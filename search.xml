<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ğŸ‰6ã€æ§åˆ¶å™¨Controllerèµ„æº</title>
      <link href="/posts/64ee6901.html"/>
      <url>/posts/64ee6901.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ§åˆ¶å™¨-Controllerèµ„æº">æ§åˆ¶å™¨ Controllerèµ„æº</h2><h3 id="1ã€æ§åˆ¶å™¨ä½œç”¨"><strong>1ã€æ§åˆ¶å™¨ä½œç”¨</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.podç±»å‹çš„èµ„æºï¼Œåˆ é™¤podåï¼Œä¸ä¼šé‡å»º</span><br><span class="line">2.æ›¿ç”¨æˆ·ç›‘è§†å¹¶ä¿è¯ç›¸åº”çš„èŠ‚ç‚¹ä¸Šå§‹ç»ˆæœ‰ç”¨æˆ·æ‰€æœŸæœ›çš„å‰¯æœ¬æ•°é‡çš„podåœ¨è¿è¡Œ</span><br><span class="line">3.å¦‚æœæ‰€è¿è¡Œçš„podå‰¯æœ¬æ•°è¶…è¿‡äº†ç”¨æˆ·æœŸæœ›çš„ï¼Œé‚£ä¹ˆæ§åˆ¶å™¨å°±ä¼šå±¾æ‰ï¼Œç›´åˆ°å’Œç”¨æˆ·æœŸæœ›çš„ä¸€è‡´</span><br><span class="line">4.å¦‚æœæ‰€è¿è¡Œçš„podå‰¯æœ¬æ•°ä½äºç”¨æˆ·æœŸæœ›çš„ï¼Œé‚£ä¹ˆæ§åˆ¶å™¨å°±ä¼šåˆ›å»ºï¼Œç›´åˆ°å’Œç”¨æˆ·æœŸæœ›çš„ä¸€è‡´</span><br></pre></td></tr></table></figure><h3 id="2ã€æ§åˆ¶å™¨çš„ç±»å‹"><strong>2ã€æ§åˆ¶å™¨çš„ç±»å‹</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1) Replicacontroller:Rc  <span class="string">&quot;å·²ç»æ·˜æ±°æ‰äº†&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¸¸ç”¨çš„</span></span><br><span class="line">2) Replicaset Rs:æŒ‰ç”¨æˆ·æœŸæœ›çš„å‰¯æœ¬åˆ›å»ºpod,å¹¶å§‹ç»ˆä¿æŒç›¸åº”æ•°é‡å‰¯æœ¬</span><br><span class="line"></span><br><span class="line">3) Deployment:</span><br><span class="line">Deploymenté€šè¿‡æ§åˆ¶RSæ¥ä¿è¯PODå§‹ç»ˆä¿æŒç›¸åº”çš„æ•°é‡å‰¯æœ¬æ”¯æŒæ»šåŠ¨æ›´æ–°ï¼Œå›æ»šï¼Œå›æ»šé»˜è®¤ä¿ç•™10ä¸ªç‰ˆæœ¬æä¾›å£°æ˜å¼é…ç½®ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹ç®¡ç†æ— çŠ¶æ€åº”ç”¨æœ€ç†æƒ³çš„æ§åˆ¶å™¨nodeèŠ‚ç‚¹å¯èƒ½ä¼šè¿è¡Œ0ä¸ªæˆ–å¤šä¸ªPOD</span><br><span class="line"></span><br><span class="line">4)Deamonset:</span><br><span class="line">ä¸€ä¸ªèŠ‚ç‚¹åªè¿è¡Œä¸€ä¸ªï¼Œå¿…é¡»æ˜¯å§‹ç»ˆè¿è¡Œçš„çŠ¶æ€</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸ªç”¨çš„æ¯”è¾ƒå°‘</span></span><br><span class="line">5)statefulset:     </span><br><span class="line">æœ‰çŠ¶æ€åº”ç”¨</span><br></pre></td></tr></table></figure><h3 id="3ã€ReplicaSet-Rs-æ§åˆ¶å™¨"><strong>3ã€ReplicaSet     Rs æ§åˆ¶å™¨</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span>        <span class="comment">#RSæ§åˆ¶å™¨çš„æ¥å£</span></span><br><span class="line">kind: <span class="string">&quot;ReplicaSet&quot;</span>           <span class="comment">#RSæ§åˆ¶å™¨çš„ç±»å‹</span></span><br><span class="line">metadata:                    <span class="comment">#RSæ§åˆ¶å™¨çš„å…ƒæ•°æ®</span></span><br><span class="line"><span class="comment">#metadataé‡Œé¢çš„nameæ˜¯è¿™ä¸ªèµ„æºçš„name,è¿™ä¸ªnameæ˜¯ç»™Rsæ§åˆ¶å™¨èµ·çš„å</span></span><br><span class="line">  name: nginx-rs             <span class="comment">#RSæ§åˆ¶å™¨çš„åå­—</span></span><br><span class="line"><span class="comment">#labesä¸éœ€è¦æ‰“ï¼Œå› ä¸ºserviceèµ„æºæ‰¾çš„æ˜¯Podèµ„æºçš„æ ‡ç­¾ï¼Œæ‰€ä»¥æ§åˆ¶å™¨çš„æ ‡ç­¾æ²¡å¿…è¦æ‰“</span></span><br><span class="line">  namespace: default         <span class="comment">#RSæ§åˆ¶å™¨å¯åŠ¨åœ¨defaultåç§°ç©ºé—´  </span></span><br><span class="line">spec:                        <span class="comment">#RSæ§åˆ¶å™¨å…³è”Pod</span></span><br><span class="line"><span class="comment">#æœ€å°çš„å‡†å¤‡æ—¶é—´ï¼Œç»™æ§åˆ¶å™¨ä¸€ä¸ªå°±ç»ªæ—¶é—´ï¼Œä¸€èˆ¬ä¸éœ€è¦å†™ï¼Œä¸éœ€è¦çº¦æŸ</span></span><br><span class="line">  <span class="comment">#minReadySeconds: integer</span></span><br><span class="line"><span class="comment">#æœŸæœ›çš„å‰¯æœ¬ï¼Œæ¯”å¦‚è¯´èµ·5ä¸ªnginxå‰¯æœ¬</span></span><br><span class="line">  replicas: 5                <span class="comment">#podå‰¯æœ¬æ•°é‡</span></span><br><span class="line"><span class="comment">#åŒ¹é…æ ‡ç­¾çš„ï¼Œæœ‰2ç§å†™æ³•ï¼Œä¸€ä¸ªæ˜¯æ‹¿æ­£åˆ™åŒ¹é…ï¼Œä¸€ä¸ªç²¾ç¡®åŒ¹é…</span></span><br><span class="line">  selector:                  <span class="comment">#æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">    matchLabels:             <span class="comment">#åŒ¹é…çš„æ ‡ç­¾</span></span><br><span class="line">    <span class="comment">#æ ‡ç­¾èƒ½è®©æ§åˆ¶å™¨æ‰¾åˆ°pod,æ‰€ä»¥è¿™é‡Œå†™podçš„æ ‡ç­¾,ä¸€ä¼špodé‡Œé¢è¦æ‰“çš„æ ‡ç­¾ä¸€å®šè¦å’Œè¿™ä¸ªä¸€æ ·</span></span><br><span class="line">      app: nginx             <span class="comment">#æ§åˆ¶å™¨åŒ¹é…çš„Podæ ‡ç­¾</span></span><br><span class="line">  template:                  <span class="comment">#Podèµ„æºä¿¡æ¯</span></span><br><span class="line">    metadata:                <span class="comment">#Podçš„å…ƒæ•°æ®</span></span><br><span class="line">      name: nginx-rs-pod       <span class="comment">#Podçš„åå­—</span></span><br><span class="line">      labels:                  <span class="comment">#PODæ‰“æ ‡ç­¾</span></span><br><span class="line">        app: nginx             <span class="comment">#PODæ‰“æ ‡ç­¾</span></span><br><span class="line">    spec:                      <span class="comment">#å®¹å™¨ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">      containers:              <span class="comment">#å®¹å™¨ä¿¡æ¯</span></span><br><span class="line">      - name: nginx-web-containers     <span class="comment">#å®¹å™¨å</span></span><br><span class="line">        image: nginx:alpine            <span class="comment">#é•œåƒ</span></span><br><span class="line">        imagePullPolicy: IfNotPresent  <span class="comment">#æ‹‰å–è§„åˆ™</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">å…¶å®Rsæ§åˆ¶å™¨å°±æ˜¯æŠŠä¹‹å‰çš„Podèµ„æºåŒ…å«èµ·æ¥</span><br></pre></td></tr></table></figure><p><img src="C:%5CUsers%5CMac%5CDesktop%5Casm_blog%5Chexo-theme-Fomalhaut%5Csource%5Cimage%5Cstudy_img%5Cimage-20240923164211035.png" alt="image-20240923164211035"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™Rsæ§åˆ¶å™¨çš„èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim nginx-rs.yml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;ReplicaSet&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-rs</span><br><span class="line">  namespace: default</span><br><span class="line">spec: </span><br><span class="line">  replicas: 5</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">    <span class="comment">#æ§åˆ¶å™¨åŒ¹é…çš„podæ ‡ç­¾</span></span><br><span class="line">      app: nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-rs-pod</span><br><span class="line">      labels:</span><br><span class="line">    <span class="comment">#Podçš„æ ‡ç­¾è¢«Rsæ§åˆ¶å™¨åŒ¹é…</span></span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx-web-containers</span><br><span class="line">        image: nginx:alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">  </span><br><span class="line">2ã€è¿è¡Œï¼Œå¹¶æŸ¥çœ‹ï¼Œè¿è¡Œçš„Podæ˜¯è½®è¯¢åœ¨node1ã€2ã€3çš„</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-rs.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide| grep nginx-rs</span><br><span class="line">nginx-rs-4z82q   1/1     Running   0      6m13s   10.2.2.9    node02</span><br><span class="line">nginx-rs-d5mhz   1/1     Running   0      6m13s   10.2.2.10   node02</span><br><span class="line">nginx-rs-qv5l6   1/1     Running   0      6m13s   10.2.3.62   node03</span><br><span class="line">nginx-rs-t8hz6   1/1     Running   0      6m13s   10.2.1.16   node01</span><br><span class="line">nginx-rs-tksxm   1/1     Running   0      6m13s   10.2.1.17   node01</span><br><span class="line"></span><br><span class="line">Podçš„åå­—åœ¨èµ„æºæ¸…å•ä¸­åŠ nginx-pod,ä½†æ˜¯ä¸æŒ‰podåå­—æ¥ï¼Œæ˜¯æ ¹å…·æ§åˆ¶å™¨name: nginx-rsè¿™ä¸ªåŠ ä¸Šéšæœºå­—ç¬¦ä¸²</span><br></pre></td></tr></table></figure><p>1ã€rsèµ„æºçš„æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl get replicasets</span><br><span class="line"> <span class="comment">#                  æœŸæœ›æ•°é‡   å½“å‰æ•°é‡</span></span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-5f5d9d69c4   1         1         1       5d2h</span><br><span class="line">nginx-65cc99f84f   0         0         0       5d8h</span><br><span class="line">nginx-rs           5         5         5       11m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl get rs -owide</span><br><span class="line">[root@master01 kubernetes]# kubectl get replicasets -owide</span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE    CONTAINERS             IMAGES         SELECTOR  </span><br><span class="line">nginx-rs           5         5         5       13m    nginx-web-containers   nginx:alpine   app=nginx  <span class="comment">#æ ‡ç­¾é€‰æ‹©å™¨é€‰æ‹©å¸¦app=nginxè¿™ä¸ªæ ‡ç­¾çš„ </span></span><br><span class="line"></span><br><span class="line">2ã€#æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span><br><span class="line">[root@master01 kubernetes]# kubectl describe rs nginx-rs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#æŒç»­è¾“å‡º</span><br><span class="line">å½“å‰çª—å£A</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs -w</span><br><span class="line">å†æ‰“å¼€ä¸€ä¸ªmasteræ–°çª—å£Bï¼Œ</span><br><span class="line">[root@master01 ~]# kubectl get pod -w</span><br><span class="line"></span><br><span class="line">å†æ‰“å¼€ä¸€ä¸ªmasteræ–°çª—å£Cï¼Œåˆ é™¤ä¸€ä¸ªpod,æ—§çª—å£æœ‰è¾“å‡ºä¿¡æ¯</span><br><span class="line">[root@master01 ~]# kubectl delete pod nginx-rs-4z82q</span><br><span class="line"></span><br><span class="line">çª—å£Aã€Bä¼šæœ‰è¾“å‡ºä¿¡æ¯ï¼Œçª—å£Bä¼šæ ‡è®°åˆ é™¤Terminating(æ­¤æ—¶åªæ˜¯æ ‡è®°ï¼Œå¹¶æ²¡æœ‰çœŸåˆ é™¤)ï¼Œç„¶åä¸ºäº†ä¿è¯ä½ çš„æœŸæœ›ï¼Œä¼šèµ¶ç´§åˆ›å»ºä¸€ä¸ªæ–°çš„Pendingï¼Œç„¶ååˆå§‹åŒ–å®¹å™¨ContainerCreatingï¼Œä¹‹ååœ¨åˆ é™¤Terminatingï¼Œæ–°å®¹å™¨è¿è¡Œä¹‹åï¼Œæ‰å½»åº•è¢«åˆ é™¤æ‰</span><br><span class="line"></span><br><span class="line">4ã€#åˆ é™¤PODï¼ˆåªèƒ½åˆ é™¤rsæ§åˆ¶å™¨ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨æ‹‰èµ·ï¼‰</span><br><span class="line">å½“æˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ªpodï¼Œdelete podæ˜¯åˆ ä¸æ‰çš„ï¼Œåˆ äº†å°±ä¼šé‡æ–°èµ·æ¥ï¼Œæ‰€ä»¥åˆ rsæ§åˆ¶å™¨æ‰å½»åº•åˆ é™¤</span><br><span class="line">kubectl delete æ§åˆ¶å™¨ æ§åˆ¶å™¨å</span><br><span class="line">[root@master01 kubernetes]# kubectl delete rs nginx-rs</span><br></pre></td></tr></table></figure><p>2ã€Rsèµ„æºæ‰‹åŠ¨æ‰©ç¼©å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">1ã€ç¼–è¾‘èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹å‰¯æœ¬æ•°é‡</span><br><span class="line">[root@master01 kubernetes]# vim nginx-rs.yml </span><br><span class="line">replicas: 8</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œï¼ŒæŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-rs.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs </span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-rs           8         8         8       10s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼š  ä½¿ç”¨å†…ç½®çš„editå‘½ä»¤å»ä¿®æ”¹èµ„æºæ¸…å•</span></span><br><span class="line">1ã€ç¼–è¾‘æ§åˆ¶å™¨çš„èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹å‰¯æœ¬æ•°é‡   å¦‚æœæ˜¯æ”¾åˆ°å…¶ä»–åç§°ç©ºé—´ï¼Œåé¢è¦åŠ  -n æŒ‡å®šåç§°ç©ºé—´</span><br><span class="line">[root@master01 kubernetes]# kubectl edit rs nginx-rs </span><br><span class="line">replicas: 4</span><br><span class="line">ä¿®æ”¹ä¹‹åç›´æ¥æŸ¥çœ‹ï¼Œä¸éœ€è¦apply,ç›´æ¥ç”Ÿæ•ˆ</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs</span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-rs           4         4         4       5m56s</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸‰ï¼š   ä½¿ç”¨ä¸“é—¨çš„å‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œæ‰©ç¼©å®¹ï¼Œå‡çº§</span></span><br><span class="line">[root@master01 kubernetes]# kubectl scale rs nginx-rs --replicas=7</span><br><span class="line"></span><br><span class="line">scaleï¼šæ‰‹åŠ¨æ‰©ç¼©å®¹</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs</span><br><span class="line">NAME               DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-rs           7         7         7       13m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸“ä¸šä¸€ç‚¹æ˜¯æ ¹æ®ç‰©ç†æœºçš„èµ„æºå ç”¨æƒ…å†µæ¥åšä¸€ä¸ªè®¡ç®—ï¼Œå¦‚æœæŠ—ä¸ä½äº†å°±è‡ªåŠ¨ç¼©å®¹</span></span><br></pre></td></tr></table></figure><h3 id="4ã€Deployment-æ§åˆ¶å™¨"><strong>4ã€Deployment æ§åˆ¶å™¨</strong></h3><p>1ã€Deploymentæ§åˆ¶å™¨çš„åŠŸèƒ½å’Œå…³ç³»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Deploymenté€šè¿‡æ§åˆ¶RSæ¥ä¿è¯Podå§‹ç»ˆä¿æŒç›¸å¯¹äºçš„æ•°é‡å‰¯æœ¬</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240923200104784.png" alt="image-20240923200104784"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RSæ§åˆ¶å™¨ä»–ä¼šè¾¾åˆ°ä½ çš„æœŸæœ›å‰¯æœ¬ï¼Œç¼ºé™·ä¸èƒ½åšç‰ˆæœ¬å‡çº§</span><br><span class="line">Deploymentä¹‹æ‰€ä»¥è¦æ§åˆ¶RSæ§åˆ¶å™¨æ˜¯å› ä¸ºè¦ä¿ç•™RSæ§åˆ¶å™¨çš„åŠŸèƒ½ï¼Œä¿è¯ç”¨æˆ·æœŸæœ›çš„å‰¯æœ¬æ•°é‡ä¸€ç›´å­˜åœ¨</span><br><span class="line"></span><br><span class="line">æ”¯æŒæ»šåŠ¨æ›´æ–°ï¼Œå›æ»šï¼Œå›æ»šé»˜è®¤ä¿ç•™10ä¸ªç‰ˆæœ¬(ä¹Ÿå°±é»˜è®¤ä¿ç•™10ä¸ªRSæ§åˆ¶å™¨)</span><br><span class="line">æä¾›å£°æ˜å¼é…ç½®ï¼Œæ”¯æŒåŠ¨æ€ä¿®æ”¹</span><br><span class="line">ç®¡ç†æ— çŠ¶æ€åº”ç”¨æœ€ç†æƒ³çš„æ§åˆ¶å™¨</span><br><span class="line">nodeèŠ‚ç‚¹å¯èƒ½è¿è¡Œ0ä¸ªæˆ–å¤šä¸ªpod</span><br></pre></td></tr></table></figure><p>2ã€Deploymentæ§åˆ¶å™¨çš„èµ„æºæ¸…å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cp</span> nginx-rs.yml nginx-dp.yml </span><br><span class="line">[root@master01 kubernetes]# vim nginx-dp.yml </span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line"><span class="comment">#å°±ä¿®æ”¹è¿™é‡Œæ§åˆ¶å™¨çš„åå­—ï¼Œç„¶åå†ä¿®æ”¹ä¸€ä¸‹ä¸‹é¢çš„æ ‡ç­¾</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec: </span><br><span class="line">  replicas: 8</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx-dp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-dp-pod</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx-dp</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx-web-containers</span><br><span class="line">        image: nginx:alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œå¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-dp.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">[root@master01 kubernetes]# kubectl get deployments.apps </span><br><span class="line">NAME       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-dp   8/8     8            8           39s</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹æ§åˆ¶å™¨çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">[root@master01 kubernetes]# kubectl describe deployments.apps nginx-dp </span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240923202757305.png" alt="image-20240923202757305"></p><p>3ã€Deploymentçš„æ‰©ç¼©å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">1ã€ç¼–è¾‘èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹å‰¯æœ¬æ•°é‡</span><br><span class="line">[root@master01 kubernetes]# vim nginx-dp.yml </span><br><span class="line">replicas: 6</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œï¼ŒæŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-dp.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">[root@master01 kubernetes]# kubectl get deployments.apps </span><br><span class="line">NAME       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-dp   6/6     6            6           69m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼š  ä½¿ç”¨å†…ç½®çš„editå‘½ä»¤å»ä¿®æ”¹èµ„æºæ¸…å•</span></span><br><span class="line">1ã€ç¼–è¾‘æ§åˆ¶å™¨çš„èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹å‰¯æœ¬æ•°é‡   å¦‚æœæ˜¯æ”¾åˆ°å…¶ä»–åç§°ç©ºé—´ï¼Œåé¢è¦åŠ  -n æŒ‡å®šåç§°ç©ºé—´</span><br><span class="line">[root@master01 kubernetes]# kubectl edit deployments.apps nginx-dp </span><br><span class="line">replicas: 10</span><br><span class="line">ä¿®æ”¹ä¹‹åç›´æ¥æŸ¥çœ‹ï¼Œä¸éœ€è¦apply,ç›´æ¥ç”Ÿæ•ˆ</span><br><span class="line">[root@master01 kubernetes]# kubectl get deployments.apps </span><br><span class="line">NAME       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-dp   10/10   10           10          71m</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸‰ï¼š   ä½¿ç”¨ä¸“é—¨çš„å‘½ä»¤ä¿®æ”¹é…ç½®ï¼Œæ‰©ç¼©å®¹</span></span><br><span class="line">[root@master01 kubernetes]# kubectl scale deployment nginx-dp --replicas=4</span><br><span class="line">scaleï¼šæ‰‹åŠ¨æ‰©ç¼©å®¹</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">[root@master01 kubernetes]# kubectl get deployments.apps </span><br><span class="line">NAME       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-dp   4/4     4            4           73m</span><br></pre></td></tr></table></figure><p>4ã€Deploymentæ›´æ–°ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">1ã€ç¼–è¾‘èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ç‰ˆæœ¬</span><br><span class="line">[root@master01 kubernetes]# vim nginx-dp.yml </span><br><span class="line">image: nginx:alpine æ”¹æˆ image: nginx:1.20.1</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œï¼ŒæŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-dp.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">[root@master01 kubernetes]# kubectl get deployments.apps </span><br><span class="line">NAME       READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx-dp   6/6     6            6           69m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼š  ä½¿ç”¨å†…ç½®çš„editå‘½ä»¤å»ä¿®æ”¹èµ„æºæ¸…å•</span></span><br><span class="line">1ã€ç¼–è¾‘æ§åˆ¶å™¨çš„èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ç‰ˆæœ¬   å¦‚æœæ˜¯æ”¾åˆ°å…¶ä»–åç§°ç©ºé—´ï¼Œåé¢è¦åŠ  -n æŒ‡å®šåç§°ç©ºé—´</span><br><span class="line">[root@master01 kubernetes]# kubectl edit deployments.apps nginx-dp </span><br><span class="line">- image: nginx:alpine æ”¹æˆ - image: nginx:1.20.1</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹ä¹‹åç›´æ¥æŸ¥çœ‹ï¼Œä¸éœ€è¦apply,ç›´æ¥ç”Ÿæ•ˆ</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs</span><br><span class="line">NAME                  DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-dp-6447db69d8   0         0         0       79m</span><br><span class="line">nginx-dp-7b88fc7dff   6         6         6       2m8s</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªç‰ˆæœ¬æ˜¯æ²¡æœ‰ç›´æ¥æ˜¾ç¤ºï¼Œå¯ä»¥æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl describe rs nginx-dp-7b88fc7dff| grep -n <span class="string">&#x27;.*&#x27;</span></span><br><span class="line">17è¡Œ    Image:        nginx:1.20.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸‰ï¼š   ä½¿ç”¨ä¸“é—¨çš„å‘½ä»¤å‡çº§</span></span><br><span class="line">kubectl <span class="built_in">set</span> image -f èµ„æºæ¸…å• å®¹å™¨å=é•œåƒ:ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">set</span> image -f nginx-dp.yml nginx-web-containers=nginx:1.16.0</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ä¿ç•™çš„å‡ ä¸ªç‰ˆæœ¬</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs</span><br></pre></td></tr></table></figure><p>æ»šåŠ¨æ›´æ–°ç¤ºæ„å›¾ï¼š</p><p><img src="../image/study_img/image-20240923115022973.png" alt="image-20240923115022973"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹ç‰ˆæœ¬æ»šåŠ¨çš„çŠ¶æ€æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">[root@master01 kubernetes]# kubectl rollout status deployment nginx-dp </span><br><span class="line">deployment <span class="string">&quot;nginx-dp&quot;</span> successfully rolled out</span><br></pre></td></tr></table></figure><p>5ã€Deploymentå›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å›æ»šå…¶å®å’Œä¸Šé¢çš„æ›´æ–°æ–¹æ³•ä¸€æ ·çš„ï¼Œæ”¹ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">1ã€ç¼–è¾‘èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ç‰ˆæœ¬</span><br><span class="line">[root@master01 kubernetes]# vim nginx-dp.yml </span><br><span class="line">image: nginx:alpine æ”¹æˆ image: nginx:1.20.1</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œï¼ŒæŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-dp.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">[root@master01 kubernetes]# kubectl get deployments.apps </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼š  ä½¿ç”¨å†…ç½®çš„editå‘½ä»¤å»ä¿®æ”¹èµ„æºæ¸…å•</span></span><br><span class="line">1ã€ç¼–è¾‘æ§åˆ¶å™¨çš„èµ„æºæ¸…å•ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚ä¿®æ”¹ç‰ˆæœ¬   å¦‚æœæ˜¯æ”¾åˆ°å…¶ä»–åç§°ç©ºé—´ï¼Œåé¢è¦åŠ  -n æŒ‡å®šåç§°ç©ºé—´</span><br><span class="line">[root@master01 kubernetes]# kubectl edit deployments.apps nginx-dp </span><br><span class="line">- image: nginx:alpine æ”¹æˆ - image: nginx:1.20.1</span><br><span class="line"></span><br><span class="line">ä¿®æ”¹ä¹‹åç›´æ¥æŸ¥çœ‹ï¼Œä¸éœ€è¦apply,ç›´æ¥ç”Ÿæ•ˆ</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªç‰ˆæœ¬æ˜¯æ²¡æœ‰ç›´æ¥æ˜¾ç¤ºï¼Œå¯ä»¥æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl describe rs nginx-dp-7b88fc7dff| grep -n <span class="string">&#x27;.*&#x27;</span></span><br><span class="line">17è¡Œ    Image:        nginx:1.20.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸‰ï¼š   ä½¿ç”¨ä¸“é—¨çš„å‘½ä»¤å‡çº§</span></span><br><span class="line">kubectl <span class="built_in">set</span> image -f èµ„æºæ¸…å• å®¹å™¨å=é•œåƒ:ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">set</span> image -f nginx-dp.yml nginx-web-containers=nginx:1.16.0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å†å²ç‰ˆæœ¬</span></span><br><span class="line">[root@master01 kubernetes]# kubectl rollout <span class="built_in">history</span> deployment nginx-dp </span><br><span class="line">deployment.apps/nginx-dp </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         &lt;none&gt;</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">3         &lt;none&gt;</span><br><span class="line">ä¿ç•™10ä¸ªï¼Œç°åœ¨åªè¦3ä¸ª</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æŒ‡å®šå†å²ç‰ˆæœ¬çš„ä¿¡æ¯</span></span><br><span class="line">[root@master01 kubernetes]# kubectl rollout <span class="built_in">history</span> deployment nginx-dp --revision=1</span><br><span class="line">ç¬¬7è¡Œå¯ä»¥çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">Image:      nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="comment">#çœ‹å®Œç‰ˆæœ¬åï¼Œå°±å¯ä»¥å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">[root@master01 kubernetes]# kubectl rollout undo deployment nginx-dp --to-revision=1</span><br><span class="line">[root@master01 kubernetes]# kubectl get rs</span><br><span class="line">NAME                  DESIRED   CURRENT   READY   AGE</span><br><span class="line">nginx-dp-57fb845d6d   0         0         0       3m45s</span><br><span class="line">nginx-dp-6447db69d8   6         6         6       109m</span><br><span class="line">nginx-dp-6c696f4449   0         0         0       22m</span><br><span class="line">nginx-dp-7b88fc7dff   0         0         0       31m</span><br><span class="line">[root@master01 kubernetes]# kubectl describe rs nginx-dp-6447db69d8</span><br><span class="line">æŸ¥çœ‹å·²ç»å›åˆ°alpineç‰ˆæœ¬</span><br><span class="line">    Image:        nginx:alpine</span><br></pre></td></tr></table></figure><p>å°æŠ€å·§  ä½¿ç”¨â€“recordåœ¨å†å²ç‰ˆæœ¬ä¸­è®°å½•å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å†å²ç‰ˆæœ¬</span></span><br><span class="line">[root@master01 kubernetes]# kubectl rollout <span class="built_in">history</span> deployment nginx-dp </span><br><span class="line">deployment.apps/nginx-dp </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         &lt;none&gt;</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">3         &lt;none&gt;</span><br><span class="line"></span><br><span class="line">å½“å‰ç‰ˆæœ¬ä¿¡æ¯ä¸º&lt;none&gt;ï¼Œå½“ä½¿ç”¨å‘½ä»¤å»æ›´æ”¹çš„ä½¿ç”¨ï¼Œå¯ä»¥åœ¨æœ€åé¢åŠ ä¸Šé€‰é¡¹--record,å¯ä»¥è®°å½•è¿™æ¡æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœèµ„æºæ¸…å•åŠ ä¸Šç‰ˆæœ¬å·ï¼Œä¹Ÿæ˜¯å¯ä»¥æ˜¾ç¤ºï¼Œç”¨æ³•å¦‚ä¸‹</span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">1ã€ä¿®æ”¹èµ„æºæ¸…å•ï¼Œæ”¹ä¸€ä¸‹é‡Œé¢çš„ç‰ˆæœ¬</span><br><span class="line">[root@master01 kubernetes]# vim nginx-dp.yml </span><br><span class="line">image: nginx:1.17.4</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œèµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-dp.yml --record</span><br><span class="line">[root@master01 kubernetes]# kubectl rollout <span class="built_in">history</span> deployment nginx-dp </span><br><span class="line">deployment.apps/nginx-dp </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">3         &lt;none&gt;</span><br><span class="line">4         &lt;none&gt;</span><br><span class="line">5         &lt;none&gt;</span><br><span class="line">6         kubectl apply --filename=nginx-dp.yml --record=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼š</span></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">set</span> image -f nginx-dp.yml nginx-web-containers=nginx:1.18.4 --record</span><br><span class="line">deployment.apps/nginx-dp image updated</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl rollout <span class="built_in">history</span> deployment nginx-dp </span><br><span class="line">deployment.apps/nginx-dp </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">2         &lt;none&gt;</span><br><span class="line">3         &lt;none&gt;</span><br><span class="line">4         &lt;none&gt;</span><br><span class="line">5         &lt;none&gt;</span><br><span class="line">6         kubectl apply --filename=nginx-dp.yml --record=<span class="literal">true</span></span><br><span class="line">7         kubectl <span class="built_in">set</span> image nginx-web-containers=nginx:1.18.4 --filename=nginx-dp.yml --record=<span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="5ã€DaemonSet-æ§åˆ¶å™¨"><strong>5ã€DaemonSet æ§åˆ¶å™¨</strong></h3><p>1ã€DaemonSetç±»å‹ä»‹ç»   åº”ç”¨åœºæ™¯ï¼šæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰ä¸”åªèµ·ä¸€ä¸ªpodï¼Œåƒzabbix-agent,flannel</p><p><img src="../image/study_img/image-20240923120503080.png" alt="image-20240923120503080"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç®€å•æ¥è¯´å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ¨ç½²ä¸€ä¸ªPODå‰¯æœ¬</span><br><span class="line">å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š</span><br><span class="line">ç›‘æ§å®¹å™¨</span><br><span class="line">æ—¥å¿—æ”¶é›†å®¹å™¨</span><br></pre></td></tr></table></figure><p>2ã€DaemonSetçš„èµ„æºæ¸…å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cp</span> nginx-dp.yml nginx-ds.yml</span><br><span class="line">[root@master01 kubernetes]# vim nginx-ds.yml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line"><span class="comment">#ä¿®æ”¹ä¸€ä¸‹æ§åˆ¶å™¨ç±»å‹</span></span><br><span class="line">kind: <span class="string">&quot;DaemonSet&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ds</span><br><span class="line">  namespace: default</span><br><span class="line">spec: </span><br><span class="line">  <span class="comment">#replicas: 6  è¿™è¡Œä¸è¦</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx-ds</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-ds-pod</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx-ds</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx-web-containers</span><br><span class="line">        image: nginx:alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œèµ„æºæ¸…å•ï¼Œå¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide| grep nginx-ds</span><br><span class="line">nginx-ds-7gpkh              1/1     Running            0          3m21s   10.2.1.38   node01</span><br><span class="line">nginx-ds-9r2hz              1/1     Running            0          3m21s   10.2.2.34   node02</span><br><span class="line">nginx-ds-vmjsj              1/1     Running            0          3m21s   10.2.3.81   node03</span><br><span class="line">[root@master01 kubernetes]# kubectl get ds</span><br><span class="line">NAME       DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE</span><br><span class="line">nginx-ds   3         3         3       3            3   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸éœ€è¦æ‰©ç¼©å®¹ï¼Œä¸€å°æœºå™¨åªèƒ½èµ·ä¸€ä¸ªï¼Œé™¤éåŠ node</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¿™å‡ ä¸ªæ§åˆ¶å™¨ï¼Œä»¥åçœ‹ä½ èµ·ä»€ä¹ˆæ ·çš„æœåŠ¡ï¼Œå»å†³å®šä½ ç”¨ä»€ä¹ˆç±»å‹çš„æ§åˆ¶å™¨ï¼Œé™¤äº†å®¢æˆ·ç«¯ç±»å‹çš„ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯Deplament</span><br><span class="line"></span><br><span class="line">StatefulSetæ§åˆ¶å™¨</span><br><span class="line">mysqlä¸»ä»å¤åˆ¶ ï¼Œkepalived</span><br><span class="line">è¿™ä¸ªç”¨çš„å°‘ï¼Œå¦‚æœéœ€è¦å¯ä»¥ä»ç½‘ä¸Šæœç´¢K8smysqlä¸»ä»å¤åˆ¶</span><br></pre></td></tr></table></figure><p>å°ç»ƒä¹ ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1ã€## ä½¿ç”¨æ§åˆ¶å™¨èµ·wordpress</span><br><span class="line">ä¸€ï¼šwordpressé•œåƒ</span><br><span class="line">åœ¨ä¸€ä¸ªPODé‡Œå¯åŠ¨ä¸¤ä¸ªå®¹å™¨</span><br><span class="line">- wordpress</span><br><span class="line">- mysql5.7</span><br><span class="line">1.å°±ç»ªæ€§æ¢é’ˆ</span><br><span class="line">2.å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line">3.å¯åŠ¨é’©å­</span><br><span class="line">4.åœæ­¢é’©å­</span><br><span class="line">5.åˆå§‹åŒ–å®¹å™¨</span><br><span class="line">äºŒï¼šå°è¯• wordpress å¯åŠ¨ä¸€ä¸ªPOD</span><br><span class="line">MySQLå•ç‹¬å¯åŠ¨åœ¨ä¸€ä¸ªPODé‡Œ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€## äº†è§£HPA è‡ªåŠ¨æ‰©ç¼©å®¹</span><br><span class="line">3ã€## å†™ä¸€ä¸ªMySQLä¸»ä»å¤åˆ¶çš„èµ„æºæ¸…å•</span><br></pre></td></tr></table></figure><p>ä¸€ã€ä½¿ç”¨æ§åˆ¶å™¨èµ·wordpress</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line"><span class="comment">#ç»™Deploymentèµ„æºèµ·çš„åå­—</span></span><br><span class="line">  name: wp-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#èµ·2ä¸ªï¼Œæ•°æ®ä¹Ÿæ˜¯2ä¸ªï¼Œé™¤éæŠŠæ•°æ®åˆ†å¼€ï¼Œæ‰€ä»¥ç°åœ¨åªèƒ½èµ·1ä¸ª</span></span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: wp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: wp-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        app: wp</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: mysql-data</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /data/mysql</span><br><span class="line">      - name: wp-data</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /data/wp</span><br><span class="line">      containers:</span><br><span class="line">      - name: wp-container</span><br><span class="line">        image: wordpress</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        livenessProbe:</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 80</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 3</span><br><span class="line">          timeoutSeconds: 3</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">        readinessProbe:</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 3306</span><br><span class="line">          initialDelaySeconds: 3</span><br><span class="line">          timeoutSeconds: 1</span><br><span class="line">          periodSeconds: 2</span><br><span class="line">          successThreshold: 3</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_USER</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_NAME</span><br><span class="line">          value: <span class="string">&#x27;wp_db&#x27;</span></span><br><span class="line">        </span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: wp-data</span><br><span class="line">          mountPath: /var/www/html/</span><br><span class="line">    </span><br><span class="line">      - name: mysql-container</span><br><span class="line">        image: mysql:5.7</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        args:</span><br><span class="line">        - --character-set-server=utf8</span><br><span class="line">        - --collation-server=utf8_general_ci</span><br><span class="line">        livenessProbe:</span><br><span class="line">          <span class="built_in">exec</span>:</span><br><span class="line">            <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;mysqladmin -uroot -p123 ping&quot;</span>]</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 3</span><br><span class="line">          timeoutSeconds: 3</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: MYSQL_DATABASE</span><br><span class="line">          value: <span class="string">&#x27;wp_db&#x27;</span></span><br><span class="line">        - name: MYSQL_USER</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: mysql-data</span><br><span class="line">          mountPath: /var/lib/mysql</span><br><span class="line">          </span><br><span class="line">ç›®å‰çš„èµ„æºæ¸…å•è¿˜æ˜¯æœ‰ç¼ºé™·</span><br><span class="line">1ã€å¯¹å¤–æä¾›æœåŠ¡çš„é—®é¢˜</span><br><span class="line">2ã€æ•°æ®å®¹å™¨å’Œwordpresså®¹å™¨åœ¨åŒä¸€ä¸ªpodé‡Œï¼Œæ­£å¸¸åº”è¯¥åˆ†å¼€èµ·åœ¨ä¸åŒpod</span><br><span class="line">3ã€è‡ªåŠ¨æ‰©ç¼©å®¹</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰7ã€è‡ªåŠ¨æ‰©ç¼©å®¹HPA</title>
      <link href="/posts/276654d0.html"/>
      <url>/posts/276654d0.html</url>
      
        <content type="html"><![CDATA[<h2 id="è‡ªåŠ¨æ‰©ç¼©å®¹HPA">è‡ªåŠ¨æ‰©ç¼©å®¹HPA</h2><h3 id="1ã€HPAçš„ä»‹ç»"><strong>1ã€HPAçš„ä»‹ç»</strong></h3><p>HorizontalPodAutoscalerï¼ˆç®€ç§° HPA ï¼‰ è‡ªåŠ¨æ›´æ–°å·¥ä½œè´Ÿè½½èµ„æºï¼ˆä¾‹å¦‚ Deployment æˆ–è€…StatefulSetï¼‰ï¼Œ ç›®çš„æ˜¯è‡ªåŠ¨æ‰©ç¼©å·¥ä½œè´Ÿè½½ä»¥æ»¡è¶³éœ€æ±‚ã€‚<br>æ°´å¹³æ‰©ç¼©æ„å‘³ç€å¯¹å¢åŠ çš„è´Ÿè½½çš„å“åº”æ˜¯éƒ¨ç½²æ›´å¤šçš„ Podã€‚ è¿™ä¸â€œå‚ç›´ï¼ˆVerticalï¼‰â€æ‰©ç¼©ä¸åŒï¼Œå¯¹äºKubernetesï¼Œ å‚ç›´æ‰©ç¼©æ„å‘³ç€å°†æ›´å¤šèµ„æºï¼ˆä¾‹å¦‚ï¼šå†…å­˜æˆ– CPUï¼‰åˆ†é…ç»™å·²ç»ä¸ºå·¥ä½œè´Ÿè½½è¿è¡Œçš„ Podã€‚<br>å¦‚æœè´Ÿè½½å‡å°‘ï¼Œå¹¶ä¸” Pod çš„æ•°é‡é«˜äºé…ç½®çš„æœ€å°å€¼ï¼Œ HorizontalPodAutoscaler ä¼šæŒ‡ç¤ºå·¥ä½œè´Ÿè½½èµ„æºï¼ˆDeploymentã€StatefulSet æˆ–å…¶ä»–ç±»ä¼¼èµ„æºï¼‰ç¼©å‡ã€‚<br>æœ¬æ–‡æ¡£å°†å¼•å¯¼ä½ å®Œæˆå¯ç”¨ HorizontalPodAutoscaler ä»¥è‡ªåŠ¨ç®¡ç†ç¤ºä¾‹ Web åº”ç”¨ç¨‹åºçš„æ‰©ç¼©çš„ç¤ºä¾‹ã€‚ æ­¤ç¤ºä¾‹å·¥ä½œè´Ÿè½½æ˜¯è¿è¡Œä¸€äº› PHP ä»£ç çš„ Apache httpd</p><p><font color=red>æ€»ç»“ï¼šHPAå¯æ ¹æ®ç³»ç»Ÿè´Ÿè½½æƒ…å†µ(CPUã€å†…å­˜ã€ç£ç›˜ã€å¹³å‡è´Ÿè½½)ï¼Œå¯¹æ§åˆ¶å™¨(Deploymentã€statefulsetã€ReplicaSet)è¿›è¡Œæ“ä½œï¼Œä¿®æ”¹å‰¯æœ¬æ•°é‡ï¼Œè¾¾åˆ°æ‰©ç¼©å®¹çš„ç›®çš„</font>&gt;</p><h3 id="2ã€Metrics-Serviceä»‹ç»"><strong>2ã€Metrics Serviceä»‹ç»</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Metricsï¼šæŒ‡æ ‡çš„æ„æ€</span><br><span class="line">ä»€ä¹ˆæƒ…å†µä¸‹æ‰©å®¹é‡ï¼šè´Ÿè½½é«˜</span><br><span class="line">ç¼©å®¹ï¼šPod çš„æ•°é‡é«˜äºé…ç½®çš„æœ€å°å€¼</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nodeèµ„æºçš„ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">[root@master01 ~]# kubectl top node</span><br><span class="line">error: Metrics API not available</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/</span><br><span class="line"></span><br><span class="line">HPAæ€ä¹ˆçŸ¥é“ç³»ç»Ÿè´Ÿè½½çš„æƒ…å†µï¼Ÿ</span><br><span class="line">éœ€è¦æœ‰Metrics serviceæœåŠ¡</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240924084519004.png" alt="image-20240924084519004"></p><p><img src="../image/study_img/image-20240924085953555.png" alt="image-20240924085953555"></p><p><img src="../image/study_img/image-20240924141858256.png" alt="image-20240924141858256"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Metrics Serveræ˜¯Kuberneteså†…ç½®è‡ªåŠ¨ç¼©æ”¾ç®¡é“çš„å¯æ‰©å±•ã€é«˜æ•ˆçš„å®¹å™¨èµ„æºåº¦é‡æºã€‚</span><br><span class="line">Metrics Serverä»Kubeletsæ”¶é›†èµ„æºåº¦é‡ï¼Œå¹¶é€šè¿‡Metrics APIåœ¨Kubernetes apiserverä¸­å…¬å¼€è¿™äº›åº¦é‡ï¼Œä¾›Horizontal Pod Autoscalerå’ŒVertical Pod Autocalerä½¿ç”¨ã€‚kubectl topè¿˜å¯ä»¥è®¿é—®åº¦é‡APIï¼Œä»è€Œæ›´å®¹æ˜“åœ°è°ƒè¯•è‡ªåŠ¨ç¼©æ”¾ç®¡é“</span><br></pre></td></tr></table></figure><p>ç‰ˆæœ¬çš„é€‰æ‹©ï¼š</p><table><thead><tr><th>Metrics Server</th><th>Metrics APl group/version</th><th>Supported Kubernetes version</th></tr></thead><tbody><tr><td>0.7.x</td><td><a href="http://metrics.k8s.io/v1beta1">metrics.k8s.io/v1beta1</a></td><td>1.19+</td></tr><tr><td>0.6.x</td><td><a href="http://metrics.k8s.io/v1beta1">metrics.k8s.io/v1beta1</a></td><td>1.19+</td></tr><tr><td>0.5.x</td><td><a href="http://metrics.k8s.io/v1beta1">metrics.k8s.io/v1beta1</a></td><td>*1.8+</td></tr><tr><td>0.4.x</td><td><a href="http://metrics.k8s.io/v1beta1">metrics.k8s.io/v1beta1</a></td><td>*1.8+</td></tr><tr><td>0.3.x</td><td><a href="http://metrics.k8s.io/v1beta1">metrics.k8s.io/v1beta1</a></td><td>1.8-1.21</td></tr></tbody></table><h3 id="3ã€éƒ¨ç½²Metics-Server"><strong>3ã€éƒ¨ç½²Metics Server</strong></h3><p>1ã€éƒ¨ç½²Metics Server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">registry.k8s.io/metrics-server/metrics-server:v0.7.2æ˜¯è°·æ­Œå†…éƒ¨é•œåƒç«™ä¸‹è½½ï¼Œä½†æ˜¯æ— æ³•ä¸‹è½½ï¼Œéœ€è¦æ‰‹æ®µï¼Œå¯ä»¥ä»å¦‚ä¸‹åœ°å€ä¸‹è½½</span><br><span class="line">http://test.driverzeng.com/HPA/metrics-server.tarï¼Œèµ„æºæ¸…å•å’Œé•œåƒéƒ½æœ‰</span><br><span class="line"></span><br><span class="line">1ã€æŸ¥çœ‹å½“å‰k8sç‰ˆæœ¬</span><br><span class="line">[root@master01 service]#  kubectl version | grep <span class="string">&quot;GitVersion:&quot;</span></span><br><span class="line">GitVersion:<span class="string">&quot;v1.19.3&quot;</span></span><br><span class="line"></span><br><span class="line">2ã€å»ºè®®æ¯ä¸ªnodeéƒ½ä¸‹è½½é•œåƒ</span><br><span class="line">wget http://test.driverzeng.com/HPA/metrics-server.tar</span><br><span class="line">wget http://test.driverzeng.com/HPA/components.yaml</span><br><span class="line"></span><br><span class="line">3ã€æ¯ä¸ªnodeå¯¼å…¥é•œåƒ</span><br><span class="line">[root@node01 ~]# docker load &lt; metrics-server.tar</span><br><span class="line"></span><br><span class="line">4ã€ä¿®æ”¹èµ„æºæ¸…å•</span><br><span class="line"></span><br><span class="line">[root@node01 ~]# <span class="built_in">mv</span> components.yaml.1 components.yaml</span><br><span class="line">[root@node01 ~]# vim components.yaml</span><br><span class="line">â‘ ã€åˆ é™¤è¿™å‡ è¡Œ</span><br><span class="line">122   strategy:</span><br><span class="line">123     rollingUpdate:</span><br><span class="line">124       maxUnavailable: 0</span><br><span class="line">â‘¡ã€ä¿®æ”¹æ§åˆ¶å™¨èµ„æºï¼Œä¸ºäº†ä¿è¯æ¯å°èµ·ä¸€ä¸ªæ‰€ä»¥è¦ä¿®æ”¹</span><br><span class="line">112 å°†kind: Deployment æ”¹ä¸ºkind: DaemonSet</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€å¯åŠ¨ï¼Œå¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f components.yaml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -n kube-system -owide</span><br><span class="line">NAME                  READY   STATUS    RE         AGE     </span><br><span class="line">metrics-server-9kcvb  1/1     Running   0      5h40m 10.0.0.202   node02  </span><br><span class="line">metrics-server-nltkh  1/1     Running   0          5h40m 10.0.0.201   node01  </span><br><span class="line">metrics-server-v28cw  1/1     Running   0          5h40m 10.0.0.203   node03  </span><br><span class="line"></span><br><span class="line">6ã€æŸ¥çœ‹nodeèŠ‚ç‚¹èµ„æºçš„å ç”¨æƒ…å†µ            </span><br><span class="line">[root@master01 kubernetes]# kubectl top node</span><br><span class="line">NAME       CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   </span><br><span class="line">master01   167m         16%    1248Mi          71%       </span><br><span class="line">node01     70m          7%     507Mi           29%       </span><br><span class="line">node02     73m          7%     615Mi           35%       </span><br><span class="line">node03     110m         5%     688Mi           20% </span><br><span class="line"></span><br><span class="line">7ã€æŸ¥çœ‹podèµ„æºçš„å ç”¨æƒ…å†µ  </span><br><span class="line">[root@master01 kubernetes]# kubectl top pod</span><br><span class="line">NAME                            CPU(cores)   MEMORY(bytes)   </span><br><span class="line">c7-nginx                        0m           1Mi             </span><br><span class="line">nginx-deploy-545f948568-4tgvd   0m           2Mi             </span><br><span class="line">nginx-deploy-545f948568-7jnbf   0m           2Mi             </span><br><span class="line">nginx-deploy-545f948568-v5v82   0m           2Mi             </span><br><span class="line">nginx-ds-7gpkh                  0m           1Mi             </span><br><span class="line">nginx-ds-9r2hz                  0m           1Mi             </span><br><span class="line">nginx-ds-vmjsj                  0m           2Mi </span><br><span class="line"></span><br><span class="line">HPAå°±æ˜¯æ‰nodeçš„æ¥å£è·å–èµ„æºä¿¡æ¯</span><br></pre></td></tr></table></figure><p>2ã€ç”Ÿæˆæµ‹è¯•é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ¯ä¸ªnodeç¼–å†™phpä»£ç ï¼Œåˆ›å»ºæµ‹è¯•é¦–é¡µ</span><br><span class="line"><span class="built_in">cat</span> &gt; index.php &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&lt;?php</span><br><span class="line">  <span class="variable">$x</span> = 0.0001;</span><br><span class="line">  <span class="keyword">for</span> (<span class="variable">$i</span> = 0; <span class="variable">$i</span> &lt;= 1000000; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="variable">$x</span> += sqrt(<span class="variable">$x</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;OK!&quot;</span>;</span><br><span class="line">?&gt;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">ä¸€èˆ¬åšè®¡ç®—æ˜¯cpuè®¡ç®—ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨å‹ä½ çš„cpuï¼Œè®¡ç®—100äº¿æ¬¡</span><br><span class="line"></span><br><span class="line">2ã€æ¯ä¸ªnodeåˆ›å»ºDockerfile</span><br><span class="line"><span class="built_in">cat</span> &gt; dockerfile &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">FROM php:5-apache</span><br><span class="line">ADD index.php /var/www/html/index.php</span><br><span class="line">RUN <span class="built_in">chmod</span> a+rx index.php</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€æ¯ä¸ªnodeæ„å»ºé•œåƒ</span><br><span class="line">docker build -t php:v1 .</span><br></pre></td></tr></table></figure><p>3ã€ç¼–å†™èµ„æºæ¸…å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•    kubectl run php-apache --image=php:v1 --requests=cpu=200m --expose --port=80</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# vim php-dp.yml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: php-apache</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      run: php-apache</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        run: php-apache</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: php:v1</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: php-apache</span><br><span class="line"><span class="comment">#ç°åœ¨CPUæœ€å¤šä½¿ç”¨200æ¯«æ ¸ 0.2æ ¸</span></span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: 200m</span><br><span class="line">  </span><br><span class="line">2ã€è¿è¡Œï¼Œå¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f php-dp.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE     IP          NODE</span><br><span class="line">php-apache-869dfddb74-qgffj     1/1     Running   0          53s     10.2.3.90   node03</span><br><span class="line">[root@master01 kubernetes]# curl 10.2.3.90 </span><br><span class="line">OK!</span><br><span class="line"></span><br><span class="line">3ã€ç›®å‰è¿˜æ²¡æœ‰éƒ¨ç½²HPA,</span><br><span class="line">[root@master01 kubernetes]# kubectl get hpa</span><br><span class="line">No resources found <span class="keyword">in</span> default namespace.</span><br><span class="line"></span><br><span class="line">4ã€åˆšåˆšéƒ¨ç½²äº†Metics Serverï¼Œhpaæ‰æ˜¯æ‰©å®¹çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ç°åœ¨ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">ç¼–å†™HPAç›‘æ§èµ„æºæ‰©å®¹phpçš„Deployment</span><br><span class="line">kubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# vim php-hpa.yml</span><br><span class="line">apiVersion: <span class="string">&quot;autoscaling/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;HorizontalPodAutoscaler&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: php-apache</span><br><span class="line">  namespace: default</span><br><span class="line">spec: </span><br><span class="line">  <span class="comment">#è‡ªåŠ¨æ‰©å®¹æœ€å¤§æ‰©åˆ°å¤šå°‘</span></span><br><span class="line">  maxReplicas: 8</span><br><span class="line">  <span class="comment">#è‡ªåŠ¨æ‰©å®¹æœ€å¤§æ‰©åˆ°å¤šå°‘</span></span><br><span class="line">  minReplicas: 1</span><br><span class="line">  scaleTargetRef:</span><br><span class="line">    apiVersion: apps/v1</span><br><span class="line">    kind: Deployment</span><br><span class="line">    name: php-apache</span><br><span class="line">  targetCPUUtilizationPercentage: 50</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">5ã€å¯åŠ¨hpaèµ„æº</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f php-hpa.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get hpa</span><br><span class="line">NAME         REFERENCE               TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">php-apache   Deployment/php-apache   0%/50%    1         8         1          16s</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½ æƒ³è®©å“ªä¸ªDeploymentæ§åˆ¶å™¨è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œå°±è¦è°çš„HPAèµ„æºæ¸…å•ï¼Œwordpressè‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œå°±è¦å†™wordpressçš„HPAèµ„æºç›‘æ§wordpress</span></span><br><span class="line"></span><br><span class="line">apiVersion: <span class="string">&quot;autoscaling/v1&quot;</span>           <span class="comment">#HPAæ¥å£</span></span><br><span class="line">kind: <span class="string">&quot;HorizontalPodAutoscaler&quot;</span>        <span class="comment">#HPAèµ„æºç±»å‹</span></span><br><span class="line">metadata:                              <span class="comment">#HPAå…ƒæ•°æ®</span></span><br><span class="line">  name: php-apache                     <span class="comment">#HPAèµ„æºå</span></span><br><span class="line">  namespace: default                   <span class="comment">#åç§°ç©ºé—´</span></span><br><span class="line">spec:                                  <span class="comment">#HPAæ§åˆ¶ä¿¡æ¯</span></span><br><span class="line">  maxReplicas: 8                       <span class="comment">#æœ€å¤šæ‰©å®¹8ä¸ªå‰¯æœ¬         </span></span><br><span class="line">  minReplicas: 1                       <span class="comment">#æœ€å°‘æ‰©å®¹1ä¸ªå‰¯æœ¬</span></span><br><span class="line">  scaleTargetRef:                      <span class="comment">#HPAå…³è”æ§åˆ¶å™¨</span></span><br><span class="line">    apiVersion: apps/v1                <span class="comment">#æ§åˆ¶å™¨çš„æ¥å£</span></span><br><span class="line">    kind: Deployment                   <span class="comment">#æ§åˆ¶å™¨ç±»å‹</span></span><br><span class="line">    name: php-apache                   <span class="comment">#æ§åˆ¶å™¨åå­—</span></span><br><span class="line">  targetCPUUtilizationPercentage: 50   <span class="comment">#CPUä½¿ç”¨ç‡è¾¾åˆ°50%åˆ™æ‰©å®¹</span></span><br></pre></td></tr></table></figure><p>4ã€å‹æµ‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹éœ€è¦å‹æµ‹çš„podçš„ip</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE     IP          NODE</span><br><span class="line">php-apache-869dfddb74-qgffj     1/1     Running   0          28m     10.2.3.90   node03</span><br><span class="line"></span><br><span class="line">2ã€å†™å¾ªç¯è„šæœ¬å‹æµ‹</span><br><span class="line">æ‰“å¼€2ä¸ªçª—å£ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå‹æµ‹æ•ˆæœå°±æ¯”è¾ƒæ˜æ˜¾</span><br><span class="line">[root@master01 kubernetes]# <span class="keyword">while</span> <span class="literal">true</span> ;<span class="keyword">do</span> curl 10.2.3.90;<span class="built_in">sleep</span> 0.2;<span class="keyword">done</span></span><br><span class="line">OK!OK!OK!OK!OK!OK!OK!OK!OK</span><br><span class="line"></span><br><span class="line">3ã€å†å¼€ä¸€ä¸ªmasterçª—å£ï¼ŒæŸ¥çœ‹cupçš„ä½¿ç”¨ç‡ï¼Œéœ€è¦ç­‰å¾…ä¸€ä¸‹ä¸‹ï¼Œæ‰å¯ä»¥çœ‹åˆ°cpuå˜åŒ–</span><br><span class="line">[root@master01 ~]# kubectl get hpa -w</span><br><span class="line">NAME         REFERENCE               TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">php-apache   Deployment/php-apache   0%/50%    1         8         1          6m37s</span><br><span class="line">php-apache   Deployment/php-apache   386%/50%   1         8         1          8m38s</span><br><span class="line">php-apache   Deployment/php-apache   386%/50%   1         8         4          8m53s</span><br><span class="line">php-apache   Deployment/php-apache   386%/50%   1         8         8          9m9s</span><br><span class="line">php-apache   Deployment/php-apache   103%/50%   1         8         8          9m39s</span><br><span class="line"></span><br><span class="line">4ã€å†å¼€ä¸€ä¸ªçª—å£ï¼ŒæŸ¥çœ‹podçš„å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œcpuä½¿ç”¨ç‡å¢åŠ ï¼Œpodçš„å‰¯æœ¬å¢åŠ ï¼Œæ­¤æ—¶å·²ç»å¢åŠ åˆ°8ä¸ªäº†</span><br><span class="line">[root@master01 ~]# kubectl get pod</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">php-apache-869dfddb74-2x25m     1/1     Running   0          64s</span><br><span class="line">php-apache-869dfddb74-884jw     1/1     Running   0          79s</span><br><span class="line">php-apache-869dfddb74-m6vb7     1/1     Running   0          64s</span><br><span class="line">php-apache-869dfddb74-mck7s     1/1     Running   0          64s</span><br><span class="line">php-apache-869dfddb74-mg9pf     1/1     Running   0          79s</span><br><span class="line">php-apache-869dfddb74-qgffj     1/1     Running   0          35m</span><br><span class="line">php-apache-869dfddb74-t49wf     1/1     Running   0          64s</span><br><span class="line">php-apache-869dfddb74-xdtv6     1/1     Running   0          79s</span><br><span class="line"></span><br><span class="line">5ã€åœæ­¢å‹æµ‹å‘½ä»¤ï¼Œç¨ç­‰ä¸€ä¼šï¼ŒæŸ¥çœ‹podçš„å‰¯æœ¬æ•°é‡ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œcpuä½¿ç”¨ç‡å‡å°‘ï¼Œpodæ•°é‡å‡å°‘ï¼Œå˜æˆ1ä¸ªpod</span><br><span class="line">[root@master01 ~]# kubectl get pod</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">php-apache-869dfddb74-884jw     1/1     Running   0          8m54s</span><br><span class="line"></span><br><span class="line">å‹åŠ›å‡å°æ²¡æœ‰ç«‹é©¬ç¼©å®¹ï¼Œå°±åƒæå¤§æ´»åŠ¨618ï¼Œç”¨æˆ·é‡æœ‰ä¸€éƒ¨åˆ†ä¹°å®Œäº§å“äº†ï¼Œå¦‚æœçªç„¶åˆä¸Šäº†äº§å“å°±ä¸ä¼šç¼©å®¹ã€‚è¿™ä¸ªè®¾è®¡å¾ˆåˆç†çš„ï¼Œä»–ä¼šè§‰å¾—æ²¡æœ‰ä»€ä¹ˆå¤§æµé‡ï¼Œå°±ä¼šç¼©å®¹</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰8ã€Serviceèµ„æº</title>
      <link href="/posts/b92e2a5d.html"/>
      <url>/posts/b92e2a5d.html</url>
      
        <content type="html"><![CDATA[<h2 id="Serviceèµ„æº">Serviceèµ„æº</h2><p>æ²¡æœ‰serviceèµ„æºï¼Œæƒ³è¦è®¿é—®æœåŠ¡ï¼Œéœ€è¦åœ¨é˜²ç«å¢™åšç«¯å£è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">1ã€èµ·ä¸€ä¸ªpodèµ„æº</span><br><span class="line">[root@master01 kubernetes]# vim nginx.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-test</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container-v2</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="comment">#ç«¯å£æ˜ å°„</span></span><br><span class="line">    ports:</span><br><span class="line">    - name: http-port</span><br><span class="line">    <span class="comment">#å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„8081ç«¯å£</span></span><br><span class="line">      containerPort: 80</span><br><span class="line">      hostPort: 8081</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œ</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide</span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE     IP          NODE  </span><br><span class="line">nginx-test                    1/1     Running   0          46s     10.2.3.96   node03</span><br><span class="line"></span><br><span class="line">3ã€podèµ·æ¥äº†ï¼Œå¹¶ä¸”è¿è¡Œåœ¨node03èŠ‚ç‚¹ä¸Šï¼ŒæŸ¥çœ‹node03çš„ç«¯å£ï¼Œçœ‹ä¸åˆ°8081ç«¯å£ï¼Œå¯ä»¥æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼Œèƒ½å¤Ÿè®¿é—®åˆ°nginxä¸»é¡µé¢</span><br><span class="line">10.0.0.203:8081</span><br><span class="line"></span><br><span class="line">4ã€å› ä¸ºé˜²ç«å¢™åœ¨åº•å±‚åšäº†ç«¯å£è½¬å‘ï¼Œæ˜¯çœ‹ä¸åˆ°çš„ï¼Œåªè¦è®¿é—®åˆ°node03çš„8081ç«¯å£ï¼Œä¼šè‡ªåŠ¨è½¬å‘è½¬å‘åˆ°å®¹å™¨é‡Œçš„80ç«¯å£</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœå¦‚ä¸Šç«¯å£è½¬å‘ä¸€èˆ¬ä¸ä½¿ç”¨ï¼Œæ˜ å°„çš„ç«¯å£çœ‹ä¸åˆ°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä½¿ç”¨æ§åˆ¶å™¨å¯åŠ¨PODæ—¶ï¼Œæ— æ³•å¤šä¸ªPODç»‘å®šåŒä¸€ä¸ªç«¯å£ï¼Œè€Œä¸”æ¯æ¬¡podèµ·æ¥ï¼Œipä¼šå‘ç”Ÿå˜åŒ–</span></span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> nginx-dp.yaml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  replicas: 10</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      run: nginx-dp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        run: nginx-dp</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx-container</span><br><span class="line">        image: nginx:alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - name: http-port</span><br><span class="line">          containerPort: 80</span><br><span class="line">          hostPort: 8081</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŠ¥é”™ç«¯å£è¢«å ç”¨</span></span><br><span class="line">[root@master01 kubernetes]# kubectl describe pod nginx-dp-69c9d4dbc5-9xp64</span><br><span class="line">Warning FailedScheduling 44s default-scheduler 0/4 nodes are available: 1 node(s) had taint &#123;node-role.kubernetes.io/master: &#125;, that the pod didn<span class="string">&#x27;t tolerate, 3 node(s) didn&#x27;</span>t have free ports <span class="keyword">for</span> the requested pod ports.</span><br><span class="line">Warning FailedScheduling 44s default-scheduler 0/4 nodes are available: 1 node(s) had taint &#123;node-role.kubernetes.io/master: &#125;, that the pod didn<span class="string">&#x27;t tolerate, 3 node(s) didn&#x27;</span>t have free ports <span class="keyword">for</span> the requested pod ports.</span><br></pre></td></tr></table></figure><h3 id="1ã€Serviceèµ„æºä»‹ç»"><strong>1ã€Serviceèµ„æºä»‹ç»</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   é€šè¿‡å‰é¢çš„å®éªŒæˆ‘ä»¬å·²ç»æŒæ¡äº†ä½¿ç”¨Podæ§åˆ¶å™¨æ¥ç®¡ç†Podï¼Œæˆ‘ä»¬ä¹Ÿä¼šå‘ç°ï¼ŒPodçš„ç”Ÿå‘½å‘¨æœŸéå¸¸çŸ­æš‚ï¼Œæ¯æ¬¡é•œåƒå‡çº§éƒ½ä¼šé”€æ¯ä»¥åŠåˆ›å»ºï¼Œè€Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ªPodéƒ½æ‹¥æœ‰è‡ªå·±çš„IPåœ°å€ï¼Œå¹¶ä¸”éšç€Podåˆ é™¤å’Œåˆ›å»ºï¼Œè¿™ä¸ªIPæ˜¯ä¼šå˜åŒ–çš„ã€‚</span><br><span class="line">å½“æˆ‘ä»¬çš„Podæ•°é‡éå¸¸å¤šçš„æ—¶å€™å‰ç«¯çš„å…¥å£æœåŠ¡è¯¥æ€ä¹ˆçŸ¥é“åé¢éƒ½æœ‰å“ªäº›Podå‘¢ï¼Ÿ</span><br><span class="line">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜k8sæä¾›äº†ä¸€ä¸ªå¯¹è±¡Serviceå’Œä¸‰ç§IPï¼Œåˆ›å»ºçš„Serviceèµ„æºé€šè¿‡æ ‡ç­¾å¯ä»¥åŠ¨æ€çš„çŸ¥é“åç«¯çš„Podçš„IPåœ°å€ï¼Œåœ¨PodIPä¹‹ä¸Šè®¾è®¡ä¸€ä¸ªå›ºå®šçš„IPï¼Œä¹Ÿå°±æ˜¯ClusterIPï¼Œç„¶åä½¿ç”¨NodePortæ¥å¯¹å¤–æš´éœ²ç«¯å£æä¾›è®¿é—®ã€‚</span><br><span class="line">æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆè®¤è¯†ä¸€ä¸‹K8sé‡Œçš„ä¸‰ç§IPåŠå…¶ä½œç”¨ã€‚</span><br></pre></td></tr></table></figure><p><strong>K8sä½¿ç”¨çš„ä¸‰ç§IP</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1ã€nodes IPï¼šå®¿ä¸»æœºçš„IP</span><br><span class="line">2ã€Pod IPï¼šå®¹å™¨çš„IPåœ°å€</span><br><span class="line">3ã€Cluster IPï¼šå®¹å™¨çš„è´Ÿè½½å‡è¡¡IP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Serviceèµ„æºæ¶‰åŠåˆ°çš„IPå’Œç½‘ç»œ</span></span><br><span class="line">ClusterIPï¼šIPåœ°å€</span><br><span class="line">NodePortï¼šç«¯å£</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240924175240230.png" alt="image-20240924175240230"></p><h3 id="2ã€ClusterIPçš„èµ„æº"><strong>2ã€ClusterIPçš„èµ„æº</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœè¦èµ·ä¸€ä¸ªserviceèµ„æºï¼Œå°±å¿…é¡»å…ˆèµ·ä¸€ä¸ªPod,å†ç»™PODæ‰“ä¸ŠCluster IP</span></span><br><span class="line"></span><br><span class="line">1ã€éœ€è¦å…ˆèµ·ä¸€ä¸ªDeploymentæ§åˆ¶å™¨èµ„æº</span><br><span class="line">[root@master01 service]# vim nginx-dp.yaml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      run: nginx-deploy</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        run: nginx-deploy</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx-container</span><br><span class="line">        image: nginx:alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line"></span><br><span class="line">[root@master01 service]# kubectl apply -f nginx-dp.yaml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deploy-545f948568-66bjf   1/1     Running   0          5s</span><br><span class="line">nginx-deploy-545f948568-f5mhc   1/1     Running   0          5s</span><br><span class="line">nginx-deploy-545f948568-vmkpz   1/1     Running   0          5s</span><br><span class="line"><span class="comment">#ç°åœ¨è®¿é—®ï¼Œå°±ç›¸å½“äºè®¿é—®web01ã€web02ã€web03ï¼Œä½†æ˜¯å‰é¢æ²¡æœ‰åŠ lb01,æ¥ä¸‹æ¥å°±å†™Clusterèµ„æºæ¸…å•ï¼Œå°±ç›¸å½“äºlb01</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€å†™Clusterèµ„æºæ¸…å•,è¿™ä¸ªèµ„æºæ¸…å•è¦ç»™ä¸Šé¢çš„3ä¸ªpodæ‰“ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„Cluster IP</span><br><span class="line">[root@master01 service]# vim nginx-svc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-svc</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#ä½ çš„serviceèµ·çš„cluster IPè¦ç»™å“ªä¸ªpodç»‘å®šï¼Œå°±ç›¸å½“äºæ ‡ç­¾é€‰æ‹©å™¨ï¼Œè¿™é‡Œçš„æ ‡ç­¾è¦å’Œpodçš„æ ‡ç­¾ä¸€æ ·</span></span><br><span class="line">  selector:</span><br><span class="line">    run: nginx-deploy</span><br><span class="line">  ports:</span><br><span class="line">  - name: http-nginx</span><br><span class="line">  <span class="comment">#å®¿ä¸»æœºé‡Œæ˜ å°„çš„ç«¯å£</span></span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    <span class="comment">#å®¹å™¨çš„çš„ç«¯å£</span></span><br><span class="line">    targetPort: 80</span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 service]# kubectl apply -f nginx-svc.yaml</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹svcè¯¦ç»†ä¿¡æ¯</span><br><span class="line">[root@master01 kubernetes]# kubectl get svc</span><br><span class="line">NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes   ClusterIP   10.1.0.1       &lt;none&gt;        443/TCP   11d  <span class="comment">#è¿™ä¸ªæ˜¯k8såˆ›å»ºçš„svc</span></span><br><span class="line">nginx-svc    ClusterIP   10.1.168.150   &lt;none&gt;        80/TCP    8h</span><br><span class="line">[root@master01 kubernetes]# curl 10.1.168.150</span><br><span class="line">curl ä¸€ä¸‹ï¼Œå¦‚æœé€šäº†ï¼Œè¿™ä¸ªè´Ÿè½½å‡è¡¡å°±åšå¥½äº†</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œå¦‚æœcurlä¸é€šï¼Œä¸è¦ç€æ€¥ï¼Œå…ˆcurlä¸€ä¸‹POdçš„ipæ˜¯å¦èƒ½é€šï¼Œé€šè¿‡å¯ä»¥é€šï¼Œé‚£å°±æ˜¯svcçš„è¯·æ±‚æ— æ³•åˆ°è¾¾pod,å¯èƒ½æ˜¯iptablesé˜²ç«å¢™é˜»æ­¢äº†ï¼Œå¯ä»¥åœ¨å‰é¢åŠ ingressï¼Œå¦‚æœåœ¨æµè§ˆå™¨é‡Œé¢å¯ä»¥è®¿é—®ï¼Œé‚£ä¹ˆingressèƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ï¼Œå°±æ²¡é—®é¢˜</span></span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl describe svc nginx-svc</span><br><span class="line">Name:              nginx-svc</span><br><span class="line">Namespace:         default</span><br><span class="line">Labels:            &lt;none&gt;</span><br><span class="line">Annotations:       &lt;none&gt;</span><br><span class="line">Selector:          run=nginx-deploy</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.1.168.150     <span class="comment">#seriviceèµ„æºçš„ip</span></span><br><span class="line">Port:              http-nginx  80/TCP</span><br><span class="line">TargetPort:        80/TCP</span><br><span class="line">Endpoints:         10.2.1.52:80,10.2.2.46:80,10.2.3.111:80</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240925231650457.png" alt="image-20240925231650457"></p><p>åŒä¸€ä¸ªåç§°ç©ºé—´é€šä¿¡çš„æ–¹æ³•ï¼šé€šè¿‡ping serverèµ„æºå è¿›è¡Œé€šä¿¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">4ã€éšä¾¿èµ·ä¸€ä¸ªæœ‰pingå‘½ä»¤çš„podï¼Œå¹¶è¿›å…¥pod</span><br><span class="line">[root@master01 kubernetes]# vim c7.yml </span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: c7-nginx</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f c7.yml </span><br><span class="line"></span><br><span class="line">5ã€è¿æ¥è¿›å…¥å®¹å™¨,ping seriviceèµ„æºçš„ipå’Œseriviceèµ„æºçš„åå­—</span><br><span class="line">[root@master01 service]# kubectl <span class="built_in">exec</span> -it c7-nginx -c c7-container -- /bin/bash</span><br><span class="line">[root@c7-nginx /]# ping  10.1.189.201</span><br><span class="line">[root@c7-nginx /]# ping  nginx-svc</span><br><span class="line">å¯ä»¥ping</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240924195940632.png" alt="image-20240924195940632"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 prometheus]# kubectl get pod -n kube-system</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6d56c8448f-85k2r           1/1     Running   2          13d</span><br><span class="line">coredns-6d56c8448f-h697m           1/1     Running   2          8d</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµç¨‹æ¢³ç†ï¼š</span></span><br><span class="line">1ã€å› ä¸ºæˆ‘ä»¬æœ‰2ä¸ªcorednsæœåŠ¡å™¨ï¼Œä»–ä¼šå¸®æˆ‘ä»¬åšä¸€ä¸ªåŸŸåè§£æ</span><br><span class="line">2ã€å•¥æ—¶å€™åšåŸŸåè§£æå‘¢ï¼Ÿ</span><br><span class="line">å½“ä½ applyèµ·ä¸€ä¸ªsvcæ—¶ï¼Œå½“svcèµ·æ¥äº†åï¼Œä»–ä¼šæŠŠ10.1.189.201  nginx-svc(seriviceèµ„æºçš„ipå’Œseriviceèµ„æºçš„åå­—)ç»‘å®šåˆ°é‚£2ä¸ªdnsæœåŠ¡å™¨é‡Œé¢ï¼Œåšä¸€ä¸ªåŸŸåè§£æ</span><br><span class="line"></span><br><span class="line">èµ·äº†ä¸€ä¸ªpodï¼Œpodé‡Œé¢æœ‰dnsçš„é…ç½®ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªip,æ˜¯serviceçš„ip,è¿™ä¸ªèµ·åœ¨kube-systemåç§°ç©ºé—´é‡Œé¢çš„</span><br><span class="line"></span><br><span class="line">[root@master01 prometheus]# kubectl get svc -n kube-system</span><br><span class="line">NAME             TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                  AGE</span><br><span class="line">kube-dns         ClusterIP   10.1.0.10     &lt;none&gt;        53/UDP,53/TCP,9153/TCP   13d</span><br><span class="line">metrics-server   ClusterIP   10.1.11.158   &lt;none&gt;        443/TCP                  2d13h</span><br><span class="line">[root@master01 kubernetes]# kubectl describe svc -n kube-system kube-dns</span><br><span class="line">Name:              kube-dns</span><br><span class="line">Namespace:         kube-system</span><br><span class="line">Labels:            k8s-app=kube-dns</span><br><span class="line">                   kubernetes.io/cluster-service=<span class="literal">true</span></span><br><span class="line">                   kubernetes.io/name=KubeDNS</span><br><span class="line">Annotations:       prometheus.io/port: 9153</span><br><span class="line">                   prometheus.io/scrape: <span class="literal">true</span></span><br><span class="line">Selector:          k8s-app=kube-dns</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.1.0.10</span><br><span class="line">Port:              dns  53/UDP</span><br><span class="line">TargetPort:        53/UDP</span><br><span class="line">Endpoints:         10.2.1.5:53,10.2.2.7:53</span><br><span class="line">Port:              dns-tcp  53/TCP</span><br><span class="line">TargetPort:        53/TCP</span><br><span class="line">Endpoints:         10.2.1.5:53,10.2.2.7:53</span><br><span class="line">Port:              metrics  9153/TCP</span><br><span class="line">TargetPort:        9153/TCP</span><br><span class="line">Endpoints:         10.2.1.5:9153,10.2.2.7:9153</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926232750951.png" alt="image-20240926232750951"></p><p><img src="../image/study_img/image-20240926233119633.png" alt="image-20240926233119633"></p><p>ä¸åç§°ç©ºé—´é€šä¿¡çš„æ–¹æ³•ï¼šping serviceçš„åå­—.serviceçš„åç§°ç©ºé—´.svc.cluster.local</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1ã€éšä¾¿èµ·ä¸€ä¸ªæœ‰pingå‘½ä»¤çš„podï¼Œå¹¶è¿›å…¥pod</span><br><span class="line">[root@master01 kubernetes]# vim c7.yml </span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: c7-test</span><br><span class="line">  <span class="comment">#è¿™é‡ŒæŒ‡å®šä¸€ä¸ªåç§°ç©ºé—´</span></span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f c7.yml </span><br><span class="line"></span><br><span class="line">5ã€è¿æ¥è¿›å…¥å®¹å™¨,ping seriviceèµ„æºçš„ipå’Œseriviceèµ„æºçš„åå­—</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it c7-test -n  kube-system -- /bin/bash</span><br><span class="line">[root@c7-test /]# ping nginx-svc</span><br><span class="line">ping: nginx-svc: Name or service not known</span><br><span class="line"><span class="comment">#pingèµ„æºåï¼Œæ— æ³•é€šï¼Œè¯´æ˜ä¸åœ¨åŒä¸€ä¸ªåç§°ç©ºé—´æ˜¯åšç½‘ç»œéš”ç¦»çš„ï¼Œä¸åœ¨åŒä¸€ä¸ªpodä¸èƒ½ç”¨serviceé€šä¿¡</span></span><br><span class="line"></span><br><span class="line">[root@c7-nginx /]# ping  10.1.189.201</span><br><span class="line">ipå¯ä»¥é€šï¼Œä½†æ˜¯ipé€šæ²¡å•¥ç”¨ï¼Œipä¼šå‘ç”Ÿå˜åŒ–</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæœ‰æ—¶å€™ï¼Œå°±æ˜¯æƒ³è¦ä¸åŒåç§°ç©ºé—´çš„é€šä¿¡ï¼Œå°±åƒé˜¿é‡Œäº‘ä¹°æœºå™¨ï¼ŒæŠŠç½‘ç»œæ‰“é€šå†…ç½‘çš„éœ€æ±‚ï¼Œæ‰“é€šå†…å¤–è¿™ç§äº‹ï¼Œk8sä¹Ÿèƒ½åš</span></span><br><span class="line">ping serviceçš„åå­—.serviceçš„åç§°ç©ºé—´.svc.cluster.local</span><br><span class="line"> </span><br><span class="line">[root@c7-test /]# ping nginx-svc.default.svc.cluster.local</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åŸç†ï¼š</span></span><br><span class="line">1ã€é¦–å…ˆèµ·äº†ä¸€ä¸ªc7-testçš„podï¼Œé‡Œé¢æœ‰dnsæœåŠ¡å™¨çš„é…ç½®</span><br><span class="line">[root@c7-test /]# <span class="built_in">cat</span> /etc/resolv.conf</span><br><span class="line">nameserver 10.1.0.10</span><br><span class="line">search kube-system.svc.cluster.local svc.cluster.local cluster.local</span><br><span class="line">options ndots:5</span><br><span class="line"></span><br><span class="line">2ã€10.1.0.10è¿™ä¸ªipæ˜¯ä¸€ä¸ªsvcçš„ip,ä¸è¿‡è¿™ä¸ªsvcèµ·åœ¨kube-systemè¿™ä¸ªåç§°ç©ºé—´é‡Œ</span><br><span class="line">[root@master01 prometheus]# kubectl get svc -n kube-system</span><br><span class="line">NAME             TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                  AGE</span><br><span class="line">kube-dns         ClusterIP   10.1.0.10     &lt;none&gt;        53/UDP,53/TCP,9153/TCP   13d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl describe svc -n kube-system kube-dns</span><br><span class="line">Name:              kube-dns</span><br><span class="line">Namespace:         kube-system</span><br><span class="line">Labels:            k8s-app=kube-dns</span><br><span class="line">                   kubernetes.io/cluster-service=<span class="literal">true</span></span><br><span class="line">                   kubernetes.io/name=KubeDNS</span><br><span class="line">Annotations:       prometheus.io/port: 9153</span><br><span class="line">                   prometheus.io/scrape: <span class="literal">true</span></span><br><span class="line">Selector:          k8s-app=kube-dns</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.1.0.10</span><br><span class="line">Port:              dns  53/UDP</span><br><span class="line">TargetPort:        53/UDP</span><br><span class="line">Endpoints:         10.2.1.5:53,10.2.2.7:53</span><br><span class="line">Port:              dns-tcp  53/TCP</span><br><span class="line">TargetPort:        53/TCP</span><br><span class="line">Endpoints:         10.2.1.5:53,10.2.2.7:53</span><br><span class="line">Port:              metrics  9153/TCP</span><br><span class="line">TargetPort:        9153/TCP</span><br><span class="line">Endpoints:         10.2.1.5:9153,10.2.2.7:9153</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ä»¥åpodä¸podçš„é€šä¿¡æµç¨‹å›¾</p><p><img src="../image/study_img/image-20240927194820715.png" alt="image-20240927194820715"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä½†æ˜¯ç°åœ¨å…‰ç”¨Cluster ipæ˜¯æ²¡å•¥ç”¨çš„ï¼Œä¼šå‘ç°Cluster ipçš„ipåœ¨æµè§ˆå™¨æ— æ³•è®¿é—®ï¼Œå› ä¸ºä»–æ˜¯ä¸€ä¸ªå†…ç½‘ip,æƒ³è¦è¿™ä¸ªipèƒ½å¤Ÿè®¿é—®ï¼Œè¿˜éœ€è¦åœ¨å®¿ä¸»æœºä¸Šåšä¸€ä¸ªNodePort ç«¯å£æ˜ å°„ï¼Œæ˜ å°„åˆ°clusterip</span><br></pre></td></tr></table></figure><h3 id="3ã€NodePortèµ„æº-åšç«¯å£æ˜ å°„"><strong>3ã€NodePortèµ„æº    åšç«¯å£æ˜ å°„</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœè¦èµ·ä¸€ä¸ªserviceèµ„æºï¼Œå°±å¿…é¡»å…ˆèµ·ä¸€ä¸ªPod,å†ç»™PODæ‰“ä¸ŠNodePort</span></span><br><span class="line"></span><br><span class="line">1ã€éœ€è¦å…ˆèµ·ä¸€ä¸ªDeploymentæ§åˆ¶å™¨èµ„æº</span><br><span class="line">[root@master01 service]# vim nginx-dp.yaml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      run: nginx-deploy</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        run: nginx-deploy</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx-container</span><br><span class="line">        image: nginx:alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-dp.yml</span><br><span class="line"></span><br><span class="line">2ã€ç¼–å†™nodeportèµ„æºæ¸…å•   å†™å‘å’Œclusteripä¸€æ ·ï¼Œå°±æŠŠåé¢çš„<span class="built_in">type</span>æ¢ä¸€ä¸‹</span><br><span class="line">[root@master01 service]# vim nginx-svc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-svc</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    run: nginx-deploy</span><br><span class="line">  ports:</span><br><span class="line">  - name: http-nginx</span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">    <span class="comment">#æ˜ å°„åˆ°å®¿ä¸»æœº30000çš„ç«¯å£</span></span><br><span class="line">    nodePort: 30000</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  </span><br><span class="line">3ã€åˆ é™¤ä¸Šä¸€ä¸ªå®éªŒçš„nginx-svcèµ„æºï¼Œè¿è¡Œæœ¬æ¬¡ç¼–å†™çš„èµ„æºæ¸…å•  </span><br><span class="line">[root@master01 service]# kubectl delete service nginx-svc</span><br><span class="line">service <span class="string">&quot;nginx-svc&quot;</span> deleted</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 service]# kubectl apply -f nginx-svc.yml </span><br><span class="line">[root@master01 service]# kubectl get svc</span><br><span class="line">NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes   ClusterIP   10.1.0.1      &lt;none&gt;        443/TCP        11d</span><br><span class="line">nginx-svc    NodePort    10.1.171.27   &lt;none&gt;        80:30000/TCP   63s</span><br><span class="line"><span class="comment">#æŠŠcluster ipçš„80ç«¯å£ï¼Œæ˜ å°„åˆ°å®¿ä¸»æœºçš„30000</span></span><br><span class="line">ä»–èµ·NodePortä¹Ÿå¸®ä½ èµ·ä¸€ä¸ªcluster ip,ä¹Ÿå°±æ˜¯è¯´NodePortä¹ŸåŒ…å«cluster ip,æ‰€ä»¥ä»¥åèµ·çš„æ—¶å€™å°±ä¸éœ€è¦å•ç‹¬èµ·cluster ipçš„èµ„æºäº†</span><br><span class="line"></span><br><span class="line">3ã€è¿æ¥è¿›å…¥å®¹å™¨,ping seriviceèµ„æºçš„åå­—,å¯ä»¥pingé€š</span><br><span class="line">[root@master01 service]# kubectl <span class="built_in">exec</span> -it c7-nginx -c c7-container -- /bin/bash</span><br><span class="line">[root@c7-nginx /]# ping  nginx-svc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†æ‹¥æœ‰åŒä¸€ä¸ªæ ‡ç­¾çš„podåˆ†ä¸ºä¸€ç»„ å¯¹å¤–æ˜ å°„ç«¯å£ï¼ˆ30000-65535ï¼‰ è¿›è¡Œè´Ÿè½½ </span></span><br><span class="line">å®¿ä¸»æœº 30000 --- &gt; serIP:80 -----&gt; podip:80</span><br><span class="line"></span><br><span class="line"><span class="comment">## NodePortç«¯å£èŒƒå›´ï¼š30000-32767</span></span><br><span class="line">The Service <span class="string">&quot;nginx-svc&quot;</span> is invalid: spec.ports[0].nodePort: Invalid value: 80:provided port is not <span class="keyword">in</span> the valid range. The range of valid ports is 30000-32767</span><br><span class="line"></span><br><span class="line">ç°åœ¨ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼Œå¯ä»¥è®¿é—®åˆ°nginxä¸»é¡µé¢</span><br><span class="line">10.0.0.200:30000</span><br><span class="line">10.0.0.201:30000</span><br><span class="line">10.0.0.202:30000</span><br><span class="line">10.0.0.203:30000</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸ªå’Œk8sçš„ç»„ä»¶kube-proxyæœ‰å…³ï¼Œåªè¦æœ‰kube-proxyçš„æœºå™¨éƒ½ä¼šåšç«¯å£æ˜ å°„å‡ºæ¥ï¼Œåº•å±‚åšä¸€ä¸ªè½¬å‘ï¼Œkube-proxyåœ¨å¯åŠ¨çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯DaemonSetï¼Œæ¯ä¸ªæœºå™¨éƒ½ä¼šèµ·</span></span><br><span class="line">kube-proxyæä¾›çš„30000ç«¯å£</span><br><span class="line">[root@master01 kubernetes]# netstat -lntup|grep 30000</span><br><span class="line">tcp        0      0 0.0.0.0:30000           0.0.0.0:*               LISTEN      96411/kube-proxy </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼š</span></span><br><span class="line">ç«¯å£èŒƒå›´æ˜¯30000~32767ï¼Œä¸å¤ªå¥½ç”¨ï¼Œæ‰€ä»¥ä»¥åä¸è¡ŒNodePortï¼Œå†™cluster ipå°±å¯ä»¥ï¼Œä¸è¦NodePortï¼Œå°±å¯ä»¥ä¸ç”¨kube-proxyï¼Œæˆ‘ä»¬ä¼šç”¨ingresså–ä»£</span><br></pre></td></tr></table></figure><h3 id="4ã€Ingressèµ„æºä»‹ç»"><strong>4ã€Ingressèµ„æºä»‹ç»</strong></h3><p>NodePortçš„ç¼ºç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.æ²¡æœ‰ingressä¹‹å‰ï¼Œpodå¯¹å¤–æä¾›æœåŠ¡åªèƒ½é€šè¿‡NodeIP:NodePortçš„å½¢å¼ï¼Œä½†æ˜¯è¿™ç§å½¢å¼æœ‰ç¼ºç‚¹ï¼Œä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„Portä¸èƒ½é‡å¤åˆ©ç”¨ã€‚æ¯”å¦‚æŸä¸ªæœåŠ¡å ç”¨äº†80ç«¯å£ï¼Œé‚£ä¹ˆå…¶ä»–æœåŠ¡å°±ä¸èƒ½åœ¨ç”¨è¿™ä¸ªç«¯å£äº†ã€‚</span><br><span class="line"></span><br><span class="line">2.NodePortæ˜¯4å±‚ä»£ç†ï¼Œä¸èƒ½è§£æ7å±‚çš„httpï¼Œä¸èƒ½é€šè¿‡åŸŸååŒºåˆ†æµé‡</span><br><span class="line"></span><br><span class="line">3.ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°èµ„æºæ§åˆ¶å™¨å«Ingressï¼Œä½œç”¨å°±æ˜¯æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è®¿é—®å…¥å£ã€‚å·¥ä½œåœ¨7å±‚</span><br><span class="line"></span><br><span class="line">4.è™½ç„¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨nginx/haproxyæ¥å®ç°ç±»ä¼¼çš„æ•ˆæœï¼Œä½†æ˜¯ä¼ ç»Ÿéƒ¨ç½²ä¸èƒ½åŠ¨æ€çš„å‘ç°æˆ‘ä»¬æ–°åˆ›å»ºçš„èµ„æºï¼Œå¿…é¡»æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶é‡å¯ã€‚</span><br><span class="line"></span><br><span class="line">5.é€‚ç”¨äºk8sçš„ingressæ§åˆ¶å™¨ä¸»æµçš„æœ‰nginx-ingressã€traefikã€haproxy-ingress</span><br></pre></td></tr></table></figure><p>Ingressæ§åˆ¶å™¨<br>1ï¼‰[AKS åº”ç”¨ç½‘å…³Ingresæ§åˆ¶å™¨] ä½¿ç”¨ Azureåº”ç”¨ç¨‹åºç½‘å…³å¯ç”¨AKSé›†ç¾¤ingressã€‚<br>2ï¼‰mbassador APIç½‘å…³ï¼Œä¸€ä¸ªåŸºäºEnvoyçš„Ingressæ§åˆ¶å™¨ï¼Œæœ‰ç€æ¥è‡ªç¤¾åŒºçš„æ”¯æŒå’Œæ¥è‡ªDatawireçš„å•†ä¸šæ”¯æŒã€‚<br>3ï¼‰AppsCode Inc ä¸ºæœ€å¹¿æ³›ä½¿ç”¨çš„åŸºäºHAproxyçš„Ingressæ§åˆ¶å™¨Voyageræä¾›è‡ªæŒå’Œç»´æŠ¤ã€‚<br>4ï¼‰AWS ALB Ingressæ§åˆ¶å™¨ï¼Œé€šè¿‡AWSåº”ç”¨Load Balancerå¯ç”¨Ingressã€‚<br>5ï¼‰Contouræ˜¯ä¸€ä¸ªåŸºäºEnvoyçš„Ingressæ§åˆ¶å™¨ï¼Œå®ƒç”±VMwareæä¾›å’Œæ”¯æŒã€‚<br>6ï¼‰Citrixä¸ºå…¶ç¡¬ä»¶ï¼ˆMPXï¼‰ï¼Œè™šæ‹ŸåŒ–ï¼ˆVPXï¼‰å’Œå…è´¹å®¹å™¨åŒ–ï¼ˆCPXï¼‰ADCæä¾›äº†ä¸€ä¸ªIngressæ§åˆ¶å™¨ï¼Œç”¨äºè£¸é‡‘å±å’Œäº‘éƒ¨ç½²ã€‚<br>7ï¼‰F5 Networksä¸ºç”¨äºKubernetesçš„F5 BIG-IPæ§åˆ¶å™¨æä¾›æ”¯æŒå’Œç»´æŠ¤ã€‚<br>8ï¼‰Glooæ˜¯ä¸€ä¸ªå¼€æºçš„åŸºäºEnvoyçš„Ingressæ§åˆ¶å™¨ï¼Œå®ƒæä¾›äº†APIç½‘å…³åŠŸèƒ½ï¼Œæœ‰ç€æ¥è‡ªsolo.ioçš„ä¼ä¸šçº§æ”¯æŒã€‚<br>9ï¼‰HAproxy Ingressæ˜¯HAproxyé«˜åº¦å¯å®šåˆ¶çš„ã€ç”±ç¤¾åŒºé©±åŠ¨çš„Ingressæ§åˆ¶å™¨ã€‚<br>10ï¼‰HAproxy Technologiesä¸ºç”¨äºKubernetesçš„HAproxy Ingressæ§åˆ¶å™¨æä¾›æ”¯æŒå’Œç»´æŠ¤ï¼Œå…·ä½“ä¿¡æ¯è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚<br>11ï¼‰åŸºäºIstioçš„ingressæ§åˆ¶å™¨ï¼Œæ§åˆ¶Ingressæµé‡ã€‚<br>12ï¼‰Kongä¸ºç”¨äºKubernetesçš„Kong Ingressæ§åˆ¶å™¨æä¾›ç¤¾åŒºæˆ–å•†ä¸šæ”¯æŒå’Œç»´æŠ¤ã€‚<br>14ï¼‰Nginx ä¸ºç”¨äºKubernetesçš„Nginx Ingressæ§åˆ¶å™¨æä¾›æ”¯æŒå’Œç»´æŠ¤<br>15ï¼‰Traefikï¼ˆå°èœœèœ‚ï¼‰æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„Ingressæ§åˆ¶å™¨ã€‚ï¼ˆLetâ€™s Encryptï¼Œsecretsï¼Œhttp2ï¼Œwebsocketï¼‰å¹¶ä¸”å®ƒä¹Ÿæœ‰Traefik Labsçš„å•†ä¸šæ”¯æŒ</p><p><img src="../image/study_img/image-20240924121232376.png" alt="image-20240924121232376"></p><p>1ã€éƒ¨ç½²nginx-ingress</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/kubeguide</span><br><span class="line">æƒå¨æŒ‡å—çš„èµ„æºæ¸…å•ç½‘å€ï¼šhttps://github.com/kubeguide/K8sDefinitiveGuide-V5-Sourcecode/blob/main/Chapter04/4.6.1%20nginx-ingress-controller.yaml</span><br><span class="line"></span><br><span class="line">1ã€ä¸‹è½½æƒå¨æŒ‡å—çš„èµ„æºæ¸…å• ingressèµ„æºæ¸…å•</span><br><span class="line">[root@master01 service]# vim nginx-ingress.yaml</span><br><span class="line">æŠŠå¤åˆ¶çš„èµ„æºæ¸…å•ç²˜è´´</span><br><span class="line">135è¡Œï¼š kind: Deployment æ”¹ä¸º kind: DaemonSet</span><br><span class="line">130è¡Œï¼š  åˆ é™¤ data:</span><br><span class="line">140è¡Œï¼š  åˆ é™¤ replicas: 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™2è¡Œæ˜¯ç»™nodeæ‰“æ ‡ç­¾çš„ï¼Œåªæœ‰æ‰“äº†æ ‡ç­¾æ‰è£…åœ¨nodeä¸Šé¢ï¼Œè¦ä¹ˆæ³¨é‡Šè¿™ä¸¤è¡Œï¼Œè¦ä¹ˆç»™nodeæ‰“æ ‡ç­¾     èŠ‚ç‚¹æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line">147è¡Œï¼š      nodeSelector:</span><br><span class="line">148è¡Œï¼š        role: ingress-nginx-controller</span><br><span class="line"></span><br><span class="line"><span class="comment">#å»ºè®®å¤åˆ¶ä¹‹åç²˜è´´åœ¨VScodeé‡Œé¢ï¼Œæ ¼å¼ä¸ä¼šå‡ºé”™</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240924213753073.png" alt="image-20240924213753073"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2ã€ç»™nodeèŠ‚ç‚¹æ‰“ä¸Šæ ‡ç­¾</span><br><span class="line">[root@master01 kubernetes]# kubectl label node node01 role=ingress-nginx-controller</span><br><span class="line">node/node01 labeled</span><br><span class="line">[root@master01 kubernetes]# kubectl label node node02 role=ingress-nginx-controller</span><br><span class="line">node/node02 labeled</span><br><span class="line">[root@master01 kubernetes]# kubectl label node node03 role=ingress-nginx-controller</span><br><span class="line">node/node03 labeled</span><br><span class="line"></span><br><span class="line">3ã€è¿è¡Œèµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-ingress.yaml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -n nginx-ingress -owide</span><br><span class="line">NAME                  READY   STATUS    RESTARTS   AGE     IP          NODE  </span><br><span class="line">nginx-ingress-hrn5v   1/1     Running   0          2m16s   10.2.3.98   node03</span><br><span class="line">nginx-ingress-hsvgc   1/1     Running   0          2m16s   10.2.1.45   node01</span><br><span class="line">nginx-ingress-tzsht   1/1     Running   0          2m16s   10.2.2.40   node02</span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨ingresså¯åŠ¨è‡ªå·±çš„ç«™ç‚¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸ºé¿å…æ•°æ®åº“æœ‰è„æ•°æ®ï¼Œå…ˆåˆ é™¤èŠ‚ç‚¹ä¸Šä¹‹å‰æ˜ å°„çš„æ•°æ®åº“ç›®å½•</span><br><span class="line">[root@node01 ~]#  <span class="built_in">rm</span> -rf /data/</span><br><span class="line">[root@node02 ~]#  <span class="built_in">rm</span> -rf /data/</span><br><span class="line">[root@node03 ~]#  <span class="built_in">rm</span> -rf /data/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€# wordpress pod    èµ·Deploymentèµ„æº</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f wp-dp-v1.yml </span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: wp-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#èµ·2ä¸ªï¼Œæ•°æ®ä¹Ÿæ˜¯2ä¸ªï¼Œé™¤éæŠŠæ•°æ®åˆ†å¼€</span></span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">    <span class="comment">#è¿™é‡Œçš„æ ‡ç­¾ä¸€å®šè¦å’Œsvcçš„æ ‡ç­¾ä¸€æ ·ï¼Œä¸ç„¶ä¼šè¿æ¥ä¸åˆ°</span></span><br><span class="line">      app: wp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: wp-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        app: wp</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: mysql-data</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /data/mysql</span><br><span class="line">      - name: wp-data</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /data/wp</span><br><span class="line"></span><br><span class="line">      containers:</span><br><span class="line">      - name: wp-container</span><br><span class="line">        image: wordpress</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="comment">#livenessProbe:</span></span><br><span class="line">        <span class="comment">#  tcpSocket:</span></span><br><span class="line">        <span class="comment">#    port: 80</span></span><br><span class="line">        <span class="comment">#  initialDelaySeconds: 10</span></span><br><span class="line">        <span class="comment">#  periodSeconds: 3</span></span><br><span class="line">        <span class="comment">#  timeoutSeconds: 3</span></span><br><span class="line">        <span class="comment">#  failureThreshold: 3</span></span><br><span class="line">        readinessProbe:</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 3306</span><br><span class="line">          initialDelaySeconds: 3</span><br><span class="line">          timeoutSeconds: 1</span><br><span class="line">          periodSeconds: 2</span><br><span class="line">          successThreshold: 3</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_USER</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_NAME</span><br><span class="line">          value: <span class="string">&#x27;wp_db&#x27;</span></span><br><span class="line">        </span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: wp-data</span><br><span class="line">          mountPath: /var/www/html/</span><br><span class="line">    </span><br><span class="line">      - name: mysql-container</span><br><span class="line">        image: mysql:5.7</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        args:</span><br><span class="line">        - --character-set-server=utf8</span><br><span class="line">        - --collation-server=utf8_general_ci</span><br><span class="line">        livenessProbe:</span><br><span class="line">          <span class="built_in">exec</span>:</span><br><span class="line">            <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;mysqladmin -uroot -p123 ping&quot;</span>]</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 3</span><br><span class="line">          timeoutSeconds: 3</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: MYSQL_DATABASE</span><br><span class="line">          value: <span class="string">&#x27;wp_db&#x27;</span></span><br><span class="line">        - name: MYSQL_USER</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: mysql-data</span><br><span class="line">          mountPath: /var/lib/mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€# wordpress service</span><br><span class="line">[root@master01 kubernetes]# vim wp-svc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-svc</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">  <span class="comment">#è¿™é‡Œçš„æ ‡ç­¾ä¸€å®šè¦å’Œpod-dpçš„æ ‡ç­¾ä¸€æ ·ï¼Œä¸ç„¶ä¼šè¿æ¥ä¸åˆ°</span></span><br><span class="line">    app: wp</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line">  </span><br><span class="line">3ã€# å¯¹å¤–æä¾›æœåŠ¡çš„wordpress ingress</span><br><span class="line">[root@master01 kubernetes]# vim wp-ingress.yaml</span><br><span class="line">---</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-ingress</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  <span class="comment">#ç«™ç‚¹çš„åŸŸå</span></span><br><span class="line">  - host: blog.wp.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        pathType: ImplementationSpecific</span><br><span class="line">        <span class="comment">#backendä¹‹å‰çš„éƒ½æ˜¯ç½‘ç«™ç›¸å…³é…ç½®</span></span><br><span class="line">        <span class="comment">##ä»backendä¹‹åçš„éƒ½æ˜¯ingresså…³è”ClusterIP</span></span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">          <span class="comment">#è¿™é‡Œå¿…é¡»è¦å†™svcç½‘ç«™çš„åå­—</span></span><br><span class="line">            name: wordpress-svc</span><br><span class="line">            port:</span><br><span class="line">              number: 80</span><br><span class="line">              </span><br><span class="line">4ã€è¿è¡Œ</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f wp-ingress.yml </span><br><span class="line">ingress.networking.k8s.io/wordpress-ingress created</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f wp-dp-v1.yml  </span><br><span class="line">pod/wp-pod created</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f wp-svc.yml </span><br><span class="line">service/wordpress-svc created</span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl get ingress</span><br><span class="line">Warning: extensions/v1beta1 Ingress is deprecated <span class="keyword">in</span> v1.14+, unavailable <span class="keyword">in</span> v1.22+; use networking.k8s.io/v1 Ingress</span><br><span class="line">NAME                CLASS    HOSTS         ADDRESS   PORTS   AGE</span><br><span class="line">wordpress-ingress   &lt;none&gt;   blog.wp.com             80      13s</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl get svc</span><br><span class="line">wordpress-svc   ClusterIP   10.1.42.145    &lt;none&gt;        80/TCP         25s</span><br><span class="line">[root@master01 kubernetes]# kubectl describe svc wordpress-svc </span><br><span class="line">Name:              wordpress-svc</span><br><span class="line">Namespace:         default</span><br><span class="line">Labels:            &lt;none&gt;</span><br><span class="line">Annotations:       &lt;none&gt;</span><br><span class="line">Selector:          app=wp</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.1.84.160</span><br><span class="line">Port:              http  80/TCP</span><br><span class="line">TargetPort:        80/TCP</span><br><span class="line">Endpoints:         10.2.3.118:80  <span class="comment">#æ˜¾ç¤ºæ‰¾åˆ°äº†pod ip</span></span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE   IP           NODE  </span><br><span class="line">wp-dp-9d48b944b-z6snw           2/2     Running   0          22m   10.2.3.118   node03</span><br></pre></td></tr></table></figure><p>3ã€æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1ã€æœ¬åœ°æœºå™¨åšåŸŸåè§£æï¼Œingressèµ·åœ¨nodeèŠ‚ç‚¹ä¸Šçš„ï¼ŒnodeèŠ‚ç‚¹çš„ipåšè°çš„åŸŸåè§£æéƒ½å¯ä»¥</span><br><span class="line">10.0.0.201  blog.wp.com</span><br><span class="line"></span><br><span class="line">2ã€ä½¿ç”¨åŸŸååœ¨æµè§ˆå™¨è®¿é—®æˆåŠŸï¼Œè¿™å°±æ˜¯ingressçš„ç›¸å…³ï¼Œè€Œä¸”è¿˜æ˜¯80ç«¯å£ï¼Œä»¥åä¸ç®¡èµ·å¤šå°‘ä¸ªç½‘ç«™ï¼Œéƒ½èµ°80ç«¯å£ï¼Œä½†æ˜¯nodeèŠ‚ç‚¹ä¸Šçœ‹ä¸åˆ°80ç«¯å£çš„ï¼Œåªæ˜¯åœ¨åº•å±‚çš„é˜²ç«å¢™åšçš„è½¬å‘</span><br><span class="line">blog.wp.com</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;3ã€iptables -Fè¿™ä¸ªå‘½ä»¤åƒä¸‡ä¸è¦æ‰§è¡Œï¼Œä»–ä¼šæ¸…ç©ºiptablesæ‰€æœ‰çš„è½¬å‘é…ç½®&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927230958071.png" alt="image-20240927230958071"></p><p><img src="../image/study_img/image-20240927231602977.png" alt="image-20240927231602977"></p><p>å°†åŸŸåè§£ææ”¹åˆ°å…¶ä»–nodeï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸŸåè®¿é—®æˆåŠŸ</p><p><img src="../image/study_img/image-20240927231929202.png" alt="image-20240927231929202"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä»–åˆ°nodeèŠ‚ç‚¹çš„æœºå™¨ï¼Œè½¬å‘åˆ°cluster ipä¸Šï¼Œcluster ipå»è®¿é—®podï¼Œä½†æˆ‘ä»¬çš„podå°±ä¸€ä¸ªpodï¼Œæ‰€ä»¥æš‚æ—¶æ²¡æœ‰æ—¥å¿—æ˜¾ç¤ºæ˜¯å“ªå°æœºå™¨è½¬å‘çš„</span><br><span class="line"></span><br><span class="line">è§£æåˆ°å“ªï¼Œå–å†³äºå“ªäº›æœºå™¨å®‰è£…äº†ingress</span><br></pre></td></tr></table></figure><p>3ã€ingressèµ„æºè§£æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spec:                                          <span class="comment">#è½¬å‘è§„åˆ™</span></span><br><span class="line">  rules:                                       <span class="comment">#è½¬å‘è§„åˆ™</span></span><br><span class="line">  <span class="comment">#ç«™ç‚¹çš„åŸŸå</span></span><br><span class="line">  - host: blog.wp.com                          <span class="comment">#åŒ¹é…çš„åŸŸå</span></span><br><span class="line">    http:                                      <span class="comment">#åŸºäºhttpåè®®è§£æ</span></span><br><span class="line">      paths:                                   <span class="comment">#åŸºäºè·¯å¾„è¿›è¡ŒåŒ¹é…</span></span><br><span class="line">      - path: /                                <span class="comment">#åŒ¹é…/è·¯å¾„</span></span><br><span class="line">        pathType: ImplementationSpecific       <span class="comment">#è·¯å¾„ç±»å‹</span></span><br><span class="line">        backend:                               <span class="comment">#åŒ¹é…åè·³è½¬çš„åç«¯æœåŠ¡</span></span><br><span class="line">          service:                       <span class="comment">#è®¾ç½®åç«¯è·³è½¬åˆ°Serviceçš„é…ç½®</span></span><br><span class="line">            name: wordpress-svc          <span class="comment">#è·³è½¬åˆ°åä¸ºwordpress-svcçš„ClusterIP</span></span><br><span class="line">            port:                              <span class="comment">#è·³è½¬åˆ°çš„ç«¯å£</span></span><br><span class="line">              number: 80                       <span class="comment">#Serviceç«¯å£å·</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># pathTypeè·¯å¾„ç±»å‹æ”¯æŒçš„ç±»å‹ï¼š</span></span><br><span class="line">ImplementationSpecific ç³»ç»Ÿé»˜è®¤ï¼Œç”±IngressClassæ§åˆ¶å™¨æä¾›</span><br><span class="line">Exact ç²¾ç¡®åŒ¹é…URLè·¯å¾„ï¼ŒåŒºåˆ†å¤§å°å†™  ç›¸å½“äºnginxé…ç½®æ–‡ä»¶çš„ location = /  ~ * è¿™ç§</span><br><span class="line">Prefix åŒ¹é…URLè·¯å¾„çš„å‰ç¼€ï¼ŒåŒºåˆ†å¤§å°å†™</span><br></pre></td></tr></table></figure><h3 id="5ã€ServiceæœåŠ¡å‘ç°"><strong>5ã€ServiceæœåŠ¡å‘ç°</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœ¨k8sä¸­ï¼Œä¸€ä¸ªserviceå¯¹åº”çš„â€œåç«¯â€ç”±Podçš„IPå’Œå®¹å™¨ç«¯å£å·ç»„æˆï¼Œå³ä¸€ä¸ªå®Œæ•´çš„<span class="string">&quot;IP:Port&quot;</span>è®¿é—®åœ°å€ï¼Œè¿™åœ¨k8sé‡Œå«åšEndpointã€‚é€šè¿‡æŸ¥çœ‹Serviceçš„è¯¦ç»†ä¿¡æ¯å¯ä»¥çœ‹åˆ°åç«¯Endpointçš„åˆ—è¡¨ã€‚</span><br><span class="line">[rootÂ©node1 ~]# kubectl describe svc my-nginx</span><br><span class="line">Endpoints:  10.2.1.24:80,10.2.1.26:80,10.2.1.27:89 more...</span><br><span class="line"></span><br><span class="line">æŠŠä¸€ä¸ªpodåˆ æ‰åï¼Œè‡ªåŠ¨èµ·æ¥çš„å°±ä¼šè‡ªåŠ¨åŠ åˆ°cluster ipé‡Œ</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨DNSåŸŸåçš„å½¢å¼è®¿é—®Serviceï¼Œå¦‚æœåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´é‡Œç”šè‡³å¯ä»¥ç›´æ¥ä½¿ç”¨serviceåæ¥è®¿é—®æœåŠ¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">servicename.namespace.svc.cluster.local</span><br><span class="line">servicename.namespace</span><br><span class="line">servicename</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927183355537.png" alt="image-20240927183355537"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰9ã€KubernetesæŒä¹…åŒ–å‚¨å­˜</title>
      <link href="/posts/a288ff46.html"/>
      <url>/posts/a288ff46.html</url>
      
        <content type="html"><![CDATA[<h2 id="KubernetesæŒä¹…åŒ–å‚¨å­˜">KubernetesæŒä¹…åŒ–å‚¨å­˜</h2><h3 id="1ã€K8sæŒä¹…åŒ–å‚¨å­˜ä»‹ç»"><strong>1ã€K8sæŒä¹…åŒ–å‚¨å­˜ä»‹ç»</strong></h3><p>â€‹      ä¹‹å‰æ¥è§¦hostpathã€emptyDirçš„æ˜¯æœ¬åœ°å‚¨å­˜ï¼Œç¼ºé™·æ•°æ®ä¸èƒ½åšåˆ°å’Œå…¶ä»–æœºå™¨å…±äº«</p><p>â€‹       å®¹å™¨å†…éƒ¨çš„çš„å­˜å‚¨åœ¨ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼Œä¼šéšç€å®¹å™¨ç¯å¢ƒçš„é”€æ¯è€Œé”€æ¯ï¼Œå…·æœ‰ä¸ç¨³å®šæ€§ï¼Œåœ¨k8sé‡Œå°†å¯¹å®¹å™¨åº”ç”¨æ‰€éœ€çš„å­˜å‚¨èµ„æºæŠ½è±¡ä¸ºå­˜å‚¨å·(Volume)æ¦‚å¿µæ¥è§£å†³è¿™äº›é—®é¢˜ã€‚</p><p>K8sç›®å‰æ”¯æŒçš„Volumeç±»å‹åŒ…æ‹¬k8sçš„å†…éƒ¨èµ„æºå¯¹è±¡ç±»å‹ï¼Œå¼€æºå…±äº«å­˜å‚¨ç±»å‹å’Œå…¬æœ‰äº‘å­˜å‚¨ç­‰ã€‚åˆ†ç±»å¦‚ä¸‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#K8sç‰¹å®šçš„èµ„æºå¯¹è±¡</span></span><br><span class="line">configMapï¼šå‚¨å­˜é…ç½®æ–‡ä»¶  (é…ç½®ä¸­å¿ƒ:nacos)</span><br><span class="line">Secretï¼šå‚¨å­˜åŠ å¯†æ•°æ®ï¼Œè¯ä¹¦æ–‡ä»¶</span><br><span class="line">ServiceAccountTokenï¼šå‚¨å­˜tokenæ•°æ®</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ¬åœ°å‚¨å­˜ï¼špodèµ·åœ¨å“ªï¼Œæ•°æ®å°±åœ¨å“ªä¸ªæœºå™¨</span></span><br><span class="line">EmptDirï¼šä¸´æ—¶å‚¨å­˜(å®¿ä¸»æœºéšæœºç”Ÿæˆä¸€ä¸ªå‚¨å­˜ç›®å½•)</span><br><span class="line">HostPathï¼šå®¿ä¸»æœºç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç½‘ç»œå…±äº«å‚¨å­˜</span></span><br><span class="line">CephFSï¼šå¼€æºå…±äº«å‚¨å­˜ç³»ç»Ÿ(ç°åœ¨ç”¨çš„æ¯”è¾ƒå¤šä¸€äº›)</span><br><span class="line">ClusterFSï¼šå¼€æºå…±äº«å‚¨å­˜ç³»ç»Ÿ  FastDFS</span><br><span class="line">NFSï¼šå¼€æºå…±äº«å‚¨å­˜  (è¿™ä¸ªæ˜¯å•ç‚¹ï¼Œå†™è„šæœ¬ä¼šå¡ä¸»)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#PVå…±äº«å­˜å‚¨ï¼š</span></span><br><span class="line">PersishtenVolumeClainï¼š</span><br></pre></td></tr></table></figure><h3 id="2ã€æœ¬åœ°å‚¨å­˜â€”â€”EmptyDirç±»å‹çš„æŒ‚è½½æ–¹å¼"><strong>2ã€æœ¬åœ°å‚¨å­˜â€”â€”EmptyDirç±»å‹çš„æŒ‚è½½æ–¹å¼</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™Deploymentæ§åˆ¶å™¨çš„èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim nginx-emptDir.yml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec: </span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: mysql-dp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-dp-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        app: mysql-dp</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: mysql-emptydir</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      containers:</span><br><span class="line">      - name: mysql-container</span><br><span class="line">        image: mysql:5.7</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: mysql-emptydir</span><br><span class="line">          mountPath: /var/lib/mysql</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œå¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-emptDir.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide</span><br><span class="line">NAME                        READY   STATUS    RESTARTS   AGE   IP           NODE  </span><br><span class="line">nginx-dp-67b5bd5fdc-kvjqh   1/1     Running   0          18s   10.2.3.119   node03</span><br><span class="line"></span><br><span class="line">3ã€node03æŸ¥çœ‹æŒ‚è½½çš„æ•°æ®</span><br><span class="line">[root@node03 ~]# docker inspect fb799f13d7e9</span><br><span class="line">[root@node03 ~]# ll /var/lib/kubelet/pods/9be94529-0040-4185-91c8-91b4b271d387/volumes/kubernetes.io~empty-dir/mysql-emptydir</span><br><span class="line">-rw-r----- 1 polkitd input       56 Sep 28 11:53 auto.cnf</span><br><span class="line">-rw------- 1 polkitd input     1680 Sep 28 11:53 ca-key.pem</span><br><span class="line">-rw-r--r-- 1 polkitd input     1112 Sep 28 11:53 ca.pem</span><br><span class="line">-rw-r--r-- 1 polkitd input     1112 Sep 28 11:53 client-cert.pem</span><br><span class="line">-rw------- 1 polkitd input     1680 Sep 28 11:53 client-key.pem</span><br><span class="line">-rw-r----- 1 polkitd input     1318 Sep 28 11:53 ib_buffer_pool</span><br><span class="line">-rw-r----- 1 polkitd input 79691776 Sep 28 11:53 ibdata1</span><br><span class="line">-rw-r----- 1 polkitd input 50331648 Sep 28 11:53 ib_logfile0</span><br><span class="line">-rw-r----- 1 polkitd input 50331648 Sep 28 11:53 ib_logfile1</span><br><span class="line">-rw-r----- 1 polkitd input 12582912 Sep 28 11:53 ibtmp1</span><br><span class="line">drwxr-x--- 2 polkitd input     4096 Sep 28 11:53 mysql</span><br><span class="line">lrwxrwxrwx 1 polkitd input       27 Sep 28 11:53 mysql.sock -&gt; /var/run/mysqld/mysqld.sock</span><br><span class="line">drwxr-x--- 2 polkitd input     8192 Sep 28 11:53 performance_schema</span><br><span class="line">-rw------- 1 polkitd input     1680 Sep 28 11:53 private_key.pem</span><br><span class="line">-rw-r--r-- 1 polkitd input      452 Sep 28 11:53 public_key.pem</span><br><span class="line">-rw-r--r-- 1 polkitd input     1112 Sep 28 11:53 server-cert.pem</span><br><span class="line">-rw------- 1 polkitd input     1680 Sep 28 11:53 server-key.pem</span><br><span class="line">drwxr-x--- 2 polkitd input     8192 Sep 28 11:53 sys</span><br></pre></td></tr></table></figure><h3 id="3ã€æœ¬åœ°å‚¨å­˜â€”â€”hostpathç±»å‹"><strong>3ã€æœ¬åœ°å‚¨å­˜â€”â€”hostpathç±»å‹</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™æ§åˆ¶å™¨çš„èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim nginx-hostpath.yml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec: </span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: mysql-dp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: nginx-dp-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        app: mysql-dp</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: mysql-emptydir</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      - name: mysql-hostpath</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /opt/mysql</span><br><span class="line">      containers:</span><br><span class="line">      - name: mysql-container</span><br><span class="line">        image: mysql:5.7</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: mysql-hostpath</span><br><span class="line">          mountPath: /var/lib/mysql</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-hostpath.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4ã€å…±äº«å‚¨å­˜â€”â€”NFSç±»å‹"><strong>4ã€å…±äº«å‚¨å­˜â€”â€”NFSç±»å‹</strong></h3><p><img src="../image/study_img/image-20240928175642454.png" alt="image-20240928175642454"></p><p>1ã€éƒ¨ç½²NFS</p><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>nfs</td><td>10.0.0.31  /  172.16.1.31</td><td></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#NFSæœåŠ¡å™¨ä¸èƒ½èµ·åœ¨Podé‡Œçš„ï¼Œå‚¨å­˜ç±»çš„å‡ ä¹ä¸ä¼šç”¨podå»èµ·çš„</span></span><br><span class="line"></span><br><span class="line">1ã€NFSæœåŠ¡å®‰è£…NFS</span><br><span class="line">[root@nfs ~]# yum -y install nfs-utils</span><br><span class="line"></span><br><span class="line">2ã€nodeèŠ‚ç‚¹è¦æŒ‚è½½è¿‡å»ï¼Œæ‰€æœ‰nodeèŠ‚ç‚¹å®‰è£…nfs</span><br><span class="line">[root@node01 ~]# yum -y install nfs-utils</span><br><span class="line">[root@node02 ~]# yum -y install nfs-utils</span><br><span class="line">[root@node03 ~]# yum -y install nfs-utils</span><br><span class="line"></span><br><span class="line">3ã€ä¿®æ”¹nfsæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@nfs ~]# vim /etc/exports</span><br><span class="line">/data/wp 172.16.1.0/24(rw,<span class="built_in">sync</span>,all_squash)</span><br><span class="line"></span><br><span class="line">4ã€åˆ›å»ºæŒ‚è½½ç›®å½•ï¼Œå¹¶æˆæƒï¼Œå¯åŠ¨æœåŠ¡</span><br><span class="line">[root@nfs ~]# <span class="built_in">mkdir</span> -p /data/wp</span><br><span class="line">[root@nfs ~]# <span class="built_in">chown</span> -R nfsnobody.nfsnobody /data/wp</span><br><span class="line">[root@nfs ~]# systemctl start nfs &amp;&amp; systemctl <span class="built_in">enable</span> nfs </span><br><span class="line"></span><br><span class="line">5ã€éªŒè¯ç”Ÿæ•ˆ</span><br><span class="line">[root@nfs ~]# <span class="built_in">cat</span> /var/lib/nfs/etab </span><br><span class="line">/data/wp        172.16.1.0/24(rw,<span class="built_in">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,rw,secure,root_squash,all_squash)</span><br></pre></td></tr></table></figure><p>2ã€masterç¼–å†™wpæŒ‚è½½nfsçš„èµ„æºæ¸…å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™wpçš„Deploymentèµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim wp-dp-v1.yml </span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: wp-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#èµ·2ä¸ªï¼Œæ•°æ®ä¹Ÿæ˜¯2ä¸ªï¼Œé™¤éæŠŠæ•°æ®åˆ†å¼€</span></span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: wp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: wp-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        app: wp</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: wp-data</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /data/wp</span><br><span class="line"></span><br><span class="line">      <span class="comment">#-----------------æŒ‚è½½nfsçš„å†™æ³•---------------------</span></span><br><span class="line">      <span class="comment">#æœ€åä¸€è¡ŒæŒ‚è½½çš„åå­—è¦æ”¹ä¸€ä¸‹</span></span><br><span class="line">      <span class="comment"># mount -t nfs 172.16.1.31:/data/wordpress /var/www/html</span></span><br><span class="line">      - name: wp-nfs    </span><br><span class="line">        nfs:</span><br><span class="line">      <span class="comment">#nfsæœåŠ¡å™¨é…ç½®æ–‡ä»¶å†™çš„å…±äº«ç›®å½•</span></span><br><span class="line">          path: /data/wp</span><br><span class="line">          readOnly: <span class="literal">false</span></span><br><span class="line">      <span class="comment">#serverå°±æ˜¯nfsæœåŠ¡çš„ip</span></span><br><span class="line">          server: 172.16.1.31</span><br><span class="line"></span><br><span class="line">      containers:</span><br><span class="line">      - name: wp-container</span><br><span class="line">        image: wordpress</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="comment">#livenessProbe:</span></span><br><span class="line">        <span class="comment">#  tcpSocket:</span></span><br><span class="line">        <span class="comment">#    port: 80</span></span><br><span class="line">        <span class="comment">#  initialDelaySeconds: 10</span></span><br><span class="line">        <span class="comment">#  periodSeconds: 3</span></span><br><span class="line">        <span class="comment">#  timeoutSeconds: 3</span></span><br><span class="line">        <span class="comment">#  failureThreshold: 3</span></span><br><span class="line">        <span class="comment">#readinessProbe:</span></span><br><span class="line">        <span class="comment">#  tcpSocket:</span></span><br><span class="line">        <span class="comment">#    host: mysql-svc</span></span><br><span class="line">        <span class="comment">#    port: 3306</span></span><br><span class="line">        <span class="comment">#  initialDelaySeconds: 3</span></span><br><span class="line">        <span class="comment">#  timeoutSeconds: 1</span></span><br><span class="line">        <span class="comment">#  periodSeconds: 2</span></span><br><span class="line">        <span class="comment">#  successThreshold: 3</span></span><br><span class="line">        <span class="comment">#  failureThreshold: 3</span></span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&#x27;mysql-svc&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_USER</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_NAME</span><br><span class="line">          value: <span class="string">&#x27;wp_db&#x27;</span></span><br><span class="line">        </span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: wp-nfs</span><br><span class="line">          mountPath: /var/www/html/</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f wp-dp-v1.yml </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ç¼–å†™wpçš„Serviceèµ„æº</span><br><span class="line">[root@master01 kubernetes]# vim wp-svc.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-svc</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: wp</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    <span class="comment">#è¿™é‡Œä¸´æ—¶ä¸ºäº†æµ‹è¯•ï¼Œæ‰€ä»¥ä¸´æ—¶ä½¿ç”¨NodePort</span></span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30002</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f wp-svc.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get svc</span><br><span class="line">NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)     </span><br><span class="line">wordpress-svc   NodePort    10.1.84.160    &lt;none&gt;        80:30002/TCP</span><br><span class="line"></span><br><span class="line">3ã€ç¼–å†™mysqlçš„Deploymentèµ„æº</span><br><span class="line">[root@master01 kubernetes]# vim mysql-dp.yml </span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: mysql-dp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: mysql-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        app: mysql-dp</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: mysql-emptydir</span><br><span class="line">        emptyDir: &#123;&#125; </span><br><span class="line">      - name: mysql-hostpath</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /opt/mysql</span><br><span class="line"></span><br><span class="line">      containers:</span><br><span class="line">      - name: mysql-container</span><br><span class="line">        image: mysql:5.7.44</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">          value: <span class="string">&quot;123&quot;</span></span><br><span class="line">        - name: MYSQL_DATABASE</span><br><span class="line">          value: <span class="string">&quot;wp_db&quot;</span></span><br><span class="line">        - name: MYSQL_USER</span><br><span class="line">          value: <span class="string">&quot;wp_user&quot;</span></span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          value: <span class="string">&quot;123&quot;</span></span><br><span class="line">        </span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: mysql-hostpath</span><br><span class="line">          mountPath: /var/lib/mysql</span><br><span class="line">          </span><br><span class="line">[root@master01 kubernetes]#  kubectl apply -f mysql-dp.yml </span><br><span class="line"></span><br><span class="line">4ã€ç¼–å†™mysqlçš„Serviceèµ„æº</span><br><span class="line">[root@master01 kubernetes]# vim mysql-svc.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-svc</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: mysql-dp</span><br><span class="line">  ports:</span><br><span class="line">  - name: mysql</span><br><span class="line">    port: 3306</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 3306</span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line">  </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f mysql-svc.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get svc</span><br><span class="line">NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">mysql-svc       ClusterIP   10.1.47.161    &lt;none&gt;        3306/TCP       52s</span><br><span class="line">wordpress-svc   NodePort    10.1.84.160    &lt;none&gt;        80:30002/TCP   15h</span><br><span class="line"></span><br><span class="line">3ã€åˆ°nfséªŒè¯æ˜¯å¦æŒ‚è½½æˆåŠŸ</span><br><span class="line">[root@nfs ~]# ll /data/wp/</span><br><span class="line">-rw-r--r--  1 nfsnobody nfsnobody   405 Feb  6  2020 index.php</span><br><span class="line">-rw-r--r--  1 nfsnobody nfsnobody 19915 Jan  1  2024 ...</span><br><span class="line">-rw-r--r--  1 nfsnobody nfsnobody  3246 Mar  2  2024 xmlrpc.php</span><br><span class="line"></span><br><span class="line">4ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">k8sé›†ç¾¤ä¸­éšä¾¿ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥è®¿é—®ï¼Œä¸Šé¢è¯´è¿‡ï¼Œå’Œkube-proxyæœ‰å…³</span><br><span class="line">10.0.0.200:30002</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240928141216598.png" alt="image-20240928141216598"></p><p>å‘å¸ƒæ–‡ç« ä¸Šä¼ å›¾ç‰‡</p><p><img src="../image/study_img/image-20240928142403213.png" alt="image-20240928142403213"></p><p>nfsæœºå™¨é‡Œé¢æŸ¥çœ‹å›¾ç‰‡æ˜¯å¦ä¸Šä¼ åˆ°æŒ‚è½½ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@nfs ~]# ll /data/wp/wp-content/uploads/2024/09/</span><br><span class="line">total 512</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody  74163 Sep 28 14:21 12-1024x758.jpg</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody   6000 Sep 28 14:21 12-150x150.jpg</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody  13125 Sep 28 14:21 12-300x222.jpg</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody  50103 Sep 28 14:21 12-768x568.jpg</span><br><span class="line">-rw-r--r-- 1 nfsnobody nfsnobody 367277 Sep 28 14:21 12.jpg</span><br></pre></td></tr></table></figure><h3 id="5ã€PVå’ŒPVCçš„ä»‹ç»"><strong>5ã€PVå’ŒPVCçš„ä»‹ç»</strong></h3><p>PVæ˜¯å¯¹åº•å±‚ç½‘ç»œå…±äº«å­˜å‚¨çš„æŠ½è±¡ï¼Œå°†å…±äº«å­˜å‚¨å®šä¹‰ä¸ºä¸€ç§â€œèµ„æºâ€<br>PVç”±ç®¡ç†å‘˜åˆ›å»ºå’Œé…ç½®<br>PVCåˆ™æ˜¯ç”¨æˆ·å¯¹å­˜å‚¨èµ„æºçš„ä¸€ä¸ªâ€œç”³è¯·â€å°±åƒPodæ¶ˆè´¹Nodeçš„èµ„æºä¸€æ ·ï¼Œ<br>PVCèƒ½å¤Ÿ&quot;æ¶ˆè´¹&quot;PVèµ„æºPVCå¯ä»¥ç”³è¯·ç‰¹å®šçš„å­˜å‚¨ç©ºé—´å’Œè®¿é—®æ¨¡å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å°±ç›®å‰è€Œè¨€ï¼ŒæŒ‚è½½é‚£å°NFSä¸»æœºç£ç›˜æœ‰å¤šå¤§ï¼Œå°±èƒ½å‚¨å­˜å¤šå¤§ï¼Œå¯¹å ç”¨æ²¡æœ‰åšé™åˆ¶ï¼Œ</span><br><span class="line"></span><br><span class="line">PV,å¯ä»¥ç†è§£ä¸ºnfså‚¨å­˜ï¼Œä¸€å…±20Gï¼ŒPVå°±æ˜¯åˆ’åˆ†ç£ç›˜ç©ºé—´çš„ä¸œè¥¿ï¼Œç»™å‚¨å­˜èµ„æºåˆ’åˆ†ç©ºé—´ï¼Œåˆ’åˆ†2Gä¸€å—ï¼Œ3Gä¸€å—...</span><br><span class="line"></span><br><span class="line">PVC,è¿™ä¸ªå‚¨å­˜æ˜¯ä¸€ä¸ªå¤§çš„å›­åŒºï¼Œå¼€å‘å•†æŠŠå›­åŒºå¼€å‘æˆæˆ¿å­ï¼ŒPVCå°±æ˜¯è´­ä¹°åˆ«å¢…çš„äººï¼Œæƒ³è¦å¤šå¤§ï¼Œå°±ç”³è¯·å¤šå¤§(ç”³è¯·PVåˆ’åˆ†çš„èµ„æºç©ºé—´)ï¼Œ</span><br><span class="line"></span><br><span class="line">PVåˆ’åˆ†å‚¨å­˜ï¼ŒPVCç»‘å®šPV,podä½¿ç”¨æŒ‡å®šçš„PVC</span><br></pre></td></tr></table></figure><p>pvå’ŒPVCçš„ç”Ÿå‘½å‘¨æœŸ</p><p><img src="../image/study_img/image-20240925102733528.png" alt="image-20240925102733528"></p><p>PVå’ŒPVCéœ€è¦æ³¨æ„çš„åœ°æ–¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åœ¨PVçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¯èƒ½ä¼šå¤„äº4ç§ä¸åŒçš„é˜¶æ®µ:</span><br><span class="line"></span><br><span class="line">Avaliable(å¯ç”¨)ï¼šè¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½•PVCç»‘å®š</span><br><span class="line">Bound(è¢«ç»‘å®šçš„)ï¼šè¡¨ç¤ºPVå·²ç»è¢«PVCç»‘å®š</span><br><span class="line">Released(å·²é‡Šæ”¾)ï¼šPVCè¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜ï¼Œè¢«é‡Šæ”¾äº†ï¼Œé‡Œé¢è¿˜æœ‰æ•°æ®åœ¨ï¼Œéœ€è¦æŠŠæ•°æ®åˆ é™¤æˆ–è€…å¤‡ä»½ï¼Œå†æŠŠè¿™ä¸ªpvåˆ é™¤ï¼Œé‡å¯èµ·æ¥ï¼Œå°±ä¼šå˜æˆAvaliableçŠ¶æ€</span><br><span class="line">Failed(å¤±è´¥)ï¼šè¡¨ç¤ºè¯¥PVçš„è‡ªåŠ¨å›æ”¶å¤±è´¥</span><br></pre></td></tr></table></figure><p>PVCç»‘å®šPVçš„æ¡ä»¶å¦‚ä¸‹ï¼š</p><p>åˆ›å»ºPVCä¹‹åï¼Œk8så°±ä¼šå»æŸ¥æ‰¾æ»¡è¶³æˆ‘ä»¬å£°æ˜è¦æ±‚çš„PVæ¯”å¦‚storageClassNameï¼ŒaccessModesä»¥åŠå®¹æ˜¯è¿™äº›æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœæ»¡è¶³è¦æ±‚å°±å°†PVå’ŒPVCç»‘å®šåœ¨ä¸€èµ·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1ã€storageClassName</span><br><span class="line">2ã€accessModes</span><br><span class="line">3ã€size</span><br></pre></td></tr></table></figure><p><font color=red>éœ€è¦æ³¨æ„çš„æ˜¯ç›®å‰PVå’ŒPVCä¹‹é—´æ˜¯ä¸€å¯¹ä¸€ç»‘å®šçš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªPVåªèƒ½è¢«ä¸€ä¸ªPVCç»‘å®šã€‚</font>&gt;</p><p><img src="../image/study_img/image-20240925103145263.png" alt="image-20240925103145263"></p><h3 id="6ã€PVã€PVCçš„èµ„æºæ¸…å•"><strong>6ã€PVã€PVCçš„èµ„æºæ¸…å•</strong></h3><p>PVèµ„æºå…³é”®å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">capacity: PVå­˜å‚¨çš„å®¹é‡</span><br><span class="line">capacity: 5Gi <span class="comment">#åˆ’åˆ†ç£ç›˜ç©ºé—´5G</span></span><br><span class="line"></span><br><span class="line">accessModes: è®¿é—®æ¨¡å¼,k8sæ”¯æŒçš„è®¿é—®æ¨¡å¼å¦‚ä¸‹</span><br><span class="line">------------------------------------------------------</span><br><span class="line">ReadWriteOnce(RWO): è¯»å†™æƒé™ï¼Œå¹¶ä¸”åªèƒ½è¢«å•ä¸ªNodeæŒ‚è½½</span><br><span class="line">ReadOnlyMany(ROX): åªè¯»æƒé™ï¼Œå…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½</span><br><span class="line">ReadWriteMany(RWX): è¯»å†™æƒé™ï¼Œå…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">persistentVolumeReclaimPolicy: èµ„æºå›æ”¶ç­–ç•¥ï¼Œpvcåˆ ä¹‹åæ•°æ®æ˜¯å¦å›æ”¶çš„ç­–ç•¥</span><br><span class="line">------------------------------------------------------</span><br><span class="line">Retain: ä¿ç•™æ•°æ®ï¼Œéœ€è¦æ‰‹å·¥å¤„ç†      </span><br><span class="line">Recycle: ç®€å•æ¸…é™¤æ–‡ä»¶çš„æ“ä½œ(ä¾‹å¦‚è¿è¡Œ<span class="built_in">rm</span> -rf /dada/* å‘½ä»¤)ï¼Œå¦‚æœåˆ é™¤pvc,pvçš„èµ„æºå°±ä¼šè¢«åˆ é™¤é‡Šæ”¾æ‰</span><br><span class="line">Delete: å¦‚æœæŠŠPVCåˆ äº†ï¼ŒPVä¹Ÿä¼šè¢«ä¸€èµ·åˆ é™¤ï¼Œæ•°æ®ä¹Ÿä¼šè¢«æ¸…æ‰(å¾ˆå°‘ç”¨)</span><br><span class="line">ç›®å‰åªæœ‰NFSå’ŒHostPathä¸¤ç§ç±»å‹çš„PVæ”¯æŒRecycleç­–ç•¥ã€‚</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line">storageClassName: å­˜å‚¨ç±»åˆ«</span><br><span class="line">å…·æœ‰ç‰¹å®šç±»åˆ«çš„PVåªèƒ½ä¸è¯·æ±‚äº†è¯¥ç±»åˆ«çš„PVCç»‘å®šã€‚æœªæŒ‡å®šç±»å‹çš„PVåˆ™åªèƒ½å¯¹ä¸ä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„PVCç»‘å®šã€‚</span><br></pre></td></tr></table></figure><p>ç¼–å†™PVèµ„æºæ¸…å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">1 mib =1024 kib</span><br><span class="line">1 gib = 1024 mib</span><br><span class="line"></span><br><span class="line">1ã€ç¼–å†™PVèµ„æºæ¸…å•ï¼Œåˆ’åˆ†5G</span><br><span class="line">[root@master01 kubernetes]# vim pv01.yml </span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;PersistentVolume&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: pv01</span><br><span class="line">spec:</span><br><span class="line">  capacity:</span><br><span class="line">    <span class="comment">#PVç”³è¯·ç£ç›˜ç©ºé—´çš„å¤§å°5G</span></span><br><span class="line">    storage: 5Gi</span><br><span class="line">  <span class="comment">#è®¿é—®æ¨¡å¼ï¼šè¯»å†™æƒé™ï¼Œå¹¶ä¸”åªèƒ½è¢«å•ä¸ªNodeæŒ‚è½½</span></span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  <span class="comment">#å›æ”¶ç­–ç•¥</span></span><br><span class="line">  persistentVolumeReclaimPolicy: Recycle</span><br><span class="line">  storageClassName: pv01-nfs</span><br><span class="line">  nfs:</span><br><span class="line">    path: /data/wp1</span><br><span class="line">    server: 172.16.1.31</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">2ã€ç¼–å†™PVèµ„æºæ¸…å•ï¼Œåˆ’åˆ†3G</span><br><span class="line">[root@master01 kubernetes]# vim pv02.yml </span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;PersistentVolume&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: pv02</span><br><span class="line">spec:</span><br><span class="line">  capacity:</span><br><span class="line">    <span class="comment">#PVç”³è¯·ç£ç›˜ç©ºé—´çš„å¤§å°5G</span></span><br><span class="line">    storage: 4Gi</span><br><span class="line">  <span class="comment">#è®¿é—®æ¨¡å¼ï¼šåªè¯»æƒé™ï¼Œå…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½</span></span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadOnlyMany</span><br><span class="line">  <span class="comment">#å›æ”¶ç­–ç•¥</span></span><br><span class="line">  persistentVolumeReclaimPolicy: Recycle</span><br><span class="line">  storageClassName: pv02-nfs</span><br><span class="line">  nfs:</span><br><span class="line">    path: /data/wp2</span><br><span class="line">    server: 172.16.1.31</span><br><span class="line">    </span><br><span class="line">3ã€ç¼–å†™PVèµ„æºæ¸…å•ï¼Œåˆ’åˆ†5G   </span><br><span class="line">[root@master01 kubernetes]# vim pv03.yml </span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;PersistentVolume&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: pv03</span><br><span class="line">spec:</span><br><span class="line">  capacity:</span><br><span class="line">    <span class="comment">#PVç”³è¯·ç£ç›˜ç©ºé—´çš„å¤§å°5G</span></span><br><span class="line">    storage: 3Gi</span><br><span class="line">  <span class="comment">#è®¿é—®æ¨¡å¼ï¼š(RWX): è¯»å†™æƒé™ï¼Œå…è®¸è¢«å¤šä¸ªNodeæŒ‚è½½</span></span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany</span><br><span class="line">  <span class="comment">#å›æ”¶ç­–ç•¥</span></span><br><span class="line">  persistentVolumeReclaimPolicy: Recycle</span><br><span class="line">  storageClassName: pv03-nfs</span><br><span class="line">  nfs:</span><br><span class="line">    path: /data/wp3</span><br><span class="line">    server: 172.16.1.31</span><br><span class="line"></span><br><span class="line">4ã€è¿è¡Œ</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f pv01.yml     </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f pv02.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f pv03.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pv</span><br><span class="line">NAME   CAPACITY(#pvcç»‘å®šçš„æ¡ä»¶)   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGEC</span><br><span class="line">pv01   5Gi        RWO            Recycle          Available           pv01-nfs</span><br><span class="line">pv02   4Gi        ROX            Recycle          Available           pv02-nfs</span><br><span class="line">pv03   3Gi        RWX            Recycle          Available           pv03-nfs</span><br></pre></td></tr></table></figure><p>ç¼–å†™PVCèµ„æºæ¸…å•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™PVCèµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim pvc01.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: pvc01</span><br><span class="line"><span class="comment">#specé‡Œé¢çš„å†…å®¹å°±æ˜¯è¦å»åŒ¹é…PVçš„</span></span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 4Gi</span><br><span class="line">  storageClassName: pv01-nfs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œ</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f pvc01.yml </span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹PVCå·²ç»ç»‘å®šäº†pv01</span><br><span class="line">[root@master01 kubernetes]# kubectl get pvc</span><br><span class="line">NAME    STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">pvc01   Bound    pv01     5Gi        RWO            pv01-nfs       4m5s</span><br><span class="line"></span><br><span class="line">4ã€pvå·²ç»æ˜¾ç¤ºè¢«ç»‘å®š</span><br><span class="line">[root@master01 kubernetes]# kubectl get pv</span><br><span class="line">NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM           STORAGECLA</span><br><span class="line">pv01   5Gi        RWO            Recycle          Bound       default/pvc01   pv01-nfs  </span><br><span class="line">pv02   4Gi        ROX            Recycle          Available                   pv02-nfs  </span><br><span class="line">pv03   3Gi        RWX            Recycle          Available                   pv03-nfs  </span><br></pre></td></tr></table></figure><h3 id="7ã€Podå…³è”PVC"><strong>7ã€Podå…³è”PVC</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">1ã€åˆ›å»ºwordpress-Deploymentèµ„æº</span><br><span class="line">[root@master01 kubernetes]# vim wp-dp-v2.yml</span><br><span class="line">apiVersion: <span class="string">&quot;apps/v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Deployment&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: wp-dp</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line"><span class="comment">#èµ·2ä¸ªï¼Œæ•°æ®ä¹Ÿæ˜¯2ä¸ªï¼Œé™¤éæŠŠæ•°æ®åˆ†å¼€</span></span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: wp</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: wp-pod</span><br><span class="line">      namespace: default</span><br><span class="line">      labels:</span><br><span class="line">        app: wp</span><br><span class="line">    spec:</span><br><span class="line">    <span class="comment">#æœ€åä¸€è¡ŒæŒ‚è½½ç‚¹çš„åå­—é¸¡è›‹æ›´æ”¹ nfsè¢«pvå’Œpvcç»‘å®šäº†ï¼Œæ‰€ä»¥podè‡ªå·±ç”¨pvcèµ„æº</span></span><br><span class="line">      volumes:</span><br><span class="line">      - name: wp-pvc</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">        <span class="comment">#è¿™ä¸ªæ˜¯pvcçš„åå­—</span></span><br><span class="line">          claimName: pvc01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      containers:</span><br><span class="line">      - name: wp-container</span><br><span class="line">        image: wordpress</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="comment">#livenessProbe:</span></span><br><span class="line">        <span class="comment">#  tcpSocket:</span></span><br><span class="line">        <span class="comment">#    port: 80</span></span><br><span class="line">        <span class="comment">#  initialDelaySeconds: 10</span></span><br><span class="line">        <span class="comment">#  periodSeconds: 3</span></span><br><span class="line">        <span class="comment">#  timeoutSeconds: 3</span></span><br><span class="line">        <span class="comment">#  failureThreshold: 3</span></span><br><span class="line">        <span class="comment">#readinessProbe:</span></span><br><span class="line">        <span class="comment">#  tcpSocket:</span></span><br><span class="line">        <span class="comment">#    host: mysql-svc</span></span><br><span class="line">        <span class="comment">#    port: 3306</span></span><br><span class="line">        <span class="comment">#  initialDelaySeconds: 3</span></span><br><span class="line">        <span class="comment">#  timeoutSeconds: 1</span></span><br><span class="line">        <span class="comment">#  periodSeconds: 2</span></span><br><span class="line">        <span class="comment">#  successThreshold: 3</span></span><br><span class="line">        <span class="comment">#  failureThreshold: 3</span></span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&#x27;mysql-svc&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_USER</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_NAME</span><br><span class="line">          value: <span class="string">&#x27;wp_db&#x27;</span></span><br><span class="line">        </span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: wp-pvc</span><br><span class="line">          mountPath: /var/www/html/</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œ</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f wp-dp-v2.yml</span><br><span class="line"></span><br><span class="line">3ã€åˆ°nfsæœºå™¨æŸ¥çœ‹æŒ‚è½½æˆåŠŸ</span><br><span class="line">[root@nfs ~]# ll /data/wp1/</span><br><span class="line">-rw-r--r--  1 nfsnobody nfsnobody   405 Feb  6  2020 index.php</span><br><span class="line">-rw-r--r--  1 nfsnobody nfsnobody 19915 Jan  1  2024 license.txt</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240928181611313.png" alt="image-20240928181611313"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰10ã€Kubernetesé…ç½®æ–‡ä»¶ç®¡ç†ConfigMap</title>
      <link href="/posts/b63dfd70.html"/>
      <url>/posts/b63dfd70.html</url>
      
        <content type="html"><![CDATA[<h2 id="Kubernetesé…ç½®æ–‡ä»¶ç®¡ç†ConfigMap">Kubernetesé…ç½®æ–‡ä»¶ç®¡ç†ConfigMap</h2><h3 id="1ã€ConfigMapçš„ä»‹ç»"><strong>1ã€ConfigMapçš„ä»‹ç»</strong></h3><p>ä½œç”¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å°†é…ç½®æ–‡ä»¶å’ŒPodè§£å¶ï¼Œæ–¹ä¾¿ç®¡ç†é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>ConfigMapé‡Œçš„é…ç½®æ–‡ä»¶å¦‚ä½•å‚¨å­˜çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–¹æ³•ä¸€</span></span><br><span class="line">é”®å€¼å¯¹çš„æ–¹å¼ï¼š </span><br><span class="line">key:value</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼š</span></span><br><span class="line">æ–‡ä»¶å:é…ç½®æ–‡ä»¶çš„å†…å®¹</span><br></pre></td></tr></table></figure><p>ConfigMapæ”¯æŒçš„é…ç½®ç±»å‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç›´æ¥å®šä¹‰é”®å€¼å¯¹</span><br><span class="line">2ã€åŸºäºæ–‡ä»¶åˆ›å»ºçš„é”®å€¼å¯¹</span><br></pre></td></tr></table></figure><p>ConfigMapåˆ›å»ºæ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1ã€å‘½ä»¤è¡Œ</span><br><span class="line">2ã€èµ„æºæ¸…å•</span><br></pre></td></tr></table></figure><p>ConfigMapçš„é…ç½®æ–‡ä»¶å¦‚ä½•ä¼ é€’åˆ°podé‡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1ã€å˜é‡ä¼ é€’    (åªæ˜¯ç¯å¢ƒå˜é‡ï¼Œåˆä¸ä¼šæ”¹å˜é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥æ¯«æ— æ„ä¹‰)</span><br><span class="line">2ã€æ•°æ®å·æŒ‚è½½</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Configmapçš„é™åˆ¶æ¡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1ã€ConfigMapå¿…é¡»åœ¨podä¹‹å‰åˆ›å»ºï¼Œpodæ‰èƒ½å¼•ç”¨</span><br><span class="line">2ã€ConfigMapå—é™äºåç§°ç©ºé—´çš„é™åˆ¶ï¼Œåªæœ‰å¤„äºåŒä¸€ä¸ªåç§°ç©ºé—´çš„podæ‰å¯ä»¥è¢«å¼•ç”¨</span><br></pre></td></tr></table></figure><h3 id="2ã€å‘½ä»¤è¡Œåˆ›å»ºConfigMap"><strong>2ã€å‘½ä»¤è¡Œåˆ›å»ºConfigMap</strong></h3><p>æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œåˆ›å»ºé”®å€¼å¯¹Keyï¼švalueçš„å‚¨å­˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">[root@master01 kubernetes]# kubectl create configmap --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºconfigmap</span><br><span class="line">[root@master01 kubernetes]# kubectl create configmap nginx-config --from-literal=nginx_port=80 --from-literal=server_name=blog.test.com</span><br><span class="line"></span><br><span class="line">--from-literalï¼šåˆ›å»ºé”®å€¼å¯¹çš„key=value</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl get cm</span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">nginx-config   2      67s</span><br><span class="line"></span><br><span class="line">ConfigMapçš„åå­—ï¼šnginx-configï¼Œé‡Œé¢æœ‰2æ¡æ•°æ®</span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span><br><span class="line">[root@master01 kubernetes]# kubectl describe cm nginx-config </span><br><span class="line">Name:         nginx-config</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">nginx_port:</span><br><span class="line">----</span><br><span class="line">80</span><br><span class="line">server_name:</span><br><span class="line">----</span><br><span class="line">blog.test.com</span><br><span class="line">Events:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºè¿™ç§é”®å€¼å¯¹çš„æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºé…ç½®æ–‡ä»¶å¾ˆå°‘æ˜¯é”®å€¼å¯¹çš„</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€å¼•ç”¨ConfigMapï¼Œå¦‚æœpodæƒ³è¦å¼•ç”¨ä¸Šé¢çš„ConfigMapï¼Œåªèƒ½é€šè¿‡ç¯å¢ƒå˜é‡çš„å½¢å¼</span><br></pre></td></tr></table></figure><p>é€šè¿‡å˜é‡ä¼ é€’åˆ°pod</p><p><img src="../image/study_img/image-20240928205743737.png" alt="image-20240928205743737"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# vim nginx-cm.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-cm</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-pod</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: NGINX_PORT</span><br><span class="line">      valueFrom:</span><br><span class="line">        configMapKeyRef:</span><br><span class="line">          name: nginx-config</span><br><span class="line">          key: nginx_port</span><br><span class="line"></span><br><span class="line">    - name: SERVER_NAME</span><br><span class="line">      valueFrom:</span><br><span class="line">        configMapKeyRef:</span><br><span class="line">          name: nginx-config</span><br><span class="line">          key: server_name</span><br><span class="line"></span><br><span class="line">6ã€å¯åŠ¨pod</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-cm.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">NAME                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-cm                   1/1     Running   0          9s</span><br><span class="line"></span><br><span class="line">7ã€è¿›å…¥podï¼ŒæŸ¥çœ‹podå·²ç»å¼•å…¥äº†å˜é‡</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it nginx-cm -- /bin/sh</span><br><span class="line">/ <span class="comment"># echo $NGINX_PORT</span></span><br><span class="line">80</span><br><span class="line">/ <span class="comment"># echo $SERVER_NAME</span></span><br><span class="line">blog.test.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#è™½ç„¶è¿™ä¸¤ä¸ªå˜é‡ä¼ è¿›æ¥äº†ï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶å¹¶æ²¡æœ‰æ”¹å˜ï¼Œå› ä¸ºä»–ä¸çŸ¥é“ä¼šä¼ åˆ°å“ªä¸ªé…ç½®æ–‡ä»¶ï¼Œæ²¡é‚£ä¹ˆæ™ºèƒ½ï¼Œåªæ˜¯ä¼ é€’å˜é‡</span></span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šåŸºäºæ–‡ä»¶å½¢å¼åˆ›å»ºConfigMap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1ã€åˆ›å»ºé…ç½®æ–‡ä»¶</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> &gt; www.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">server &#123;</span></span><br><span class="line"><span class="string">    listen 80;</span></span><br><span class="line"><span class="string">    server_name blog.test.com;</span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">        root /usr/share/nginx/html/www;</span></span><br><span class="line"><span class="string">        index index.html index.htm;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">2ã€å‘½ä»¤è¡Œåˆ›å»ºConfigMapèµ„æº</span><br><span class="line">kubectl create configmap [è‡ªå®šä¹‰çš„ConfigMapåå­—]  --from-file=[è‡ªå®šä¹‰çš„keyåå­—]=[é…ç½®æ–‡ä»¶è·¯å¾„]</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl create configmap nginx-www  --from-file=test-www=./www.conf</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹cmèµ„æº</span><br><span class="line">[root@master01 kubernetes]# kubectl get cm</span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">nginx-www      1      117s</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240928214603450.png" alt="image-20240928214603450"></p><ul><li>é€šè¿‡æŒ‚è½½å·ä¼ é€’åˆ°pod</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# vim nginx-cm.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-cm-v1</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data-configmap</span><br><span class="line">    configMap:</span><br><span class="line">      name: nginx-www</span><br><span class="line">      items:</span><br><span class="line">      - key: test-www</span><br><span class="line">        path: wordpress.conf</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-pod</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data-configmap</span><br><span class="line">      mountPath: /etc/nginx/conf.d/</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240928221503694.png" alt="image-20240928221503694"></p><ul><li>ä¸€æ¬¡æ€§åˆ›å»ºConfigMapçš„2ä¸ªkey</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1ã€å‡†å¤‡é…ç½®æ–‡ä»¶</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> &gt; wp.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">server &#123;</span></span><br><span class="line"><span class="string">    listen 80;</span></span><br><span class="line"><span class="string">    server_name www.wp.com;</span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">        root /usr/share/nginx/html/www;</span></span><br><span class="line"><span class="string">        index index.html index.htm;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cat</span> &gt; wc.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">server &#123;</span></span><br><span class="line"><span class="string">    listen 90;</span></span><br><span class="line"><span class="string">    server_name www.wc.com;</span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">        root /usr/share/nginx/html/www;</span></span><br><span class="line"><span class="string">        index index.html index.htm;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">2ã€å‘½ä»¤è¡Œåˆ›å»ºConfigMap</span><br><span class="line">[root@master01 kubernetes]# kubectl create configmap wp-wc-conf  --from-file=wp-conf=./wp.conf --from-file=wc-conf=./wc.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹</span><br><span class="line">[root@master01 ~]# kubectl get cm</span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">nginx-config   2      126m</span><br><span class="line">nginx-www      1      45m</span><br><span class="line">wp-wc-conf     2      112s</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240928223040756.png" alt="image-20240928223040756"></p><p>ä¸€æ¬¡æ€§æŒ‚è½½2ä¸ªæ–‡ä»¶è¿›å»</p><p><img src="../image/study_img/image-20240928225407162.png" alt="image-20240928225407162"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]#  vim wp-wc-configmap.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wp-wc-cm</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: wp-wc-configmap</span><br><span class="line">    configMap:</span><br><span class="line">      name: wp-wc-conf</span><br><span class="line">      items:</span><br><span class="line">      - key: wp-conf</span><br><span class="line">        path: wordpress.conf</span><br><span class="line">      - key: wc-conf</span><br><span class="line">        path: wecenter.conf</span><br><span class="line"></span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-pod</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: wp-wc-configmap</span><br><span class="line">      mountPath: /etc/nginx/conf.d/</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œï¼Œå¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]#  kubectl apply -f wp-wc-configmap.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">NAME                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">wp-wc-cm                   1/1     Running   0          5s</span><br><span class="line"></span><br><span class="line">3ã€è¿›å…¥podæŸ¥çœ‹æŒ‚è½½æˆåŠŸ</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it wp-wc-cm -- /bin/sh</span><br><span class="line">/ <span class="comment"># ls -l /etc/nginx/conf.d/</span></span><br><span class="line">lrwxrwxrwx    1 root     root            20 Sep 28 14:41 wecenter.conf -&gt; ..data/wecenter.conf</span><br><span class="line">lrwxrwxrwx    1 root     root            21 Sep 28 14:41 wordpress.conf -&gt; ..data/wordpress.conf</span><br><span class="line">/ <span class="comment"># cat /etc/nginx/conf.d/wecenter.conf &amp;&amp; cat /etc/nginx/conf.d/wordpress.conf </span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 90;</span><br><span class="line">    server_name www.wc.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html/www;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name www.wp.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html/www;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•åŠ¨æ€ä¿®æ”¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# kubectl get cm</span><br><span class="line">NAME           DATA   AGE</span><br><span class="line">wp-wc-conf     2      30m</span><br><span class="line"></span><br><span class="line">1ã€ä¿®æ”¹</span><br><span class="line">[root@master01 kubernetes]# kubectl edit cm wp-wc-conf</span><br><span class="line">        listen 91;</span><br><span class="line">......</span><br><span class="line">        listen 81;</span><br><span class="line">        </span><br><span class="line">2ã€å†æ¬¡è¿›å…¥å®¹å™¨å†…è§‚å¯Ÿä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it wp-wc-cm -- /bin/sh</span><br><span class="line">/ <span class="comment"># cat /etc/nginx/conf.d/wecenter.conf &amp;&amp; cat /etc/nginx/conf.d/wordpress.conf </span></span><br><span class="line"></span><br><span class="line">3ã€ä½†æ˜¯ç«¯å£æ²¡æœ‰å˜</span><br><span class="line">/ <span class="comment">#  netstat -lntup</span></span><br><span class="line">tcp        0      0 0.0.0.0:80 </span><br><span class="line">tcp        0      0 0.0.0.0:90</span><br><span class="line"></span><br><span class="line">4ã€éœ€è¦é‡å¯æœåŠ¡æ‰å¯ä»¥ç”Ÿæ•ˆï¼Œéœ€è¦åˆ é™¤èµ„æºå†é‡å¯ï¼Œå¦‚æœæ˜¯podèµ„æºå°±ä¸èƒ½åˆ é™¤é‡å¯ï¼Œpodèµ„æºå°±åˆ é™¤ï¼Œé‡æ–°åº”ç”¨ä¸€ä¸‹</span><br><span class="line">[root@master01 kubernetes]#  kubectl delete -f wp-wc-configmap.yml</span><br><span class="line">[root@master01 kubernetes]#  kubectl apply -f wp-wc-configmap.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it wp-wc-cm -- /bin/sh</span><br><span class="line">/ <span class="comment"># netstat -lntup      </span></span><br><span class="line">tcp        0      0 0.0.0.0:81              0.0.0.0:*             </span><br><span class="line">tcp        0      0 0.0.0.0:91              0.0.0.0:*            </span><br><span class="line"><span class="comment"># åŠ¨æ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯æ— æ³•é‡æ–°åŠ è½½æœåŠ¡ ï¼ˆæœ‰ä¸€äº›ä¼ä¸šç”¨NacosæœåŠ¡ï¼šé…ç½®ç®¡ç†ä¸­å¿ƒï¼Œæ”¹å®Œäº†å°±å¸®ä½ é‡æ–°åŠ è½½æœåŠ¡ï¼‰</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä»¥ä¸Šæ“ä½œæŠŠé…ç½®æ–‡ä»¶æŒ‚åˆ°podé‡Œé¢äº†ï¼Œéœ€è¦å…ˆå‡†å¤‡é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯è¿˜æœ‰ç¼ºé™·ï¼Œéœ€è¦æå‰å‡†å¤‡é…ç½®æ–‡ä»¶</span><br><span class="line">ä½†æœ‰çš„èµ„æºæ¸…å•ï¼Œæ¯”å¦‚kube-flannelï¼Œæ²¡æœ‰å‡†å¤‡é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨èµ„æºæ¸…å•åˆ›å»ºConfigMapå°±ä¸éœ€è¦æå‰å‡†å¤‡</span><br></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨èµ„æºæ¸…å•åˆ›å»ºconfigmap"><strong>3ã€ä½¿ç”¨èµ„æºæ¸…å•åˆ›å»ºconfigmap</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">ä¸ºé¿å…å†²çªï¼Œåˆ é™¤ä¸Šæ¬¡å®éªŒåˆ›å»ºçš„cmå’Œpod</span><br><span class="line"></span><br><span class="line">1ã€åˆ›å»ºèµ„æºæ¸…å•</span><br><span class="line">root@master01 kubernetes]# vim wp-wc-configmap.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: wp-wc-conf</span><br><span class="line">  namespace: default</span><br><span class="line">data:</span><br><span class="line">  wp-key: |</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 88;</span><br><span class="line">        server_name www.wwpp.com;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /usr/share/nginx/html/www;</span><br><span class="line">            index index.html index.htm;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  wc-key: |</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 99;</span><br><span class="line">        server_name www.wwcc.com;</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /usr/share/nginx/html/www;</span><br><span class="line">            index index.html index.htm;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wp-wc-cm2</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: wp-wc-configmap</span><br><span class="line">    configMap:</span><br><span class="line">      name: wp-wc-conf</span><br><span class="line">      items:</span><br><span class="line">      - key: wp-key</span><br><span class="line">        path: wordpress.conf</span><br><span class="line">      - key: wc-key</span><br><span class="line">        path: wecenter.conf</span><br><span class="line"></span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-pod</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: wp-wc-configmap</span><br><span class="line">      mountPath: /etc/nginx/conf.d/</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œï¼Œå¹¶ä¸”æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span><br><span class="line">root@master01 kubernetes]# kubectl apply -f wp-wc-configmap.yml </span><br><span class="line">configmap/wp-wc-conf created</span><br><span class="line">pod/wp-wc-cm2 created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">NAME                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">wp-wc-cm2                  1/1     Running   0          2m42s</span><br><span class="line">[root@master01 kubernetes]# kubectl get cm</span><br><span class="line">NAME         DATA   AGE</span><br><span class="line">wp-wc-conf   2      21s</span><br><span class="line">[root@master01 kubernetes]# kubectl describe cm wp-wc-conf</span><br><span class="line">Name:         wp-wc-conf</span><br><span class="line">Namespace:    default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">wc-key:</span><br><span class="line">----</span><br><span class="line">server &#123;</span><br><span class="line">    listen 99;</span><br><span class="line">    server_name www.wwcc.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html/www;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">wp-key:</span><br><span class="line">----</span><br><span class="line">server &#123;</span><br><span class="line">    listen 88;</span><br><span class="line">    server_name www.wwpp.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html/www;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€è¿›å…¥å®¹å™¨å¹¶æŸ¥çœ‹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@master01 ~]# kubectl <span class="built_in">exec</span> -it wp-wc-cm2 -- /bin/sh</span><br><span class="line">/# <span class="built_in">cat</span> /etc/nginx/conf.d/wecenter.conf &amp;&amp; <span class="built_in">cat</span> /etc/nginx/conf.d/wordpress.conf </span><br><span class="line">/# netstat -lntup</span><br><span class="line">tcp        0      0 0.0.0.0:88</span><br><span class="line">tcp        0      0 0.0.0.0:99</span><br><span class="line"></span><br><span class="line">4ã€åŠ¨æ€ä¿®æ”¹èƒ½å¤Ÿä¿®æ”¹ï¼Œä½†æ˜¯ä¸ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure><h3 id="4ã€wordpressç»¼åˆç»ƒä¹ "><strong>4ã€wordpressç»¼åˆç»ƒä¹ </strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## wordpress è¦è¿è¡Œåœ¨k8sä¸­</span></span><br><span class="line"><span class="comment">## MySQL</span></span><br><span class="line">1.åç§°ç©ºé—´ï¼š blog</span><br><span class="line">2.é•œåƒmysql:5.7</span><br><span class="line">3.ç¯å¢ƒå˜é‡</span><br><span class="line">        - rootå¯†ç ï¼š123</span><br><span class="line">        - æ•°æ®åº“ï¼šwordpress</span><br><span class="line">        - ç”¨æˆ·ï¼šwordpress</span><br><span class="line">        - å‚æ•°ï¼šå­—ç¬¦é›†</span><br><span class="line">4.æ•°æ®æŒä¹…åŒ–ï¼šåœ¨å®¿ä¸»æœºçš„/data/mysql/data</span><br><span class="line"></span><br><span class="line"><span class="comment">## mysql-svcéœ€æ±‚</span></span><br><span class="line">åç§°ç©ºé—´ï¼šblog</span><br><span class="line"></span><br><span class="line"><span class="comment">## wordpresséœ€æ±‚</span></span><br><span class="line">å‰¯æœ¬æ•°ä¸º:2</span><br><span class="line">é•œåƒï¼šwordpress:latest</span><br><span class="line">æ•°æ®åº“åœ°å€ï¼šcluster ip</span><br><span class="line">æ•°æ®åº“åç§°ï¼šwordpress</span><br><span class="line">ç”¨æˆ·ï¼šwordpress</span><br><span class="line"></span><br><span class="line">******** ä½¿ç”¨NFSæŒä¹…åŒ–æ•°æ®ï¼Œå®¿ä¸»æœºï¼š/data/wordpress/data 10.0.0.31</span><br><span class="line"></span><br><span class="line">mysql deployment</span><br><span class="line">mysql clusterip</span><br><span class="line">wordpress deployment</span><br><span class="line">wordpress clusterip</span><br><span class="line">wordpress ingress</span><br><span class="line">wordpress hpa</span><br></pre></td></tr></table></figure><p>èµ„æºæ¸…å•å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="comment"># åç§°ç©ºé—´</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: blog</span><br><span class="line">---</span><br><span class="line"><span class="comment"># mysqlçš„PVèµ„æº</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-pv</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: mysql-hostpath</span><br><span class="line">  persistentVolumeReclaimPolicy: Retain</span><br><span class="line">  accessModes:</span><br><span class="line">  - ReadWriteOnce</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 5Gi</span><br><span class="line">  hostPath:</span><br><span class="line">    path: /data/wp-db</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment"># mysqlçš„pvcèµ„æº</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-pvc</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: mysql-pvc</span><br><span class="line">  accessModes:</span><br><span class="line">  - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 5Gi</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment"># mysqlçš„deployèµ„æº</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-deploy</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      run: mysql-deploy</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      name: mysql-pod</span><br><span class="line">      namespace: blog</span><br><span class="line">      labels:</span><br><span class="line">        run: mysql-deploy</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: db-pvc</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          claimName: mysql-pvc</span><br><span class="line">      containers:</span><br><span class="line">      - name: mysql-container</span><br><span class="line">        image: mysql:5.7</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        livenessProbe:</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 3306</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          initialDelaySeconds: 5</span><br><span class="line">          periodSeconds: 1</span><br><span class="line">          timeoutSeconds: 10</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        - name: MYSQL_DATABASE</span><br><span class="line">          value: <span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">        - name: MYSQL_USER</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: MYSQL_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: db-pvc</span><br><span class="line">          mountPath: /var/lib/mysql</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment"># mysqlçš„serviceèµ„æº</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: mysql-service</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    run: mysql-deploy</span><br><span class="line">  ports:</span><br><span class="line">  - name: mysql</span><br><span class="line">    protocol: TCP</span><br><span class="line">    port: 3306</span><br><span class="line">    targetPort: 3306</span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment"># wordpressçš„PVèµ„æº</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-pv</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  storageClassName: wordpress-nfs</span><br><span class="line">  persistentVolumeReclaimPolicy: Retain</span><br><span class="line">  accessModes:</span><br><span class="line">  - ReadWriteOnce</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 5Gi</span><br><span class="line">  nfs:</span><br><span class="line">    path: /data/wp</span><br><span class="line">    server: 172.16.1.31</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment">#wordpressçš„PVC</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-pvc</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">  - ReadWriteOnce</span><br><span class="line">  storageClassName: wordpress-nfs</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 5Gi</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment"># wordpressçš„deploymentçš„èµ„æº</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-deploy</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      run: wordpress-deploy</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        run: wordpress-deploy</span><br><span class="line">      name: wordpress-pod </span><br><span class="line">      namespace: blog</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: web-pvc</span><br><span class="line">        persistentVolumeClaim:</span><br><span class="line">          claimName: wordpress-pvc</span><br><span class="line">      containers:</span><br><span class="line">      - name: wordpress-container</span><br><span class="line">        image: wordpress</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        <span class="comment">#livenessProbe:</span></span><br><span class="line">        <span class="comment">#  httpGet:</span></span><br><span class="line">        <span class="comment">#    path: /</span></span><br><span class="line">        <span class="comment">#    port: 80</span></span><br><span class="line">        <span class="comment">#  failureThreshold: 3</span></span><br><span class="line">        <span class="comment">#  initialDelaySeconds: 5</span></span><br><span class="line">        <span class="comment">#  periodSeconds: 1</span></span><br><span class="line">        <span class="comment">#  timeoutSeconds: 10</span></span><br><span class="line">        readinessProbe:</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 3306</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          initialDelaySeconds: 3</span><br><span class="line">          periodSeconds: 1</span><br><span class="line">          successThreshold: 3</span><br><span class="line">          timeoutSeconds: 10</span><br><span class="line">        <span class="built_in">env</span>:</span><br><span class="line">        - name: WORDPRESS_DB_HOST</span><br><span class="line">          value: <span class="string">&#x27;mysql-service&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_USR</span><br><span class="line">          value: <span class="string">&#x27;wp_user&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_DATABASE</span><br><span class="line">          value: <span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">        - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">          value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: web-pvc</span><br><span class="line">          mountPath: /var/www/html</span><br><span class="line">---</span><br><span class="line"><span class="comment"># wordpressçš„serviceèµ„æº</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-service</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    run: wordpress-deploy</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">  <span class="built_in">type</span>: ClusterIP  </span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment"># wordpressçš„HPAèµ„æº</span></span><br><span class="line">apiVersion: autoscaling/v1</span><br><span class="line">kind: HorizontalPodAutoscaler</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-hpa</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  maxReplicas: 10</span><br><span class="line">  minReplicas: 2</span><br><span class="line">  scaleTargetRef:</span><br><span class="line">    apiVersion: apps/v1</span><br><span class="line">    kind: Deployment</span><br><span class="line">    name: wordpress-deploy</span><br><span class="line">  targetCPUUtilizationPercentage: 50</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"><span class="comment"># wordpressçš„ingressèµ„æº</span></span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: wordpress-ingress</span><br><span class="line">  namespace: blog</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">    - host: wp.web.com</span><br><span class="line">      http:</span><br><span class="line">        paths:</span><br><span class="line">        - path: /</span><br><span class="line">          pathType: Prefix</span><br><span class="line">          backend:</span><br><span class="line">            service:</span><br><span class="line">              name: wordpress-service</span><br><span class="line">              port:</span><br><span class="line">                number: 80</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰11ã€K8sèµ„æºé™åˆ¶å’ŒPrometheusç›‘æ§</title>
      <link href="/posts/aef7182b.html"/>
      <url>/posts/aef7182b.html</url>
      
        <content type="html"><![CDATA[<h2 id="K8sèµ„æºé™åˆ¶å’ŒPrometheusç›‘æ§">K8sèµ„æºé™åˆ¶å’ŒPrometheusç›‘æ§</h2><h3 id="1ã€K8sé‡Œçš„Podèµ„æºé™åˆ¶"><strong>1ã€K8sé‡Œçš„Podèµ„æºé™åˆ¶</strong></h3><p>èµ„æºé™åˆ¶çš„èµ„æºæ¸…å•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1ã€èµ„æºæ¸…å•çš„ç¼–å†™</span><br><span class="line">[root@master01 kubernetes]# vim limit.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: resource-demo</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: resource-demo</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    resources:</span><br><span class="line">    <span class="comment">#æœ€å°çš„éœ€æ±‚</span></span><br><span class="line">      requests:</span><br><span class="line">      <span class="comment">#å†…å­˜æœ€å°éœ€æ±‚</span></span><br><span class="line">        memory: 50Mi</span><br><span class="line">      <span class="comment">#cpuçš„æœ€å°éœ€æ±‚</span></span><br><span class="line">        cpu: 200m</span><br><span class="line">      <span class="comment">#é™åˆ¶å ç”¨ç£ç›˜æœ€å°éœ€æ±‚</span></span><br><span class="line">        <span class="comment">#storage: 3Gi</span></span><br><span class="line">      <span class="comment">#æœ€å¤§éœ€æ±‚</span></span><br><span class="line">      limits:</span><br><span class="line">        memory: 100Mi</span><br><span class="line">        cpu: 1500m</span><br><span class="line">        <span class="comment">#storage: 5Gi</span></span><br><span class="line">        </span><br><span class="line">2ã€è¿è¡Œ</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f limit.yaml</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requestsï¼šèŠ‚ç‚¹æ‰€éœ€çš„æœ€å°è®¡ç®—èµ„æºï¼Œk8sè°ƒåº¦çš„æ—¶å€™çš„ä¾æ®å€¼</span><br><span class="line"></span><br><span class="line">limitsï¼šé™åˆ¶å…è®¸çš„æœ€å¤§è®¡ç®—èµ„æºï¼ŒçœŸæ­£çš„èµ„æºé™åˆ¶å‚æ•°</span><br></pre></td></tr></table></figure><p>æ•°å€¼è½¬æ¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 CPU = 1000m     mæ˜¯æ¯«æ ¸</span><br><span class="line">0.5 CPU = 500m</span><br><span class="line">1 Mib = 1024 Kib</span><br><span class="line">1 MB = 1000 KB</span><br></pre></td></tr></table></figure><p>éªŒè¯æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">docker inspect å®¹å™¨ID | grep CgroupParent</span><br><span class="line"><span class="built_in">cd</span> /sys/fs/cgroup/cpu/kubepods.slice/kubepods-burstable.slice/è¿‡æ»¤å‡ºæ¥çš„ç»“æœ</span><br><span class="line"><span class="built_in">cat</span> cpu.cfs_quota_us</span><br><span class="line"></span><br><span class="line">1ã€æŸ¥çœ‹èµ·åœ¨å“ªä¸ªnode</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE     IP           NODE</span><br><span class="line">resource-demo                   1/1     Running   0          4m19s   10.2.3.114   node03</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹node03ä¸Šçš„å®¹å™¨</span><br><span class="line">[root@node03 ~]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE                                               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">2463239ecc3f        c7b4f26a7d93                                        <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   5 minutes ago       Up 5 minutes                            k8s_resource-demo_resource-demo_default_cb221617-6b64-41d8-83de-d1766988dddd_0</span><br><span class="line"></span><br><span class="line">[root@node03 ~]# docker inspect 2463239ecc3f | grep CgroupParent</span><br><span class="line">            <span class="string">&quot;CgroupParent&quot;</span>: <span class="string">&quot;kubepods-burstable-podcb221617_6b64_41d8_83de_d1766988dddd.slice&quot;</span>,</span><br><span class="line">            </span><br><span class="line">[root@node03 ~]# <span class="built_in">cd</span> /sys/fs/cgroup/cpu/kubepods.slice/kubepods-burstable.slice/kubepods-burstable-podcb221617_6b64_41d8_83de_d1766988dddd.slice</span><br><span class="line"></span><br><span class="line">[root@node03 kubepods-burstable-podcb221617_6b64_41d8_83de_d1766988dddd.slice]# <span class="built_in">cat</span> cpu.cfs_quota_us</span><br><span class="line">150000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœæŸ¥çœ‹åˆ°çš„ç»“æœæ˜¯-1ï¼Œå°±æ˜¯æ²¡åšé™åˆ¶</span></span><br><span class="line">ä¸èƒ½ç›²ç›®çš„åšèµ„æºé™åˆ¶ï¼Œæ‰€ä»¥è¦åšç›‘æ§</span><br></pre></td></tr></table></figure><h3 id="2ã€Prometheusçš„ä»‹ç»"><strong>2ã€Prometheusçš„ä»‹ç»</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   Prometheusæ˜¯ä¸€ä¸ªå¼€æºç³»ç»Ÿç›‘æ§å’Œè­¦æŠ¥å·¥å…·åŒ…ï¼Œæœ€åˆæ˜¯åœ¨SoundCloudä¸Šæ„å»ºçš„ã€‚è‡ª2012å¹´æˆç«‹ä»¥æ¥ï¼Œè®¸å¤šå…¬å¸å’Œç»„ç»‡éƒ½é‡‡ç”¨äº†Prometheusï¼Œè¯¥é¡¹ç›®æ‹¥æœ‰éå¸¸æ´»è·ƒçš„å¼€å‘è€…å’Œç”¨æˆ·ç¤¾åŒºã€‚</span><br><span class="line">   </span><br><span class="line">Prometheusç°åœ¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¼€æºé¡¹ç›®ï¼Œç‹¬ç«‹äºä»»ä½•å…¬å¸è¿›è¡Œç»´æŠ¤ã€‚ä¸ºäº†å¼ºè°ƒè¿™ä¸€ç‚¹ï¼Œå¹¶æ¾„æ¸…é¡¹ç›®çš„æ²»ç†ç»“æ„ï¼ŒPrometheusäº2016å¹´åŠ å…¥äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼Œä½œä¸ºç»§Kubernetesä¹‹åçš„ç¬¬äºŒä¸ªæ‰˜ç®¡é¡¹ç›®ã€‚</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç†è§£Prometheusæ˜¯ä¸€ä¸ªç›‘æ§ç³»ç»ŸåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®åº“ã€‚</span><br><span class="line"></span><br><span class="line">æ¨èé˜…è¯»:</span><br><span class="line">    å®˜ç½‘åœ°å€ï¼šhttps://prometheus.io</span><br><span class="line">    å®˜æ–¹æ–‡æ¡£ï¼šhttps://prometheus.io/docs/introduction/overview/</span><br><span class="line">    GitHubåœ°å€ï¼šhttps://github.com/prometheus</span><br><span class="line">    æ¶æ„å›¾åœ°å€ï¼šhttps://prometheus.io/docs/introduction/overview/</span><br></pre></td></tr></table></figure><h3 id="3ã€Prometheusæ¶æ„"><strong>3ã€Prometheusæ¶æ„</strong></h3><p><img src="../image/study_img/image-20240926113735188.png" alt="image-20240926113735188"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå±•ç¤ºäº†æ™®ç½—ç±³ä¿®æ–¯(prometheus)çš„å»ºç­‘å’Œå®ƒçš„ä¸€äº›ç”Ÿæ€ç³»ç»Ÿç»„æˆéƒ¨åˆ†ã€‚</span><br><span class="line">(1)Prometheus server:</span><br><span class="line">    prometheusçš„æœåŠ¡ç«¯ï¼Œè´Ÿè´£æ”¶é›†æŒ‡æ ‡å’Œå­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®ï¼Œå¹¶æä¾›æŸ¥è¯¢æ¥å£ã€‚</span><br><span class="line"></span><br><span class="line">(2)exporters:</span><br><span class="line">    å¦‚æœæƒ³è¦ç›‘æ§ï¼Œå‰ææ˜¯èƒ½è·å–è¢«ç›‘æ§ç«¯æ•°æ®ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°æ®æ ¼å¼å¿…é¡»éµå¾ªPrometheusæ•°æ®æ¨¡å‹ï¼Œè¿™æ ·æ‰èƒ½è¯†åˆ«å’Œé‡‡é›†ï¼Œä¸€èˆ¬ä½¿ç”¨exporteræ•°æ®é‡‡é›†å™¨(ç±»ä¼¼äºzabbix_agentç«¯)æä¾›ç›‘æ§æŒ‡æ ‡æ•°æ®ã€‚</span><br><span class="line">    exporteræ•°æ®é‡‡é›†å™¨ï¼Œé™¤äº†å®˜æ–¹å’ŒGitHubæä¾›çš„å¸¸ç”¨ç»„ä»¶exporterå¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºè‡ªå·±è‡ªç ”çš„äº§å“å®šåˆ¶exportersç»„ä»¶å“Ÿã€‚</span><br><span class="line"></span><br><span class="line">(3)Pushgateway:</span><br><span class="line">    çŸ­æœŸå­˜å‚¨æŒ‡æ ‡æ•°æ®ï¼Œä¸»è¦ç”¨äºä¸´æ—¶æ€§çš„ä»»åŠ¡ã€‚æ¯”å¦‚å¤‡ä»½æ•°æ®åº“ä»»åŠ¡ç›‘æ§ç­‰ã€‚</span><br><span class="line">æœ¬è´¨ä¸Šæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºPushgatewayå¯ä»¥å¸®å’±ä»¬ç›‘æ§è‡ªå®šä¹‰çš„ç›‘æ§é¡¹ï¼Œè¿™éœ€è¦å’±ä»¬è‡ªå·±ç¼–å†™è„šæœ¬æ¥æ¨é€åˆ°Pushgatewayç«¯ï¼Œè€Œåç”±Prometheus serverä»Pushgatewayå»pullç›‘æ§æ•°æ®ã€‚</span><br><span class="line">    æ¢å¥è¯è¯´ï¼Œè¯·ä¸è¦è¢«å®˜æ–¹çš„æ¶æ„å›¾è’™éª—äº†ï¼Œå’±ä»¬å®Œå…¨å¯ä»¥åŸºäºPushgatewayæ¥ç›‘æ§å’±ä»¬è‡ªå®šä¹‰çš„ç›‘æ§é¡¹å“Ÿï¼Œè¿™äº›ç›‘æ§é¡¹å®Œå…¨å¯ä»¥æ˜¯é•¿æœŸè¿è¡Œçš„å‘¢ï¼</span><br><span class="line"></span><br><span class="line">(4)Service discovery:</span><br><span class="line">    æœåŠ¡å‘ç°ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é…ç½®åŠ¨æ€çš„æœåŠ¡ç›‘æ§ï¼Œæ— éœ€é‡å¯Prometheus serverå®ä¾‹å°±èƒ½å®ç°åŠ¨æ€ç›‘æ§ã€‚</span><br><span class="line"></span><br><span class="line">(5)Alertmanager:</span><br><span class="line">    æ”¯æŒæŠ¥è­¦åŠŸèƒ½ï¼Œæ¯”å¦‚å¯ä»¥æ”¯æŒåŸºäºé‚®ä»¶ï¼Œå¾®ä¿¡ï¼Œé’‰é’‰æŠ¥è­¦ã€‚</span><br><span class="line">    æ®ç½‘å‹åé¦ˆè¯¥ç»„ä»¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å­˜åœ¨ç¼ºé™·ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Grafanaæ¥å±•ç¤ºå¹¶å®ç°æŠ¥è­¦åŠŸèƒ½ã€‚</span><br><span class="line"></span><br><span class="line">(6)Prometheus Web UI</span><br><span class="line">    Prometheusæ¯”è¾ƒç®€å•çš„Webæ§åˆ¶å°ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ä½¿ç”¨grafanaæ¥é›†æˆåšæ›´æ¼‚äº®çš„Webå±•ç¤ºå“Ÿã€‚</span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">    å¤§å¤šæ•°Prometheusç»„ä»¶éƒ½æ˜¯ç”¨Goç¼–å†™çš„ï¼Œè¿™ä½¿å¾—å®ƒä»¬æ˜“äºæ„å»ºå’Œéƒ¨ç½²ä¸ºé™æ€äºŒè¿›åˆ¶æ–‡ä»¶</span><br></pre></td></tr></table></figure><h3 id="4ã€äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²Prometheus"><strong>4ã€äºŒè¿›åˆ¶æ–¹å¼éƒ¨ç½²Prometheus</strong></h3><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>hostname</th><th>ip</th><th>roles</th><th>é…ç½®(application)</th><th>é…ç½®</th></tr></thead><tbody><tr><td>master01</td><td>10.0.0.200  /  172.16.1.200</td><td>PrometheusæœåŠ¡ç«¯</td><td>promethues,pushgateway,alertmanager,<br/>node_exporter,cAdVidorï¼Œgrafana</td><td>1h2G</td></tr><tr><td>node01</td><td>10.0.0.201  /  172.16.1.201</td><td>prometheuså®¢æˆ·ç«¯(æ”¶é›†æ•°æ®æŒ‡æ ‡)</td><td>node_exporter,cAdVidor</td><td>1h2G</td></tr><tr><td>node02</td><td>10.0.0.202  /  172.16.1.202</td><td>prometheuså®¢æˆ·ç«¯(æ”¶é›†æ•°æ®æŒ‡æ ‡)</td><td>node_exporter,cAdVidor</td><td>1h2G</td></tr><tr><td>node03</td><td>10.0.0.203  /  172.16.1.203</td><td>prometheuså®¢æˆ·ç«¯(æ”¶é›†æ•°æ®æŒ‡æ ‡)</td><td>node_exporter,cAdVidor</td><td>2h4G</td></tr></tbody></table><p>1ã€ä¸‹è½½åŒ…</p><p><img src="../image/study_img/image-20240926155738935.png" alt="image-20240926155738935"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pushgatewayï¼šè‡ªå®šä¹‰ç›‘æ§</span><br><span class="line">alertmanagerï¼šå‘Šè­¦</span><br><span class="line">node_exporterï¼šmasterèµ·å®¹å™¨äº†ï¼Œapiserverï¼Œcontrollerç»„ä»¶éƒ½æ˜¯ä»¥å®¹å™¨æ–¹å¼èµ·æ¥çš„éœ€è¦ç›‘æ§</span><br><span class="line">cAdVidorï¼šç›‘æ§å®¹å™¨</span><br><span class="line"></span><br><span class="line">https://prometheus.io/download/</span><br><span class="line"></span><br><span class="line">1ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…</span><br><span class="line">ç‰ˆæœ¬çš„é€‰æ‹©bataæ˜¯é¢„ä¸Šçº¿ç‰ˆæœ¬ï¼Œå½“å‰ç¨³å®šç‰ˆLTS   ç”Ÿäº§ä¸­æœ€å¥½ç”¨æ–‡æ¡£ç‰ˆçš„</span><br><span class="line"><span class="comment">#ä¸‹è½½Prometheus</span></span><br><span class="line">wget https://github.com/prometheus/prometheus/releases/download/v2.54.1/prometheus-2.54.1.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½alertmanagerï¼ˆå‘Šè­¦ç»„ä»¶ï¼‰</span></span><br><span class="line">wget https://github.com/prometheus/alertmanager/releases/download/v0.27.0/alertmanager-0.27.0.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½node_exporter(å®¿ä¸»æœºæŒ‡æ ‡æ”¶é›†å™¨)</span></span><br><span class="line">wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½pushgatewayï¼ˆè‡ªå®šä¹‰ç›‘æ§ç»„ä»¶ï¼‰</span></span><br><span class="line">cAdVidorä¸æ˜¯è‡ªå·±çš„ç»„ä»¶</span><br></pre></td></tr></table></figure><p>2ã€éƒ¨ç½²Prometheus</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…Prometheus</span><br><span class="line">[root@master01 ~]# tar xf prometheus-2.54.1.linux-amd64.tar.gz -C /app</span><br><span class="line">[root@master01 ~]# <span class="built_in">mv</span> /app/prometheus-2.54.1.linux-amd64 /app/prometheus-2.54.1</span><br><span class="line">[root@master01 ~]# <span class="built_in">ln</span> -s /app/prometheus-2.54.1 /app/prometheus</span><br><span class="line">åˆ¶ä½œå¥½è½¯è¿æ¥ï¼Œå°±å®‰è£…å®Œæˆ</span><br><span class="line"></span><br><span class="line">[root@master01 prometheus-2.54.1]# ll /app/</span><br><span class="line">lrwxrwxrwx 1 root root    22 Sep 26 12:01 prometheus -&gt; /app/prometheus-2.54.1</span><br><span class="line">drwxr-xr-x 4 1001 docker 132 Sep 26 12:44 prometheus-2.54.1</span><br><span class="line">[root@master01 ~]# ll /app/prometheus-2.54.1/</span><br><span class="line">total 265552</span><br><span class="line">drwxr-xr-x 2 1001 docker        38 Aug 27 19:11 console_libraries#åº“æ–‡ä»¶</span><br><span class="line">drwxr-xr-x 2 1001 docker       173 Aug 27 19:11 consoles</span><br><span class="line">-rw-r--r-- 1 1001 docker     11357 Aug 27 19:11 LICENSE</span><br><span class="line">-rw-r--r-- 1 1001 docker      3773 Aug 27 19:11 NOTICE</span><br><span class="line">-rwxr-xr-x 1 1001 docker 140096826 Aug 27 18:58 prometheus <span class="comment">#å¯åŠ¨ç¨‹åº</span></span><br><span class="line">-rw-r--r-- 1 1001 docker       934 Aug 27 19:11 prometheus.yml  <span class="comment">#é…ç½®æ–‡ä»¶</span></span><br><span class="line">-rwxr-xr-x 1 1001 docker 131802216 Aug 27 18:58 promtool</span><br></pre></td></tr></table></figure><p>â€‹    Prometheusé…ç½®æ–‡ä»¶è§£è¯»</p><p><img src="../image/study_img/image-20240926163353506.png" alt="image-20240926163353506"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@master01 prometheus-2.54.1]# vim prometheus.yml</span><br><span class="line">......</span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.200:9090&quot;</span>]</span><br><span class="line">     <span class="comment">#è¿™é‡Œå†™Prometheusçš„å®‰è£…æœºå™¨çš„ip:ç«¯å£</span></span><br><span class="line"> </span><br><span class="line">3ã€æŸ¥çœ‹å¸®åŠ©ï¼ŒæŸ¥çœ‹å¯åŠ¨æœåŠ¡éƒ½éœ€è¦å“ªäº›å‚æ•° </span><br><span class="line">[root@master01 prometheus]# /app/prometheus/prometheus --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€å¯åŠ¨Prometheus</span><br><span class="line">[root@master01 prometheus]# /app/prometheus/prometheus --config.file=/app/prometheus/prometheus.yml &amp;</span><br><span class="line">ä¼šæœ‰æ—¥å¿—è¾“å‡ºåœ¨ç»ˆç«¯</span><br><span class="line"><span class="comment">#å¯åŠ¨ä¹‹åï¼Œè¿™æ¬¡ä¸éœ€è¦å†™systemdè„šæœ¬ç®¡ç†ï¼Œè¿™æ¬¡ä½¿ç”¨å¦å¤–ä¸€ç§ç®¡ç†æ–¹å¼supervisor</span></span><br><span class="line"></span><br><span class="line">5ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.200:9090</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926164644789.png" alt="image-20240926164644789"></p><p>3ã€äºŒè¿›åˆ¶å®‰è£…node_exportï¼Œå¹¶åŠ å…¥Prometheus</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…</span><br><span class="line">[root@master01 ~]# tar xf node_exporter-1.8.2.linux-amd64.tar.gz -C /app</span><br><span class="line">[root@master01 app]# <span class="built_in">mv</span> /app/node_exporter-1.8.2.linux-amd64/ /app/node_exporter-1.8.2</span><br><span class="line">[root@master01 app]# <span class="built_in">ln</span> -s /app/node_exporter-1.8.2 /app/node_exporter</span><br><span class="line"><span class="comment">#è¿™é‡Œå¯ä»¥å…ˆåšç¬¬5æ­¥ï¼ŒæŠŠé…ç½®æ–‡ä»¶æ”¹äº†</span></span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹</span><br><span class="line">[root@master01 app]# <span class="built_in">cd</span> /app/node_exporter</span><br><span class="line">[root@master01 node_exporter]# ll</span><br><span class="line">total 20040</span><br><span class="line">-rw-r--r-- 1 1001 1002    11357 Jul 14 19:57 LICENSE</span><br><span class="line">-rwxr-xr-x 1 1001 1002 20500541 Jul 14 19:54 node_exporter <span class="comment">#å¯åŠ¨ç¨‹åºæ–‡ä»¶</span></span><br><span class="line">-rw-r--r-- 1 1001 1002      463 Jul 14 19:57 NOTICE</span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨</span><br><span class="line">[root@master01 node_exporter]# /app/node_exporter/node_exporter  &amp;</span><br><span class="line">å¯åŠ¨ï¼Œä¹‹åï¼ŒPrometheusæŒ‚äº†</span><br><span class="line"></span><br><span class="line">4ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.200:9100</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926170004149.png" alt="image-20240926170004149"></p><p><img src="../image/study_img/image-20240926170140793.png" alt="image-20240926170140793"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">5ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†node_exporterçš„ä¿¡æ¯åŠ å…¥Prometheus</span><br><span class="line">[root@master01 prometheus-2.54.1]# vim prometheus.yml</span><br><span class="line">......</span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.200:9090&quot;</span>]</span><br><span class="line">  - job_name: <span class="string">&quot;node_exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">    <span class="comment">#å†™node_exporterçš„åœ°å€å’Œç«¯å£</span></span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.200:9100&quot;</span>]</span><br><span class="line">      </span><br><span class="line">6ã€å†æ¬¡é‡æ–°å¯åŠ¨Prometheus</span><br><span class="line">[root@master01 prometheus]# <span class="built_in">jobs</span></span><br><span class="line">[1]-  Running                 /app/prometheus/prometheus --config.file=/app/prometheus/prometheus.yml &amp;</span><br><span class="line">[2]+  Running                 /app/node_exporter/node_exporter &amp;  (wd: /app/node_exporter)</span><br><span class="line">[root@master01 prometheus]# <span class="built_in">kill</span> %1</span><br><span class="line"></span><br><span class="line">[root@master01 prometheus]# /app/prometheus/prometheus --config.file=/app/prometheus/prometheus.yml &amp;</span><br><span class="line"></span><br><span class="line">7ã€åˆ·æ–°é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°node_exporterçš„èŠ‚ç‚¹</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926171311595.png" alt="image-20240926171311595"></p><p>4ã€éƒ¨ç½²supervisor</p><p>node_exporterå’ŒPrometheusæœåŠ¡,å¯åœæ²¡æœ‰ä½¿ç”¨systemdç®¡ç†ï¼Œè¿™æ¬¡ä½¿ç”¨supervisorç®¡ç†æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…supervisor   æ˜¯pythonå†™çš„</span><br><span class="line">[root@master01 prometheus-2.54.1]# yum -y install supervisor</span><br><span class="line">[root@master01 prometheus]# systemctl start supervisord</span><br><span class="line">[root@master01 prometheus]# systemctl <span class="built_in">enable</span> supervisord</span><br><span class="line">å¦‚æœå…¬å¸æœ‰ä¸€äº›å‰ç«¯æˆ–è€…åç«¯çš„é¡µé¢è¦å¯åŠ¨éƒ½å¯ä»¥æ”¾åˆ°è¿™é‡Œç®¡ç†</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@master01 prometheus]# vim /etc/supervisord.conf </span><br><span class="line">[include]</span><br><span class="line">files = supervisord.d/*.ini   <span class="comment">#å­é…ç½®æ–‡ä»¶çš„å†™æ³•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€ç¼–å†™promethueså¯åŠ¨è„šæœ¬</span><br><span class="line">[root@master01 prometheus]# vim /etc/supervisord.d/prome.ini</span><br><span class="line">[program:prometheus]</span><br><span class="line">directory=/app/prometheus/</span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/app/prometheus/prometheus --config.file=/app/prometheus/prometheus.yml&quot;</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/var/log/prome_stdout.log</span><br><span class="line">stderr_logfile=/var/log/prome_stderr.log</span><br><span class="line">user=root</span><br><span class="line">stopsignal=TERM</span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›ç¨‹/ç¨‹åºï¼šç¨‹åºå</span></span><br><span class="line">[program:prometheus]</span><br><span class="line"><span class="comment">#ç¨‹åºçš„å·¥ä½œç›®å½•</span></span><br><span class="line">directory=/app/prometheus/</span><br><span class="line"><span class="comment">#å¯åŠ¨å‘½ä»¤</span></span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/app/prometheus/prometheus --config.file=/app/prometheus/prometheus.yml&quot;</span></span><br><span class="line"><span class="comment">#è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥çœ‹åšå¼€æœºè‡ªå¯åŠ¨ï¼Œåªè¦supervisoå¯åŠ¨ï¼Œä»–å°±å¯åŠ¨ï¼Œæ‰€ä»¥è¦ç»™supervisoè®¾ç½®å¼€æœºè‡ªå¯åŠ¨</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line"><span class="comment">#è‡ªåŠ¨å¯åŠ¨</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line"><span class="comment">#æ ‡å‡†è¾“å‡ºçš„æ—¥å¿—</span></span><br><span class="line">stdout_logfile=/var/log/prome_stdout.log</span><br><span class="line"><span class="comment">#é”™è¯¯è¾“å‡ºçš„æ—¥å¿—</span></span><br><span class="line">stderr_logfile=/var/log/prome_stderr.log</span><br><span class="line"><span class="comment">#ç¨‹åºçš„å¯åŠ¨ç”¨æˆ·</span></span><br><span class="line">user=root</span><br><span class="line"><span class="comment">#stopçš„ä¿¡å·æ˜¯termï¼Œkill -lå¯ä»¥çœ‹åˆ°æ‰€æœ‰ä¿¡å·ï¼Œæœ‰ä¸€ä¸ª15)çš„ä¿¡å· ç›¸å½“äºkill -15 è¿›ç¨‹åï¼Œè¿™ä¸ªæ˜¯æœ€æ ‡å‡†æœ€å®‰å…¨çš„æ€è¿›ç¨‹</span></span><br><span class="line">stopsignal=TERM</span><br><span class="line"><span class="comment">#å¯åŠ¨çš„è¶…æ—¶æ—¶é—´5sï¼Œè¶…è¿‡5sæ²¡èµ·æ¥å°±æ˜¯è¶…æ—¶</span></span><br><span class="line">startsecs=5</span><br><span class="line"><span class="comment">#é‡è¯•æ¬¡æ•°</span></span><br><span class="line">startretries=3</span><br><span class="line"><span class="comment">#å¦‚æœä½ çš„è¿™ä¸ªè„šæœ¬åœäº†ï¼Œè¿™ä¸ªè„šæœ¬é‡Œé¢çš„å…¶ä»–ç¨‹åºä¹Ÿåœæ‰</span></span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line"><span class="comment">#è¿™ä¸ªè„šæœ¬é‡Œé¢çš„å…¶ä¸­ä¸€ä¸ªæœåŠ¡æ€æ‰ï¼Œå…¶ä»–æœåŠ¡ä¹Ÿæ€æ‰</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€éœ€è¦æ›´æ–°å¯åŠ¨è„šæœ¬,æ¯æ¬¡æ›´æ”¹è¿™ä¸ªå¯åŠ¨è„šæœ¬éƒ½è¦æ›´æ–°ï¼Œç›¸å½“äºæ‰§è¡Œsystemctl daemon-reload</span><br><span class="line">[root@master01 prometheus]# supervisorctl update</span><br><span class="line">prometheus: added process group</span><br><span class="line"></span><br><span class="line">5ã€å…ˆæŠŠåå°çš„2ä¸ªè¿›ç¨‹åœæ­¢æ‰ï¼Œ</span><br><span class="line">[root@master01 prometheus]# <span class="built_in">jobs</span></span><br><span class="line">[2]-  Running                 /app/node_exporter/node_exporter &amp;  (wd: /app/node_exporter)</span><br><span class="line">[3]+  Running                 /app/prometheus/prometheus --config.file=/app/prometheus/prometheus.yml &amp;</span><br><span class="line">[root@master01 prometheus]# <span class="built_in">kill</span> %1</span><br><span class="line">-bash: <span class="built_in">kill</span>: %1: no such job</span><br><span class="line">[root@master01 prometheus]# <span class="built_in">kill</span> %2</span><br><span class="line">[root@master01 prometheus]# <span class="built_in">kill</span> %3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€supervisoræ§åˆ¶æœåŠ¡çš„å¯åœ</span><br><span class="line">[root@master01 prometheus]# supervisorctl start all</span><br><span class="line">prometheus: started</span><br><span class="line">[root@master01 prometheus]# supervisorctl stop all</span><br><span class="line">prometheus: stopped</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@master01 prometheus]# supervisorctl stop prometheus</span><br><span class="line">prometheus: stopped</span><br><span class="line">[root@master01 prometheus]# supervisorctl start prometheus</span><br><span class="line">prometheus: started</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926181219003.png" alt="image-20240926181219003"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#supervisorçš„å¤šæœåŠ¡ç®¡ç†</span></span><br><span class="line">7ã€ç¼–å†™node_exporterçš„å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@master01 prometheus]# vim /etc/supervisord.d/prome.ini</span><br><span class="line">[program:prometheus]</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="comment">#åŠ å…¥node_exporterçš„å¯åœæ­¢è„šæœ¬</span></span><br><span class="line">[program:node_exporter]</span><br><span class="line">directory=/app/node_exporter/</span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/app/node_exporter/node_exporter&quot;</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/var/log/node_exporter_stdout.log</span><br><span class="line">stderr_logfile=/var/log/node_exporter_stderr.log</span><br><span class="line">user=root</span><br><span class="line">stopsignal=TERM</span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">8ã€æ›´æ–°å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@master01 prometheus]# supervisorctl update</span><br><span class="line">node_exporter: added process group</span><br><span class="line">åŠ è¿›å»ä¼šè‡ªåŠ¨å¯åŠ¨ï¼Œå› ä¸ºå†™äº†autostart=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9ã€å¦‚æœä½¿ç”¨å¦‚ä¸‹ç›®å½•ï¼Œå°±ä¼š2ä¸ªæœåŠ¡ä¸€èµ·å¯åŠ¨æˆ–åœæ­¢</span><br><span class="line">[root@master01 prometheus]# supervisorctl stop all</span><br><span class="line">node_exporter: stopped</span><br><span class="line">prometheus: stopped</span><br><span class="line">[root@master01 prometheus]# supervisorctl start all</span><br><span class="line">node_exporter: started</span><br><span class="line">prometheus: started</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# supervisorctl status</span><br><span class="line">node_exporter                    RUNNING   pid 33788, <span class="built_in">uptime</span> 0:05:37</span><br><span class="line">prometheus                       RUNNING   pid 33789, <span class="built_in">uptime</span> 0:05:37</span><br></pre></td></tr></table></figure><p>5ã€å®‰è£…pushgateway</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…</span><br><span class="line">[root@master01 ~]# tar xf pushgateway-1.10.0.linux-amd64.tar.gz  -C /app/</span><br><span class="line">[root@master01 ~]# <span class="built_in">mv</span> /app/pushgateway-1.10.0.linux-amd64/ /app/pushgateway-1.10.0</span><br><span class="line">[root@master01 ~]# <span class="built_in">ln</span> -s /app/pushgateway-1.10.0/ /app/pushgateway</span><br><span class="line"></span><br><span class="line">2ã€å¯åŠ¨å‘½ä»¤</span><br><span class="line">[root@master01 ~]# /app/pushgateway/pushgateway</span><br><span class="line"></span><br><span class="line">3ã€ä¿®æ”¹å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@master01 ~]# vim /etc/supervisord.d/prome.ini</span><br><span class="line">[program:prometheus]</span><br><span class="line">[program:node_exporter]</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="comment">#åŠ å…¥pushgatewayçš„å¯åœæ­¢è„šæœ¬</span></span><br><span class="line">[program:pushgateway]</span><br><span class="line">directory=/app/pushgateway/</span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/app/pushgateway/pushgateway&quot;</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/var/log/pushgateway_stdout.log</span><br><span class="line">stderr_logfile=/var/log/pushgateway_stderr.log</span><br><span class="line">user=root</span><br><span class="line">stopsignal=TERM</span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">4ã€æ›´æ–°å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@master01 prometheus]# supervisorctl update</span><br><span class="line">pushgateway: added process group</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# supervisorctl status</span><br><span class="line">node_exporter                    RUNNING   pid 33788, <span class="built_in">uptime</span> 1:20:01</span><br><span class="line">prometheus                       RUNNING   pid 33789, <span class="built_in">uptime</span> 1:20:01</span><br><span class="line">pushgateway                      RUNNING   pid 77783, <span class="built_in">uptime</span> 0:01:20</span><br><span class="line"></span><br><span class="line">5ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.200:9091</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926195532979.png" alt="image-20240926195532979"></p><p>6ã€éƒ¨ç½²alertmanager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…</span><br><span class="line">[root@master01 ~]# tar xf alertmanager-0.27.0.linux-amd64.tar.gz -C /app/</span><br><span class="line">[root@master01 ~]# <span class="built_in">mv</span> /app/alertmanager-0.27.0.linux-amd64/ /app/alertmanager-0.27.0</span><br><span class="line">[root@master01 ~]# <span class="built_in">ln</span> -s /app/alertmanager-0.27.0/ /app/alertmanager</span><br><span class="line">[root@master01 ~]# ll /app/alertmanager/</span><br><span class="line">é‡Œé¢æœ‰é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸éœ€è¦æ”¹</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">[root@master01 ~]# /app/alertmanager/alertmanager  --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨</span><br><span class="line">[root@master01 ~]# /app/alertmanager/alertmanager  --config.file=/app/alertmanager/alertmanager.yml </span><br><span class="line"></span><br><span class="line">4ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.200:9093</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926194338396.png" alt="image-20240926194338396"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">5ã€ä¿®æ”¹å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@master01 ~]# vim /etc/supervisord.d/prome.ini</span><br><span class="line">[program:prometheus]</span><br><span class="line">[program:node_exporter]</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="comment">#åŠ å…¥alertmanagerçš„å¯åœæ­¢è„šæœ¬</span></span><br><span class="line">[program:alertmanager]</span><br><span class="line">directory=/app/alertmanager/</span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/app/alertmanager/alertmanager  --config.file=/app/alertmanager/alertmanager.yml &quot;</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/var/log/alertmanager_stdout.log</span><br><span class="line">stderr_logfile=/var/log/alertmanager_stderr.log</span><br><span class="line">user=root</span><br><span class="line">stopsignal=TERM</span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">8ã€æ›´æ–°å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@master01 ~]# supervisorctl update</span><br><span class="line">alertmanager: added process group</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# supervisorctl status</span><br><span class="line">alertmanager                     RUNNING   pid 77780, <span class="built_in">uptime</span> 0:01:20</span><br><span class="line">node_exporter                    RUNNING   pid 33788, <span class="built_in">uptime</span> 1:20:01</span><br><span class="line">prometheus                       RUNNING   pid 33789, <span class="built_in">uptime</span> 1:20:01</span><br><span class="line">pushgateway                      RUNNING   pid 77783, <span class="built_in">uptime</span> 0:01:20</span><br></pre></td></tr></table></figure><p>7ã€3å°nodeèŠ‚ç‚¹éƒ¨ç½²node_exporter</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">-----------#3å°éƒ½è¦å®‰è£…------------------------</span><br><span class="line">1ã€å®‰è£…node_exporter   </span><br><span class="line">[root@node01 ~]# <span class="built_in">mkdir</span> /app</span><br><span class="line">[root@node01 ~]# tar xf node_exporter-1.8.2.linux-amd64.tar.gz -C /app</span><br><span class="line">[root@node01 ~]# <span class="built_in">mv</span> /app/node_exporter-1.8.2.linux-amd64/ /app/node_exporter-1.8.2</span><br><span class="line">[root@node01 ~]# <span class="built_in">ln</span> -s /app/node_exporter-1.8.2 /app/node_exporter</span><br><span class="line">[root@node01 ~]# <span class="built_in">cd</span> /app/node_exporter</span><br><span class="line">[root@node01 node_exporter]# ll</span><br><span class="line">total 20040</span><br><span class="line">-rw-r--r-- 1 1001 1002    11357 Jul 14 19:57 LICENSE</span><br><span class="line">-rwxr-xr-x 1 1001 1002 20500541 Jul 14 19:54 node_exporter</span><br><span class="line">-rw-r--r-- 1 1001 1002      463 Jul 14 19:57 NOTICE</span><br><span class="line">[root@node01 node_exporter]# yum -y install supervisor</span><br><span class="line">[root@node01 node_exporter]# systemctl start supervisord</span><br><span class="line">[root@node01 node_exporter]# systemctl <span class="built_in">enable</span> supervisord</span><br><span class="line"></span><br><span class="line">2ã€ç¼–å†™å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@node01 node_exporter]# vim /etc/supervisord.d/prome.ini</span><br><span class="line">[program:node_exporter]</span><br><span class="line">directory=/app/node_exporter/</span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/app/node_exporter/node_exporter&quot;</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/var/log/node_exporter_stdout.log</span><br><span class="line">stderr_logfile=/var/log/node_exporter_stderr.log</span><br><span class="line">user=root</span><br><span class="line">stopsignal=TERM</span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line">             </span><br><span class="line">[root@node01 node_exporter]# supervisorctl update</span><br><span class="line">node_exporter: added process group</span><br><span class="line">[root@node01 node_exporter]# supervisorctl start all</span><br><span class="line">------------------------------------------------</span><br><span class="line"></span><br><span class="line">--------------#masteræ“ä½œ---------------------</span><br><span class="line">3ã€#masteræ“ä½œ</span><br><span class="line">ä¿®æ”¹prometheusé…ç½®æ–‡ä»¶ï¼Œå°†node_exporterçš„ä¿¡æ¯åŠ å…¥Prometheus</span><br><span class="line">[root@master01 prometheus-2.54.1]# vim prometheus.yml</span><br><span class="line">......</span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.200:9090&quot;</span>]</span><br><span class="line">  - job_name: <span class="string">&quot;node_exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">    <span class="comment">#å†™node_exporterçš„åœ°å€å’Œç«¯å£,å°†node01  02 03çš„ipç«¯å£æ·»åŠ </span></span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.200:9100&quot;</span>, <span class="string">&quot;10.0.0.201:9100&quot;</span>, <span class="string">&quot;10.0.0.202:9100&quot;</span>, <span class="string">&quot;10.0.0.203:9100&quot;</span>]</span><br><span class="line">      </span><br><span class="line">4ã€é‡å¯</span><br><span class="line">[root@master01 prometheus]# supervisorctl restart all</span><br><span class="line"></span><br><span class="line">5ã€è®¿é—®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°nodeèŠ‚ç‚¹éƒ½èµ·æ¥äº†</span><br><span class="line">10.0.0.200:9090</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240926210750410.png" alt="image-20240926210750410"></p><p>8ã€3å°nodeèŠ‚ç‚¹å®‰è£…cAdVisor</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1ã€3å°nodeèŠ‚ç‚¹æ‹‰å–cadvisoré•œåƒ</span><br><span class="line">docker pull google/cadvisor:latest</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œé•œåƒ</span><br><span class="line">[root@node01 ~]# docker run --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/data/cadvisor:/var/lib/docker.io --publish=8080:8080 --detach=<span class="literal">true</span> --name=cadvisor google/cadvisor:latest</span><br></pre></td></tr></table></figure><h3 id="5ã€Prometheusè‡ªåŠ¨å‘ç°â€”â€”file-sd-æ–‡ä»¶å‘ç°"><strong>5ã€Prometheusè‡ªåŠ¨å‘ç°â€”â€”file-sd(æ–‡ä»¶å‘ç°)</strong></h3><p>1ã€å…ˆæŠŠPrometheusæ”¶é›†åˆ°çš„nodeèŠ‚ç‚¹åœ¨Prometheusçš„é…ç½®æ–‡ä»¶é‡Œé¢åˆ é™¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@master01 prometheus-2.54.1]# vim prometheus.yml</span><br><span class="line">......</span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.200:9090&quot;</span>]</span><br><span class="line">  - job_name: <span class="string">&quot;node_exporter&quot;</span></span><br><span class="line">    static_configs:</span><br><span class="line">    <span class="comment">#æ”¹å›åªè·å–master01çš„</span></span><br><span class="line">      - targets: [<span class="string">&quot;10.0.0.200:9100&quot;</span>]</span><br></pre></td></tr></table></figure><p>2ã€ä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶ï¼Œæ·»åŠ è‡ªåŠ¨å‘ç°è§„åˆ™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@master01 prometheus]# vim prometheus.yml</span><br><span class="line">scrape_configs:</span><br><span class="line">.....</span><br><span class="line"><span class="comment">#æ·»åŠ è‡ªåŠ¨å‘ç°è§„åˆ™</span></span><br><span class="line"> - job_name: <span class="string">&quot;prome_file_sd&quot;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">    - files:</span><br><span class="line">      - /app/prometheus/file_sd/agent.yml</span><br><span class="line">      refresh_interval: 5s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºæ–‡ä»¶å‘ç°é…ç½®å­˜æ”¾ç›®å½•</span><br><span class="line">[root@master01 prometheus]# <span class="built_in">mkdir</span> -p /app/prometheus/file_sd</span><br><span class="line"></span><br><span class="line">3ã€ç¼–è¾‘æ–‡ä»¶å‘ç°çš„é…ç½®æ–‡ä»¶</span><br><span class="line">ä»¥åå¯èƒ½åƒpushgatewayä¹Ÿè¦åŠ è¿›æ¥</span><br><span class="line">[root@master01 prometheus]# vim /app/prometheus/file_sd/agent.yml</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;targets&quot;</span>:  [<span class="string">&quot;10.0.0.201:9100&quot;</span>,<span class="string">&quot;10.0.0.202:9100&quot;</span>,<span class="string">&quot;10.0.0.203:9100&quot;</span>],</span><br><span class="line">    <span class="string">&quot;labels&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;agent&quot;</span>: <span class="string">&quot;node_exporter&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;targets&quot;</span>:  [<span class="string">&quot;10.0.0.201:8080&quot;</span>,<span class="string">&quot;10.0.0.202:8080&quot;</span>,<span class="string">&quot;10.0.0.203:8080&quot;</span>],</span><br><span class="line">    <span class="string">&quot;labels&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;agent&quot;</span>: <span class="string">&quot;cAdVisor&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">      </span><br><span class="line">2ã€é‡å¯Prometheus</span><br><span class="line">[root@master01 prometheus]# supervisorctl restart all</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927135935380.png" alt="image-20240927135935380"></p><h3 id="6ã€Prometheusæ•°æ®æ ¼å¼"><strong>6ã€Prometheusæ•°æ®æ ¼å¼</strong></h3><p><strong>â‘ ã€PrometheusæŒ‡æ ‡ç±»å‹</strong></p><p><img src="../image/study_img/image-20240927100110091.png" alt="image-20240927100110091"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ•°æ®æè¿°</span></span><br><span class="line"><span class="comment"># HELP node_cpu_seconds_total Seconds the CPUs spent in each mode.</span></span><br><span class="line"><span class="comment">#æ•°æ®ç±»å‹ (ä¸‹é¢æ”¶é›†åˆ°çš„æ•°æ®å«æŒ‡æ ‡ï¼ŒæŒ‡æ ‡ç±»å‹)</span></span><br><span class="line"><span class="comment"># TYPE node_cpu_seconds_total counter</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125; 335802.19  <span class="comment">#ç©ºé—²</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;iowait&quot;</span>&#125; 115.16   <span class="comment">#ç­‰å¾…</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;irq&quot;</span>&#125; 0    <span class="comment">#</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;nice&quot;</span>&#125; 3.2</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;softirq&quot;</span>&#125; 602.95</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;steal&quot;</span>&#125; 0</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;system&quot;</span>&#125; 11580.34 <span class="comment">#å†…æ ¸æ€</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;user&quot;</span>&#125; 8994.06   <span class="comment">#ç”¨æˆ·æ€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cpu2ä¸ªæ ¸å¿ƒçš„</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125; 337368.67</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;iowait&quot;</span>&#125; 10.91</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;irq&quot;</span>&#125; 0</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;nice&quot;</span>&#125; 3.41</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;softirq&quot;</span>&#125; 520.71</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;steal&quot;</span>&#125; 0</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;system&quot;</span>&#125; 11293.66</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;user&quot;</span>&#125; 9194.18</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŒ‡æ ‡ç±»å‹    åé¢çš„è‡ªå®šä¹‰ç›‘æ§è¦å®šä¹‰æŒ‡æ ‡ç±»å‹</span></span><br><span class="line">1ã€gaugeï¼šç¬æ—¶å€¼ï¼Œå½“å‰æœ€æ–°çš„å€¼   <span class="comment">#(å¸¸ç”¨çš„)</span></span><br><span class="line">æ¯”å¦‚æ”¶é›†ç”¨æˆ·æœ€æ–°çš„ç™»å½•æ•°é‡</span><br><span class="line">Gaugesæ˜¯æœ€ç®€å•çš„åº¦é‡æŒ‡æ ‡ï¼Œåªæœ‰ä¸€ä¸ªç®€å•çš„è¿”å›å€¼ï¼Œæˆ–è€…å«ç¬æ—¶çŠ¶æ€ã€‚</span><br><span class="line">ä¾‹å¦‚ï¼šæˆ‘ä»¬æƒ³è¡¡é‡ä¸€ä¸ªå¾…å¤„ç†é˜Ÿåˆ—ä¸­ä»»åŠ¡çš„ä¸ªæ•°ï¼Œè¿™ä¸ªä¸ªæ•°æ˜¯ä¼šå˜åŒ–çš„ã€‚</span><br><span class="line">å½“æˆ‘ä»¬è¦ç›‘æ§ç¡¬ç›˜å®¹é‡æˆ–è€…å†…å­˜çš„ä½¿ç”¨é‡ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨Gaugesçš„metricsæ ¼å¼æ¥è¡¡é‡ï¼Œå› ä¸ºç¡¬ç›˜çš„å®¹é‡æˆ–è€…å†…å­˜çš„ä½¿ç”¨é‡æ˜¯éšæ—¶é—´çš„æ¨ç§»ï¼Œä¸æ–­ç¬æ—¶ä¸”æ— è§„åˆ™å˜åŒ–çš„ã€‚</span><br><span class="line">è¿™ç§å˜åŒ–æ²¡æœ‰è§„å¾‹ï¼Œå½“å‰æ˜¯å¤šå°‘ï¼Œé‡‡é›†å›æ¥çš„å°±æ˜¯å¤šå°‘ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€counterï¼šè®¡æ•°å™¨ç±»å‹         <span class="comment">#(å¸¸ç”¨çš„)</span></span><br><span class="line">Counterså°±æ˜¯è®¡æ•°å™¨ï¼Œä»æ•°æ®é‡0å¼€å§‹ç§¯ç´¯è®¡ç®—ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œåªèƒ½æ˜¯æ°¸è¿œçš„å¢é•¿ï¼Œä¸ä¼šé™ä½(ä¸€äº›ç‰¹æ®Šæƒ…å†µå¦è¯´,æ¯”å¦‚è¯´ç²‰ä¸æ•°,æœªå¿…å°±æ˜¯åªå¢ä¸å‡.)ã€‚</span><br><span class="line">æ¯”å¦‚ç»Ÿè®¡ä¸€å°æ—¶ï¼Œä¸€å¤©ï¼Œä¸€å‘¨ï¼Œä¸€ä¸ªæœˆçš„ç”¨æˆ·çš„è®¿é—®é‡ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªç´¯åŠ çš„æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€histogramsï¼šç»Ÿè®¡æ•°æ®çš„å‘å¸ƒæƒ…å†µã€‚æ¯”å¦‚æœ€å°å€¼ï¼Œæœ€å¤§å€¼ï¼Œä¸­é—´å€¼ï¼Œè¿˜æœ‰ä¸­ä½æ•° (å¾ˆå°‘ç”¨)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line">å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡ç›‘æ§çš„æ–¹å¼æŠ“å–å½“å¤©nginxçš„access.logï¼Œå¹¶ä¸”æƒ³ç›‘æ§ç”¨æˆ·çš„è®¿é—®æœåŠ¡å‡ºç°çš„æ•…éšœæ—¶é—´ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšå‘¢?</span><br><span class="line"><span class="comment"># é”™è¯¯è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">æŠŠæ—¥å¿—æ¯è¡Œçš„<span class="string">&quot;http_response_time&quot;</span>æ•°å€¼ç»Ÿç»Ÿé‡‡é›†ä¸‹æ¥ï¼Œç„¶åè®¡ç®—ä¸€ä¸‹æ€»çš„å¹³å‡å€¼ã€‚è¿™æ˜¯æ¯«æ— æ„ä¹‰çš„ï¼Œå› ä¸ºæ•…éšœå‘ç”Ÿæ—¶é—´å¯èƒ½åªæœ‰ä¸€å°æ®µæ—¶é—´ï¼Œæ¯”å¦‚ç½‘ç»œå»¶è¿Ÿæ”¾ç”Ÿåœ¨12:30-12:40ä¹‹é—´ï¼Œå…¶å®ƒæ—¶é—´éƒ½æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœè®¡ç®—æ€»çš„å¹³å‡å€¼ï¼Œåˆ™ç»“æœçœ‹èµ·æ¥ä¼šå¾ˆæ­£å¸¸ï¼Œæ— æ³•è§¦å‘æŠ¥è­¦åŠŸèƒ½ï¼Œè¿ç»´äººå‘˜å¯èƒ½ä¹Ÿä¸çŸ¥é“è¿™ä»¶äº‹æƒ…å‘ç”Ÿäº†ã€‚</span><br><span class="line"><span class="comment"># æ­£ç¡®è§£å†³æ–¹æ¡ˆ:</span></span><br><span class="line">é€šè¿‡Histogramså‡½æ•°ï¼Œå¯ä»¥åˆ†åˆ«ç»Ÿè®¡å‡ºå…¨éƒ¨ç”¨æˆ·çš„å“åº”æ—¶é—´åœ¨0.05ç§’,1ç§’,2ç§’,5ç§’,10ç§’çš„é‡ã€‚è¿™æ ·è¿ç»´äººå‘˜å°±èƒ½æ ¹æ®è¿™ä¸ªå€¼è¿›è¡ŒæŠ¥è­¦ï¼Œåˆ†æè¿™äº›æ—¶é—´çš„äº§ç”ŸåŸå› ï¼Œä»è€Œé¿å…ä»¥åç±»ä¼¼çš„é—®é¢˜å‘ç”Ÿã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€summaryï¼šç›¸å½“äºå‡çº§ç‰ˆçš„histograms</span><br><span class="line">å› ä¸ºhistogramåœ¨å®¢æˆ·ç«¯å°±æ˜¯ç®€å•çš„åˆ†æ¡¶è®¡æ•°ï¼Œåœ¨prometheusæœåŠ¡ç«¯åŸºäºè¿™ä¹ˆæœ‰é™çš„æ•°æ®åšç™¾åˆ†ä½ä¼°ç®—ï¼Œæ‰€ä»¥çš„ç¡®ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œsummaryå°±æ˜¯è§£å†³ç™¾åˆ†ä½å‡†ç¡®çš„é—®é¢˜è€Œæ¥çš„ã€‚</span><br><span class="line">æˆ‘ä»¬å¯ä»¥ç®€å•ç†è§£summaryæ˜¯Histogramçš„æ‰©å±•ç±»å‹ï¼Œå¦‚æœæƒ³è¦æ¸…é™¤çš„äº†è§£histogramså’Œsummaryçš„æ›´å¤šç»†èŠ‚ï¼Œå¯è‡ªè¡ŒæŸ¥é˜…ç›¸å…³çš„æ–‡æ¡£ã€‚</span><br></pre></td></tr></table></figure><p><strong>â‘¡ã€æŒ‡æ ‡æ•°æ®æ ¼å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ•°æ®æè¿°</span></span><br><span class="line"><span class="comment"># HELP node_cpu_seconds_total Seconds the CPUs spent in each mode.</span></span><br><span class="line"><span class="comment">#æ•°æ®ç±»å‹ (æŒ‡æ ‡ç±»å‹)</span></span><br><span class="line"><span class="comment"># TYPE node_cpu_seconds_total counter</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125; 335802.19</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;iowait&quot;</span>&#125; 115.16</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;irq&quot;</span>&#125; 0</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;nice&quot;</span>&#125; 3.2</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;softirq&quot;</span>&#125; 602.95</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;steal&quot;</span>&#125; 0</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;system&quot;</span>&#125; 11580.34</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;user&quot;</span>&#125; 8994.06</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125; 337368.67</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;iowait&quot;</span>&#125; 10.91</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;irq&quot;</span>&#125; 0</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;nice&quot;</span>&#125; 3.41</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;softirq&quot;</span>&#125; 520.71</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;steal&quot;</span>&#125; 0</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;system&quot;</span>&#125; 11293.66</span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;1&quot;</span>,mode=<span class="string">&quot;user&quot;</span>&#125; 9194.18</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">keyï¼šnode_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125; </span><br><span class="line">valueï¼š335802.19</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡æ ‡æ•°æ®æ ¼å¼å°±æ˜¯å¦‚ä¸‹ï¼š</span></span><br><span class="line">1ã€è¦æœ‰ä¸€è¡Œæè¿°</span><br><span class="line">2ã€è¦æœ‰ä¸€è¡ŒæŒ‡æ ‡ç±»å‹å®šä¹‰</span><br><span class="line">3ã€çœŸå®æ•°æ®(æ•°æ®æ ¼å¼æ˜¯Key value)</span><br><span class="line"></span><br><span class="line">ä»¥åè‡ªå®šä¹‰ç›‘æ§æ”¶é›†åˆ°çš„æ•°æ®è¦ç»„æˆkey valueçš„å½¢å¼</span><br></pre></td></tr></table></figure><p><strong>â‘¢ã€PromeQLæŸ¥è¯¢ç»“æœçš„ç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PromQLçš„è¡¨è¾¾å¼ä¸­æ”¯æŒä¸€ä¸‹4ç§æ•°æ®ç±»å‹</span><br><span class="line">1ã€å³æ—¶å‘é‡(Instant Vector):</span><br><span class="line">ç‰¹å®šæˆ–å…¨éƒ¨çš„æ—¶é—´åºåˆ—é›†åˆä¸Šï¼Œå…·æœ‰ç›¸åŒæ—¶é—´æˆ³çš„ä¸€ç»„æ ·æœ¬ç§°ä¸ºå³æ—¶å‘é‡ã€‚</span><br><span class="line"></span><br><span class="line">2ã€èŒƒå›´å‘é‡(Range Vector):</span><br><span class="line">ç‰¹å®šæˆ–å…¨éƒ¨çš„æ—¶é—´åºåˆ—é›†åˆä¸Šï¼Œåœ¨æŒ‡å®šçš„åŒä¸€èŒƒå›´å†…çš„æ‰€æœ‰æ ·æœ¬å€¼</span><br><span class="line"></span><br><span class="line">3ã€æ ‡é‡(Scalar):</span><br><span class="line">ä¸€ä¸ªæµ®ç‚¹å‹çš„æ•°æ®å€¼ã€‚å¸¦å°æ•°ç‚¹çš„</span><br><span class="line"></span><br><span class="line">4ã€å­—ç¬¦ä¸²(String)ï¼š</span><br><span class="line">æ”¯æŒä½¿ç”¨å•å¼•å·ï¼ŒåŒå¼•å·æˆ–åå¼•å·è¿›è¡Œå¼•ç”¨ï¼Œä½†åå¼•å·ä¸­ä¸ä¼šè½¬ç§»å­—ç¬¦è¿›è¡Œè½¬ä¹‰</span><br></pre></td></tr></table></figure><p>1ã€å³æ—¶å‘é‡</p><p><img src="../image/study_img/image-20240927151046205.png" alt="image-20240927151046205"></p><p>è¿™äº›æ•°æ®åœ¨åŒä¸€æ—¶åˆ»ï¼ŒåŒä¸€ç§’ï¼Œæ±‡æˆä¸€å°çº¿çš„æ•°æ®å€¼ï¼Œå«å³æ—¶å‘é‡ï¼Œæ¯ä¸€ä¸ªæŒ‡æ ‡åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹è·å–åˆ°çš„æ•°æ®å€¼</p><p>2ã€èŒƒå›´å‘é‡   æ¯”å¦‚ä»10ç‚¹~11ç‚¹æŸ¥å‡ºæ¥çš„ç»“æœé›†</p><p><strong>â‘¢ã€Prometheuså¸¸ç”¨çš„å‡½æ•°</strong></p><p>1ã€increaseå‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">increaseå‡½æ•°ï¼šæ±‚æŒ‡å®šæ—¶é—´å†…çš„å¢é‡</span><br><span class="line">    åœ¨prometheusä¸­æ˜¯ç”¨æ¥é’ˆå¯¹Counterè¿™ç§æŒç»­å¢é•¿çš„æ•°å€¼ï¼Œæˆªå–å…¶ä¸­çš„ä¸€æ®µæ—¶é—´çš„å¢é‡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line">increase(node_cpu_seconds_total[1m]):</span><br><span class="line">    è·å–CPUæ€»ä½¿ç”¨æ—¶é—´åœ¨1åˆ†é’Ÿå†…çš„å¢é‡ï¼Œè®¡ç®—çš„æ˜¯1åˆ†é’Ÿå†…å¢åŠ çš„æ€»é‡ã€‚</span><br><span class="line">    åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨é€šå¸¸æ˜¯å¤šæ ¸çš„ï¼Œå› æ­¤è¿™ä¸ªé‡‡é›†çš„æ˜¯æ‰€æœ‰æ ¸å¿ƒçš„å€¼å“Ÿã€‚</span><br><span class="line">increase(node_cpu_seconds_total&#123;instance=<span class="string">&quot;10.0.0.101:9100&quot;</span>&#125;[100m]):</span><br><span class="line">     æˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©æ ‡ç­¾é€‰æ‹©å™¨è¿‡æ»¤æŸ¥çœ‹æŸä¸ªæœåŠ¡å™¨å®ä¾‹çš„é…ç½®.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cpu 1åˆ†é’Ÿçš„å¢é•¿é‡</span><br><span class="line">increase(node_cpu_seconds_total&#123;instance=<span class="string">&#x27;10.0.0.202:9100&#x27;</span>,job=<span class="string">&#x27;prome_file_sd&#x27;</span>,mode=<span class="string">&#x27;system&#x27;</span>&#125;[1m])</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927102930773.png" alt="image-20240927102930773"></p><p><img src="../image/study_img/image-20240927153951299.png" alt="image-20240927153951299"></p><p>2ã€sumå‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>å‡½æ•°: ä¸»è¦æ˜¯èµ·åˆ°åŠ å’Œçš„ä½œç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total[1m])):</span><br><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;job=<span class="string">&#x27;prome_file_sd&#x27;</span>,mode=<span class="string">&#x27;system&#x27;</span>&#125;[1m]))</span><br><span class="line">    åœ¨<span class="string">&quot;increase(node_cpu[1m])&quot;</span>å¤–é¢å¥—ç”¨ä¸€ä¸ª<span class="built_in">sum</span>å‡½æ•°å°±å¯ä»¥æŠŠæ‰€æœ‰CPUæ ¸å¿ƒæ•°åœ¨1åˆ†é’Ÿå†…çš„å¢é‡åšä¸€ä¸ªç´¯åŠ ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;instance=<span class="string">&#x27;10.0.0.202:9100&#x27;</span>,job=<span class="string">&#x27;prome_file_sd&#x27;</span>,mode=<span class="string">&#x27;system&#x27;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927103557200.png" alt="image-20240927103557200"></p><p>3ã€byå‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">byå‡½æ•°:</span><br><span class="line">   å°†æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œç±»ä¼¼äºMySQLçš„<span class="string">&quot;group by&quot;</span>ã€‚</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line">by (instance):</span><br><span class="line">    è¿™é‡Œçš„<span class="string">&quot;instance&quot;</span>ä»£è¡¨çš„æ˜¯æœºå™¨åç§°ï¼Œæ„æ€æ˜¯å°†æ•°æ®æŒ‰ç…§instanceæ ‡ç­¾è¿›è¡Œå¼ºè¡Œæ‹†åˆ†ã€‚</span><br><span class="line">    è¯¥å‡½æ•°é€šå¸¸ä¼šå’Œ<span class="built_in">sum</span>å‡½æ•°æ­é…ä½¿ç”¨ï¼Œæ¯”å¦‚<span class="string">&quot;(sum(increase(node_cpu_seconds_total[1m]))by (instance))&quot;</span>,è¡¨ç¤ºæŠŠ<span class="built_in">sum</span>å‡½æ•°ä¸­ç´¯åŠ å’ŒæŒ‰ç…§<span class="string">&quot;instance&quot;</span>(æœºå™¨åç§°)å¼ºè¡Œæ‹†åˆ†æˆå¤šç»„æ•°æ®ã€‚å½“ç„¶ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæœºå™¨åç§°çš„è¯ï¼Œä½ ä¼šå‘ç°åªæœ‰ä¸€ç»„æ•°æ®ï¼Œå› æ­¤ä»ç»“æœä¸Šå¯èƒ½çœ‹ä¸åˆ°æ˜æ˜¾çš„å˜åŒ–å“Ÿã€‚</span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">instanceæ˜¯node_exporterå†…ç½®çš„æ ‡ç­¾ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ ‡ç­¾ï¼Œæ¯”å¦‚æ ¹æ®ç”Ÿäº§ç¯å¢ƒä¸­ä¸åŒçš„é›†ç¾¤æ·»åŠ ç›¸åº”çš„æ ‡ç­¾ã€‚æ¯”å¦‚åŸºäºè‡ªå®šä¹‰çš„<span class="string">&quot;cluster_name&quot;</span>æ ‡ç­¾è¿›è¡Œåˆ†ç»„ç­‰ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;job=<span class="string">&#x27;prome_file_sd&#x27;</span>,mode=<span class="string">&#x27;system&#x27;</span>&#125;[1m]))by(instance)</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span>(increase(node_cpu_seconds_total&#123;agent=<span class="string">&#x27;node_exporter&#x27;</span>,mode=<span class="string">&#x27;system&#x27;</span>&#125;[1m])) by(instance)</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927104801961.png" alt="image-20240927104801961"></p><p>4ã€rateå‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">rateå‡½æ•°:</span><br><span class="line">    å®ƒçš„åŠŸèƒ½æ˜¯æŒ‰ç…§è®¾ç½®çš„ä¸€ä¸ªæ—¶é—´æ®µï¼Œå–counteråœ¨è¿™ä¸ªæ—¶é—´æ®µä¸­çš„å¹³å‡æ¯ç§’çš„å¢é‡ã€‚å› æ­¤æ˜¯ä¸“é—¨æ­é…counterç±»å‹æ•°æ®ä½¿ç”¨çš„å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line">    rate(node_cpu_seconds_total[1m]):</span><br><span class="line">è·å–CPUæ€»ä½¿ç”¨æ—¶é—´åœ¨1åˆ†é’Ÿå†…çš„å¢åŠ çš„æ€»é‡å¹¶é™¤ä»¥60ç§’ï¼Œè®¡ç®—çš„æ˜¯æ¯ç§’çš„å¢é‡ã€‚</span><br><span class="line"></span><br><span class="line">    rate(node_network_receive_bytes_total[1m]):</span><br><span class="line">è·å–ä¸€åˆ†é’Ÿå†…ç½‘ç»œæ¥æ”¶çš„æ€»é‡ã€‚</span><br><span class="line">æŸ¥çœ‹çš„æ—¶é—´è¶ŠçŸ­ï¼ŒæŸä¸€ç¬é—´çš„çªèµ·æˆ–é™ä½åœ¨æˆå›¾çš„æ—¶å€™ä¼šä½“ç°çš„æ›´ç»†è‡´ï¼Œæ›´æ•æ„Ÿã€‚</span><br><span class="line"></span><br><span class="line">    rate(node_network_receive_bytes_total[20m])</span><br><span class="line">è·å–äºŒååˆ†é’Ÿå†…ç½‘ç»œæ¥æ”¶çš„æ€»é‡ã€‚</span><br><span class="line">æŸ¥çœ‹çš„æ—¶é—´è¶Šé•¿ï¼Œé‚£ä¹ˆå½“å‘ç”Ÿç¬é—´çš„çªèµ·æˆ–é™ä½æ—¶å€™ï¼Œä¼šæ˜¾å¾—å¹³ç¼“ä¸€äº›ï¼Œå› ä¸ºå–å¾—æ—¶é—´æ®µè¶Šé•¿ä¼šæŠŠæ³¢å³°æ³¢è°·éƒ½ç»™å¹³å‡æ¶ˆä¸‹å»äº†ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#increaseå‡½æ•°å’Œrateå‡½æ•°å¦‚æ­¤ç›¸ä¼¼å¦‚ä½•é€‰æ‹©?</span></span><br><span class="line">(1)å¯¹äºé‡‡é›†é¢‘ç‡è¾ƒä½çš„æ•°æ®é‡‡ç”¨å»ºè®®ä½¿ç”¨increaseå‡½æ•°ï¼Œå› ä¸ºä½¿ç”¨rateå‡½æ•°å¯èƒ½ä¼šå‡ºç°æ–­ç‚¹(æ¯”å¦‚æŒ‰ç…§5åˆ†é’Ÿé‡‡æ ·æ•°æ®é‡è¾ƒå°çš„åœºæ™¯ï¼Œä»¥é‡‡é›†ç¡¬ç›˜å¯ç”¨å®¹é‡ä¸ºä¾‹ï¼Œå¯èƒ½ä¼šå‡ºç°æŸæ¬¡é‡‡é›†æ•°æ®æœªé‡‡é›†åˆ°çš„æƒ…å†µï¼Œå› ä¸ºä¼šæŒ‰ç…§å¹³å‡æ¯ç§’æ¥è®¡ç®—æœ€ç»ˆçš„å¢é‡)çš„æƒ…å†µ;</span><br><span class="line"></span><br><span class="line">(2)å¯¹äºé‡‡é›†é¢‘ç‡è¾ƒé«˜çš„æ•°æ®é‡‡ç”¨å»ºè®®ä½¿ç”¨rateå‡½æ•°ï¼Œæ¯”å¦‚å¯¹CPUï¼Œå†…å­˜ï¼Œç½‘ç»œæµé‡ç­‰éƒ½å¯ä»¥åŸºäºrateå‡½æ•°æ¥é‡‡æ ·ï¼Œå½“ç„¶ï¼Œç¡¬ç›˜ä¹Ÿæ˜¯å¯ä»¥ç”¨rateå‡½æ•°æ¥é‡‡æ ·çš„å“Ÿ;</span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line"></span><br><span class="line">åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬å–ç›‘æ§é¢‘ç‡ä¸º1åˆ†é’Ÿè¿˜æ˜¯5åˆ†é’Ÿè¿™å–å†³ä¸æˆ‘ä»¬å¯¹äºç›‘æ§æ•°æ®çš„æ•æ„Ÿç¨‹åº¦æ¥æŒ‘é€‰ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rate(node_cpu_seconds_total&#123;agent=<span class="string">&#x27;node_exporter&#x27;</span>,mode=<span class="string">&#x27;system&#x27;</span>&#125;[1m])</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927105435679.png" alt="image-20240927105435679"></p><p>5ã€irateå‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  irateå‡½æ•°ï¼šä¸»è¦ç”¨äºè®¡ç®—å‘é‡ï¼ˆé€šå¸¸æ˜¯Counterç±»å‹çš„æ—¶é—´åºåˆ—ï¼‰åœ¨æ¯ä¸ªæ—¶é—´èŒƒå›´å†…çš„æ¯ç§’ç¬æ—¶å¢é•¿ç‡ã€‚ä¸rateå‡½æ•°ä¸åŒï¼Œirateç‰¹åˆ«å…³æ³¨äºæ—¶é—´èŒƒå›´å†…çš„æœ€åä¸¤ä¸ªæ•°æ®ç‚¹ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªç‚¹çš„å·®å€¼é™¤ä»¥å®ƒä»¬ä¹‹é—´çš„æ—¶é—´å·®æ¥å¾—åˆ°ç¬æ—¶å¢é•¿ç‡ã€‚è¿™ç§æ–¹å¼ä½¿å¾—irateåœ¨æ•æ‰å¿«é€Ÿå˜åŒ–æˆ–æ³¢åŠ¨è¾ƒå¤§çš„æ•°æ®æ—¶æ›´åŠ æ•æ„Ÿã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line">å‡è®¾æœ‰ä¸€ä¸ªåä¸ºhttp_requests_totalçš„Counterç±»å‹æ—¶é—´åºåˆ—ï¼Œè®°å½•äº†HTTPè¯·æ±‚çš„æ€»æ•°ã€‚è¦è®¡ç®—è¿‡å»5åˆ†é’Ÿå†…æ¯ç§’çš„HTTPè¯·æ±‚ç¬æ—¶å¢é•¿ç‡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹PromQLè¡¨è¾¾å¼ï¼š</span><br><span class="line">irate(http_requests_total[5m])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">irate(node_cpu_seconds_total&#123;agent=<span class="string">&#x27;node_exporter&#x27;</span>,mode=<span class="string">&#x27;system&#x27;</span>&#125;[1m])</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927105526235.png" alt="image-20240927105526235"></p><p>6ã€topkå‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">topkå‡½æ•°:</span><br><span class="line">    å–topæ¦œçš„å‰nåã€‚å®é™…ä½¿ç”¨çš„æ—¶å€™ä¸€èˆ¬ä¼šç”¨è¯¥å‡½æ•°è¿›è¡Œç¬æ—¶æŠ¥è­¦ï¼Œè€Œä¸æ˜¯ä¸ºäº†è§‚å¯Ÿæ›²çº¿å›¾ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line">     topk(3,rate(node_cpu_seconds_total[1m])):</span><br><span class="line">è·å–CPUæ€»ä½¿ç”¨æ—¶é—´åœ¨1åˆ†é’Ÿå†…çš„å¢åŠ çš„æ€»é‡å¹¶é™¤ä»¥60ç§’ï¼Œè®¡ç®—çš„æ˜¯æ¯ç§’çš„æ•°é‡ã€‚å¹¶åªæŸ¥çœ‹top3ã€‚</span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">æˆ‘ä»¬é€šå¸¸ä½¿ç”¨topkåªä¼šå…³æ³¨<span class="string">&quot;Console&quot;</span>ä¸­çš„ç¬æ—¶ç»“æœï¼Œä¸å¤ªä¼šå…³å¿ƒGraphçš„å‡ºå›¾æ•ˆæœï¼Œå› ä¸ºå…³æ³¨ä»–å¹¶æ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼Œå­˜åœ¨å¤ªå¤šçš„æ–­ç‚¹å•¦ï¼</span><br><span class="line">å¦‚æœå‡ºå›¾ä¼šå‡ºç°ä¸­æ–­çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºåœ¨xxåˆ†é’Ÿå†…è¿™ä¸€åˆ»çš„æ•°æ®å…¶å¹¶æ²¡æœ‰æ’è¿›top3ï¼Œè‡ªç„¶å°±ä¼šå‡ºç°æ–­ç‚¹çš„çŠ¶å†µ</span><br><span class="line"></span><br><span class="line">topk(10,rate(node_cpu_seconds_total&#123;agent=<span class="string">&#x27;node_exporter&#x27;</span>&#125;[1m]))</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927161431883.png" alt="image-20240927161431883"></p><p>7ã€countå‡½æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">count(container_last_seen&#123;instance=<span class="string">&#x27;10.0.0.201:8080&#x27;</span>,image!=<span class="string">&#x27;&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">countå‡½æ•°:</span><br><span class="line">    æŠŠæ•°å€¼ç¬¦åˆæ¡ä»¶çš„ï¼Œè¾“å‡ºæ•°ç›®è¿›è¡Œç´¯è®¡åŠ å’Œã€‚ä¸€èˆ¬ç”¨å®ƒè¿›è¡Œä¸€äº›æ¨¡ç³Šçš„ç›‘æ§åˆ¤æ–­ã€‚</span><br><span class="line">    æ¯”å¦‚è¯´ä¼ä¸šä¸­æœ‰100å°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆåªæœ‰10å°æœåŠ¡å™¨CPUä½¿ç”¨ç‡é«˜äº80%çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™ä¸éœ€è¦æŠ¥è­¦ï¼Œå½“ç¬¦åˆ80%CPUçš„æœåŠ¡å™¨æ•°é‡è¶…è¿‡70å°çš„æ—¶å€™é‚£ä¹ˆå°±è§¦å‘æŠ¥è­¦ã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸¾ä¸ªä¾‹å­:</span></span><br><span class="line">    count(aaa_tcp_wait_conn &gt; 500):</span><br><span class="line">æˆ‘ä»¬å‡è®¾aaa_tcp_wait_connæ˜¯å’±ä»¬è‡ªå®šä¹‰çš„KEYï¼Œä¸Šè¿°æ¡ˆä¾‹æ˜¯æ‰¾å‡ºå½“å‰(æˆ–è€…å†å²çš„)å½“å‰TCPç­‰å¾…æ•°å¤§äº500çš„æœºå™¨æ•°é‡ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»Ÿè®¡node01ä¸Šæœ‰å¤šå°‘å°å®¹å™¨</span></span><br><span class="line">image!=<span class="string">&#x27;&#x27;</span>  imageä¸ç­‰äºç©ºçš„å°±æ˜¯å®¹å™¨</span><br><span class="line"></span><br><span class="line">countç»Ÿè®¡ä»–æœ‰å¤šå°‘è¡Œ</span><br><span class="line">count(container_last_seen&#123;instance=<span class="string">&#x27;10.0.0.201:8080&#x27;</span>,image!=<span class="string">&#x27;&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240927162241644.png" alt="image-20240927162241644"></p><p><strong>å‡½æ•°ç»ƒä¹ ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1ã€è®¡ç®—å„èŠ‚ç‚¹çš„CPUçš„æ€»ä½¿ç”¨ç‡ï¼Œå‚è€ƒå…¬å¼:100%-(CPUç©ºé—²æ—¶é—´/æ€»æ—¶é—´)</span><br><span class="line">(1)æˆ‘ä»¬éœ€è¦å…ˆæ‰¾åˆ°æŸ¥çœ‹CPUçš„keyåç§°</span><br><span class="line">node_cpu_seconds_total</span><br><span class="line"></span><br><span class="line">(2)æŒ‰æœºå™¨åˆ†ç»„ï¼Œè®¡ç®—å‡ºæ¯ä¸ªæœºå™¨çš„ç©ºé—²æ—¶é—´</span><br><span class="line"><span class="built_in">sum</span>(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;)by(instance)</span><br><span class="line"></span><br><span class="line">(3)æŒ‰æœºå™¨åˆ†ç»„ï¼Œè®¡ç®—å‡ºæ¯ä¸ªæœºå™¨çš„æ€»æ—¶é—´</span><br><span class="line"><span class="built_in">sum</span>(node_cpu_seconds_total) by(instance)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(4)CPUç©ºé—²æ—¶é—´/æ€»æ—¶é—´=ç©ºé—²ç‡</span><br><span class="line"><span class="built_in">sum</span>(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;)by(instance)/sum(node_cpu_seconds_total) by(instance)</span><br><span class="line"></span><br><span class="line">(5)æ¯å°æœºå™¨çš„CPUçš„æ€»ä½¿ç”¨ç‡</span><br><span class="line">1-(<span class="built_in">sum</span>(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;idle&#x27;</span>&#125;)by(instance)/sum(node_cpu_seconds_total) by(instance))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€è®¡ç®—ç”¨æˆ·æ€çš„CPUä½¿ç”¨ç‡</span><br><span class="line"><span class="built_in">sum</span>(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;user&#x27;</span>&#125;)by(instance)/sum(node_cpu_seconds_total) by(instance)</span><br><span class="line"></span><br><span class="line">3ã€è®¡ç®—å†…æ ¸æ€çš„CPUä½¿ç”¨ç‡</span><br><span class="line"><span class="built_in">sum</span>(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;system&#x27;</span>&#125;)by(instance)/sum(node_cpu_seconds_total) by(instance)</span><br><span class="line"></span><br><span class="line">4ã€è®¡ç®—IOç­‰å¾…çš„CPUä½¿ç”¨ç‡</span><br><span class="line"><span class="built_in">sum</span>(node_cpu_seconds_total&#123;mode=<span class="string">&#x27;iowait&#x27;</span>&#125;)by(instance)/sum(node_cpu_seconds_total) by(instance)</span><br></pre></td></tr></table></figure><h3 id="7ã€ä½¿ç”¨pushgatewayè‡ªå®šä¹‰ç›‘æ§"><strong>7ã€ä½¿ç”¨pushgatewayè‡ªå®šä¹‰ç›‘æ§</strong></h3><p><strong>pushgatewayä»‹ç»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨è„šæœ¬ç›‘æ§å°†æ•°æ®æ¨é€åˆ°pushgatewayä¸Šï¼ŒPromethuesä»pushgatewayä¸­æ‹‰å–æ•°æ® (å¯ä»¥æŠŠpushgatewayå½“åˆPrometheusçš„å®¢æˆ·ç«¯ï¼ŒPrometheusä¹Ÿæ˜¯æ‹‰å–æ•°æ®)</span><br><span class="line"></span><br><span class="line">å®ƒæ˜¯å¯ä»¥å•ç‹¬è¿è¡Œåœ¨ä»»ä½•èŠ‚ç‚¹(ä¸ä¸€å®šæ˜¯åœ¨è¢«ç›‘æ§å®¢æˆ·ç«¯)ä¸Šçš„æ’ä»¶ï¼Œç„¶åé€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰å¼€å‘è„šæœ¬æŠŠéœ€è¦ç›‘æ§çš„æ•°æ®å‘é€ç»™pushgatewayï¼Œå†ç”±pushgatewayæš´éœ²httpæ¥å£,è€Œåç”±æŠŠprometheus serverå»pullæ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">pushgatewayç»„ä»¶æœ¬èº«æ˜¯æ²¡æœ‰ä»»ä½•æŠ“å–ç›‘æ§æ•°æ®åŠŸèƒ½çš„ï¼Œå®ƒåªèƒ½è¢«åŠ¨çš„ç­‰å¾…ç›‘æ§æ•°æ®è¢«æ¨é€è¿‡æ¥ã€‚</span><br></pre></td></tr></table></figure><p><strong>Prometheuså…³è”pushgateway</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–¹æ³•ä¸€ï¼šä¿®æ”¹Prometheusé…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@master01 prometheus]# vim prometheus.yml</span><br><span class="line">scrape_configs:</span><br><span class="line">.....</span><br><span class="line"><span class="comment">#æ·»åŠ è‡ªåŠ¨å‘ç°è§„åˆ™</span></span><br><span class="line"> - job_name: <span class="string">&quot;prome_file_sd&quot;</span></span><br><span class="line">    file_sd_configs:</span><br><span class="line">    - files:</span><br><span class="line">      - /app/prometheus/file_sd/agent.yml</span><br><span class="line">      refresh_interval: 5s</span><br><span class="line"></span><br><span class="line">2ã€é‡å¯Prometheus</span><br><span class="line">[root@master01 prometheus]# supervisorctl restart all</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼šç¼–è¾‘æ–‡ä»¶å‘ç°çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">ä»¥åå¯èƒ½åƒpushgatewayä¹Ÿè¦åŠ è¿›æ¥</span><br><span class="line">[root@master01 prometheus]# vim /app/prometheus/file_sd/agent.yml</span><br><span class="line">[</span><br><span class="line">.....</span><br><span class="line"> &#123;</span><br><span class="line">    <span class="string">&quot;targets&quot;</span>:  [<span class="string">&quot;10.0.0.200:9091&quot;</span>],</span><br><span class="line">    <span class="string">&quot;labels&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;agent&quot;</span>: <span class="string">&quot;pushgateway&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">      </span><br><span class="line"><span class="comment">#ä¸éœ€è¦é‡å¯</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240930182759622.png" alt="image-20240930182759622"></p><p><strong>pushgatewayçš„ä¼˜ç¼ºç‚¹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pushgatewayé»˜è®¤ä¼šæœ‰ä¸€äº›æ•°æ®ï¼Œå¹¶ä¸å¤šï¼Œä¸»è¦æ˜¯è‡ªå®šä¹‰ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰æ•°æ®è¦å†™è„šæœ¬ï¼Œåªè¦èƒ½å†™è„šæœ¬è·å–åˆ°çš„æ•°æ®éƒ½å¯ä»¥ç›‘æ§</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼˜ç‚¹:</span></span><br><span class="line">çµæ´»æ€§æ›´å¼ºã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼ºç‚¹:</span></span><br><span class="line">(1)å­˜åœ¨å•ç‚¹ç“¶é¢ˆï¼Œå‡å¦‚æœ‰å¤šä¸ªè„šæœ¬åŒæ—¶å‘ç»™ä¸€ä¸ªpushgatewayè¿›ç¨‹ï¼Œå¦‚æœè¯¥pushgatewayè¿›ç¨‹æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆç›‘æ§æ•°æ®ä¹Ÿå°±æ²¡äº†ã€‚</span><br><span class="line">(2)pushgatewayå¹¶ä¸èƒ½å¯¹å‘é€è¿‡æ¥çš„è„šæœ¬é‡‡é›†æ•°æ®è¿›è¡Œæ›´æ™ºèƒ½çš„åˆ¤æ–­ï¼Œå‡å¦‚è„šæœ¬ä¸­é—´é‡‡é›†å‡ºäº†é—®é¢˜ï¼Œé‚£ä¹ˆæœ‰é—®é¢˜çš„æ•°æ®pushgatewayç»„ä»¶ä¼šç…§å•å…¨æ”¶å‘é€ç»™Prometheus serverã€‚(ä¹Ÿå°±æ˜¯è¯´ä»–ä¸èƒ½åšåˆ¤æ–­ï¼Œæ”¶é›†åˆ°å•¥å°±ä¼ å•¥ï¼Œæ‰€ä»¥å†™çš„è„šæœ¬ä¸€å®šè¦ç²¾ç¡®)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">å¯¹äºç¼ºç‚¹ä¸€ï¼Œå»ºè®®å¤§å®¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¤šå¼€å¯å‡ ä¸ªpushgatewayè¿›ç¨‹ï¼Œå‰é¢åŠ ä¸ªè´Ÿè½½å‡è¡¡ï¼Œä»¥ä¾¿äºå¤‡ä»½ä½¿ç”¨ã€‚</span><br><span class="line">å¦‚æœä½¿ç”¨è´Ÿè½½å‡è¡¡ï¼Œé…ç½®æ–‡ä»¶çš„å†™æ³•æ˜¯ï¼š</span><br><span class="line">[root@master01 prometheus]# vim /app/prometheus/file_sd/agent.yml</span><br><span class="line">[</span><br><span class="line">.....</span><br><span class="line"> &#123;</span><br><span class="line">    <span class="string">&quot;targets&quot;</span>:  [<span class="string">&quot;ç”¨åŸŸåæˆ–è€…è´Ÿè½½å‡è¡¡çš„ip:9091&quot;</span>],</span><br><span class="line">    <span class="string">&quot;labels&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;agent&quot;</span>: <span class="string">&quot;pushgateway&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">å¯¹äºç¼ºç‚¹äºŒï¼Œå»ºè®®å¤§å®¶åœ¨ç¼–å†™è„šæœ¬æ—¶è¦æ³¨æ„ä¸šåŠ¡é€»è¾‘ï¼Œå°½å¯èƒ½é¿å…è„šæœ¬å‡ºé”™çš„æƒ…å†µå‘ç”Ÿã€‚</span><br></pre></td></tr></table></figure><p><strong>å•ä¸ªæ•°æ®è‡ªå®šä¹‰ç›‘æ§â€”â€”ç”¨æˆ·ç™»å½•æ•°é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é¦–å…ˆä½ æƒ³ç›‘æ§å“ªå°æœºå™¨ï¼Œå°±æŠŠè„šæœ¬å†™åœ¨å“ªä¸ªæœºå™¨ä¸Š</span></span><br><span class="line"></span><br><span class="line">1ã€ç¼–å†™è‡ªå®šä¹‰ç›‘æ§â€”â€”ç”¨æˆ·ç™»å½•æ•°é‡çš„è„šæœ¬</span><br><span class="line">[root@node03 ~]# vim user_count.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#è·å–ä¸»æœºåhostname -sçŸ­çš„ä¸»æœºå  hostnameé•¿çš„ä¸»æœºå</span></span><br><span class="line">INSTANCE_NAME=$(hostname -s)</span><br><span class="line"><span class="comment">#åˆ¤æ–­å¦‚æœæ˜¯æ²¡æœ‰ä¿®æ”¹ä¸»æœºåå°±æŠ¥é”™</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$INSTANCE_NAME</span>&quot;</span> == <span class="string">&quot;localhost&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;å¿…é¡»è¦å®Œæ•´çš„ä¸»æœºå&quot;</span></span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰PrometheusæŠ“å–åˆ°çš„ç›‘æ§é¡¹çš„keyåå­—ï¼Œ</span></span><br><span class="line">METRICS_NAME=<span class="string">&quot;user_count&quot;</span></span><br><span class="line"><span class="comment">#è·å–ç”¨æˆ·çš„ç™»å½•æ•°é‡(ç›‘æ§é¡¹çš„å€¼çš„è·å–)</span></span><br><span class="line">USER_COUNT_VALUE=$(<span class="built_in">uptime</span> |grep -Po <span class="string">&#x27;[0-9]+(?= user)&#x27;</span>)</span><br><span class="line"><span class="comment">#å‘é€æ•°æ®  æŠŠechoçš„å†…å®¹äº¤ç»™curl --data-binary å‘é€äºŒè¿›åˆ¶çš„æ•°æ®,åé¢çš„è·¯å¾„å¯ä»¥è‡ªå®šä¹‰</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$METRICS_NAME</span> <span class="variable">$USER_COUNT_VALUE</span>&quot;</span> |curl --data-binary @- http://10.0.0.200:9091/metrics/job/sh_job/instance/<span class="variable">$INSTANCE_NAME</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@node03 ~]# sh user_count.sh</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹é¡µé¢</span><br><span class="line">10.0.0.200:9091</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240930202019536.png" alt="image-20240930202019536"></p><p>é¦–å…ˆå›¾ä¸­çš„æ•°æ®ç±»å‹æ˜¯ UNTYPED æˆ‘å¹¶æ²¡æœ‰å®šä¹‰æ•°æ®ç±»å‹çš„,æŸ¥çœ‹æ•°æ®æŒ‡æ ‡10.0.0.200:9091/metricï¼Œä»–è‡ªå·±åŠ çš„untype</p><p><img src="../image/study_img/image-20240930203034740.png" alt="image-20240930203034740"></p><p>PrometheusæŸ¥çœ‹æ•°æ®</p><p><img src="../image/study_img/image-20240930202427231.png" alt="image-20240930202427231"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">user_count&#123;agent=<span class="string">&quot;pushgateway&quot;</span>, exported_instance=<span class="string">&quot;node03&quot;</span>, exported_job=<span class="string">&quot;sh_job&quot;</span>, instance=<span class="string">&quot;10.0.0.200:9091&quot;</span>, job=<span class="string">&quot;prome_file_sd&quot;</span>&#125;   æ˜¾ç¤ºçš„ç»“æœæ˜¯è‡ªå®šä¹‰çš„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¸Šé¢æåˆ°è¿‡</span><br><span class="line"><span class="comment">#æŒ‡æ ‡æ•°æ®æ ¼å¼å°±æ˜¯å¦‚ä¸‹ï¼š</span></span><br><span class="line">1ã€è¦æœ‰ä¸€è¡Œæè¿°</span><br><span class="line">2ã€è¦æœ‰ä¸€è¡ŒæŒ‡æ ‡ç±»å‹å®šä¹‰</span><br><span class="line">3ã€çœŸå®æ•°æ®(æ•°æ®æ ¼å¼æ˜¯Key value)</span><br><span class="line"><span class="comment">#æ•°æ®æè¿°</span></span><br><span class="line"><span class="comment"># HELP node_cpu_seconds_total Seconds the CPUs spent in each mode.</span></span><br><span class="line"><span class="comment">#æ•°æ®ç±»å‹ (æŒ‡æ ‡ç±»å‹)</span></span><br><span class="line"><span class="comment"># TYPE keyåå­— counter</span></span><br><span class="line">node_cpu_seconds_total&#123;cpu=<span class="string">&quot;0&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125; 335802.19</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€ä¿®æ”¹è„šæœ¬ï¼Œå®šä¹‰æ•°æ®ç±»å‹,å¹¶åŠ ä¸Šå¾ªç¯</span><br><span class="line">[root@node03 ~]# vim user_count.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">  <span class="comment">#è·å–ä¸»æœºåhostname -sçŸ­çš„ä¸»æœºå  hostnameé•¿çš„ä¸»æœºå</span></span><br><span class="line">  INSTANCE_NAME=$(hostname -s)</span><br><span class="line">  <span class="comment">#åˆ¤æ–­å¦‚æœæ˜¯æ²¡æœ‰ä¿®æ”¹ä¸»æœºåå°±æŠ¥é”™</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$INSTANCE_NAME</span>&quot;</span> == <span class="string">&quot;localhost&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">     <span class="built_in">echo</span> <span class="string">&quot;å¿…é¡»è¦å®Œæ•´çš„ä¸»æœºå&quot;</span></span><br><span class="line">     <span class="built_in">exit</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#å®šä¹‰PrometheusæŠ“å–åˆ°çš„ç›‘æ§é¡¹çš„keyåå­—ï¼Œ</span></span><br><span class="line">  METRICS_NAME=<span class="string">&quot;user_count&quot;</span></span><br><span class="line">  <span class="comment">#è·å–ç”¨æˆ·çš„ç™»å½•æ•°é‡(ç›‘æ§é¡¹çš„å€¼çš„è·å–)</span></span><br><span class="line">  USER_COUNT_VALUE=$(<span class="built_in">uptime</span> |grep -Po <span class="string">&#x27;[0-9]+(?= user)&#x27;</span>)</span><br><span class="line">  <span class="comment">#å‘é€æ•°æ®  æŠŠechoçš„å†…å®¹äº¤ç»™curl --data-binary å‘é€äºŒè¿›åˆ¶çš„æ•°æ®,åé¢çš„è·¯å¾„å¯ä»¥è‡ªå®šä¹‰ \nå›è½¦  gaugeï¼šç¬æ—¶å€¼ï¼Œå½“å‰æœ€æ–°çš„å€¼</span></span><br><span class="line">  <span class="built_in">echo</span> -e <span class="string">&quot;# TYPE <span class="variable">$&#123;METRICS_NAME&#125;</span> gauge\n<span class="variable">$METRICS_NAME</span> <span class="variable">$USER_COUNT_VALUE</span>&quot;</span> |curl --data-binary @- http://10.0.0.200:9091/metrics/job/sh_job/instance/<span class="variable">$INSTANCE_NAME</span></span><br><span class="line">  <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€ç”±äºè„šæœ¬é‡Œé¢å†™äº†æ­»å¾ªç¯ï¼Œä¸èƒ½ç›´æ¥æ‰§è¡Œè„šæœ¬ï¼Œå¯ä»¥ç”¨supervisorå»ç®¡ç†</span><br><span class="line">ä»¥åæ‰€ä»¥å¾—ç›‘æ§è„šæœ¬éƒ½å¯ä»¥æ”¾è¿™é‡Œï¼Œæ‰€æœ‰çš„ç›‘æ§é¡¹éƒ½å¯ä»¥èµ·æ¥</span><br><span class="line">[root@node03 ~]# vim /etc/supervisord.d/push.ini </span><br><span class="line">[program:user_count]</span><br><span class="line"><span class="comment">#è¿™é‡Œå»ºè®®è„šæœ¬å»ºä¸€ä¸ªç›®å½•å­˜æ”¾</span></span><br><span class="line">directory=/root</span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/bin/sh /root/user_count.sh&quot;</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/var/log/node_exporter_stdout.log</span><br><span class="line">stderr_logfile=/var/log/node_exporter_stderr.log</span><br><span class="line">user=root</span><br><span class="line">stopsignal=TERM</span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line">[root@node03 ~]# supervisorctl update</span><br><span class="line">[root@node03 ~]# supervisorctl restart all</span><br><span class="line">[root@node03 ~]# supervisorctl status</span><br><span class="line">node_exporter                    RUNNING   pid 8440, <span class="built_in">uptime</span> 1 day, 12:35:41</span><br><span class="line">user_count                       RUNNING   pid 107360, <span class="built_in">uptime</span> 0:02:39</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€éªŒè¯æ˜¯å¦è¿è¡Œ</span><br><span class="line">å¤šå¼€å‡ ä¸ªç»ˆç«¯ï¼Œå»Prometheusé‡Œé¢æŸ¥è¯¢æ•°æ®</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240930212805096.png" alt="image-20240930212805096"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‘½ä»¤è¡Œç®€å†ç›‘æ§æ•°æ®</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;# TYPE keyåå­— gauge\nkeyåå­— value&quot;</span> |curl --data-binary @- http://10.0.0.200:9091/metrics/job/é¡¹ç›®å/instance/ä¸»æœºå</span><br><span class="line"></span><br><span class="line">[root@node03 ~]# <span class="built_in">echo</span> -e <span class="string">&quot;# TYPE aaa gauge\naaa 111&quot;</span> |curl --data-binary @- http://10.0.0.200:9091/metrics/job/aaa/instance/node03</span><br><span class="line"></span><br><span class="line">æ•°æ®æŒ‡æ ‡ä¸­å°±ä¼šç”Ÿæˆaaaçš„key</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240930224338728.png" alt="image-20240930224338728"></p><p><img src="../image/study_img/image-20240930224429624.png" alt="image-20240930224429624"></p><p><strong>å¤šä¸ªæ•°æ®è‡ªå®šä¹‰ç›‘æ§â€”â€”ç›‘æ§å®¹å™¨è¿è¡Œæ—¶é—´</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">è·å–cadvisorçš„è¿è¡Œæ—¶é—´</span><br><span class="line">[root@node03 ~]# docker inspect -f <span class="string">&#x27;&#123;&#123;.State.StartedAt&#125;&#125;&#x27;</span> cadvisor</span><br><span class="line">2024-09-30T10:06:13.136629499Z</span><br><span class="line">[root@node03 ~]# docker inspect -f <span class="string">&#x27;&#123;&#123;.State.StartedAt&#125;&#125;&#x27;</span> cadvisor</span><br><span class="line">2024-09-30T10:06:13.136629499Z</span><br><span class="line">[root@node03 ~]# docker inspect -f <span class="string">&#x27;&#123;&#123;.State.StartedAt&#125;&#125;&#x27;</span> cadvisor</span><br><span class="line">2024-09-30T10:06:13.136629499Z</span><br><span class="line">[root@node03 ~]# <span class="built_in">date</span> +%s -d 2024-09-30T10:06:13.136629499Z</span><br><span class="line">1727690773</span><br><span class="line">[root@node03 ~]# <span class="built_in">date</span> +%s </span><br><span class="line">1727708230</span><br><span class="line">[root@node03 ~]# <span class="built_in">let</span> res=1727708230-1727690773</span><br><span class="line">[root@node03 ~]# <span class="built_in">echo</span> <span class="variable">$res</span></span><br><span class="line">17457</span><br><span class="line">[root@node03 ~]# python</span><br><span class="line">&gt;&gt;&gt; 17457/60/60</span><br><span class="line">4</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span><span class="string">&quot;# TYPE <span class="variable">$&#123;metrics_name&#125;</span> gauge  </span></span><br><span class="line"><span class="string"># HELP <span class="variable">$&#123;metrics_name&#125;</span> time sec&quot;</span><span class="string">&quot;&quot;</span> &gt; docker_temp.log</span><br><span class="line"></span><br><span class="line">1ã€ç¼–å†™å¤šä¸ªæ•°æ®è‡ªå®šä¹‰ç›‘æ§â€”â€”ç›‘æ§å®¹å™¨è¿è¡Œæ—¶é—´çš„è„šæœ¬</span><br><span class="line">[root@node03 ~]# vim runtime.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"><span class="comment">#è·å–ä¸»æœºåhostname -sçŸ­çš„ä¸»æœºå  hostnameé•¿çš„ä¸»æœºå</span></span><br><span class="line">instance_name=$(hostname -s)</span><br><span class="line">metrics_name=docker_runtime</span><br><span class="line"><span class="comment">#åˆ¤æ–­å¦‚æœæ˜¯æ²¡æœ‰ä¿®æ”¹ä¸»æœºåå°±æŠ¥é”™</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$instance_name</span>&quot;</span> == <span class="string">&quot;localhost&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;å¿…é¡»è¦å®Œæ•´çš„ä¸»æœºå&quot;</span></span><br><span class="line">   <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–æ‰€ä»¥è¿è¡Œå®¹å™¨çš„åç§° &#123;&#123;.Names&#125;&#125;ç›¸å½“äºé‡‘ç”²æ¨¡ç‰ˆçš„è°ƒç”¨å˜é‡</span></span><br><span class="line">allname=$(docker ps --format <span class="string">&quot;&#123;&#123;.Names&#125;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">docker_run</span></span>()&#123;</span><br><span class="line">      <span class="comment">#è·å–å„ä¸ªå®¹å™¨çš„å¯åŠ¨æ—¶é—´</span></span><br><span class="line">      start_time=$(docker inspect -f <span class="string">&#x27;&#123;&#123;.State.StartedAt&#125;&#125;&#x27;</span> <span class="variable">$1</span>)</span><br><span class="line">      <span class="comment">#å°†æ—¶é—´è½¬æ¢ä½æ—¶é—´æˆ³</span></span><br><span class="line">      time1=$(<span class="built_in">date</span> +%s -d <span class="string">&quot;<span class="variable">$start_time</span>&quot;</span>)</span><br><span class="line">      <span class="comment">#è·å–å½“å‰çš„æ—¶é—´æˆ³</span></span><br><span class="line">      time2=$(<span class="built_in">date</span> +%s)</span><br><span class="line">      <span class="comment">#è®¡ç®—è¿è¡Œæ—¶é—´</span></span><br><span class="line">      <span class="built_in">let</span> tt=<span class="variable">$time2</span>-<span class="variable">$time1</span></span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$tt</span></span><br><span class="line">      <span class="built_in">return</span> <span class="variable">$tt</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†éœ€è¦å¾€pushgatewayä¸Šä¼ çš„æ•°æ®å†™å…¥&quot;docker_temp.log&quot;æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;# TYPE <span class="variable">$&#123;metrics_name&#125;</span> gauge&quot;</span> &gt; docker_temp.log  </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;# HELP <span class="variable">$&#123;metrics_name&#125;</span> time sec&quot;</span> &gt;&gt; docker_temp.log</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;allname&#125;</span>;<span class="keyword">do</span></span><br><span class="line">    start_time=$(docker_run <span class="variable">$i</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$metrics_name</span>&#123;name=\&quot;<span class="variable">$i</span>\&quot;,aaa=\&quot;xxx\&quot;&#125; <span class="variable">$start_time</span>&quot;</span> &gt;&gt;  docker_temp.log <span class="comment"># æ ¼å¼åŒ–å†™å…¥æ•°æ®</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹åœ°å€å’Œå‚æ•°åå‘ç‰¹å®šçš„urlä¸Šä¼ æ•°æ®ï¼Œæ•°æ®åœ¨doceker_temp.logæ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment">#curl äºŒè¿›åˆ¶ @æ–‡ä»¶å æŠŠä¸ªæ–‡ä»¶é‡Œé¢çš„å†…å®¹äº¤ç»™åé¢çš„url</span></span><br><span class="line">curl --data-binary <span class="string">&quot;@docker_temp.log&quot;</span> http://10.0.0.200:9091/metrics/job/docker_runtime/instance/<span class="variable">$instance_name</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æƒ…å†µä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#rm -rf docker_temp.log</span></span><br><span class="line"><span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">2ã€å°†è„šæœ¬åŠ å…¥supervisor</span><br><span class="line">[root@node03 ~]# vim /etc/supervisord.d/push.ini </span><br><span class="line">[program:docker_runtime]</span><br><span class="line">directory=/root</span><br><span class="line"><span class="built_in">command</span>=/bin/bash -c <span class="string">&quot;/bin/sh /root/runtime.sh&quot;</span></span><br><span class="line">autostart=<span class="literal">true</span></span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">stdout_logfile=/var/log/node_exporter_stdout.log</span><br><span class="line">stderr_logfile=/var/log/node_exporter_stderr.log</span><br><span class="line">user=root</span><br><span class="line">stopsignal=TERM</span><br><span class="line">startsecs=5</span><br><span class="line">startretries=3</span><br><span class="line">stopasgroup=<span class="literal">true</span></span><br><span class="line">killasgroup=<span class="literal">true</span></span><br><span class="line">[root@node03 ~]# supervisorctl update</span><br><span class="line">[root@node03 ~]# supervisorctl status</span><br><span class="line">docker_runtime                   RUNNING   pid 29434, <span class="built_in">uptime</span> 0:00:07</span><br><span class="line">node_exporter                    RUNNING   pid 8372, <span class="built_in">uptime</span> 5:48:45</span><br><span class="line">user_count                       RUNNING   pid 8374, <span class="built_in">uptime</span> 5:48:45</span><br><span class="line"></span><br><span class="line">3ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.200:9091          10.0.0.200:9091/metrics</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20241001220001771.png" alt="image-20241001220001771"></p><p><img src="../image/study_img/image-20241001220252497.png" alt="image-20241001220252497"></p><p>PrometheusæŸ¥çœ‹æ•°æ®</p><p><img src="../image/study_img/image-20241001220418085.png" alt="image-20241001220418085"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">éªŒè¯æ²¡é—®é¢˜ä¹‹åï¼ŒæŠŠè„šæœ¬å‘é€ç»™å…¶ä»–nodeèŠ‚ç‚¹ï¼Œå¹¶æ‰§è¡Œï¼Œå°±å¯ä»¥è·å–åˆ°æ•°æ®äº†</span><br></pre></td></tr></table></figure><p><strong>ç›‘æ§å†…å­˜ä½¿ç”¨ç‡    (è¿™ä¸ªæ˜¯è‡ªå¸¦çš„ï¼Œä¸éœ€è¦å†™è„šæœ¬ï¼Œç›´æ¥å¯ä»¥æŸ¥å‡ºæ¥)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å‚è€ƒæ¡ˆä¾‹:</span><br><span class="line">(1 - (node_memory_Buffers_bytes + node_memory_Cached_bytes + node_memory_MemFree_bytes) / node_memory_MemTotal_bytes) * 100</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20241001223311889.png" alt="image-20241001223311889"></p><p><strong>ç›‘æ§ç¡¬ç›˜çš„ä½¿ç”¨æƒ…å†µ    (è¿™ä¸ªæ˜¯è‡ªå¸¦çš„ï¼Œä¸éœ€è¦å†™è„šæœ¬ï¼Œç›´æ¥å¯ä»¥æŸ¥å‡ºæ¥)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å‚è€ƒæ¡ˆä¾‹:</span><br><span class="line">(node_filesystem_free_bytes / node_filesystem_size_bytes) &lt; 0.95</span><br><span class="line"></span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">(1)ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®å¤§å®¶å°†0.95æ”¹ä¸º0.20ï¼Œè¡¨ç¤ºå½“ç©ºé—²ç¡¬ç›˜å°äº20%çš„æ—¶å€™å°±æ˜¾ç¤ºåœ¨å›¾ä¸Š;</span><br><span class="line">(2)æˆ‘ä¹‹æ‰€ä»¥å†™0.95æ˜¯å› ä¸ºæˆ‘çš„ç©ºé—²ç¡¬ç›˜æŒºå¤§çš„ï¼Œä¸ºäº†è®©å¤§å®¶çœ‹åˆ°å‡ºå›¾çš„æ•ˆæœè€Œå·²ã€‚</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20241001223441812.png" alt="image-20241001223441812"></p><p><strong>ç›‘æ§ç¡¬ç›˜I/Oä½¿ç”¨æƒ…å†µ  (è¿™ä¸ªæ˜¯è‡ªå¸¦çš„ï¼Œä¸éœ€è¦å†™è„šæœ¬ï¼Œç›´æ¥å¯ä»¥æŸ¥å‡ºæ¥)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‚è€ƒæ¡ˆä¾‹:</span><br><span class="line">rate(node_network_transmit_bytes_total[1m]) / 1024 / 1024</span><br><span class="line"></span><br><span class="line">node_network_transmit_bytes_total:</span><br><span class="line">ç½‘ç»œä¼ è¾“å­—èŠ‚æ•°ã€‚</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20241001223636224.png" alt="image-20241001223636224"></p><p><strong>ç›‘æ§æ–‡ä»¶æè¿°ç¬¦</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">å‚è€ƒæ¡ˆä¾‹:</span><br><span class="line">(node_filefd_allocated / node_filefd_maximum) * 100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">node_filefd_allocated:</span><br><span class="line">å·²åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">node_filefd_maximum:</span><br><span class="line">ä¸€ä¸ªè¿›ç¨‹è¿è¡Œæœ€å¤§æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„æ€»é‡ã€‚</span><br><span class="line"></span><br><span class="line">(1)ç¼–å†™è„šæœ¬</span><br><span class="line">[root@docker201 ~]# vim network_delay.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#instance_name=`hostname -i` # è¯¥æŒ‡ä»¤è¦æ±‚hostsæ–‡ä»¶å¿…é¡»æœ‰è§£æ</span></span><br><span class="line">instance_name=$(hostname -s) </span><br><span class="line"></span><br><span class="line"><span class="comment"># è¦æ±‚æœºå™¨åä¸èƒ½æ˜¯&quot;localhost&quot;ä¸ç„¶æ ‡ç­¾å°±æ²¡æœ‰åŒºåˆ†äº†</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$instance_name</span> == <span class="string">&quot;localhost&quot;</span> ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Must FQDN hostname&quot;</span></span><br><span class="line">    <span class="built_in">exit</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šéœ€è¦pingçš„ä¸»æœº</span></span><br><span class="line">monitoring_site=<span class="string">&quot;www.aaa.com&quot;</span></span><br><span class="line"><span class="comment"># è·å–ä¸¢åŒ…ç‡ç›¸å…³å­—æ®µ</span></span><br><span class="line"><span class="comment"># -q:</span></span><br><span class="line"><span class="comment"># å®‰é™æ¨¡å¼pingï¼Œå³ä¸è¾“å‡ºæ¯æ¬¡pingçš„è¿”å›çš„ä¸­é—´ç»“æœï¼Œä»…è¿”å›æœ€ç»ˆçš„ç»“æœã€‚</span></span><br><span class="line"><span class="comment"># -A:</span></span><br><span class="line"><span class="comment"># å¯ç”¨å¹¶è¡Œçš„pingæ•ˆæœï¼Œå¯ä»¥åŠ å¿«pingçš„å¤„ç†è¿‡ç¨‹ã€‚</span></span><br><span class="line"><span class="comment"># -s:</span></span><br><span class="line"><span class="comment"># ä¸€ä¸ªpingåŒ…çš„å¤§å°ã€‚</span></span><br><span class="line"><span class="comment"># -W:</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œpingå‘½ä»¤æœ€å¤§çš„å»¶è¿Ÿç­‰å¾…æ—¶é—´(timeout),ä»¥msä¸ºå•ä½ã€‚</span></span><br><span class="line"><span class="comment"># -c:</span></span><br><span class="line"><span class="comment"># å‘é€å¤šå°‘ä¸ªæ•°æ®åŒ…ã€‚</span></span><br><span class="line">package_loss_rate=`<span class="built_in">timeout</span> 5 ping -q -A -s 500 -W 1000 -c 100 <span class="variable">$monitoring_site</span> |</span><br><span class="line">grep transmitted | awk <span class="string">&#x27;&#123;print $6&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å»¶è¿Ÿæƒ…å†µçš„ç›¸å…³å­—æ®µ(æœ¬è´¨ä¸Šæ˜¯æ‰§è¡Œpingå‘½ä»¤æ‰€è€—è´¹çš„æ—¶é—´å“Ÿ~)</span></span><br><span class="line">delay_time=`<span class="built_in">timeout</span> 5 ping -q -A -s 500 -W 1000 -c 100 <span class="variable">$monitoring_site</span> | grep transmitted | awk <span class="string">&#x27;&#123;print $10&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ•°å­—ç±»å‹</span></span><br><span class="line">package_loss_rate_number=`<span class="built_in">echo</span> <span class="variable">$package_loss_rate</span> | sed <span class="string">&quot;s/%//g&quot;</span>`</span><br><span class="line">delay_time_number=`<span class="built_in">echo</span> <span class="variable">$delay_time</span> | sed <span class="string">&quot;s/ms//g&quot;</span>`</span><br><span class="line"><span class="comment"># å°†æ•°æ®ä¸Šä¼ åˆ°pushgateway</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sh_linux_package_loss_rate_<span class="variable">$instance_name</span> <span class="variable">$package_loss_rate_number</span>&quot;</span> | curl --data-binary @-</span><br><span class="line">http://docker201.zls.com:9091/metrics/job/zls_linux_package_loss_rate/instance/localhost:9092</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;sh_linux_delay_time_<span class="variable">$instance_name</span> <span class="variable">$delay_time_number</span>&quot;</span> | curl --data-binary @- http://docker201.zls.com:9091/metrics/job/zls_linux_package_loss_rate/instance/localhost:9092</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(2)ç¼–å†™å‘¨æœŸæ€§ä»»åŠ¡</span><br><span class="line">[root@docker201~]# crontab -l</span><br><span class="line">...</span><br><span class="line">*/10 * * * * /root/network_delay.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(3)åœ¨Prometheus serverä¸­æŸ¥çœ‹KEY</span><br><span class="line">sh_linux_package_loss_rate_docker201</span><br><span class="line">sh_linux_delay_time_docker201</span><br><span class="line">æ¸©é¦¨æç¤º:</span><br><span class="line">(1)å¯¹äºè¾ƒå¤šçš„ç½‘ç»œç›‘æ§æˆ‘å»ºè®®è¿˜æ˜¯ä½¿ç”¨ä¸“ä¸šçš„smokepingç›‘æ§ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯åœ¨IDCå…¬å¸ï¼ŒsmokepingåŸºæœ¬ä¸Šæ˜¯å¿…ç”¨è½¯ä»¶å“Ÿã€‚</span><br></pre></td></tr></table></figure><h3 id="8ã€ä½¿ç”¨alertmanagerå‘Šè­¦"><strong>8ã€ä½¿ç”¨alertmanagerå‘Šè­¦</strong></h3><p>1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶(é…ç½®æŠ¥è­¦åª’ä»‹ç±»å‹)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">1ã€å…ˆåœæ‰alertmanager</span><br><span class="line">[root@master01 kubernetes]# supervisorctl stop alertmanager</span><br><span class="line"></span><br><span class="line">2ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé…ç½®æŠ¥è­¦åª’ä»‹ç±»å‹</span><br><span class="line">[root@master01 kubernetes]# vim /app/alertmanager/alertmanager.yml </span><br><span class="line">global:</span><br><span class="line">  resolve_timeout: 5m</span><br><span class="line">  smtp_from: <span class="string">&#x27;xxx@qq.com&#x27;</span></span><br><span class="line">  smtp_smarthost: <span class="string">&#x27;smtp.qq.com:465&#x27;</span></span><br><span class="line">  smtp_auth_username: <span class="string">&#x27;xxxx@qq.com&#x27;</span></span><br><span class="line">  smtp_auth_password: <span class="string">&#x27;xxxgreaga&#x27;</span></span><br><span class="line">  smtp_require_tls: <span class="literal">false</span></span><br><span class="line">  smtp_hello: <span class="string">&#x27;qq.com&#x27;</span></span><br><span class="line">route:</span><br><span class="line">  group_by: [<span class="string">&#x27;alertname&#x27;</span>]</span><br><span class="line">  group_wait: 5s</span><br><span class="line">  group_interval: 5s</span><br><span class="line">  repeat_interval: 5m</span><br><span class="line">  receiver: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">receivers:</span><br><span class="line">- name: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  email_configs:</span><br><span class="line">  - to: <span class="string">&#x27;xxx85@qq.com&#x27;</span></span><br><span class="line">    send_resolved: <span class="literal">true</span></span><br><span class="line">inhibit_rules:</span><br><span class="line">  - source_match:</span><br><span class="line">      severity: <span class="string">&#x27;critical&#x27;</span></span><br><span class="line">    target_match:</span><br><span class="line">      severity: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    equal: [<span class="string">&#x27;alertname&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;instance&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">ç›¸å…³å‚æ•°è¯´æ˜    </span><br><span class="line">global:</span><br><span class="line"><span class="comment">#è§£æè¶…æ—¶æ—¶é—´</span></span><br><span class="line">  resolve_timeout: 5m</span><br><span class="line">  <span class="comment">#å‘ä»¶äººé‚®ç®±åœ°å€</span></span><br><span class="line">  smtp_from: <span class="string">&#x27;xxxxxxxx@qq.com&#x27;</span></span><br><span class="line">  <span class="comment">#é‚®ç®±çš„æœåŠ¡å™¨çš„åœ°å€åŠç«¯å£ï¼Œä¾‹å¦‚: &#x27;smtp.qq.com:465&#x27;</span></span><br><span class="line">  smtp_smarthost: <span class="string">&#x27;smtp.qq.com:465&#x27;</span></span><br><span class="line">  <span class="comment">#å‘é€äººçš„é‚®ç®±ç”¨æˆ·å</span></span><br><span class="line">  smtp_auth_username: <span class="string">&#x27;xxxxxxxx@qq.com&#x27;</span></span><br><span class="line">  <span class="comment">#å‘é€äººçš„é‚®ç®±çš„æˆæƒç </span></span><br><span class="line">  smtp_auth_password: <span class="string">&#x27;xxxxxxxxxxxxxxx&#x27;</span></span><br><span class="line">  <span class="comment">#æ˜¯å¦åŸºäºtlsåŠ å¯†</span></span><br><span class="line">  smtp_require_tls: <span class="literal">false</span></span><br><span class="line">  <span class="comment">#é‚®ç®±æœåŠ¡å™¨ï¼Œä¾‹å¦‚: &#x27;qq.com&#x27;</span></span><br><span class="line">  smtp_hello: <span class="string">&#x27;qq.com&#x27;</span></span><br><span class="line">route:</span><br><span class="line"><span class="comment">#é‡å¤æŠ¥è­¦çš„é—´éš”æ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰è§£å³æŠ¥è­¦é—®é¢˜ï¼Œåˆ™ä¼šé—´éš”æŒ‡å®šæ—¶é—´ä¸€ç›´è§¦å‘æŠ¥è­¦ï¼Œæ¯”å¦‚:5m</span></span><br><span class="line">  group_by: [<span class="string">&#x27;alertname&#x27;</span>]</span><br><span class="line">  group_wait: 5s</span><br><span class="line">  group_interval: 5s</span><br><span class="line">  repeat_interval: 5m</span><br><span class="line">  <span class="comment">#é‡‡ç”¨ä»€ä¹ˆæ–¹å¼æ¥æ”¶æŠ¥è­¦ï¼Œä¾‹å¦‚&#x27;email&#x27;</span></span><br><span class="line">  receiver: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">receivers:</span><br><span class="line"><span class="comment">#å®šä¹‰æ¥æ”¶è€…çš„åç§°ï¼Œæ³¨æ„è¿™é‡Œçš„nameè¦å’Œä¸Šé¢çš„routeå¯¹åº”ï¼Œä¾‹å¦‚: &#x27;email&#x27;</span></span><br><span class="line">- name: <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  email_configs:</span><br><span class="line">  <span class="comment">#é‚®ç®±å‘ç»™è°</span></span><br><span class="line">  - to: <span class="string">&#x27;xxxxxxxx@qq.com&#x27;</span></span><br><span class="line">    send_resolved: <span class="literal">true</span></span><br><span class="line">inhibit_rules:</span><br><span class="line">  - source_match:</span><br><span class="line">  <span class="comment">#åŒ¹é…æŠ¥è­¦çº§åˆ«ï¼Œä¾‹å¦‚: &#x27;critical&#x27;</span></span><br><span class="line">      severity: <span class="string">&#x27;critical&#x27;</span></span><br><span class="line">    target_match:</span><br><span class="line">    <span class="comment">#åªè¦æ˜¯warningå°±æŠ¥è­¦</span></span><br><span class="line">      severity: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    equal: [<span class="string">&#x27;alertname&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;instance&#x27;</span>]</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">3ã€å¯åŠ¨alertmanager</span><br><span class="line">[root@master01 kubernetes]# supervisorctl start alertmanager</span><br></pre></td></tr></table></figure><p>2ã€é…ç½®è®©Prometheuså…³è”alertmanager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# vim /app/prometheus/prometheus.yml </span><br><span class="line"><span class="comment"># Alertmanager configuration</span></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets:</span><br><span class="line">        <span class="comment">#è¿™é‡Œå†™alertmanagerçš„å®‰è£…åœ°å€</span></span><br><span class="line">          - 10.0.0.200:9093</span><br><span class="line">          </span><br><span class="line">[root@master01 kubernetes]# supervisorctl restart prometheus</span><br></pre></td></tr></table></figure><p>3ã€é…ç½®è§¦å‘å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">1ã€é…ç½®è§¦å‘å™¨è§„åˆ™å­˜æ”¾ç›®å½•</span><br><span class="line"><span class="comment">#ä¸€ä¸ªè§¦å‘å™¨ï¼Œä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">[root@master01 kubernetes]# vim /app/prometheus/prometheus.yml </span><br><span class="line"><span class="comment"># Load rules once and periodically evaluate them according to the global &#x27;evaluation_interval&#x27;.</span></span><br><span class="line">rule_files:</span><br><span class="line"><span class="comment">#é…ç½®è§¦å‘å™¨è§„åˆ™å­˜æ”¾ç›®å½•</span></span><br><span class="line">  - <span class="string">&quot;/app/prometheus/alertmanager/user_count.yml&quot;</span></span><br><span class="line">  <span class="comment">#- &quot;second_rules.yml&quot;</span></span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# supervisorctl restart prometheus</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºå­˜æ”¾ç›®å½•</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">mkdir</span> -p /app/prometheus/alertmanager/</span><br><span class="line"></span><br><span class="line">3ã€ç¼–å†™è§¦å‘å™¨è§„åˆ™æ–‡ä»¶</span><br><span class="line">[root@master01 kubernetes]# vim /app/prometheus/alertmanager/user_count.yml</span><br><span class="line"><span class="built_in">groups</span>:</span><br><span class="line">- name: user-count</span><br><span class="line">  rules:</span><br><span class="line">  - alert: user-count</span><br><span class="line">    <span class="built_in">expr</span>: user_count &gt; 3</span><br><span class="line">    <span class="keyword">for</span>: 15s</span><br><span class="line">    labels:</span><br><span class="line">      severity: 1</span><br><span class="line">      team: node</span><br><span class="line">    annotations:</span><br><span class="line">      summary: <span class="string">&quot;&#123;&#123; <span class="variable">$labels</span>.exported_instance &#125;&#125; ç™»å½•ç”¨æˆ·æ•°é‡è¶…è¿‡ 3ï¼&quot;</span></span><br><span class="line">      </span><br><span class="line"><span class="comment">#å‚æ•°è§£é‡Š    </span></span><br><span class="line"><span class="built_in">groups</span>:</span><br><span class="line"><span class="comment">#åå­—è‡ªå®šä¹‰</span></span><br><span class="line">- name: user-count</span><br><span class="line">  rules:</span><br><span class="line">  <span class="comment">#å‘Šè­¦ä¿¡æ¯ï¼Œuser-countçš„å€¼çš„key</span></span><br><span class="line">  - alert: user-count</span><br><span class="line">  <span class="comment">#expr: keyåå­—&#123;job=&quot;xxx&quot;&#125; == 3</span></span><br><span class="line">    <span class="built_in">expr</span>: user_count == 3</span><br><span class="line">    <span class="keyword">for</span>: 15s</span><br><span class="line">    labels:</span><br><span class="line">      severity: 1</span><br><span class="line">      team: node</span><br><span class="line">    annotations:</span><br><span class="line">    <span class="comment">#exported_instanceæ˜¯è·å–æœºå™¨çš„ip</span></span><br><span class="line">      summary: <span class="string">&quot;&#123;&#123; <span class="variable">$labels</span>.exported_instance &#125;&#125; ç™»å½•ç”¨æˆ·æ•°é‡è¶…è¿‡ 3ï¼&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20241002124047891.png" alt="image-20241002124047891"></p><p>4ã€æµ‹è¯•ï¼Œnode03å¤šå¼€å‡ ä¸ªç»ˆç«¯ï¼Œæµè§ˆå™¨è®¿é—®10.0.0.200:9093ï¼ŒæŸ¥çœ‹æœ‰æŠ¥è­¦ä¿¡æ¯ï¼Œå°±å¯ä»¥æŸ¥çœ‹é‚®ç®±ï¼Œä¼šæ”¶åˆ°æŠ¥è­¦é‚®ä»¶</p><p><img src="../image/study_img/image-20241002145740578.png" alt="image-20241002145740578"></p><p><img src="../image/study_img/image-20241002145916255.png" alt="image-20241002145916255"></p><p>5ã€å½“ç™»å½•ç”¨æˆ·æ•°é‡å°‘äº3ä¸ªæ—¶é—´ï¼Œä¹Ÿä¼šå‘æ¢å¤çš„é‚®ä»¶</p><p><img src="../image/study_img/image-20241002150222081.png" alt="image-20241002150222081"></p><h3 id="9ã€K8séƒ¨ç½²Prometheusçš„èµ„æºæ¸…å•â€”â€”è¿™ä¸ªæ˜¯éƒ¨ç½²åœ¨å®¹å™¨é‡Œé¢"><strong>9ã€K8séƒ¨ç½²Prometheusçš„èµ„æºæ¸…å•â€”â€”è¿™ä¸ªæ˜¯éƒ¨ç½²åœ¨å®¹å™¨é‡Œé¢</strong></h3><p>1ã€ConfigMap èµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; prom-cm.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Namespace</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prom-config</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: ConfigMap</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prom-config</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="string">  prometheus.yml: |</span></span><br><span class="line"><span class="string">  #å…¨å±€é…ç½®</span></span><br><span class="line"><span class="string">    global:</span></span><br><span class="line"><span class="string">      scrape_interval: 15s #æŠ“å–æ•°æ®é—´éš”æ—¶é—´</span></span><br><span class="line"><span class="string">      scrape_timeout: 15s #æŠ“å–æ•°æ®è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="string">    scrape_configs: #æŠ“å–é…ç½®</span></span><br><span class="line"><span class="string">    #ä»»åŠ¡åç§°</span></span><br><span class="line"><span class="string">      - job_name: &quot;prometheus&quot;</span></span><br><span class="line"><span class="string">      #é™æ€é…ç½®</span></span><br><span class="line"><span class="string">        static_configs:</span></span><br><span class="line"><span class="string">        #æŠ“å–æ•°æ®èŠ‚ç‚¹çš„IPç«¯å£ï¼Œèµ·åœ¨å®¹å™¨é‡Œé¢ï¼Œåªèƒ½å†™localhost</span></span><br><span class="line"><span class="string">          - targets: [&quot;localhost:9090&quot;]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœè¦æ·»åŠ å®¢æˆ·ç«¯ï¼Œå°±è¦editè¿™ä¸ªèµ„æºæ¸…å•ï¼Œæ·»åŠ å®¢æˆ·ç«¯</span></span><br></pre></td></tr></table></figure><p>2ã€PVå’ŒPVCèµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä½ è¦å®‰è£…åœ¨å“ªå°æœºå™¨ï¼Œå°±å…ˆåˆ›å»ºæŒ‚è½½ç›®å½•ï¼Œå› ä¸ºä¸‹é¢ä½¿ç”¨çš„æ˜¯<span class="built_in">local</span></span><br><span class="line"><span class="built_in">mkdir</span> /data/k8s/prometheus</span><br><span class="line"></span><br><span class="line">2ã€èµ„æºæ¸…å•</span><br><span class="line"><span class="built_in">cat</span> &gt; prom-pv-pvc.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: PersistentVolume</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prom-localhost</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    app: prometheus</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  capacity:</span></span><br><span class="line"><span class="string">    storage: 10Gi</span></span><br><span class="line"><span class="string">  accessModes:</span></span><br><span class="line"><span class="string">  - ReadWriteOnce</span></span><br><span class="line"><span class="string">  storageClassName: local-storage</span></span><br><span class="line"><span class="string">  local:</span></span><br><span class="line"><span class="string">    path: /data/k8s/prometheus</span></span><br><span class="line"><span class="string">    #è¿™é‡Œæ˜¯äº²å’Œæ€§</span></span><br><span class="line"><span class="string">  nodeAffinity:</span></span><br><span class="line"><span class="string">    required:</span></span><br><span class="line"><span class="string">      nodeSelectorTerms:</span></span><br><span class="line"><span class="string">      - matchExpressions:</span></span><br><span class="line"><span class="string">        - key: kubernetes.io/hostname</span></span><br><span class="line"><span class="string">        #In,å°±æ˜¯ä¸»æœºååŒ…å«nodeï¼Œéƒ½èµ·</span></span><br><span class="line"><span class="string">          operator: In</span></span><br><span class="line"><span class="string">          values:</span></span><br><span class="line"><span class="string">          #- ä½ æƒ³å®‰è£…åœ¨å“ªå°æœºå™¨ï¼Œå°±å†™ä»–çš„ä¸»æœºå</span></span><br><span class="line"><span class="string">          - node03</span></span><br><span class="line"><span class="string">  persistentVolumeReclaimPolicy: Retain</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: PersistentVolumeClaim</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prom-data</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  selector:</span></span><br><span class="line"><span class="string">    matchLabels:</span></span><br><span class="line"><span class="string">      app: prometheus</span></span><br><span class="line"><span class="string">  accessModes:</span></span><br><span class="line"><span class="string">  - ReadWriteOnce</span></span><br><span class="line"><span class="string">  resources:</span></span><br><span class="line"><span class="string">    requests:</span></span><br><span class="line"><span class="string">      storage: 10Gi</span></span><br><span class="line"><span class="string">  storageClassName: local-storage</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>3ã€RBAC æƒé™èµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; prom-rbac.yml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: ServiceAccount</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiVersion: rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="string">kind: ClusterRole</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">rules:</span></span><br><span class="line"><span class="string">- apiGroups:</span></span><br><span class="line"><span class="string">  - &quot;&quot;</span></span><br><span class="line"><span class="string">  resources:</span></span><br><span class="line"><span class="string">  - nodes</span></span><br><span class="line"><span class="string">  - services</span></span><br><span class="line"><span class="string">  - endpoints</span></span><br><span class="line"><span class="string">  - pods</span></span><br><span class="line"><span class="string">  - nodes/proxy</span></span><br><span class="line"><span class="string">  verbs:</span></span><br><span class="line"><span class="string">  - get</span></span><br><span class="line"><span class="string">  - list</span></span><br><span class="line"><span class="string">  - watch</span></span><br><span class="line"><span class="string">- apiGroups:</span></span><br><span class="line"><span class="string">  - &quot;extensions&quot;</span></span><br><span class="line"><span class="string">  resources:</span></span><br><span class="line"><span class="string">  - ingresses</span></span><br><span class="line"><span class="string">  verbs:</span></span><br><span class="line"><span class="string">  - get</span></span><br><span class="line"><span class="string">  - list</span></span><br><span class="line"><span class="string">  - watch</span></span><br><span class="line"><span class="string">- apiGroups:</span></span><br><span class="line"><span class="string">  - &quot;&quot;</span></span><br><span class="line"><span class="string">  resources:</span></span><br><span class="line"><span class="string">  - configmaps</span></span><br><span class="line"><span class="string">  - nodes/metrics</span></span><br><span class="line"><span class="string">  verbs:</span></span><br><span class="line"><span class="string">  - get</span></span><br><span class="line"><span class="string">- nonResourceURLs:</span></span><br><span class="line"><span class="string">  - /metrics</span></span><br><span class="line"><span class="string">  verbs:</span></span><br><span class="line"><span class="string">  - get</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiVersion: rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="string">kind: ClusterRoleBinding</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">roleRef:</span></span><br><span class="line"><span class="string">  apiGroup: rbac.authorization.k8s.io</span></span><br><span class="line"><span class="string">  kind: ClusterRole</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">subjects:</span></span><br><span class="line"><span class="string">- kind: ServiceAccount</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>4ã€Deployment èµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; prom-dp.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: apps/v1</span></span><br><span class="line"><span class="string">kind: Deployment</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    app: prometheus</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  selector:</span></span><br><span class="line"><span class="string">    matchLabels:</span></span><br><span class="line"><span class="string">      app: prometheus</span></span><br><span class="line"><span class="string">  template:</span></span><br><span class="line"><span class="string">    metadata:</span></span><br><span class="line"><span class="string">      labels:</span></span><br><span class="line"><span class="string">        app: prometheus</span></span><br><span class="line"><span class="string">    spec:</span></span><br><span class="line"><span class="string">      serviceAccountName: prometheus</span></span><br><span class="line"><span class="string">      volumes:</span></span><br><span class="line"><span class="string">      - name: data</span></span><br><span class="line"><span class="string">      persistentVolumeClaim:</span></span><br><span class="line"><span class="string">        claimName: prom-data</span></span><br><span class="line"><span class="string">      - name: config-volume</span></span><br><span class="line"><span class="string">        configMap:</span></span><br><span class="line"><span class="string">          name: prom-config</span></span><br><span class="line"><span class="string">      initContainers:</span></span><br><span class="line"><span class="string">      - name: fix-permissions</span></span><br><span class="line"><span class="string">        image: busybox</span></span><br><span class="line"><span class="string">        command: [chown, -R, &quot;nobody:nobody&quot;, /prometheus]</span></span><br><span class="line"><span class="string">        volumeMounts:</span></span><br><span class="line"><span class="string">        - name: data</span></span><br><span class="line"><span class="string">          mountPath: /prometheus</span></span><br><span class="line"><span class="string">      containers:</span></span><br><span class="line"><span class="string">      - name: prometheus</span></span><br><span class="line"><span class="string">        image: prom/prometheus:v2.24.1</span></span><br><span class="line"><span class="string">        args:</span></span><br><span class="line"><span class="string">        - &quot;--config.file=/etc/prometheus/prometheus.yml&quot; # é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="string">        - &quot;--storage.tsdb.path=/prometheus&quot; # æ•°æ®ä¿å­˜è·¯å¾„</span></span><br><span class="line"><span class="string">        - &quot;--storage.tsdb.retention.time=24h&quot; # æ•°æ®ä¿ç•™ï¼Œé»˜è®¤15å¤©</span></span><br><span class="line"><span class="string">        - &quot;--web.enable-admin-api&quot; # æ§åˆ¶å¯¹admin HTTP APIè®¿é—®</span></span><br><span class="line"><span class="string">        - &quot;--web.enable-lifecycle&quot; # æ”¯æŒçƒ­æ›´æ–°</span></span><br><span class="line"><span class="string">        ports:</span></span><br><span class="line"><span class="string">        - containerPort: 9090</span></span><br><span class="line"><span class="string">        volumeMounts:</span></span><br><span class="line"><span class="string">        - name: config-volume</span></span><br><span class="line"><span class="string">          mountPath: /etc/prometheus</span></span><br><span class="line"><span class="string">        - name: data</span></span><br><span class="line"><span class="string">          mountPath: /prometheus</span></span><br><span class="line"><span class="string">        resources:</span></span><br><span class="line"><span class="string">          requests:</span></span><br><span class="line"><span class="string">            cpu: 100m</span></span><br><span class="line"><span class="string">            memory: 512Mi</span></span><br><span class="line"><span class="string">          limits:</span></span><br><span class="line"><span class="string">            cpu: 100m</span></span><br><span class="line"><span class="string">          memory: 512Mi</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>5ã€Serviceèµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; prom-svc.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Service</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    app: prometheus</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  selector:</span></span><br><span class="line"><span class="string">    app: prometheus</span></span><br><span class="line"><span class="string">  ports:</span></span><br><span class="line"><span class="string">  - name: web</span></span><br><span class="line"><span class="string">    port: 9090</span></span><br><span class="line"><span class="string">    targetPort: 9090</span></span><br><span class="line"><span class="string">  type: ClusterIP</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>6ã€ingressèµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; prom-ingress.yaml &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: networking.k8s.io/v1</span></span><br><span class="line"><span class="string">kind: Ingress</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: prometheus</span></span><br><span class="line"><span class="string">  namespace: prom</span></span><br><span class="line"><span class="string">  labels:</span></span><br><span class="line"><span class="string">    app: prometheus</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  rules:</span></span><br><span class="line"><span class="string">  - host: prom.drz.com</span></span><br><span class="line"><span class="string">    http:</span></span><br><span class="line"><span class="string">      paths:</span></span><br><span class="line"><span class="string">      - path: /</span></span><br><span class="line"><span class="string">        pathType: ImplementationSpecific</span></span><br><span class="line"><span class="string">        backend:</span></span><br><span class="line"><span class="string">          service:</span></span><br><span class="line"><span class="string">            name: prometheus</span></span><br><span class="line"><span class="string">            port:</span></span><br><span class="line"><span class="string">              number: 9090</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>7ã€å®‰è£…å®Œæˆï¼Œåº”è¯¥æ˜¯èµ·åˆ°node03ä¸Šçš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç‰©ç†æœºåšåŸŸåè§£æ</span><br><span class="line">10.0.0.203 prom.drz.com   </span><br><span class="line"></span><br><span class="line">æµè§ˆå™¨è®¿é—®åŸŸå</span><br><span class="line">prom.drz.com</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰5ã€Podçš„é’©å­å’Œæ¢é’ˆ</title>
      <link href="/posts/feb758ca.html"/>
      <url>/posts/feb758ca.html</url>
      
        <content type="html"><![CDATA[<h2 id="Podçš„é’©å­å’Œæ¢é’ˆ">Podçš„é’©å­å’Œæ¢é’ˆ</h2><h3 id="1ã€podçš„ç”Ÿå‘½å‘¨æœŸ">1ã€<strong>podçš„ç”Ÿå‘½å‘¨æœŸ</strong></h3><p><img src="../image/study_img/image-20240920083828296.png" alt="image-20240920083828296"></p><p><img src="../image/study_img/image-20240920083900491.png" alt="image-20240920083900491"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ç”Ÿå‘½å‘¨æœŸé‡Œé¢åŒ…å«çš„ä¸œè¥¿</span><br><span class="line">1ã€åˆå§‹åŒ–å®¹å™¨</span><br><span class="line">2ã€2ä¸ªé’©å­</span><br><span class="line">   - start hook</span><br><span class="line">   - stop hook</span><br><span class="line"></span><br><span class="line"><span class="comment">#init container</span></span><br><span class="line">åˆå§‹åŒ–å®¹å™¨çš„ä½œç”¨ï¼šä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰ï¼Œå¯ä»¥è®©ä»–åšä¸€äº›å‡†å¤‡å·¥ä½œã€‚</span><br><span class="line">æ¯”å¦‚ï¼š</span><br><span class="line">1ã€åˆ›å»ºç”¨æˆ·ï¼Œå®¹å™¨çš„ç»Ÿä¸€ç”¨æˆ·</span><br><span class="line">2ã€2ä¸ªå®¹å™¨åšäº†å…±äº«å‚¨å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è®©ä»–å…ˆå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œæ¥å¯¹ç›®å½•è¿›è¡Œæ›´æ”¹å’Œæˆæƒ</span><br><span class="line">3ã€å®¹å™¨éœ€è¦è¿æ¥æ•°æ®åº“ï¼Œå¯ä»¥è®©åˆå§‹åŒ–å®¹å™¨æ£€æµ‹æ•°æ®åº“æ˜¯å¦å¯ä»¥æ­£å¸¸è¿æ¥ï¼Œå¦‚æœå¯ä»¥å†å¯åŠ¨ä¸»å®¹å™¨</span><br><span class="line"></span><br><span class="line"><span class="comment">#hook</span></span><br><span class="line">Poststartï¼šåœ¨å®¹å™¨åˆ›å»ºåï¼Œç«‹å³æ‰§è¡Œï¼Œä½†æ—¶é—´ä¸èƒ½å¤ªä¹…ï¼Œå¦åˆ™å®¹å™¨ä¸ä¼šæ˜¯runningçŠ¶æ€</span><br><span class="line">Prestartï¼šåœ¨å®¹å™¨åœæ­¢å‰ï¼Œæ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œä¸»è¦ç”¨äºä¼˜é›…å…³é—­è¿›ç¨‹</span><br><span class="line"></span><br><span class="line"><span class="comment">#Liveness probe</span></span><br><span class="line">å­˜æ´»æ¢é’ˆï¼Œç”¨äºå®šä¹‰å®¹å™¨å†…ï¼Œåº”ç”¨æ˜¯å¦æ»¡è¶³æ¢é’ˆçŠ¶æ€</span><br><span class="line"></span><br><span class="line"><span class="comment">#rediness probe</span></span><br><span class="line">å°±ç»ªæ¢é’ˆï¼ŒæŒ‡å®šä½•æ—¶å…è®¸å®¹å™¨è¿›å…¥æµé‡</span><br></pre></td></tr></table></figure><h3 id="2ã€åˆå§‹åŒ–å®¹å™¨">2ã€<strong>åˆå§‹åŒ–å®¹å™¨</strong></h3><ul><li>åˆ©ç”¨åˆå§‹åŒ–å®¹å™¨æ›´æ”¹nginxé¡µé¢</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ©ç”¨åˆå§‹åŒ–å®¹å™¨æ›´æ”¹nginxé¡µé¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä»–åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œåˆå§‹åŒ–å®¹å™¨æ‰§è¡Œå®Œæˆåå°±ç»“æŸé€€å‡º</span></span><br><span class="line"></span><br><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim init-container.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: init-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">#æŒ‡å®šä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨ï¼šåˆå§‹åŒ–å®¹å™¨çš„å†™æ³•å’Œä¸‹é¢å®¹å™¨çš„å†™æ³•æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">  initContainers:</span><br><span class="line">  - name: initcontainer</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s åˆå§‹åŒ–å®¹å™¨&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œå®¹å™¨ï¼ŒæŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f init-container.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -owide</span><br><span class="line">NAME        READY   STATUS    RESTARTS   AGE    IP          NODE</span><br><span class="line">init-pod    2/2     Running   0          2m1s   10.2.2.6    node02</span><br><span class="line">[root@master01 kubernetes]# curl 10.2.2.6</span><br><span class="line"><span class="built_in">test</span> k8s åˆå§‹åŒ–å®¹å™¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it init-pod -c c7-container -- /bin/bash</span><br><span class="line">[root@init-pod /]# <span class="built_in">cat</span> /usr/share/nginx/html/index.html </span><br><span class="line"><span class="built_in">test</span> k8s åˆå§‹åŒ–å®¹å™¨</span><br><span class="line"></span><br><span class="line">ç°åœ¨ç›¸å½“äº3ä¸ªå®¹å™¨åŒæ—¶æŒ‚è½½åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼ŒåŒæ—¶ä¹Ÿç›¸å½“äºæŒ‚è½½åˆ°å®¿ä¸»æœºçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ï¼Œä»–ä»¬3çš„ç›®å½•åšäº†å…±äº«</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚è¯´èµ·ä¸ªnginxå’Œphpå®¹å™¨ï¼Œå®¹å™¨çš„æ–‡ä»¶äº’ç›¸éš”ç¦»ï¼Œä»£ç å°±ä¸å…±äº«ï¼Œé‚£ä»£ç éƒ¨ç½²åœ¨å“ªé‡Œå‘¢ï¼Œå¦‚æœéƒ¨ç½²åœ¨nginxä¸Šï¼Œphpæ‰æ˜¯è§£æä»£ç çš„ï¼Œwordpressä¸æ˜¯å‰åç«¯åˆ†ç¦»çš„ï¼Œnginxé…ç½®æ–‡ä»¶å°±ä¸èƒ½ç”¨socketè¿æ¥phpäº†ï¼Œè¦ç”¨fastcgi_pass xx.xx.xx.xx:900,ä»£ç å¿…é¡»2è¾¹éƒ½è¦å­˜</span><br></pre></td></tr></table></figure><h3 id="3ã€é’©å­">3ã€<strong>é’©å­</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨é’©å­  poststart  å¯åŠ¨ä¹‹å</span></span><br><span class="line">lifecycle: </span><br><span class="line">  preStart: </span><br><span class="line">    <span class="built_in">exec</span>:</span><br><span class="line">    httpGet: </span><br><span class="line">    tcpSocket </span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>ï¼šæ‰§è¡Œå‘½ä»¤</span><br><span class="line">httpGetï¼šæ£€æµ‹HTTPï¼Œæ¯”å¦‚æ£€æµ‹ç½‘ç«™çš„80ï¼Œ443ç«¯å£ï¼Œè¦æ±‚webé¡µé¢çŠ¶æ€ç è¿”å›æ˜¯ä¸æ˜¯404ï¼Œ200ï¼Œä¸€èˆ¬åœ¨æ¢é’ˆé‡Œç”¨</span><br><span class="line">tcpSocketï¼šæ£€æµ‹ç«¯å£é€šä¸é€šï¼Œæ¯”å¦‚æ£€æµ‹æ•°æ®åº“æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œå¦‚æœç”¨httpgetä¸è¡Œ</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢é’©å­   preStop   åœæ­¢ä¹‹å‰</span></span><br><span class="line">lifecycle: </span><br><span class="line">  preStop: </span><br><span class="line">    <span class="built_in">exec</span>:</span><br><span class="line">    httpGet: </span><br><span class="line">    tcpSocket</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨å¯åŠ¨é’©å­åœ¨ä¸€ä¸ªpodé‡Œç»Ÿä¸€å¤šä¸ªå®¹å™¨çš„ç”¨æˆ·</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cp</span> init-container.yml poststart.yml</span><br><span class="line">[root@master01 kubernetes]# vim poststart.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: poststart-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  <span class="comment">#è¿™é‡ŒæŒ‚è½½ç›®å½•å¯ä»¥æ˜¯ä¸´æ—¶çš„</span></span><br><span class="line">  - name: nginx-data</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  initContainers:</span><br><span class="line">  - name: initcontainer</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s ä½¿ç”¨å¯åŠ¨é’©å­åœ¨ä¸€ä¸ªpodé‡Œç»Ÿä¸€å¤šä¸ªå®¹å™¨çš„ç”¨æˆ·&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="comment">#nginxå¯åŠ¨ä¹‹åçš„é’©å­å†™æ³•:ç»Ÿä¸€å®¹å™¨çš„ç”¨æˆ·</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">     <span class="comment">#nginxé‡Œé¢ä¸€å¼€å§‹å†™useraddå‘½ä»¤åˆ›å»ºç”¨æˆ·ï¼Œä½†æ˜¯è¿™ä¸ªå®¹å™¨é‡Œé¢æ²¡æœ‰useraddå‘½ä»¤ï¼Œä¼šæŠ¥é”™ã€‚æ‰€ä»¥åªèƒ½ç”¨æ”¹ç»„ã€ç”¨æˆ·æœ‰å…³çš„é…ç½®æ–‡ä»¶å»æ·»åŠ ç”¨æˆ·</span></span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;www:x:666&#x27; &gt;&gt; /etc/group &amp;&amp; echo &#x27;www:x:666:666::/home/www:/sbin/nologin&#x27; &gt;&gt; /etc/passwd&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    <span class="comment">#C7å¯åŠ¨ä¹‹åçš„é’©å­å†™æ³•:ç»Ÿä¸€å®¹å™¨çš„ç”¨æˆ·</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>: </span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;groupadd www -g 666 &amp;&amp; useradd www -u 666 -g 666 -s /sbin/nologin -M&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œå®¹å™¨ï¼ŒæŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f  poststart.yml </span><br><span class="line">pod/poststart-pod created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod poststart-pod -owide</span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE   IP          NODE  </span><br><span class="line">poststart-pod   2/2     Running   0          33s   10.2.3.33   node03</span><br><span class="line">[root@master01 kubernetes]# curl 10.2.3.33</span><br><span class="line"><span class="built_in">test</span> k8s ä½¿ç”¨å¯åŠ¨é’©å­åœ¨ä¸€ä¸ªpodé‡Œç»Ÿä¸€å¤šä¸ªå®¹å™¨çš„ç”¨æˆ·</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it poststart-pod -c c7-container -- /bin/bash</span><br><span class="line">[root@poststart-pod /]# <span class="built_in">id</span> www</span><br><span class="line">uid=666(www) gid=666(www) <span class="built_in">groups</span>=666(www)</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it poststart-pod -c nginx-container -- /bin/sh</span><br><span class="line">/ <span class="comment"># id www</span></span><br><span class="line">uid=666(www) gid=666 <span class="built_in">groups</span>=666</span><br></pre></td></tr></table></figure><ul><li>åœæ­¢é’©å­  å®¹å™¨åœæ­¢ä¹‹å‰æ‰“å°æŒ‡å®šå†…å®¹åˆ°æ–‡ä»¶  (ä¸å¸¸ç”¨ï¼Œæ²¡ä»€ä¹ˆåº”ç”¨åœºæ™¯)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cp</span> poststart.yml poststop.yml</span><br><span class="line">[root@master01 kubernetes]# vim prestop.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: poststop-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  <span class="comment">#ä¸ºäº†æ»¡è¶³åœæ­¢ä¹‹å‰echoå†…å®¹åˆ°æŒ‚è½½ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œçš„æŒ‚è½½ç›®å½•éœ€è¦æŒä¹…åŒ–</span></span><br><span class="line">  - name: nginx-data</span><br><span class="line">    hostPath:</span><br><span class="line">     path: /data/nginx</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  initContainers:</span><br><span class="line">  - name: initcontainer</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s ä½¿ç”¨å¯åŠ¨é’©å­åœ¨ä¸€ä¸ªpodé‡Œç»Ÿä¸€å¤šä¸ªå®¹å™¨çš„ç”¨æˆ·&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;www:x:666&#x27; &gt;&gt; /etc/group &amp;&amp; echo &#x27;www:x:666:666::/home/www:/sbin/nologin&#x27; &gt;&gt; /etc/passwd&quot;</span>]</span><br><span class="line"><span class="comment">#å®¹å™¨åœæ­¢ä¹‹å‰åšçš„äº‹æƒ…</span></span><br><span class="line">      preStop:</span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s ä½¿ç”¨åœæ­¢é’©å­ä½¿podåœ¨åœæ­¢ä¹‹å‰æ‰“å°  bye&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    <span class="comment">#C7å¯åŠ¨ä¹‹åçš„é’©å­å†™æ³•:ç»Ÿä¸€å®¹å™¨çš„ç”¨æˆ·</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>: </span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;groupadd www -g 666 &amp;&amp; useradd www -u 666 -g 666 -s /sbin/nologin -M&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">      </span><br><span class="line"> 2ã€æŸ¥çœ‹  </span><br><span class="line">[root@node03 ~]# <span class="built_in">rm</span> -rf /data/nginx/index.html</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod poststop-pod -owide</span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE   IP          NODE  </span><br><span class="line">poststop-pod   2/2     Running   0          40s   10.2.3.34   node03</span><br><span class="line">[root@master01 kubernetes]# curl 10.2.3.34</span><br><span class="line"><span class="built_in">test</span> k8s ä½¿ç”¨å¯åŠ¨é’©å­åœ¨ä¸€ä¸ªpodé‡Œç»Ÿä¸€å¤šä¸ªå®¹å™¨çš„ç”¨æˆ·</span><br><span class="line"></span><br><span class="line">3ã€ç°åœ¨curlå‡ºæ¥çš„ç»“æœè¿˜æ²¡æœ‰æ”¹å˜ï¼Œéœ€è¦åˆ é™¤è¿™ä¸ªpodï¼Œæ‰ä¼šå‘ç”Ÿæ”¹å˜ï¼Œåˆ æ‰ä¹‹åå®¹å™¨ä¸åœ¨äº†ï¼Œä¸èƒ½ç”¨curl,åªèƒ½åˆ°æŒ‚è½½ç›®å½•å»çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl delete pod poststop-pod</span><br><span class="line"></span><br><span class="line">[root@node03 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">test</span> k8s ä½¿ç”¨åœæ­¢é’©å­ä½¿podåœ¨åœæ­¢ä¹‹å‰æ‰“å° <span class="built_in">bye</span></span><br></pre></td></tr></table></figure><h3 id="4ã€æ¢é’ˆ">4ã€<strong>æ¢é’ˆ</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å­˜æ´»æ€§æ¢é’ˆ(å­˜æ´»æ€æ¢é’ˆ) livenessprobe</span></span><br><span class="line">åˆ—å¦‚ï¼š</span><br><span class="line">å½“nginxå®¹å™¨èµ·æ¥åï¼Œå³ä¾¿é¡µé¢æ˜¯404ï¼Œå®¹å™¨ä¼šæ­£å¸¸è¿è¡Œï¼Œ80ç«¯å£ä¹Ÿä¼šæ­£å¸¸å­˜åœ¨ï¼Œk8så°±ä¸ä¼šåšåˆ°é‡æ–°æ‹‰èµ·è¿™ä¸ªå®¹å™¨ï¼Œå­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line">æ•°æ®åº“å‡æ­»ï¼Œè¿›ç¨‹å­˜åœ¨ï¼Œå­˜æ´»æ€§æ¢é’ˆå°±å¯ä»¥æ£€æµ‹åº”ç”¨æ˜¯å¦å­˜æ´»ï¼Œä¸å­˜æ´»ä¼šå‡ºç°æ‹‰èµ·æ–°çš„pod</span><br><span class="line"></span><br><span class="line">ç”¨äºå®šä¹‰å®¹å™¨å†…ï¼Œåº”ç”¨æ˜¯å¦æ»¡è¶³æ¢é’ˆæŒ‡å®šçŠ¶æ€ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™åˆ é™¤PODé‡æ–°æ‹‰èµ·ä¸€ä¸ªæ–°çš„POD</span><br><span class="line"></span><br><span class="line">å­˜æ´»æ¢é’ˆç®€å•æ¥è¯´å°±æ˜¯ç”¨æ¥æ£€æµ‹å®¹å™¨çš„åº”ç”¨ç¨‹åºæ˜¯å¦è¿˜æ­£å¸¸å·¥ä½œï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸æ­£å¸¸ï¼Œå³ä½¿å®¹å™¨è¿˜æ´»ç€ä¹Ÿæ²¡æœ‰æ„ä¹‰äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨å­˜æ´»æ¢é’ˆæ¥æ¢æµ‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸æ­£å¸¸ï¼Œå°±é‡å¯PODã€‚</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span>ï¼šæ‰§è¡Œå‘½ä»¤</span><br><span class="line">httpGetï¼šæ£€æµ‹HTTP</span><br><span class="line">tcpSocketï¼šæ£€æµ‹ç«¯å£</span><br><span class="line"></span><br><span class="line">ivenessProbe:</span><br><span class="line">httpGet:   <span class="comment">#åŸºäºHTTPè¯·æ±‚èµ„æº</span></span><br><span class="line">path:      <span class="comment">#è¯·æ±‚åœ°å€ï¼Œå¦‚æœè¿™ä¸ªåœ°å€è¿”å›çš„çŠ¶æ€ç åœ¨200~400ä¹‹é—´æ­£å¸¸</span></span><br><span class="line">port:      <span class="comment">#è¯·æ±‚çš„ç«¯å£</span></span><br><span class="line">initialDelaySeconds: 3     <span class="comment">#ç¬¬ä¸€æ¬¡å¯åŠ¨æ¢æµ‹åœ¨å®¹å™¨å¯åŠ¨çš„3såå¼€å§‹</span></span><br><span class="line">periodSeconds: 3           <span class="comment">#å®¹å™¨å¯åŠ¨åæ¯éš”3sæ£€æµ‹ä¸€æ¬¡</span></span><br></pre></td></tr></table></figure><ul><li>1ã€å­˜æ´»æ€§æ¢é’ˆ  execç‰ˆ   åº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚è¯´nfs,æ²¡æœ‰é¡µé¢å’Œç«¯å£ï¼Œå°±å¯ä»¥ç”¨å‘½ä»¤ï¼Œdf -Th|grep æŒ‚è½½ç›®å½•ï¼Œå¦‚æœnfsæŒ‚äº†df -Thä¼šå¡ä¸»ï¼Œä½†æ˜¯ä»–æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå¡ä½äº†ï¼Œåˆ°æ—¶å€™è¶…æ—¶äº†å°±è®¤ä¸ºæŒ‚äº†</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span>è¿˜å¯ä»¥å†™è„šæœ¬å»æ£€æµ‹æŸä¸ªæœåŠ¡</span><br><span class="line"></span><br><span class="line">1ã€å†™serviceèµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim ivenssprobe-service.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: ivenssprobe-service</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">  <span class="comment">#è¿™ä¸ªæ ‡ç­¾ä¸€å®šè¦å’Œä¸‹é¢çš„æ ‡ç­¾ä¿æŒä¸€è‡´ï¼Œä¸ç„¶ä¼šcurlæŠ¥é”™</span></span><br><span class="line">    app: ivenssprobe</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">    <span class="comment">#æŠŠ80æ˜ å°„åˆ°å®¿ä¸»æœºçš„30000ç«¯å£</span></span><br><span class="line">    nodePort: 30000</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ç¼–å†™èµ„æºæ¸…å•    åˆ°è¿™é‡Œç›®å‰è¿˜æ²¡æœ‰æ·»åŠ å­˜æ´»æ¢é’ˆçš„åŠŸèƒ½ï¼Œåœ¨åé¢æ·»åŠ </span><br><span class="line">[root@master01 kubernetes]# vim ivenssprobe.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: ivenssprobe-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: ivenssprobe</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data</span><br><span class="line">    hostPath:</span><br><span class="line">     path: /data/nginx</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"><span class="comment">#ä½¿ç”¨å¯åŠ¨é’©å­ç»™nginxä¸€ä¸ªåˆå§‹é¡µé¢ï¼Œåˆå§‹åŒ–å®¹å™¨æˆ–è€…å¯åŠ¨é’©å­éƒ½è¡Œï¼Œä¸ç„¶æŒ‚è½½å‡ºæ¥æ²¡é¡µé¢</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s å­˜æ´»æ€§æ¢é’ˆ&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">          </span><br><span class="line">2ã€è¿è¡Œ</span><br><span class="line">[root@master01 kubernetes]# kubectl get service</span><br><span class="line">NAME                  TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">ivenssprobe-service   NodePort    10.1.87.209   &lt;none&gt;        80:30000/TCP   25s</span><br><span class="line">kubernetes            ClusterIP   10.1.0.1      &lt;none&gt;        443/TCP        7d5h</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod ivenssprobe-pod -owide</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE     IP          NODE  </span><br><span class="line">ivenssprobe-pod   1/1     Running   0          3m53s   10.2.1.11   node01</span><br><span class="line"></span><br><span class="line">3ã€æ£€æŸ¥</span><br><span class="line">ivenssprobe-serviceè¿™ä¸ªèµ„æºç›¸å½“äºç»™ä»–ä»¬åšäº†è´Ÿè½½å‡è¡¡</span><br><span class="line">[root@master01 kubernetes]# curl 10.1.151.36</span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line">[root@master01 kubernetes]# curl 10.2.1.7 </span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line"></span><br><span class="line">ç”±äºåšäº†å®¿ä¸»æœºä¸Šçš„æ˜ å°„ï¼Œå¯ä»¥æµè§ˆå™¨è®¿é—®   10.0.0.201:30000</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240920165623622.png" alt="image-20240920165623622"></p><p>æµ‹è¯•æ¢é’ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line"></span><br><span class="line">1ã€åˆ é™¤ä¸»é¡µé¢ï¼Œå†æ¬¡æµè§ˆå™¨è®¿é—®ï¼Œå˜æˆ403</span><br><span class="line">[root@node01 ~]# <span class="built_in">rm</span> -rf /data</span><br><span class="line"></span><br><span class="line">2ã€å†æ¬¡æŸ¥çœ‹ä¸»é¡µé¢ï¼Œè¿˜æ˜¯ç©ºçš„ï¼ŒæŸ¥çœ‹podï¼Œè¿˜æ˜¯runningçŠ¶æ€ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†ç½‘ç«™ç¡®å®æŒ‚äº†ï¼Œpodè™½ç„¶åœ¨è¿è¡Œï¼Œä½†æ˜¯æ²¡å•¥ç”¨äº†ï¼Œè¿˜å ç”¨èµ„æº</span><br></pre></td></tr></table></figure><p>åœ¨èµ„æºæ¸…å•ç¼–å†™å­˜æ´»æ€§æ¢é’ˆçš„æ£€éªŒåŠŸèƒ½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">1ã€åˆ é™¤æ—§çš„pod</span><br><span class="line">[root@master01 kubernetes]# kubectl delete pod ivenssprobe-pod </span><br><span class="line"></span><br><span class="line">2ã€åœ¨èµ„æºæ¸…å•æ·»åŠ å­˜æ´»æ€§æ¢é’ˆçš„æ£€éªŒåŠŸèƒ½</span><br><span class="line">[root@master01 kubernetes]# vim ivenssprobe.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: ivenssprobe-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: ivenssprobe</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data</span><br><span class="line">    hostPath:</span><br><span class="line">     path: /data/nginx</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"><span class="comment">#ä½¿ç”¨å¯åŠ¨é’©å­ç»™nginxä¸€ä¸ªåˆå§‹é¡µé¢ï¼Œåˆå§‹åŒ–å®¹å™¨æˆ–è€…å¯åŠ¨é’©å­éƒ½è¡Œï¼Œä¸ç„¶æŒ‚è½½å‡ºæ¥æ²¡é¡µé¢</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s å­˜æ´»æ€§æ¢é’ˆ&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    livenessProbe:</span><br><span class="line">      <span class="built_in">exec</span>:</span><br><span class="line"><span class="comment">#æ£€æµ‹ä¸»é¡µé¢ï¼Œæ‹¿å‘½ä»¤æ£€æµ‹ï¼Œå½“è¿”å›å€¼ä¸ä¸º0å°±æ˜¯å¤±è´¥</span></span><br><span class="line">        <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line"><span class="comment">#ä¸€å®šè¦å†™ä¼˜åŒ–å‚æ•°</span></span><br><span class="line">      <span class="comment">#å»¶è¿Ÿæ—¶é—´3s</span></span><br><span class="line">      initialDelaySeconds: 3 </span><br><span class="line">      <span class="comment">#å®¹å™¨æ¯éš”2sæ£€æµ‹ä¸€æ¬¡</span></span><br><span class="line">      periodSeconds: 2</span><br><span class="line">      <span class="comment">#è¶…æ—¶æ—¶é—´ 1s</span></span><br><span class="line">      timeoutSeconds: 1</span><br><span class="line">      <span class="comment">#æˆåŠŸä¹‹å3æ¬¡è¿ç»­å¤±è´¥ï¼Œæ‰æ˜¯çœŸå¤±è´¥ï¼Œç„¶åé‡æ–°å»æ‹‰èµ·ï¼Œé¿å…ç½‘ç»œæ³¢åŠ¨çš„æƒ…å†µ</span></span><br><span class="line">      failureThreshold: 3</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">      </span><br><span class="line">3ã€æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]#  kubectl apply -f ivenssprobe.yml </span><br><span class="line">pod/ivenssprobe-pod created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod ivenssprobe-pod -owide</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE   IP          NODE  </span><br><span class="line">ivenssprobe-pod   1/1     Running   0          64s   10.2.1.12   node01</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å‚æ•°è§£é‡Šï¼š</span><br><span class="line"></span><br><span class="line">initialDelaySeconds: <span class="comment">#ç¬¬ä¸€æ¬¡æ‰§è¡Œæ¢é’ˆéœ€è¦åœ¨å®¹å™¨å¯åŠ¨åç­‰å¾…çš„æ—¶å€™æ—¶é—´</span></span><br><span class="line">periodSeconds: <span class="comment">#å®¹å™¨å¯åŠ¨åæ¯éš”å¤šå°‘ç§’æ‰§è¡Œä¸€æ¬¡å­˜æ´»æ¢é’ˆ(å¿ƒè·³æ£€æµ‹çš„é—´éš”æ—¶é—´)</span></span><br><span class="line">timeoutSeconds: <span class="comment">#æ¢é’ˆè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤1ç§’ï¼Œæœ€å°1ç§’</span></span><br><span class="line">successThreshold: <span class="comment">#æ¢é’ˆå¤±è´¥åæœ€å°‘è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šæˆåŠŸï¼Œé»˜è®¤1æ¬¡ï¼Œå¦‚æœæ˜¯livenesså¿…é¡»ä¸º1(ä¸€å¼€å§‹æ£€æµ‹ä¸€ä¸ªç½‘ç«™æ˜¯403ï¼Œä»£è¡¨ç½‘ç«™å¤±è´¥ï¼Œä¸å¯èƒ½ä¸€å¤±è´¥å°±ç«‹é©¬å»é‡æ–°æ‹‰èµ·pod,éœ€è¦æ£€æŸ¥åˆ°å‡ æ¬¡æˆåŠŸæ‰è®¤ä¸ºæ˜¯æˆåŠŸçš„)</span></span><br><span class="line">failureThreshold: <span class="comment">#æ¢é’ˆæˆåŠŸåè¢«è§†ä¸ºå¤±è´¥çš„æ¢æµ‹çš„æœ€å°è¿ç»­å¤±è´¥æ¬¡æ•°ã€‚é»˜è®¤3æ¬¡ã€‚æœ€å°å€¼ä¸º1(æ¢é’ˆæ£€æµ‹æˆåŠŸå®¹å™¨æ­£å¸¸è¿è¡Œï¼Œé‚£ä¹ˆè¿˜è¦æ£€æµ‹å‡ æ¬¡å¤±è´¥æ‰ä¼šé‡æ–°æ‹‰èµ·è¿™ä¸ªpod)</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•  è®¿é—®ç½‘é¡µ  10.0.0.201:30000  æ¢å¤æ­£å¸¸</p><p><img src="../image/study_img/image-20240920173329296.png" alt="image-20240920173329296"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line">[root@node01 ~]# <span class="built_in">rm</span> -rf /data</span><br><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line">[root@node01 ~]# <span class="built_in">rm</span> -rf /data</span><br><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">cat</span>: /data/nginx/index.html: No such file or directory</span><br><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">cat</span>: /data/nginx/index.html: No such file or directory</span><br><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line"></span><br><span class="line">åˆ æ‰ä¸»é¡µé¢ï¼ŒæŸ¥çœ‹ä¸»é¡µé¢å†…å®¹ï¼Œä¼šé‡æ–°æ‹‰èµ·ï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°å†…å®¹</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯<span class="built_in">exec</span>æœ‰ç¼ºé™·ï¼Œä»¥åä»£ç é¡µé¢å¤šï¼Œä¸èƒ½<span class="built_in">cat</span>ï¼Œæ‰€ä»¥Httpgetæ¯”è¾ƒå¥½ç”¨</span><br></pre></td></tr></table></figure><ul><li>2ã€å­˜æ´»æ€§æ¢é’ˆ  httpgetç‰ˆ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">1ã€åˆ é™¤æ—§çš„pod</span><br><span class="line">[root@master01 kubernetes]# kubectl delete pod ivenssprobe-pod </span><br><span class="line"></span><br><span class="line">2ã€åœ¨èµ„æºæ¸…å•æ·»åŠ å­˜æ´»æ€§æ¢é’ˆçš„æ£€éªŒåŠŸèƒ½</span><br><span class="line">[root@master01 kubernetes]# vim ivenssprobe.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: ivenssprobe-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: ivenssprobe</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data</span><br><span class="line">    hostPath:</span><br><span class="line">     path: /data/nginx</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"><span class="comment">#ä½¿ç”¨å¯åŠ¨é’©å­ç»™nginxä¸€ä¸ªåˆå§‹é¡µé¢ï¼Œåˆå§‹åŒ–å®¹å™¨æˆ–è€…å¯åŠ¨é’©å­éƒ½è¡Œï¼Œä¸ç„¶æŒ‚è½½å‡ºæ¥æ²¡é¡µé¢</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s å­˜æ´»æ€§æ¢é’ˆ&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    livenessProbe:</span><br><span class="line">    <span class="comment">#httpç‰ˆæœ¬</span></span><br><span class="line">      httpGet:</span><br><span class="line">      <span class="comment">#hostå°±æ˜¯æœ¬æœºï¼Œä½†æ˜¯å¯ä»¥é»˜è®¤å°±æ˜¯æœ¬æœºï¼Œä¸éœ€è¦å†™</span></span><br><span class="line">        <span class="comment">#host: 127.0.0.1</span></span><br><span class="line"><span class="comment">#pathå°±æ˜¯uri   http://k8s.driverzeng.com/v1.19/,æ¯”å¦‚è¯´è¿™ä¸ªç½‘ç«™çš„uriå°±æ˜¯/v1.19/     http://10.0.0.201:30000/ï¼Œuriå°±æ˜¯/</span></span><br><span class="line">        path: /</span><br><span class="line">      <span class="comment">#è¿˜å¯ä»¥åŠ ä¸Šç«¯å£</span></span><br><span class="line">        port: 80</span><br><span class="line">      </span><br><span class="line"><span class="comment">#ä¸€å®šè¦å†™ä¼˜åŒ–å‚æ•°</span></span><br><span class="line">      <span class="comment">#å»¶è¿Ÿæ—¶é—´3s</span></span><br><span class="line">      initialDelaySeconds: 3 </span><br><span class="line">      <span class="comment">#å®¹å™¨æ¯éš”2sæ£€æµ‹ä¸€æ¬¡</span></span><br><span class="line">      periodSeconds: 2</span><br><span class="line">      <span class="comment">#è¶…æ—¶æ—¶é—´ 1s</span></span><br><span class="line">      timeoutSeconds: 1</span><br><span class="line">      <span class="comment">#æˆåŠŸä¹‹å3æ¬¡è¿ç»­å¤±è´¥ï¼Œæ‰æ˜¯çœŸå¤±è´¥ï¼Œç„¶åé‡æ–°å»æ‹‰èµ·ï¼Œé¿å…ç½‘ç»œæ³¢åŠ¨çš„æƒ…å†µ</span></span><br><span class="line">      failureThreshold: 3</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------------------</span><br><span class="line">ä¸å†™hostæ˜¯å› ä¸ºä¸çŸ¥é“podèµ·æ¥æ˜¯ä»€ä¹ˆip,ä½†ä»¥åå¾—å†™ï¼Œä»¥åä¸å¯èƒ½å§nginxå’Œmysqlèµ·åœ¨ä¸€ä¸ªpod,æ•°æ®åº“è‚¯å®šè¦å•ç‹¬èµ·ä¸€ä¸ªpod</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥è¯¢</span><br><span class="line">[root@master01 kubernetes]#  kubectl delete pod ivenssprobe-pod </span><br><span class="line">pod <span class="string">&quot;ivenssprobe-pod&quot;</span> deleted</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f ivenssprobe.yml </span><br><span class="line">pod/ivenssprobe-pod created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod ivenssprobe-pod -owide</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE   IP          NODE  </span><br><span class="line">ivenssprobe-pod   1/1     Running   0          26s   10.2.1.13   node01</span><br><span class="line"></span><br><span class="line">4ã€#æµ‹è¯•</span><br><span class="line">åˆ°node01åˆ é™¤ä¸»é¡µæ–‡ä»¶</span><br><span class="line">[root@node01 ~]# <span class="built_in">rm</span> -rf /data</span><br><span class="line">é€Ÿåº¦å¿«ç‚¹ï¼Œåˆ‡æ¢åˆ°æµè§ˆå™¨ç½‘ç«™ï¼Œä¼šçœ‹åˆ°403ï¼Œä¸€ç›´åˆ·æ–°ï¼Œç½‘ç«™å°±ä¼šæ¢å¤åŸæ ·ï¼Œä¸éœ€è¦å»<span class="built_in">cat</span>ä¸»é¡µæ–‡ä»¶äº†</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ä¸»é¡µæ–‡ä»¶ï¼Œæ¢å¤åŸæ ·</span><br><span class="line">[root@node01 ~]# <span class="built_in">cat</span> /data/nginx/index.html </span><br><span class="line"><span class="built_in">test</span> k8s å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¥½å¤„æ˜¯ç›‘æµ‹å®ƒçš„80ç«¯å£ï¼Œè®¿é—®è¿™ä¸ªuriï¼Œåªè¦å‡ºç°çŠ¶æ€ç 40å‡ ï¼Œ50å‡ å°±ä¼šé‡æ–°æ‹‰èµ·ï¼Œæƒ³wordpressè¿™ç§ä»£ç å¤šçš„æƒ…å†µä¸‹ï¼Œä¸èƒ½ç”¨catå‘½ä»¤ä¸å¯èƒ½æ¯ä¸ªæ–‡ä»¶éƒ½cat,æ‰€ä»¥httpgetæ˜¯æ£€æµ‹nginxæœ€åçš„æ–¹æ³•</span></span><br></pre></td></tr></table></figure><ul><li>3ã€å­˜æ´»æ€§æ¢é’ˆ  tcpSocketç‰ˆ   åº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚è¯´æ•°æ®åº“ï¼Œåªæœ‰ç«¯å£ï¼Œæ²¡æœ‰ç½‘ç«™</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">åªèƒ½æ£€æµ‹ç«¯å£ï¼Œä¸ä¼šæ£€æµ‹é¡µé¢ï¼Œåˆ æ‰é¡µé¢ï¼Œæ²¡æœ‰ç”¨ï¼Œä¸ä¼šé‡æ–°æ‹‰èµ·ï¼ŒhttpGetå°±ç›¸å½“äºåº•å±‚ä½¿ç”¨curlå‘½ä»¤å»æ£€æµ‹</span><br><span class="line"></span><br><span class="line">tcpSocket: </span><br><span class="line">  host:     <span class="comment">#é»˜è®¤å¯ä»¥ä¸å†™ï¼Œä»–è‡ªå·±çŸ¥é“podçš„ip,æ‰€ä»¥å¯ä»¥ä¸å†™</span></span><br><span class="line">  port:     <span class="comment">#ç«¯å£ã€‚å¦‚æœåªæ£€æµ‹ç«¯å£ï¼Œé¡µé¢åˆ é™¤æ²¡æœ‰æ„ä¹‰ï¼Œä¸ä¼šæ‹‰èµ·</span></span><br><span class="line"></span><br><span class="line">1ã€åœ¨èµ„æºæ¸…å•æ·»åŠ å­˜æ´»æ€§æ¢é’ˆçš„æ£€éªŒåŠŸèƒ½</span><br><span class="line">[root@master01 kubernetes]# vim ivenssprobe.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: ivenssprobe-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: ivenssprobe</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data</span><br><span class="line">    hostPath:</span><br><span class="line">     path: /data/nginx</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"><span class="comment">#ä½¿ç”¨å¯åŠ¨é’©å­ç»™nginxä¸€ä¸ªåˆå§‹é¡µé¢ï¼Œåˆå§‹åŒ–å®¹å™¨æˆ–è€…å¯åŠ¨é’©å­éƒ½è¡Œï¼Œä¸ç„¶æŒ‚è½½å‡ºæ¥æ²¡é¡µé¢</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s å­˜æ´»æ€§æ¢é’ˆ&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    livenessProbe:</span><br><span class="line">      <span class="comment">#tcpSocketç‰ˆ</span></span><br><span class="line">      tcpSocket:</span><br><span class="line">        port: 80</span><br><span class="line">      </span><br><span class="line"><span class="comment">#ä¸€å®šè¦å†™ä¼˜åŒ–å‚æ•°</span></span><br><span class="line">      <span class="comment">#å»¶è¿Ÿæ—¶é—´3s</span></span><br><span class="line">      initialDelaySeconds: 3 </span><br><span class="line">      <span class="comment">#å®¹å™¨æ¯éš”2sæ£€æµ‹ä¸€æ¬¡</span></span><br><span class="line">      periodSeconds: 2</span><br><span class="line">      <span class="comment">#è¶…æ—¶æ—¶é—´ 1s</span></span><br><span class="line">      timeoutSeconds: 1</span><br><span class="line">      <span class="comment">#æˆåŠŸä¹‹å3æ¬¡è¿ç»­å¤±è´¥ï¼Œæ‰æ˜¯çœŸå¤±è´¥ï¼Œç„¶åé‡æ–°å»æ‹‰èµ·ï¼Œé¿å…ç½‘ç»œæ³¢åŠ¨çš„æƒ…å†µ</span></span><br><span class="line">      failureThreshold: 3</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">2ã€åˆ é™¤æ—§podï¼Œè¿è¡Œæ–°pod</span><br><span class="line">[root@master01 kubernetes]# kubectl delete pod ivenssprobe-pod &amp;&amp; kubectl apply -f ivenssprobe.yml </span><br><span class="line">pod <span class="string">&quot;ivenssprobe-pod&quot;</span> deleted</span><br><span class="line">pod/ivenssprobe-pod created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod ivenssprobe-pod  -owide</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE     IP          NODE  </span><br><span class="line">ivenssprobe-pod   1/1     Running   0          8m58s   10.2.1.14   node01</span><br><span class="line"></span><br><span class="line">3ã€è¿æ¥è¿›å…¥å®¹å™¨ï¼Œæ–­å¼€ç«¯å£</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it ivenssprobe-pod -c nginx-container -- /bin/sh</span><br><span class="line">/ <span class="comment">#  nginx -s stop</span></span><br><span class="line">æ‰§è¡Œä¹‹åå®¹å™¨ä¼šè‡ªåŠ¨é€€å‡ºï¼Œå› ä¸ºå­˜æ´»æ€§æ¢é’ˆæ£€æµ‹åˆ°ç«¯å£ä¸è§äº†ï¼ŒæŠŠå°±å®¹å™¨åˆ é™¤ï¼Œå°±ä¼šè¢«å¼ºåˆ¶è¸¢å‡ºæ¥</span><br></pre></td></tr></table></figure><p>2ã€å°±ç»ªæ€§æ¢é’ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å°±ç»ªæ€§æ¢é’ˆ(å°±ç»ªæ€æ¢é’ˆ) readnissprobe  </span></span><br><span class="line">å°±ç»ªæ€§æ¢é’ˆé…ç½®è¯­æ³•å’Œå­˜æ´»æ¢é’ˆåŸºæœ¬ä¸€æ ·</span><br><span class="line"></span><br><span class="line">æœ‰æ—¶å€™æˆ‘ä»¬Podæœ¬èº«å·²ç»èµ·æ¥äº†ï¼Œä½†æ˜¯podçš„å®¹å™¨è¿˜æ²¡æœ‰å®Œå…¨å‡†å¤‡å¥½å¯¹å¤–æä¾›æœåŠ¡ï¼Œé‚£ä¹ˆè¿™æ—¶å€™æµé‡è¿›æ¥å°±ä¼šé€ æˆè¯·æ±‚å¤±è´¥çš„æƒ…å†µå‡ºç°ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µk8sæœ‰ä¸€ç§æ¢é’ˆå«å°±ç»ªæ¢é’ˆï¼Œä»–çš„ä½œç”¨å°±æ˜¯è®©k8sçŸ¥é“ä½ çš„Podå†…åº”ç”¨æ˜¯å¦å‡†å¤‡å¥½ä¸ºè¯·æ±‚æä¾›æœåŠ¡ã€‚åªæœ‰å°±ç»ªæ¢é’ˆokäº†æ‰ä¼šæŠŠæµé‡è½¬å‘åˆ°podä¸Šã€‚</span><br><span class="line"></span><br><span class="line">åº”ç”¨åœºæ™¯ï¼šæ¯”å¦‚è¯´æ•°æ®åº“éœ€è¦åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–çš„æ—¶å€™é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œnginxå®¹å™¨èµ·æ¥çš„é€Ÿåº¦å¿«ï¼Œä½†æ˜¯æ•°æ®åº“æ²¡èµ·æ¥ï¼Œè®¿é—®è‚¯å®šæ˜¯502ï¼Œå°±å¥½æ¯”gitlab,nginxèµ·æ¥äº†ï¼Œç»„ä»¶æ²¡èµ·æ¥ï¼Œè®¿é—®æ˜¾ç¤º502ï¼Œå°±ç»ªæ¢é’ˆå°±æ˜¯ç­‰æ•°æ®èµ·æ¥ï¼Œæ‰å¯¹å¤–æä¾›æœåŠ¡(å°±æ˜¯æµè§ˆå™¨æ­£å¸¸è®¿é—®)</span><br><span class="line">ä½†æ˜¯æƒ³è¦æ£€æµ‹ï¼Œå°±è¦ç”¨åˆ°serviceèµ„æº</span><br></pre></td></tr></table></figure><p>ç¼–å†™èµ„æºæ¸…å•ï¼šéœ€æ±‚</p><p>nginxçš„podå¯åŠ¨ï¼Œå‰ææ¡ä»¶æ˜¯æ•°æ®åº“podä¹Ÿå¯åŠ¨èµ·æ¥ï¼Œå¹¶ä¸”æ•°æ®åº“å·²åˆå§‹åŒ–å®Œäº†ï¼Œç„¶åå†å¯¹å¤–æä¾›æœåŠ¡</p><ul><li>å°±ç»ªæ¢é’ˆ  execå‘½ä»¤ç‰ˆ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim readnessprobe.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: readnessprobe-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: readnessprobe</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data</span><br><span class="line">    hostPath:</span><br><span class="line">     path: /data/nginx</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"><span class="comment">#ä½¿ç”¨å¯åŠ¨é’©å­ç»™nginxä¸€ä¸ªåˆå§‹é¡µé¢ï¼Œåˆå§‹åŒ–å®¹å™¨æˆ–è€…å¯åŠ¨é’©å­éƒ½è¡Œï¼Œä¸ç„¶æŒ‚è½½å‡ºæ¥æ²¡é¡µé¢</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s å°±ç»ªæ€§æ¢é’ˆreadnessprobe&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    livenessProbe:</span><br><span class="line">      httpGet:</span><br><span class="line">        path: /</span><br><span class="line">        port: 80</span><br><span class="line"><span class="comment">#å°±ç»ªæ€§æ¢é’ˆå†™æ³•</span></span><br><span class="line">    readinessProbe:</span><br><span class="line">      <span class="built_in">exec</span>:</span><br><span class="line"><span class="comment">#æ£€æµ‹æ–‡ä»¶æ˜¯å¦æœ‰å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰æ–‡ä»¶å°±æ²¡æœ‰å°±ç»ª</span></span><br><span class="line">        <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /usr/share/nginx/html/healthy.html&quot;</span>]</span><br><span class="line">      </span><br><span class="line"><span class="comment">#ä¸€å®šè¦å†™ä¼˜åŒ–å‚æ•°</span></span><br><span class="line">      <span class="comment">#å»¶è¿Ÿæ—¶é—´3s</span></span><br><span class="line">      initialDelaySeconds: 3 </span><br><span class="line">      <span class="comment">#å®¹å™¨æ¯éš”2sæ£€æµ‹ä¸€æ¬¡</span></span><br><span class="line">      periodSeconds: 2</span><br><span class="line">      <span class="comment">#è¶…æ—¶æ—¶é—´ 1s</span></span><br><span class="line">      timeoutSeconds: 1</span><br><span class="line">      <span class="comment">#æˆåŠŸä¹‹å3æ¬¡è¿ç»­å¤±è´¥ï¼Œæ‰æ˜¯çœŸå¤±è´¥ï¼Œç„¶åé‡æ–°å»æ‹‰èµ·ï¼Œé¿å…ç½‘ç»œæ³¢åŠ¨çš„æƒ…å†µ</span></span><br><span class="line">      failureThreshold: 3</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯ç°åœ¨æ²¡æœ‰/usr/share/nginx/html/healthy.htmlè¿™ä¸ªæ–‡ä»¶ï¼Œé‚£å®¹å™¨è‚¯å®šæ˜¯ä¸€ç›´ä¸å°±ç»ªçš„</span><br><span class="line"></span><br><span class="line">2ã€åˆ é™¤æ—§pod,åˆ›å»ºæ–°pod</span><br><span class="line">[root@master01 kubernetes]# kubectl delete pod ivenssprobe-pod</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f readnessprobe.yml </span><br><span class="line">pod/readnessprobe-pod created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod readnessprobe-pod -owide</span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE   IP          NODE </span><br><span class="line">readnessprobe-pod   0/1     Running   0          69s   10.2.1.15   node01</span><br><span class="line"></span><br><span class="line">READYä¸€ç›´æ˜¾ç¤º0/1,ä¸€ç›´ä¸å°±ç»ªï¼Œå°±ä¸å¯¹å¤–æä¾›æµé‡ï¼Œä¸å¯¹å¤–æä¾›æµé‡ï¼Œä½†æ˜¯é¡µé¢å¯ä»¥è®¿é—®</span><br><span class="line">[root@master01 kubernetes]# curl 10.2.1.15</span><br><span class="line"><span class="built_in">test</span> k8s å°±ç»ªæ€§æ¢é’ˆreadnessprobe</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹å¤–æä¾›æµé‡å‰é¢è¦åŠ è´Ÿè½½å‡è¡¡å’Œç«¯å£æ˜ å°„ï¼Œå¾—ç”¨serviceè´Ÿè½½å‡ºæ¥</span></span><br><span class="line">3ã€ç¼–å†™serviceèµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# <span class="built_in">cp</span> ivenssprobe-service.yml readnessprobe-service.yml</span><br><span class="line">[root@master01 kubernetes]# vim readnessprobe-service.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: readnessprobe-service</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: readnessprobe</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">    <span class="comment">#ä¸èƒ½ç«¯å£å†²çªï¼Œæ‰€ä»¥ç«¯å£éœ€è¦æ”¹ä¸€ä¸‹</span></span><br><span class="line">    nodePort: 30001</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line"></span><br><span class="line">4ã€å¯åŠ¨å¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f readnessprobe-service.yml</span><br><span class="line">service/readnessprobe-service created</span><br><span class="line">[root@master01 kubernetes]# kubectl get svc</span><br><span class="line">NAME                    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes              ClusterIP   10.1.0.1      &lt;none&gt;        443/TCP        7d9h</span><br><span class="line">readnessprobe-service   NodePort    10.1.234.20   &lt;none&gt;        80:30001/TCP   17s</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1ã€æµ‹è¯•curl</span><br><span class="line">[root@master01 kubernetes]# curl 10.1.234.20</span><br><span class="line">curl: (7) Failed connect to 10.1.234.20:80; Connection refused</span><br><span class="line">æ²¡æœ‰ç»“æœï¼Œå› ä¸ºå°±ç»ªæ¢é’ˆæ²¡æœ‰å°±ç»ª</span><br><span class="line"></span><br><span class="line">2ã€åœ¨nodeèŠ‚ç‚¹æ˜ å°„çš„å®¿ä¸»æœºç›®å½•åˆ›å»ºå°±ç»ªæ–‡ä»¶</span><br><span class="line">[root@node01 ~]# <span class="built_in">touch</span> /data/nginx/healthy.html</span><br><span class="line"></span><br><span class="line">3ã€åˆ°masteræŸ¥çœ‹å°±ç»ªçŠ¶æ€ï¼Œå·²ç»å˜æˆå°±ç»ªå®Œæˆ</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod readnessprobe-pod -owide</span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE   IP          NODE  </span><br><span class="line">readnessprobe-pod   1/1     Running   0          16m   10.2.1.15   node01</span><br><span class="line">[root@master01 kubernetes]#  curl 10.1.234.20</span><br><span class="line"><span class="built_in">test</span> k8s å°±ç»ªæ€§æ¢é’ˆreadnessprobe</span><br><span class="line"></span><br><span class="line">4ã€æ£€æŸ¥å·²ç»å¯¹å¤–æä¾›æœåŠ¡äº†</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240920201911358.png" alt="image-20240920201911358"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">5ã€åˆ é™¤å°±ç»ªæ–‡ä»¶ï¼Œcurlå¤±è´¥ï¼Œæœªå°±ç»ªï¼Œç½‘ç«™æ— æ³•è®¿é—®</span><br><span class="line">[root@node01 ~]# <span class="built_in">rm</span> -rf /data/nginx/healthy.html</span><br><span class="line">[root@master01 kubernetes]#  curl 10.1.234.20</span><br><span class="line">curl: (7) Failed connect to 10.1.234.20:80; Connection refused</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod readnessprobe-pod -owide</span><br><span class="line"></span><br><span class="line">podçš„ipå¯ä»¥é€šï¼Œä»£è¡¨å¯¹å†…æä¾›æœåŠ¡</span><br><span class="line">[root@master01 kubernetes]# curl 10.2.1.15</span><br><span class="line"><span class="built_in">test</span> k8s å°±ç»ªæ€§æ¢é’ˆreadnessprobe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚ä¸Šæ˜¯å°±ç»ªæ¢é’ˆçš„ä½¿ç”¨æ–¹æ³•ï¼Œä½†æ˜¯æ­£å¸¸ä¸ä¼šè¿™æ ·å­åšï¼Œå°±åƒèµ·wp,å°±è¦æ£€æµ‹æ•°æ®åº“æœ‰æ²¡æœ‰å‡†å¤‡å¥½</span><br></pre></td></tr></table></figure><p>nginxå’Œmysqlï¼Œæ£€æµ‹mysqlæ˜¯å¦å°±ç»ªï¼Œå°±åƒå°±å¯¹å¤–æä¾›æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 kubernetes]# vim readness-mysql.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: readnessprobe-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: readnessprobe</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: nginx-data</span><br><span class="line">    hostPath:</span><br><span class="line">     path: /data/nginx</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"><span class="comment">#ä½¿ç”¨å¯åŠ¨é’©å­ç»™nginxä¸€ä¸ªåˆå§‹é¡µé¢ï¼Œåˆå§‹åŒ–å®¹å™¨æˆ–è€…å¯åŠ¨é’©å­éƒ½è¡Œï¼Œä¸ç„¶æŒ‚è½½å‡ºæ¥æ²¡é¡µé¢</span></span><br><span class="line">    lifecycle: </span><br><span class="line">      postStart: </span><br><span class="line">        <span class="built_in">exec</span>:</span><br><span class="line">          <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;test k8s å°±ç»ªæ€§æ¢é’ˆreadnessprobe&#x27; &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">    livenessProbe:</span><br><span class="line">      httpGet:</span><br><span class="line">        path: /</span><br><span class="line">        port: 80</span><br><span class="line"><span class="comment">#å°±ç»ªæ€§æ¢é’ˆå†™æ³•  #è¦æ£€æµ‹æ•°æ®åªèƒ½ç”¨tcpsocket,é™¤éæ˜¯è¿™ä¸ªç½‘ç«™å¯åŠ¨è¦ä¾èµ–å…¶ä»–ç½‘ç«™å°±ç”¨httpGet:</span></span><br><span class="line">    readinessProbe:</span><br><span class="line">      tcpSocket:</span><br><span class="line">        port: 3306</span><br><span class="line">      </span><br><span class="line"><span class="comment">#ä¸€å®šè¦å†™ä¼˜åŒ–å‚æ•°ï¼Œå­˜æ´»æ€§æ¢é’ˆè®¾ç½®çš„é¢‘ç‡è¦æ¯”å°±ç»ªæ¢é’ˆæ…¢ä¸€äº›</span></span><br><span class="line">      <span class="comment">#å»¶è¿Ÿæ—¶é—´3s</span></span><br><span class="line">      initialDelaySeconds: 3 </span><br><span class="line">      <span class="comment">#å®¹å™¨æ¯éš”2sæ£€æµ‹ä¸€æ¬¡</span></span><br><span class="line">      periodSeconds: 2</span><br><span class="line">      <span class="comment">#è¶…æ—¶æ—¶é—´ 1s</span></span><br><span class="line">      timeoutSeconds: 1</span><br><span class="line">      successThreshold: 3</span><br><span class="line">      <span class="comment">#æˆåŠŸä¹‹å3æ¬¡è¿ç»­å¤±è´¥ï¼Œæ‰æ˜¯çœŸå¤±è´¥ï¼Œç„¶åé‡æ–°å»æ‹‰èµ·ï¼Œé¿å…ç½‘ç»œæ³¢åŠ¨çš„æƒ…å†µ</span></span><br><span class="line">      failureThreshold: 3</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: nginx-data</span><br><span class="line">      mountPath: /usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">  - name: mysql-container</span><br><span class="line">    image: mysql:5.7.44</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">      value: <span class="string">&#x27;123&#x27;</span></span><br><span class="line">    <span class="comment">#åé¢çš„ä¼˜åŒ–ï¼Œæ¢é’ˆå¯ä»¥ç»§ç»­å†™</span></span><br><span class="line"></span><br><span class="line">2ã€å¯åŠ¨æ£€æŸ¥</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f readness-mysql.yml</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod readnessprobe-pod</span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE</span><br><span class="line">readnessprobe-pod   1/2     Running   0          62s</span><br><span class="line"></span><br><span class="line">1/2æ˜¯å› ä¸ºæ•°æ®åº“æ²¡æœ‰å†™å°±ç»ªæ¢é’ˆï¼Œå¦‚æœå†™äº†ï¼Œå°±æ˜¯0/2,æ•°æ®åº“çš„å°±ç»ªæ¢é’ˆå°±å†™æ£€æµ‹è‡ªå·±çš„3306ç«¯å£</span><br><span class="line">ç­‰å¾…ä¸€ä¼šï¼Œmysqlåˆå§‹åŒ–å®Œæˆå°±ç»ªå®Œæˆ</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod readnessprobe-pod</span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE</span><br><span class="line">readnessprobe-pod   2/2     Running   0          18s</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl get svc </span><br><span class="line">NAME                    TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes              ClusterIP   10.1.0.1      &lt;none&gt;        443/TCP        7d10h</span><br><span class="line">readnessprobe-service   NodePort    10.1.234.20   &lt;none&gt;        80:30001/TCP   52m</span><br><span class="line">[root@master01 kubernetes]# curl 10.1.234.20</span><br><span class="line"><span class="built_in">test</span> k8s å°±ç»ªæ€§æ¢é’ˆreadnessprobe</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å­˜æ´»æ¢é’ˆå’Œå°±ç»ªæ¢é’ˆåŒæ—¶å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ•°æ®åº“æ²¡æœ‰å‡†å¤‡å¥½å°±ä¸å°±ç»ªï¼Œé¡µé¢å°±ä¸€ç›´æ˜¯502ï¼Œå‡ºç°502ï¼Œå­˜æ´»æ¢é’ˆé¢‘ç‡é…é«˜äº†ï¼Œæ£€æµ‹åˆ°æœ‰é—®é¢˜å°±ä¼šé‡æ–°æ‹‰èµ·ï¼Œè¿™æ ·å°±è¿›å…¥æ­»å¾ªç¯ï¼Œå¦‚æœ2ä¸ªå®¹å™¨åœ¨ä¸€ä¸ªpodé‡Œï¼Œæ•°æ®æ°¸è¿œèµ·ä¸æ¥ï¼Œå› ä¸ºæŠŠpodåˆ äº†ï¼Œä¼šé‡æ–°åˆ›å»ºï¼Œè¿›å…¥æ­»å¾ªç¯ï¼Œæ‰€ä»¥å­˜æ´»æ¢é’ˆè¦æ¯”å°±ç»ªæ¢é’ˆè®¾ç½®çš„é¢‘ç‡æ…¢</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ï¼šwordpressé•œåƒ</span><br><span class="line">åœ¨ä¸€ä¸ªPODé‡Œå¯åŠ¨ä¸¤ä¸ªå®¹å™¨</span><br><span class="line">- wordpress</span><br><span class="line">- mysql5.7</span><br><span class="line">1.å°±ç»ªæ€§æ¢é’ˆ</span><br><span class="line">2.å­˜æ´»æ€§æ¢é’ˆ</span><br><span class="line">3.å¯åŠ¨é’©å­</span><br><span class="line">4.åœæ­¢é’©å­</span><br><span class="line">5.åˆå§‹åŒ–å®¹å™¨</span><br><span class="line"></span><br><span class="line">äºŒï¼šå°è¯• wordpress å¯åŠ¨ä¸€ä¸ªPOD</span><br><span class="line">MySQLå•ç‹¬å¯åŠ¨åœ¨ä¸€ä¸ªPODé‡Œ,å¦‚ä½•è¿æ¥ï¼Œæ‰èƒ½è®©ç½‘ç«™èƒ½å¤Ÿæ­£å¸¸è®¿é—®</span><br><span class="line"></span><br><span class="line">ä¸‰ï¼šå°è¯• nginx å’Œ phpç¯å¢ƒåˆ†å¼€è£…ï¼Œéƒ¨ç½²ä»£ç </span><br><span class="line">fastcgi_pass unix://dev/shm/php.sock</span><br><span class="line"></span><br><span class="line">ä¸€å¼€å§‹æ˜¯è¿™æ ·å­å†™çš„fastcgi_pass 127.0.0.1:9000ï¼Œä½†æ˜¯ç°åœ¨è¦åˆ†å¼€å®‰è£…ï¼Œå°±è¦å†™å†…å¤–ip  fastcgi_pass 172.16.1.8:9000</span><br><span class="line">æµ‹è¯•ï¼Œä¸Šä¼ å›¾ç‰‡</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰4ã€æ ‡ç­¾çš„è®¾ç½®åŠä½¿ç”¨</title>
      <link href="/posts/4666867d.html"/>
      <url>/posts/4666867d.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ ‡ç­¾çš„è®¾ç½®åŠä½¿ç”¨">æ ‡ç­¾çš„è®¾ç½®åŠä½¿ç”¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">kubectl get  [èµ„æº] -n [åç§°ç©ºé—´] --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹nodeæ ‡ç­¾</span></span><br><span class="line">[root@master01 ~]# kubectl get nodes --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹podçš„æ ‡ç­¾</span></span><br><span class="line">[root@master01 ~]# kubectl get  pod -n kube-flannel --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™nodeæ‰“æ ‡ç­¾</span></span><br><span class="line">[root@master01 ~]# kubectl label node node01 MEM=16G</span><br><span class="line">node/node01 labeled</span><br><span class="line">[root@master01 ~]# kubectl get nodes --show-labels</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™nodeæ‰“è§’è‰²æ ‡ç­¾ï¼šä¸ºäº†åŒºåˆ†é¡¹ç›®åï¼Œæˆ–è€…é…ç½®</span></span><br><span class="line">node-role  è§’è‰²æ ‡ç­¾çš„æ¥å£</span><br><span class="line">node-role.kubernetes.io  æ ‡è¯†è°ƒè§’è‰²æ ‡ç­¾çš„æ¥å£</span><br><span class="line">=å˜æˆ-å·ï¼Œå°±æ˜¯åˆ é™¤è§’è‰²æ ‡ç­¾  node-</span><br><span class="line">node=  ï¼šè¡¨ç¤ºç»™è§’è‰²æ‰“çš„æ ‡ç­¾åå«node</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# kubectl label node node01 node-role.kubernetes.io/node=</span><br><span class="line">[root@master01 ~]# kubectl get nodes</span><br><span class="line">NAME       STATUS   ROLES    AGE     VERSION</span><br><span class="line">master01   Ready    master   5d23h   v1.19.3</span><br><span class="line">node01     Ready    node     5d23h   v1.19.3</span><br><span class="line">node02     Ready    node     5d23h   v1.19.3</span><br><span class="line">node03     Ready    node     5d23h   v1.19.3</span><br></pre></td></tr></table></figure><p><font color=red><strong>ç»™podæ‰“æ ‡ç­¾çš„æ–¹æ³•ï¼šÂ  Â  å¦‚æœä¸èµ„æºæ¸…å•é‡Œé¢ä¸å†™æ ‡ç­¾ï¼Œèµ·æ¥çš„podå°±æ²¡æœ‰æ ‡ç­¾ï¼Œä¸ä¼šå­˜åœ¨é»˜è®¤æ ‡ç­¾çš„è¯´æ³•ï¼Œæ‰€ä»¥èµ„æºæ¸…å•é‡Œé¢ä¸€å®šè¦å†™æ ‡ç­¾</strong></font></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç»™podæ‰“æ ‡ç­¾ä¸ºäº†ä»¥åé€šä¿¡ç”¨</span></span><br><span class="line">æ–¹æ³•ä¸€ï¼š</span><br><span class="line">ä½¿ç”¨å‘½ä»¤æ‰“æ ‡ç­¾ï¼š(ä¸€èˆ¬å¾ˆå°‘ç”¨å‘½ä»¤æ‰“æ ‡ç­¾ï¼Œä»¥åèµ·podæ˜¯ç”¨èµ„æºæ¸…å•çš„ï¼Œæ‰€ä»¥åœ¨èµ„æºæ¸…å•é‡Œé¢æ‰“æ ‡ç­¾æ¯”è¾ƒå¸¸ç”¨)</span><br><span class="line">[root@master01 ~]# kubectl label pod kube-flannel-ds-4ncf5 run=flannel -n kube-flannel </span><br><span class="line">kube-flannel-ds-4ncf5ï¼šPodå</span><br><span class="line">run=flannelï¼šæ ‡ç­¾å</span><br><span class="line">kube-flannelï¼šåç§°ç©ºé—´</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ–¹æ³•äºŒï¼š</span><br><span class="line"><span class="comment">#ç»™Podæ‰“æ ‡ç­¾(ç”¨èµ„æºæ¸…å•æ‰“ï¼Œæ¯”è¾ƒå¸¸ç”¨)</span></span><br><span class="line">[root@master01 kubernetes]# vim nginx-label.yml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata: </span><br><span class="line">  name: nginx-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    run: nginx</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx:alpine</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"></span><br><span class="line">è¿è¡Œèµ„æºæ¸…å• </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-label.yml </span><br><span class="line">æŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod --show-labels</span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-pod      1/1     Running   0          23s   run=nginx</span><br></pre></td></tr></table></figure><p>å°†podèµ·åˆ°æŒ‡å®šçš„nodeä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šé¢æ‰§è¡Œäº†å‘½ä»¤ç»™node01æ‰“MEM=16Gçš„æ ‡ç­¾</span><br><span class="line">[root@master01 ~]# kubectl label node node01 MEM=16G</span><br><span class="line"></span><br><span class="line">å°†podèµ·åœ¨MEM=16çš„èŠ‚ç‚¹ä¸Š</span><br><span class="line"><span class="comment">#å¯åŠ¨podåœ¨æŒ‡å®šæ ‡ç­¾çš„nodeä¸Š</span></span><br><span class="line">[root@master01 kubernetes]# vim nginx2-label.yml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata: </span><br><span class="line">  name: nginx-pod-v2</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    run: nginx</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container-v2</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="comment">#å°†podèµ·åœ¨MEM=16çš„èŠ‚ç‚¹ä¸Š</span></span><br><span class="line">  nodeSelector:</span><br><span class="line">    MEM: 16G</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#(ä¸€èˆ¬æ¥è¯´ä¸å†™å¦‚ä¸‹å†…å®¹ï¼Œå› ä¸ºk8sä¼šåšèµ„æºè®¡ç®—å’Œè°ƒåº¦ï¼Œä½†æ˜¯åœ¨èµ·redisæˆ–è€…æ•°æ®åº“è¿™ç§podçš„æ—¶å€™ï¼Œä»–ä¸¤å¯¹å†…å­˜çš„ä½¿ç”¨æ¯”è¾ƒå¤§ï¼Œå»ºè®®ä¸è¦èµ·åœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œè¿™ä¸ªæƒ…å†µå°±è¦ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤äº†ï¼Œé¿å…k8sè‡ªå·±èµ„æºè®¡ç®—ï¼Œå°†redisã€mysqlèµ·åœ¨åŒä¸€ä¸ªæœºå™¨) </span></span><br><span class="line">  nodeSelector:</span><br><span class="line">    MEM: 16G</span><br><span class="line"> </span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx2-label.yml </span><br><span class="line">pod/nginx-pod-v2 created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-pod                1/1     Running   0          17m</span><br><span class="line">nginx-pod-v2             1/1     Running   0          32s</span><br><span class="line">æŸ¥çœ‹èµ·åœ¨node01ä¸Šçš„</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod nginx-pod-v2  -o wide</span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE     IP         NODE  </span><br><span class="line">nginx-pod-v2   1/1     Running   0          6m26s   10.2.1.4   node01</span><br></pre></td></tr></table></figure><p>åˆ é™¤æ ‡ç­¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1ã€å…ˆæŸ¥çœ‹</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod --show-labels</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-pod                1/1     Running   0          31m   run=nginx</span><br><span class="line">nginx-pod-v2             1/1     Running   0          14m   run=nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#åˆ é™¤æ ‡ç­¾</span><br><span class="line">kubectl label [èµ„æº] [èµ„æºå] [æ ‡ç­¾å/æ ‡ç­¾key]-</span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# kubectl label pod nginx-pod-v2 run-</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod --show-labels</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-pod                1/1     Running   0          32m   run=nginx</span><br><span class="line">nginx-pod-v2             1/1     Running   0          15m   &lt;none&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®æ ‡ç­¾æŸ¥æ‰¾pod</span></span><br><span class="line">3ã€æŸ¥çœ‹å“ªäº›podæ‰“äº†run=nginxçš„æ ‡ç­¾ï¼Œæ‰“äº†è¿™ä¸ªæ ‡ç­¾çš„éƒ½ä¼šè¢«åˆ—å‡ºæ¥</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -l run=nginx</span><br><span class="line">NAME        READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-pod   1/1     Running   0          35m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ ¹æ®æ ‡ç­¾åˆ é™¤pod</span></span><br><span class="line">4ã€æ‰“äº†æ ‡ç­¾æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¯ä»¥æ ¹æ®æ ‡ç­¾å»ç­›é€‰ï¼Œè¿˜å¯ä»¥æ ¹æ®æ ‡ç­¾å»åˆ é™¤pod</span><br><span class="line">[root@master01 kubernetes]# kubectl delete pod -l run=nginx</span><br><span class="line">pod <span class="string">&quot;nginx-pod&quot;</span> deleted</span><br><span class="line"></span><br><span class="line">  ä½†æ˜¯ä¸€ä¸ªpodé‡Œé¢èµ·2ä¸ªå®¹å™¨æ€ä¹ˆè¿</span><br><span class="line">  -c æ°¸è¿œåªæœ‰3ä¸ªå¼•å·</span><br><span class="line">  é»˜è®¤è¿ç¬¬ä¸€ä¸ªå®¹å™¨</span><br><span class="line">  -cæŒ‡å®šå®¹å™¨å</span><br><span class="line">  <span class="comment">#å½“ä¸€ä¸ªpodä¸­æœ‰å¤šä¸ªå®¹å™¨æ—¶</span></span><br></pre></td></tr></table></figure><p>è¿æ¥åˆ°pod     å®¹å™¨å¯ä»¥ä½¿ç”¨å‘½ä»¤è¿æ¥è¿›å»ï¼Œpodä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤è¿æ¥è¿›å»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿æ¥åˆ°ä¸€ä¸ªpod</span></span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it  nginx-pod-v2 -- /bin/sh</span><br><span class="line">/ <span class="comment"># ls</span></span><br><span class="line">bin           etc  </span><br><span class="line"></span><br><span class="line">--ï¼šç›¸å½“äºåˆ†éš”ç¬¦,--åé¢çš„æ‰€æœ‰éƒ½æ˜¯å‘½ä»¤</span><br><span class="line"></span><br><span class="line"><span class="comment">#é—®é¢˜ï¼šä¸€ä¸ªpodé‡Œé¢èµ·2ä¸ªå®¹å™¨æ€ä¹ˆè¿ï¼Ÿ</span></span><br><span class="line">1ã€ç¼–å†™ä¸€ä¸ªpodèµ·2ä¸ªå®¹å™¨çš„èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim nginx-busybox.yml</span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-busybox</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: busybox-container</span><br><span class="line">    image: busybox</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line"> <span class="comment">#-cï¼šè¡¨ç¤ºæ°¸è¿œåªæœ‰3ä¸ªå¼•å·ï¼Œç¬¬3ä¸ªå¼•å·å¯ä»¥å†™é•¿çš„å‘½ä»¤</span></span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œpod,å¹¶æŸ¥çœ‹podæ˜¯å¦èµ·æ¥ï¼ŒæŸ¥çœ‹podèµ·åœ¨å“ªä¸ªæœºå™¨</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f nginx-busybox.yml </span><br><span class="line">pod/nginx-busybox created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-5f5d9d69c4-d8hvx   1/1     Running   0          19h</span><br><span class="line">nginx-busybox            2/2     Running   0          8s</span><br><span class="line">nginx-pod-v2             1/1     Running   0          43m</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod nginx-busybox -o wide</span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE     IP         NODE  </span><br><span class="line">nginx-busybox   2/2     Running   0          3m34s   10.2.2.5   node02</span><br><span class="line"></span><br><span class="line">3ã€è¿æ¥è¿›å…¥å®¹å™¨</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it nginx-busybox -- /bin/sh</span><br><span class="line">/ <span class="comment"># ls -l /usr</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x    2 root     root            17 May 18  2023 bin</span><br><span class="line">drwxr-xr-x    2 daemon   daemon           6 May 18  2023 sbin</span><br><span class="line"></span><br><span class="line">è¯¥ç›®å½•æ²¡æœ‰ç«™ç‚¹ç›®å½•ï¼Œæ‰€ä»¥è¿›å»çš„busyboxå®¹å™¨ï¼Œæ‰€ä»¥é»˜è®¤è¿ç¬¬ä¸€ä¸ªå®¹å™¨</span><br><span class="line"></span><br><span class="line">4ã€å¦‚æœéœ€è¦è¿æ¥æŒ‡å®šçš„å®¹å™¨ï¼Œéœ€è¦ä½¿ç”¨é€‰é¡¹-cæŒ‡å®š</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it nginx-busybox -c nginx-container -- /bin/sh</span><br><span class="line">/ <span class="comment"># ls -l /usr/share/nginx/html/</span></span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--    1 root     root           497 Aug 14 06:12 50x.html</span><br><span class="line">-rw-r--r--    1 root     root           615 Aug 14 06:12 index.html</span><br><span class="line"></span><br><span class="line">-cï¼šè¿æ¥åˆ°æŒ‡å®šçš„å®¹å™¨å</span><br><span class="line"></span><br><span class="line">ä½œç”¨ï¼šk8såªéœ€è¦åœ¨masterä¸Šæ“ä½œï¼Œå°±å¯ä»¥è¿åˆ°éœ€è¦è¿çš„å®¹å™¨</span><br></pre></td></tr></table></figure><h2 id="2ã€é‡æ–°è®¤è¯†Pod">2ã€<strong>é‡æ–°è®¤è¯†Pod</strong></h2><p>å…±äº«ç½‘ç»œ</p><p><img src="../image/study_img/image-20240919110354547.png" alt="image-20240919110354547"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1ã€Podå†…çš„å®¹å™¨ä½¿ç”¨Containeræ¨¡å¼å…±äº«æ ¹å®¹å™¨çš„ç½‘ç»œ</span><br><span class="line">2ã€å®¹å™¨çœ‹åˆ°çš„ç½‘ç»œè®¾å¤‡ä¿¡æ¯å’Œæ ¹å®¹å™¨å®Œå…¨ç›¸åŒ</span><br><span class="line">3ã€Podå†…çš„å¤šä¸ªå®¹å™¨å¯ä»¥ä½¿ç”¨localhostè¿›è¡Œç½‘ç»œé€šè®¯</span><br><span class="line">4ã€Podå†…çš„å¤šä¸ªå®¹å™¨ä¸èƒ½ç»‘å®šç›¸åŒçš„ç«¯å£</span><br><span class="line">5ã€Podçš„ç”Ÿå‘½å‘¨æœŸå’Œæ ¹å®¹å™¨ä¸€æ ·ï¼Œå¦‚æœæ ¹å®¹å™¨é€€å‡ºï¼ŒPodå°±é€€å‡º</span><br></pre></td></tr></table></figure><h2 id="3ã€å…±äº«æ–‡ä»¶ç³»ç»Ÿ">3ã€<strong>å…±äº«æ–‡ä»¶ç³»ç»Ÿ</strong></h2><h3 id="1ã€æœ¬åœ°å…±äº«å‚¨å­˜">1ã€<strong>æœ¬åœ°å…±äº«å‚¨å­˜</strong></h3><p><img src="../image/study_img/image-20240919165826698.png" alt="image-20240919165826698"></p><p>ç¬¬ä¸€ç§ï¼šhostPath  æœ¬åœ°çš„æ˜ å°„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿è¡Œæ•°æ®åº“</span></span><br><span class="line">docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wp_db \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim wp.yml</span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: mysql57-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql57</span><br><span class="line">    run: mysql57</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment">#è®¾ç½®æŒ‚è½½æ˜ å°„çš„å†™æ³•   æŒ‡å®šå®¿ä¸»æœºçš„æŒ‚è½½ç›®å½•</span></span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data       <span class="comment">#åå­—ä¸€å®šè¦å†™ï¼Œè®¾ç½®æŒ‚è½½çš„å˜é‡ï¼Œç›¸å½“äºå˜é‡å</span></span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql    <span class="comment">#å®¿ä¸»æœºçš„ç›®å½•ï¼Œç›¸å½“äºå˜é‡å€¼</span></span><br><span class="line">  - name: test-data</span><br><span class="line">    hostPath:</span><br><span class="line">      path: /opt/test</span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: mysql57-container</span><br><span class="line">    image: mysql:5.7.44</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: <span class="string">&quot;wp_db&quot;</span></span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: <span class="string">&quot;wp_user&quot;</span></span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="comment">#æŒ‡å®šå­—ç¬¦é›†çš„å†™æ³•</span></span><br><span class="line">    args:</span><br><span class="line">    - --character-set-server=utf8mb4</span><br><span class="line">    - --collation-server=utf8mb4_unicode_ci</span><br><span class="line"><span class="comment">#å®¹å™¨é‡Œé¢çš„ç›®å½•æŒ‚è½½å‡ºæ¥çš„å†™æ³•</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: mysql-data             <span class="comment">#ç°åœ¨å®¹å™¨çš„ç›®å½•è¦æŒ‚åˆ°å®¿ä¸»æœºçš„å“ªä¸ªç›®å½•ï¼Œå°±å†™å®¿ä¸»æœºç›®å½•çš„å˜é‡å</span></span><br><span class="line">      mountPath: /var/lib/mysql    <span class="comment">#è¿™é‡Œå†™å®¹å™¨é‡Œéœ€è¦æŒ‚å‡ºæ¥çš„ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###</span></span><br><span class="line">--xxxä¸€èˆ¬ç”¨args</span><br><span class="line">å¦‚æœæ˜¯ä¸€æ¡å®Œæ•´çš„å‘½ä»¤å°±ç”¨<span class="built_in">command</span></span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œèµ„æºæ¸…å•ï¼Œå¹¶æŸ¥çœ‹podè¿è¡Œçš„node</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f mysql.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -o wide</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE     IP          NODE  </span><br><span class="line">mysql57-pod              1/1     Running   0          3m42s   10.2.3.14   node03</span><br><span class="line"></span><br><span class="line">3ã€åˆ°node03èŠ‚ç‚¹æŸ¥çœ‹ç›®å½•æ˜¯å¦æ˜ å°„</span><br><span class="line">[root@node03 ~]# ll /data/mysql/</span><br><span class="line">-rw-r----- 1 polkitd input       56 Sep 19 18:29 auto.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç›®å½•æ˜ å°„å‡ºæ¥äº†ï¼Œå¦‚æœmysqlæŒ‚äº†ï¼Œå†æ‹‰èµ·ï¼Œæ•°æ®æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä¸åšæ˜ å°„ï¼Œk8sè‡ªåŠ¨æ‹‰èµ·ï¼Œæ•°æ®å°±ä¼šå…¨éƒ¨æ²¡æœ‰</span></span><br><span class="line"></span><br><span class="line">å®¹å™¨é‡Œé¢mysqlç”¨æˆ·çš„uid gidéƒ½æ˜¯999ï¼Œå®¿ä¸»æœºä¸Šuidä¸º999çš„æ˜¯polkitd,gidä¸º999çš„æ˜¯inputï¼Œç³»ç»Ÿåªè®¤IDï¼Œä¸è®¤å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²æ˜¯ç»™äººçœ‹çš„ï¼ŒçŸ¥é“åå­—å°±æ›´å¥½åŒºåˆ†</span><br><span class="line"></span><br><span class="line">4ã€è¿æ¥åˆ°å®¹å™¨é‡Œé¢æ£€æŸ¥</span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it pod/mysql57-pod -- /bin/sh</span><br><span class="line">sh-4.2# mysql -uroot -p123</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> host,user from mysql.user;</span><br><span class="line">mysql&gt; show create database wp_db;</span><br><span class="line">sh-4.2# mysql -uwp_user -p123</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:left">Value</th><th style="text-align:left">Behavior</th></tr></thead><tbody><tr><td style="text-align:left"><code>â€Œ&quot;&quot;</code></td><td style="text-align:left">é»˜è®¤ä¸éœ€è¦åˆ›å»ºï¼Œä¼šè‡ªåŠ¨åˆ›å»º</td></tr><tr><td style="text-align:left"><code>DirectoryOrCreate</code></td><td style="text-align:left">ç›®å½•å¿…é¡»å­˜åœ¨ï¼Œæƒé™å¿…é¡»æ˜¯755</td></tr><tr><td style="text-align:left"><code>Directory</code></td><td style="text-align:left">ç›®å½•å¿…é¡»å­˜åœ¨</td></tr><tr><td style="text-align:left"><code>FileOrCreate</code></td><td style="text-align:left">æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œæƒé™å¿…é¡»æ˜¯644</td></tr><tr><td style="text-align:left"><code>File</code></td><td style="text-align:left">æ–‡ä»¶å¿…é¡»å­˜åœ¨</td></tr><tr><td style="text-align:left"><code>Socket</code></td><td style="text-align:left">æŒ‚è½½socketæ–‡ä»¶</td></tr><tr><td style="text-align:left"><code>CharDevice</code></td><td style="text-align:left">æŒ‚è½½å­—ç¬¦è®¾å¤‡æ–‡ä»¶ï¼ˆé”®ç›˜ï¼Œé¼ æ ‡ï¼Œç»ˆç«¯â€¦ï¼‰</td></tr><tr><td style="text-align:left"><code>BlockDevice</code></td><td style="text-align:left">æŒ‚è½½å¿«è®¾å¤‡æ–‡ä»¶ï¼ˆç£ç›˜ï¼ŒUç›˜ï¼Œç§»åŠ¨ç¡¬ç›˜â€¦ï¼‰</td></tr></tbody></table><p>ç¬¬äºŒç§ï¼šemptyDir</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# vim wp.yml</span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: mysql57-pod</span><br><span class="line">  namespace: default</span><br><span class="line">  labels:</span><br><span class="line">    app: mysql57</span><br><span class="line">    run: mysql57</span><br><span class="line">spec:</span><br><span class="line">  <span class="comment">#è®¾ç½®æŒ‚è½½æ˜ å°„çš„å†™æ³•   æŒ‡å®šå®¿ä¸»æœºçš„æŒ‚è½½ç›®å½•</span></span><br><span class="line">  volumes:</span><br><span class="line">  - name: mysql-data       <span class="comment">#åå­—ä¸€å®šè¦å†™ï¼Œè®¾ç½®æŒ‚è½½çš„å˜é‡ï¼Œç›¸å½“äºå˜é‡å</span></span><br><span class="line">    hostPath:</span><br><span class="line">      path: /data/mysql    <span class="comment">#å®¿ä¸»æœºçš„ç›®å½•ï¼Œç›¸å½“äºå˜é‡å€¼</span></span><br><span class="line">  - name: empty-data</span><br><span class="line">    emptyDir: &#123;&#125;           <span class="comment">#é»˜è®¤æ˜¯ç©ºçš„è¯å°±å†™&#123;&#125;</span></span><br><span class="line">      </span><br><span class="line">  containers:</span><br><span class="line">  - name: mysql57-container</span><br><span class="line">    image: mysql:5.7.44</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: <span class="string">&quot;wp_db&quot;</span></span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: <span class="string">&quot;wp_user&quot;</span></span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="comment">#æŒ‡å®šå­—ç¬¦é›†çš„å†™æ³•</span></span><br><span class="line">    args:</span><br><span class="line">    - --character-set-server=utf8mb4</span><br><span class="line">    - --collation-server=utf8mb4_unicode_ci</span><br><span class="line"><span class="comment">#å®¹å™¨é‡Œé¢çš„ç›®å½•æŒ‚è½½å‡ºæ¥çš„å†™æ³•</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: empty-data             <span class="comment">#ç°åœ¨å®¹å™¨çš„ç›®å½•è¦æŒ‚åˆ°å®¿ä¸»æœºçš„å“ªä¸ªç›®å½•ï¼Œå°±å†™å®¿ä¸»æœºç›®å½•çš„å˜é‡å</span></span><br><span class="line">      mountPath: /var/lib/mysql    <span class="comment">#è¿™é‡Œå†™å®¹å™¨é‡Œéœ€è¦æŒ‚å‡ºæ¥çš„ç›®å½•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€åˆ é™¤node03çš„dataç›®å½•</span><br><span class="line">[root@node03 ~]# <span class="built_in">rm</span> -rf /data/mysql/</span><br><span class="line"></span><br><span class="line">3ã€åˆ é™¤ä¸Šä¸€æ¬¡å®éªŒèµ·çš„pod,é‡æ–°è¿è¡Œèµ„æºæ¸…å•</span><br><span class="line">[root@master01 kubernetes]# kubectl delete pod  mysql57-pod</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f mysql.yml </span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -o wide</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE     IP          NODE  </span><br><span class="line">mysql57-pod              1/1     Running   0          59s     10.2.3.24   node03</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€æŸ¥è¯¢æ˜ å°„çš„datamç›®å½•</span><br><span class="line">[root@node03 ~]# docker inspect 1dd8436185b0</span><br><span class="line"><span class="comment">#æŸ¥æ‰¾Mounts</span></span><br><span class="line"><span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;bind&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/kubelet/pods/b3994de1-53ba-4ccf-b3b1-a7bdc8f1b08d/volumes/kubernetes.io~empty-dir/empty-data&quot;</span>,</span><br><span class="line"></span><br><span class="line">[root@node03 ~]# ll /var/lib/kubelet/pods/b3994de1-53ba-4ccf-b3b1-a7bdc8f1b08d/volumes/kubernetes.io~empty-dir/empty-data</span><br><span class="line">total 188484</span><br><span class="line">-rw-r----- 1 polkitd input       56 Sep 19 20:05 auto.cnf</span><br><span class="line"></span><br><span class="line">emptyDir: &#123;&#125;</span><br><span class="line">åªæ˜¯ä¸´æ—¶ä½¿ç”¨ï¼šéšæœºçš„ä¸´æ—¶ç›®å½•  å®¹å™¨åˆ é™¤ï¼Œè¿™ä¸ªç›®å½•å°±ä¼šè¢«åˆ é™¤ï¼Œåšä¸åˆ°æŒä¹…åŒ–</span><br><span class="line"></span><br><span class="line">ä½œç”¨ï¼šåœ¨åŒä¸€ä¸ªPodé‡Œ,2ä¸ªå®¹å™¨ä¹‹é—´çš„æ–‡ä»¶æ˜¯äº’ç›¸éš”ç¦»çš„ï¼Œæƒ³è®©ä»–ä»¬äº’é€šæŸä¸ªç›®å½•å°±å¯ä»¥ä½¿ç”¨åˆ°ï¼Œè®©2ä¸ªå®¹å™¨åŒæ—¶éƒ½æŒ‚è½½åˆ°è¿™ä¸ªç›®å½•ï¼Œè¿™æ ·å­è¿™ä¸¤ä¸ªå®¹å™¨å°±æ‰¾åˆ°å…±äº«è¿™ä¸ªç›®å½•</span><br></pre></td></tr></table></figure><p>å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•</span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: c7-nginx</span><br><span class="line">  namespace: default</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: empty-data</span><br><span class="line">    emptyDir: &#123;&#125; </span><br><span class="line">  containers:</span><br><span class="line">  - name: nginx-container</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: empty-data</span><br><span class="line">      mountPath: /usr/share/nginx/html     </span><br><span class="line">      <span class="comment">#è®©busyboxæŒ‚åˆ°å®¿ä¸»æœºçš„éšæœºç›®å½•</span></span><br><span class="line"> </span><br><span class="line">  - name: c7-container</span><br><span class="line">    image: centos:7</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /etc/hosts&quot;</span>]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: empty-data</span><br><span class="line">      mountPath: /opt/html    </span><br><span class="line">      <span class="comment">#è®©c7æŒ‚åˆ°å®¿ä¸»æœºçš„éšæœºç›®å½•</span></span><br><span class="line">      <span class="comment">#éƒ½æ˜¯æŒ‚åˆ°å®¿ä¸»æœºçš„ä¸´æ—¶ç›®å½•ï¼Œè¿™ä¸¤ä¸ªç›®å½•é‡Œé¢çš„æ–‡ä»¶è‚¯å®šæ˜¯äº’é€šçš„</span></span><br><span class="line">      </span><br><span class="line">2ã€è¿è¡Œèµ„æºæ¸…å•ï¼Œå¹¶æŸ¥çœ‹podè¿è¡Œçš„node</span><br><span class="line">[root@master01 kubernetes]# kubectl apply -f c7-busybox-emptyDir.yml </span><br><span class="line">pod/c7-nginx created</span><br><span class="line">[root@master01 kubernetes]# kubectl get pod -o wide</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE     IP          NODE  </span><br><span class="line">c7-nginx                 2/2     Running   0          5s      10.2.3.30   node03</span><br><span class="line"></span><br><span class="line">3ã€æµ‹è¯•2ä¸ªå®¹å™¨æ˜¯å¦å…±äº«äº†ç›®å½•</span><br><span class="line">[root@node03 ~]# docker inspect dbb9f576eacd</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;bind&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/kubelet/pods/bed3c777-7aff-4593-a7bc-f2bc3ed47827/volumes/kubernetes.io~empty-dir/empty-data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/opt/html&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;rprivate&quot;</span></span><br><span class="line">                </span><br><span class="line">4ã€æŸ¥çœ‹æŒ‚è½½çš„éšæœºç›®å½•ï¼Œæ˜¯ç©ºçš„               </span><br><span class="line">[root@node03 ~]# ll /var/lib/kubelet/pods/bed3c777-7aff-4593-a7bc-f2bc3ed47827/volumes/kubernetes.io~empty-dir/empty-data</span><br><span class="line">total 0     </span><br><span class="line"></span><br><span class="line">5ã€è¿è¿›å®¹å™¨é‡Œé¢æŸ¥çœ‹æŒ‚è½½ç›®å½•ï¼Œæ˜¯ç©ºçš„  </span><br><span class="line">[root@master01 kubernetes]# kubectl <span class="built_in">exec</span> -it c7-nginx -c nginx-container -- /bin/sh</span><br><span class="line">/ <span class="comment"># ls -l /usr/share/nginx/html/</span></span><br><span class="line"></span><br><span class="line">[root@master01 ~]# kubectl <span class="built_in">exec</span> -it c7-nginx -c c7-container -- /bin/bash</span><br><span class="line">[root@c7-nginx /]# <span class="built_in">ls</span> -l /opt/html/</span><br><span class="line">total 0</span><br><span class="line"></span><br><span class="line">6ã€è¿›å…¥éšæœºç›®å½•ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">[root@node03 ~]# <span class="built_in">cd</span> /var/lib/kubelet/pods/bed3c777-7aff-4593-a7bc-f2bc3ed47827/volumes/kubernetes.io~empty-dir/empty-data</span><br><span class="line">[root@node03 empty-data]# <span class="built_in">echo</span> <span class="string">&quot;test å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•&quot;</span> &gt; index.html</span><br><span class="line"></span><br><span class="line">7ã€è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶å¯ä»¥çœ‹åˆ°2ä¸ªå®¹å™¨éƒ½å¯ä»¥çœ‹åˆ°åˆ›å»ºçš„æ–‡ä»¶å†…å®¹</span><br><span class="line">/ <span class="comment"># cat /usr/share/nginx/html/index.html </span></span><br><span class="line"><span class="built_in">test</span> å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•</span><br><span class="line">/ <span class="comment"># curl 127.0.0.1</span></span><br><span class="line"><span class="built_in">test</span> å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•</span><br><span class="line"></span><br><span class="line">[root@c7-nginx /]# <span class="built_in">cat</span> /opt/html/index.html </span><br><span class="line"><span class="built_in">test</span> å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•</span><br><span class="line">[root@c7-nginx /]# curl 127.0.0.1</span><br><span class="line"><span class="built_in">test</span> å°†ä¸€ä¸ªPODå†…çš„ä¸¤ä¸ªå®¹å™¨å…±äº«ç›®å½•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å½“Podç»“æŸäº†ï¼Œå…±äº«å°±ç»“æŸäº†ï¼Œå¦‚æœæ•°æ®å¾ˆé‡è¦ï¼Œéœ€è¦æŒä¹…åŒ–ï¼ŒemptyDirå°±ä¸å»ºè®®ä½¿ç”¨ï¼Œå°±ä½¿ç”¨Hostoath</span></span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªpodèµ·åœ¨node02,ä¸€ä¸ªèµ·åœ¨node03,åªèƒ½ç”¨nfså…±äº«</span><br><span class="line"></span><br><span class="line"><span class="built_in">command</span>åé¢çš„å‘½ä»¤ä¼šè®©å®¹å™¨æŠŠåé¢çš„å‘½ä»¤å½“åˆPIDä¸º1çš„è¿›ç¨‹ï¼Œé‚£æ¡å‘½ä»¤ç»“æŸï¼Œè¿›ç¨‹å°±ç»“æŸäº†</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ¯”å¦‚è¯´æƒ³æ”¹nginxç«¯å£ï¼Œæƒ³ç”¨8080ï¼Œç”¨èµ„æºæ¸…å•æ€ä¹ˆæ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">podä¸èƒ½è‡ªåŠ¨æ‹‰å–</span><br><span class="line">podåˆå§‹åŒ–å®¹å™¨ï¼Œæƒ³ä¸´æ—¶æ”¹é‡Œé¢æŸäº›ä¸œè¥¿ï¼Œæ¯”å¦‚è¯´æ·»åŠ wwwç”¨æˆ·ï¼Œç»Ÿä¸€ç”¨æˆ·</span><br><span class="line"></span><br><span class="line">é’©å­ å¯åŠ¨é’©å­ï¼šå¯åŠ¨ä¹‹å‰è®©ä»–åšä¸€äº›äº‹æƒ…</span><br><span class="line">åœæ­¢é’©å­ï¼špodç»“æŸäº†å°±åœæ­¢é’©å­ï¼Œç»“æŸä¹‹å‰æƒ³è®©ä»–å‘é‚®ä»¶å‘Šè­¦</span><br><span class="line">æ¢é’ˆï¼šk8sæŒ‚äº†å¯ä»¥é‡æ–°æ‹‰èµ·ï¼Œé‚£ä¹ˆpodæ²¡æŒ‚ï¼Œä½†æ˜¯ç½‘ç«™æ˜¯404æˆ–è€…50å‡ ï¼Œç½‘ç«™ä¸èƒ½æ­£å¸¸è®¿é—®ï¼Œä½†æ˜¯k8såªæ£€æµ‹podæœ‰æ²¡æœ‰æŒ‚æˆ–è€…è¢«åˆ é™¤ï¼Œä½†æ˜¯10ä¸ªpodéƒ½æ˜¯404ï¼Œpodåœ¨ï¼Œä¸ä¼šé‡æ–°æ‹‰èµ·ï¼Œå°±è¦ç”¨æ¢é’ˆ</span><br><span class="line">å­˜æ´»æ¢é’ˆ æ•‘ç»­æ¢é’ˆ  è‡ªåŠ¨æ‰©ç¼©å®¹</span><br></pre></td></tr></table></figure><p><strong>wordpressé•œåƒ</strong></p><p>åœ¨ä¸€ä¸ªPODé‡Œå¯åŠ¨ä¸¤ä¸ªå®¹å™¨ wordpresså’Œmysql5.7ï¼Œç”¨æˆ·ä¸Šä¼ æ•°æ®çš„ç›®å½•åšæŒä¹…åŒ–ï¼Œè¯¥æ‰“æ ‡ç­¾çš„æ‰“æ ‡ç­¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿è¡Œæ•°æ®åº“</span></span><br><span class="line">docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wp_db \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œwordpresså®¹å™¨</span></span><br><span class="line">docker run \</span><br><span class="line">--name wp \</span><br><span class="line">--<span class="built_in">link</span> mysql57 \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql57 \</span><br><span class="line">-e WORDPRESS_DB_USER=wp_user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=123 \</span><br><span class="line">-e WORDPRESS_DB_NAME=wp_db \</span><br><span class="line">-d wordpress-df:v2 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 kubernetes]# vim wp.yml</span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Namespace&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: wp</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: wp-pod</span><br><span class="line">  namespace: wp</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: wp-containers</span><br><span class="line">    image: wordpress-df:v2</span><br><span class="line">    imagePullPolicy: Never</span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 80</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: WORDPRESS_DB_HOST</span><br><span class="line">      value: <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_USER</span><br><span class="line">      value: <span class="string">&quot;wp_user&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br><span class="line">    - name: WORDPRESS_DB_NAME</span><br><span class="line">      value: <span class="string">&quot;wp_db&quot;</span></span><br><span class="line"></span><br><span class="line">  - name: mysql-containers</span><br><span class="line">    image: mysql:5.7.44</span><br><span class="line">    imagePullPolicy: Never</span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 3306</span><br><span class="line">    <span class="built_in">env</span>:</span><br><span class="line">    - name: MYSQL_ROOT_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br><span class="line">    - name: MYSQL_DATABASE</span><br><span class="line">      value: <span class="string">&quot;wp_db&quot;</span></span><br><span class="line">    - name: MYSQL_USER</span><br><span class="line">      value: <span class="string">&quot;wp_user&quot;</span></span><br><span class="line">    - name: MYSQL_PASSWORD</span><br><span class="line">      value: <span class="string">&quot;123&quot;</span></span><br><span class="line">    volumeMounts:</span><br><span class="line">    - name: db</span><br><span class="line">      mountPath: /var/lib/mysql</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰3ã€PODèµ„æº</title>
      <link href="/posts/763f53e4.html"/>
      <url>/posts/763f53e4.html</url>
      
        <content type="html"><![CDATA[<h2 id="PODèµ„æºçš„ä»‹ç»">PODèµ„æºçš„ä»‹ç»</h2><h3 id="1ã€kubernetesèµ„æºå¯¹è±¡æ“ä½œ">1ã€<strong>kubernetesèµ„æºå¯¹è±¡æ“ä½œ</strong></h3><table><thead><tr><th>èµ„æºå¯¹è±¡</th><th>å¢</th><th>åˆ </th><th>æ”¹</th><th>æŸ¥</th></tr></thead><tbody><tr><td>nodes</td><td></td><td>kubectl delete node</td><td></td><td>kubectl get nodes</td></tr><tr><td>namespace</td><td>kubectl create ns  [èµ„æºå]</td><td>kubectl delete ns  [èµ„æºå]</td><td>kubectl edit ns  [èµ„æºå]</td><td>kubectl get ns</td></tr><tr><td>pod</td><td>kubectl create deployment [èµ„æºå]</td><td>kubectl delete pod  [podå]</td><td></td><td>kubectl get pod</td></tr></tbody></table><p>1ã€nodes</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">å¢</span><br><span class="line"><span class="comment">#å¿˜è®°nodeåŠ å…¥masteré›†ç¾¤å‘½ä»¤,é‚£ä¹ˆéœ€è¦é‡æ–°æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</span></span><br><span class="line">[root@master01 ~]# kubeadm token create --print-join-command</span><br><span class="line"></span><br><span class="line">åˆ </span><br><span class="line">kubectl delete node</span><br><span class="line"></span><br><span class="line">æŸ¥</span><br><span class="line"><span class="comment">#æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€</span></span><br><span class="line">[root@master01 ~]# kubectl get nodes</span><br><span class="line">NAME       STATUS   ROLES    AGE    VERSION</span><br><span class="line">master01   Ready    master   5d2h   v1.19.3</span><br><span class="line">node01     Ready    &lt;none&gt;   5d2h   v1.19.3</span><br><span class="line">node02     Ready    &lt;none&gt;   5d2h   v1.19.3</span><br><span class="line">node03     Ready    &lt;none&gt;   5d2h   v1.19.3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹åç§°ç©ºé—´</span></span><br><span class="line">[root@master01 ~]# kubectl get ns</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   5d2h</span><br><span class="line">kube-flannel      Active   5d1h</span><br><span class="line">kube-node-lease   Active   5d2h</span><br><span class="line">kube-public       Active   5d2h</span><br><span class="line">kube-system       Active   5d2h</span><br></pre></td></tr></table></figure><p>2ã€namespace</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å¢</span><br><span class="line">kubectl create ns  [èµ„æºå]</span><br><span class="line"></span><br><span class="line">åˆ </span><br><span class="line">kubectl delete ns  [èµ„æºå]</span><br><span class="line"></span><br><span class="line">æ”¹</span><br><span class="line">kubectl edit ns  [èµ„æºå]</span><br><span class="line"></span><br><span class="line">æŸ¥</span><br><span class="line">kubectl get ns </span><br></pre></td></tr></table></figure><p>3ã€pod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥</span><br><span class="line"><span class="comment">#æŸ¥çœ‹pod(é»˜è®¤æŸ¥çœ‹defaultåç§°ç©ºé—´)</span></span><br><span class="line">[root@master01 ~]# kubectl get pod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹pod(æŸ¥çœ‹æŒ‡å®šçš„åç§°ç©ºé—´)</span></span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-flannel</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å¸®åŠ©</span></span><br><span class="line">[root@master01 ~]# kubectl get pod --<span class="built_in">help</span></span><br><span class="line">-oæˆ–è€…--outputï¼šæŒ‡å®šè¾“å‡ºæ ¼å¼</span><br><span class="line">jsonï¼šè¾“å‡ºjsonæ ¼å¼</span><br><span class="line">yamlï¼šè¾“å‡ºyamlæ ¼å¼</span><br><span class="line">wideï¼šè¾“å‡ºè¯¦ç»†ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">-nï¼šæŒ‡å®šåç§°ç©ºé—´</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡å®šè¾“å‡ºæ ¼å¼</span></span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-flannel -o json</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-flannel </span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-flannel-ds-4ncf5   1/1     Running   0          5d2h</span><br><span class="line">kube-flannel-ds-7dnxx   1/1     Running   1          5d2h</span><br><span class="line">kube-flannel-ds-dpzqp   1/1     Running   0          5d2h</span><br><span class="line">kube-flannel-ds-knmch   1/1     Running   0          5d2h</span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-flannel kube-flannel-ds-4ncf5 -o json</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æŒ‡å®šçš„pod</span></span><br><span class="line">[root@master01 ~]# kubectl get pod nginx-5f5d9d69c4-pk4c4 -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºpodè¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-flannel -o wide</span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE    IP           NODE       NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-flannel-ds-4ncf5   1/1     Running   0          5d2h   10.0.0.203   node03     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-7dnxx   1/1     Running   1          5d2h   10.0.0.200   master01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-dpzqp   1/1     Running   0          5d2h   10.0.0.201   node01     &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-flannel-ds-knmch   1/1     Running   0          5d2h   10.0.0.202   node02     &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¢</span><br><span class="line"><span class="comment">#åˆ›å»ºpod(é»˜è®¤åˆ›å»ºåœ¨defaultåç§°ç©ºé—´)</span></span><br><span class="line">kubectl create deployment podå --image=é•œåƒ:ç‰ˆæœ¬</span><br><span class="line">[root@master01 ~]# kubectl create deployment nginx --image=nginx:alpine</span><br><span class="line"></span><br><span class="line">åˆ </span><br><span class="line"><span class="comment">#åˆ é™¤pod</span></span><br><span class="line">[root@master01 ~]# kubectl delete pod nginx-65cc99f84f-8k9rj</span><br><span class="line"></span><br><span class="line">æ”¹</span><br><span class="line"><span class="comment">#å½“åˆ›å»ºpodï¼Œé•œåƒåå†™é”™äº†ï¼Œéœ€è¦ä¿®æ”¹æ—¶</span></span><br><span class="line">[root@master01 ~]# kubectl edit deployment nginx </span><br><span class="line">å°±ä¼šè¿›å…¥åƒviç¼–è¾‘å™¨ä¸€æ ·çš„ä¸œè¥¿ï¼Œæ‰¾åˆ°imageï¼Œæ”¹åé¢çš„é•œåƒå</span><br><span class="line"></span><br><span class="line">ç­‰å¾…ä¸€ä¼šï¼Œè¿™æ¬¡æŸ¥çœ‹pod,å°±ä¼šæ­£å¸¸è¿è¡Œ</span><br><span class="line">[root@master01 ~]#  kubectl get pod</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-5f5d9d69c4-pk4c4   1/1     Running   0          8m14s</span><br></pre></td></tr></table></figure><h3 id="2ã€PODçš„èµ„æºæ¸…å•">2ã€<strong>PODçš„èµ„æºæ¸…å•</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# vim nginx.yaml </span><br><span class="line">apiVersion: v1                        <span class="comment">## K8Sèµ„æºæ¥å£</span></span><br><span class="line">kind: Pod                             <span class="comment">## èµ„æºç±»å‹</span></span><br><span class="line">metadata:                             <span class="comment">## èµ„æºçš„å…ƒæ•°æ®</span></span><br><span class="line">  name: nginx-pod                     <span class="comment">## PODåå­—</span></span><br><span class="line">  namespace: default                  <span class="comment">## èµ„æºå¯åŠ¨åœ¨å“ªä¸ªåç§°ç©ºé—´</span></span><br><span class="line">spec:                                 <span class="comment">## å®¹å™¨ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">  containers:                         <span class="comment">## å®¹å™¨ä¿¡æ¯</span></span><br><span class="line">  - image: nginx:alpine               <span class="comment">## æŒ‡å®šå®¹å™¨çš„é•œåƒ</span></span><br><span class="line">    imagePullPolicy: IfNotPresent     <span class="comment">## é•œåƒæ‹‰å–è§„åˆ™  IfNotPresentï¼šä¸å­˜åœ¨åˆ™æ‹‰å–</span></span><br><span class="line">    name: nginx-containers            <span class="comment">## å®¹å™¨åå­—</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">Alwaysï¼šæ€»æ˜¯æ‹‰å–ï¼Œä¸ç®¡å½“å‰æœºå™¨ä¸Šæ˜¯å¦æœ‰æ”¹é•œåƒéƒ½æ‹‰å–</span><br><span class="line">Neverï¼šä»ä¸æ‹‰å–é•œåƒï¼Œéœ€è¦æå‰docker pull</span><br><span class="line">IfNotPresentï¼šä¸å­˜åœ¨åˆ™æ‹‰å–</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#K8Sèµ„æºæ¥å£ï¼š</span></span><br><span class="line">apiVersion: v1  </span><br><span class="line">å¯ä»¥ç†è§£ä¸ºhttps://masterçš„ip:6443/pod/v1ä¸€å¼€å§‹initåˆå§‹åŒ–çš„æ—¶å€™å°±å†™äº†masterçš„ipä¸º10.0.0.200ï¼Œä¼šè‡ªåŠ¨è¡¥å…¨ï¼Œå¯ä»¥ç†è§£ä¸ºå‰é¢å¯ä»¥ä¸å†™ï¼Œä¼šè‡ªåŠ¨è¡¥å…¨,è¿™äº›æ¥å£å…¨éƒ½æ³¨å†Œåœ¨etcdé‡Œé¢</span><br><span class="line">https://10.0.0.200:6443/pod/v1</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240918150439792.png" alt="image-20240918150439792"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯åŠ¨pod</span></span><br><span class="line">[root@master01 ~]# kubectl create -f nginx.yml </span><br><span class="line">pod/nginx-pod created</span><br><span class="line">[root@master01 ~]# kubectl get pod</span><br><span class="line">nginx-pod                0/1     ContainerCreating   0          13s</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹è¿™ä¸ªpodèµ·åœ¨å“ªä¸ªnode</span></span><br><span class="line">[root@master01 ~]# kubectl get pod -o wide</span><br><span class="line">NAME                     READY   STATUS             RESTARTS   AGE     IP         NODE     NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx-pod                0/1     ImagePullBackOff   0          4m49s   10.2.3.6   node03   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><h3 id="3ã€æ‰‹å†™èµ„æºæ¸…å•">3ã€<strong>æ‰‹å†™èµ„æºæ¸…å•</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å‚è€ƒç½‘å€ï¼šhttp://k8s.driverzeng.com/v1.19/</span><br><span class="line">è¿™4ä¸ªå¿…å†™çš„</span><br><span class="line"></span><br><span class="line">objectæ•°æ®ç±»å‹å†™æ³•ï¼šç›´æ¥å›è½¦ï¼Œå’Œä¸Šä¸€ä¸ªç¼©è¿›å†™key: valueçš„å½¢å¼</span><br><span class="line">[]åˆ—è¡¨æ•°æ®ç±»å‹å†™æ³•ï¼šå›è½¦ä¹‹åå†™ä¸€ä¸ªå‡å·-ï¼Œå†ç©ºæ ¼</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240918153235543.png" alt="image-20240918153235543"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™èµ„æºæ¸…å•  <span class="comment"># è¿™é‡Œæœ‰å‘ï¼Œéœ€è¦ç»§ç»­å¾€ä¸‹æŸ¥çœ‹æ›´æ–°åçš„èµ„æºæ¸…å•</span></span><br><span class="line">[root@master01 ~]# vim busybox.yml</span><br><span class="line"><span class="comment">#å¦‚æœåé¢è¦æŒ‡å®šåç§°ç©ºé—´ï¼Œå°±è¦å…ˆåˆ›å»ºåç§°ç©ºé—´</span></span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Namespace&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: aaa</span><br><span class="line"><span class="comment">#åˆ†éš”ç¬¦ï¼Œåˆ†éš”ä¸Šé¢å’Œä¸‹é¢çš„èµ„æº</span></span><br><span class="line">---</span><br><span class="line"><span class="comment">#è¿™ä¸ªæ˜¯1ä¸ªpodé‡Œé¢èµ·2ä¸ªå®¹å™¨</span></span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: busybox-pod</span><br><span class="line">  namespace: aaa</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: busybox-containers</span><br><span class="line">    image: busybox</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line"> </span><br><span class="line">  - name: nginx-containers</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    </span><br><span class="line">2ã€å¯åŠ¨èµ„æº</span><br><span class="line">[root@master01 ~]# kubectl apply -f busybox.yml </span><br><span class="line">namespace/aaa created</span><br><span class="line">pod/busybox-pod created</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹åç§°ç©ºé—´é‡Œé¢èµ·çš„èµ„æºï¼Œåªçœ‹åˆ°ä¸€ä¸ª</span><br><span class="line">[root@master01 ~]# kubectl get pod -n aaa</span><br><span class="line">NAME          READY   STATUS             RESTARTS   AGE</span><br><span class="line">busybox-pod   1/2     CrashLoopBackOff   3          94s</span><br><span class="line"></span><br><span class="line">4ã€ç”±äºåç§°ç©ºé—´é‡Œé¢èµ·çš„èµ„æºï¼Œåªçœ‹åˆ°ä¸€ä¸ªï¼Œæ‰€ä»¥æœ‰é—®é¢˜ï¼Œè¦æ£€æŸ¥åŸå› æ’é”™</span><br><span class="line"><span class="comment">#æ’æŸ¥å‘½ä»¤</span></span><br><span class="line"><span class="comment">#kubectl describe [èµ„æº] [èµ„æºå] [-n åç§°ç©ºé—´]</span></span><br><span class="line"></span><br><span class="line">[root@master01 ~]# kubectl describe pod busybox-pod -n aaa</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# kubectl describe namespace  aaa</span><br><span class="line"></span><br><span class="line">å…¶å®åŸå› å°±æ˜¯busyboxæ²¡å¡ä½ï¼Œè¿™ä¸ªæ˜¯ç½‘ç»œç›¸å…³çš„é•œåƒï¼Œéœ€è¦åŠ å‘½ä»¤å¡ä½</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">5ã€æ›´æ–°èµ„æºæ¸…å•</span><br><span class="line">[root@master01 ~]# vim busybox.yml</span><br><span class="line"><span class="comment">#å¦‚æœåé¢è¦æŒ‡å®šåç§°ç©ºé—´ï¼Œå°±è¦å…ˆåˆ›å»ºåç§°ç©ºé—´</span></span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Namespace&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: aaa</span><br><span class="line"><span class="comment">#åˆ†éš”ç¬¦ï¼Œåˆ†éš”ä¸Šé¢å’Œä¸‹é¢çš„èµ„æº</span></span><br><span class="line">---</span><br><span class="line"><span class="comment">#è¿™ä¸ªæ˜¯1ä¸ªpodé‡Œé¢èµ·2ä¸ªå®¹å™¨</span></span><br><span class="line">apiVersion: <span class="string">&quot;v1&quot;</span></span><br><span class="line">kind: <span class="string">&quot;Pod&quot;</span></span><br><span class="line">metadata:</span><br><span class="line">  name: busybox-pod</span><br><span class="line">  namespace: aaa</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: busybox-containers</span><br><span class="line">    image: busybox</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    <span class="comment">#åŠ å…¥å¡ä½çš„å‘½ä»¤</span></span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/bin/tail&quot;</span>,<span class="string">&quot;-f&quot;</span>,<span class="string">&quot;/etc/hosts&quot;</span>]</span><br><span class="line"> </span><br><span class="line">  - name: nginx-containers</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    </span><br><span class="line">6ã€åˆ é™¤å°±å¾—pod</span><br><span class="line">[root@master01 ~]# kubectl delete -f busybox.yml</span><br><span class="line"></span><br><span class="line">7ã€å†æ¬¡åˆ›å»ºpod,å¹¶æŸ¥çœ‹</span><br><span class="line">[root@master01 ~]# kubectl apply -f busybox.yml </span><br><span class="line">[root@master01 ~]# kubectl get pod -n aaa</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">busybox-pod   2/2     Running   0          13s</span><br><span class="line"><span class="comment">#æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@master01 ~]# kubectl get pod -n aaa -o wide</span><br></pre></td></tr></table></figure><h3 id="4ã€ä½¿ç”¨VScodeç¼–å†™èµ„æºæ¸…å•">4ã€<strong>ä½¿ç”¨VScodeç¼–å†™èµ„æºæ¸…å•</strong></h3><p>1ã€é…ç½®VScode</p><p>å…ˆè¿œç¨‹è¿æ¥ä¸»èŠ‚ç‚¹</p><p><img src="../image/study_img/image-20240918170551193.png" alt="image-20240918170551193"></p><p>ç»Ÿä¸€èµ„æºæ¸…å•çš„ä½ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# <span class="built_in">mkdir</span> /opt/kubernetes</span><br><span class="line">[root@master01 ~]# <span class="built_in">mv</span> *.yml /opt/kubernetes</span><br></pre></td></tr></table></figure><p>è¿æ¥æˆåŠŸï¼Œæ‰“å¼€åˆ›å»ºçš„/opt/kubernetesç›®å½•</p><p><img src="../image/study_img/image-20240918171056628.png" alt="image-20240918171056628"></p><p><img src="../image/study_img/image-20240918171219206.png" alt="image-20240918171219206"></p><p>é…ç½®æ¢¯å­åŠ é€Ÿä¸‹è½½ï¼Œå®‰è£…kubernetesæ’ä»¶ï¼Œå®‰è£…æ’ä»¶å¯èƒ½éœ€è¦7åˆ†é’Ÿå·¦å³</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@master01 ~]# vim ~/.bashrc </span><br><span class="line"><span class="built_in">export</span> https_proxy=https://192.168.10.200:7890</span><br><span class="line"></span><br><span class="line">[root@master01 ~]# <span class="built_in">source</span> .bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨å®Œæˆåï¼Œæ‰§è¡Œå¦‚ä¸‹ï¼š</span></span><br><span class="line">[root@master01 ~]# vim ~/.bashrc </span><br><span class="line"><span class="comment">#export https_proxy=https://192.168.10.200:7890</span></span><br><span class="line"></span><br><span class="line">[root@master01 ~]# <span class="built_in">unset</span> https_proxy</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240918172406539.png" alt="image-20240918172406539"></p><p><img src="../image/study_img/image-20240918173241749.png" alt="image-20240918173241749"></p><p>å®‰è£…æ’ä»¶å¯èƒ½éœ€è¦7åˆ†é’Ÿå·¦å³ï¼Œå®‰è£…å®Œæˆ</p><p><img src="../image/study_img/image-20240918174036219.png" alt="image-20240918174036219"></p><p>2ã€ä½¿ç”¨æ’ä»¶</p><p>æŸ¥çœ‹é•œåƒçš„çŠ¶æ€å’Œip</p><p><img src="../image/study_img/image-20240918174854465.png" alt="image-20240918174854465"></p><p>ç¼–å†™èµ„æºæ¸…å•</p><p><img src="../image/study_img/image-20240918175229795.png" alt="image-20240918175229795"></p><p><img src="../image/study_img/image-20240918175420732.png" alt="image-20240918175420732"></p><p><img src="../image/study_img/image-20240918175433243.png" alt="image-20240918175433243"></p><p>æ ¹æ®æ¨¡ç‰ˆä¿®æ”¹å†…å®¹    èµ„æºé™åˆ¶ä¸éœ€è¦ï¼Œæ‰€ä»¥åˆ é™¤ï¼Œåˆ é™¤ä¹‹åæœ‰é»„çº¿ï¼Œä¸ç”¨ç®¡</p><p><img src="../image/study_img/image-20240918175813043.png" alt="image-20240918175813043"></p>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰2ã€kubernetså®‰è£…éƒ¨ç½²v1.19-æºç å®‰è£…</title>
      <link href="/posts/8b2778bc.html"/>
      <url>/posts/8b2778bc.html</url>
      
        <content type="html"><![CDATA[<h2 id="kubernetså®‰è£…éƒ¨ç½²v1-19-æºç å®‰è£…">kubernetså®‰è£…éƒ¨ç½²v1.19  (æºç å®‰è£…)</h2><h3 id="1ã€k8sçš„å®‰è£…æ–¹å¼">1ã€<strong>k8sçš„å®‰è£…æ–¹å¼</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## K8Sçš„æ–¹å¼æœ‰ä¸€å †</span></span><br><span class="line">äºŒè¿›åˆ¶å®‰è£…  ç”Ÿäº§æ¨è</span><br><span class="line">kubeadm    ç”Ÿäº§æ¨è</span><br><span class="line">Ansible    äºŒè¿›åˆ¶å®‰è£…</span><br><span class="line">Rancher    è™½ç„¶k8sæ˜¯æœ‰è‡ªå¸¦çš„å›¾å½¢åŒ–ç•Œé¢ï¼Œä½†åœ¨ä¼ä¸šé‡Œé¢ç”¨Rancherçš„è¿˜æ˜¯æ¯”è¾ƒå¤š</span><br><span class="line">é˜¿é‡Œäº‘ACK</span><br><span class="line">äºšé©¬é€Šäº‘EKS</span><br><span class="line"></span><br><span class="line">å®‰è£…k8s1.19ç‰ˆï¼Œk8sä¸­å°ç‰ˆæœ¬å˜äº†å½±å“å¾ˆå¤§ï¼Œæ¥å£æ˜¯ä¸ä¸€æ ·çš„</span><br></pre></td></tr></table></figure><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th><th>é…ç½®</th><th>é…ç½®</th></tr></thead><tbody><tr><td>master01</td><td>10.0.0.200  /  172.16.1.200</td><td>master</td><td>kubectl,apiserver,scheduler,controller,<br>etcd,kubelet,kube-proxy</td><td>1h2G</td></tr><tr><td>node01</td><td>10.0.0.201  /  172.16.1.201</td><td>node</td><td>kubectlï¼Œapiserver,<br>kube-proxy</td><td>1h2G</td></tr><tr><td>node02</td><td>10.0.0.202  /  172.16.1.202</td><td>node</td><td>kubectlï¼Œapiserver,<br>kube-proxy</td><td>1h2G</td></tr><tr><td>node03</td><td>10.0.0.203  /  172.16.1.203</td><td>node</td><td>kubectlï¼Œapiserver,<br>kube-proxy</td><td>2h4G</td></tr></tbody></table><p>IPè§„åˆ’</p><p>ä¸ºä»€ä¹ˆè§„åˆ’IP?  å› ä¸ºæ‰€æœ‰çš„PODèµ·æ¥åº”è¯¥åœ¨åŒä¸€ä¸ªç½‘æ®µï¼ŒCluster IPä¹Ÿåœ¨åŒä¸€ä¸ªç½‘æ®µ</p><table><thead><tr><th>ä¸‰ç§service</th><th>IP</th></tr></thead><tbody><tr><td>POD IP</td><td>10.2.0.0</td></tr><tr><td>Cluster IP</td><td>10.1.0.0</td></tr><tr><td>Node IP</td><td>10.0.0.0</td></tr></tbody></table><p>æ³¨æ„ï¼šå¦‚æœæ˜¯äºŒè¿›åˆ¶å®‰è£…ï¼Œé»˜è®¤çš„pod IPæ˜¯10.0.0.0ç½‘æ®µï¼Œå®¿ä¸»æœºçš„ç½‘æ®µå’Œpod ipÂ·ä¸èƒ½ä¸€æ ·</p><p><strong>â‘ ã€éƒ¨ç½²å‰çš„ç¯å¢ƒä¼˜åŒ–</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######4å°æœºå™¨éƒ½æ‰§è¡Œ   </span></span><br><span class="line"><span class="comment">#(kubelet:æ§åˆ¶å®¹å™¨è¿è¡Œæ—¶å¯åŠ¨å®¹å™¨çš„ä¸œè¥¿,è¦æŠŠmasterå½“ä½œnodeèŠ‚ç‚¹ï¼Œæ‰€ä»¥masterä¹Ÿè¦å®‰è£…)</span></span><br><span class="line">1ã€é…ç½®kubleté…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„Cgroupé©±åŠ¨å’Œç¦ç”¨swap     </span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/sysconfig/kubelet &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">KUBELET_CGROUP_ARGS=&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"><span class="string">KUBELET_EXTRA_ARGS=&quot;--fail-swap-on=false&quot;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®©kubeletä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„Cgroupé©±åŠ¨ </span></span><br><span class="line">KUBELET_CGROUP_ARGS=<span class="string">&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line"><span class="comment">#è®©kubeletç¦æ­¢ä½¿ç”¨swap(è™šæ‹Ÿå†…å­˜) </span></span><br><span class="line">KUBELET_EXTRA_ARGS=<span class="string">&quot;--fail-swap-on=false&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€å†…å‚æ•°è°ƒä¼˜ï¼Œè¦æŠŠiptableåŠŸèƒ½å¼€å¯(å› ä¸ºåº•å±‚ç«¯å£çš„è½¬å‘ç«¯å£æ˜ å°„éƒ½æ˜¯é˜²ç«å¢™åšçš„)</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables=1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables=1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1</span></span><br><span class="line"><span class="string">vm.swappiness=0</span></span><br><span class="line"><span class="string">fs.file-max=52706963</span></span><br><span class="line"><span class="string">fs.nr_open=52706963</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å¯iptablesåŠŸèƒ½   ipv4</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line"><span class="comment">#å¼€å¯iptablesåŠŸèƒ½   ipv6</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="line"><span class="comment">#å¼€å¯å†…æ ¸è½¬å‘</span></span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"><span class="comment">#å†…æ ¸å‚æ•°ç¦ç”¨swap</span></span><br><span class="line">vm.swappiness=0</span><br><span class="line"><span class="comment">#æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶æœ€å¤§å€¼</span></span><br><span class="line">fs.file-max=52706963</span><br><span class="line"><span class="comment">#æ–‡ä»¶æè¿°ç¬¦å¼€å¯æ•°é‡</span></span><br><span class="line">fs.nr_open=52706963</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ</span><br><span class="line">sysctl --system</span><br><span class="line">æ‰§è¡Œä¹‹åè¾“å‡ºç»“æœå€’æ•°çš„è¡Œä¼šæ˜¾ç¤ºç¬¬2æ­¥é…ç½®çš„å†…å®¹</span><br><span class="line">* Applying /etc/sysctl.d/k8s.conf ...</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">vm.swappiness = 0</span><br><span class="line">fs.file-max = 52706963</span><br><span class="line">fs.nr_open = 52706963</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€æ›´æ”¹dockeræº</span><br><span class="line">[root@master01 ~]# <span class="built_in">cat</span> &gt; /etc/yum.repos.d/docker-ce.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[docker-ce-stable]</span></span><br><span class="line"><span class="string">name=Docker CE Stable - $basearch</span></span><br><span class="line"><span class="string">baseurl=https://download.docker.com/linux/centos/7/x86_64/stable</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://download.docker.com/linux/centos/gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">[root@master01 ~]# sed -i <span class="string">&#x27;s+download.docker.com+mirrors.huaweicloud.com/docker-ce+&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">5ã€å®‰è£…æ—¶é—´åŒæ­¥æœåŠ¡ (è¿™ä¸ªä¸éœ€è¦å†™åœ¨å®šæ—¶ä»»åŠ¡é‡Œé¢)</span><br><span class="line">yum install -y chrony</span><br><span class="line">systemctl start chronyd</span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€å…³é—­swap</span><br><span class="line">swapoff -a</span><br><span class="line">sed -i <span class="string">&#x27;/swap/d&#x27;</span> /etc/fstab</span><br><span class="line">free -m</span><br><span class="line">[root@master01 ~]# free -m</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1846         100        1271           9         474        1564</span><br><span class="line">Swap:             0           0           0#å˜æˆ0å°±æ˜¯å…³é—­äº†</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸´æ—¶å…³é—­swap</span></span><br><span class="line">swapoff -a</span><br><span class="line"><span class="comment">#æ°¸ä¹…å…³é—­swap</span></span><br><span class="line">sed -i <span class="string">&#x27;/swap/d&#x27;</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7ã€åŠ è½½ipvsæ¨¡å—   åšk8sï¼Œåº•å±‚æœ‰è½¬å‘ï¼Œéœ€è¦é…åˆipvsæ¨¡å—æ‰å¯ä»¥</span><br><span class="line"><span class="built_in">cat</span>  &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">modprobe -- ip_vs</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_rr</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_wrr</span></span><br><span class="line"><span class="string">modprobe -- ip_vs_sh</span></span><br><span class="line"><span class="string">modprobe -- nf_conntrack_ipv4</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"><span class="built_in">source</span> /etc/sysconfig/modules/ipvs.modules</span><br><span class="line">lsmod|grep -e <span class="string">&#x27;ip_vs&#x27;</span> -e <span class="string">&#x27;nf_conntrack_ipv&#x27;</span>  </span><br><span class="line"><span class="comment">#è¿‡æ»¤å‡ºip_vsæ¨¡å—å°±åŠ è½½å‡ºæ¥äº†</span></span><br><span class="line"></span><br><span class="line">ipvs:LVSåšå››å±‚è´Ÿè½½,ä¸éœ€è¦è£…ä»»ä½•è½¯ä»¶,éœ€è¦ä¸‹è½½ipvsadmå‘½ä»¤,ç”¨ipvsadmè¿™ä¸ªå‘½ä»¤å»æ”¹ä¸»æœºçš„è·¯ç”±ã€è·¯ç”±è¡¨ã€ç½‘ç»œç›¸å…³çš„ä¸œè¥¿æ”¹æ‰,æŠŠè¿™ä¸ªä¸»æœºå½“æˆå››å±‚è´Ÿè½½çš„æœºå™¨,åº•å±‚è¦åšè½¬å‘çš„ï¼ŒLVSè¿™ä¸ªæœåŠ¡æ¯”è¾ƒç‹¬ç‰¹çš„ï¼Œæ²¡æœ‰ä¸“é—¨çš„åº”ç”¨ï¼Œä¸åƒnginxã€HAproxyåšè´Ÿè½½å‡è¡¡éœ€è¦å®‰è£…nginxã€HAproxy,LVSæ²¡æœ‰æœåŠ¡å®‰è£…ï¼Œéœ€è¦å®‰è£…ipvsadm,ç”¨è¿™ä¸ªå‘½ä»¤å»ä¿®æ”¹è·¯ç”±ä¿®æ”¹è½¬å‘è¿™äº›ä¸œè¥¿ï¼Œè®©æ•´ä¸ªç‰©ç†æœºå˜æˆè½¬å‘çš„æœºå™¨</span><br></pre></td></tr></table></figure><p><strong>â‘¡ã€å®‰è£…dockeræŒ‡å®šç‰ˆæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######4å°æœºå™¨éƒ½æ‰§è¡Œ ####</span></span><br><span class="line">1ã€æŸ¥è¯¢dockerç‰ˆæœ¬  </span><br><span class="line"><span class="comment">#(åªæ˜¾ç¤ºyumä»“åº“é‡Œçš„æœ€æ–°ç‰ˆ)</span></span><br><span class="line">yum list docker-ce </span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰çš„ç‰ˆæœ¬</span></span><br><span class="line">yum list docker-ce --showduplicates</span><br><span class="line"></span><br><span class="line">2ã€å®‰è£…docke 19.03.15ç‰ˆæœ¬ï¼Œå› ä¸ºè¿™ä¸ªç‰ˆæœ¬æ¯”è¾ƒç¨³å®š</span><br><span class="line">yum install -y docker-ce-19.03.15 docker-ce-cli-19.03.15 containerd.io</span><br><span class="line">systemctl start docker &amp;&amp; systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">containerd.ioï¼šå®¹å™¨è¿è¡Œæ—¶ï¼Œç”¨k8sæ–°ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥æ— ç—•ä»dockeå¯¹æ¥åˆ°containerdï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆ</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹æ˜¯å¦å‡ºç°è­¦å‘Šï¼Œå†çœ‹ä¸€ä¸‹æ˜¾ç¤ºçš„ç‰ˆæœ¬æ˜¯å¦å¯¹çš„ä¸Š</span><br><span class="line">[root@node01 ~]# docker info</span><br><span class="line">Client:</span><br><span class="line">...</span><br><span class="line"> Server Version: 19.03.15</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#ç”Ÿäº§ä¸­å†åŠ 2ä¸ªæ­¥éª¤ï¼š</span></span><br><span class="line"><span class="comment">#4ã€ä¿®æ”¹æ•°æ®ç›®å½•</span></span><br><span class="line"><span class="comment">#5ã€dockerå›¾å½¢åŒ–ç•Œé¢</span></span><br><span class="line"> </span><br><span class="line">4ã€é…ç½®é•œåƒåŠ é€Ÿå’ŒCgroupé©±åŠ¨</span><br><span class="line"> <span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;: [</span></span><br><span class="line"><span class="string">  &quot;https://docker.1panel.live&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://dockercf.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker-cf.registry.cyou&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.chenby.cn&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.m.daocloud.io&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.m.daocloud.io&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.nju.edu.cn&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://dockerproxy.com&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.rainbond.cc&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://docker.registry.cyou&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://dockertest.jsdelivr.fyi&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://hub-mirror.c.163.com&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://hub.rat.dev/&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://mirror.aliyuncs.com&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://mirror.baidubce.com&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://mirror.iscas.ac.cn&quot;,</span></span><br><span class="line"><span class="string">  &quot;https://registry.docker-cn.com&quot;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€æµ‹è¯•æ‹‰å–</span><br><span class="line">[root@node01 ~]# docker pull busybox</span><br><span class="line">[root@node01 ~]# docker images</span><br></pre></td></tr></table></figure><p><strong>â‘¢ã€å®‰è£…kubeadm</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######4å°æœºå™¨éƒ½æ‰§è¡Œ ####</span></span><br><span class="line">1ã€æ›´æ¢åä¸ºæº</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.huaweicloud.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">repo_gpgcheck=0</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.huaweicloud.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.huaweicloud.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">2ã€å®‰è£…kubelet nodeèŠ‚ç‚¹å®¹å™¨è¿è¡Œæ—¶çš„æ§åˆ¶å™¨ kubeadmåšk8sé›†ç¾¤ kubectlæ˜¯k8sçš„å®¢æˆ·ç«¯å‘½ä»¤ ipvsadmåŠ è½½jpvsæ¨¡å—</span><br><span class="line">yum install kubelet-1.19.3 kubeadm-1.19.3  kubectl-1.19.3  ipvsadm -y</span><br><span class="line"></span><br><span class="line">systemctl start kubelet.service &amp;&amp; systemctl <span class="built_in">enable</span> kubelet.service </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubelet-1.19.3 ï¼šæ§åˆ¶å®¹å™¨è¿è¡Œæ—¶</span><br><span class="line">kubeadm-1.19.3  ï¼šç±»ä¼¼äºstream</span><br><span class="line">kubectl-1.19.3  ï¼šæ‰§è¡Œk8så‘½ä»¤éœ€è¦çš„å®¢æˆ·ç«¯</span><br><span class="line">ipvsadmï¼šä¸Šé¢é…ç½®IPVSæ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤</span><br></pre></td></tr></table></figure><p><strong>â‘£ã€master01åˆå§‹åŒ–é›†ç¾¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####å¦‚ä¸‹æ“ä½œåªèƒ½master01æ‰§è¡Œ(masterèŠ‚ç‚¹æ‰§è¡Œ)ï¼Œå…¶ä»–æœºå™¨ä¸è¦æ‰§è¡Œ</span></span><br><span class="line">1ã€åˆå§‹åŒ–é›†ç¾¤   å¤§æ¦‚è¦ç­‰å¾…å‡ åˆ†é’Ÿ</span><br><span class="line">[root@master01 ~]# kubeadm init \</span><br><span class="line">--apiserver-advertise-address=10.0.0.200 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers  \</span><br><span class="line">--kubernetes-version=v1.19.3 \</span><br><span class="line">--service-cidr=10.1.0.0/16 \</span><br><span class="line">--pod-network-cidr=10.2.0.0/16 \</span><br><span class="line">--service-dns-domain=cluster.local \</span><br><span class="line">--ignore-preflight-errors=Swap \</span><br><span class="line">--ignore-preflight-errors=NumCPU</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åªæœ‰ä¸€ä¸ªmasterçš„å†™æ³•</span></span><br><span class="line">--apiserver-advertise-address=masterçš„ip \</span><br><span class="line"><span class="comment">#é•œåƒä»“åº“çš„åœ°å€ é˜¿é‡Œäº‘çš„è°·æ­Œå®¹å™¨çš„</span></span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers  \</span><br><span class="line">--kubernetes-version=v1.19.3 \</span><br><span class="line"><span class="comment">#serviceèµ„æºï¼Œè®¾ç½®cluster ipç½‘æ®µ</span></span><br><span class="line">--service-cidr=10.1.0.0/16 \</span><br><span class="line"><span class="comment">#è®¾ç½®pod ipçš„ç½‘æ®µ</span></span><br><span class="line">--pod-network-cidr=10.2.0.0/16 \</span><br><span class="line"><span class="comment">#ä½¿ç”¨æœ¬åœ°çš„dns</span></span><br><span class="line">--service-dns-domain=cluster.local \</span><br><span class="line"><span class="comment">#å¿½ç•¥swapçš„æŠ¥é”™</span></span><br><span class="line">--ignore-preflight-errors=Swap \</span><br><span class="line"><span class="comment">#å¿½ç•¥cpuçš„æŠ¥é”™</span></span><br><span class="line">--ignore-preflight-errors=NumCPU</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ä¿å­˜æœ€åå‡ è¡Œå†…å®¹</span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line">  <span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  <span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line">  <span class="comment">#å…¶ä»–nodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤</span></span><br><span class="line">Then you can <span class="built_in">join</span> any number of worker nodes by running the following on each as root:</span><br><span class="line">kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token cgex1m.9ck6cjchon5xn4j5 \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:273cdce81c642065666a2d0eb4fd0c3097df69e984fa50836b8daf2ed10de18a </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¿»è¯‘</span></span><br><span class="line">æ‚¨çš„Kubernetesæ§åˆ¶å¹³é¢å·²æˆåŠŸåˆå§‹åŒ–ï¼</span><br><span class="line">è¦å¼€å§‹ä½¿ç”¨é›†ç¾¤ï¼Œæ‚¨éœ€è¦ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</span><br><span class="line">mkdir-p<span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">sudo</span> cp-i/etc/kubernetes/admin.conf<span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span>$ï¼ˆid-uï¼‰ï¼š$ï¼ˆid-gï¼‰<span class="variable">$HOME</span>/.kube/config</span><br><span class="line">ç°åœ¨ï¼Œæ‚¨åº”è¯¥å°†podç½‘ç»œéƒ¨ç½²åˆ°é›†ç¾¤ã€‚</span><br><span class="line">ä½¿ç”¨ä»¥ä¸‹åˆ—å‡ºçš„é€‰é¡¹ä¹‹ä¸€è¿è¡Œâ€œkubectl apply-f[podnetwork].yamlâ€ï¼š</span><br><span class="line">https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line">ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥rootèº«ä»½åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åŠ å…¥ä»»æ„æ•°é‡çš„å·¥ä½œèŠ‚ç‚¹ï¼š</span><br><span class="line">kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token cgex1m.9ck6cjchon5xn4j5 \</span><br><span class="line">--discovery-token-ca-cert-hash sha256:273cdce81c642065666a2d0eb4fd0c3097df69e984fa50836b8daf2ed10de18a</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">3ã€å¯ä»¥çœ‹åˆ°å¤šäº†å¥½å‡ ä¸ªé•œåƒï¼Œè¯´æ˜åˆšæ‰çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œæ‹‰å–äº†éœ€è¦çš„é•œåƒ</span><br><span class="line">[root@master01 ~]# docker images</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">4ã€æ‰§è¡Œè¿™å‡ ä¸ªå‘½ä»¤   åˆ›å»ºéšè—ç›®å½•ï¼Œæ‹·è´é…ç½®æ–‡ä»¶ï¼Œæˆæƒ</span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹k8sé›†ç¾¤èŠ‚ç‚¹ï¼Œ ä¼šçœ‹åˆ°masterä¸»èŠ‚ç‚¹</span><br><span class="line">[root@master01 ~]# kubectl get nodes</span><br><span class="line">NAME       STATUS     ROLES    AGE     VERSION</span><br><span class="line">master01   NotReady   master   4m32s   v1.19.3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###############nodeèŠ‚ç‚¹æ“ä½œç¬¬6æ­¥  node01 node02 node03</span></span><br><span class="line">6ã€ç›®å‰åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥è¦å°†å…¶ä»–èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</span><br><span class="line"><span class="comment">##æ³¨æ„ï¼šè¿™ä¸ªå‘½ä»¤è¦ä¿å­˜å¥½ï¼Œå› ä¸ºæ¨ªå‘æ‰©å±•ï¼Œå°†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤éœ€è¦ä½¿ç”¨</span></span><br><span class="line">[root@master01 ~]# kubeadm <span class="built_in">join</span> 10.0.0.200:6443 --token cgex1m.9ck6cjchon5xn4j5 \</span><br><span class="line">--discovery-token-ca-cert-hash</span><br><span class="line">sha256:273cdce81c642065666a2d0eb4fd0c3097df69e984fa50836b8daf2ed10de18a </span><br><span class="line"><span class="comment">##########################################  </span></span><br><span class="line">  </span><br><span class="line">7ã€åŠ å…¥é›†ç¾¤å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œæœ€åä¸€è¡Œä¿¡æ¯æ˜¾ç¤ºå¦‚ä¸‹</span><br><span class="line">Run <span class="string">&#x27;kubectl get nodes&#x27;</span> on the control-plane to see this node <span class="built_in">join</span> the cluster.</span><br><span class="line">åœ¨æ§åˆ¶å¹³é¢ä¸Š(master)è¿è¡Œâ€œkubectl get nodesâ€ä»¥æŸ¥çœ‹æ­¤èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8ã€#åˆ°master01æ‰§è¡Œkubectl get nodes</span><br><span class="line">[root@master01 ~]# kubectl get nodes</span><br><span class="line">NAME       STATUS     ROLES    AGE     VERSION</span><br><span class="line">master01   NotReady   master   9m33s   v1.19.3</span><br><span class="line">node01     NotReady   &lt;none&gt;   3m48s   v1.19.3</span><br><span class="line">node02     NotReady   &lt;none&gt;   118s    v1.19.3</span><br><span class="line">node03     NotReady   &lt;none&gt;   106s    v1.19.3</span><br><span class="line"></span><br><span class="line">ç°åœ¨çš„çŠ¶æ€æ˜¯NotReadyæ²¡æœ‰å‡†å¤‡å¥½çš„ï¼Œå› ä¸ºç½‘ç»œè¿˜æ²¡é…</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9ã€è®¾ç½®kube-proxyä½¿ç”¨ipvsæ¨¡å¼</span><br><span class="line">k8sé»˜è®¤ä½¿ç”¨çš„æ˜¯iptablesé˜²ç«å¢™ï¼Œå¯ä»¥ä¿®æ”¹æˆæ€§èƒ½æ›´é«˜çš„ipvsæ¨¡å¼ï¼Œè¯¥æ¨¡å¼LVSä¹Ÿåœ¨ä½¿ç”¨</span><br><span class="line">[root@master01 ~]# kubectl edit cm kube-proxy -n kube-system</span><br><span class="line"> 44è¡Œ     </span><br><span class="line"> mode: <span class="string">&quot; &quot;</span> æ”¹ä¸º mode: <span class="string">&quot;ipvs&quot;</span></span><br><span class="line"> </span><br><span class="line">10ã€æŸ¥çœ‹åç§°ç©ºé—´</span><br><span class="line">[root@master01 ~]# kubectl get ns</span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@master01 ~]# kubectl get namespace</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   45m</span><br><span class="line">kube-node-lease   Active   45m</span><br><span class="line">kube-public       Active   45m</span><br><span class="line">kube-system       Active   45m</span><br><span class="line"></span><br><span class="line">11ã€æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´ä¸­çš„podä¿¡æ¯</span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-system</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6d56c8448f-85k2r           0/1     Pending   0          46m <span class="comment">#DNSæœåŠ¡å™¨</span></span><br><span class="line">coredns-6d56c8448f-cn2t9           0/1     Pending   0          46m <span class="comment">#DNSæœåŠ¡å™¨</span></span><br><span class="line">etcd-master01                      1/1     Running   0          46m <span class="comment">#æ•°æ®åº“etcd</span></span><br><span class="line">kube-apiserver-master01            1/1     Running   0          46m <span class="comment">#å¸ä»¤éƒ¨ipserver</span></span><br><span class="line">kube-controller-manager-master01   1/1     Running   0          46m <span class="comment">#æ§åˆ¶å™¨controller</span></span><br><span class="line">kube-proxy-2wfhq                   1/1     Running   0          38m <span class="comment">#ç½‘ç»œã€ç«¯å£æ˜ å°„å°„kube-proxy  æœ‰4ä¸ªæ˜¯å› ä¸ºè¿™ä¸ªé›†ç¾¤é‡Œé¢æœ‰4å°æœºå™¨</span></span><br><span class="line">kube-proxy-8tmqx                   1/1     Running   0          40m <span class="comment">#ç½‘ç»œã€ç«¯å£æ˜ å°„å°„kube-proxy</span></span><br><span class="line">kube-proxy-fr9dl                   1/1     Running   0          39m <span class="comment">#ç½‘ç»œã€ç«¯å£æ˜ å°„å°„kube-proxy</span></span><br><span class="line">kube-proxy-pz4ms                   1/1     Running   0          46m <span class="comment">#ç½‘ç»œã€ç«¯å£æ˜ å°„å°„kube-proxy</span></span><br><span class="line">kube-scheduler-master01            1/1     Running   0          46m <span class="comment">#èµ„æºè°ƒåº¦scheduler</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">12ã€æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´ä¸­podçš„è¯¦ç»†ä¿¡æ¯  å¯ä»¥çœ‹åˆ°èµ·åœ¨å“ªå°æœºå™¨ä¸Š</span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-system -o wide</span><br><span class="line"></span><br><span class="line">ç”¨çš„DaemonSetæ§åˆ¶å™¨ï¼Œæ¯å°æœ‰ä¸”åªèƒ½èµ·ä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">13ã€é‡å¯pod</span><br><span class="line">æŠŠä»–åˆ æ‰ï¼Œå°±ä¼šè‡ªåŠ¨æ‹‰èµ·ï¼Œä»¥åæœ‰å“ªä¸ªç»„ä»¶åäº†ï¼Œå°±åˆ æ‰é‡æ–°æ‹‰èµ·</span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-system|grep <span class="string">&#x27;kube-proxy&#x27;</span>|awk <span class="string">&#x27;&#123;print &quot;kubectl delete pod -n kube-system &quot;$1&#125;&#x27;</span>|bash</span><br></pre></td></tr></table></figure><p>**â‘¤ã€master é…ç½®flanale **</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éƒ¨ç½²ç½‘ç»œæ’ä»¶flanaleï¼Œè®©æ‰€æœ‰èŠ‚ç‚¹ç½‘ç»œæ‰“é€š</span></span><br><span class="line"><span class="comment">##############master01æ‰§è¡Œ#####</span></span><br><span class="line">é“¾æ¥åœ°å€ï¼š</span><br><span class="line">https://github.com/flannel-io/flannel/blob/master/Documentation/kube-flannel.yml</span><br><span class="line"></span><br><span class="line">1ã€ä¸‹è½½èµ„æºæ¸…å•</span><br><span class="line">[root@master01 ~]# wget https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ä¿®æ”¹flannelèµ„æºæ¸…å•</span><br><span class="line">[root@master01 ~]# vim  kube-flannel.yml </span><br><span class="line">       <span class="comment">#æœç´¢net-conf.jsonï¼Œä¿®æ”¹ç½‘æ®µä¸ºè§„åˆ’çš„pod ip  </span></span><br><span class="line">      <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;10.2.0.0/16&quot;</span>,</span><br><span class="line">      ......</span><br><span class="line">      .....</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - --ip-masq</span><br><span class="line">        - --kube-subnet-mgr</span><br><span class="line">        <span class="comment">#æœç´¢ containersï¼Œæ–°å¢ä½¿ç”¨çš„ç½‘å¡</span></span><br><span class="line">        - --iface=eth0</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">#æœç´¢containersï¼Œå¦‚æœå‡ºç°è¿™ä¸ªæ ‡ç­¾ï¼Œå°±æŠŠè¿™ä¸ªæ ‡ç­¾é‡Œé¢çš„3è¡Œå†…å®¹åˆ æ‰</span></span><br><span class="line">        spec:</span><br><span class="line">          selector:  <span class="comment">#åˆ æ‰</span></span><br><span class="line">            matchLabels:  <span class="comment">#åˆ æ‰</span></span><br><span class="line">            app: flannel  <span class="comment">#åˆ æ‰</span></span><br><span class="line"></span><br><span class="line">app: flannelæ˜¯ä¸€ä¸ªæ ‡ç­¾é€‰æ‹©å™¨ï¼Œåªæœ‰æ‰“äº†appæ ‡ç­¾çš„nodeï¼Œæ‰ä¼šå®‰è£…flannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€åªè¦ä¿®æ”¹äº†flannelèµ„æºæ¸…å•ï¼Œå°±è¦æ‰§è¡Œåº”ç”¨flannelèµ„æºæ¸…å•</span><br><span class="line">[root@master01 ~]# kubectl apply -f kube-flannel.yml</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">4ã€#æ£€æŸ¥è¿™å‡ ä¸ªçŠ¶æ€</span><br><span class="line">â‘ ã€æ£€æŸ¥flannelçš„podæ˜¯å¦å¯åŠ¨æˆåŠŸ   4ä¸ªSTATUSæ˜¾ç¤ºRunningå°±æ˜¯æˆåŠŸ</span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-flannel</span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-flannel-ds-4ncf5   1/1     Running   0          4m20s</span><br><span class="line">kube-flannel-ds-7dnxx   1/1     Running   0          4m20s</span><br><span class="line">kube-flannel-ds-dpzqp   1/1     Running   0          4m20s</span><br><span class="line">kube-flannel-ds-knmch   1/1     Running   0          4m20s</span><br><span class="line"></span><br><span class="line">â‘¡ã€æ£€æŸ¥k8sé›†ç¾¤èŠ‚ç‚¹çŠ¶æ€    STATUSæ˜¾ç¤ºReadyå°±æ˜¯å‡†å¤‡å¥½çš„ï¼Œé›†ç¾¤ä¹‹é—´èµ·çš„podå°±å¯ä»¥äº’ç›¸é€šä¿¡äº†</span><br><span class="line">[root@master01 ~]# kubectl get nodes</span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION</span><br><span class="line">master01   Ready    master   81m   v1.19.3</span><br><span class="line">node01     Ready    &lt;none&gt;   75m   v1.19.3</span><br><span class="line">node02     Ready    &lt;none&gt;   73m   v1.19.3</span><br><span class="line">node03     Ready    &lt;none&gt;   73m   v1.19.3</span><br><span class="line"></span><br><span class="line">â‘¢ã€æ£€æŸ¥corednsæ˜¯å¦æ­£å¸¸è¿è¡Œ   åªè¦ç½‘ç»œé…å¥½ï¼Œdnså°±okäº†ï¼ŒSTATUSæ˜¾ç¤ºRunningçŠ¶æ€</span><br><span class="line">[root@master01 ~]# kubectl get pod -n kube-system</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-6d56c8448f-85k2r           1/1     Running   0          81m</span><br><span class="line">coredns-6d56c8448f-cn2t9           1/1     Running   0          81m</span><br><span class="line">etcd-master01                      1/1     Running   0          81m</span><br><span class="line">kube-apiserver-master01            1/1     Running   0          81m</span><br><span class="line">kube-controller-manager-master01   1/1     Running   0          81m</span><br><span class="line">kube-proxy-2skng                   1/1     Running   0          30m</span><br><span class="line">kube-proxy-fxwbg                   1/1     Running   0          30m</span><br><span class="line">kube-proxy-w6v6r                   1/1     Running   0          30m</span><br><span class="line">kube-proxy-zng7l                   1/1     Running   0          30m</span><br><span class="line">kube-scheduler-master01            1/1     Running   0          81m</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nodeè®¾ç½®è§’è‰²ä¿¡æ¯   </span></span><br><span class="line"> kubectl label node node01 node-role.kubernetes.io/node=</span><br><span class="line"> kubectl label node node02 node-role.kubernetes.io/node=</span><br><span class="line"> kubectl label node node03 node-role.kubernetes.io/node=</span><br></pre></td></tr></table></figure><h3 id="2ã€å®‰è£…kubectlå‘½ä»¤è¡¥å…¨é»‘ç§‘æŠ€">2ã€<strong>å®‰è£…kubectlå‘½ä»¤è¡¥å…¨é»‘ç§‘æŠ€</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯ä»¥tabè¡¥å…¨çš„å·¥å…·</span></span><br><span class="line"></span><br><span class="line">yum install -y bash-completion</span><br><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion </span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash) </span><br><span class="line">kubectl completion bash &gt; /etc/bash_completion.d/kubectl</span><br><span class="line"></span><br><span class="line">å®‰è£…å®Œæˆéœ€è¦é€€å‡ºåœ¨é‡æ–°è¿æ¥</span><br><span class="line"><span class="built_in">logout</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@master01 ~]# kubectl ap æŒ‰tabå¯ä»¥è¡¥å…¨äº†</span><br><span class="line">api-resources  api-versions   apply          </span><br><span class="line">[root@master01 ~]# kubectl get namespaces æŒ‰tabå¯ä»¥è¡¥å…¨äº†</span><br><span class="line">default          kube-flannel     kube-node-lease  kube-public      kube-system  </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> K8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ‰1ã€K8såŸºç¡€å’Œèµ„æºä»‹ç»</title>
      <link href="/posts/4b5e2999.html"/>
      <url>/posts/4b5e2999.html</url>
      
        <content type="html"><![CDATA[<h2 id="K8såŸºç¡€å’Œèµ„æºä»‹ç»">K8såŸºç¡€å’Œèµ„æºä»‹ç»</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">k8æ˜¯å¯¹å®¹å™¨çš„ç¼–æ’å·¥å…·ï¼Œä¹‹å‰ä½¿ç”¨çš„docker-composeæ˜¯å•æœºç¼–æ’</span><br><span class="line"></span><br><span class="line">k8såŸç”Ÿçš„è¯­è¨€ï¼šgoè¯­è¨€</span><br><span class="line"></span><br><span class="line">ç®¡ç†k8sé›†ç¾¤å·¥å…·ï¼š</span><br><span class="line">1ã€vsocde</span><br><span class="line">2ã€rancherï¼ˆwebå›¾å½¢åŒ–ç•Œé¢ï¼‰</span><br><span class="line">3ã€k9s</span><br><span class="line"></span><br><span class="line"><span class="comment">#å’Œk8sç±»ä¼¼çš„ç¼–æ’å·¥å…·</span></span><br><span class="line">borg   </span><br><span class="line">swarm(dockerå†™çš„)</span><br><span class="line">mesos </span><br><span class="line">è¿™äº›éƒ½åœ¨ä¹‹å‰ä½¿ç”¨çš„ç¼–æ’å·¥å…·ï¼Œä½†ç°åœ¨k8sç«èµ·æ¥äº†ï¼Œä»–ä»¬å°±ä¸æ€ä¹ˆç”¨äº†</span><br></pre></td></tr></table></figure><h3 id="1ã€K8så‚è€ƒç½‘ç«™">1ã€<strong>K8så‚è€ƒç½‘ç«™</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">å®˜ç½‘ï¼šhttps://kubernetes.io</span><br><span class="line">å®˜æ–¹æ–‡æ¡£ï¼šhttps://kubernetes.io/zh-cn/docs/home/</span><br><span class="line">kubeadmå®˜æ–¹æ–‡æ¡£ï¼šhttps://kubernetes.io/zh-cn/docs/setup/production-environment/tools/</span><br><span class="line">dockerå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.docker.com/</span><br><span class="line">prometheuså®˜æ–¹æ–‡æ¡£ï¼šhttps://prometheus.io/docs/introduction/overview/</span><br><span class="line">ansibleå®‰è£…k8sé¡¹ç›®ï¼šhttps://github.com/easzlab/kubeasz?tab=readme-ov-file</span><br><span class="line">é˜¿é‡Œäº‘ACKï¼šhttps://www.aliyun.com/product/kubernetes</span><br><span class="line">äºšé©¬é€Šäº‘EKSï¼šhttps://aws.amazon.com/cn/eks/?nc2=h_ql_prod_ct_eks</span><br></pre></td></tr></table></figure><h3 id="2ã€K8sçš„2å¤§ç»„ä»¶">2ã€<strong>K8sçš„2å¤§ç»„ä»¶</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c/sç»“æ„çš„</span><br><span class="line"></span><br><span class="line">1ã€masterç»„ä»¶(æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰)</span><br><span class="line"></span><br><span class="line">2ã€nodeç»„ä»¶</span><br></pre></td></tr></table></figure><ul><li><strong>1ã€masterç»„ä»¶    (æ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆControl Plane Componentsï¼‰)</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1ã€kube-apiserver(apiserver)ï¼šç±»ä¼¼äºå¸ä»¤éƒ¨ï¼Œæ‰€æœ‰masterä¸Šçš„ç»„ä»¶å·¥ä½œéƒ½è¦ç»è¿‡apiserver</span><br><span class="line">(å½“åœ¨å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤æˆ–è€…åœ¨UIç•Œé¢æ“ä½œèµ·ä¸€ä¸ªå®¹å™¨éƒ½éœ€è¦ç»è¿‡api,ä»–ä¼šé€šçŸ¥å…¶ä»–ç»„ä»¶ï¼Œæ‰€æœ‰ç»„ä»¶è°ƒç”¨ä»€ä¹ˆä¸œè¥¿æˆ–è€…è®¡ç®—ä»€ä¹ˆä¸œè¥¿éƒ½è¦ç»è¿‡ä»–)</span><br><span class="line"></span><br><span class="line">2ã€etcdï¼šæ‰€æœ‰ç»„ä»·äº§ç”Ÿçš„æ•°æ®å­˜æ”¾ä½ç½®ï¼Œå‚¨å­˜æ‰€æœ‰å‘½ä»¤ã€èµ„æºæ¸…å•ã€è¯ä¹¦ä¿¡ä»»ã€webæ“ä½œåŠå…¶ä»–ç»„ä»¶æ•°æ®</span><br><span class="line">(å¦‚æœè¿™ä¸ªå®•äº†ï¼Œè¿™ä¸€å¥—é›†ç¾¤å°±åºŸäº†ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™å¥—é›†ç¾¤éœ€è¦é‡æ–°æ­å»ºï¼Œè€Œä¸æ˜¯ä¿®å¤ä¸€å°etcd)</span><br><span class="line"></span><br><span class="line">3ã€kube-scheduler(scheduler  æ—¶è¯¥ä¸¢äº†å„¿)ï¼šèµ„æºè®¡ç®—ã€èµ„æºè°ƒåº¦</span><br><span class="line">(æ¯”å¦‚è¯´åœ¨å‘½ä»¤è¡Œæ‰§è¡Œåˆ›å»º10å°å®¹å™¨ï¼Œå…ˆç»è¿‡ä»–apiserverï¼Œä¼šæŠŠæœŸæœ›å€¼å­˜æ¡£etcd,ç„¶åé€šçŸ¥schedulerå»etcdæŠŠæ•°æ®å–å‡ºæ¥)</span><br><span class="line"></span><br><span class="line">4ã€kube-controller-manager(controller  æŠ—æŠ½äº†å„¿)ï¼šæ§åˆ¶å™¨ï¼Œæ§åˆ¶nodeç»„ä»¶å¯åŠ¨å®¹å™¨</span><br><span class="line">(scheduleåšå®Œèµ„æºçš„è®¡ç®—è°ƒåº¦,æ•°æ®å­˜æ¡£etcdäº†,controlleré€šè¿‡apiserveræ‹¿åˆ°æ•°æ®ï¼Œä¼šæ§åˆ¶nodeç»„ä»¶å¯åŠ¨)</span><br></pre></td></tr></table></figure><ul><li><strong>2ã€nodeç»„ä»¶</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1ã€kubeletï¼šæ§åˆ¶dockerå¯åŠ¨å®¹å™¨(æ§åˆ¶å®¹å™¨è¿æ—¶ï¼Œå¯åŠ¨æŒ‡å®šå®¹å™¨)</span><br><span class="line">(æ¯ä¸€ä¸ªnodeéƒ½è¦è£…)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€å®¹å™¨è¿è¡Œæ—¶ï¼ˆContainer runtimeï¼‰</span><br><span class="line"> (æ¯ä¸€ä¸ªnodeèŠ‚ç‚¹ä¸Šå¾—è£…ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶)</span><br><span class="line">    - containerd</span><br><span class="line">    - CRI-O</span><br><span class="line">    - Docker Engine</span><br><span class="line">    - Mirantis Container Runtime</span><br><span class="line"></span><br><span class="line">3ã€kube-proxyï¼ˆå¯é€‰ï¼‰ï¼šPODç«¯å£æ˜ å°„ï¼Œç½‘ç»œç›¸å…³</span><br><span class="line">å¯ä»¥ç†è§£ä¸ºpodå°±æ˜¯å®¹å™¨</span><br><span class="line">èµ·podéœ€è¦åšç«¯å£æ˜ å°„ï¼Œä»–å°±æ˜¯åšç«¯å£æ˜ å°„çš„å·¥å…·</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#k8sä¸‰å¤§æ¥å£APIäºŒæ¬¡å¼€å‘ï¼Œè°ƒç”¨æ¥å£</span></span><br><span class="line">CRIï¼šruntimeï¼Œå®¹å™¨æ“ä½œæ¥å£</span><br><span class="line">CNIï¼šnetworkï¼Œç½‘ç»œæ“ä½œæ¥å£</span><br><span class="line">CSIï¼šstorageï¼Œå‚¨å­˜æ“ä½œæ¥å£</span><br></pre></td></tr></table></figure><h3 id="3ã€K8sæ¶æ„">3ã€<strong>K8sæ¶æ„</strong></h3><p>å•æœºèŠ‚ç‚¹æ¶æ„</p><p><img src="../image/study_img/image-20240912101412211.png" alt="image-20240912101412211"></p><p>é«˜å¯ç”¨æ¶æ„</p><p><img src="../image/study_img/image-20240912163330677.png" alt="image-20240912163330677"></p><p><img src="../image/study_img/image-20240912102531543.png" alt="image-20240912102531543"></p><p>podåˆ›å»ºæµç¨‹</p><p><img src="../image/study_img/image-20240912103904760.png" alt="image-20240912103904760"></p><p><img src="../image/study_img/image-20240912173745374.png" alt="image-20240912173745374"></p><h3 id="4ã€k8sæ ¸å¿ƒèµ„æº-æ“ä½œå¯¹è±¡">4ã€<strong>k8sæ ¸å¿ƒèµ„æº(æ“ä½œå¯¹è±¡)</strong></h3><p><strong>â‘ ã€podèµ„æº</strong></p><p>â‘ ä»€ä¹ˆæ˜¯pod<br>1ã€Podæ˜¯K8sçš„æœ€å°å•ä½<br>2ã€Podçš„IPåœ°å€æ˜¯éšæœºçš„ï¼Œåˆ é™¤Podä¼šæ”¹å˜IP<br>3ã€Podéƒ½æœ‰ä¸€ä¸ªæ ¹å®¹å™¨<br>4ã€ä¸€ä¸ªPodå†…å¯ä»¥ç”±ä¸€ä¸ªå®¹å™¨æˆ–å¤šä¸ªå®¹å™¨ç»„æˆ<br>5ã€ä¸€ä¸ªPodå†…çš„å®¹å™¨å…±äº«æ ¹å®¹å™¨çš„ç½‘ç»œã€åç§°ç©ºé—´ã€å’Œæ–‡ä»¶ç³»ç»Ÿå·    (æ¯”å¦‚è¯´èµ·ä¸€ä¸ªnginxçš„pod,ä»–ä¼šå’Œæ ¹å®¹å™¨å…±äº«ç½‘ç»œã€åç§°ç©ºé—´ã€å’Œæ–‡ä»¶ç³»ç»Ÿã€‚åŸç†æ˜¯ï¼šæ ¹å®¹å™¨é‡Œé¢çš„ç½‘ç»œæ¨¡å¼ç”¨çš„æ˜¯dockerç½‘ç»œæ¨¡å¼ä¸­çš„Containeræ¨¡å¼)<br>6ã€ä¸€ä¸ªPodå†…çš„ç½‘ç»œåœ°å€ç”±æ ¹å®¹å™¨æä¾›</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¯·é—®è´µå…¬å¸k8sæ¶æ„ä¸€ä¸ªpodé‡Œé¢èµ·å‡ ä¸ªå®¹å™¨</span><br><span class="line"></span><br><span class="line"> ç­”ç²¾ç¡®çš„æ•°å­—å°±æ˜¯é”™è¯¯çš„ï¼Œé¦–å…ˆåº”è¯¥podé‡Œé¢èµ·å‡ ä¸ªå®¹å™¨å–å†³äºé¡¹ç›®</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240912104532405.png" alt="image-20240912104532405"></p><p>â‘¡podè¿è¡ŒçŠ¶æ€ï¼Œåªè¦è®°ä½ä¸æ˜¯runingçŠ¶æ€å°±æ˜¯æœ‰é—®é¢˜çš„</p><table><thead><tr><th>çŠ¶æ€</th><th>æè¿°</th></tr></thead><tbody><tr><td>Pendingï¼ˆç­‰å¾…ï¼‰</td><td>Podå·²ç»è¢«K8Sç³»ç»Ÿæ¥å—ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œå°šæœªåˆ›å»ºï¼Œäº¦æœªè¿è¡Œã€‚æ­¤é˜¶æ®µåŒ…æ‹¬ç­‰å¾…Podè¢«è°ƒåº¦çš„æ—¶é—´å’Œé€šè¿‡ç½‘ç»œä¸‹è½½é•œåƒçš„æ—¶é—´</td></tr><tr><td>Runningï¼ˆè¿è¡Œï¼‰</td><td>Podå·²ç»ç»‘å®šåˆ°æŸä¸ªèŠ‚ç‚¹(node)ï¼ŒPodä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²è¢«åˆ›å»ºï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ä»åœ¨è¿è¡Œï¼Œæˆ–è€…å¤„äºå¯åŠ¨æˆ–é‡å¯çŠ¶æ€</td></tr><tr><td>Succeededï¼ˆæˆåŠŸï¼‰</td><td>Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”ä¸ä¼šå†é‡å¯</td></tr><tr><td>Failedï¼ˆå¤±è´¥ï¼‰</td><td>Podä¸­æ‰€æœ‰å®¹å™¨éƒ½å·²æˆåŠŸç»ˆæ­¢ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªå®¹å™¨æ˜¯å› ä¸ºå¤±è´¥è€Œç»ˆæ­¢</td></tr><tr><td>Unknownï¼ˆæœªçŸ¥ï¼‰</td><td>å› ä¸ºæŸäº›åŸå› æ— æ³•è·å–PodçŠ¶æ€ï¼Œè¿™ç§æƒ…å†µï¼Œé€šå¸¸æ˜¯å› ä¸ºä¸Podæ‰€åœ¨ä¸»æœºé€šä¿¡å¤±è´¥</td></tr></tbody></table><p><strong>â‘¡ã€serviceèµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serviceä¹Ÿæ˜¯k8sæ ¸å¿ƒèµ„æºä¹‹ä¸€ï¼Œserviceå®šä¹‰äº†æœåŠ¡çš„å…¥å£åœ°å€ï¼Œç”¨æ¥å°†åç«¯çš„podæœåŠ¡æš´éœ²ç»™å¤–éƒ¨çš„ç”¨æˆ·è®¿é—®</span><br></pre></td></tr></table></figure><p>serviceæä¾›äº†2ç§ç½‘ç»œèµ„æº</p><p><img src="../image/study_img/image-20240912180101026.png" alt="image-20240912180101026"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€ç§ï¼šNodePort  å®¿ä¸»æœºç«¯å£æ˜ å°„clusteripç«¯å£ï¼Œå¯¹å¤–æä¾›æœåŠ¡</span><br><span class="line"></span><br><span class="line">ç¬¬äºŒç§ï¼šClusterIP  podçš„è´Ÿè½½å‡è¡¡(èµ·10ä¸ªpod,clusteripå¯ä»¥ç»™è¿™äº›podè´Ÿè½½ï¼Œä½†æ˜¯clusteripæ˜¯å†…ç½‘ipï¼Œå®¿ä¸»æœºè¿˜æ˜¯ä¸èƒ½è®¿é—®ï¼Œæ‰€ä»¥serviceåˆæä¾›äº†nodeport)</span><br><span class="line"></span><br><span class="line"><span class="comment">#é—®é¢˜ï¼šPODçš„IPæ˜¯éšæœºçš„ï¼Œå¦‚æœä¸€ä¸ªPODå®•æœºäº†ï¼Œk8sä¼šè‡ªåŠ¨æ‹‰èµ·ä¸€ä¸ªæ–°çš„pod,ipå˜äº†å¦‚ä½•åŠ å…¥åˆ°ClusterIPè¿™ä¸ªè´Ÿè½½å‡è¡¡é›†ç¾¤ä¸­ï¼Ÿ</span></span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨DNSè§£æPODçš„IPåˆ°ä¸€ä¸ª<span class="string">&#x27;å­—ç¬¦ä¸²ä¸Š&#x27;</span>(æ¯ä¸ªpodå¯åŠ¨éƒ½è¦åˆ°æ ‡ç­¾app:nginx)</span><br><span class="line">DNSçš„æœåŠ¡ï¼š</span><br><span class="line">    - coreDNS(k8sç”¨è¿™ä¸ª)</span><br><span class="line">    - bind9(æ¯”è¾ƒéº»çƒ¦)</span><br><span class="line">    - dnsmsq(å†…å¤–çš„dnsç”¨)</span><br></pre></td></tr></table></figure><p><strong>â‘¢ã€labelæ ‡ç­¾èµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Labelæ ‡ç­¾æ˜¯K8Sä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªå±æ€§ï¼ŒLabelæ ‡ç­¾å°±åƒèº«ä»½è¯ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥è¯†åˆ«K8Sçš„å¯¹è±¡ã€‚</span><br><span class="line">ä¼ ç»Ÿæ¶æ„ä¸­ï¼Œä¸åŒçš„æœåŠ¡åº”ç”¨ä¹‹é—´é€šè®¯ï¼Œéƒ½æ˜¯é€šè¿‡IPå’Œç«¯å£ï¼Œä½†æ˜¯åœ¨K8Sä¸­å¾ˆå¤šåŒ¹é…å…³ç³»éƒ½æ˜¯é€šè¿‡æ ‡ç­¾æ¥æ‰¾ã€‚</span><br></pre></td></tr></table></figure><p><strong>â‘£ã€Namespaceèµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Namespaceï¼ˆåç§°ç©ºé—´ï¼‰æ˜¯K8Sä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒNamespaceå°†é›†ç¾¤å†…éƒ¨çš„èµ„æºè¿›è¡Œéš”ç¦»åˆ’åˆ†ã€‚</span><br><span class="line">åœ¨Namespaceä¸­ï¼Œå½¢æˆé€»è¾‘ä¸Šçš„ä¸åŒé¡¹ç›®ç»„æˆ–ç”¨æˆ·ç»„ã€‚</span><br></pre></td></tr></table></figure><p><strong>â‘¤ã€Controlleræ§åˆ¶å™¨èµ„æº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Controllerç”¨æ¥ç®¡ç†Podã€‚</span></span><br><span class="line"><span class="comment">## Podæ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼š</span></span><br><span class="line">  - RCèµ„æºï¼šå¯ä»¥åšçš„è‡ªåŠ¨æ‹‰èµ·ï¼Œæ§åˆ¶å¤šä¸ªå‰¯æœ¬ï¼Œä½†ç°åœ¨ä¸ç”¨äº†</span><br><span class="line">  - RS   RCæ§åˆ¶å™¨çš„å‡çº§ç‰ˆï¼Œå¯ä»¥è‡ªåŠ¨æ‹‰èµ·å®•æœºçš„POD</span><br><span class="line">  - Deployment  ç”Ÿäº§ä¸­å¸¸ç”¨çš„æ§åˆ¶å™¨ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼ŒåŒ…å«äº†RSæ§åˆ¶å™¨ï¼Œå¯¹é•œåƒåšç‰ˆæœ¬ç®¡ç†(æ¯”è¾ƒå¸¸ç”¨)</span><br><span class="line">  - DaemonSet   ä¿è¯æ‰€æœ‰nodeèŠ‚ç‚¹ä¸Šï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªpodè¿è¡Œ</span><br><span class="line">  - Staefulset  æœ‰çŠ¶æ€çš„åº”ç”¨(å¦‚mysqlçš„ä¸»ä»å¤åˆ¶)ï¼Œä¸ºpodæä¾›å”¯ä¸€æ ‡è¯†</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  åé¢èµ·podä¼šå†™èµ„æºæ¸…å•èµ·10ä¸ªnginxï¼ŒæŒ‚äº†ä¸€å°å°±ç›´æ¥æŒ‚äº†ï¼Œpodä¸ä¼šå†èµ·ä¸€å°ï¼Œè€Œèƒ½å¤Ÿæ‹‰èµ·çš„æ˜¯controllerèµ„æºï¼Œä»–ä¼šæ£€æµ‹èµ„æºæ¸…å•æ˜¯ä¸æ˜¯10ä¸ªpodéƒ½åœ¨ï¼Œå¦‚æœå°‘ä¸€ä¸ªï¼Œæ§åˆ¶å™¨ä¼šé‡æ–°æ‹‰èµ·ä¸€ä¸ªå†åŠ å…¥é›†ç¾¤</span><br></pre></td></tr></table></figure><p><strong>pod RC Service çš„å…³ç³»</strong></p><p><img src="../image/study_img/image-20240912120405666.png" alt="image-20240912120405666"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è‡ªåŠ¨æ‰©ç¼©å®¹ï¼š</span><br><span class="line">æ¯”å¦‚è¯´ç°åœ¨æœ‰10å°nginx,åŒåä¸€æµé‡ä¸Šæ¥äº†ï¼Œ10å°ä¸å¤Ÿç”¨ï¼Œæ€ä¹ˆåŠï¼Ÿ</span><br><span class="line">k8sæœ‰ä¸€ä¸ªèµ„æºï¼Œä¸€å¼€å§‹10ä¸ªnginxå°±å¤Ÿäº†ï¼Œæµé‡ä¸Šæ¥äº†ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œæµé‡ä¸‹å»äº†ä¼šè‡ªåŠ¨ç¼©å®¹ï¼Œè€Œä¸”æ‰©å‡ºæ¥çš„podå’Œä¹‹å‰çš„podä¸€æ¨¡ä¸€æ ·</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> k8s </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡åä¸€ã€groupèµ„æºæ§åˆ¶/æ·»åŠ ç£ç›˜</title>
      <link href="/posts/cb5f694f.html"/>
      <url>/posts/cb5f694f.html</url>
      
        <content type="html"><![CDATA[<h3 id="Cgroup-èµ„æºæ§åˆ¶-æ·»åŠ ç£ç›˜">Cgroup(èµ„æºæ§åˆ¶)/æ·»åŠ ç£ç›˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1ã€#dockerå¦‚ä½•åšèµ„æºé™åˆ¶çš„(æ¯”å¦‚è¯´å†…å­˜çš„é™åˆ¶)</span><br><span class="line">docker run -m å»é™åˆ¶å†…å­˜</span><br><span class="line"></span><br><span class="line">2ã€#åŸç†æ˜¯ä»€ä¹ˆ</span><br><span class="line">-mæŒ‡å®šé™åˆ¶å†…å­˜çš„æ•°é‡ï¼Œdockeré€šè¿‡å†…æ ¸å‚æ•°ï¼Œä¹Ÿå°±æ˜¯Cgroupå¯¹èµ„æºè¿›è¡Œé™åˆ¶</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#Cgroupçš„ä½œç”¨</span><br><span class="line">åœ¨æ“ä½œç³»ç»Ÿè§£å†³äº†èµ„æºç›¸ä¸éš”ç¦»çš„é—®é¢˜ä»¥åï¼Œè¿˜éœ€è¦è§£å†³èµ„æºé™åˆ¶çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯é¿å…åœ¨åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸­ï¼Œé˜²æ­¢æœ‰äº›èµ„æºæ¶ˆè€—è¾ƒå¤§çš„å®¹å™¨ï¼Œå°†æ•´ä¸ªç‰©ç†æœºå™¨(å®¿ä¸»æœº)çš„ç¡¬ä»¶èµ„æº(CPU,Memory)å æ»¡ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨Linux ç³»ç»Ÿä¸­èƒ½å¤Ÿæ§åˆ¶çš„èµ„æºåˆ—è¡¨å¦‚ä¸‹</span><br><span class="line">memory      <span class="comment">#å†…å­˜é™åˆ¶</span></span><br><span class="line">hugetlb     <span class="comment">#huge pages ä½¿ç”¨é‡</span></span><br><span class="line">cpu         <span class="comment">#é™åˆ¶CPUä½¿ç”¨ç‡</span></span><br><span class="line">cpuacct     <span class="comment">#ç»Ÿè®¡cgroupsä¸­çš„è¿›ç¨‹çš„CPUä½¿ç”¨æŠ¥å‘Š</span></span><br><span class="line">cpuset      <span class="comment">#ç»‘å®šcgroupsåˆ°æŒ‡å®š CPUså’Œ NUMAèŠ‚ç‚¹</span></span><br><span class="line">innodb_lock_wait_timeout  <span class="comment">#blockè®¾å¤‡çš„I0é€Ÿåº¦</span></span><br><span class="line">not_cls     <span class="comment">#ç½‘ç»œæ¥å£è®¾ç½®ä¼˜å…ˆçº§</span></span><br><span class="line">devices     <span class="comment">#mknodeè®¿é—®è®¾å¤‡æƒé™</span></span><br><span class="line">freezer     <span class="comment">#suspendå’Œrestore cgroups è¿›ç¨‹</span></span><br><span class="line">perf_event  <span class="comment">#æ€§èƒ½ç›‘æ§</span></span><br><span class="line">pids        <span class="comment">#é™åˆ¶å­æ ‘ cgroups æ€»è¿›ç¨‹æ•°</span></span><br><span class="line"></span><br><span class="line">4ã€#å®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„èµ„æºå¦‚ä½•éš”ç¦»ï¼Ÿ</span><br><span class="line">Namespace  åç§°ç©ºé—´éš”ç¦»</span><br><span class="line"></span><br><span class="line">5ã€#ä¸ºä»€ä¹ˆå®¹å™¨ä¹‹é—´çš„èµ„æºå¯ä»¥é€šè¿‡nsè¿›è¡Œéš”ç¦»ï¼Ÿ</span><br><span class="line">å› ä¸ºdockerå®¹å™¨è¿è¡Œèµ·æ¥æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªå®¹å™¨éƒ½æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹ä¹‹é—´ç”¨æ¥èµ„æºéš”ç¦»çš„å°±æ˜¯Namespace</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç³»ç»Ÿå®ç°çš„é™åˆ¶èµ„æº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 node]# <span class="built_in">cat</span> /proc/cgroups </span><br><span class="line"><span class="comment">#subsys_name    hierarchy       num_cgroups     enabled</span></span><br><span class="line">cpuset  11      7       1</span><br><span class="line">cpu     3       77      1</span><br><span class="line">cpuacct 3       77      1</span><br><span class="line">memory  7       77      1</span><br><span class="line">devices 5       77      1</span><br><span class="line">freezer 10      7       1</span><br><span class="line">net_cls 2       7       1</span><br><span class="line">blkio   9       77      1</span><br><span class="line">perf_event      4       7       1</span><br><span class="line">hugetlb 6       7       1</span><br><span class="line">pids    8       77      1</span><br><span class="line">net_prio        2       7       1</span><br></pre></td></tr></table></figure><h3 id="1ã€æ¡ˆä¾‹ï¼šé™åˆ¶SSHå†…å­˜ä½¿ç”¨">1ã€<strong>æ¡ˆä¾‹ï¼šé™åˆ¶SSHå†…å­˜ä½¿ç”¨</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1ã€é™åˆ¶ç³»ç»ŸæœåŠ¡å†…å­˜</span><br><span class="line">[root@docker01 node]# <span class="built_in">cd</span> /sys/fs/cgroup/memory/system.slice/sshd.service/</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹å†…å­˜æœåŠ¡é™åˆ¶(byte)</span><br><span class="line">[root@docker01 sshd.service]# <span class="built_in">cat</span> memory.limit_in_bytes </span><br><span class="line">9223372036854771712</span><br><span class="line"></span><br><span class="line">3ã€è®¡ç®—ä¸€ä¸‹ï¼Œå¤§æ¦‚æ˜¯7G,è¿™ä¸ªæ˜¯é»˜è®¤å€¼ï¼Œä¸ç®¡ç³»ç»Ÿå†…å­˜å¤šå¤§ï¼Œæ¯ä¸ªè¿›ç¨‹é»˜è®¤æœ€å¤§ä½¿ç”¨7G,è¿™æ ·å°±ç›¸å½“äºæ²¡æœ‰åšä»»ä½•é™åˆ¶Â·</span><br><span class="line">[root@docker01 sshd.service]# python</span><br><span class="line">&gt;&gt;&gt; 9223372036854771712/1024/1024/1024/1024/1024/1024</span><br><span class="line">7</span><br><span class="line"></span><br><span class="line">4ã€sshæœåŠ¡ä¸æ˜¯æ‹¿å®¹å™¨èµ·èµ·æ¥çš„ï¼Œå¦‚æœæƒ³ç»™ä»–é™åˆ¶ï¼Œå°±éœ€è¦æ”¹æ–‡ä»¶é‡Œé¢çš„æ•°å­—å¤§å°</span><br><span class="line">è®¾ç½®é™åˆ¶å†…å­˜</span><br><span class="line">[root@docker01 sshd.service]# <span class="built_in">echo</span> 64K &gt; memory.limit_in_bytes </span><br><span class="line">æ‰§è¡Œä¹‹åï¼Œsshå°±ç«‹é©¬ç«¯å£è¿æ¥äº†ï¼Œåªå†™1ä¸ªå­—èŠ‚ï¼Œæ ¹æœ¬å°±è¿ä¸ä¸Šssh</span><br><span class="line"></span><br><span class="line">5ã€åˆ°è™šæ‹Ÿæœºé‡Œé¢æŸ¥çœ‹æ—¥å¿—</span><br><span class="line">tailf /var/log/messages</span><br><span class="line"></span><br><span class="line">6ã€å¯ä»¥å‘ç°ï¼Œè¿œç¨‹è¿æ¥æ—¶ï¼Œä¼šæ€è¿›ç¨‹ï¼Œå› ä¸ºè¿œç¨‹è¿æ¥ä¼šäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯sshè¢«åšäº†é™åˆ¶</span><br><span class="line">ï¼Œä¼šæ€æ‰è¿æ¥çš„è¿›ç¨‹</span><br><span class="line"></span><br><span class="line">Cgroupè°ƒç”¨å†…æ ¸å‚æ•°ï¼Œå¦‚æœåšé™åˆ¶ï¼Œå°±æ”¹memory.limit_in_bytesæ–‡ä»¶ï¼Œå†…æ ¸æ¥è¯»å–è¿™ä¸ªæ–‡ä»¶æ¥è¿›è¡Œé™åˆ¶</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240912151039561.png" alt="image-20240912151039561"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 sshd.service]# <span class="built_in">echo</span> 9223372036854771712 &gt; memory.limit_in_bytes</span><br><span class="line"></span><br><span class="line">[root@docker01 sshd.service]# <span class="built_in">cat</span> memory.limit_in_bytes</span><br><span class="line">9223372036854771712</span><br></pre></td></tr></table></figure><h3 id="2ã€OverlayFS">2ã€<strong>OverlayFS</strong></h3><p><strong>OverlayFS</strong> <strong>å®ç°æ–¹å¼</strong></p><p>OverlayFSé€šè¿‡ä¸‰ä¸ªç›®å½•ï¼šlowerç›®å½•ã€upperç›®å½•ã€ä»¥åŠworkç›®å½•å®ç°,å…¶ä¸­lowerç›®å½•å¯ä»¥æ˜¯å¤šä¸ª,upperç›®å½•ä¸ºå¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œçš„ç›®å½•, workç›®å½•ä¸ºå·¥ä½œåŸºç¡€ç›®å½•,æŒ‚è½½åå†…å®¹ä¼šè¢«æ¸…ç©º,ä¸”åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å…¶å†…å®¹ç”¨æˆ·ä¸å¯è§,æœ€åè”åˆæŒ‚è½½å®Œæˆç»™ç”¨æˆ·å‘ˆç°çš„ç»Ÿä¸€è§†å›¾ç§°ä¸ºmergedç›®å½•ã€‚</p><p><img src="../image/study_img/image-20240913170119816.png" alt="image-20240913170119816"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¨¡æ‹Ÿoverlayfså­˜å‚¨æ–¹å¼</span></span><br><span class="line">1.åˆ›å»ºæ–‡ä»¶</span><br><span class="line">[root@k8s01 ~]# <span class="built_in">mkdir</span> /lower&#123;1..3&#125;</span><br><span class="line">[root@k8s01 ~]# <span class="built_in">mkdir</span> /upper /work /merged</span><br><span class="line"></span><br><span class="line">2.æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">[root@k8s01 ~]# mount -t overlay overlay -o</span><br><span class="line">lowerdir=/lower1:/lower2:/lower3,upperdir=/upper,workdir=/work /merged</span><br><span class="line"></span><br><span class="line">3.æŸ¥çœ‹æŒ‚è½½</span><br><span class="line">[root@k8s01 ~]# mount | grep merged</span><br><span class="line"></span><br><span class="line">4.åœ¨/upper ç›®å½•ä¸­å†™å…¥æ–‡ä»¶,åœ¨mergedä¸­å¯ä»¥æ˜¾ç¤º</span><br><span class="line">[root@k8s01 /]# <span class="built_in">touch</span> /upper/upper.txt</span><br><span class="line">[root@k8s01 /]# ll /merged/</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar 14 02:17 upper.txt</span><br><span class="line"></span><br><span class="line">5. åœ¨mergedä¸­å†™å…¥æ–‡ä»¶, å®é™…å­˜å‚¨åˆ°äº†/uppper</span><br><span class="line">[root@k8s01 /]# <span class="built_in">touch</span> /merged/d.txt</span><br><span class="line">[root@k8s01 /]# ll /upper/</span><br><span class="line">-rw-r--r-- 1 root root 0 Mar 14 02:19 d.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ³¨:å¦‚æœæ²¡æœ‰upperdirï¼Œ mergedæ˜¯åªè¯»çš„</span><br><span class="line">[root@node-2 overlay2]# umount /merged</span><br><span class="line">[root@node-2 overlay2]# mount -t overlay overlay -o lowerdir=/lower1:/lower2 /merged</span><br><span class="line">[root@k8s01 /]# <span class="built_in">touch</span> /merged/c.txt</span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> â€˜/merged/c.txtâ€™: Read-only file system</span><br></pre></td></tr></table></figure><h3 id="3ã€æ‰©å±•æ·»åŠ ç£ç›˜å’Œæ›´æ”¹dockeré»˜è®¤æ•°æ®ç›®å½•">3ã€<strong>æ‰©å±•æ·»åŠ ç£ç›˜å’Œæ›´æ”¹dockeré»˜è®¤æ•°æ®ç›®å½•</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1ã€å…ˆå…³æœº</span><br><span class="line"></span><br><span class="line">2ã€æ·»åŠ ç£ç›˜</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240913172422996.png" alt="image-20240913172422996"></p><p><img src="../image/study_img/image-20240913172442557.png" alt="image-20240913172442557"></p><p><img src="../image/study_img/image-20240913172500576.png" alt="image-20240913172500576"></p><p><img src="../image/study_img/image-20240913172538917.png" alt="image-20240913172538917"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">3ã€æŸ¥çœ‹æ·»åŠ çš„ç£ç›˜</span><br><span class="line">[root@docker01 ~]# fdisk -l</span><br><span class="line">Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors</span><br><span class="line">......</span><br><span class="line">.....</span><br><span class="line"><span class="comment">#/dev/sdbæ˜¯æ–°æ·»åŠ çš„ç£ç›˜</span></span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line"></span><br><span class="line">4ã€åˆ›å»ºåˆ†åŒº</span><br><span class="line">[root@docker01 ~]# fdisk /dev/sdb</span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition <span class="built_in">type</span>: <span class="comment">## é€‰æ‹©ä¸»åˆ†åŒºè¿˜æ˜¯æ‰©å±•åˆ†åŒº</span></span><br><span class="line">    p primary (0 primary, 0 extended, 4 free)</span><br><span class="line">    e extended</span><br><span class="line">Select (default p): p <span class="comment"># ä¸»åˆ†åŒº</span></span><br><span class="line">Partition number (1-4, default 1): 1 <span class="comment"># ä¸€ä¸ªåˆ†åŒº</span></span><br><span class="line">First sector (2048-104857599, default 2048): <span class="comment">## è®¾ç½®å¼€å¤´æ‰‡åŒºå¤§å°ï¼Œæˆ‘é€‰æ‹©é»˜è®¤</span></span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-104857599, default 104857599): <span class="comment">## è®¾ç½®æœ€åæ‰‡åŒºå¤§å°ï¼Œæˆ‘é€‰æ‹©é»˜è®¤</span></span><br><span class="line">Partition 1 of <span class="built_in">type</span> Linux and of size 50 GiB is <span class="built_in">set</span>  <span class="comment">## åˆ†åŒºæˆåŠŸ</span></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w <span class="comment">## é€€å‡º</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€å†æ¬¡æŸ¥çœ‹ç£ç›˜</span><br><span class="line">[root@docker01 ~]# fdisk -l</span><br><span class="line">.....</span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes, 20971520 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0x481c9cdc</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048    20971519    10484736   83  Linux</span><br><span class="line"><span class="comment">#æ–°åˆ†åŒº /dev/sdb1 </span></span><br><span class="line"></span><br><span class="line">5ã€æ ¼å¼åŒ–åˆ†åŒº</span><br><span class="line">[root@docker01 ~]# mkfs.xfs /dev/sdb1</span><br><span class="line"></span><br><span class="line">6ã€æŸ¥çœ‹åˆ†åŒºçš„UUID</span><br><span class="line">[root@docker01 ~]# blkid /dev/sdb1</span><br><span class="line">/dev/sdb1: UUID=<span class="string">&quot;65cdcede-223b-40ad-aa68-6165b7606b71&quot;</span> TYPE=<span class="string">&quot;xfs&quot;</span> </span><br><span class="line"></span><br><span class="line">7ã€#è®¾ç½®æ°¸ä¹…æŒ‚è½½</span><br><span class="line">æ–¹æ³•ä¸€ï¼šè¿™ä¸ªæ–¹æ³•å¦‚æœå†™é”™ä¸€ä¸ªå­—æ¯ï¼Œå¾ˆå¯èƒ½é€ æˆç³»ç»Ÿèµ·ä¸æ¥ï¼Œæ‰€ä»¥å†™å®Œäº†è¦ä»”ç»†æ£€æŸ¥</span><br><span class="line">[root@docker01 ~]# vim /etc/fstab </span><br><span class="line"><span class="comment">#æŠŠå†…å®¹åŠ å…¥æœ€åä¸€è¡Œ</span></span><br><span class="line">UUID=65cdcede-223b-40ad-aa68-6165b7606b71   /docker_data  xfs     defaults        0 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ–¹æ³•äºŒï¼šå†™å…¥è‡ªå¯åŠ¨æ–‡ä»¶   è¿™ä¸ªå†™é”™äº†ä¸ä¼šé€ æˆç³»ç»Ÿèµ·ä¸æ¥çš„æƒ…å†µ</span><br><span class="line">vim /root/.bashrc </span><br><span class="line">mount -t xfs /dev/sdb1 /docker_data </span><br><span class="line">ä¸è¦å½±å“æ–‡ä»¶åŸå…ˆçš„å†…å®¹</span><br><span class="line"></span><br><span class="line">8ã€ä¸´æ—¶æŒ‚è½½</span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> /docker_data</span><br><span class="line">[root@docker01 ~]# mount -a</span><br><span class="line"></span><br><span class="line">9ã€æŸ¥çœ‹ç£ç›˜åˆ†åŒº</span><br><span class="line">[root@docker01 ~]# <span class="built_in">df</span> -Th</span><br><span class="line">Filesystem              Type      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root xfs        19G   14G  5.1G  73% /</span><br><span class="line">devtmpfs                devtmpfs  1.6G     0  1.6G   0% /dev</span><br><span class="line">tmpfs                   tmpfs     1.6G     0  1.6G   0% /dev/shm</span><br><span class="line">tmpfs                   tmpfs     1.6G   12M  1.6G   1% /run</span><br><span class="line">tmpfs                   tmpfs     1.6G     0  1.6G   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               xfs       497M  126M  372M  26% /boot</span><br><span class="line">tmpfs                   tmpfs     318M     0  318M   0% /run/user/0</span><br><span class="line">/dev/sdb1               xfs        10G   33M   10G   1% /docker_data</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹æ­¥éª¤å¯ä»¥ä¸éœ€è¦æ“ä½œï¼Œå¦‚æœä¸æ›´æ”¹dockeré»˜è®¤æ•°æ®ç›®å½•çš„è¯ï¼Œä¸éœ€è¦æ“ä½œï¼Œå¦‚æœæ›´æ”¹äº†æ•°æ®ç›®å½•ï¼Œä¹‹å‰æ‹‰çš„é•œåƒå°±éœ€è¦é‡æ–°æ‹‰å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹dockeré»˜è®¤æ•°æ®ç›®å½•çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line">1ã€åœ¨é…ç½®æ–‡ä»¶é‡Œé¢æ·»åŠ ç›®å½•ä¿¡æ¯</span><br><span class="line">[root@docker01 docker_data]# vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;http://10.0.0.105&quot;</span>,<span class="string">&quot;http://172.16.1.101:5000&quot;</span>],</span><br><span class="line"><span class="string">&quot;data-root&quot;</span>: <span class="string">&quot;/docker_data&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">[root@docker01 docker_data]# systemctl daemon-reload</span><br><span class="line">[root@docker01 docker_data]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹dockerä¿¡æ¯</span><br><span class="line">[root@docker01 docker_data]# docker info</span><br><span class="line">Docker Root Dir: /docker_data</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡åã€å®¹å™¨åŒ–ç›‘æ§Prometheus</title>
      <link href="/posts/f75a8470.html"/>
      <url>/posts/f75a8470.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®¹å™¨åŒ–ç›‘æ§Promethues">å®¹å™¨åŒ–ç›‘æ§Promethues</h2><h3 id="1ã€Dockerè‡ªå¸¦çš„ç›‘æ§å‘½ä»¤">1ã€<strong>Dockerè‡ªå¸¦çš„ç›‘æ§å‘½ä»¤</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker02 ~]# docker ps</span><br><span class="line">[root@docker02 ~]# docker top mysql80</span><br><span class="line">[root@docker02 ~]# docker top jenkins</span><br><span class="line">[root@docker02 ~]# docker stats</span><br></pre></td></tr></table></figure><p>æœ‰äº†ä¸Šé¢çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨zabbixæ¥ç›‘æ§dockerå®¹å™¨äº†ï¼Œä½†æ˜¯é—®é¢˜å°±æ˜¯ï¼Œ zabbix-agent çš„ç«¯å£ï¼Œæˆ‘ä»¬åœ¨å®¿ä¸»æœºä¸Šåªèƒ½æ˜ å°„å‡ºæ¥ä¸€ä¸ªã€‚<br><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br>1.èµ·å¤šå—ç½‘å¡<br>2.æ¯ä¸ªå®¹å™¨è£…ä¸€ä¸ªzabbix-server<br>3.ä¿®æ”¹ä¸åŒå®¹å™¨çš„agentç«¯å£<br>4.æ˜ å°„å®¹å™¨çš„ç›¸å…³æ–‡ä»¶ï¼Œç„¶åç›‘æ§å®¿ä¸»æœºä¸Šçš„å¯¹åº”æ–‡ä»¶<br>5.ä¸ç”¨zabbix</p><h3 id="2ã€ç›‘æ§è½¯ä»¶çš„ä»‹ç»">2ã€<strong>ç›‘æ§è½¯ä»¶çš„ä»‹ç»</strong></h3><p><em>æœåŠ¡ç«¯</em></p><p>prometheusï¼šç±»ä¼¼äºzabbix-serveræœåŠ¡ç«¯ï¼Œè´Ÿè´£æ”¶é›†å®¢æˆ·ç«¯ç›‘æ§æŒ‡æ ‡(Metrics)</p><p><em>å®¢æˆ·ç«¯</em></p><p>cAdvisorï¼šç±»ä¼¼ zabbix-agent å®¢æˆ·ç«¯ï¼Œç”¨æ¥æ”¶é›†å®¹å™¨é‡Œé¢çš„ç›‘æ§æŒ‡æ ‡<br>node_exporterï¼šç±»ä¼¼ zabbix-agent å®¢æˆ·ç«¯ï¼Œç”¨æ¥æ”¶é›†å®¿ä¸»æœºçš„ç›‘æ§æŒ‡æ ‡</p><p><em>ç»„ä»¶</em></p><p>Grafanaï¼šå‡ºå›¾å·¥å…·</p><p>1ã€cAdvisorä»‹ç»     å‡¯å¾—æ­ªçƒ­å„¿</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cAdvisorä»‹ç»</span><br><span class="line">cAdvisoræ˜¯è°·æ­Œå¼€å‘çš„å®¹å™¨ç›‘æ§å·¥å…·ï¼ŒcAdvisorä¼šæ˜¾ç¤ºå½“å‰hostèµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬CPUã€å†…å­˜ã€ç½‘ç»œã€æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚</span><br><span class="line"></span><br><span class="line">ä¸è¿‡cAdvisoræä¾›çš„æ“ä½œç•Œé¢ç•¥æ˜¾ç®€é™‹ï¼Œè€Œä¸”è¦åœ¨ä¸åŒçš„é¡µé¢ä¹‹é—´è·³è½¬ï¼Œå¹¶ä¸”åªèƒ½ç›‘æ§ä¸€ä¸ªhostï¼Œä¸å…è®©äººè´¨ç–‘å®ƒçš„å®ç”¨æ€§ï¼Œä½†æ˜¯cAdvisoræœ‰ä¸€ä¸ªäº®ç‚¹ï¼Œå°±æ˜¯å°†ç›‘æ§æ•°æ®å¯¼å‡ºç»™å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œè€Œä¸”å®ƒå…¼å®¹å¾ˆå¤šç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå®šä½æˆæ˜¯ä¸€ä¸ª ç›‘æ§æ•°æ®æ”¶é›†å™¨ ï¼Œæ”¶é›†å’Œå¯¼å‡ºæ˜¯å®ƒçš„å¼ºé¡¹ï¼Œè€Œéå±•ç¤º</span><br><span class="line"></span><br><span class="line">dokcer stats å¯ä»¥æŸ¥çœ‹è¿è¡Œçš„ Docker é•œåƒçš„è¿è¡ŒçŠ¶æ€ï¼Œä¾‹å¦‚ï¼šè¿™ç§æ–¹å¼æ¯”è¾ƒåŸå§‹ï¼Œå› ä¸ºä½ æ— æ³•é€šè¿‡http çš„æ–¹å¼æ¥è·å–æ•°æ®ï¼Œè€Œä¸”æ²¡æœ‰ç•Œé¢ï¼Œæ•°æ®å¯è§†åŒ–è¿˜éœ€è¦åšå¤§é‡çš„å·¥ä½œã€‚</span><br><span class="line"></span><br><span class="line">ç”±äº dokcer stats æœ‰è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥ cadvisor è¯ç”Ÿäº†ã€‚ cadvisor ä¸ä»…å¯ä»¥æœé›†ä¸€å°æœºå™¨ä¸Šæ‰€æœ‰è¿è¡Œçš„å®¹å™¨ä¿¡æ¯è¿˜æä¾›åŸºç¡€æŸ¥è¯¢ç•Œé¢å’Œ http æ¥å£ï¼Œæ–¹ä¾¿ Prometheus è¿›è¡Œæ•°æ®æŠ“å–ã€‚</span><br></pre></td></tr></table></figure><p>2ã€grafanaä»‹ç»<br>grafanaæ˜¯ä¸€ä¸ªæ”¯æŒå¤šç§æ•°æ®æºçš„å›¾å½¢å±•ç¤ºå·¥å…·</p><p>3ã€prometheusä»‹ç»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">promethueså®˜ç½‘ï¼šhttps://prometheus.io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">prometheusæ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„ç›‘æ§å·¥å…·ï¼Œæä¾›äº†ç›‘æ§æ•°æ®çš„æ”¶é›†ã€å­˜å‚¨ã€å¤„ç†ã€å¯è§†åŒ–ã€å’Œå‘Šè­¦ç­‰ä¸€ç³»åˆ—å®Œæ•´çš„ç›‘æ§ä½“ç³»ã€‚</span><br><span class="line"></span><br><span class="line">ç»„ä»¶åŒ…å«ï¼š</span><br><span class="line">Node Exporterï¼šè´Ÿè´£æ”¶é›†hostç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿæ•°æ®ï¼Œä»¥å®¹å™¨çš„å½¢å¼è¿è¡Œåœ¨æ‰€æœ‰çš„hostä¸Šã€‚</span><br><span class="line">cAdvisorï¼šè´Ÿè´£æ”¶é›†å®¹å™¨æ•°æ®ï¼Œä»¥å®¹å™¨çš„å½¢å¼è¿è¡Œåœ¨æ‰€æœ‰çš„hostä¸Šã€‚</span><br><span class="line"></span><br><span class="line">zabbixæ˜¯åœ¨å®¢æˆ·ç«¯é…æœåŠ¡ç«¯çš„åœ°å€ï¼Œæ‰€ä»¥æ•°æ®èƒ½ä»å®¢æˆ·ç«¯æ¨é€ç»™æœåŠ¡ç«¯</span><br><span class="line"></span><br><span class="line">prometheusæ•°æ®è·å–çš„æ¥æºï¼š</span><br><span class="line">æœåŠ¡ç«¯é…å®¢æˆ·ç«¯çš„åœ°å€ï¼Œprometheus-serverå»å…¶ä»–å®¢æˆ·ç«¯æ‹‰è¿‡æ¥çš„æ•°æ®ï¼Œåªæœ‰å‘Šè­¦æ˜¯æ¨çš„</span><br><span class="line">è®¾ç½®è§¦å‘å™¨å‡ºç°å‘Šè­¦äº†ï¼Œå‡ºå‘å‘Šè­¦æ–¹å¼ï¼Œæ‰ä¼šæ¨é€æ•°æ®</span><br></pre></td></tr></table></figure><p>æ”¯æŒï¼š<br>1ã€MySQLã€Oracleã€Postgreã€esç­‰æ•°æ®åº“<br>2ã€zabbixã€prometheusç­‰ç›‘æ§ç³»ç»Ÿ</p><h3 id="3ã€Prometheusæ¶æ„">3ã€<strong>Prometheusæ¶æ„</strong></h3><p><img src="../image/study_img/image-20240911085025512.png" alt="image-20240911085025512"></p><p>TSDBï¼šæ—¶åºæ•°æ®åº“ï¼Œå’Œæ—¶é—´è½´æœ‰å…³çš„</p><p>influxDBï¼šæ—¶åºæ•°æ®åº“</p><h3 id="4ã€éƒ¨ç½²Prometheus">4ã€<strong>éƒ¨ç½²Prometheus</strong></h3><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th><th>åº”ç”¨</th></tr></thead><tbody><tr><td>docker01</td><td>10.0.0.101  /  172.16.1.101</td><td>è¢«ç›‘æ§ç«¯</td><td>cadvisorã€node_exporter</td></tr><tr><td>docker02</td><td>10.0.0.102  /  172.16.1.102</td><td>è¢«ç›‘æ§ç«¯</td><td>cadvisorã€node_exporter</td></tr><tr><td>docker03</td><td>10.0.0.103  /  172.16.1.103</td><td>è¢«ç›‘æ§ç«¯</td><td>cadvisorã€node_exporter</td></tr><tr><td>elk01</td><td>10.0.0.76  /  172.16.1.76</td><td>ç›‘æ§ç«¯ã€æœåŠ¡ç«¯</td><td>prometheusã€grafanaã€cadvisor</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## docker runå‘½ä»¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨node-exporter</span></span><br><span class="line">docker run -d -p 9100:9100 -v <span class="string">&quot;/:/host:ro,rslave&quot;</span> --name=node_exporter</span><br><span class="line">quay.io/prometheus/node-exporter --path.rootfs /host</span><br><span class="line"></span><br><span class="line">-v <span class="string">&quot;/:/hostï¼šç›¸å½“äºç›‘æ§å®¿ä¸»æœº</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># å¯åŠ¨cadvisor</span></span><br><span class="line"><span class="string">docker run --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --</span></span><br><span class="line"><span class="string">volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro -p 8080:8080 -d --name=cadvisor google/cadvisor:latest</span></span><br></pre></td></tr></table></figure><p>1ã€elkæœºå™¨ éƒ¨ç½²docker compose</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">1ã€å‡†å¤‡å·¥ä½œç›®å½•</span><br><span class="line">[root@elk1 ~]# <span class="built_in">mkdir</span> prometheus &amp;&amp; <span class="built_in">cd</span> prometheus/</span><br><span class="line"></span><br><span class="line">2ã€å‡†å¤‡promethuesé…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk1 prometheus]# vim prometheus.yml</span><br><span class="line">scrape_configs:</span><br><span class="line">- job_name: cadvisor</span><br><span class="line">  scrape_interval: 5s</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets:</span><br><span class="line">    - 10.0.0.101:8080</span><br><span class="line">    - 10.0.0.102:8080</span><br><span class="line">    - 10.0.0.103:8080</span><br><span class="line"></span><br><span class="line">- job_name: prometheus</span><br><span class="line">  scrape_interval: 5s</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets:</span><br><span class="line">    - 10.0.0.76:9090</span><br><span class="line"></span><br><span class="line">- job_name: node_exporter</span><br><span class="line">  scrape_interval: 5s</span><br><span class="line">  static_configs:</span><br><span class="line">  - targets:</span><br><span class="line">    - 10.0.0.101:9100</span><br><span class="line">    - 10.0.0.102:9100</span><br><span class="line">    - 10.0.0.103:9100</span><br><span class="line"></span><br><span class="line">3ã€ç¼–å†™docker-compose</span><br><span class="line">[root@elk1 prometheus]# vim pro-docker-compose.yml </span><br><span class="line">version: <span class="string">&#x27;3.2&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  prometheus:</span><br><span class="line">    image: prom/prometheus:latest</span><br><span class="line">    container_name: prometheus</span><br><span class="line">    ports:</span><br><span class="line">      - 9090:9090</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - --config.file=/etc/prometheus/prometheus.yml</span><br><span class="line">    volumes:</span><br><span class="line">      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro</span><br><span class="line">    restart: always</span><br><span class="line">    </span><br><span class="line">  grafana:</span><br><span class="line">    image: grafana/grafana:latest</span><br><span class="line">    container_name: grafana</span><br><span class="line">    ports:</span><br><span class="line">      - 3000:3000</span><br><span class="line">    restart: always</span><br><span class="line">    </span><br><span class="line">  cadvisor:</span><br><span class="line">    image: google/cadvisor:latest</span><br><span class="line">    container_name: cadvisor</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:8080</span><br><span class="line">    volumes:</span><br><span class="line">      - /:/rootfs:ro</span><br><span class="line">      - /var/run:/var/run:rw</span><br><span class="line">      - /sys:/sys:ro</span><br><span class="line">      - /var/lib/docker:/var/lib/docker:ro</span><br><span class="line">    restart: always</span><br><span class="line">      </span><br><span class="line">  node-exporter:</span><br><span class="line">    image: prom/node-exporter:latest</span><br><span class="line">    container_name: node_exporter</span><br><span class="line">    ports:</span><br><span class="line">      - 9100:9100</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">[root@elk1 promethenus]# docker-compose -f pro-docker-compose.yml up -d</span><br></pre></td></tr></table></figure><p>2ã€docker01 02 03</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 node]# <span class="built_in">mkdir</span> node &amp;&amp; <span class="built_in">cd</span> node</span><br><span class="line">[root@docker01 node]# vim node-docker-compose.yml </span><br><span class="line">version: <span class="string">&#x27;3.2&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  node-exporter:</span><br><span class="line">    image: prom/node-exporter:latest</span><br><span class="line">    container_name: node_exporter</span><br><span class="line">    ports:</span><br><span class="line">      - 9100:9100</span><br><span class="line">    restart: always</span><br><span class="line">    </span><br><span class="line">  cadvisor:</span><br><span class="line">    image: google/cadvisor:latest</span><br><span class="line">    container_name: cadvisor</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:8080</span><br><span class="line">    volumes:</span><br><span class="line">      - /:/rootfs:ro</span><br><span class="line">      - /var/run:/var/run:rw</span><br><span class="line">      - /sys:/sys:ro</span><br><span class="line">      - /var/lib/docker:/var/lib/docker:ro</span><br><span class="line">    restart: always</span><br><span class="line">    </span><br><span class="line">[root@docker02 node]# docker-compose -f node-docker-compose.yml up</span><br></pre></td></tr></table></figure><p>3ã€è®¿é—®ç½‘é¡µ 10.0.0.76:9090ï¼Œå¯ä»¥çœ‹åˆ°ç›‘æ§çš„å…¶ä»–å®¢æˆ·ç«¯</p><p><img src="../image/study_img/image-20240911093304356.png" alt="image-20240911093304356"></p><p><img src="../image/study_img/image-20240911163131170.png" alt="image-20240911163131170"></p><p>æ”¶é›†åˆ°çš„æ•°æ®æŒ‡æ ‡æ˜¯Key:valueçš„æ ¼å¼</p><p>æ•°æ®æŸ¥è¯¢æ“ä½œ</p><p><img src="../image/study_img/image-20240911163606439.png" alt="image-20240911163606439"></p><p><img src="../image/study_img/image-20240911163702757.png" alt="image-20240911163702757"></p><p>å¦‚æœåªæƒ³çœ‹101çš„æ•°æ®  ï¼š  å°±ç”¨{ }èŠ±æ‹¬å·é‡Œé¢å†™æƒ³è¦æŸ¥çœ‹çš„å­—æ®µ  èŠ±æ‹¬å·é‡Œé¢çš„å­—æ®µç›¸å½“äºè¿‡æ»¤</p><p><img src="../image/study_img/image-20240911170150515.png" alt="image-20240911170150515"></p><p>4ã€è®¿é—®cadvisoré¡µé¢ 10.0.0.101:8080</p><p><img src="../image/study_img/image-20240911165134739.png" alt="image-20240911165134739"></p><p><img src="../image/study_img/image-20240911165240850.png" alt="image-20240911165240850"></p><p><img src="../image/study_img/image-20240911165311636.png" alt="image-20240911165311636"></p><p>5ã€grafanaæ¨¡ç‰ˆå‡ºå›¾</p><p>ç™»å½•è‡ªå·±æ­å»ºçš„grafana ï¼š10.0.0.76:3000/</p><p><img src="../image/study_img/image-20240911160356809.png" alt="image-20240911160356809"></p><p>è¿›å…¥grafanaå®˜ç½‘ï¼š<a href="https://grafana.com/">https://grafana.com/</a>     è¿›å…¥å®˜ç½‘é¦–é¡µï¼Œæ¥åˆ°é¦–é¡µçš„é¡µé¢æœ€åº•ä¸‹</p><p><img src="../image/study_img/image-20240911170835247.png" alt="image-20240911170835247"></p><p><img src="../image/study_img/image-20240911171206521.png" alt="image-20240911171206521"></p><p>é€‰æ‹©ä¸€ä¸ªè‡ªå·±æƒ³è¦çš„æ¨¡ç‰ˆç‚¹å‡»è¿›å»ï¼Œè‡ªåŠ¨ä»–çš„IDï¼Œä¹‹åæ·»åŠ </p><p><img src="../image/study_img/image-20240911171354848.png" alt="image-20240911171354848"></p><p>â‘ ã€å›åˆ°è‡ªå·±æ­å»ºçš„grafana</p><p><img src="../image/study_img/image-20240911171850344.png" alt="image-20240911171850344"></p><p>â‘¡ã€æ‰¾åˆ°prometheusçš„å›¾æ ‡ï¼ŒåŒå‡»è¿›å»ï¼Œæ·»åŠ prometheusçš„URL,ç„¶åç‚¹å‡»æœ€ä¸‹é¢çš„save &amp; test  å¯çœ‹åˆ°Successfullyæ·»åŠ æˆåŠŸçš„ä¿¡æ¯</p><p><img src="../image/study_img/image-20240911172651580.png" alt="image-20240911172651580"></p><p>â‘¢æµ‹è¯•ï¼š  å†ç‚¹å‡»å·¦è¾¹çš„æ•°æ®æºæ  å¯çœ‹åˆ°æ·»åŠ æˆåŠŸï¼Œä¹‹åæ·»åŠ æ¨¡ç‰ˆ</p><p><img src="../image/study_img/image-20240911173117487.png" alt="image-20240911173117487"></p><p><img src="../image/study_img/image-20240911173228995.png" alt="image-20240911173228995"></p><p><img src="../image/study_img/image-20240911173445043.png" alt="image-20240911173445043"></p><p>æ¨¡ç‰ˆé‡Œé¢å¯ä»¥ç‚¹å‡»è¿›å»çœ‹çœ‹ï¼Œæœ‰çš„æœ‰æ•°æ®ï¼Œæœ‰çš„æ²¡æœ‰æ•°æ®</p><p><img src="../image/study_img/image-20240911173624110.png" alt="image-20240911173624110"></p><p>å…¶å®å¯ä»¥æŠŠåˆšåˆšæ·»åŠ çš„3ä¸ªæ¨¡ç‰ˆåˆ é™¤ï¼Œå› ä¸ºä¸æ˜¯æˆ‘éœ€è¦çš„ï¼Œæ¥ä¸‹æ¥ä¼šæ·»åŠ éœ€è¦çš„æ¨¡ç‰ˆ</p><p>â‘£ã€æ·»åŠ cAdcisorçš„æ¨¡ç‰ˆ</p><p><img src="../image/study_img/image-20240911174519155.png" alt="image-20240911174519155"></p><p>8919    11277  è¿™ä¸¤ä¸ªIDæ¯”è¾ƒå¸¸ç”¨</p><p><img src="../image/study_img/image-20240911174945815.png" alt="image-20240911174945815"></p><p><img src="../image/study_img/image-20240911175011030.png" alt="image-20240911175011030"></p><p><img src="../image/study_img/image-20240911175141393.png" alt="image-20240911175141393"></p><p>å¯ä»¥çœ‹åˆ°æ•°æ®ï¼Œä½†æ˜¯ç›®å‰é»˜è®¤æ˜¯çœ‹101çš„æ•°æ®ï¼Œé¡¹ç›®å’Œä¸»æœºéƒ½æ˜¯ç©ºçš„ï¼Œæƒ³çœ‹æŒ‡å®šä¸»æœºçš„æ•°æ®æ²¡æœ‰ï¼Œæ‰€ä»¥éœ€è¦æ”¹æ¨¡ç‰ˆ</p><p><img src="../image/study_img/image-20240911175238626.png" alt="image-20240911175238626"></p><p><em>6ã€ä¿®æ”¹æ¨¡ç‰ˆ</em></p><p>éœ€è¦ä½¿ç”¨prometheusæŸ¥è¯¢æ•°æ®çš„è¯­å¥ ï¼špromeQL</p><p><img src="../image/study_img/image-20240911181443564.png" alt="image-20240911181443564"></p><p><img src="../image/study_img/image-20240911181734944.png" alt="image-20240911181734944"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1ã€project</span><br><span class="line">label_values(container_last_seen, project)</span><br><span class="line"></span><br><span class="line">2ã€server</span><br><span class="line">label_values(container_last_seen&#123;project=~<span class="string">&quot;<span class="variable">$project</span>&quot;</span>&#125;, server)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€instance</span><br><span class="line">label_values(container_last_seen&#123;project=~<span class="string">&quot;<span class="variable">$project</span>&quot;</span>,server=~<span class="string">&quot;<span class="variable">$server</span>&quot;</span>&#125;, instance)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1ã€project</span><br><span class="line">label_values(container_last_seen, project)</span><br><span class="line">è·å–çš„æ˜¯container_last_seené‡Œé¢çš„projectï¼Œå»prometheusé‡Œé¢å»æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰è¿™ä¸ªå€¼</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240911192227950.png" alt="image-20240911192227950"></p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªç‰ˆæœ¬çš„projecté¡¹ç›®åå«jobï¼Œæ‰€ä»¥projectåº”è¯¥æ”¹æˆjob</p><p><img src="../image/study_img/image-20240911194340683.png" alt="image-20240911194340683"></p><p>æŠŠprojectä¿®æ”¹æˆjobæˆåŠŸ</p><p><img src="../image/study_img/image-20240911194429236.png" alt="image-20240911194429236"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2ã€server</span><br><span class="line">label_values(container_last_seen&#123;project=~<span class="string">&quot;<span class="variable">$project</span>&quot;</span>&#125;, server)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢åªè¦instanceå’Œjob,æ²¡æœ‰server,æ‰€ä»¥æŠŠserveråˆ é™¤</p><p><img src="../image/study_img/image-20240911194700416.png" alt="image-20240911194700416"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3ã€instance</span><br><span class="line">label_values(container_last_seen&#123;project=~<span class="string">&quot;<span class="variable">$project</span>&quot;</span>,server=~<span class="string">&quot;<span class="variable">$server</span>&quot;</span>&#125;, instance)</span><br><span class="line">serveræ²¡æœ‰ï¼Œä¸è¦ï¼Œå¯ä»¥åˆ é™¤</span><br><span class="line"></span><br><span class="line">label_values(container_last_seen&#123;job=~<span class="string">&quot;<span class="variable">$project</span>&quot;</span>&#125;, instance)</span><br><span class="line"></span><br><span class="line"><span class="variable">$project</span>è¿™ä¸ªè¡¨ç¤ºè·å–projecté‡Œé¢çš„å˜é‡</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240911200218534.png" alt="image-20240911200218534"></p><p><img src="../image/study_img/image-20240911195320041.png" alt="image-20240911195320041"></p><p>ä¿®æ”¹å®Œæˆï¼Œä¿å­˜</p><p><img src="../image/study_img/image-20240911195411815.png" alt="image-20240911195411815"></p><p><img src="../image/study_img/image-20240911200333043.png" alt="image-20240911200333043"></p><p>æŸ¥çœ‹æ²¡æœ‰æ•°æ®ï¼Œæ·»åŠ æ•°æ®</p><p><img src="../image/study_img/image-20240911200507280.png" alt="image-20240911200507280"></p><p><img src="../image/study_img/image-20240911200625330.png" alt="image-20240911200625330"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">count(container_last_seen&#123;project=~<span class="string">&quot;<span class="variable">$project</span>&quot;</span>,instance=~<span class="string">&quot;<span class="variable">$instance</span>&quot;</span>,image!=<span class="string">&quot;&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">æŠŠå˜é‡å’Œjobæ¢ä¸€ä¸‹</span><br><span class="line">count(container_last_seen&#123;job=~<span class="string">&quot;cadvisor&quot;</span>,instance=~<span class="string">&quot;10.0.0.101:8080&quot;</span>,image!=<span class="string">&quot;&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥è·å–åˆ°æ•°æ®</p><p><img src="../image/study_img/image-20240911200945018.png" alt="image-20240911200945018"></p><p><img src="../image/study_img/image-20240911201650404.png" alt="image-20240911201650404"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å› ä¸ºprometheusé‡Œé¢æŸ¥å‡ºæ¥çš„æ²¡æœ‰projectæ ‡ç­¾ï¼Œåªæœ‰jobæ ‡ç­¾</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">container_last_seen&#123;<span class="built_in">id</span>=<span class="string">&quot;/&quot;</span>, instance=<span class="string">&quot;10.0.0.101:8080&quot;</span>, job=<span class="string">&quot;cadvisor&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰åªæ”¹äº†ä¸€ä¸ªæ•°æ®ï¼Œä½†æ˜¯ä¸å¯èƒ½ä¸€ä¸ªä¸€ä¸ªå»ä¿®æ”¹ï¼Œæ‰€ä»¥éœ€è¦æ‰¹é‡ä¿®æ”¹</p><p><img src="../image/study_img/image-20240911201813116.png" alt="image-20240911201813116"></p><p>è¿™ä¸ªjsonæ–‡ä»¶å°±æ˜¯æ¨¡ç‰ˆï¼Œä½†å¾€ä¸‹çœ‹ï¼Œè¿™ä¸ªjsonæ–‡ä»¶é‡Œé¢è¿˜æ˜¯projectï¼Œå¯ä»¥å¤åˆ¶å‡ºæ¥ï¼Œæ‰¹é‡æ›¿æ¢æˆjob</p><p><img src="../image/study_img/image-20240911201937730.png" alt="image-20240911201937730"></p><p><img src="../image/study_img/image-20240911202129508.png" alt="image-20240911202129508"></p><p>æŠŠæ›¿æ¢åçš„jsonæ–‡ä»¶ç²˜è´´</p><p><img src="../image/study_img/image-20240911202309412.png" alt="image-20240911202309412"></p><p>ä¿å­˜ä¹‹åï¼Œé‡æ–°è¿›å…¥ï¼ŒæŸ¥çœ‹æ•°æ®</p><p><img src="../image/study_img/image-20240911202434264.png" alt="image-20240911202434264"></p><p><img src="../image/study_img/image-20240911202449993.png" alt="image-20240911202449993"></p><p>â‘¤ã€æ·»åŠ node_exporterçš„æ¨¡ç‰ˆ</p><p>åœ¨å®˜ç½‘æœç´¢æ¨¡ç‰ˆID</p><p><img src="../image/study_img/image-20240911215221833.png" alt="image-20240911215221833"></p><p><img src="../image/study_img/image-20240911215237958.png" alt="image-20240911215237958"></p><p>å›åˆ°è‡ªå·±å®‰è£…çš„grafanaï¼Œæ·»åŠ æ¨¡ç‰ˆ</p><p><img src="../image/study_img/image-20240911215341094.png" alt="image-20240911215341094"></p><p><img src="../image/study_img/image-20240911215432195.png" alt="image-20240911215432195"></p><p><img src="../image/study_img/image-20240911215458213.png" alt="image-20240911215458213"></p><p>æ•°æ®ç”Ÿæˆ</p><p><img src="../image/study_img/image-20240911215516206.png" alt="image-20240911215516206"></p><p><img src="../image/study_img/image-20240911215800737.png" alt="image-20240911215800737"></p><p><img src="../image/study_img/image-20240911215816266.png" alt="image-20240911215816266"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node_filesystem_size_bytes&#123;instance=<span class="string">&quot;<span class="variable">$node</span>&quot;</span>,job=<span class="string">&quot;<span class="variable">$job</span>&quot;</span>,mountpoint=<span class="string">&quot;/&quot;</span>,fstype!=<span class="string">&quot;rootfs&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">æƒ³è¦å±•ç¤ºæ•°æ®å°±æŠŠ,fstype!=<span class="string">&quot;rootfs&quot;</span>åˆ æ‰</span><br><span class="line">node_filesystem_size_bytes&#123;instance=<span class="string">&quot;<span class="variable">$node</span>&quot;</span>,job=<span class="string">&quot;<span class="variable">$job</span>&quot;</span>,mountpoint=<span class="string">&quot;/&quot;</span>,fstype!=<span class="string">&quot;rootfs&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240911215845909.png" alt="image-20240911215845909"></p><p>æƒ³è¦å±•ç¤ºæ•°æ®å°±æŠŠ,fstype!=&quot;rootfs&quot;åˆ æ‰</p><p><img src="../image/study_img/image-20240911220402516.png" alt="image-20240911220402516"></p><p><img src="../image/study_img/image-20240911220531172.png" alt="image-20240911220531172"></p><p>å†æŸ¥çœ‹æ²¡æ•°æ®çš„æ¡†ï¼ŒæŸ¥çœ‹æ²¡æ•°æ®çš„åŸå› ï¼Œå¹¶ä¿®æ”¹</p><p><img src="../image/study_img/image-20240911220656392.png" alt="image-20240911220656392"></p><p>æ— æ³•æŸ¥è¯¢æ•°æ®ï¼ŒCPUæ²¡æœ‰ç­‰å¾…æ—¶é—´ï¼ŒæŸ¥è¯¢ä¸å‡ºæ•°æ®ï¼Œæ‰€ä»¥æ²¡æœ‰æ•°æ®æ²¡å…³ç³»</p><p><img src="../image/study_img/image-20240911221251157.png" alt="image-20240911221251157"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irate(node_pressure_cpu_waiting_seconds_total&#123;instance=<span class="string">&quot;<span class="variable">$node</span>&quot;</span>,job=<span class="string">&quot;<span class="variable">$job</span>&quot;</span>&#125;[<span class="variable">$__rate_interval</span>])</span><br></pre></td></tr></table></figure><p>å†ç»§ç»­æ’æŸ¥ä¸‹ä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„åŸå› ï¼Œå¹¶ä¿®æ”¹</p><p><img src="../image/study_img/image-20240911221454957.png" alt="image-20240911221454957"></p><p><img src="../image/study_img/image-20240911221632432.png" alt="image-20240911221632432"></p><p><img src="../image/study_img/image-20240911222204013.png" alt="image-20240911222204013"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ²¡æœ‰æ•°æ®å°±å»prometheusé‡Œé¢æŸ¥ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰ç›¸å…³å­—æ®µ</span><br><span class="line"></span><br><span class="line">æ¯”è¾ƒå¥½ç”¨çš„æ¨¡ç‰ˆæœ‰</span><br><span class="line">11277</span><br><span class="line">8919</span><br></pre></td></tr></table></figure><p>8919çš„æ¨¡ç‰ˆå›¾</p><p><img src="../image/study_img/image-20240911224138667.png" alt="image-20240911224138667"></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡ä¹ã€dockerçš„èµ„æºé™åˆ¶</title>
      <link href="/posts/79ab352e.html"/>
      <url>/posts/79ab352e.html</url>
      
        <content type="html"><![CDATA[<h2 id="dockerçš„èµ„æºé™åˆ¶">dockerçš„èµ„æºé™åˆ¶</h2><h3 id="1ã€dockerèµ„æºé™åˆ¶ä»‹ç»"><strong>1ã€dockerèµ„æºé™åˆ¶ä»‹ç»</strong></h3><p>å®˜ç½‘ï¼š <a href="https://docs.docker.com/engine/containers/resource_constraints/">https://docs.docker.com/engine/containers/resource_constraints/</a></p><p>å¸¦æœ‰å†…å­˜ã€CPU å’Œ GPU çš„è¿è¡Œæ—¶é€‰é¡¹<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨æ²¡æœ‰èµ„æºé™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸»æœºå†…æ ¸è°ƒåº¦ç¨‹åºå…è®¸çš„å°½å¯èƒ½å¤šçš„ç»™å®šèµ„æºã€‚Docker æä¾›äº†æ§åˆ¶å®¹å™¨å¯ä»¥ä½¿ç”¨å¤šå°‘å†…å­˜æˆ– CPU çš„æ–¹æ³•ï¼Œè®¾ç½®docker runå‘½ä»¤çš„è¿è¡Œæ—¶é…ç½®æ ‡å¿—ã€‚æœ¬èŠ‚æä¾›æœ‰å…³ä½•æ—¶åº”è¯¥è®¾ç½®æ­¤ç±»é™åˆ¶ä»¥åŠè®¾ç½®è¿™äº›é™åˆ¶çš„å¯èƒ½å½±å“çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>å…¶ä¸­è®¸å¤šåŠŸèƒ½éœ€è¦æ‚¨çš„å†…æ ¸æ”¯æŒ Linux åŠŸèƒ½ã€‚è¦æ£€æŸ¥æ”¯æŒï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥ docker infoå‘½ä»¤ã€‚å¦‚æœæ‚¨çš„å†…æ ¸ä¸­ç¦ç”¨äº†æŸä¸ªåŠŸèƒ½ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨è¾“å‡ºçš„æœ«å°¾çœ‹åˆ°å¦‚ä¸‹è­¦å‘Šï¼š<br>WARNING: no swap limit support</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é˜¿é‡Œäº‘ä¸Šé¢æ²¡æœ‰swapç©ºé—´ï¼Œå› ä¸ºswapæ˜¯è™šæ‹Ÿçš„ï¼Œé˜¿é‡Œäº‘ä¹Ÿæ˜¯è™šæ‹Ÿçš„</span><br><span class="line">docker k8séƒ½ä¸è¦æswap,æœ¬æ¥å°±æ˜¯è™šæ‹ŸåŒ–çš„äº§å“ï¼ŒæŠŠè™šæ‹Ÿç£ç›˜å†å˜æˆè™šæ‹Ÿå†…å­˜ï¼Œæ€§èƒ½æ›´ä½</span><br><span class="line"></span><br><span class="line">å½“ç£ç›˜è¢«æ²¾æ»¡äº†ï¼Œä¼šå†…å­˜æº¢å‡ºï¼Œä¼šå¯åŠ¨OOM <span class="built_in">kill</span>,ä¼šæ€è¿›ç¨‹</span><br></pre></td></tr></table></figure><h4 id="Dokcerå†…å­˜é™åˆ¶"><strong>Dokcerå†…å­˜é™åˆ¶</strong></h4><p>Dockeré™åˆ¶å†…å­˜çš„ç›¸å…³å‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‹‰å–å‹æµ‹å·¥å…·çš„é•œåƒ</span><br><span class="line">[root@docker03 ~]# docker pull akarshes/docker-stress-ng:latest</span><br><span class="line"></span><br><span class="line">2ã€# å†…å­˜é™åˆ¶æµ‹è¯•</span><br><span class="line"><span class="comment"># æ²¡æœ‰å†…å­˜é™åˆ¶</span></span><br><span class="line">[root@docker02 ~]# docker run --name mem_test -it --<span class="built_in">rm</span> akarshes/docker-stress-ng --vm 8</span><br><span class="line">[root@docker03 ~]# docker stats</span><br><span class="line">CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT     MEM %     NET I/O         BLOCK I/O         PIDS</span><br><span class="line">9450d02cb9a1   mem_test          234.65%   2.006GiB / 2.885GiB   69.55%    586B / 0B       5.55MB / 0B       17</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹å®¹å™¨åšèµ„æºé™åˆ¶</span></span><br><span class="line">[root@docker03 ~]# docker run --name mem_test -it --<span class="built_in">rm</span>  -m 200m akarshes/docker-stress-ng --vm 8</span><br><span class="line">[root@docker03 ~]# docker stats</span><br><span class="line">CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT     MEM %     NET I/O          BLOCK I/O         PIDS</span><br><span class="line">7870345de325   mem_test          136.94%   193.2MiB / 200MiB     96.59%    656B / 0B        59.7MB / 7.41GB   15</span><br><span class="line"></span><br><span class="line">-mï¼šå…è®¸å®¹å™¨ä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼Œå•ä½ï¼škã€mã€g</span><br><span class="line">--oom-kill-disable</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©</span></span><br><span class="line">docker run --name mem_test -it --<span class="built_in">rm</span> akarshes/docker-stress-ng --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Example: stress-ng --cpu 8 --io 4 --vm 2 --vm-bytes 128M --fork 4 --<span class="built_in">timeout</span> 10s</span><br></pre></td></tr></table></figure><h4 id="Dokceré™åˆ¶CPU"><strong>Dokceré™åˆ¶CPU</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ²¡åšCPUé™åˆ¶</span></span><br><span class="line">[root@docker02 ~]# docker run --name mem_test -it --<span class="built_in">rm</span> akarshes/docker-stress-ng --cpu 4</span><br><span class="line">[root@docker03 ~]# docker stats</span><br><span class="line">CONTAINER ID   NAME              CPU %     MEM USAGE / LIMIT     MEM %     NET I/O         BLOCK I/O         PIDS</span><br><span class="line">3c74f649be1e   mem_test          214.19%   25.6MiB / 2.885GiB    0.87%     656B / 0B       0B / 0B           9</span><br><span class="line"><span class="comment">#cpuæ•°æ®ä¸€ç›´å¢åŠ ï¼Œåœ¨è¶…è½½</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é™åˆ¶CPU</span></span><br><span class="line">[root@docker02 ~]# docker run --name mem_test -it --<span class="built_in">rm</span> --cpus 0.5 akarshes/docker-stress-ng -cpu 8</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬èµ„æºé™åˆ¶ä¸æ˜¯ç›®çš„ï¼Œç›®çš„æ˜¯æˆ‘ä»¬è¦éšæ—¶ç›‘æ§åˆ°æˆ‘ä»¬çš„èµ„æºï¼Œèƒ½çœ‹åˆ°å®¹å™¨å¯¹å®¿ä¸»æœºèµ„æºçš„ä½¿ç”¨ï¼Œæ‰èƒ½æ›´å¥½çš„åšé™åˆ¶ï¼Œä¸è¦ç›²ç›®é™åˆ¶ï¼Œä¸çŸ¥é“èµ„æºä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œå°±å¯¹å®¹å™¨èµ„æºé™åˆ¶ï¼Œæ˜¯å¾ˆå±é™©çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å¯¹å®¹å™¨è¿›è¡Œç›‘æ§ï¼Œå¦‚æœä¸ç›‘æ§ã€‚å®¹å™¨è¶…è½½äº†å°±ä¼šå‡ºç°OMMå†…å­˜æº¢å‡ºï¼Œæ€è¿›ç¨‹çš„æƒ…å†µ</p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡å…«ã€dockerå®¹å™¨è·¨ä¸»æœºé€šä¿¡</title>
      <link href="/posts/f36f1204.html"/>
      <url>/posts/f36f1204.html</url>
      
        <content type="html"><![CDATA[<h2 id="dockerå®¹å™¨è·¨ä¸»æœºé€šä¿¡">dockerå®¹å™¨è·¨ä¸»æœºé€šä¿¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">èµ·é‚£ä¹ˆå¤šå°dockerï¼Œæƒ³åšé›†ç¾¤ï¼Œå°±è¦è®©å®¹å™¨ä¹‹é—´äº’ç›¸é€šä¿¡ï¼Œç„¶ååšæˆä¸€ä¸ªæ¶æ„</span><br><span class="line"></span><br><span class="line"><span class="comment">#docker-composå¤šæœºç¼–æ’ï¼Œéœ€è¦é…åˆdocker-swarm</span></span><br><span class="line"></span><br><span class="line">ç°åœ¨èµ·ä¸€ä¸ªå®¹å™¨è‡ªå·±å†³å®šèµ·åœ¨å“ªä¸€å°ä¸Šï¼Œæ²¡æœ‰å¯¹è¿™å°çš„èµ„æºè¿›è¡Œè®¡ç®—</span><br><span class="line">å¤šæœºç¼–æ’å·¥å…·å¯ä»¥è®¡ç®—å“ªå°æœºå™¨é€‚åˆæŠŠæœåŠ¡èµ·åœ¨å“ªå°æœºå™¨</span><br></pre></td></tr></table></figure><p><strong>Dockerè·¨ä¸»æœºç½‘ç»œç±»å‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1ã€é™æ€è·¯ç”±</span><br><span class="line">2ã€flannel (k8sé‡Œé¢ç”¨çš„æ¯”è¾ƒå¤š)</span><br><span class="line">3ã€overlay</span><br><span class="line">4ã€macvlan</span><br><span class="line">5ã€calico</span><br></pre></td></tr></table></figure><h3 id="1ã€é™æ€è·¯ç”±æ¨¡å¼"><strong>1ã€é™æ€è·¯ç”±æ¨¡å¼</strong></h3><p><img src="C:%5CUsers%5CMac%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240910090901456.png" alt="image-20240910090901456"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">é™æ€è·¯ç”±åšèµ·æ¥ç®€å•ï¼Œä½†æ˜¯é˜¿é‡Œäº‘ä¸è®©æ·»åŠ è·¯ç”±</span><br><span class="line"></span><br><span class="line">1. æ·»åŠ ä¸€æ¡åˆ°è¾¾ç½‘ç»œ192.168.1.0/24çš„è·¯ç”±ï¼Œç½‘å…³ä¸º192.168.0.1ï¼Œè·ç¦»å€¼ä¸º10ï¼š</span><br><span class="line">route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.0.1 metric 10</span><br><span class="line"></span><br><span class="line">2. æ·»åŠ ä¸€æ¡åˆ°è¾¾ä¸»æœº192.168.1.100çš„è·¯ç”±ï¼Œç½‘å…³ä¸º192.168.0.1ï¼š</span><br><span class="line">route add -host 192.168.1.100 gw 192.168.0.1</span><br><span class="line"></span><br><span class="line">3. æ·»åŠ ä¸€æ¡åˆ°è¾¾ç½‘ç»œ192.168.0.0/16çš„è·¯ç”±ï¼Œç½‘å…³ä¸º192.168.1.1ï¼Œè·ç¦»å€¼ä¸º20ï¼Œç»è¿‡eth0æ¥å£ï¼š</span><br><span class="line">route add -net 192.168.0.0 netmask 255.255.0.0 gw 192.168.1.1 metric 20 dev eth0</span><br></pre></td></tr></table></figure><p>2ã€flannel (k8sé‡Œé¢ç”¨çš„æ¯”è¾ƒå¤š)</p><p><img src="C:%5CUsers%5CMac%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240910091610337.png" alt="image-20240910091610337"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flannelå›¾å½¢åŒ–ç•Œé¢éœ€è¦é…ç½®è¯ä¹¦</span><br></pre></td></tr></table></figure><h3 id="2ã€flanneç½‘ç»œæ¨¡å¼çš„éƒ¨ç½²"><strong>2ã€flanneç½‘ç»œæ¨¡å¼çš„éƒ¨ç½²</strong></h3><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th><th>åº”ç”¨</th></tr></thead><tbody><tr><td>docker01</td><td>10.0.0.101  /  172.16.1.101</td><td>äº’ç›¸é€šä¿¡çš„å®¹å™¨</td><td>flanne</td></tr><tr><td>docker02</td><td>10.0.0.102  /  172.16.1.102</td><td>äº’ç›¸é€šä¿¡çš„å®¹å™¨</td><td>flanne</td></tr><tr><td>docker03</td><td>10.0.0.103  /  172.16.1.103</td><td>äº’ç›¸é€šä¿¡çš„å®¹å™¨</td><td>flanne</td></tr><tr><td>elk01</td><td>10.0.0.76  /  172.16.1.76</td><td>å‚¨å­˜æ•°æ®çš„ä¸­ä»‹</td><td>ETCD</td></tr></tbody></table><p>1ã€éƒ¨ç½²ETCD</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…etcd</span><br><span class="line">[root@elk1 ~]# yum -y install etcd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ä¿®æ”¹etcdé…ç½®æ–‡ä»¶</span><br><span class="line">[root@elk1 ~]# vim /etc/etcd/etcd.conf </span><br><span class="line"><span class="comment"># [member]</span></span><br><span class="line">ETCD_NAME=default</span><br><span class="line">ETCD_DATA_DIR=<span class="string">&quot;/var/lib/etcd/default.etcd&quot;</span></span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=<span class="string">&quot;http://172.16.1.76:2379,http://127.0.0.1:2379&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [cluster]</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=<span class="string">&quot;new&quot;</span></span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=<span class="string">&quot;etcd-cluster&quot;</span></span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=<span class="string">&quot;http://172.16.1.76:2379&quot;</span></span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨etcdå¹¶åŠ å…¥å¼€æœºè‡ªå¯</span><br><span class="line">[root@elk1 ~]# systemctl start etcd</span><br><span class="line">[root@elk1 ~]# systemctl <span class="built_in">enable</span> etcd</span><br><span class="line">æŸ¥çœ‹ç«¯å£ 2380æ˜¯å›¾å½¢åŒ–ç•Œé¢è¿æ¥çš„ç«¯å£</span><br></pre></td></tr></table></figure><p>ETCDçš„åŸºç¡€æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-c  è°ƒæ¥å£</span><br><span class="line"></span><br><span class="line">1ã€æ£€æŸ¥é›†ç¾¤çš„å¥åº·çŠ¶æ€</span><br><span class="line">[root@elk1 ~]# etcdctl -C http://127.0.0.1:2379 cluster-health</span><br><span class="line"></span><br><span class="line">2ã€å†™å…¥æ•°æ®</span><br><span class="line">[root@elk1 ~]# etcdctl -C http://127.0.0.1:2379 <span class="built_in">set</span> /testdir/testkey <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹æ•°æ®</span><br><span class="line">[root@elk1 ~]# etcdctl -C http://127.0.0.1:2379 get /testdir/testkey </span><br></pre></td></tr></table></figure><p>2ã€3å°æœºå™¨å®‰è£…é…ç½®flannel</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1ã€3å°æœºå™¨å®‰è£…flannel</span><br><span class="line">[root@docker01 ~]# yum -y install flannel</span><br><span class="line">[root@docker02 ~]# yum -y install flannel</span><br><span class="line">[root@docker02 ~]# yum -y install flannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€3å°æœºå™¨ä¿®æ”¹flannleé…ç½®æ–‡ä»¶</span><br><span class="line">[root@docker02 ~]# vim /etc/sysconfig/flanneld</span><br><span class="line"><span class="comment">#å†™etcdç«¯çš„ip</span></span><br><span class="line">FLANNEL_ETCD_ENDPOINTS=<span class="string">&quot;http://172.16.1.76:2379&quot;</span></span><br><span class="line"><span class="comment">#è¿™æ®µæ˜¯é»˜è®¤çš„ï¼Œä¸éœ€è¦ä¿®æ”¹ï¼Œä¸€ä¼šè¦åœ¨æ”¹ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶</span></span><br><span class="line">FLANNEL_ETCD_PREFIX=<span class="string">&quot;/atomic.io/network&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€åˆ›å»ºflannelæ•°æ®å†etcdä¸­</span><br><span class="line">[root@elk1 ~]# etcdctl mk /atomic.io/network/config <span class="string">&#x27;&#123;&quot;Network&quot;:&quot;192.168.0.0/16&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;Network&quot;</span>:<span class="string">&quot;192.168.0.0/16&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">[root@elk1 ~]# etcdctl -C http://127.0.0.1:2379 <span class="built_in">set</span> /atomic.io/network/config <span class="string">&#x27;&#123;&quot;Network&quot;:&quot;192.168.0.0/16&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">4ã€3å°æœºå™¨å¯åŠ¨flannel</span><br><span class="line">[root@docker01 ~]# systemctl start flanneld &amp;&amp; systemctl <span class="built_in">enable</span> flanneld</span><br><span class="line"></span><br><span class="line">5ã€3å°æœºå™¨æŸ¥çœ‹flannel0ç½‘å¡ä¿¡æ¯</span><br><span class="line">[root@docker01 ~]# ifconfig</span><br><span class="line">flannel0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1472</span><br><span class="line">        inet 192.168.54.0  netmask 255.255.0.0  destination 192.168.54.0</span><br></pre></td></tr></table></figure><p>3ã€å…³è”flannelå’Œdocker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">1ã€3å°æœºå™¨æŸ¥çœ‹æ”¹æ–‡ä»¶ï¼Œä¸€ä¼šä¼šåœ¨å¯åŠ¨è„šæœ¬é‡Œé¢åŠ ä¿¡æ¯</span><br><span class="line">[root@docker02 ~]# <span class="built_in">cat</span> /run/flannel/docker </span><br><span class="line">DOCKER_OPT_BIP=<span class="string">&quot;--bip=192.168.22.1/24&quot;</span></span><br><span class="line">DOCKER_OPT_IPMASQ=<span class="string">&quot;--ip-masq=true&quot;</span></span><br><span class="line">DOCKER_OPT_MTU=<span class="string">&quot;--mtu=1472&quot;</span></span><br><span class="line">DOCKER_NETWORK_OPTIONS=<span class="string">&quot; --bip=192.168.22.1/24 --ip-masq=true --mtu=1472&quot;</span></span><br><span class="line"></span><br><span class="line">2ã€3å°æœºå™¨ä¿®æ”¹dockerå¯åŠ¨è„šæœ¬</span><br><span class="line">[root@docker02 ~]# vim /usr/lib/systemd/system/docker.service</span><br><span class="line">[Service]</span><br><span class="line"><span class="comment">#æ·»åŠ è¿™è¡Œè¯»å–ç¯å¢ƒå˜é‡æ–‡ä»¶</span></span><br><span class="line">EnviromentFile=/run/flannel/docker </span><br><span class="line"><span class="comment">#åœ¨æœ€åé¢æ·»åŠ å˜é‡</span></span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock <span class="variable">$DOCKER_NETWORK_OPTIONS</span></span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# systemctl daemon-reload &amp;&amp; systemctl restart flanneld</span><br><span class="line"></span><br><span class="line">3ã€3å°æœºå™¨å¼€å¯å†…æ ¸è½¬å‘</span><br><span class="line">[root@docker03 ~]# <span class="built_in">echo</span> <span class="string">&#x27;net.ipv4.ip_forward=1&#x27;</span>  &gt;&gt; /etc/sysctl.conf </span><br><span class="line"></span><br><span class="line">4ã€3å°æœºå™¨å¼€åšå¦‚ä¸‹æ“ä½œ</span><br><span class="line">[root@docker01 ~]# systemctl restart docker</span><br><span class="line">[root@docker01 ~]# systemctl start firewalld</span><br><span class="line">[root@docker01 ~]# systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# systemctl start firewalld &amp;&amp; systemctl stop firewalld</span><br><span class="line">[root@docker01 ~]#  systemctl restart network</span><br><span class="line">[root@docker01 ~]#  systemctl restart flanneld </span><br><span class="line">[root@docker01 ~]#  systemctl restart docker</span><br><span class="line"></span><br><span class="line">------------æ³¨æ„---------------------</span><br><span class="line">1ã€# æ‰§è¡Œdocker info å‡ºç°è­¦å‘Š</span><br><span class="line"><span class="comment">#éœ€è¦é…ç½®å†…æ ¸è½¬å‘æ”¯æŒiptables</span></span><br><span class="line">WARNING: bridge-nf-call-iptables is disabled</span><br><span class="line">WARNING: bridge-nf-call-ip6tables is disabled</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/docker.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables=1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables=1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">[root@docker01 ~]#  systemctl restart network</span><br><span class="line">[root@docker01 ~]#  systemctl restart flanneld </span><br><span class="line">[root@docker01 ~]#  systemctl restart docker</span><br></pre></td></tr></table></figure><p>3ã€æµ‹è¯•æ˜¯å¦å¯ä»¥é€šä¿¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1ã€è¿›å»æŸ¥çœ‹3å°æœºå™¨çš„ip,ç„¶åå†äº’ç›¸ping  IPï¼Œå¦‚æœå¯ä»¥pingé€šåˆ™ok</span><br><span class="line">[root@docker01 ~]# docker run -it busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:C0:A8:36:02  </span><br><span class="line">          inet addr:192.168.54.2  Bcast:192.168.54.255  Mask:255.255.255.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@docker02 ~]# docker run -it busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:C0:A8:16:05  </span><br><span class="line">          inet addr:192.168.22.5  Bcast:192.168.22.255  Mask:255.255.255.0</span><br><span class="line">          </span><br><span class="line">[root@docker03 ~]# docker run -it busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:C0:A8:39:05  </span><br><span class="line">          inet addr:192.168.57.5  Bcast:192.168.57.255  Mask:255.255.255.0</span><br></pre></td></tr></table></figure><h3 id="3ã€overlayè·¨ä¸»æœºé€šä¿¡"><strong>3ã€overlayè·¨ä¸»æœºé€šä¿¡</strong></h3><p><img src="C:%5CUsers%5CMac%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240910144826332.png" alt="image-20240910144826332"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">http://www.cnblogs.com/CloudMan6/p/7270551.html</span><br><span class="line"></span><br><span class="line">docker03ä¸Šï¼š consulå­˜å‚¨ipåœ°å€çš„åˆ†é…</span><br><span class="line">docker run -d -p 8500:8500 -h consul --name consul progrium/consul -server -bootstrap</span><br><span class="line"></span><br><span class="line">è®¾ç½®å®¹å™¨çš„ä¸»æœºå</span><br><span class="line">consulï¼škvç±»å‹çš„å­˜å‚¨æ•°æ®åº“ï¼ˆkey:valueï¼‰</span><br><span class="line">docker01ã€02ä¸Šï¼š</span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;cluster-store&quot;</span>: <span class="string">&quot;consul://10.0.0.13:8500&quot;</span>,</span><br><span class="line"><span class="string">&quot;cluster-advertise&quot;</span>: <span class="string">&quot;10.0.0.11:2376&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">2ï¼‰åˆ›å»ºoverlayç½‘ç»œ</span><br><span class="line">docker network create -d overlay --subnet 172.16.2.0/24 --gateway 172.16.2.254 ol1</span><br><span class="line"></span><br><span class="line">3ï¼‰å¯åŠ¨å®¹å™¨æµ‹è¯•</span><br><span class="line">docker run -it --network ol1 --name oldboy01 busybox /bin/sh</span><br><span class="line">æ¯ä¸ªå®¹å™¨æœ‰ä¸¤å—ç½‘å¡,eth0å®ç°å®¹å™¨é—´çš„é€šè®¯,eth1å®ç°å®¹å™¨è®¿é—®å¤–ç½‘</span><br></pre></td></tr></table></figure><h3 id="4ã€macvlan"><strong>4ã€macvlan</strong></h3><p>é»˜è®¤ä¸€ä¸ªç‰©ç†ç½‘å¡ï¼Œåªæœ‰ä¸€ä¸ªç‰©ç†macåœ°å€ï¼Œè™šæ‹Ÿå¤šä¸ªmacåœ°å€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## åˆ›å»ºmacvlanç½‘ç»œ</span></span><br><span class="line">docker network create --driver macvlan --subnet 10.0.0.0/24 --gateway 10.0.0.254 -o parent=eth0 macvlan_1</span><br><span class="line"></span><br><span class="line"><span class="comment">## è®¾ç½®eth0çš„ç½‘å¡ä¸ºæ··æ‚æ¨¡å¼</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 promisc on</span><br><span class="line"></span><br><span class="line"><span class="comment">## åˆ›å»ºä½¿ç”¨macvlanç½‘ç»œçš„å®¹å™¨</span></span><br><span class="line">docker run -it --network macvlan_1 --ip=10.0.0.200 busybox</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡ä¸ƒã€Dockerå•æœºç¼–æ’å·¥å…·</title>
      <link href="/posts/c7b1e5e1.html"/>
      <url>/posts/c7b1e5e1.html</url>
      
        <content type="html"><![CDATA[<h2 id="Dockerå•æœºç¼–æ’å·¥å…·">Dockerå•æœºç¼–æ’å·¥å…·</h2><h3 id="1ã€docker-composeçš„ä»‹ç»">1ã€<strong>docker-composeçš„ä»‹ç»</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Composeæ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨Dockeråº”ç”¨å·¥å…·é€šè¿‡Compose å¯ä»¥ä½¿ç”¨YMLæ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰æœåŠ¡ï¼Œç”¨æ¥ç®¡ç†å®¹å™¨çš„èµ·åœï¼ŒæŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—ï¼Œæ¯”è¾ƒæ–¹ä¾¿</span><br><span class="line">ä¸åƒdocker runå‘½ä»¤æ¯”è¾ƒé•¿ï¼Œè€Œä¸”æ˜¯ä¸´æ—¶æ‰§è¡Œçš„</span><br><span class="line"></span><br><span class="line">DockerComposeä½¿ç”¨çš„ä¸‰æ­¥:</span><br><span class="line">1.ä½¿ç”¨docker file å®šä¹‰åº”ç”¨ç¨‹åºçš„ç¯å¢ƒé•œåƒ</span><br><span class="line">2.docker-composeå®šä¹‰æ„æˆåº”ç”¨ç¨‹åºçš„æœåŠ¡</span><br><span class="line">3.å¯åŠ¨Composeï¼Œå°±ç›¸å½“äºå¯åŠ¨åº”ç”¨</span><br></pre></td></tr></table></figure><p><strong>ç‰ˆæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">composeæ–‡ä»¶ç‰ˆæœ¬ï¼šversion: <span class="string">&#x27;2.3&#x27;</span></span><br><span class="line"></span><br><span class="line">docker-composeç¨‹åºå®‰è£…çš„ç‰ˆæœ¬ï¼š</span><br><span class="line">[root@harbor harbor]# docker-compose --version</span><br><span class="line">docker-compose version 1.18.0, build 8dd22a9</span><br><span class="line"></span><br><span class="line">dockerç‰ˆæœ¬ï¼š</span><br><span class="line">[root@harbor harbor]# docker --version</span><br><span class="line">Docker version 26.1.4, build 5650f9b</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240909134745384.png" alt="image-20240909134745384"></p><h3 id="2ã€å®‰è£…bocker-compose">2ã€<strong>å®‰è£…bocker-compose</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–¹æ³•ä¸€ï¼šç‰ˆæœ¬ä¸å¯æ§ï¼Œå®‰è£…çš„ç‰ˆæœ¬ç¨å¾®åè€  1.18çš„</span></span><br><span class="line">1ã€å®‰è£…bocker-compose </span><br><span class="line">[root@docker01 ~]# yum install -y docker-compose</span><br><span class="line">[root@docker01 ~]# docker-compose --version</span><br><span class="line">docker-compose version 1.18.0, build 8dd22a9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€æ–¹æ³•äºŒ  å¯èƒ½è¦å¼€ä»£ç†ä¸‹è½½</span><br><span class="line">[root@docker02 bin]# curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/v2.29.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/2.29.2/dockercompose-Linux-x86_64&quot;</span> -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# <span class="built_in">mv</span> docker-compose-linux-x86_64\ \(2\)  docker-compose</span><br><span class="line">[root@docker01 ~]# <span class="built_in">mv</span> docker-compose /usr/local/bin/</span><br><span class="line">[root@docker01 ~]# <span class="built_in">chmod</span> +x /usr/local/bin/docker-compose    </span><br><span class="line">[root@docker01 ~]# docker-compose  --version</span><br><span class="line">Docker Compose version v2.29.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#æƒ³è¦å…¶ä»–æœºå™¨èƒ½å¤Ÿä½¿ç”¨docker-composeå‘½ä»¤,å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶scpè¿‡å»</span></span><br><span class="line">scp /usr/local/bin/docker-compose 10.0.0.102:/usr/local/bin/</span><br></pre></td></tr></table></figure><h3 id="3ã€docker-composeçš„æ¨¡ç‰ˆ">3ã€<strong>docker-composeçš„æ¨¡ç‰ˆ</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;ç‰ˆæœ¬å·&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  æœåŠ¡åç§°1:</span><br><span class="line">    image: å®¹å™¨é•œåƒ</span><br><span class="line">    container_name: å®¹å™¨åç§°(å®¹å™¨åç§°å’ŒæœåŠ¡åç§°ä¿æŒä¸€è‡´)</span><br><span class="line">    environment:</span><br><span class="line">      - ç¯å¢ƒå˜é‡1=å€¼1</span><br><span class="line">      - ç¯å¢ƒå˜é‡2=å€¼2</span><br><span class="line">    volumes:</span><br><span class="line">      - å®¿ä¸»æœºæ•°æ®ç›®å½•:å®¹å™¨å†…æ•°æ®ç›®å½•</span><br><span class="line">    ports:</span><br><span class="line">      - å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…æ˜ å°„ç«¯å£</span><br><span class="line">    networks:</span><br><span class="line">      - è‡ªå®šä¹‰ç½‘ç»œåç§°</span><br><span class="line">    links:</span><br><span class="line">      - namenode</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - æ•°æ®åº“ä½¿ç”¨å­—ç¬¦é›†å˜é‡æ—¶å¯ä»¥ç”¨</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  æœåŠ¡åç§°2:</span><br><span class="line">    image: å®¹å™¨é•œåƒ</span><br><span class="line">    container_name: å®¹å™¨åç§°(å®¹å™¨åç§°å’ŒæœåŠ¡åç§°ä¿æŒä¸€è‡´)</span><br><span class="line">    environment:</span><br><span class="line">      - ç¯å¢ƒå˜é‡1=å€¼1</span><br><span class="line">      - ç¯å¢ƒå˜é‡2=å€¼2</span><br><span class="line">    user: å®¿ä¸»æœºç”¨æˆ·:å®¹å™¨ç”¨æˆ·</span><br><span class="line">    volumes:</span><br><span class="line">      - å®¿ä¸»æœºæ•°æ®ç›®å½•:å®¹å™¨å†…æ•°æ®ç›®å½•</span><br><span class="line">    ports:</span><br><span class="line">      - å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…æ˜ å°„ç«¯å£</span><br><span class="line">    networks:</span><br><span class="line">      - è‡ªå®šä¹‰ç½‘ç»œåç§°</span><br><span class="line">    links:</span><br><span class="line">      - namenode</span><br><span class="line">    depends_on:</span><br><span class="line">      - ä¾èµ–æœåŠ¡</span><br><span class="line">    restart: always</span><br><span class="line"> </span><br><span class="line"><span class="comment">#å¦‚æœæ²¡æœ‰ç½‘ç»œï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">networks:</span><br><span class="line">  default:</span><br><span class="line">  externnal: <span class="literal">true</span></span><br><span class="line">  name: è‡ªå®šä¹‰ç½‘ç»œåç§°</span><br></pre></td></tr></table></figure><h3 id="4ã€docker-composeâ€”â€”å•æœºç¼–æ’mysql">4ã€<strong>docker-composeâ€”â€”å•æœºç¼–æ’mysql</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1ã€#æ‰¾åˆ°è¿è¡Œmysqlçš„å‘½ä»¤</span><br><span class="line">docker run \</span><br><span class="line">--name mysql80 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=zabbix \</span><br><span class="line">-e MYSQL_USER=zabbix \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:8.0 \</span><br><span class="line">--character-set-server=utf8mb4 \</span><br><span class="line">--collation-server=utf8mb4_bin \</span><br><span class="line">--log_bin_trust_function_creators</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#ç¼–å†™docker-compose</span><br><span class="line">å¦‚æœä¹‹å‰è¿è¡Œæœ‰å…¶ä»–ç‰ˆæœ¬çš„mysqlï¼Œéœ€è¦æ¸…é™¤ç›®å½•</span><br><span class="line">[root@docker01 mysql]# <span class="built_in">rm</span> -rf /data/</span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> mysql</span><br><span class="line">[root@docker01 ~]# <span class="built_in">cd</span> mysql/</span><br><span class="line">[root@docker01 mysql]# vim mysql-compose.yml    (åå­—æœ€å¥½å«docker-compose.yml)</span><br><span class="line">version: <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  mysql80:</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    container_name: mysql80</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=123</span><br><span class="line">      - MYSQL_DATABASE=zabbix</span><br><span class="line">      - MYSQL_USER=zabbix</span><br><span class="line">      - MYSQL_PASSWORD=123</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/mysql:/var/lib/mysql</span><br><span class="line">    ports:</span><br><span class="line">      - 3306:3306</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - --character-set-server=utf8mb4</span><br><span class="line">      - --collation-server=utf8mb4_bin</span><br><span class="line">      - --log_bin_trust_function_creators</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#ç¬¬ä¸€æ¬¡å¯åŠ¨ä½¿ç”¨up,ä¼šåˆ›å»ºå®¹å™¨å¹¶å¯åŠ¨å®¹å™¨,å‰å°è¾“å‡ºæ—¥å¿—</span><br><span class="line">å¦‚æœåˆ›å»ºçš„æ–‡ä»¶åå«docker-compose.ymlï¼Œå¯åŠ¨å‘½ä»¤æ˜¯ï¼š</span><br><span class="line">      docker-compose up</span><br><span class="line">      </span><br><span class="line">å¦‚æœåˆ›å»ºçš„æ–‡ä»¶åä¸å«docker-compose.ymlï¼Œå¯åŠ¨å‘½ä»¤æ˜¯ï¼š</span><br><span class="line">[root@docker01 mysql]# docker-compose -f mysql-compose.yml up</span><br><span class="line"></span><br><span class="line">æ£€æŸ¥æ²¡é—®é¢˜å°±ctrl+c</span><br></pre></td></tr></table></figure><p>docker-composeçš„æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¬¬ä¸€æ¬¡å¯åŠ¨åˆ›å»ºå®¹å™¨å¹¶å‰å°è¾“å‡ºæ—¥å¿—</span></span><br><span class="line">[root@docker01 mysql]# docker-compose -f mysql-compose.yml up</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ—¥å¿—æ²¡æœ‰æŠ¥é”™ï¼Œç›´æ¥åå°å¯åŠ¨</span></span><br><span class="line">[root@docker01 mysql]# docker-compose -f mysql-compose.yml up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢å®¹å™¨</span></span><br><span class="line">[root@docker01 mysql]# docker-compose -f mysql-compose.yml stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨å®¹å™¨</span></span><br><span class="line">[root@docker01 mysql]# docker-compose -f mysql-compose.yml start</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯å®¹å™¨</span></span><br><span class="line">[root@docker01 mysql]# docker-compose -f mysql-compose.yml restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¯¥composeä¸­çš„æ‰€æœ‰å®¹å™¨è¿è¡ŒçŠ¶æ€</span></span><br><span class="line">[root@docker01 mysql]# docker-compose -f mysql-compose.yml ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤composeä¸­çš„å®¹å™¨</span></span><br><span class="line">[root@docker01 mysql]# docker-compose <span class="built_in">rm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">[root@docker01 mysql]# docker-compose logs</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæœåŠ¡å¯åœ</span></span><br><span class="line">[root@harbor harbor]# docker-compose start proxy</span><br></pre></td></tr></table></figure><h3 id="5ã€docker-composeâ€”â€”å•æœºç¼–æ’zabbix">5ã€<strong>docker-composeâ€”â€”å•æœºç¼–æ’zabbix</strong></h3><p>1ã€æ‰¾åˆ°è¿è¡Œzabbixçš„dockerå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">mysqlè¦åˆå§‹åŒ–ã€‚æ‰€ä»¥web-serverè¦åå¯åŠ¨  å†™æˆ=å¦‚æœæŠ¥é”™ã€‚å°±è¦å†™æˆkey: value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€#æ‰¾åˆ°è¿è¡Œmysqlçš„å‘½ä»¤</span><br><span class="line">docker run \</span><br><span class="line">--name mysql80 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=zabbix \</span><br><span class="line">-e MYSQL_USER=zabbix \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:8.0 \</span><br><span class="line">--character-set-server=utf8mb4 \</span><br><span class="line">--collation-server=utf8mb4_bin \</span><br><span class="line">--log_bin_trust_function_creators</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œå®¹å™¨åŒ–zabbix-server</span><br><span class="line">docker run \</span><br><span class="line">--<span class="built_in">link</span> mysql80 \</span><br><span class="line">--name zabbix-server \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">&quot;mysql80&quot;</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">&quot;zabbix&quot;</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">&quot;123&quot;</span> \</span><br><span class="line">-d zabbix/zabbix-server-mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€å®¹å™¨åŒ–zabbix-web</span><br><span class="line">docker run \</span><br><span class="line">--<span class="built_in">link</span> zabbix-server \</span><br><span class="line">--<span class="built_in">link</span> mysql80 \</span><br><span class="line">--name zabbix-web \</span><br><span class="line">-p 80:8080 \</span><br><span class="line">-p 8443:8443 \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">&quot;mysql80&quot;</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">&quot;zabbix&quot;</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">&quot;123&quot;</span> \</span><br><span class="line">-e ZBX_SERVER_HOST=<span class="string">&quot;zabbix-server&quot;</span> \</span><br><span class="line">-e PHP_TZ=<span class="string">&quot;Asia/Shanghai&quot;</span> \</span><br><span class="line">-d zabbix/zabbix-web-nginx-mysql</span><br></pre></td></tr></table></figure><p>2ã€ç¼–å†™zabbixçš„docker-compose</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# <span class="built_in">rm</span> -rf /data/</span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> zabbix</span><br><span class="line">[root@docker01 ~]# <span class="built_in">cd</span> zabbix/</span><br><span class="line">[root@docker01 zabbix]# vim docker-compose.yml</span><br><span class="line">version: <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  mysql80:</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    container_name: mysql80</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=123</span><br><span class="line">      - MYSQL_DATABASE=zabbix</span><br><span class="line">      - MYSQL_USER=zabbix</span><br><span class="line">      - MYSQL_PASSWORD=123</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/mysql:/var/lib/mysql</span><br><span class="line">    ports:</span><br><span class="line">      - 3306:3306</span><br><span class="line">    <span class="built_in">command</span>:</span><br><span class="line">      - --character-set-server=utf8mb4</span><br><span class="line">      - --collation-server=utf8mb4_bin</span><br><span class="line">      - --log_bin_trust_function_creators</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  zabbix-server:</span><br><span class="line">    image: zabbix/zabbix-server-mysql</span><br><span class="line">    container_name: zabbix-server</span><br><span class="line">    environment:</span><br><span class="line">      - DB_SERVER_HOST=mysql80</span><br><span class="line">      - MYSQL_USER=zabbix</span><br><span class="line">      - MYSQL_PASSWORD=123</span><br><span class="line">    ports:</span><br><span class="line">      - 10051:10051</span><br><span class="line">    links:</span><br><span class="line">      - mysql80</span><br><span class="line">    restart: always</span><br><span class="line">    </span><br><span class="line">  zabbix-web:</span><br><span class="line">    image: zabbix/zabbix-web-nginx-mysql</span><br><span class="line">    container_name: zabbix-web</span><br><span class="line">    environment:</span><br><span class="line">      - DB_SERVER_HOST=mysql80</span><br><span class="line">      - MYSQL_USER=zabbix</span><br><span class="line">      - MYSQL_PASSWORD=123</span><br><span class="line">      - ZBX_SERVER_HOST=zabbix-server</span><br><span class="line">      - PHP_TZ=Asia/Shanghai</span><br><span class="line">    ports:</span><br><span class="line">      - 80:8080</span><br><span class="line">      - 443:8443</span><br><span class="line">    links:</span><br><span class="line">      - mysql80</span><br><span class="line">      - zabbix-server</span><br><span class="line">    restart: always</span><br><span class="line">    </span><br><span class="line"><span class="comment">#  networks:</span></span><br><span class="line"><span class="comment">#    default:</span></span><br><span class="line"><span class="comment">#      externnal: true</span></span><br><span class="line"><span class="comment">#      name: zabbix-net</span></span><br><span class="line"><span class="comment">#åŸºäºé»˜è®¤çš„default-bridgeç±»å‹åˆ›å»ºä¸€ä¸ªbridgeç±»å‹çš„ç½‘æ¡¥</span></span><br></pre></td></tr></table></figure><p>####æŠ¥é”™</p><p><img src="../image/study_img/image-20240909153932154.png" alt="image-20240909153932154"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å¦‚æœæœ‰ç¯å¢ƒå˜é‡çš„æŠ¥é”™ï¼Œå°±å–æ¶ˆå•å¼•å·è¯•ä¸€ä¸‹ï¼Œä¸è¡Œå†æ¢æˆkey:valueæ ¼å¼</span></span><br><span class="line">environment:</span><br><span class="line">- DB_SERVER_HOST: <span class="string">&#x27;mysql80&#x27;</span></span><br><span class="line">- MYSQL_USER: <span class="string">&#x27;zabbix&#x27;</span></span><br><span class="line">- MYSQL_PASSWORD: <span class="string">&#x27;zabbix&#x27;</span></span><br></pre></td></tr></table></figure><p>3ã€å¯åŠ¨zabbix</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1ã€å‰å°æ£€æŸ¥æ˜¯å¦æœ‰æŠ¥é”™</span><br><span class="line">[root@docker01 zabbix]# docker-compose up </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€æ²¡æœ‰æŠ¥é”™å°±æ”¾åå°è¿è¡Œ</span><br><span class="line">[root@docker01 zabbix]# docker-compose up -d</span><br><span class="line"></span><br><span class="line">3ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.101</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240909154947402.png" alt="image-20240909154947402"></p><h3 id="6ã€docker-composeâ€”â€”å•æœºç¼–æ’jenkins">6ã€<strong>docker-composeâ€”â€”å•æœºç¼–æ’jenkins</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">1ã€gitlabé•œåƒ</span><br><span class="line">docker run \</span><br><span class="line">--hostname 10.0.0.102 \</span><br><span class="line">--<span class="built_in">env</span> GITLAB_OMNIBUS_CONFIG=<span class="string">&quot;external_url &#x27;http://10.0.0.102&#x27;&quot;</span> \</span><br><span class="line">-p 443:443 -p 80:80 -p 2222:22 \</span><br><span class="line">--name gitlab \</span><br><span class="line">--restart always \</span><br><span class="line">-v /data/gitlab/config:/etc/gitlab \</span><br><span class="line">-v /data/gitlab/logs:/var/log/gitlab \</span><br><span class="line">-v /data/gitlab/data:/var/opt/gitlab \</span><br><span class="line">-d gitlab/gitlab-ce</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œjenkinså®¹å™¨</span><br><span class="line">docker run \</span><br><span class="line">--name jenkins \</span><br><span class="line">--privileged \</span><br><span class="line">--user=root \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /data/jenkins/:/var/jenkins_home \</span><br><span class="line">-v /usr/bin/docker:/usr/bin/docker \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v /root/.ssh/:/root/.ssh/ \</span><br><span class="line">-v /root/.docker/config.json:/root/.docker/config.json \</span><br><span class="line">-p 8080:8080 \</span><br><span class="line">-p 5000:5000 \</span><br><span class="line">-d jenkins/jenkins:2.422</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> jenkins &amp;&amp; <span class="built_in">cd</span> jenkins</span><br><span class="line">[root@docker01 jenkins]# vim jenkins-docker-compose.yml</span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  gitlab:</span><br><span class="line">    image: gitlab/gitlab-ce</span><br><span class="line">    container_name: gitlab</span><br><span class="line">    hostname: 10.0.0.102</span><br><span class="line">    environment:</span><br><span class="line">      GITLAB_OMNIBUS_CONFIG: |</span><br><span class="line">        external_url <span class="string">&#x27;http://10.0.0.102</span></span><br><span class="line"><span class="string">        gitlab_rails[&#x27;</span>gitlab_shell_ssh_port<span class="string">&#x27;] = 2222 </span></span><br><span class="line"><span class="string">        alertmanager[&#x27;</span><span class="built_in">enable</span><span class="string">&#x27;] = false</span></span><br><span class="line"><span class="string">        node_exporter[&#x27;</span><span class="built_in">enable</span><span class="string">&#x27;] = false</span></span><br><span class="line"><span class="string">        redis_exporter[&#x27;</span><span class="built_in">enable</span><span class="string">&#x27;] = false</span></span><br><span class="line"><span class="string">        postgres_exporter[&#x27;</span><span class="built_in">enable</span><span class="string">&#x27;] = false</span></span><br><span class="line"><span class="string">    volumes:</span></span><br><span class="line"><span class="string">      - /data/gitlab/config:/etc/gitlab </span></span><br><span class="line"><span class="string">      - /data/gitlab/logs:/var/log/gitlab </span></span><br><span class="line"><span class="string">      - /data/gitlab/data:/var/opt/gitlab</span></span><br><span class="line"><span class="string">    ports:</span></span><br><span class="line"><span class="string">      - 443:443 </span></span><br><span class="line"><span class="string">      - 80:80 </span></span><br><span class="line"><span class="string">      - 2222:22</span></span><br><span class="line"><span class="string">    restart: always</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">  jenkins:</span></span><br><span class="line"><span class="string">    image: jenkins/jenkins:2.422</span></span><br><span class="line"><span class="string">    container_name: jenkins</span></span><br><span class="line"><span class="string">    user: root</span></span><br><span class="line"><span class="string">    privileged: ture</span></span><br><span class="line"><span class="string">    volumes:</span></span><br><span class="line"><span class="string">      - /data/jenkins/:/var/jenkins_home</span></span><br><span class="line"><span class="string">      - /usr/bin/docker:/usr/bin/docker</span></span><br><span class="line"><span class="string">      - /var/run/docker.sock:/var/run/docker.sock</span></span><br><span class="line"><span class="string">      - /root/.ssh/:/root/.ssh/</span></span><br><span class="line"><span class="string">      - /root/.docker/config.json:/root/.docker/config.json</span></span><br><span class="line"><span class="string">    ports:</span></span><br><span class="line"><span class="string">      - 8080:8080 </span></span><br><span class="line"><span class="string">      - 5000:5000 </span></span><br><span class="line"><span class="string">    restart: always</span></span><br></pre></td></tr></table></figure><h3 id="7ã€docker-composeâ€”â€”å•æœºç¼–æ’wordpress">7ã€<strong>docker-composeâ€”â€”å•æœºç¼–æ’wordpress</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿è¡Œæ•°æ®åº“</span></span><br><span class="line">docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wp_db \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œwordpresså®¹å™¨</span></span><br><span class="line">docker run \</span><br><span class="line">--name wp \</span><br><span class="line">--<span class="built_in">link</span> mysql57 \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql57 \</span><br><span class="line">-e WORDPRESS_DB_USER=wp_user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=123 \</span><br><span class="line">-e WORDPRESS_DB_NAME=wp_db \</span><br><span class="line">-d wordpress-df:v1 </span><br></pre></td></tr></table></figure><p>2ã€ç¼–å†™docker-compos</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> wp</span><br><span class="line">[root@docker01 ~]# <span class="built_in">cd</span> wp/</span><br><span class="line">[root@docker01 wp]# vim wp-docker-compose.yml</span><br><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  mysql57:</span><br><span class="line">    image: mysql:5.7.44</span><br><span class="line">    container_name: mysql57</span><br><span class="line">    environment:</span><br><span class="line">      - MYSQL_ROOT_PASSWORD=123</span><br><span class="line">      - MYSQL_DATABASE=wp_db</span><br><span class="line">      - MYSQL_USER=wp_user</span><br><span class="line">      - MYSQL_PASSWORD=123</span><br><span class="line">    volumes:</span><br><span class="line">      - /data/mysql:/var/lib/mysql</span><br><span class="line">    ports:</span><br><span class="line">      - 3306:3306</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  wp:</span><br><span class="line">    image:  wordpress-df:v2</span><br><span class="line">    container_name: wp</span><br><span class="line">    environment:</span><br><span class="line">      - WORDPRESS_DB_HOST=mysql57</span><br><span class="line">      - WORDPRESS_DB_USER=wp_user</span><br><span class="line">      - WORDPRESS_DB_PASSWORD=123</span><br><span class="line">      - WORDPRESS_DB_NAME=wp_db</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line">    links:</span><br><span class="line">      - mysql57</span><br><span class="line">    restart: always</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">[root@docker01 wp]# docker-compose -f wp-docker-compose.yml up -d</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡å…­ã€dockerçš„å®¹å™¨åŒ–ä»£ç ä¸Šçº¿</title>
      <link href="/posts/93124e7b.html"/>
      <url>/posts/93124e7b.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®¹å™¨åŒ–ä»£ç ä¸Šçº¿">å®¹å™¨åŒ–ä»£ç ä¸Šçº¿</h2><h3 id="1ã€å®¹å™¨åŒ–gitlab"><strong>1ã€å®¹å™¨åŒ–gitlab</strong></h3><p>ç¯å¢ƒå‡†å¤‡  å…ˆæ£€æŸ¥å¯ä»¥å†…å­˜Avail(æœ€å°‘è¿˜æœ‰10G)æ¯”è¾ƒå¤šçš„æœºå™¨ï¼Œå»æ‹‰å–gitlabï¼Œä¸ç„¶ä¼šæ‹‰å–å¤±è´¥</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th><th>å†…å­˜</th></tr></thead><tbody><tr><td>docker03</td><td>10.0.0.102  /  172.16.1.102</td><td>éƒ¨ç½²å®¹å™¨åŒ–gitlab</td><td>8G</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¹å™¨åŒ–ä»£ç ä¸Šçº¿å‘ï¼š</span></span><br><span class="line">1.gitlabå¦‚ä½•ä½¿ç”¨é22ç«¯å£æ‹‰ä»£ç </span><br><span class="line">2.jenkinså®¹å™¨å¦‚ä½•ä½¿ç”¨dockerå‘½ä»¤</span><br><span class="line">3.jenkinsçš„å¯†é’¥ä¸Šä¼ åˆ°gitlab</span><br><span class="line">4.jenkinså¦‚ä½•ç™»å½• harbor</span><br><span class="line"></span><br><span class="line">å¼€å‘æŠŠä»£ç æäº¤åˆ°gitlabï¼Œjekinså»æ‹‰å–ä»£ç åˆ°å®¹å™¨é‡Œé¢</span><br></pre></td></tr></table></figure><p>å®¹å™¨åŒ–ä»£ç ä¸Šçº¿æµç¨‹å›¾</p><p><img src="../image/study_img/image-20240905093733661.png" alt="image-20240905093733661"></p><p>1ã€å»å®˜ç½‘æŸ¥æ‰¾è¿è¡Œå®¹å™¨çš„ä»£ç   <a href="https://about.gitlab.com/">https://about.gitlab.com/</a></p><p><img src="../image/study_img/image-20240907130711368.png" alt="image-20240907130711368"></p><p>å¾€ä¸‹æ»‘ æ‰¾åˆ°å®¹å™¨å®‰è£…</p><p><img src="../image/study_img/image-20240907130745739.png" alt="image-20240907130745739"></p><p><img src="../image/study_img/image-20240907131037286.png" alt="image-20240907131037286"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‹‰å–é•œåƒ   Git-ce æ˜¯ç¤¾åŒºç‰ˆï¼Œgitlab-eeæ˜¯ä¼ä¸šç‰ˆï¼Œæ”¶è´¹çš„ã€‚</span><br><span class="line">[root@docker02 ~]# docker pull gitlab/gitlab-ce:latest</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œé•œåƒ</span><br><span class="line">docker run \</span><br><span class="line">--hostname 10.0.0.102 \</span><br><span class="line">--<span class="built_in">env</span> GITLAB_OMNIBUS_CONFIG=<span class="string">&quot;external_url &#x27;http://10.0.0.102&#x27;&quot;</span> \</span><br><span class="line">-p 443:443 -p 80:80 -p 2222:22 \</span><br><span class="line">--name gitlab \</span><br><span class="line">--restart always \</span><br><span class="line">-v /data/gitlab/config:/etc/gitlab \</span><br><span class="line">-v /data/gitlab/logs:/var/log/gitlab \</span><br><span class="line">-v /data/gitlab/data:/var/opt/gitlab \</span><br><span class="line">-d gitlab/gitlab-ce</span><br><span class="line"></span><br><span class="line">-p 2222:22  å®¿ä¸»æœºçš„22ç«¯å£è¢«å ç”¨äº†ï¼Œæ‰€æœ‰ä½¿ç”¨å®¿ä¸»æœºçš„2222ç«¯å£</span><br><span class="line">--detach=-d</span><br><span class="line"></span><br><span class="line">3ã€è¿è¡Œä¹‹åï¼Œæ‰§è¡Œ</span><br><span class="line">[root@docker02 ~]# docker ps</span><br><span class="line">å¯èƒ½ä¸€å¼€å§‹çœ‹ä¸åˆ°è¿è¡Œç»“æœï¼Œå› ä¸ºé•œåƒæ¯”è¾ƒå¤§ï¼Œè¿è¡Œèµ·æ¥æ¯”è¾ƒæ…¢ï¼Œåé¢è¿˜è¦åšä¼˜åŒ–ï¼Œå…ˆè¿›å…¥å®¹å™¨é‡Œé¢ï¼ŒæŸ¥çœ‹å¯åŠ¨çŠ¶æ€</span><br><span class="line">[root@docker02 ~]# docker <span class="built_in">exec</span> -it gitlab /bin/bash</span><br><span class="line">root@10:/# gitlab-ctl status</span><br><span class="line">run: alertmanager: (pid 1281) 314s; run: <span class="built_in">log</span>: (pid 1008) 429s</span><br><span class="line">run: gitaly: (pid 1231) 318s; run: <span class="built_in">log</span>: (pid 559) 642s</span><br><span class="line">run: gitlab-exporter: (pid 1219) 319s; run: <span class="built_in">log</span>: (pid 939) 448s</span><br><span class="line">run: gitlab-kas: (pid 751) 626s; run: <span class="built_in">log</span>: (pid 768) 623s</span><br><span class="line">run: gitlab-workhorse: (pid 1155) 321s; run: <span class="built_in">log</span>: (pid 885) 461s</span><br><span class="line">run: logrotate: (pid 502) 655s; run: <span class="built_in">log</span>: (pid 514) 653s</span><br><span class="line">run: nginx: (pid 1169) 320s; run: <span class="built_in">log</span>: (pid 917) 455s</span><br><span class="line">run: postgres-exporter: (pid 1289) 314s; run: <span class="built_in">log</span>: (pid 1032) 420s</span><br><span class="line">run: postgresql: (pid 583) 632s; run: <span class="built_in">log</span>: (pid 594) 631s</span><br><span class="line">run: prometheus: (pid 1238) 318s; run: <span class="built_in">log</span>: (pid 984) 437s</span><br><span class="line">run: puma: (pid 835) 474s; run: <span class="built_in">log</span>: (pid 842) 473s</span><br><span class="line">run: redis: (pid 519) 649s; run: <span class="built_in">log</span>: (pid 532) 647s</span><br><span class="line">run: redis-exporter: (pid 1221) 319s; run: <span class="built_in">log</span>: (pid 968) 441s</span><br><span class="line">run: sidekiq: (pid 852) 468s; run: <span class="built_in">log</span>: (pid 860) 467s</span><br><span class="line">run: sshd: (pid 37) 676s; run: <span class="built_in">log</span>: (pid 36) 676s</span><br><span class="line"></span><br><span class="line">4ã€çœ‹åˆ°nginxæœåŠ¡èµ·æ¥äº†ï¼Œå°±å¯ä»¥è®¿é—®ç½‘é¡µ</span><br><span class="line">10.0.0.102</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240907152247060.png" alt="image-20240907152247060"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•çš„ç”¨æˆ·åæ˜¯root</span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹gitlabçš„åˆå§‹å¯†ç </span><br><span class="line">[root@docker02 ~]# docker <span class="built_in">exec</span> -it gitlab grep <span class="string">&#x27;Password:&#x27;</span> /etc/gitlab/initial_root_password</span><br><span class="line">Password: dUs0tOCn+nDOkWoShlwCvYYWlnIZUwaiBujL9BkO2TU=</span><br></pre></td></tr></table></figure><p>6ã€åˆ›å»ºä¸€ä¸ªé¡¹ç›®</p><p><img src="../image/study_img/image-20240907153032437.png" alt="image-20240907153032437"></p><p><img src="../image/study_img/image-20240907153123588.png" alt="image-20240907153123588"></p><p><img src="../image/study_img/image-20240907155134996.png" alt="image-20240907155134996"></p><p>7ã€æ‹‰å–ä»£ç ï¼šç›®å‰é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œä½¿ç”¨å…¶ä»–æœºå™¨æ‹‰å–ä»£ç ï¼Œæ— æ³•æ‹‰å–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‹‰å–ä»£ç çš„æœºå™¨éœ€è¦å®‰è£…git</span><br><span class="line">[root@docker01 ~]# yum -y install git</span><br><span class="line"></span><br><span class="line">2ã€ç”Ÿæˆå¯†é’¥å¯¹ï¼Œé…ç½®åˆ°gitlabä»“åº“</span><br><span class="line">[root@docker01 ~]# ssh-keygen</span><br><span class="line">[root@docker01 ~]# <span class="built_in">cat</span> ~/.ssh/id_rsa.pub </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDQrHuOoZahkYpkUthbzbVLMH3ijST4TSPGuKWm77QBIredxGGKpoq2TN71pysOPUiGUKpBQnttyfo5AOealp0knNFuxqiShcRa8IlJQMX6mJfVFrY6jI5g/AnDvIayurVVBsf6T7h6sQNV8Pj4bzGpO8PXi8Z8GGslZ2LbmqA+LsfLLX/KR3BJce4JC/0PsK4DqAVO/WVYd7H0qeSUK5arrnpt7ncYVx02k63KI47Tb4W+nyqhlChwxD55V3ArzbvVpQy3BnRoOQQ5cr7le6HP+kl27jHTxCNJ7bf5uU1O4Polc3ODBkq2gZC9JaN6O8RuyB2UeCe5odVYOmxb5IKJ root@docker01</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240907154118623.png" alt="image-20240907154118623"></p><p><img src="../image/study_img/image-20240907154153334.png" alt="image-20240907154153334"></p><p><img src="../image/study_img/image-20240907154228630.png" alt="image-20240907154228630"></p><p>ä¿®æ”¹ä¸ºä¸­æ–‡å­—ä½“ï¼Œå†åˆ·æ–°</p><p><img src="../image/study_img/image-20240907154846257.png" alt="image-20240907154846257"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ‹‰å–ä»£ç æ—¶ï¼Œè¿˜éœ€è¦è¾“å…¥å¯†ç ï¼Œæ‰€ä»¥é…ç½®çš„sshå¯†é’¥å¯¹åˆ°gitlabæ—¶æ˜¯ä¸å¤ªè¡Œçš„</span><br><span class="line">[root@docker01 ~]# git <span class="built_in">clone</span> git@10.0.0.102:root/web.git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#gitlabä½¿ç”¨é22ç«¯å£æ‹‰ä»£ç </span><br><span class="line">[root@docker01 ~]# git <span class="built_in">clone</span> ssh://git@10.0.0.102:2222/root/web.git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€ç”±äºæ¯æ¬¡æ‹‰å–ä»£ç éƒ½è¦è¾“å…¥åè®®å’Œç«¯å£ï¼Œæ•ˆç‡ä¸é«˜ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶è®¾ç½®è‡ªåŠ¨å‡ºç°åè®®å’Œç«¯å£ï¼Œç›´æ¥å¤åˆ¶</span><br><span class="line"><span class="comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶å’Œåšgitlabçš„ä¼˜åŒ–</span></span><br><span class="line">ç”±äºé…ç½®æ–‡ä»¶å·²ç»æ˜ å°„å‡ºæ¥äº†ï¼Œç›´æ¥ä¿®æ”¹</span><br><span class="line">[root@docker02 ~]# vim /data/gitlab/config/gitlab.rb</span><br><span class="line"><span class="comment">#32è¡Œï¼šurlçš„é…ç½®</span></span><br><span class="line">external_url <span class="string">&#x27;http://10.0.0.102&#x27;</span>  </span><br><span class="line"><span class="comment"># 698è¡Œï¼šç«¯å£çš„é…ç½®</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_shell_ssh_port&#x27;</span>] = 2222 </span><br><span class="line"><span class="comment">###ä¼˜åŒ–å†…å®¹  æŠŠè¿™å‡ è¡ŒåŠ å…¥é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#å‘Šè­¦å…³é—­</span></span><br><span class="line">alertmanager[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line"><span class="comment">#å…³é—­å‰ç«¯çš„nodeåŠŸèƒ½</span></span><br><span class="line">node_exporter[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line"><span class="comment">#å…³é—­redisåŠŸèƒ½</span></span><br><span class="line">redis_exporter[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line"><span class="comment">#å…³é—­postgreåŠŸèƒ½</span></span><br><span class="line">postgres_exporter[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€é‡æ–°åŠ è½½gitlabé…ç½®æ–‡ä»¶ï¼Œéœ€è¦ç­‰å¾…3åˆ†é’Ÿå·¦å³</span><br><span class="line">[root@docker02 ~]# docker <span class="built_in">exec</span> -it gitlab gitlab-ctl reconfigure</span><br><span class="line">reconfigureç›¸å½“äºnginxçš„reloadï¼Œè¿˜æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®ç½‘é¡µçš„</span><br><span class="line"></span><br><span class="line">5ã€å†æ¬¡è®¿é—®ç½‘é¡µï¼Œåˆ·æ–°é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°æä¾›çš„åœ°å€æ˜¯ç›´æ¥å¯ä»¥ä½¿ç”¨çš„åœ°å€</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240907162925699.png" alt="image-20240907162925699"></p><h3 id="2ã€å®¹å™¨åŒ–jenkins"><strong>2ã€å®¹å™¨åŒ–jenkins</strong></h3><p>è®¿é—®å®˜ç½‘ï¼Œæ‰¾åˆ°å¯åŠ¨å®¹å™¨çš„å‘½ä»¤ï¼š<a href="https://www.jenkins.io/">https://www.jenkins.io/</a></p><p><img src="../image/study_img/image-20240907163455778.png" alt="image-20240907163455778"></p><p><img src="../image/study_img/image-20240907163613722.png" alt="image-20240907163613722"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">--name jenkins-docker \</span><br><span class="line">--<span class="built_in">rm</span> \</span><br><span class="line">--detach \</span><br><span class="line">--privileged \</span><br><span class="line">--network jenkins \    <span class="comment">#ç½‘ç»œæ²¡æœ‰é…ç½®ï¼Œéœ€è¦åˆ é™¤</span></span><br><span class="line">--network-alias docker \ <span class="comment">#ç½‘ç»œæ²¡æœ‰é…ç½®ï¼Œéœ€è¦åˆ é™¤</span></span><br><span class="line">--<span class="built_in">env</span> DOCKER_TLS_CERTDIR=/certs \  <span class="comment">#æ²¡æœ‰è¯ä¹¦ï¼Œéœ€è¦åˆ é™¤</span></span><br><span class="line">--volume jenkins-docker-certs:/certs/client \ <span class="comment">#æ²¡æœ‰è¯ä¹¦ï¼Œéœ€è¦åˆ é™¤</span></span><br><span class="line">--volume jenkins-data:/var/jenkins_home \  <span class="comment">#æ˜ å°„çš„jenkinsç›®å½•</span></span><br><span class="line">--publish 2376:2376 \</span><br><span class="line">docker:dind \</span><br><span class="line">--storage-driver overlay2</span><br></pre></td></tr></table></figure><p>åˆ°dockerå®˜ç½‘ï¼Œæ‰¾åˆ°jenkinsé•œåƒ  <a href="https://hub.docker.com/">https://hub.docker.com/</a></p><p><img src="../image/study_img/image-20240907164947184.png" alt="image-20240907164947184"></p><p><img src="../image/study_img/image-20240907165448303.png" alt="image-20240907165448303"></p><p><img src="../image/study_img/image-20240907165642490.png" alt="image-20240907165642490"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‹‰å–2.422ç‰ˆæœ¬çš„é•œåƒ</span><br><span class="line">[root@docker02 ~]# docker pull jenkins/jenkins:2.422</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œjenkinså®¹å™¨</span><br><span class="line">docker run \</span><br><span class="line">--name jenkins \</span><br><span class="line">--privileged \</span><br><span class="line">--user=root \</span><br><span class="line">--restart=always \</span><br><span class="line">-v /data/jenkins/:/var/jenkins_home \</span><br><span class="line">-v /usr/bin/docker:/usr/bin/docker \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v /root/.ssh/:/root/.ssh/ \</span><br><span class="line">-v /root/.docker/config.json:/root/.docker/config.json \</span><br><span class="line">-p 8080:8080 \</span><br><span class="line">-p 5000:5000 \</span><br><span class="line">-d jenkins/jenkins:2.422</span><br><span class="line"></span><br><span class="line">--<span class="built_in">rm</span>ï¼šåªè¦å®¹å™¨åœæ­¢å°±ä¼šåˆ æ‰</span><br><span class="line">--user=rootï¼šjenkinséœ€è¦rootç”¨æˆ·å»å¯åŠ¨ï¼Œä¸ç„¶è¿è¡Œä¹‹ådocker <span class="built_in">log</span> -f jenkinsæŸ¥çœ‹æ—¥å¿—éƒ½ä¼šæ²¡æœ‰æƒé™</span><br><span class="line">--privilegedï¼šç›¸å½“äºzabbixéœ€è¦ç›‘æ§å®¿ä¸»æœºï¼Œæƒ³è¦æœ‰æƒé™å°±éœ€è¦è¿™ä¸ªå‚æ•°ï¼Œè¿˜å¯ä»¥è®©å®¹å™¨æœ‰æƒé™èƒ½ä½¿ç”¨å®¿ä¸»æœºä¸Šçš„dockerå‘½ä»¤</span><br><span class="line">dockerå®¹å™¨æƒ³è¦ä½¿ç”¨å®¿ä¸»æœºçš„å‘½ä»¤å°±æ˜¯docker <span class="keyword">in</span> docker</span><br><span class="line">-v /usr/bin/dockerï¼šå°†å®¿ä¸»æœºçš„dockerå‘½ä»¤æ˜ å°„ï¼Œå®¹å™¨é‡Œé¢å°±å¯ä»¥æ‰§è¡Œdocker ps..</span><br><span class="line">-v /var/run/docker.sockï¼šdockerçš„å‘½ä»¤é€šè¿‡socktè¿æ¥çš„ï¼Œéœ€è¦æ˜ å°„sockæ–‡ä»¶ï¼Œç”±äºå®¹å™¨é‡Œé¢æ²¡æœ‰sockæ–‡ä»¶ï¼Œä¸ç„¶æ‰§è¡Œdockerå‘½ä»¤ä¼šæŠ¥é”™</span><br><span class="line"><span class="comment">#è§£å†³jenkinsç”Ÿæˆå¯†é’¥åˆ°gitlab,å¦‚æœåœ¨å®¹å™¨é‡Œé¢ç”Ÿæˆå¯†é’¥å¯¹ï¼Œä¸‡ä¸€jenkinså®•æœºäº†ï¼Œåœ¨é‡æ–°ç”Ÿæˆå¯†é’¥å¯¹ï¼Œä¹‹å‰æ”¾åˆ°gitlabé‡Œé¢çš„å¯†é’¥å¯¹å°±ä¸èƒ½ä½¿ç”¨äº†ï¼Œä¸ºäº†å¯†é’¥å¯¹æŒä¹…åŒ–ï¼Œéœ€è¦åœ¨å®¿ä¸»æœºä¸Šç”Ÿæˆå¯†é’¥å¯¹ï¼Œæ˜ å°„åˆ°å®¹å™¨</span></span><br><span class="line">[root@docker02 ~]# ssh-keygen</span><br><span class="line">-v /root/.sshï¼šå°†å®¿ä¸»æœºçš„å¯†é’¥å¯¹æ˜ å°„åˆ°å®¹å™¨</span><br><span class="line">-v /root/.docker/config.jsonï¼šå°†ç™»å½•harborçš„è®¤è¯ä¿¡æ¯æ˜ å°„ï¼Œå®¹å™¨å°±å¯ä»¥æ¨é€é•œåƒåˆ°harbor</span><br><span class="line"></span><br><span class="line">3ã€ä¸Šä¼ æ’ä»¶</span><br><span class="line"></span><br><span class="line">4ã€è§£å‹æ’ä»¶</span><br><span class="line">[root@docker02 ~]# tar xf jenkins_plugins_2.422.tgz -C /data/jenkins/</span><br><span class="line"></span><br><span class="line">5ã€å†é‡æ–°å¯åŠ¨jenkins</span><br><span class="line">[root@docker02 ~]# docker restart jenkins</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€æµè§ˆå™¨è®¿é—®ç½‘é¡µ</span><br><span class="line">10.0.0.102:8080</span><br><span class="line"></span><br><span class="line">7ã€æŸ¥çœ‹å¯†ç </span><br><span class="line">[root@docker02 ~]# docker <span class="built_in">exec</span> -it jenkins <span class="built_in">cat</span> /var/jenkins_home/secrets/initialAdminPassword</span><br><span class="line">3766efc193fe418f9256897f39840929</span><br><span class="line"></span><br><span class="line">ç”±äº/var/jenkins_homeç›®å½•å·²ç»æ˜ å°„å‡ºæ¥åœ¨å®¿ä¸»æœºä¸Šå·²ç»æŒä¹…åŒ–äº†ï¼Œè¿˜å¯ä»¥è¿™æ ·æŸ¥çœ‹å¯†ç æ–‡ä»¶</span><br><span class="line">[root@docker02 ~]# <span class="built_in">cat</span> /data/jenkins/secrets/initialAdminPassword </span><br><span class="line">3766efc193fe418f9256897f39840929</span><br><span class="line"></span><br><span class="line">ç„¶åå‡ºç°å®‰è£…jenkinsæ’ä»¶çš„é¡µé¢ä¹‹é—´ï¼Œä¸è¦å®‰è£…æ’ä»¶ï¼Œç›´æ¥ç‚¹å‡»å³ä¸Šè§’çš„Ã—â€”â€”&gt;ç‚¹å‡»å¼€å§‹ä½¿ç”¨jenkins</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240907175615967.png" alt="image-20240907175615967"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">8ã€å°†æ­å»ºäº†jenkinsæœåŠ¡å™¨çš„å…¬é’¥æ”¾åˆ°gitlabæœåŠ¡å™¨</span><br><span class="line">[root@docker02 ~]# <span class="built_in">cat</span> .ssh/id_rsa.pub </span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDPOMkDhGerkcJCwv55/6B4vTtzY0gxDKDYibzGUHX18AKgN8eZUBQVyub/mLmhBYlPWBIlb8x1xzNqH6N+kt/aIp03KheYAJBk26Npc8vtVEh009kf9DU3q4QopDrbKOmaF21/0LZ+ZVsAT0AmPKVH8pWodOv9O8aoXoVZe+uxAD+nItopJ6bnDzalKLEeVadtGZqm4k+AZRY2W7bZFUlss6WEKB2DLWfnf4FkIkDBQqLTPOS8ovB4U9gEBqN0vRFGI9qa1dDE4I9bK3ISKWBLR1yzV5wA4ARszXuj4t/nEP71qWfdi3vi9xdYvWStGdWa487nIFgi7s96ix9g8QBD root@docker02</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240907182329531.png" alt="image-20240907182329531"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">9ã€jenkinsæœºå™¨æ‹‰å–gitlabé‡Œé¢çš„ä»£ç </span><br><span class="line">è¿›å…¥jenkinså®¹å™¨</span><br><span class="line">[root@docker02 ~]# docker <span class="built_in">exec</span> -it jenkins /bin/bash</span><br><span class="line"></span><br><span class="line">10ã€æ‹‰å–ä»£ç </span><br><span class="line">root@126b61b9d225:/# git <span class="built_in">clone</span> ssh://git@10.0.0.102:2222/root/web.git</span><br><span class="line">è¾“å…¥<span class="built_in">yes</span>ï¼Œä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œç›´æ¥å…å¯†æ‹‰å–ä»£ç </span><br></pre></td></tr></table></figure><h3 id="3ã€æµ‹è¯•å°†jenkinsé‡Œé¢çš„é•œåƒæ¨é€åˆ°Harborå›¾å½¢åŒ–é•œåƒä»“åº“"><strong>3ã€æµ‹è¯•å°†jenkinsé‡Œé¢çš„é•œåƒæ¨é€åˆ°Harborå›¾å½¢åŒ–é•œåƒä»“åº“</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1ã€è¿›å…¥jenkinså®¹å™¨</span><br><span class="line">[root@docker02 ~]# docker <span class="built_in">exec</span> -it jenkins /bin/bash</span><br><span class="line">root@126b61b9d225:/# docker images</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€å°†é•œåƒæ”¹å</span><br><span class="line">root@126b61b9d225:/# docker tag wordpress:v7 172.16.1.76/wordpress/wordpress-jenkins-harbor:v7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€æ¨é€é•œåƒ   æŠ¥é”™ï¼Œæ˜¯å› ä¸ºéœ€è¦ç™»å½•ï¼Œä½†æ˜¯æ¯æ¬¡é‡å¯éƒ½éœ€è¦ç™»å½•</span><br><span class="line">root@126b61b9d225:/# docker push 172.16.1.76/wordpress/wordpress-jenkins-harbor:v7</span><br><span class="line">unauthorized: unauthorized to access repository: wordpress/wordpress-jenkins-harbor, action: push: unauthorized to access repository: wordpress/wordpress-jenkins-harbor, action: push</span><br><span class="line"></span><br><span class="line">4ã€æ£€æŸ¥å®¿ä¸»æœºæ˜¯å¦èƒ½å¤Ÿæ¨é€</span><br><span class="line">[root@docker02 ~]# docker push 172.16.1.76/wordpress/wordpress-jenkins-harbor:v7</span><br><span class="line">unauthorized: unauthorized to access repository: wordpress/wordpress-jenkins-harbor, action: push: unauthorized to access repository: wordpress/wordpress-jenkins-harbor, action: push</span><br><span class="line"></span><br><span class="line">5ã€å®¿ä¸»æœºä¸èƒ½æ¨é€ï¼Œéœ€è¦ç™»å½•harbor</span><br><span class="line">[root@docker01 ~]# docker login 172.16.1.76</span><br><span class="line">Username: admin</span><br><span class="line">Password:  <span class="comment">#å¯†ç ï¼šHarbor12345</span></span><br><span class="line">......</span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line">6ã€å®¿ä¸»æœºæ­£å¸¸æ¨é€  æ¨é€æˆåŠŸ</span><br><span class="line">[root@docker02 ~]# docker push 172.16.1.76/wordpress/wordpress-jenkins-harbor:v7</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240907210452739.png" alt="image-20240907210452739"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">7ã€å®¿ä¸»æœºèƒ½å¤Ÿæ¨é€é•œåƒï¼Œä½†æ˜¯å®¹å™¨ä¸ä¸€å®šèƒ½æ¨ï¼Œå› ä¸ºå®¹å™¨ä¹Ÿæ˜¯éœ€è¦loginç™»å½•çš„ï¼Œä½†æ˜¯è¿™é‡Œä¸éœ€è¦å®¹å™¨ç™»å½•</span><br><span class="line">å®¿ä¸»æœºç™»å½•äº†ä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªè®¤è¯ä¿¡æ¯åšå‡ºä¸€ä¸ªæ–‡ä»¶ä¿å­˜åˆ°~/.docker/config.json</span><br><span class="line">[root@docker02 ~]# ll -a ~/.docker/config.json </span><br><span class="line">-rw------- 1 root root 139 Sep  7 21:02 /root/.docker/config.json</span><br><span class="line">[root@docker02 ~]# <span class="built_in">cat</span> ~/.docker/config.json</span><br><span class="line">&#123;</span><br><span class="line">        <span class="string">&quot;auths&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;10.0.0.76&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;auth&quot;</span>: <span class="string">&quot;YWRtaW46SGFyYm9yMTIzNDU=&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;172.16.1.76&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;auth&quot;</span>: <span class="string">&quot;YWRtaW46SGFyYm9yMTIzNDU=&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment">#æ‰€ä»¥ï¼Œæ˜¯éœ€è¦åœ¨å¯åŠ¨jenkinsçš„æ—¶å€™ï¼Œå°†è®¤è¯ä¿¡æ¯çš„æ–‡ä»¶æ˜ å°„ï¼Œè¿™æ ·jenkinså®¹å™¨å°±å¯ä»¥æ¨é€é•œåƒåˆ°Harborä»åº“ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™æˆ‘å·²ç»åŠ ä¸Šè¿™ä¸ªæ–‡ä»¶æ˜ å°„äº†çš„ï¼Œåªè¦æˆ‘çš„å®¿ä¸»æœºç™»å½•è¿‡ï¼Œæˆ‘çš„jenkinså®¹å™¨å¯ä»¥æ¨é€</span></span><br></pre></td></tr></table></figure><h3 id="4ã€jenkinså®¹å™¨æ„å»ºä»£ç ä¸Šçº¿â€”â€”è‡ªç”±é£æ ¼"><strong>4ã€jenkinså®¹å™¨æ„å»ºä»£ç ä¸Šçº¿â€”â€”è‡ªç”±é£æ ¼</strong></h3><p>1ã€æµ‹è¯•æ„å»º</p><p><img src="../image/study_img/image-20240907230455222.png" alt="image-20240907230455222"></p><p><img src="../image/study_img/image-20240907234349843.png" alt="image-20240907234349843"></p><p>å¤åˆ¶ä»£ç åœ°å€</p><p><img src="../image/study_img/image-20240907234446792.png" alt="image-20240907234446792"></p><p><img src="../image/study_img/image-20240907234558247.png" alt="image-20240907234558247"></p><p><img src="../image/study_img/image-20240908000318150.png" alt="image-20240908000318150"></p><p>æ‰§è¡Œæ„å»ºï¼Œæ„å»ºæˆåŠŸ</p><p><img src="../image/study_img/image-20240908000821406.png" alt="image-20240908000821406"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1ã€#æ‹‰å–åä»£ç å­˜æ”¾çš„ç›®å½•</span><br><span class="line">[root@docker02 ~]# ll /data/jenkins/workspace/web-frestlye/</span><br><span class="line">-rw-r--r-- 1 root root    7 Sep  8 00:06 index.html</span><br><span class="line">-rw-r--r-- 1 root root 6141 Sep  8 00:06 README.md</span><br><span class="line"></span><br><span class="line">2ã€#å…å¯†webæœåŠ¡å™¨</span><br><span class="line">[root@docker02 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.101</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;WORKSPACE&#125;</span></span><br><span class="line">/var/jenkins_home/workspace/web-frestlye</span><br></pre></td></tr></table></figure><p>2ã€å†™è„šæœ¬æ„å»º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">harbor_ip=172.16.1.76</span><br><span class="line">web_ip=172.16.1.101</span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$&#123;WORKSPACE&#125;</span>/Dockerfile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">FROM nginx:alpine</span></span><br><span class="line"><span class="string">#å°†ç½‘é¡µä»£ç å¤åˆ¶åˆ°nginxçš„ç«™ç‚¹ç›®å½•ä¸‹</span></span><br><span class="line"><span class="string">COPY index.html /usr/share/nginx/html/</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment">#è¿›å…¥å·¥ä½œç›®å½•æ„å»ºé•œåƒ</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;WORKSPACE&#125;</span> &amp;&amp; \</span><br><span class="line">docker build -t <span class="variable">$&#123;harbor_ip&#125;</span>/wordpress/web-frestlye:v1 .</span><br><span class="line"><span class="comment">#æ‰“å®Œé•œåƒåæ¨é€åˆ°Harborä»“åº“</span></span><br><span class="line">docker push <span class="variable">$&#123;harbor_ip&#125;</span>/wordpress/web-frestlye:v1</span><br><span class="line"><span class="comment">#è¿æ¥åˆ°webæœåŠ¡å™¨æŠŠé•œåƒä»harboræ‹‰ä¸‹æ¥,æ³¨æ„jenkinsæœºå™¨è¦å’Œwebå…å¯†</span></span><br><span class="line">ssh root@<span class="variable">$&#123;web_ip&#125;</span> <span class="string">&quot;docker pull <span class="variable">$&#123;harbor_ip&#125;</span>/wordpress/web-frestlye:v1&quot;</span></span><br><span class="line"><span class="comment">#åˆ é™¤ä¹‹å‰æ—§çš„webé•œåƒ</span></span><br><span class="line">ssh root@<span class="variable">$&#123;web_ip&#125;</span> <span class="string">&quot;docker rm -f web&quot;</span></span><br><span class="line"><span class="comment">#åœ¨webæœåŠ¡å™¨éƒ¨ç½²nginxç½‘é¡µä»£ç </span></span><br><span class="line">ssh root@<span class="variable">$&#123;web_ip&#125;</span> <span class="string">&quot;docker run --name web -p 80:80 -d <span class="variable">$&#123;harbor_ip&#125;</span>/wordpress/web-frestlye:v1&quot;</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240908230050715.png" alt="image-20240908230050715"></p><p><img src="../image/study_img/image-20240908230246558.png" alt="image-20240908230246558"></p><h3 id="5ã€jenkinså®¹å™¨æ„å»ºä»£ç ä¸Šçº¿â€”â€”å‚æ•°åŒ–æ„å»º"><strong>5ã€jenkinså®¹å™¨æ„å»ºä»£ç ä¸Šçº¿â€”â€”å‚æ•°åŒ–æ„å»º</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¬¬ä¸€ç‰ˆ</span><br><span class="line">[root@docker02 ~]# <span class="built_in">mkdir</span> /web</span><br><span class="line">[root@docker02 ~]# <span class="built_in">cd</span> /web</span><br><span class="line">[root@docker02 web]# git init /web</span><br><span class="line">[root@docker02 web]# vim index.html</span><br><span class="line">[root@docker02 web]# vim src.js</span><br><span class="line">[root@docker02 web]# git add .</span><br><span class="line">[root@docker02 web]#  git config --global user.email <span class="string">&quot;you@example.com&quot;</span></span><br><span class="line">[root@docker02 web]# git config --global user.name <span class="string">&quot;Your Name&quot;</span></span><br><span class="line">[root@docker02 web]# git commit -m <span class="string">&#x27;å®˜ç½‘v1.0&#x27;</span></span><br><span class="line">[root@docker02 web]#  git tag -a <span class="string">&#x27;v1&#x27;</span>  -m <span class="string">&quot;å®˜ç½‘v1.0&quot;</span></span><br><span class="line">[root@docker02 web]# git remote add origin ssh://git@10.0.0.102:2222/root/web-website.git</span><br><span class="line">[root@docker02 web]# git push --all</span><br><span class="line">[root@docker02 web]# git push --tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ç¬¬äºŒç‰ˆ</span><br><span class="line">[root@docker02 web]# vim src.js</span><br><span class="line">[root@docker02 web]# git add .</span><br><span class="line">[root@docker02 web]# git commit -m <span class="string">&#x27;å®˜ç½‘v2.0&#x27;</span></span><br><span class="line">[root@docker02 web]# git tag -a <span class="string">&#x27;v2&#x27;</span>  -m <span class="string">&quot;å®˜ç½‘v2.0&quot;</span></span><br><span class="line">[root@docker02 web]# git push --all</span><br><span class="line">[root@docker02 web]# git push --tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä»£ç ä¸éœ€è¦è½¯è¿æ¥äº†ã€‚å·²ç»å®¹å™¨éƒ¨ç½²äº†ï¼Œä»£ç å¯ä»¥éšä¾¿åˆ é™¤</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240909172701792.png" alt="image-20240909172701792"></p><p><img src="../image/study_img/image-20240909224852871.png" alt="image-20240909224852871"></p><p><img src="../image/study_img/image-20240909224914742.png" alt="image-20240909224914742"></p><p><img src="../image/study_img/image-20240909224936189.png" alt="image-20240909224936189"></p><p><img src="../image/study_img/image-20240909225006620.png" alt="image-20240909225006620"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">harbor_ip=172.16.1.76</span><br><span class="line">project_name=<span class="string">&#x27;wordpress&#x27;</span></span><br><span class="line">pkg_name=<span class="string">&#x27;$&#123;harbor_ip&#125;/$&#123;project_name&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$&#123;WORKSPACE&#125;</span>/Dockerfile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">FROM nginx:alpine</span></span><br><span class="line"><span class="string">#å°†ç½‘é¡µä»£ç å¤åˆ¶åˆ°nginxçš„ç«™ç‚¹ç›®å½•ä¸‹</span></span><br><span class="line"><span class="string">COPY ./* /usr/share/nginx/html/</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥å·¥ä½œç›®å½•æ„å»ºé•œåƒ</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$&#123;WORKSPACE&#125;</span> &amp;&amp; \</span><br><span class="line">docker build -t <span class="variable">$&#123;pkg_name&#125;</span>/web-frestlye:<span class="variable">$&#123;git_tag&#125;</span> .</span><br><span class="line"><span class="comment">#æ‰“å®Œé•œåƒåæ¨é€åˆ°Harborä»“åº“</span></span><br><span class="line">docker push <span class="variable">$pkg_name</span>&#125;/web-frestlye:<span class="variable">$&#123;git_tag&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">deploy</span></span> () &#123;</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="variable">$@</span> ;<span class="keyword">do</span></span><br><span class="line"><span class="comment">#è¿æ¥åˆ°webæœåŠ¡å™¨æŠŠé•œåƒä»harboræ‹‰ä¸‹æ¥,æ³¨æ„jenkinsæœºå™¨è¦å’Œwebå…å¯†</span></span><br><span class="line">ssh root@172.16.1.<span class="variable">$&#123;n&#125;</span> <span class="string">&quot;docker pull <span class="variable">$&#123;harbor_ip&#125;</span>/wordpress/web-frestlye:<span class="variable">$&#123;git_tag&#125;</span>&quot;</span></span><br><span class="line"><span class="comment">#åˆ é™¤ä¹‹å‰æ—§çš„webé•œåƒ</span></span><br><span class="line">ssh root@172.16.1.<span class="variable">$&#123;n&#125;</span> <span class="string">&quot;docker rm -f web&quot;</span></span><br><span class="line"><span class="comment">#åœ¨webæœåŠ¡å™¨éƒ¨ç½²nginxç½‘é¡µä»£ç </span></span><br><span class="line">ssh root@172.16.1.<span class="variable">$&#123;n&#125;</span> <span class="string">&quot;docker run --name web -p 80:80 -d <span class="variable">$&#123;harbor_ip&#125;</span>/wordpress/web-frestlye:<span class="variable">$&#123;git_tag&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$env</span> <span class="keyword">in</span></span><br><span class="line">dev)</span><br><span class="line"><span class="comment">#ç»™å‡½æ•°ä¼ å‚æ•° ä¼ é€’æœºå™¨çš„ip</span></span><br><span class="line">   deploy 101</span><br><span class="line">   ;;</span><br><span class="line">prod)</span><br><span class="line">   deploy 103</span><br><span class="line">   ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240909225041225.png" alt="image-20240909225041225"></p><h3 id="6ã€jenkinså®¹å™¨æ„å»ºä»£ç ä¸Šçº¿â€”â€”MAVENé¡¹ç›®æ„å»º"><strong>6ã€jenkinså®¹å™¨æ„å»ºä»£ç ä¸Šçº¿â€”â€”MAVENé¡¹ç›®æ„å»º</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1ã€å“ªå°æœºå™¨éœ€è¦éƒ¨ç½²javaä»£ç ï¼Œåˆ°dockerå®˜ç½‘æ‹‰å–tomcat</span><br><span class="line">docker pull tomcat:alpine </span><br><span class="line">éœ€è¦å…ˆæ‰‹åŠ¨ç¼–è¯‘ä»£ç ï¼Œä¸‹è½½maven</span><br><span class="line">yum -y install maven</span><br><span class="line"></span><br><span class="line">2ã€ä¸‹è½½javaä»£ç helloword</span><br><span class="line"></span><br><span class="line">3ã€è¿è¡Œtmocat</span><br><span class="line">docker run -p 8080:8080 -d tomcat:alpine </span><br><span class="line"></span><br><span class="line">æ”¹Mavenæºã€‚æ¢æˆé˜¿é‡Œäº‘çš„æº</span><br><span class="line">vim</span><br><span class="line"></span><br><span class="line">æ„å»º  æ„å»ºå®Œæˆä¹‹åä¼šç”Ÿæˆä¸€ä¸ªtargetç›®å½•</span><br><span class="line">maven pakage</span><br><span class="line"><span class="built_in">cd</span> target/hellowrd</span><br><span class="line">tar zcf hello-1.0.0.tgz</span><br><span class="line"></span><br><span class="line">vim Dockerfile</span><br><span class="line">FROM tomcat:alpine </span><br><span class="line">RUN <span class="built_in">rm</span> -rf /usr/local/tomcat/webapps/ROOT/*</span><br><span class="line">ADD hello-1.0.0.tgz /usr/local/tomcat/webapps/ROOT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker build -t 172.16.1.76/wordpress/hello:v1 .</span><br><span class="line">docker run -p 8080:8080 -d 172.16.1.76/wordpress/hello:v1</span><br><span class="line"></span><br><span class="line">ç›®å‰è®¿é—®çš„æ—¶å€™è¦åŠ ä¸Šç›®å½•ï¼Œtomcatå‰é¢ä¼šåŠ ä¸Šnginxåšä»£ç†ï¼Œä»£ç†è¿™ä¸ªç›®å½•</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240909092954321.png" alt="image-20240909092954321"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#jenkinsæœºå™¨</span></span><br><span class="line">èµ·å®¿ä¸»æœºæŠŠmavenæ˜ å°„è¿›å»  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Jenkinsæ—¶åŒºä¸å¯¹ï¼Œå·®8ä¸ªå°æ—¶ï¼Œè§£å†³æ–¹æ¡ˆ</span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it -u root jenkins bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹å®¹å™¨æ—¶åŒº</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&#x27;Asia/Shanghai&#x27;</span> &gt; /etc/timezone</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ä¿®æ”¹åçš„å®¹å™¨æ—¶åŒº</span></span><br><span class="line"><span class="built_in">cat</span> /etc/timezone</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡å¯jenkinså®¹å™¨</span></span><br><span class="line">docker restart jenkins</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœè§‰å¾—Jenkinså ç”¨å†…å­˜è¿‡å¤§,æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸‹é¢çš„æ–¹å¼é™åˆ¶ienkinså ç”¨å†…å­˜å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dockeré™åˆ¶å†…å­˜å¤§å°</span></span><br><span class="line">docker update jenkins -m 3g --memory-swap -1</span><br><span class="line"></span><br><span class="line">--memory æˆ–-m é™åˆ¶å®¹å™¨çš„å†…å­˜ä½¿ç”¨é‡</span><br><span class="line">--memory-swap é™åˆ¶å†…å­˜å’Œswapçš„æ€»å’Œï¼Œä¸è®¾ç½®çš„è¯é»˜è®¤ä¸º--memoryçš„ä¸¤å€</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡äº”ã€Dockerçš„å›¾å½¢åŒ–Portainer</title>
      <link href="/posts/812941c2.html"/>
      <url>/posts/812941c2.html</url>
      
        <content type="html"><![CDATA[<h3 id="Dockerçš„å›¾å½¢åŒ–Portainer">Dockerçš„å›¾å½¢åŒ–Portainer</h3><p>å¯åŠ¨Portainer     å¡æ³°äº†</p><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>elk1</td><td>10.0.0.76  /  172.16.1.76</td><td>å›¾å½¢åŒ–portainer</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@elk1 harbor]# docker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock --restart=always --name portainer portainer/portainer</span><br><span class="line"></span><br><span class="line">2ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">http://10.0.0.76:9000/</span><br><span class="line"></span><br><span class="line">3ã€ç™»å½•è¿›å»å¯èƒ½å›æç¤ºportainerè¶…æ—¶ï¼Œéœ€è¦é‡å¯</span><br><span class="line">[root@elk1 harbor]# docker restart  portainer</span><br><span class="line">portainer</span><br><span class="line"></span><br><span class="line">4ã€é‡å¯ä¹‹åå†è®¿é—®é¡µé¢ï¼Œè¿›å»åˆ·æ–°ï¼Œè®¾ç½®åˆå§‹å¯†ç  12ä½çš„</span><br><span class="line">aaaaaa111111</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240906175708573.png" alt="image-20240906175708573"></p><p>5ã€æŸ¥çœ‹æœ¬åœ°çš„docker</p><p><img src="../image/study_img/image-20240906175929805.png" alt="image-20240906175929805"></p><p><img src="../image/study_img/image-20240906180028688.png" alt="image-20240906180028688"></p><p>æ­¤å¤„å¯ä»¥å¯åŠ¨å®¹å™¨</p><p><img src="../image/study_img/image-20240906180212414.png" alt="image-20240906180212414"></p><p>6ã€æµ‹è¯•æ‹‰å–ä¸€ä¸ªé•œåƒå¹¶å¯åŠ¨</p><p><img src="../image/study_img/image-20240906180900453.png" alt="image-20240906180900453"></p><p><img src="../image/study_img/image-20240906180924462.png" alt="image-20240906180924462"></p><p>ç­‰å¾…ä¸€ä¼šï¼Œæ˜¾ç¤ºæ‹‰å–é•œåƒå¹¶å¯åŠ¨æˆåŠŸï¼Œè·³è½¬åˆ°å®¹å™¨å¯åŠ¨çš„é¡µé¢ï¼Œå¹¶ä¸”åœ¨å‘½ä»¤è¡Œä¸»å¯ä»¥æŸ¥çœ‹åˆ°å·²æ‹‰å–æˆåŠŸï¼Œå¯åŠ¨æˆåŠŸ</p><p><img src="../image/study_img/image-20240906181242551.png" alt="image-20240906181242551"></p><p><img src="../image/study_img/image-20240906181309969.png" alt="image-20240906181309969"></p><p>7ã€æŸ¥çœ‹æ‰€æœ‰é•œåƒ</p><p><img src="../image/study_img/image-20240906181607353.png" alt="image-20240906181607353"></p><p>8ã€æµ‹è¯•æ‹‰å–é•œåƒ</p><p><img src="../image/study_img/image-20240906181951743.png" alt="image-20240906181951743"></p><p>9ã€æŒ‚è½½ç›®å½•çš„é¡µé¢</p><p><img src="../image/study_img/image-20240906182154901.png" alt="image-20240906182154901"></p><p>10ã€äº‹ä»¶çš„æŸ¥çœ‹ï¼Œå“ªä¸ªå®¹å™¨é€€å‡ºäº†ï¼ŒæŸ¥çœ‹æ—¥å¿—</p><p><img src="../image/study_img/image-20240906182246878.png" alt="image-20240906182246878"></p><p>12ã€æŸ¥çœ‹ç‰©ç†æœºçš„ä¿¡æ¯</p><p><img src="../image/study_img/image-20240906182322538.png" alt="image-20240906182322538"></p><p>13ã€æ·»åŠ è‡ªå·±çš„é•œåƒä»“åº“ã€‚æ‹‰å–å®¹å™¨çš„æ—¶å€™å°±å»è‡ªå·±åˆ›å»ºçš„ä»“åº“é‡Œé¢æ‹‰å–</p><p><img src="../image/study_img/image-20240906182455490.png" alt="image-20240906182455490"></p><p><img src="../image/study_img/image-20240906182652673.png" alt="image-20240906182652673"></p><p>æ·»åŠ ä¹‹åï¼Œå¦‚æœæƒ³æ‹‰å–è‡ªå·±ä»“åº“é‡Œé¢çš„å®¹å™¨ï¼Œå°±è¿™æ ·é€‰æ‹©</p><p><img src="../image/study_img/image-20240906182823018.png" alt="image-20240906182823018"></p><p>æ‹‰å–harboré‡Œé¢çš„å®¹å™¨</p><p><img src="../image/study_img/image-20240906182929405.png" alt="image-20240906182929405"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#portaineréœ€è¦ä¿¡ä»»harborçš„åœ°å€</span></span><br><span class="line">[root@elk1 harbor]# vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.1panel.live&quot;</span>, <span class="string">&quot;https://hub.rat.dev/&quot;</span>, <span class="string">&quot;https://docker.chenby.cn&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>],</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;http://10.0.0.76&quot;</span>,<span class="string">&quot;http://172.16.1.101:5000&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@elk1 harbor]# systemctl restart docker</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240906183541971.png" alt="image-20240906183541971"></p><p>14ã€ç®¡ç†docker01 ~ 03æœºå™¨çš„é•œåƒ</p><p><img src="../image/study_img/image-20240906183926754.png" alt="image-20240906183926754"></p><p><img src="../image/study_img/image-20240906184008628.png" alt="image-20240906184008628"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨æƒ³è¦ç®¡ç†çš„dockeræœºå™¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤</span></span><br><span class="line">docker run -d \</span><br><span class="line">  -p 9001:9001 \</span><br><span class="line">  --name portainer_agent \</span><br><span class="line">  --restart=always \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  -v /var/lib/docker/volumes:/var/lib/docker/volumes \</span><br><span class="line">  portainer/agent:2.16.2</span><br><span class="line">  </span><br><span class="line"><span class="comment">#é‡å¯docker</span></span><br><span class="line">  systemctl restart docker</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240906185043251.png" alt="image-20240906185043251"></p><p><img src="../image/study_img/image-20240906185302712.png" alt="image-20240906185302712"></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡å››ã€dockerçš„ç½‘ç»œä¸Harboré•œåƒä»“åº“</title>
      <link href="/posts/5c6d7d69.html"/>
      <url>/posts/5c6d7d69.html</url>
      
        <content type="html"><![CDATA[<h2 id="dockerçš„ç½‘ç»œä¸Harboré•œåƒä»“åº“">dockerçš„ç½‘ç»œä¸Harboré•œåƒä»“åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">101ä¸Šèµ·çš„å®¹å™¨å’Œ103ä¸Šèµ·çš„å®¹å™¨ä¸èƒ½é€šä¿¡</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å®¹å™¨çš„ip</span></span><br><span class="line"><span class="comment">#101èµ·centos</span></span><br><span class="line">[root@docker01 ~]# docker run --<span class="built_in">link</span> mysql80 -it centos:7 /bin/bash</span><br><span class="line">[root@56db98b318bb /]# ping mysql80</span><br><span class="line">PING mysql80 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from mysql80 (172.17.0.2): icmp_seq=1 ttl=64 time=0.271 ms</span><br><span class="line"></span><br><span class="line">mysql80å®¹å™¨çš„ipæ˜¯ï¼š172.17.0.2</span><br><span class="line"></span><br><span class="line"><span class="comment">#102èµ·centos</span></span><br><span class="line">[root@bdc4ac174cb6 /]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line"></span><br><span class="line">å¯ä»¥å‘ç°æ˜¯pingä¸é€šçš„ï¼Œå¦‚æœå¼€å¯å†…æ ¸è½¬ï¼Œå°±å¯ä»¥é€šä¿¡ï¼ŒAè™šæ‹Ÿæœºé‡Œé¢èµ·çš„å®¹å™¨å°±ä¸Bè™šæ‹Ÿæœºå¯ä»¥é€šä¿¡</span><br></pre></td></tr></table></figure><h3 id="1ã€Bridgeæ¡¥æ¥æ¨¡å¼-docker-é»˜è®¤çš„ç½‘ç»œæ¨¡å¼"><strong>1ã€Bridgeæ¡¥æ¥æ¨¡å¼  (docker é»˜è®¤çš„ç½‘ç»œæ¨¡å¼)</strong></h3><p>Bridgeï¼šDockerè®¾è®¡çš„NATç½‘ç»œæ¨¡å‹ é»˜è®¤ç±»å‹ï¼Œç±»ä¼¼äºè™šæ‹Ÿæœºé‡Œé¢çš„NATæ¨¡å¼</p><p><img src="../image/study_img/image-20240905150011381.png" alt="image-20240905150011381"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">ä½ çš„å®¹å™¨æ¡¥æ¥åˆ°docker0é‚£ä¸ªç½‘å¡ï¼Œå®¹å™¨çš„ç½‘å¡å’Œdocker0é‚£ä¸ªç½‘å¡åœ¨åŒä¸€ç½‘æ®µ</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰è™šæ‹Ÿæœºçš„ç½‘ç»œç±»å‹</span></span><br><span class="line">[root@docker02 ~]# docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">870935df49b1   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">a7fce1fe694d   host      host      <span class="built_in">local</span></span><br><span class="line">d7fe2c2b78e7   none      null      <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ¡¥æ¥æ¨¡å¼çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@docker01 ~]# docker network inspect bridge</span><br><span class="line"></span><br><span class="line"><span class="comment">## å®‰è£…bridge-utils æŸ¥çœ‹</span></span><br><span class="line">[root@docker01 ~]# brctl show</span><br><span class="line">bridge name bridge <span class="built_in">id</span> STP enabled interfaces</span><br><span class="line">docker0 8000.0242eca7bc4c no</span><br><span class="line"></span><br><span class="line"><span class="comment">#è°ƒè¯•ç½‘ç»œä¸“ç”¨é•œåƒ</span></span><br><span class="line">[root@docker01 ~]# docker run -it -d  busybox  /bin/sh</span><br><span class="line"></span><br><span class="line">å…¬å¸æœ‰è§„å®š å†…ç½‘çš„ipè§„å®š192æˆ–è€…168çš„ç½‘æ®µ</span><br><span class="line"><span class="comment">#ä¿®æ”¹æ¡¥æ¥æ¨¡å¼çš„ç½‘æ®µ</span></span><br><span class="line">æ–¹æ³•1ï¼šä¿®æ”¹dockerçš„å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@docker01 ~]# vim /lib/systemd/system/docker.service</span><br><span class="line">ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">--bip=192.168.10.1/24</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# systemctl daemon-reload</span><br><span class="line">[root@docker01 ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker run -it busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0 Link encap:Ethernet HWaddr 02:42:C0:A8:0A:03</span><br><span class="line">     inet addr:192.168.10.3 Bcast:192.168.10.255 Mask:255.255.255.0</span><br><span class="line">     UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span><br><span class="line">     RX packets:8 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">     TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">     collisions:0 txqueuelen:0</span><br><span class="line">     RX bytes:656 (656.0 B) TX bytes:0 (0.0 B)</span><br><span class="line"></span><br><span class="line">[root@docker02 ~]# docker run -it busybox /bin/sh</span><br><span class="line"><span class="comment">#è¿™ä¸ªæ˜¯ä¸“é—¨çš„ç½‘ç»œå·¥å…·ï¼Œç½‘ç»œç›¸å…³çš„å‘½ä»¤éƒ½æ”¯æŒ</span></span><br><span class="line"></span><br><span class="line">æ–¹æ³•2ï¼šä¿®æ”¹dockerçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@docker01 ~]# vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;bip&quot;</span>: <span class="string">&quot;192.168.30.1/24&quot;</span>,</span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.1panel.live&quot;</span>,<span class="string">&quot;https://hub.rat.dev/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://docker.chenby.cn&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">## æˆ–è€…</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.1panel.live&quot;</span>,<span class="string">&quot;https://hub.rat.dev/&quot;</span>,</span><br><span class="line"><span class="string">&quot;https://docker.chenby.cn&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>],</span><br><span class="line"><span class="string">&quot;bip&quot;</span>: <span class="string">&quot;192.168.30.1/24&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# systemctl daemon-reload</span><br><span class="line">[root@docker01 ~]# systemctl restart docker</span><br><span class="line">[root@docker01 ~]# docker run -it busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0 Link encap:Ethernet HWaddr 02:42:C0:A8:14:03</span><br><span class="line">     inet addr:192.168.20.3 Bcast:192.168.20.255 Mask:255.255.255.0</span><br><span class="line">     UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span><br><span class="line">     RX packets:6 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">     TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">     collisions:0 txqueuelen:0</span><br><span class="line">     RX bytes:516 (516.0 B) TX bytes:0 (0.0 B)</span><br><span class="line">     </span><br><span class="line">è¿™æ ·å­å°±å¯ä»¥å®šä¹‰å®¹å™¨çš„ç½‘æ®µäº†</span><br></pre></td></tr></table></figure><h3 id="2ã€Hostæ¨¡å¼">**2ã€Hostæ¨¡å¼   **</h3><p>hostï¼šä¸å®¿ä¸»æœºå…±äº«Network Namespaceï¼Œâ€“network=host æ€§èƒ½æœ€é«˜</p><p><img src="../image/study_img/image-20240905151204236.png" alt="image-20240905151204236"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run --network=host -d nginx:alpine</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker run -it --network=host nginx:alpine /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">docker0 Link encap:Ethernet HWaddr 02:42:77:C6:BE:B9</span><br><span class="line">        inet addr:192.168.20.1 Bcast:192.168.20.255 Mask:255.255.255.0</span><br><span class="line">        inet6 addr: fe80::42:77ff:fec6:beb9/64 Scope:Link</span><br><span class="line">        UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span><br><span class="line">        RX packets:3150 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">        TX packets:2794 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">        collisions:0 txqueuelen:0</span><br><span class="line">        RX bytes:7792958 (7.4 MiB) TX bytes:1119887 (1.0 MiB)</span><br><span class="line"></span><br><span class="line">eth0    Link encap:Ethernet HWaddr 00:0C:29:1A:2F:80</span><br><span class="line">        inet addr:10.0.0.101 Bcast:10.0.0.255 Mask:255.255.255.0</span><br><span class="line">        inet6 addr: fe80::20c:29ff:fe1a:2f80/64 Scope:Link</span><br><span class="line"></span><br><span class="line">å’Œä¸»æœºå…±äº«ç½‘å¡çš„æ¨¡å¼ï¼Œä¸€èˆ¬èµ·å®¹å™¨ä¸ä¼šç”¨åˆ°è¿™ä¸ªæ¨¡å¼</span><br></pre></td></tr></table></figure><h3 id="3ã€containeræ¨¡å¼"><strong>3ã€containeræ¨¡å¼</strong></h3><p>Containerï¼šä¸å¦ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨å…±äº«Network Namespaceï¼Œâ€“net=container:containerIDï¼ˆK8Sï¼‰</p><p><img src="../image/study_img/image-20240905114345031.png" alt="image-20240905114345031"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@docker01 ~]# docker run -it busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0 Link encap:Ethernet HWaddr 02:42:C0:A8:14:03</span><br><span class="line">     inet addr:192.168.20.3 Bcast:192.168.20.255 Mask:255.255.255.0</span><br><span class="line">     UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span><br><span class="line">     RX packets:6 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">     TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">     collisions:0 txqueuelen:0</span><br><span class="line">     RX bytes:516 (516.0 B) TX bytes:0 (0.0 B)</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker run -it --network=container:763cd9e2da94 centos:7 /bin/bash</span><br><span class="line">[root@docker01 ~]# docker run -it --network=container:763cd9e2da94 nginx:alpine /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0 Link encap:Ethernet HWaddr 02:42:C0:A8:14:03</span><br><span class="line">     inet addr:192.168.20.3 Bcast:192.168.20.255 Mask:255.255.255.0</span><br><span class="line">     UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</span><br><span class="line">     RX packets:8 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">     TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">     collisions:0 txqueuelen:0</span><br><span class="line">     RX bytes:656 (656.0 B) TX bytes:0 (0.0 B)</span><br></pre></td></tr></table></figure><h3 id="4ã€Noneæ¨¡å¼"><strong>4ã€Noneæ¨¡å¼</strong></h3><p>None:ä¸ä¸ºå®¢å™¨é…ç½®ä»»ä½•ç½‘ç»œåŠŸèƒ½ï¼Œâ€“net=none   æ²¡æœ‰ç½‘ç»œçš„æ¨¡å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨çš„æ—¶å€™æŒ‡å®š  </span><br><span class="line">[root@docker01 ~]# docker run -it --network=none busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">lo   Link encap:Local Loopback</span><br><span class="line">     inet addr:127.0.0.1 Mask:255.0.0.0</span><br><span class="line">     inet6 addr: ::1/128 Scope:Host</span><br><span class="line">     UP LOOPBACK RUNNING MTU:65536 Metric:1</span><br><span class="line">     RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">     TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">     collisions:0 txqueuelen:1000</span><br><span class="line">     RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240905113318250.png" alt="image-20240905113318250"></p><h3 id="5ã€Dockerè‡ªå®šä¹‰ç½‘ç»œæ¨¡å¼"><strong>5ã€Dockerè‡ªå®šä¹‰ç½‘ç»œæ¨¡å¼</strong></h3><p>åŸºäºä»¥ä¸Š4ç§æ¨¡å¼åˆ›å»ºç½‘ç»œ</p><p><img src="../image/study_img/image-20240905113509543.png" alt="image-20240905113509543"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è‡ªå®šä¹‰ç½‘ç»œ</span></span><br><span class="line">docker network create -d &lt;mode&gt; --subnet &lt;CIDR&gt; --gateway &lt;ç½‘å…³&gt; &lt;è‡ªå®šä¹‰ç½‘è·¯åç§°&gt;</span><br><span class="line">åˆ›å»º</span><br><span class="line">docker network create -d bridge --subnet 192.168.100.0/24 --gateway 192.168.100.1 abc-net</span><br><span class="line"></span><br><span class="line"><span class="comment">## å¼•ç”¨è‡ªå®šä¹‰ç½‘ç»œ</span></span><br><span class="line">[root@docker01 ~]# docker run -it --network=abc-net busybox /bin/sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å°±ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªäº¤æ¢æœº</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è‡ªå®šä¹‰ç½‘ç»œ</span></span><br><span class="line">[root@docker01 ~]# docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID NAME DRIVER SCOPE</span><br><span class="line">2b0a232f6643 bridge bridge <span class="built_in">local</span></span><br><span class="line">168f91213e19 host host <span class="built_in">local</span></span><br><span class="line">4de4c2edcb74 none null <span class="built_in">local</span></span><br><span class="line">7a7b8742e475 abc-net bridge <span class="built_in">local</span></span><br><span class="line">[root@docker01 ~]# docker network <span class="built_in">rm</span> abc-net</span><br><span class="line">abc-net</span><br><span class="line">[root@docker01 ~]# docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID NAME DRIVER SCOPE</span><br><span class="line">2b0a232f6643 bridge bridge <span class="built_in">local</span></span><br><span class="line">168f91213e19 host host <span class="built_in">local</span></span><br><span class="line">4de4c2edcb74 none null <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line">åˆ›å»ºäº†ç½‘ç»œå°±åˆ›å»ºäº†ä¸€ä¸ªæ¡¥æ¥çš„ç½‘å¡ï¼Œç›¸å½“äºä¸€ä¸ªç½‘å¡å°±æ˜¯ä¸€ä¸ªäº¤æ¢æœº</span><br><span class="line">dockeré»˜è®¤å°±æ˜¯bridgeæ¨¡å¼ï¼Œå½“æœ‰ä¸åŒçš„Â·é¡¹ç›®å°±è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼ŒæŠŠä¸åŒé¡¹ç›®çš„ä¸»æœºæ”¾åˆ°è¿™ä¸ªæ¨¡å¼é‡Œé¢</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240905113639559.png" alt="image-20240905113639559"></p><h3 id="6ã€Dockerç§æœ‰åˆ›å»ºHarbor">6ã€<strong>Dockerç§æœ‰åˆ›å»ºHarbor</strong></h3><p>Harbor æ˜¯ä¸ºä¼ä¸šç”¨æˆ·è®¾è®¡çš„å®¹å™¨é•œåƒä»“åº“å¼€æºé¡¹ç›®ï¼ŒåŒ…æ‹¬äº†æƒé™ç®¡ç†(RBAC)ã€+DAPã€å®¡è®¡ã€å®‰å…¨æ¼æ´æ‰«æã€é•œåƒéªŒçœŸã€ç®¡ç†ç•Œé¢ã€è‡ªæˆ‘æ³¨å†Œã€HA ç­‰ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ï¼ŒåŒæ—¶é’ˆå¯¹ä¸­å›½ç”¨æˆ·çš„ç‰¹ç‚¹ï¼Œè®¾è®¡é•œåƒå¤åˆ¶å’Œä¸­æ–‡æ”¯æŒç­‰åŠŸèˆ±   <a href="https://goharbor.io/">https://goharbor.io/</a></p><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>elk1</td><td>10.0.0.76  /  172.16.1.76</td><td>Harborå›¾å½¢åŒ–ä»“åº“</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">harbor å›¾å½¢åŒ–ç•Œé¢çš„  https://goharbor.io/</span><br><span class="line">registry å‘½ä»¤è¡Œæ“ä½œçš„</span><br><span class="line"></span><br><span class="line">ä¸‹è½½harborå¸¦offlineæ ‡ç­¾çš„ï¼Œæ‰€æœ‰çš„é•œåƒï¼Œå®‰è£…åŒ…é‡Œé¢éƒ½åœ¨ä¸€èµ·çš„æ‰€ä»¥æ¯”è¾ƒå¤§</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€#å®‰è£…dockerç¯å¢ƒ</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.huaweicloud.com/repository/conf/CentOS-7-anon.repo</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">sed -i <span class="string">&quot;s@http://mirrors.aliyun.com@https://mirrors.huaweicloud.com@g&quot;</span> /etc/yum.repos.d/epel.repo</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/yum.repos.d/docker-ce.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[docker-ce-stable]</span></span><br><span class="line"><span class="string">name=Docker CE Stable - $basearch</span></span><br><span class="line"><span class="string">baseurl=https://mirrors.huaweicloud.com/docker-ce/linux/centos/7/x86_64/stable</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=1</span></span><br><span class="line"><span class="string">gpgkey=https://mirrors.huaweicloud.com/docker-ce/linux/centos/gpg</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">sed -i <span class="string">&#x27;s+download.docker.com+mirrors.huaweicloud.com/docker-ce+&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/docker/daemon.json &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;registry-mirrors&quot;ï¼š[&quot;https://docker.1panel.live&quot;,&quot;https://hub.rat.dev/&quot;,&quot;https://docker.chenby.cn&quot;, &quot;https://docker.m.daocloud.io&quot;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.ä¸‹è½½harbor</span><br><span class="line">[root@harbor ~]# wget https://github.com/goharbor/harbor/releases/download/v2.11.1/harbor-offline-installer-v2.11.1.tgz</span><br><span class="line"></span><br><span class="line"> 3.è§£å‹</span><br><span class="line">[root@harbor ~]# tar xf harbor-offline-installer-v2.11.1.tgz </span><br><span class="line"></span><br><span class="line">4.è¿›å…¥harborç›®å½•</span><br><span class="line">[root@harbor harbor]# <span class="built_in">cd</span> /root/harbor/</span><br><span class="line">[root@elk1 harbor]# ll</span><br><span class="line">total 646848</span><br><span class="line">-rw-r--r-- 1 root root      3646 Aug 15 18:07 common.sh</span><br><span class="line">-rw-r--r-- 1 root root 662330539 Aug 15 18:07 harbor.v2.11.1.tar.gz#harborçš„æ‰€æœ‰é•œåƒ</span><br><span class="line">-rw-r--r-- 1 root root     14270 Aug 15 18:07 harbor.yml.tmpl</span><br><span class="line">-rwxr-xr-x 1 root root      1975 Aug 15 18:07 install.sh</span><br><span class="line">-rw-r--r-- 1 root root     11347 Aug 15 18:07 LICENSE</span><br><span class="line">-rwxr-xr-x 1 root root      1882 Aug 15 18:07 prepare</span><br><span class="line"></span><br><span class="line">5.æ”¹é…ç½®æ–‡ä»¶å</span><br><span class="line">[root@harbor harbor]# <span class="built_in">cp</span> /root/harbor/harbor.yml.tmpl /root/harbor/harbor.yml</span><br><span class="line"></span><br><span class="line">6.ä¿®æ”¹é…ç½®æ–‡ä»¶ (æ³¨é‡ŠHTTPSçš„é…ç½®)</span><br><span class="line">[root@harbor harbor]# vim harbor.yml</span><br><span class="line">ç¬¬5è¡Œ æ”¹æˆå½“å‰ä¸»æœºçš„ip</span><br><span class="line">hostname: 10.0.0.105</span><br><span class="line">47è¡Œï¼šå…ˆè®°å½•harborçš„å¯†ç </span><br><span class="line">harbor_admin_password: Harbor12345</span><br><span class="line"></span><br><span class="line">7.æ‰§è¡Œå®‰è£…è„šæœ¬</span><br><span class="line">[root@harbor harbor]# ./install.sh</span><br><span class="line">âœ” ----Harbor has been installed and started successfully.----#å‡ºç°è¿™ä¸ªå°±å®‰è£…æˆåŠŸ</span><br><span class="line"></span><br><span class="line">[root@harbor harbor]# docker images</span><br><span class="line">ä¼šçœ‹åˆ°harborè‡ªåŠ¨å®‰è£…çš„é•œåƒ</span><br><span class="line">[root@harbor harbor]# netstat -lntup</span><br><span class="line">ä¼šçœ‹åˆ°80ç«¯å£</span><br><span class="line"></span><br><span class="line">8ã€æµè§ˆå™¨è®¿é—®å½“å‰ä¸»æœºçš„IP</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240905171032747.png" alt="image-20240905171032747"></p><p>1ã€åˆ›å»ºé¡¹ç›®     -1 å°±æ˜¯æ— é™å¤§</p><p><img src="../image/study_img/image-20240905171320050.png" alt="image-20240905171320050"></p><p>2ã€ä¸Šä¼ é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸Šä¼ é•œåƒçš„éœ€æ±‚</span></span><br><span class="line">éœ€è¦ä¿®æ”¹é•œåƒåç§°ï¼šå‘½åè§„åˆ™</span><br><span class="line">harborçš„IPåœ°å€/é¡¹ç›®åç§°/é•œåƒåç§°:æ ‡ç­¾</span><br><span class="line"></span><br><span class="line">1ã€å°†é•œåƒé‡æ–°å‘½å</span><br><span class="line">[root@docker02 ~]# docker tag wordpress:v7 10.0.0.76/wordpress/wordpress:v7</span><br><span class="line"></span><br><span class="line">2ã€æ¨é€é•œåƒ  æŠ¥é”™</span><br><span class="line">[root@docker02 ~]# docker push 10.0.0.76/wordpress/wordpress:v7</span><br><span class="line">The push refers to repository [10.0.0.76/wordpress/wordpress]</span><br><span class="line">Get <span class="string">&quot;https://10.0.0.76/v2/&quot;</span>: dial tcp 10.0.0.76:443: connect: connection refused</span><br><span class="line">åŸå› æ˜¯æ²¡æœ‰ä¿¡ä»»ä¸å®‰å…¨çš„è¿æ¥</span><br><span class="line"></span><br><span class="line">3ã€ä¿®æ”¹dockeré…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¿¡ä»»ä¸å®‰å…¨çš„é•œåƒä»“åº“é…ç½®</span><br><span class="line">[root@docker02 ~]# vim /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.1panel.live&quot;</span>, <span class="string">&quot;https://hub.rat.dev/&quot;</span>, <span class="string">&quot;https://docker.chenby.cn&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>],</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;http://10.0.0.76&quot;</span>]#å°±æ˜¯åŠ è¿™ä¸ªé…ç½®ï¼Œæ³¨æ„ï¼Œéœ€è¦åœ¨ä¸Šä¸€è¡Œç»“æŸä½ç½®åŠ ,é€—å·</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">é‡å¯docker</span><br><span class="line">[root@docker02 ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">4ã€å†æ¬¡æ¨é€ æŠ¥é”™</span><br><span class="line">[root@docker02 ~]# docker push 10.0.0.76/wordpress/wordpress:v7</span><br><span class="line">unauthorized: unauthorized to access repository: wordpress/wordpress, action: push: unauthorized to access repository: wordpress/wordpress, action: push</span><br><span class="line">ä»“åº“æ²¡æœ‰åšè®¤è¯</span><br><span class="line"></span><br><span class="line">5ã€å‘½ä»¤è¡Œç™»å½•Harborè¿›è¡Œè®¤è¯</span><br><span class="line">[root@docker02 ~]# docker login 10.0.0.76</span><br><span class="line">Username: admin</span><br><span class="line">Password:  <span class="comment">#å¯†ç ï¼šHarbor12345</span></span><br><span class="line">......</span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line">6ã€è¿™æ¬¡æ¨é€é•œåƒæˆåŠŸï¼Œè¿›å…¥webé¡µé¢ï¼Œåˆ·æ–°ä¸€ä¸‹æŸ¥çœ‹</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240905173214933.png" alt="image-20240905173214933"></p><p><img src="../image/study_img/image-20240905173246328.png" alt="image-20240905173246328"></p><p><img src="../image/study_img/image-20240905173324730.png" alt="image-20240905173324730"></p><p>3ã€ä¸‹è½½Harborä»“åº“é‡Œé¢çš„é•œåƒ</p><p><img src="../image/study_img/image-20240905181051876.png" alt="image-20240905181051876"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨10.0.0.101ä¸‹è½½é•œåƒ</span><br><span class="line"><span class="comment">#10.0.0.101æ“ä½œå¦‚ä¸‹</span></span><br><span class="line">1ã€ä¿®æ”¹dockeré…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¿¡ä»»ä¸å®‰å…¨çš„é•œåƒä»“åº“é…ç½®</span><br><span class="line">[root@docker01 ~]# vim /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.1panel.live&quot;</span>, <span class="string">&quot;https://hub.rat.dev/&quot;</span>, <span class="string">&quot;https://docker.chenby.cn&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>],</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;http://10.0.0.76&quot;</span>]#å°±æ˜¯åŠ è¿™ä¸ªé…ç½®ï¼Œæ³¨æ„ï¼Œéœ€è¦åœ¨ä¸Šä¸€è¡Œç»“æŸä½ç½®åŠ ,é€—å·</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">2ã€ç™»å½•harbor</span><br><span class="line">[root@docker01 ~]# docker login 10.0.0.76</span><br><span class="line">Username: admin</span><br><span class="line">Password:  <span class="comment">#å¯†ç ï¼šHarbor12345</span></span><br><span class="line">......</span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line">3ã€ä¸‹è½½é•œåƒ</span><br><span class="line">[root@docker01 ~]# docker pull 10.0.0.76/wordpress/wordpress@sha256:c23f172bdd40059652c0a45affd4c0d1740fa8578c56e0209316e43516560050</span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@docker01 ~]# docker pull 10.0.0.76/wordpress/wordpress:v7</span><br></pre></td></tr></table></figure><h3 id="7ã€é•œåƒä»“åº“registry">7ã€<strong>é•œåƒä»“åº“registry</strong></h3><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>docker01</td><td>10.0.0.101  /  172.16.1.101</td><td>registryå‘½ä»¤è¡Œä»“åº“</td></tr></tbody></table><p>1ã€ä½¿ç”¨10.0.0.101åœ°å€çš„æœºå™¨æ­å»ºä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ­å»ºä»“åº“</span><br><span class="line">[root@docker01 ~]# docker run -d -p 5000:5000 --restart=always --name registry -v /opt/myregistry:/var/lib/registry registry</span><br><span class="line"></span><br><span class="line">[root@docker01 wordpress]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS         PORTS                                                  NAMES</span><br><span class="line">356673cd10da   registry          <span class="string">&quot;/entrypoint.sh /etcâ€¦&quot;</span>   11 seconds ago   Up 9 seconds   0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp              registry</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸ªæ˜¯httpçš„80ç«¯å£ï¼Œä¸€èˆ¬åœ¨ä¼ä¸šä¸­ï¼Œä¼šåœ¨ä»–å‰é¢åŠ nginxä»£ç†ï¼Œç”¨nginx80ä»£ç†ä»–çš„5000ç«¯å£ï¼Œnginxä¸Šé…ç½®åŸŸåæˆ–è€…ip</span></span><br><span class="line">regsitryåšé›†ç¾¤å¯ä»¥æŒ‚è½½è¿™ä¸ªç›®å½•/opt/myregistry/docker/registry/v2/repositories/</span><br><span class="line"></span><br><span class="line">Harborï¼šä»–æœ¬æ¥å°±æ˜¯http,å¦‚æœæƒ³ç»™harboråšé›†ç¾¤,å¯ä»¥å¤šèµ·å‡ ä¸ªharbor,å‰é¢åŠ ä¸ªè´Ÿè½½å‡è¡¡ï¼Œè™½ç„¶æ•°æ®ä¸æ˜¯ç»Ÿä¸€çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨NFSæŒ‚è½½ï¼Œnginxè´Ÿè½½å‡è¡¡å¯ä»¥è§£å†³æ•°æ®ç»Ÿä¸€çš„é—®é¢˜ï¼Œä¸€å°ä¸Šé¢å®‰è£…rsyncï¼Œå…¶ä»–2å°å®æ—¶åŒæ­¥ä¹Ÿå¯ä»¥ï¼Œæ‰€æœ‰æœºå™¨éƒ½è¦å®‰è£…rsync,seysync</span><br><span class="line"></span><br><span class="line">registryå¯ä»¥ä½¿ç”¨nginxä»£ç†</span><br><span class="line">haborä¸å¯ä»¥ä½¿ç”¨nginxä»£ç†</span><br></pre></td></tr></table></figure><p>2ã€ä¸Šä¼ é•œåƒåˆ°ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç»™é•œåƒæ‰“tagæ ‡ç­¾ï¼Œè¦å†™å…¨ä»“åº“åœ°å€    åœ°å€:ç«¯å£/é•œåƒå:ç‰ˆæœ¬å·</span><br><span class="line">[root@docker02 ~]# docker tag wordpress-manual:v1 172.16.1.101:5000/wordpress-manual:v1</span><br><span class="line">[root@docker02 ~]# docker tag nginx:alpine 172.16.1.101:5000/nginx:alpine</span><br><span class="line">[root@docker02 ~]# docker tag busybox:latest  172.16.1.101:5000/busybox:latest</span><br><span class="line"></span><br><span class="line">2ã€å…¶ä»–æœºå™¨éœ€è¦å°†ä»£ç ä¸Šä¼ åˆ°ä»“åº“çš„æœºå™¨é…ç½®æ–‡ä»¶ï¼Œæ”¹æœºå™¨å°±è¦ä¿¡ä»»ä»“åº“åœ°å€</span><br><span class="line">[root@docker03 ~]# vim /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.1panel.live&quot;</span>, <span class="string">&quot;https://hub.rat.dev/&quot;</span>, <span class="string">&quot;https://docker.chenby.cn&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>],</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;http://10.0.0.76&quot;</span>,<span class="string">&quot;http://172.16.1.101:5000&quot;</span>]#å°±æ˜¯åŠ è¿™ä¸ªé…ç½®ï¼Œæ³¨æ„ï¼Œéœ€è¦åœ¨ä¸Šä¸€è¡Œç»“æŸä½ç½®åŠ ,é€—å·ï¼Œåœ°å€å†™å†…å¤–æ¨é€ä¼šæ¯”è¾ƒå¿«ï¼Œå¦‚æœå†™å†…å¤–ï¼Œå‘½åå°±è¦ç”¨å†…å¤–å‘½å</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3ã€é‡å¯Docker</span><br><span class="line">[root@docker03 ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">4ã€æ¨é€é•œåƒ</span><br><span class="line">[root@docker02 ~]# docker push 172.16.1.101:5000/wordpress-manual:v1</span><br><span class="line">[root@docker02 ~]# docker push 172.16.1.101:5000/nginx:alpine</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3ã€æŸ¥çœ‹ç§æœ‰æŸ¥çœ‹é•œåƒåˆ—è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1ã€éšä¾¿åœ¨å“ªå°æœºå™¨æŸ¥çœ‹éƒ½è¡Œï¼Œåªè¦å’ŒregistreæŸ¥çœ‹çš„æœºå™¨é€šï¼ŒæŸ¥çœ‹æ‰€æœ‰é•œåƒä»“åº“</span><br><span class="line">[root@docker02 ~]# curl http://172.16.1.101:5000/v2/_catalog</span><br><span class="line">&#123;<span class="string">&quot;repositories&quot;</span>:[<span class="string">&quot;busybox&quot;</span>,<span class="string">&quot;nginx&quot;</span>,<span class="string">&quot;wordpress-manual&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹æŒ‡å®šä»“åº“çš„tagæ ‡ç­¾</span><br><span class="line">[root@docker02 ~]# curl http://172.16.1.101:5000/v2/nginx/tags/list</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;nginx&quot;</span>,<span class="string">&quot;tags&quot;</span>:[<span class="string">&quot;alpine&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line">3ã€æ ¼å¼åŒ–è¾“å‡ºjsonæ ¼å¼ä¿¡æ¯</span><br><span class="line">[root@docker02 ~]# yum -y install jq</span><br><span class="line">[root@docker02 ~]#  curl -s http://172.16.1.101:5000/v2/_catalog|jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;repositories&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;busybox&quot;</span>,</span><br><span class="line">    <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;wordpress-manual&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€åˆ é™¤ç§æœ‰ä»“åº“ä¸­çš„é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹æ˜ å°„çš„ç›®å½•</span><br><span class="line">[root@docker01 ~]# docker inspect registry</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;bind&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/opt/myregistry&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/var/lib/registry&quot;</span>,</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹/opt/myregistryç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šä¼ åˆ°çš„é•œåƒ</span><br><span class="line">[root@docker01 ~]# ll /opt/myregistry/docker/registry/v2/repositories/</span><br><span class="line">drwxr-xr-x 5 root root 55 Sep  6 16:40 busybox</span><br><span class="line">drwxr-xr-x 5 root root 55 Sep  6 16:32 nginx</span><br><span class="line">drwxr-xr-x 5 root root 55 Sep  6 16:17 wordpress-manual</span><br><span class="line"></span><br><span class="line">3ã€ç”±äºåšäº†æ˜ å°„ï¼Œå°±ä¸éœ€è¦è¿åˆ°å®¹å™¨é‡Œé¢ï¼Œç›´æ¥åœ¨å®¿ä¸»æœºä¸Šåˆ é™¤</span><br><span class="line">[root@docker01 ~]# <span class="built_in">rm</span> -rf /opt/myregistry/docker/registry/v2/repositories/busybox</span><br><span class="line">[root@docker01 ~]# ll /opt/myregistry/docker/registry/v2/repositories/</span><br><span class="line">drwxr-xr-x 5 root root 55 Sep  6 16:32 nginx</span><br><span class="line">drwxr-xr-x 5 root root 55 Sep  6 16:17 wordpress-manual</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# curl -s http://172.16.1.101:5000/v2/_catalog|jq</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;repositories&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;wordpress-manual&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹æ˜¯å¦ç”ŸæˆblobäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚æœæœ‰å°±åˆ é™¤ï¼Œæ²¡æœ‰ç”Ÿæˆå°±ä¸ç”¨ç®¡</span><br><span class="line">[root@docker01 ~]# ll /etc/docker</span><br><span class="line">-rw-r--r-- 1 root root 219 Sep  6 16:52 daemon.json</span><br><span class="line"></span><br><span class="line">åˆ é™¤æ–¹æ³•ï¼š</span><br><span class="line">registry garbage-collect /etc/docker/registry/config.yml</span><br></pre></td></tr></table></figure><p>5ã€æ‹‰å–é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@docker03 ~]# docker pull 172.16.1.101:5000/wordpress-manual:v1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡ä¸‰ã€Dockeråˆ¶ä½œé•œåƒ</title>
      <link href="/posts/eb54e23d.html"/>
      <url>/posts/eb54e23d.html</url>
      
        <content type="html"><![CDATA[<h2 id="Dockeråˆ¶ä½œé•œåƒ">Dockeråˆ¶ä½œé•œåƒ</h2><p>Docker å®¹å™¨æ“ä½œçš„é€‰é¡¹</p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>â€“name</td><td>è‡ªå®šä¹‰å®¹å™¨å</td></tr><tr><td>-d</td><td>å°†å®¹å™¨æ”¾åå°å¯åŠ¨</td></tr><tr><td>-it   (input   TTY)</td><td>åˆ†é…ä¸€ä¸ªäº¤äº’å¼çš„ç»ˆç«¯</td></tr><tr><td>-p</td><td>ç«¯å£æ˜ å°„</td></tr><tr><td>-P</td><td>æ˜ å°„éšæœºç«¯å£</td></tr><tr><td>-v</td><td>æ•°æ®å·æ˜ å°„</td></tr><tr><td>-e</td><td>env  æŒ‡å®šç¯å¢ƒå˜é‡</td></tr><tr><td>â€“restart=always</td><td>è®¾ç½®å®¹å™¨å¼€æœºè‡ªå¯ï¼Œdockerå¯åŠ¨å°±è·Ÿç€è‡ªåŠ¨å¯åŠ¨</td></tr><tr><td>â€“link=mysql57</td><td>æŒ‡å®šå¦ä¸€ä¸ªå®¹å™¨çš„åå­—ï¼Œå°±å¯ä»¥å’ŒæŒ‡å®šçš„å®¹å™¨é€šä¿¡</td></tr></tbody></table><p>è¿è¡Œmysqlå®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‹‰å–mysql5.7.44é•œåƒ</span><br><span class="line">root@docker01 ~]# docker pull mysql:5.7.44</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹å·¥ä½œç›®å½•å’Œç«¯å£</span><br><span class="line">[root@docker01 ~]# docker inspect mysql:5.7.44</span><br><span class="line">            <span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;3306/tcp&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">&quot;33060/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">                </span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;/var/lib/mysql&quot;</span>: &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment">#rootå¯†ç </span></span><br><span class="line">MYSQL_ROOT_PASSWORD</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ºåº“</span></span><br><span class="line">MYSQL_DATABASE</span><br><span class="line"></span><br><span class="line"><span class="comment">## åˆ›å»ºç”¨æˆ·</span></span><br><span class="line">MYSQL_USER</span><br><span class="line"></span><br><span class="line"><span class="comment">## åˆ›å»ºæ™®é€šç”¨æˆ·çš„å¯†ç </span></span><br><span class="line">MYSQL_PASSWORD</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œé•œåƒ</span><br><span class="line">docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wordpress \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line">-v <span class="comment">#æ˜ å°„é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">-name some-mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=my-secret-pw \</span><br><span class="line">-d mysql:tag \</span><br><span class="line">--character-set-server=utf8mb4 \</span><br><span class="line">--collation-server=utf8mb4_unicode_ci</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">--name wp \</span><br><span class="line">--<span class="built_in">link</span> mysql57 \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-v /data/wp:/var/www/html \</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql57 \</span><br><span class="line">-e WORDPRESS_DB_USER=wp_user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=123 \</span><br><span class="line">-e WORDPRESS_DB_NAME=wordpress \</span><br><span class="line">-d wordpress</span><br><span class="line">ä¸€èˆ¬éƒ½æ˜¯åˆ›å»ºæ™®é€šç”¨æˆ·ï¼Œåšäº†ç«¯å£æ˜ å°„å®¿ä¸»æœºä¹Ÿèƒ½è¿æ¥</span><br><span class="line"></span><br><span class="line">3ã€è¿æ¥è¿›å»</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">exec</span> -it eedc00b /bin/bash</span><br><span class="line">bash-4.2# </span><br><span class="line">bash-4.2# mysql -uroot -p123</span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹åˆ›å»ºçš„åº“å’Œç”¨æˆ·</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| wordpress          |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| user          | host      |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| root          | %         |</span><br><span class="line">| wp_user       | %         | <span class="comment">#å®¹å™¨çš„ipæ˜¯å†…å¤–ip,ä¸æŠŠç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šå°±æ²¡äº‹</span></span><br><span class="line">| mysql.session | localhost |</span><br><span class="line">| mysql.sys     | localhost |</span><br><span class="line">| root          | localhost |</span><br><span class="line">+---------------+-----------+</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants <span class="keyword">for</span> wp_user@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">| Grants <span class="keyword">for</span> wp_user@%                                   |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO <span class="string">&#x27;wp_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span>                    |</span><br><span class="line">| GRANT ALL PRIVILEGES ON `wordpress`.* TO <span class="string">&#x27;wp_user&#x27;</span>@<span class="string">&#x27;%&#x27;</span> |</span><br><span class="line">+--------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">4ã€æ˜ å°„çš„ç›®å½•é‡Œé¢æœ‰æ•°æ®</span><br><span class="line">[root@docker01 ~]# ll /data/mysql/</span><br></pre></td></tr></table></figure><h3 id="1ã€æ‰‹åŠ¨åˆ¶ä½œWordPressé•œåƒ">1ã€<strong>æ‰‹åŠ¨åˆ¶ä½œWordPressé•œåƒ</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½wordpressä»£ç åŒ…</span><br><span class="line">[root@docker01 ~]# wget https://cn.wordpress.org/wordpress-5.9.10-zh_CN.tar.gz</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œä¸€ä¸ªåŸºç¡€å®¹å™¨</span><br><span class="line">[root@docker01 ~]# docker run --name wp_base -it  centos:7 /bin/bash</span><br><span class="line"></span><br><span class="line">3ã€æ¢æº</span><br><span class="line">[root@3dcd1060f3ab /]#  curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.huaweicloud.com/repository/conf/CentOS-7-anon.repo</span><br><span class="line">[root@3dcd1060f3ab /]#  curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">[root@3dcd1060f3ab /]#sed -i <span class="string">&quot;s@http://mirrors.aliyun.com@https://mirrors.huaweicloud.com@g&quot;</span> /etc/yum.repos.d/epel.repo</span><br><span class="line"></span><br><span class="line">4ã€æ¢phpæº</span><br><span class="line">[root@3dcd1060f3ab /]# <span class="built_in">cat</span> &gt; /etc/yum.repos.d/php.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[php-webtatic]</span></span><br><span class="line"><span class="string">name = PHP Repository</span></span><br><span class="line"><span class="string">baseurl = http://us-east.repo.webtatic.com/yum/el7/x86_64/</span></span><br><span class="line"><span class="string">gpgcheck = 0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;[php-webtatic]\nname = PHP Repository\nbaseurl = http://us-east.repo.webtatic.com/yum/el7/x86_64/\ngpgcheck = 0&quot;</span>&gt; /etc/yum.repos.d/php.repo</span><br><span class="line"></span><br><span class="line">5ã€å®‰è£…phpã€mysqlã€nginx</span><br><span class="line">[root@nginx ~]# yum -y install php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb mariadb-server nginx</span><br><span class="line"></span><br><span class="line">6ã€åˆ›å»ºnginxå¯åŠ¨ç”¨æˆ·</span><br><span class="line">[root@3dcd1060f3ab code]# groupadd -g 666 www</span><br><span class="line">[root@3dcd1060f3ab code]# useradd -u 666 -g 666 -s /sbin/nologin -M www</span><br><span class="line"></span><br><span class="line">7ã€ä¼˜åŒ–nginx  php ç»Ÿä¸€ç”¨æˆ·</span><br><span class="line">ä¸»é…ç½®æ–‡ä»¶   (å¦‚æœæ˜¯nginxXå®˜æ–¹æºä¸‹è½½çš„nginxï¼Œå°±ä¸ç”¨ä¼˜åŒ–)</span><br><span class="line">[root@3dcd1060f3ab /]# vi /etc/nginx/nginx.conf</span><br><span class="line">user www;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@3dcd1060f3ab ~]# sed -i <span class="string">&#x27;s#user = apache#user = www#g&#x27;</span> /etc/php-fpm.d/www.conf</span><br><span class="line">[root@3dcd1060f3ab ~]# sed -i <span class="string">&#x27;s#group = apache#group = www#g&#x27;</span> /etc/php-fpm.d/www.conf </span><br><span class="line"></span><br><span class="line">8ã€ç¼–å†™ç½‘ç«™ä¸»é…ç½®æ–‡ä»¶</span><br><span class="line">[root@3dcd1060f3ab /]# vi /etc/nginx/conf.d/wp.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name _;</span><br><span class="line">        root /code/wordpress;</span><br><span class="line">        index index.php index.html;</span><br><span class="line">        </span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">             fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">             fastcgi_param SCRIPT_FILENAME $document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">             include fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">9ã€åˆ›å»ºç«™ç‚¹ç›®å½•ï¼Œå®¿ä¸»æœºæ–°å¼€çª—å£ä¸Šä¼ ä»£ç åˆ°ç«™ç‚¹ç›®å½•ï¼Œå¹¶è§£å‹ï¼Œæˆæƒ</span><br><span class="line">[root@3dcd1060f3ab /]# <span class="built_in">mkdir</span> /code</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> wordpress-5.9.10.tar.gz  wp_base:/code</span><br><span class="line"></span><br><span class="line">[root@3dcd1060f3ab /]# <span class="built_in">cd</span> /code</span><br><span class="line">[root@3dcd1060f3ab code]# tar xf wordpress-5.9.10.tar.gz </span><br><span class="line">[root@3dcd1060f3ab code]# <span class="built_in">chown</span> -R  www.www /code/</span><br><span class="line"></span><br><span class="line">10ã€å¯åŠ¨æ•°æ®åº“</span><br><span class="line">è™½ç„¶æ˜¯ä¸èƒ½systemdå¯åŠ¨ï¼Œä½†æ˜¯mariadbçš„å¯åŠ¨è„šæœ¬è¿˜æ˜¯åœ¨çš„</span><br><span class="line">[root@3dcd1060f3ab code]# <span class="built_in">cat</span> /usr/lib/systemd/system/mariadb.service </span><br><span class="line"> 35è¡Œï¼šå¯åŠ¨ä¹‹å‰è¦åšåˆå§‹åŒ–ï¼Œæ‰¾åˆ°åˆå§‹åŒ–å‘½ä»¤ </span><br><span class="line"> ExecStartPre=/usr/libexec/mariadb-prepare-db-dir %n</span><br><span class="line"> 38è¡Œï¼šå¯åŠ¨å‘½ä»¤</span><br><span class="line"> ExecStart=/usr/bin/mysqld_safe --basedir=/usr   (å¯ä»¥å¡ä¸»)</span><br><span class="line"> </span><br><span class="line"> [root@3dcd1060f3ab code]# /usr/libexec/mariadb-prepare-db-dir %n</span><br><span class="line"> [root@3dcd1060f3ab code]# /usr/bin/mysqld_safe --basedir=/usr &amp;</span><br><span class="line"> </span><br><span class="line"> 11ã€è¿›å»æ•°æ®åº“åˆ›å»ºåº“ ç”¨æˆ·</span><br><span class="line">[root@3dcd1060f3ab code]# mysql</span><br><span class="line">MariaDB [(none)]&gt; create database wordpress;</span><br><span class="line">MariaDB [(none)]&gt; grant all on *.* to wp_user@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">12ã€æµ‹è¯•ç”¨æˆ·æ˜¯å¦å¯ä»¥è¿æ¥</span><br><span class="line">[root@3dcd1060f3ab code]# mysql -uwp_user -p123 -h127.0.0.1</span><br><span class="line"></span><br><span class="line">13ã€å¯åŠ¨nginx</span><br><span class="line">[root@3dcd1060f3ab code]# nginx</span><br><span class="line"></span><br><span class="line">14ã€å¯åŠ¨php</span><br><span class="line">æ‰¾åˆ°å¯åŠ¨è„šæœ¬é‡Œé¢çš„å¯åŠ¨å‘½ä»¤</span><br><span class="line">[root@3dcd1060f3ab code]# vi /usr/lib/systemd/system/php-fpm.service </span><br><span class="line"> 9è¡Œ</span><br><span class="line"> ExecStart=/usr/sbin/php-fpm --nodaemonize --fpm-config /etc/php-fpm.conf</span><br><span class="line"> </span><br><span class="line"> --nodaemonizeï¼šå¯ä»¥å¡ä½ï¼Œä¸åŠ å°±æ”¾åå°</span><br><span class="line">[root@3dcd1060f3ab code]# /usr/sbin/php-fpm  --fpm-config /etc/php-fpm.conf</span><br><span class="line"> </span><br><span class="line"> 15ã€curlä¸€ä¸‹ï¼Œèƒ½å¤Ÿæ­£å¸¸è®¿é—®</span><br><span class="line"> [root@3dcd1060f3ab code]# curl -L 127.0.0.1</span><br><span class="line"> ....</span><br><span class="line"> &lt;p&gt;Welcome to WordPress. Before getting started, we need some information on the database. You will need to know the following items before proceeding.&lt;/p&gt;</span><br><span class="line">&lt;ol&gt;</span><br><span class="line">        &lt;li&gt;Database name&lt;/li&gt;     <span class="comment">#å¡«å†™æ•°æ®åº“ä¿¡æ¯çš„é¡µé¢</span></span><br><span class="line">        &lt;li&gt;Database username&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;Database password&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;Database host&lt;/li&gt;</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">16ã€å°†3ä¸ªæœåŠ¡å†™è„šæœ¬å¯åŠ¨ï¼Œå°±ä¸ç”¨ä¸€ä¸ªä¸€ä¸ªå¯åŠ¨äº†</span><br><span class="line">[root@3dcd1060f3ab code]# <span class="built_in">cd</span> ~</span><br><span class="line">[root@3dcd1060f3ab ~]# vi start.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">/sbin/nginx</span><br><span class="line">/usr/sbin/php-fpm  --fpm-config /etc/php-fpm.conf</span><br><span class="line"><span class="comment">#è„šæœ¬é‡Œé¢éœ€è¦å¡ä¸»ä¸€ä¸ªå°±å¯ä»¥ï¼ŒæŠŠmysqlå¡ä½</span></span><br><span class="line">/usr/bin/mysqld_safe --basedir=/usr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">17ã€è¾“å…¥æ­¤æ—¶å¯ä»¥æ‰“åŒ…äº†ï¼Œä½†æ˜¯æ‰“åŒ…å‡ºæ¥çš„é•œåƒå¾ˆå¤§ï¼Œéœ€è¦ä¼˜åŒ–ä¸€ä¸‹</span><br><span class="line">[root@3dcd1060f3ab ~]# <span class="built_in">rm</span> -rf /code/wordpress-5.9.10.tar.gz</span><br><span class="line">[root@3dcd1060f3ab ~]# yum clean all</span><br><span class="line">åˆ é™¤æ‰€æœ‰yumæºï¼Œä»¥åç”¨ä¸åˆ°çš„ï¼Œè¿™ä¸ªå°±æ˜¯wordpress</span><br><span class="line">[root@3dcd1060f3ab ~]# <span class="built_in">rm</span> -rf /etc/yum.repos.d/* </span><br><span class="line">å¦‚æœæœ‰ä¸‹è½½wgetä¸‹è½½ä¸œè¥¿ï¼Œéƒ½è¦å¸è½½æ‰ï¼Œä»¥åç”¨ä¸åˆ°çš„</span><br><span class="line"></span><br><span class="line">18ã€æ‰“å¼€æ–°çª—å£ï¼Œå°†å®¹å™¨æ‰“åŒ…</span><br><span class="line">[root@docker01 ~]# docker commit wp_base wordpress:v1</span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">wordpress    v1        26586db1eda4   9 seconds ago   615MB</span><br><span class="line"></span><br><span class="line">19ã€è¿è¡Œè¿™ä¸ªå®¹å™¨ï¼Œæµ‹è¯•æ˜¯å¦èƒ½å¤Ÿåœ¨ç½‘é¡µé‡Œé¢è®¿é—®</span><br><span class="line">[root@docker01 ~]# docker run -p 80:80 -d wordpress:v1  /bin/sh ~/start.sh</span><br><span class="line">è„šæœ¬åœ¨å®¹å™¨é‡Œé¢çš„ç»å¯¹è·¯å¾„</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS        PORTS                               NAMES</span><br><span class="line">720febe29da7   wordpress:v1   <span class="string">&quot;/bin/sh /root/startâ€¦&quot;</span>   2 seconds ago   Up 1 second   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   hopeful_wing</span><br><span class="line"></span><br><span class="line">20ã€æµè§ˆå™¨è®¿é—®10.0.0.101</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240904155106974.png" alt="image-20240904155106974"></p><p><img src="../image/study_img/image-20240905192409386.png" alt="image-20240905192409386"></p><p><img src="../image/study_img/image-20240904160154137.png" alt="image-20240904160154137"></p><p><img src="../image/study_img/image-20240904160307363.png" alt="image-20240904160307363"></p><p><img src="../image/study_img/image-20240904160327203.png" alt="image-20240904160327203"></p><p><img src="../image/study_img/image-20240904160430589.png" alt="image-20240904160430589"></p><p><img src="../image/study_img/image-20240904162155815.png" alt="image-20240904162155815"></p><h3 id="2ã€ä½¿ç”¨å®˜æ–¹çš„wordpresså®¹å™¨">2ã€<strong>ä½¿ç”¨å®˜æ–¹çš„wordpresså®¹å™¨</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‹‰å–wordpresså®¹å™¨</span><br><span class="line">[root@docker02 ~]# docker pull wordpress</span><br><span class="line"></span><br><span class="line">2ã€æ‹‰å–æ•°æ®åº“</span><br><span class="line">[root@docker02 ~]# docker pull mysql:5.7.44</span><br><span class="line"></span><br><span class="line">3ã€#å®˜æ–¹wpå®¹å™¨çš„å¯åŠ¨æ–¹æ³•</span><br><span class="line">[root@docker02 ~]# docker run \</span><br><span class="line">--name wp \</span><br><span class="line">--<span class="built_in">link</span> mysql57 \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-v /data/wp:/var/www/html \</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql57 \</span><br><span class="line">-e WORDPRESS_DB_USER=wp_user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=123 \</span><br><span class="line">-e WORDPRESS_DB_NAME=wordpress \</span><br><span class="line">-d wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®˜æ–¹mysqlå®¹å™¨çš„å¯åŠ¨æ–¹æ³•</span></span><br><span class="line">[root@docker02 ~]# docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wordpress \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line">4ã€æµè§ˆå™¨è®¿é—®10.0.0.102</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240904164056259.png" alt="image-20240904164056259"></p><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰å¡«å†™æ•°æ®åº“ä¿¡æ¯çš„é˜¶æ®µï¼Œå› ä¸ºåœ¨å¯åŠ¨æ•°æ®åº“ä¹‹å‰å·²ç»ä½¿ç”¨å‚æ•°ä¼ é€’è¿›å»äº†ï¼Œè€Œä¸”ä¸ä¼šå‡ºç°é”™è¯¯ï¼Œä¸ä¼šå‡ºç°ç ´å›¾ï¼Œè¿™ä¸ªæ‰æ˜¯ç”Ÿäº§ä¸­éœ€è¦çš„æ•ˆæœï¼Œéœ€è¦å˜é‡ä¼ é€’å‚æ•°</p><p><img src="../image/study_img/image-20240904164144932.png" alt="image-20240904164144932"></p><h3 id="3ã€æ„å»ºå¯ä»¥ä¼ é€’å‚æ•°çš„é•œåƒ-ï¼ˆæ¨¡æ‹Ÿå®˜æ–¹æ‰“wordpressé•œåƒï¼‰">3ã€<strong>æ„å»ºå¯ä»¥ä¼ é€’å‚æ•°çš„é•œåƒ    ï¼ˆæ¨¡æ‹Ÿå®˜æ–¹æ‰“wordpressé•œåƒï¼‰</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…ˆäº†è§£è¯»å–ç³»ç»Ÿç¯å¢ƒå˜é‡çš„å‘½ä»¤ï¼šenvsubst</span></span><br><span class="line">[root@docker02 ~]# <span class="built_in">export</span> wp_db_name=wp</span><br><span class="line">[root@docker02 ~]# <span class="built_in">export</span> wp_db_user=wp_user</span><br><span class="line">[root@docker02 ~]# <span class="built_in">echo</span> <span class="variable">$wp_db_name</span></span><br><span class="line">wp</span><br><span class="line">[root@docker02 ~]# <span class="built_in">echo</span> <span class="variable">$wp_db_user</span></span><br><span class="line">wp_user</span><br><span class="line">[root@docker02 ~]# vim 1.txt</span><br><span class="line">define( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;$wp_db_name&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;$wp_db_user&#x27;</span> );</span><br><span class="line"></span><br><span class="line">æ‹¿ç¯å¢ƒå˜é‡å»æ¸²æŸ“è¿™ä¸ªæ–‡ä»¶,1.txtä¼šå˜æˆç©ºæ–‡ä»¶</span><br><span class="line">envsubstè¯»å–1.txté‡Œé¢çš„å˜é‡ï¼ŒåŒ¹é…ç¯å¢ƒå˜é‡é‡Œé¢æœ‰æ²¡æœ‰ï¼Œæœ‰çš„è¯ï¼Œè¾“å‡ºæ¸²æŸ“åˆ°2.txt</span><br><span class="line">[root@docker02 ~]# envsubst &lt; 1.txt &gt; 2.txt</span><br><span class="line">[root@docker02 ~]# <span class="built_in">cat</span> 2.txt </span><br><span class="line">define( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;wp&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;wp_user&#x27;</span> );</span><br><span class="line"></span><br><span class="line">æŒ‡å®šåªæ¸²æŸ“ä¸€ä¸ªå˜é‡ï¼Œæ²¡è¢«æ¸²æŸ“çš„å˜é‡å°±æ˜¯é»˜è®¤çš„</span><br><span class="line">[root@docker02 ~]# <span class="built_in">cat</span> 1.txt </span><br><span class="line">define( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;$wp_db_name&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;$wp_db_user&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_PASS&#x27;</span>, <span class="string">&#x27;$wp_db_pass&#x27;</span> );</span><br><span class="line">[root@docker02 ~]# envsubst <span class="string">&#x27;$wp_db_name&#x27;</span> &lt; 1.txt &gt;2.txt </span><br><span class="line">[root@docker02 ~]# <span class="built_in">cat</span> 2.txt </span><br><span class="line">define( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;wp&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;$wp_db_user&#x27;</span> );</span><br><span class="line">define( <span class="string">&#x27;DB_PASS&#x27;</span>, <span class="string">&#x27;$wp_db_pass&#x27;</span> );</span><br><span class="line"></span><br><span class="line">å®¹å™¨é‡Œé¢æ²¡æœ‰è¿™ä¸ªå‘½ä»¤ï¼Œå…ˆæŸ¥è¯¢ä¸€ä¸ªå±äºå“ªä¸ªåŒ…ï¼Œåœ¨å®¹å™¨é‡Œé¢å®‰è£…æœåŠ¡çš„æ—¶å€™ä¸€èµ·å®‰è£…</span><br><span class="line">[root@docker02 ~]# yum provides envsbet</span><br><span class="line">gettext-0.19.8.1-3.el7.x86_64 : GNU libraries and utilities <span class="keyword">for</span> producing multi-lingual messages</span><br></pre></td></tr></table></figure><p>åœ¨docker02    10.0.0.102 æ„å»º     éœ€è¦æŠŠä¹‹å‰å…è®¸çš„å®¹å™¨å…³é—­ï¼Œéœ€è¦æ‰“nginxã€php</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½wordpressä»£ç åŒ…</span><br><span class="line">[root@docker01 ~]# wget https://cn.wordpress.org/wordpress-5.9.10-zh_CN.tar.gz</span><br><span class="line"></span><br><span class="line">1ã€è¿è¡Œä¸€ä¸ªåŸºç¡€å®¹å™¨</span><br><span class="line">[root@docker01 ~]# docker run --name wp_base -it  centos:7 /bin/bash</span><br><span class="line"></span><br><span class="line">2ã€æ¢æº</span><br><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.huaweicloud.com/repository/conf/CentOS-7-anon.repo</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">sed -i <span class="string">&quot;s@http://mirrors.aliyun.com@https://mirrors.huaweicloud.com@g&quot;</span> /etc/yum.repos.d/epel.repo</span><br><span class="line"></span><br><span class="line">3ã€æ¢phpæº</span><br><span class="line">[root@3dcd1060f3ab /]# <span class="built_in">cat</span> &gt; /etc/yum.repos.d/php.repo &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[php-webtatic]</span></span><br><span class="line"><span class="string">name = PHP Repository</span></span><br><span class="line"><span class="string">baseurl = http://us-east.repo.webtatic.com/yum/el7/x86_64/</span></span><br><span class="line"><span class="string">gpgcheck = 0</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;[php-webtatic]\nname = PHP Repository\nbaseurl = http://us-east.repo.webtatic.com/yum/el7/x86_64/\ngpgcheck = 0&quot;</span>&gt; /etc/yum.repos.d/php.repo</span><br><span class="line"></span><br><span class="line">4ã€å®‰è£…phpã€nginxã€envsubstå‘½ä»¤</span><br><span class="line">[root@nginx ~]# yum -y install php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb nginx  gettext</span><br><span class="line"></span><br><span class="line">5ã€åˆ›å»ºnginxå¯åŠ¨ç”¨æˆ·</span><br><span class="line">groupadd -g 666 www</span><br><span class="line">useradd -u 666 -g 666 -s /sbin/nologin -M www</span><br><span class="line"></span><br><span class="line">6ã€ä¼˜åŒ–nginx  php ç»Ÿä¸€ç”¨æˆ·</span><br><span class="line">ä¸»é…ç½®æ–‡ä»¶   (å¦‚æœæ˜¯nginxXå®˜æ–¹æºä¸‹è½½çš„nginxï¼Œå°±ä¸ç”¨ä¼˜åŒ–)</span><br><span class="line">[root@3dcd1060f3ab /]# vi /etc/nginx/nginx.conf</span><br><span class="line">user www;</span><br><span class="line">worker_processes auto;</span><br><span class="line">error_log /var/log/nginx/error.log;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"></span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line">    keepalive_timeout   65;</span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types;</span><br><span class="line">    default_type        application/octet-stream;</span><br><span class="line"></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@3dcd1060f3ab ~]# sed -i <span class="string">&#x27;s#user = apache#user = www#g&#x27;</span> /etc/php-fpm.d/www.conf</span><br><span class="line">sed -i <span class="string">&#x27;s#group = apache#group = www#g&#x27;</span> /etc/php-fpm.d/www.conf </span><br><span class="line"></span><br><span class="line">7ã€ç¼–å†™ç½‘ç«™ä¸»é…ç½®æ–‡ä»¶</span><br><span class="line">[root@3dcd1060f3ab /]# vi /etc/nginx/conf.d/wp.conf</span><br><span class="line">server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name _;</span><br><span class="line">        root /code/wordpress;</span><br><span class="line">        index index.php index.html;</span><br><span class="line">        </span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">             fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">             fastcgi_param SCRIPT_FILENAME $document_root<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">             include fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">8ã€åˆ›å»ºç«™ç‚¹ç›®å½•ï¼Œå®¿ä¸»æœºæ–°å¼€çª—å£ä¸Šä¼ ä»£ç åˆ°ç«™ç‚¹ç›®å½•ï¼Œå¹¶è§£å‹ï¼Œæˆæƒ</span><br><span class="line">[root@3dcd1060f3ab /]# <span class="built_in">mkdir</span> /code</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> wordpress-5.9.10.tar.gz  wp_base:/code</span><br><span class="line">[root@3dcd1060f3ab code]# <span class="built_in">cd</span> /code</span><br><span class="line">[root@3dcd1060f3ab code]# tar xf wordpress-5.9.10.tar.gz </span><br><span class="line">[root@3dcd1060f3ab code]# <span class="built_in">chown</span> -R  www.www /code/</span><br><span class="line"><span class="built_in">chown</span> -R www.www /var/lib/nginx/</span><br><span class="line"></span><br><span class="line">9ã€å¯åŠ¨nginx</span><br><span class="line">[root@3dcd1060f3ab code]# nginx</span><br><span class="line"></span><br><span class="line">10ã€å¯åŠ¨php</span><br><span class="line">æ‰¾åˆ°å¯åŠ¨è„šæœ¬é‡Œé¢çš„å¯åŠ¨å‘½ä»¤</span><br><span class="line">[root@3dcd1060f3ab code]# vi /usr/lib/systemd/system/php-fpm.service </span><br><span class="line"> 9è¡Œ</span><br><span class="line"> ExecStart=/usr/sbin/php-fpm --nodaemonize --fpm-config /etc/php-fpm.conf</span><br><span class="line"> </span><br><span class="line"> --nodaemonizeï¼šå¯ä»¥å¡ä½ï¼Œä¸åŠ å°±æ”¾åå°</span><br><span class="line">[root@3dcd1060f3ab code]# /usr/sbin/php-fpm  --fpm-config /etc/php-fpm.conf</span><br><span class="line"> </span><br><span class="line"> 11ã€curlä¸€ä¸‹ï¼Œèƒ½å¤Ÿæ­£å¸¸è®¿é—®</span><br><span class="line"> [root@3dcd1060f3ab code]# curl -L 127.0.0.1</span><br><span class="line"> ....    <span class="comment">#å¯ä»¥çœ‹åˆ°é€‰ä¸­è¯­è¨€çš„ç•Œé¢</span></span><br><span class="line">&lt;option value=<span class="string">&quot;zh_HK&quot;</span> lang=<span class="string">&quot;zh&quot;</span> data-continue=<span class="string">&quot;ç¹¼çºŒ&quot;</span>&gt;é¦™æ¸¯ä¸­æ–‡&lt;/option&gt;</span><br><span class="line">&lt;option value=<span class="string">&quot;zh_CN&quot;</span> lang=<span class="string">&quot;zh&quot;</span> data-continue=<span class="string">&quot;ç»§ç»­&quot;</span>&gt;ç®€ä½“ä¸­æ–‡&lt;/option&gt;</span><br><span class="line">&lt;option value=<span class="string">&quot;zh_TW&quot;</span> lang=<span class="string">&quot;zh&quot;</span> data-continue=<span class="string">&quot;ç¹¼çºŒ&quot;</span>&gt;ç¹é«”ä¸­æ–‡&lt;/option&gt;</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">12ã€ä¼ å‚ï¼Œä¸è¦æ•°æ®çš„é¡µé¢ï¼Œéœ€è¦ä½¿ç”¨è¯»å–ç³»ç»Ÿç¯å¢ƒå˜é‡çš„å‘½ä»¤envsubst</span><br><span class="line">å°†é…ç½®æ–‡ä»¶æ”¹æˆæ¨¡ç‰ˆæ–‡ä»¶</span><br><span class="line">[root@1925f5794372 code]# vi /code/wordpress/wp-config-sample.php</span><br><span class="line">......</span><br><span class="line"><span class="comment">#æŠŠè¿™å‡ è¡Œæ”¹æˆå˜é‡</span></span><br><span class="line">     23 define( <span class="string">&#x27;DB_NAME&#x27;</span>, <span class="string">&#x27;$WORDPRESS_DB_NAME&#x27;</span> );</span><br><span class="line">     24 </span><br><span class="line">     25 /** Database username */</span><br><span class="line">     26 define( <span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;$WORDPRESS_DB_USER&#x27;</span> );</span><br><span class="line">     27 </span><br><span class="line">     28 /** Database password */</span><br><span class="line">     29 define( <span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;$WORDPRESS_DB_PASSWORD&#x27;</span> );</span><br><span class="line">     30 </span><br><span class="line">     31 /** Database hostname */</span><br><span class="line">     32 define( <span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;$WORDPRESS_DB_HOST&#x27;</span> );</span><br><span class="line">     </span><br><span class="line"> </span><br><span class="line">sed -i <span class="string">&#x27;s#database_name_here#$WORDPRESS_DB_NAME#g&#x27;</span> /code/wordpress/wp-config-sample.php</span><br><span class="line">sed -i <span class="string">&#x27;s#username_here#$WORDPRESS_DB_USER#g&#x27;</span> /code/wordpress/wp-config-sample.php</span><br><span class="line">sed -i <span class="string">&#x27;s#password_here#$WORDPRESS_DB_PASSWORD#g&#x27;</span> /code/wordpress/wp-config-sample.php</span><br><span class="line">sed -i <span class="string">&#x27;s#localhost#$WORDPRESS_DB_HOST#g&#x27;</span> /code/wordpress/wp-config-sample.php</span><br><span class="line"></span><br><span class="line">13ã€å°†2ä¸ªæœåŠ¡å†™è„šæœ¬å¯åŠ¨ï¼Œå°±ä¸ç”¨ä¸€ä¸ªä¸€ä¸ªå¯åŠ¨äº†</span><br><span class="line">[root@3dcd1060f3ab ~]# vi /start.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#æ¸²æŸ“å˜é‡åˆ°wp-config.php</span></span><br><span class="line">envsubst <span class="string">&#x27;$WORDPRESS_DB_NAME $WORDPRESS_DB_USER $WORDPRESS_DB_PASSWORD $WORDPRESS_DB_HOST&#x27;</span> &lt; /code/wordpress/wp-config-sample.php &gt; /code/wordpress/wp-config.php</span><br><span class="line"><span class="built_in">chown</span> -R  www.www /code/</span><br><span class="line">/usr/sbin/php-fpm  --fpm-config /etc/php-fpm.conf</span><br><span class="line"><span class="comment">#è„šæœ¬é‡Œé¢å¿…é¡»æœ‰ä¸€ä¸ªå¡åœ¨ï¼Œå“ªä¸ªå¡åœ¨éƒ½å¯ä»¥</span></span><br><span class="line">/sbin/nginx -g <span class="string">&#x27;daemon off;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">14ã€è¾“å…¥æ­¤æ—¶å¯ä»¥æ‰“åŒ…äº†ï¼Œä½†æ˜¯æ‰“åŒ…å‡ºæ¥çš„é•œåƒå¾ˆå¤§ï¼Œéœ€è¦ä¼˜åŒ–ä¸€ä¸‹</span><br><span class="line">[root@3dcd1060f3ab ~]# <span class="built_in">rm</span> -rf /code/wordpress-5.9.10.tar.gz</span><br><span class="line">[root@3dcd1060f3ab ~]# yum clean all</span><br><span class="line">åˆ é™¤æ‰€æœ‰yumæºï¼Œä»¥åç”¨ä¸åˆ°çš„ï¼Œè¿™ä¸ªå°±æ˜¯wordpress</span><br><span class="line">[root@3dcd1060f3ab ~]# <span class="built_in">rm</span> -rf /etc/yum.repos.d/* </span><br><span class="line">å¦‚æœæœ‰ä¸‹è½½wgetä¸‹è½½ä¸œè¥¿ï¼Œéƒ½è¦å¸è½½æ‰ï¼Œä»¥åç”¨ä¸åˆ°çš„</span><br><span class="line"></span><br><span class="line">15ã€æ‰“å¼€æ–°çª—å£ï¼Œå°†å®¹å™¨æ‰“åŒ…</span><br><span class="line">[root@docker01 ~]# docker commit wp_base wordpress:v1</span><br><span class="line">[root@docker02 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">wordpress    v1        23e066cac691   2 seconds ago   586MB</span><br><span class="line"></span><br><span class="line">16ã€åˆ é™¤æ•°æ®åº“æ•°æ®ç›®å½•ï¼Œä¸ç„¶ç¬¬äºŒæ¬¡å¯åŠ¨ä¸èƒ½å»ºåº“ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡çš„æ•°æ®å·²ç»æŒä¹…åŒ–äº†</span><br><span class="line">[root@docker02 ~]# <span class="built_in">rm</span> -rf /data</span><br><span class="line"></span><br><span class="line">17ã€è¿è¡Œå¸¦å˜é‡çš„å®¹å™¨</span><br><span class="line"><span class="comment">#è¿è¡Œæ•°æ®åº“</span></span><br><span class="line">docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wp_db \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œwordpresså®¹å™¨</span></span><br><span class="line">docker run \</span><br><span class="line">--name wp \</span><br><span class="line">--<span class="built_in">link</span> mysql57 \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql57 \</span><br><span class="line">-e WORDPRESS_DB_USER=wp_user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=123 \</span><br><span class="line">-e WORDPRESS_DB_NAME=wp_db \</span><br><span class="line">-d wordpress:v3 /bin/sh /start.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„é•œåƒ</span></span><br><span class="line">[root@docker02 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED             STATUS             PORTS                                                  NAMES</span><br><span class="line">71439bdb8066   wordpress:v5   <span class="string">&quot;/bin/sh /start.sh&quot;</span>      5 seconds ago       Up 4 seconds       0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp                      wp</span><br><span class="line">c6eefe3b5358   mysql:5.7.44   <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   49 minutes ago      Up 49 minutes      0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp   mysql57</span><br><span class="line">4f798d07ace2   centos:7       <span class="string">&quot;/bin/bash&quot;</span>              About an hour ago   Up About an hour                                                          wp_base</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">18ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.102</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240904193619359.png" alt="image-20240904193619359"></p><p>é€šè¿‡å¡«å†™æ•°æ®åº“ä¿¡æ¯çš„é¡µé¢ï¼Œç›´æ¥æ¥çš„ä¸»ä»é¡µé¢</p><p><img src="../image/study_img/image-20240904194031698.png" alt="image-20240904194031698"></p><p><strong>æŠ¥é”™é—®é¢˜</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1ã€dockeræ­£å¸¸å¯åŠ¨ï¼Œå®¹å™¨é‡Œé¢çš„æœåŠ¡éƒ½æ­£å¸¸å¯åŠ¨,ç«¯å£æ˜ å°„ä¹Ÿæ²¡é—®é¢˜ï¼Œè®¿é—®ç½‘é¡µæ‰¾ä¸åˆ°é¡µé¢</span></span><br><span class="line">æ˜¯å› ä¸ºå¤–é¢çš„è¯·æ±‚ä¸èƒ½åˆ°åº•å®¹å™¨</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å†³åŠæ³•ï¼š</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line"></span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br><span class="line"><span class="comment">#2ã€wpç ´å›¾</span></span><br><span class="line">1ã€æŸ¥çœ‹é”™è¯¯æ—¥å¿—</span><br><span class="line">[root@1a60046efc86 wordpress]# tailf /var/log/nginx/error.log </span><br><span class="line">2024/09/05 12:45:49 [crit] 16#16: *432 open() <span class="string">&quot;/var/lib/nginx/tmp/fastcgi/8/01/0000000018&quot;</span> failed (13: Permission denied) <span class="keyword">while</span> reading upstream, client: 10.0.0.1, server: _, request: <span class="string">&quot;GET /wp-admin/site-editor.php?postType=wp_template&amp;postId=twentytwentytwo%2F%2Fhome HTTP/1.1&quot;</span>, upstream: <span class="string">&quot;fastcgi://127.0.0.1:9000&quot;</span>, host: <span class="string">&quot;10.0.0.102&quot;</span>, referrer: <span class="string">&quot;http://10.0.0.102/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Nginx ä¿®æ”¹äº†é»˜è®¤é…ç½®ï¼Œä¸æ˜¯ä»¥ nginx æˆ– root ç”¨æˆ·æ¥è¿è¡Œ Nginxï¼ˆä¸»è¦çš„åŸå› ï¼‰</span><br><span class="line">è¿™ä¸ªç›®å½•æ²¡æœ‰æƒé™å»è®¿é—®ï¼š/var/lib/nginx/tmp ç›®å½•ä¸»è¦æ˜¯ç”¨æ¥å­˜æ”¾ä¸´æ—¶çš„ç¼“å­˜æ–‡ä»¶ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯ Nginx çš„åå‘ä»£ç†ï¼Œå½“æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ä¼šå…ˆæŠŠæ–‡ä»¶å†™å…¥ Nginx çš„ /var/lib/nginx/tmp/client_body ç›®å½•ï¼Œç„¶åå†é€šè¿‡ä»£ç†è½¬å‘åˆ°ç›®æ ‡ç³»ç»Ÿã€‚</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹ /var/lib/nginx/tmp çš„æƒé™ï¼Œä¼šå‘ç°è¿™ä¸ªç›®å½•é»˜è®¤çš„æ‰€æœ‰è€…æ˜¯ nginx:</span><br><span class="line">[root@1a60046efc86 wordpress]# ll /var/lib</span><br><span class="line">.....</span><br><span class="line">drwxr-xr-x 2 root root   6 Apr 11  2018 misc</span><br><span class="line">drwxrwx--- 3 nginx root  17 Sep  5 11:52 nginx <span class="comment">#æƒé™ä¸å¯¹</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€ä¿®æ”¹æƒé™</span><br><span class="line">[root@1a60046efc86 wordpress]# <span class="built_in">chown</span> -R www.www /var/lib/nginx/</span><br><span class="line">[root@1a60046efc86 wordpress]# ll /var/lib</span><br><span class="line">......</span><br><span class="line">drwxrwx--- 1 www  www   17 Sep  5 11:52 nginx</span><br><span class="line"></span><br><span class="line">4ã€å†æ¬¡è®¿é—®ï¼Œåˆ·æ–°æ…¢ä¸€ç‚¹ï¼ŒåŠ é‡ä¸€ä¸‹ï¼Œå°±ä¸ä¼šç ´å›¾äº†</span><br></pre></td></tr></table></figure><h3 id="4ã€Dockerè‡ªåŠ¨åŒ–æ„å»ºé•œåƒ">4ã€<strong>Dockerè‡ªåŠ¨åŒ–æ„å»ºé•œåƒ</strong></h3><p>æ‰‹åŠ¨æ„å»ºé•œåƒçš„ç¼ºé™·<br>1.ä½“ç§¯å¤ªå¤§<br>2.å¯åŠ¨ä¸æ–¹ä¾¿<br>3.æ— æ³•ç›´æ¥ä¿®æ”¹CMD<br>4.æ²¡æœ‰å£°æ˜ç«¯å£<br>5ã€æ²¡æœ‰å£°æ˜å¯æ˜ å°„ç›®å½•</p><h3 id="5ã€Dockerfileçš„ä»‹ç»">5ã€<strong>Dockerfileçš„ä»‹ç»</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Dockerile æ˜¯ä¸€ä¸ªç”¨æ¥æ„å»ºé•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ–‡æœ¬å†…å®¹åŒ…å«äº†ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œè¯´æ˜ã€‚å£°æ˜å¼çš„è„šæœ¬ï¼Œå°†é•œåƒæ„å»ºå†…å®¹ï¼Œå†™å…¥è„šæœ¬ä¸­å³å¯ã€‚</span><br><span class="line"></span><br><span class="line">é•œåƒ:ä¸­è¯</span><br><span class="line">dockerfileï¼šé…æ–¹</span><br><span class="line">dockerfileï¼šå¸¸ç”¨æŒ‡ä»¤</span><br></pre></td></tr></table></figure><p>dockerfileçš„æŒ‡ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FROMï¼šæŒ‡å®šä¸€ä¸ªåŸºç¡€é•œåƒ</span><br><span class="line">RUNï¼š æŒ‡å®šç³»ç»Ÿå‘½ä»¤</span><br><span class="line">CMDï¼š æŒ‡å®šè¿è¡Œå®¹å™¨PIDä¸º1çš„è¿›ç¨‹å‘½ä»¤   </span><br><span class="line">ENTRYPOINTï¼šæŒ‡å®šè¿è¡Œå®¹å™¨PIDä¸º1çš„è¿›ç¨‹å‘½ä»¤ /bin/sh /start.sh</span><br><span class="line"></span><br><span class="line">ADDï¼š å°†å®¿ä¸»æœºä¸Šé¢çš„æ–‡ä»¶docker <span class="built_in">cp</span>åˆ°å®¹å™¨ä¸­(ä¼šè‡ªåŠ¨è§£å‹ï¼Œä¸€èˆ¬ä¼ å‹ç¼©åŒ…,é‡Œé¢ä¸ä¼šä¼ å‹ç¼©åŒ…ï¼Œä¹‹åä¼ è§£å‹åçš„åŒ…)</span><br><span class="line">COPYï¼šå°†å®¿ä¸»æœºä¸Šé¢çš„æ–‡ä»¶docker <span class="built_in">cp</span>åˆ°å®¹å™¨ä¸­(ä¸ä¼šè‡ªåŠ¨å‹ï¼Œä¸€èˆ¬ä¼ é…ç½®æ–‡ä»¶)</span><br><span class="line">WORKDIRï¼šæŒ‡å®šä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œdocker <span class="built_in">exec</span>è¿æ¥è¿›å»æ—¶ï¼Œè‡ªåŠ¨è¿›å…¥è¯¥ç›®å½•ä¸‹</span><br><span class="line">EXPOSEï¼šå£°æ˜é•œåƒè¦æš´éœ²çš„ç«¯å£</span><br><span class="line">VOLUMEï¼š å£°æ˜å¯æ˜ å°„çš„æ•°æ®å·</span><br><span class="line">ENVï¼šå£°æ˜é»˜è®¤ç¯å¢ƒå˜é‡(sshçš„å¯†ç ,æ•°æ®åº“çš„å¯†ç )é•œåƒçš„å±æ€§æ ‡ç­¾</span><br><span class="line"></span><br><span class="line">LABELï¼šæ‰“æ ‡ç­¾</span><br><span class="line">MAINTAINERï¼šå£°æ˜ç®¡ç†è€…æ ‡è¯†</span><br></pre></td></tr></table></figure><h3 id="6ã€è‡ªåŠ¨åŒ–æ„å»ºwordpress">6ã€<strong>è‡ªåŠ¨åŒ–æ„å»ºwordpress</strong></h3><p>1ã€å‡†å¤‡éœ€è¦çš„é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1ã€è¿è¡Œå¸¦æœ‰é…ç½®æ–‡ä»¶çš„å®¹å™¨ï¼Œè¿›å…¥å®¹å™¨ï¼Œå°†éœ€è¦çš„é…ç½®æ–‡ä»¶æ‹‰å‡ºå»</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">exec</span> -it 40b99669a1 /bin/bash</span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºæ‰€éœ€æ–‡ä»¶å­˜æ”¾çš„ç›®å½•</span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> -p /code/wordpress/</span><br><span class="line"></span><br><span class="line">3ã€æ‹‰å–å®¹å™¨é‡Œé¢çš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> 40b99669a160:/etc/nginx/nginx.conf /code/wordpress/</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> 40b99669a160:/etc/nginx/conf.d/wp.conf /code/wordpress/ </span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> 40b99669a160:/etc/php-fpm.d/www.conf /code/wordpress/</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> 40b99669a160:/code/wordpress/wp-config-sample.php /code/wordpress/</span><br><span class="line"></span><br><span class="line">4ã€å‡†å¤‡è¿™äº›æ–‡ä»¶,æ£€æŸ¥é…ç½®æ–‡ä»¶éƒ½å®‰è£…æ‰€éœ€è¦æ±‚æ›´æ”¹ok</span><br><span class="line">[root@docker01 ~]# ll /code/wordpress/</span><br><span class="line">-rw-r--r-- 1 root root  724 Sep  5 23:31 nginx.conf</span><br><span class="line">-rw-r--r-- 1 root root  278 Sep  5 20:12 start.sh</span><br><span class="line">-rw-rw-rw- 1 root root  18M Sep  5 23:24 wordpress-5.9.10.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root  324 Sep  5 19:53 wp.conf</span><br><span class="line">-rw-r--r-- 1 root root 3.0K Sep  5 21:39 wp-config-sample.php</span><br><span class="line">-rw-r--r-- 1 root root  18K Sep  5 23:32 www.conf</span><br></pre></td></tr></table></figure><p>2ã€ç¼–å†™Dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–å†™DockerFile</span><br><span class="line">[root@docker01 ~]# <span class="built_in">cd</span> /code/wordpress/</span><br><span class="line">[root@docker01 wordpress]# vim Dockerfile</span><br><span class="line">FROM centos:7</span><br><span class="line">RUN  curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.huaweicloud.com/repository/conf/CentOS-7-anon.repo</span><br><span class="line">RUN  curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line">RUN  sed -i <span class="string">&quot;s@http://mirrors.aliyun.com@https://mirrors.huaweicloud.com@g&quot;</span> /etc/yum.repos.d/epel.repo</span><br><span class="line">RUN  <span class="built_in">echo</span> -e  <span class="string">&quot;[php-webtatic]\nname = PHP Repository\nbaseurl = http://us-east.repo.webtatic.com/yum/el7/x86_64/\ngpgcheck = 0&quot;</span>&gt; /etc/yum.repos.d/php.repo</span><br><span class="line">RUN  yum -y install php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb nginx  gettext</span><br><span class="line">RUN  groupadd -g 666 www</span><br><span class="line">RUN  useradd -u 666 -g 666 -s /sbin/nologin -M www</span><br><span class="line">RUN  <span class="built_in">mkdir</span> /code</span><br><span class="line">COPY nginx.conf /etc/nginx/nginx.conf</span><br><span class="line">COPY www.conf /etc/php-fpm.d/www.conf</span><br><span class="line">COPY wp.conf /etc/nginx/conf.d/wp.conf</span><br><span class="line">ADD  wordpress-5.9.10.tar.gz  /code</span><br><span class="line">COPY wp-config-sample.php /code/wordpress/wp-config-sample.php</span><br><span class="line">RUN  <span class="built_in">chown</span> -R  www.www /code</span><br><span class="line">RUN  <span class="built_in">chown</span> -R www.www /var/lib/nginx</span><br><span class="line">COPY start.sh /start.sh</span><br><span class="line">RUN  <span class="built_in">rm</span> -rf /code/wordpress-5.9.10.tar.gz</span><br><span class="line">RUN  yum clean all</span><br><span class="line">RUN  <span class="built_in">rm</span> -rf /etc/yum.repos.d/* </span><br><span class="line">CMD  [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;/start.sh&quot;</span>]</span><br><span class="line">EXPOSE 80/tcp 8080/tcp</span><br><span class="line">WORKDIR /code/wordpress</span><br><span class="line">VOLUME  /code/wordpress</span><br><span class="line">ENV  WORDPRESS_DB_NAME=wp_db</span><br><span class="line">ENV  WORDPRESS_DB_USER=wp_user</span><br><span class="line">ENV  WORDPRESS_DB_PASSWORD=123</span><br><span class="line">ENV  WORDPRESS_DB_HOST=localhost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#æ„å»º</span><br><span class="line">[root@docker01 wordpress]# docker build -t wordpress-df:v1 .</span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY                      TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">wordpress-df                    v1        e389c28d9b3b   14 hours ago    831MB</span><br><span class="line"></span><br><span class="line">3ã€åˆ é™¤æ•°æ®åº“æ•°æ®ç›®å½•ï¼Œä¸ç„¶ç¬¬äºŒæ¬¡å¯åŠ¨ä¸èƒ½å»ºåº“ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡çš„æ•°æ®å·²ç»æŒä¹…åŒ–äº†</span><br><span class="line">[root@docker02 ~]# <span class="built_in">rm</span> -rf /data</span><br><span class="line"></span><br><span class="line">4ã€è¿è¡Œå¸¦å˜é‡çš„å®¹å™¨</span><br><span class="line"><span class="comment">#è¿è¡Œæ•°æ®åº“</span></span><br><span class="line">docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wp_db \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œwordpresså®¹å™¨</span></span><br><span class="line">docker run \</span><br><span class="line">--name wp \</span><br><span class="line">--<span class="built_in">link</span> mysql57 \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql57 \</span><br><span class="line">-e WORDPRESS_DB_USER=wp_user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=123 \</span><br><span class="line">-e WORDPRESS_DB_NAME=wp_db \</span><br><span class="line">-d wordpress-df:v1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.101</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240906135218039.png" alt="image-20240906135218039"></p><p>3ã€ä¼˜åŒ–Dockerfileçš„åŸåˆ™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼˜åŒ–åŸåˆ™:æ„å»ºçš„é•œåƒå°½å¯èƒ½å°,æ„å»ºé€Ÿåº¦å°½å¯èƒ½å¿«</span></span><br><span class="line">a: ä½¿ç”¨ä½“ç§¯å°çš„linuxé•œåƒalpineä½œä¸ºåŸºç¡€é•œåƒ</span><br><span class="line">bï¼šå°½å¯èƒ½çš„æ¸…ç†æ— ç”¨çš„ç¼“å­˜æ–‡ä»¶ï¼ˆå°½å¯èƒ½æŠŠå¤šä¸ªRUNåˆå¹¶ï¼‰</span><br><span class="line">cï¼šä¿®æ”¹dockerfileçš„æ—¶å€™ï¼Œå°½å¯èƒ½æŠŠä¿®æ”¹çš„å†…å®¹æ”¾åœ¨æœ€å</span><br><span class="line">dï¼šä½¿ç”¨.dockerignoreå¿½ç•¥æ„å»ºdockeré•œåƒæ—¶ï¼Œä¸éœ€è¦çš„æ–‡ä»¶</span><br><span class="line">f:ä½¿ç”¨\å‡å°‘ä¸å¿…è¦çš„æ–‡ä»¶RUNæˆ–ADD</span><br><span class="line"></span><br><span class="line">å±‚æ•°å¤šä¸ä»£è¡¨ä½“ç§¯å¤§ï¼Œå±‚æ•°å¤šå’Œé•œåƒé‡Œé¢çš„æœåŠ¡ï¼Œå‘½ä»¤ï¼Œå®‰è£…åŒ…æœ‰å…³ï¼Œå±‚æ•°å¤šæ˜¯å‘½ä»¤å¤šï¼Œä¸ä¼šè®©æ–‡ä»¶æ•°é‡ï¼Œæ–‡ä»¶å¤§å°å¢åŠ </span><br></pre></td></tr></table></figure><p>4ã€ä¼˜åŒ–Dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¼˜åŒ–DockerFile</span><br><span class="line">[root@docker01 ~]# <span class="built_in">cd</span> /code/wordpress/</span><br><span class="line">[root@docker01 wordpress]# vim Dockerfile</span><br><span class="line">FROM centos:7</span><br><span class="line">RUN  curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.huaweicloud.com/repository/conf/CentOS-7-anon.repo &amp;&amp; \</span><br><span class="line">curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo &amp;&amp; \</span><br><span class="line">sed -i <span class="string">&quot;s@http://mirrors.aliyun.com@https://mirrors.huaweicloud.com@g&quot;</span> /etc/yum.repos.d/epel.repo &amp;&amp; \</span><br><span class="line"><span class="built_in">echo</span> -e  <span class="string">&quot;[php-webtatic]\nname = PHP Repository\nbaseurl = http://us-east.repo.webtatic.com/yum/el7/x86_64/\ngpgcheck = 0&quot;</span>&gt; /etc/yum.repos.d/php.repo &amp;&amp; \</span><br><span class="line">yum -y install php71w php71w-cli php71w-common php71w-devel php71w-embedded php71w-gd php71w-mcrypt php71w-mbstring php71w-pdo php71w-xml php71w-fpm php71w-mysqlnd php71w-opcache php71w-pecl-memcached php71w-pecl-redis php71w-pecl-mongodb nginx  gettext &amp;&amp; \</span><br><span class="line">groupadd -g 666 www &amp;&amp; \</span><br><span class="line">useradd -u 666 -g 666 -s /sbin/nologin -M www &amp;&amp; \</span><br><span class="line"><span class="built_in">mkdir</span> /code &amp;&amp; \</span><br><span class="line">yum clean all &amp;&amp; \</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/yum.repos.d/*</span><br><span class="line">COPY nginx.conf /etc/nginx/nginx.conf</span><br><span class="line">COPY www.conf /etc/php-fpm.d/www.conf</span><br><span class="line">COPY wp.conf /etc/nginx/conf.d/wp.conf</span><br><span class="line">ADD  wordpress-5.9.10.tar.gz  /code</span><br><span class="line">COPY wp-config-sample.php /code/wordpress/wp-config-sample.php</span><br><span class="line">RUN  <span class="built_in">chown</span> -R  www.www /code &amp;&amp; \</span><br><span class="line"><span class="built_in">chown</span> -R www.www /var/lib/nginx</span><br><span class="line">COPY start.sh /start.sh</span><br><span class="line">CMD  [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;/start.sh&quot;</span>]</span><br><span class="line">EXPOSE 80/tcp 8080/tcp</span><br><span class="line">WORKDIR /code/wordpress</span><br><span class="line">VOLUME  /code/wordpress</span><br><span class="line">ENV  WORDPRESS_DB_NAME=wp_db</span><br><span class="line">ENV  WORDPRESS_DB_USER=wp_user</span><br><span class="line">ENV  WORDPRESS_DB_PASSWORD=123</span><br><span class="line">ENV  WORDPRESS_DB_HOST=localhost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#æ„å»º</span><br><span class="line">[root@docker01 wordpress]# docker build -t wordpress-df:v1 .</span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY                      TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">wordpress-df                    v2        1a14add5916b   11 seconds ago   530MB</span><br><span class="line"></span><br><span class="line">3ã€åˆ é™¤æ•°æ®åº“æ•°æ®ç›®å½•ï¼Œä¸ç„¶ç¬¬äºŒæ¬¡å¯åŠ¨ä¸èƒ½å»ºåº“ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡çš„æ•°æ®å·²ç»æŒä¹…åŒ–äº†</span><br><span class="line">[root@docker02 ~]# <span class="built_in">rm</span> -rf /data</span><br><span class="line"></span><br><span class="line">4ã€è¿è¡Œå¸¦å˜é‡çš„å®¹å™¨</span><br><span class="line"><span class="comment">#è¿è¡Œæ•°æ®åº“</span></span><br><span class="line">docker run \</span><br><span class="line">--name mysql57 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=wp_db \</span><br><span class="line">-e MYSQL_USER=wp_user \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:5.7.44</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œwordpresså®¹å™¨</span></span><br><span class="line">docker run \</span><br><span class="line">--name wp \</span><br><span class="line">--<span class="built_in">link</span> mysql57 \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-e WORDPRESS_DB_HOST=mysql57 \</span><br><span class="line">-e WORDPRESS_DB_USER=wp_user \</span><br><span class="line">-e WORDPRESS_DB_PASSWORD=123 \</span><br><span class="line">-e WORDPRESS_DB_NAME=wp_db \</span><br><span class="line">-d wordpress-df:v2 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.101</span><br></pre></td></tr></table></figure><h3 id="7ã€åˆ¶ä½œzabbixé•œåƒ">7ã€<strong>åˆ¶ä½œzabbixé•œåƒ</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‹‰å–ç›¸å…³é•œåƒ</span><br><span class="line">[root@docker01 ~]#  docker pull zabbix/zabbix-server-mysql</span><br><span class="line">[root@docker01 ~]#  docker pull zabbix/zabbix-web-nginx-mysql</span><br><span class="line">[root@docker01 ~]#  docker pull mysql:8.0</span><br><span class="line"></span><br><span class="line">2ã€#è¿è¡Œæ•°æ®åº“</span><br><span class="line">æ³¨æ„ï¼šå†æ¬¡å¯åŠ¨æ•°æ®åº“ä¹‹å‰å…ˆæ¸…ç©ºdataç›®å½•</span><br><span class="line"><span class="built_in">rm</span> -rf /data/mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">--name mysql80 \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /data/mysql:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123 \</span><br><span class="line">-e MYSQL_DATABASE=zabbix \</span><br><span class="line">-e MYSQL_USER=zabbix \</span><br><span class="line">-e MYSQL_PASSWORD=123 \</span><br><span class="line">--restart=always \</span><br><span class="line">-d mysql:8.0 \</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--character-set-server=utf8mb4 </span><br><span class="line">--collation-server=utf8mb4_bin </span><br><span class="line">--log_bin_trust_function_creators</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€yunxå®¹å™¨åŒ–zabbix-server</span><br><span class="line">docker run \</span><br><span class="line">--<span class="built_in">link</span> mysql80 \</span><br><span class="line">--name zabbix-server \</span><br><span class="line">-p 10051:10051 \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">&quot;mysql80&quot;</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">&quot;zabbix&quot;</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">&quot;123&quot;</span> \</span><br><span class="line">-d zabbix/zabbix-server-mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€å®¹å™¨åŒ–zabbix-web</span><br><span class="line">docker run \</span><br><span class="line">--<span class="built_in">link</span> zabbix-server \</span><br><span class="line">--<span class="built_in">link</span> mysql80 \</span><br><span class="line">--name zabbix-web \</span><br><span class="line">-p 80:8080 \</span><br><span class="line">-p 8443:8443 \</span><br><span class="line">-e DB_SERVER_HOST=<span class="string">&quot;mysql80&quot;</span> \</span><br><span class="line">-e MYSQL_USER=<span class="string">&quot;zabbix&quot;</span> \</span><br><span class="line">-e MYSQL_PASSWORD=<span class="string">&quot;123&quot;</span> \</span><br><span class="line">-e ZBX_SERVER_HOST=<span class="string">&quot;zabbix-server&quot;</span> \</span><br><span class="line">-e PHP_TZ=<span class="string">&quot;Asia/Shanghai&quot;</span> \</span><br><span class="line">-d zabbix/zabbix-web-nginx-mysql</span><br><span class="line"></span><br><span class="line">5ã€æ£€æŸ¥3ä¸ªå®¹å™¨æ˜¯å¦èµ·æ¥</span><br><span class="line">[root@docker01 ~]# docker ps </span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240905101309249.png" alt="image-20240905101309249"></p><p><img src="../image/study_img/image-20240905100315171.png" alt="image-20240905100315171"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å‡ºç°ä»¥ä¸ŠæŠ¥é”™å°±æ˜¯mysql8.0å¯åŠ¨å‘½ä»¤åŠ å‚æ•°</span><br><span class="line">--log_bin_trust_funetion</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240905143325160.png" alt="image-20240905143325160"></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡äºŒã€Dockerå¯¹è±¡æ“ä½œ</title>
      <link href="/posts/8f4c40fd.html"/>
      <url>/posts/8f4c40fd.html</url>
      
        <content type="html"><![CDATA[<h2 id="Dockerå¯¹è±¡æ“ä½œ">Dockerå¯¹è±¡æ“ä½œ</h2><h3 id="1ã€Dockeré•œåƒçš„æ“ä½œ"><strong>1ã€Dockeré•œåƒçš„æ“ä½œ</strong></h3><p>dockerå®˜ç½‘å¯»æ‰¾é•œåƒï¼š<a href="https://hub.docker.com/">https://hub.docker.com/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æœç´¢é•œåƒ  (é€‰é¡¹imageå¯ä»¥çœç•¥)</span></span><br><span class="line">[root@docker01 ~]# docker search nginx</span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@docker01 ~]# docker image search nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºé•œåƒçš„å…³é”®è¿‡ç¨‹</span></span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">history</span> alpine</span><br><span class="line">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT</span><br><span class="line">324bc02ae123   6 weeks ago   /bin/sh -c <span class="comment">#(nop)  CMD [&quot;/bin/sh&quot;]              0B        </span></span><br><span class="line">&lt;missing&gt;      6 weeks ago   /bin/sh -c <span class="comment">#(nop) ADD file:99093095d62d04215â€¦   7.8MB  </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‹‰å–é•œåƒï¼š (é€‰é¡¹imageå¯ä»¥çœç•¥)</span></span><br><span class="line">docker pull ä»åº“å:æ ‡ç­¾å   (ä¸åŠ æ ‡ç­¾é»˜è®¤æ‹‰å–latestç‰ˆæœ¬çš„)</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker pull nginx:alpine </span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@docker01 ~]# docker image pull nginx:alpine</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker pull nginx:latest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ‹‰å–åˆ°çš„é•œåƒ</span></span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx        alpine    0f0eda053dc5   2 weeks ago     43.3MB</span><br><span class="line">nginx        latest    5ef79149e0ec   2 weeks ago     188MB</span><br><span class="line">alpine       latest    324bc02ae123   6 weeks ago     7.8MB</span><br><span class="line">busybox      latest    87ff76f62d36   15 months ago   4.26MB</span><br><span class="line">centos       6         5bf9684f4720   2 years ago     194MB</span><br><span class="line">centos       7         eeb6ee3f44bd   2 years ago     204MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤é•œåƒ  rmi     (ä¸åŠ æ ‡ç­¾ï¼Œé»˜è®¤åˆ é™¤latest)</span></span><br><span class="line">[root@docker01 ~]# docker rmi centos:6  </span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@docker01 ~]# docker image <span class="built_in">rm</span> centos:6 </span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@docker01 ~]# docker rmi 5bf9684f4720</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å‡ºé•œåƒ(ä¸€æ¬¡åªèƒ½å¯¼å‡ºä¸€ä¸ª)</span></span><br><span class="line">[root@docker01 ~]# docker save centos:7 -o /tmp/c7.tgz</span><br><span class="line">-oï¼šoutput è¾“å‡º</span><br><span class="line">æˆ–è€…</span><br><span class="line">[root@docker01 ~]# docker save centos:7 &gt; /tmp/c7_2.tgz</span><br><span class="line">&gt;ï¼šé‡å®šå‘</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# ll /tmp/ -h</span><br><span class="line">-rw-r--r-- 1 root root 202M Sep  3 14:22 c7_2.tgz</span><br><span class="line">-rw------- 1 root root 202M Sep  3 14:21 c7.tgz</span><br><span class="line">-rw------- 1 root root 202M Sep  3 14:35 eeb6ee3f44bd.tgz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¼å…¥é•œåƒ</span></span><br><span class="line">[root@docker01 ~]# scp /tmp/c7.tgz  172.16.1.102:/tmp</span><br><span class="line"></span><br><span class="line">[root@docker02 ~]# docker image load -i /tmp/c7.tgz</span><br><span class="line">-iï¼šinput è¾“å…¥</span><br><span class="line">æˆ–è€…  &lt;ï¼šæ ‡æ³¨è¾“å…¥</span><br><span class="line">[root@docker02 ~]# docker image load &lt; /tmp/c7.tgz</span><br><span class="line"></span><br><span class="line">é•œåƒå±‚æ•°æ˜¯åˆ†å±‚çš„ï¼Œé•œåƒæœ‰ç›¸åŒçš„å±‚æ•°ï¼Œä¸ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œå†æ¬¡æŠŠc7_2.tgzå¯¼è¿›å»ä¸ä¼šé‡å¤ï¼Œä¸ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œä»–ä¼šè‡ªåŠ¨è¯†åˆ«åˆ°æ˜¯åŒä¸€ä¸ªå±‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ–è€…ä½¿ç”¨IDæ¥å¯¼å‡º(ä¸æ¨èï¼Œå› ä¸ºå¯¼å…¥åˆ°æ–°ç¯å¢ƒçš„æ—¶å€™æ²¡æœ‰åå­—)</span><br><span class="line">[root@docker01 ~]# docker save  eeb6ee3f44bd -o /tmp/eeb6ee3f44bd.tgz</span><br><span class="line">[root@docker01 ~]# scp /tmp/eeb6ee3f44bd.tgz 172.16.1.103:/tmp</span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# docker image load -i /tmp/eeb6ee3f44bd.tgz </span><br><span class="line">[root@docker03 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">&lt;none&gt;       &lt;none&gt;    eeb6ee3f44bd   2 years ago   204MB</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™é•œåƒåŠ æ ‡ç­¾(æ”¹å)</span></span><br><span class="line">docker tag IDå· é•œåƒå:æ ‡ç­¾</span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# docker tag eeb6ee3f44bd centos:7</span><br><span class="line">[root@docker03 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">centos       7         eeb6ee3f44bd   2 years ago   204MB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹é•œåƒçš„è¯¦ç»†ä¿¡æ¯(å¸¸ç”¨)</span></span><br><span class="line">[root@docker02 ~]# docker inspect nginx:alpine</span><br></pre></td></tr></table></figure><h3 id="2ã€Dockerå®¹å™¨çš„æ“ä½œ"><strong>2ã€Dockerå®¹å™¨çš„æ“ä½œ</strong></h3><p>Docker å®¹å™¨æ“ä½œçš„é€‰é¡¹</p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>â€“name</td><td>è‡ªå®šä¹‰å®¹å™¨å</td></tr><tr><td>-d</td><td>å°†å®¹å™¨æ”¾åå°å¯åŠ¨</td></tr><tr><td>-it   (input   TTY)</td><td>åˆ†é…ä¸€ä¸ªäº¤äº’å¼çš„ç»ˆç«¯</td></tr><tr><td>-p</td><td>ç«¯å£æ˜ å°„</td></tr><tr><td>-P</td><td>æ˜ å°„éšæœºç«¯å£</td></tr><tr><td>-v</td><td>æ•°æ®å·æ˜ å°„</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®¹å™¨è¿è¡Œçš„åŸåˆ™ï¼š</span></span><br><span class="line">1ã€ä¸€ä¸ªå®¹å™¨æœ€å¥½åªåšä¸€ä»¶äº‹</span><br><span class="line">(æ¯”å¦‚è¯´æ­wp,æœ€ånginxè·‘ä¸€ä¸ªå®¹å™¨,mysqlè·‘ä¸€ä¸ªå®¹å™¨,phpè·‘ä¸€ä¸ªå®¹å™¨,æœ€å¥½åˆ†å¼€ï¼Œå¦‚æœæƒ³è¦ä¸€ä¸ªå®¹å™¨è·‘å¤šä¸ªåº”ç”¨ï¼Œéœ€è¦è§£å†³æ¨ªå‘æ‰©å±•çš„é—®é¢˜)</span><br><span class="line">2ã€å®¹å™¨è¿è¡Œå¿…é¡»ä¿è¯å®¹å™¨å†…PIDä¸º1çš„è¿›ç¨‹ä¸€ç›´å­˜åœ¨</span><br><span class="line"></span><br><span class="line">PIDä¸º1çš„è¿›ç¨‹æ˜¯è°å†³å®šçš„ï¼š</span><br><span class="line">1ã€docker runè¿è¡Œå®¹å™¨ååŠ çš„å‘½ä»¤</span><br><span class="line">2ã€å¦‚æœåœ¨è¿è¡Œå®¹å™¨æ—¶æ²¡æœ‰åŠ ä»»ä½•å‘½ä»¤ï¼Œåˆ™ä»¥å®¹å™¨é•œåƒä¸­çš„CMDä¸­çš„å‘½ä»¤ä½œä¸ºPIDä¸º1çš„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€#è¿è¡Œalpineå®¹å™¨</span><br><span class="line">[root@docker03 ~]# docker run alpine /bin/echo <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">hello world</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">[root@docker02 ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">1ed0569ef98e   alpine    <span class="string">&quot;/bin/echo &#x27;hello woâ€¦&quot;</span>   9 seconds ago    Exited (0) 9 seconds ago             affectionate_curie</span><br><span class="line">a1b13ddd5328   alpine    <span class="string">&quot;echo hello world&quot;</span>       19 seconds ago   Created                              goofy_bartik</span><br><span class="line">-aï¼šæŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span><br><span class="line">[root@docker02 ~]# docker ps -aq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œä¸€ä¸ªå®¹å™¨</span></span><br><span class="line">docker run [1ä¸ªæˆ–è€…å¤šä¸ªé€‰é¡¹]  é•œåƒ [<span class="built_in">command</span>]</span><br><span class="line">[root@docker02 ~]# docker run centos:7 /bin/bash</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker run -it -d  busybox  /bin/sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®©å®¹å™¨åœ¨åå°è¿è¡Œ</span></span><br><span class="line">[root@docker03 ~]# docker run -d centos:7 tailf /etc/passwd</span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND               CREATED          STATUS          PORTS     NAMES</span><br><span class="line">29d1fc5f02e3   centos:7   <span class="string">&quot;tailf /etc/passwd&quot;</span>   28 seconds ago   Up 28 seconds             vibrant_ritchie</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œå®¹å™¨æ—¶ç»™å®¹å™¨èµ·ä¸€ä¸ªåå­—</span></span><br><span class="line">[root@docker03 ~]# docker run --name wordpress -d nginx:alpine</span><br><span class="line">[root@docker03 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">c13fdc5ac70e   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   18 seconds ago   Up 17 seconds   80/tcp    wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿è¡Œä¸€ä¸ªé•œåƒå¹¶è¿è¿›å»</span></span><br><span class="line">[root@docker03 ~]# docker run -it centos:7 /bin/bash</span><br><span class="line"></span><br><span class="line">3ã€#è¿æ¥ä¸€ä¸ªå®¹å™¨</span><br><span class="line">å¦‚æœ/bin/bashä¸èƒ½è¿æ¥è¿›å»ï¼Œå°±æ¢æˆ/bin/sh</span><br><span class="line">[root@docker03 ~]# docker <span class="built_in">exec</span> -it 29d1fc5f02e3 /bin/bash</span><br><span class="line">æŸ¥çœ‹PIDä¸º1çš„è¿›ç¨‹</span><br><span class="line">[root@29d1fc5f02e3 /]# ps -aux</span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.0   4364   584 ?        Ss   07:11   0:00 tailf /etc/passwd</span><br><span class="line"></span><br><span class="line">--------docker run å¸®æˆ‘ä»¬åšäº†å“ªäº›äº‹-----</span><br><span class="line">[root@docker02 ~]# docker run nginx:alpine</span><br><span class="line"></span><br><span class="line">1ã€æ‹‰é•œåƒ</span><br><span class="line">docker pull nginx:alpine</span><br><span class="line">2ã€åˆ›å»ºå®¹å™¨</span><br><span class="line">docker create nginx:alpine</span><br><span class="line">3ã€å¯åŠ¨å®¹å™¨</span><br><span class="line">docker start 29d1fc5f02e3</span><br><span class="line">--------------------------------</span><br><span class="line"></span><br><span class="line">4ã€#åœæ­¢å®¹å™¨</span><br><span class="line">[root@docker03 ~]# docker ps</span><br><span class="line">[root@docker03 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND               CREATED          STATUS          PORTS     NAMES</span><br><span class="line">29d1fc5f02e3   centos:7   <span class="string">&quot;tailf /etc/passwd&quot;</span>   17 minutes ago   Up 17 minutes             vibrant_ritchie</span><br><span class="line"></span><br><span class="line">åŠ åå­—</span><br><span class="line">[root@docker03 ~]# docker stop vibrant_ritchie</span><br><span class="line">vibrant_ritchie</span><br><span class="line">æˆ–è€… åŠ ID</span><br><span class="line">[root@docker03 ~]# docker stop 29d1fc5f02e3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€#åˆ é™¤å®¹å™¨</span><br><span class="line">docker <span class="built_in">rm</span> -f [container <span class="built_in">id</span>]    </span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# docker <span class="built_in">rm</span> 29d1fc5f02e3</span><br><span class="line">[root@docker03 ~]# docker <span class="built_in">rm</span> -f 29d1fc5f02e3</span><br><span class="line"><span class="comment">#(å¼ºåˆ¶åˆ é™¤  -f )</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰¹é‡åˆ é™¤</span></span><br><span class="line">[root@docker03 ~]# docker <span class="built_in">rm</span> -f $(docker ps -q)</span><br><span class="line">æ‰¹é‡åˆ é™¤åœæ­¢è¿è¡Œçš„å®¹å™¨ -aq</span><br><span class="line">[root@docker03 ~]# docker <span class="built_in">rm</span> -f $(docker ps -aq)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€#ä»£ç çš„ä¸Šä¼ å’Œæ‹‰å–</span><br><span class="line"><span class="comment">#å°†ä»£ç ä¸Šä¼ åˆ°å®¹å™¨</span></span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> 1.txt 74ce711a7128:/root</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°†å®¹å™¨é‡Œé¢çš„ä»£ç ä¸‹è½½åˆ°æœ¬åœ°</span></span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> 74ce711a7128:/etc/passwd ./</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä½¿ç”¨å‘½ä»¤å°†nginxå¯åŠ¨å¹¶ä¸”å¡ä½ï¼Œå®¹å™¨å°±ä¸ä¼šç»“æŸ</span><br><span class="line">[root@docker03 ~]# nginx -g <span class="string">&#x27;daemon off;&#x27;</span></span><br></pre></td></tr></table></figure><p>æŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹é•œåƒ</span><br><span class="line">[root@docker02 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">alpine       latest    324bc02ae123   6 weeks ago   7.8MB</span><br><span class="line"></span><br><span class="line">2ã€åˆ é™¤é•œåƒï¼ŒæŠ¥é”™</span><br><span class="line">[root@docker02 ~]# docker rmi 324bc02ae123</span><br><span class="line">Error response from daemon: conflict: unable to delete 324bc02ae123 (must be forced) - image is being used by stopped container a1b13ddd5328</span><br><span class="line"></span><br><span class="line">3ã€åˆ é™¤ä¾èµ–çš„å®¹å™¨</span><br><span class="line">[root@docker02 ~]# docker ps -a | grep <span class="string">&quot;alpine&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs docker <span class="built_in">rm</span></span><br><span class="line">1ed0569ef98e</span><br><span class="line">a1b13ddd5328</span><br><span class="line"></span><br><span class="line">4ã€åˆ é™¤é•œåƒ</span><br><span class="line">[root@docker02 ~]# docker rmi 324bc02ae123</span><br></pre></td></tr></table></figure><h3 id="3ã€å®¹å™¨çš„ç«¯å£æ˜ å°„">3ã€<strong>å®¹å™¨çš„ç«¯å£æ˜ å°„</strong></h3><p>å®¹å™¨éœ€è¦åšç«¯å£æ˜ å°„æ‰èƒ½è®©å¤–ç•Œè®¿é—®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ç«¯å£æ˜ å°„</span><br><span class="line">   -p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£</span><br><span class="line">   -P å®¿ä¸»æœºIP:å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£  (å¤šä¸ªå®¹å™¨éƒ½æƒ³ä½¿ç”¨80ç«¯å£)</span><br><span class="line">   -p å®¿ä¸»æœºIP::å®¹å™¨ç«¯å£(éšæœºç«¯å£)</span><br><span class="line">   -p å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£/udp (ä½†æ˜¯ä¸€èˆ¬TCPçš„æ¯”è¾ƒå¤š)</span><br><span class="line">   -p å®¿ä¸»æœºIP::å®¹å™¨ç«¯å£/udpä½¿ç”¨å®¿ä¸»æœºçš„10.0.8.183è¿™ä¸ªipåœ°å€çš„éšæœºç«¯å£çš„udpåè®®æ˜ å°„å®¹å™¨çš„udp53ç«¯å£</span><br><span class="line">   -p 81:80 -p 443:443 å¯ä»¥æŒ‡å®šå¤šä¸ª-p</span><br><span class="line">   -p 80-88:80-88 ç«¯å£èŒƒå›´æ˜ å°„</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">1ã€#  -pï¼šæŠŠå®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„80ç«¯å£</span><br><span class="line">[root@docker03 ~]# docker run -p80:80 -d nginx:alpine</span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">92e2dbca064e   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   9 seconds ago    Up 8 seconds    0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   adoring_hertz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æµè§ˆå™¨è®¿é—®10.0.0.103ï¼Œå°±å¯ä»¥è®¿é—®nginxé¡µé¢</span><br><span class="line"></span><br><span class="line">2ã€</span><br><span class="line">[root@docker03 ~]# docker run -p8080:80 -p90:90 -d nginx:alpine</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å®¿ä¸»æœºä¸Šæœ‰8080å’Œ90ç«¯å£</span><br></pre></td></tr></table></figure><p>-P å®¿ä¸»æœºIP:å®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£    (é’ˆå¯¹ä¸åŒçš„IPï¼Œè®¿é—®ä¸åŒçš„å®¹å™¨ï¼Œå¤šä¸ªå®¹å™¨éƒ½æƒ³ä½¿ç”¨80ç«¯å£)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1ã€å…ˆæ¸…æ¥šä¹‹å‰å…è®¸çš„docker</span><br><span class="line">[root@docker03 ~]# docker <span class="built_in">rm</span> -f $(docker ps -q)</span><br><span class="line"></span><br><span class="line">2ã€ç«¯å£æ˜ å°„</span><br><span class="line">[root@docker03 ~]# docker run -p10.0.0.103:80:80 -d nginx:alpine</span><br><span class="line">[root@docker03 ~]# docker run -p172.16.1.103:80:80 -d nginx:alpine</span><br><span class="line">[root@docker03 ~]# docker run -p127.0.0.1:80:80 -d nginx:alpine</span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                     NAMES</span><br><span class="line">7a87c542db29   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   25 seconds ago   Up 24 seconds   127.0.0.1:80-&gt;80/tcp      kind_mahavira</span><br><span class="line">a2d578ffff01   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   47 seconds ago   Up 46 seconds   172.16.1.103:80-&gt;80/tcp   interesting_joliot</span><br><span class="line">98e6d6611bd6   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   59 seconds ago   Up 58 seconds   10.0.0.103:80-&gt;80/tcp     interesting_jennings</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸åŒçš„ç½‘å¡ï¼Œä¸åŒçš„ip,è®¿é—®æ–¹å¼ä¸ä¸€æ ·</span></span><br><span class="line">æŸ¥çœ‹å®¹å™¨æ—¥å¿—</span><br><span class="line">[root@docker03 ~]# docker logs -f å®¹å™¨ID</span><br><span class="line">[root@docker03 ~]# docker logs -f å®¹å™¨å</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹10.0.0.103:80-&gt;80/tcpå®¹å™¨çš„è®¿é—®æ—¥å¿—</span><br><span class="line">[root@docker03 ~]# docker logs -f 98e6d6611bd6</span><br><span class="line">æµè§ˆå™¨è®¿é—®10.0.0.103ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—å˜åŒ–ï¼Œè¯·æ±‚è¿‡æ¥äº†</span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹172.16.1.103:80-&gt;80/tcpå®¹å™¨çš„è®¿é—®æ—¥å¿—</span><br><span class="line">[root@docker03 ~]# docker logs -f a2d578ffff01</span><br><span class="line"></span><br><span class="line">æ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯ï¼Œä½¿ç”¨curlå‘½ä»¤è®¿é—®ï¼Œçœ‹åˆ°æ—¥å¿—æœ‰è¯·æ±‚å°±è®¿é—®æˆåŠŸ</span><br><span class="line">[root@docker03 ~]# curl 172.16.1.103</span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹127.0.0.1:80-&gt;80/tcpå®¹å™¨çš„è®¿é—®æ—¥å¿—</span><br><span class="line">[root@docker03 ~]# docker logs  -f 7a87c542db29</span><br><span class="line">æ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯ï¼Œä½¿ç”¨curlå‘½ä»¤è®¿é—®ï¼Œçœ‹åˆ°æ—¥å¿—æœ‰è¯·æ±‚å°±è®¿é—®æˆåŠŸ</span><br><span class="line">[root@docker03 ~]# curl 127.0.0.1</span><br></pre></td></tr></table></figure><p>-p å®¿ä¸»æœºIP::å®¹å™¨ç«¯å£(éšæœºç«¯å£)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1ã€åœ¨å®¿ä¸»æœºä¸Šèµ·5ä¸ªéšæœºç«¯å£</span><br><span class="line">[root@docker03 ~]# docker run -p10.0.0.103::80 -d nginx:alpine</span><br><span class="line">[root@docker03 ~]# docker run -p10.0.0.103::80 -d nginx:alpine</span><br><span class="line">[root@docker03 ~]# docker run -p10.0.0.103::80 -d nginx:alpine</span><br><span class="line">[root@docker03 ~]# docker run -p10.0.0.103::80 -d nginx:alpine</span><br><span class="line">[root@docker03 ~]# docker run -p10.0.0.103::80 -d nginx:alpine</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹ç«¯å£</span><br><span class="line">[root@docker03 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED              STATUS              PORTS                      NAMES</span><br><span class="line">57ae53de8781   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   About a minute ago   Up About a minute   10.0.0.103:32776-&gt;80/tcp   distracted_tharp</span><br><span class="line">fe081b7a25ac   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   About a minute ago   Up About a minute   10.0.0.103:32775-&gt;80/tcp   kind_knuth</span><br><span class="line">2ed44ac6261f   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   About a minute ago   Up About a minute   10.0.0.103:32774-&gt;80/tcp   clever_sinoussi</span><br><span class="line">c009cf3348ff   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   About a minute ago   Up About a minute   10.0.0.103:32773-&gt;80/tcp   inspiring_hawking</span><br><span class="line">fe02a74ce3d2   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   About a minute ago   Up About a minute   10.0.0.103:32772-&gt;80/tcp   keen_yonath</span><br><span class="line"></span><br><span class="line">3ã€æµè§ˆå™¨è®¿é—®è¿™äº›é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°nginxæµ‹è¯•é¡µ</span><br><span class="line">10.0.0.103:32776</span><br><span class="line">10.0.0.103:32775</span><br><span class="line">10.0.0.103:32774</span><br><span class="line">10.0.0.103:32773</span><br><span class="line">10.0.0.103:32772</span><br></pre></td></tr></table></figure><p>-p 80-88:80-88 ç«¯å£èŒƒå›´æ˜ å°„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@docker03 ~]# docker run  -p81-85:81-85 -d nginx:alpine</span><br><span class="line"></span><br><span class="line">[root@docker03 ~]# netstat -lntup|grep <span class="string">&#x27;\b8[0-9]\b&#x27;</span></span><br><span class="line">tcp        0      0 0.0.0.0:81              0.0.0.0:*</span><br><span class="line">tcp        0      0 0.0.0.0:82              0.0.0.0:*</span><br><span class="line">tcp        0      0 0.0.0.0:83              0.0.0.0:*</span><br><span class="line">tcp        0      0 0.0.0.0:84              0.0.0.0:*</span><br><span class="line">tcp        0      0 0.0.0.0:85              0.0.0.0:*</span><br><span class="line">tcp6       0      0 :::81                   :::*     </span><br><span class="line">tcp6       0      0 :::82                   :::*     </span><br><span class="line">tcp6       0      0 :::83                   :::*     </span><br><span class="line">tcp6       0      0 :::84                   :::*     </span><br><span class="line">tcp6       0      0 :::85                   :::*     </span><br></pre></td></tr></table></figure><h3 id="4ã€æ¡ˆä¾‹ï¼šè¿è¡Œå®¹å™¨ï¼Œéƒ¨ç½²æ¸¸æˆä»£ç ">4ã€<strong>æ¡ˆä¾‹ï¼šè¿è¡Œå®¹å™¨ï¼Œéƒ¨ç½²æ¸¸æˆä»£ç </strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½ä»£ç </span><br><span class="line">[root@docker01 ~]# wget http://test.driverzeng.com/Nginx_Code/h5_games.zip</span><br><span class="line"></span><br><span class="line">2ã€è¿è¡Œnginxå®¹å™¨</span><br><span class="line">[root@docker01 ~]# docker run -p80:80 -d nginx:alpine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹è¿è¡Œçš„PID</span><br><span class="line">[root@docker01 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED              STATUS              PORTS                               NAMES</span><br><span class="line">74ce711a7128   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   About a minute ago   Up About a minute   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   zealous_shaw</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹æ˜¯å¦å­˜åœ¨å·¥ä½œç›®å½•     çœ‹åˆ°ä¸å­˜åœ¨å·¥ä½œç›®å½•</span><br><span class="line">[root@docker01 ~]# docker inspect nginx:alpine</span><br><span class="line"></span><br><span class="line">5ã€è¿æ¥åˆ°å®¹å™¨é‡Œé¢ï¼ŒæŸ¥çœ‹ç«™ç‚¹ç›®å½•</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">exec</span> -it 74ce711a7128 /bin/sh</span><br><span class="line">/ <span class="comment"># vi /etc/nginx/conf.d/default.conf </span></span><br><span class="line"> root   /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">6ã€å°†ä»£ç ä¸Šä¼ </span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> h5_games.zip 74ce711a7128:/usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">7ã€è¿™æ¬¡è¿æ¥åˆ°å®¹å™¨é‡Œé¢</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">exec</span> -it 74ce711a7128 /bin/sh</span><br><span class="line">/ <span class="comment"># </span></span><br><span class="line">/ <span class="comment"># cd /usr/share/nginx/html/</span></span><br><span class="line">/usr/share/nginx/html <span class="comment"># unzip h5_games.zip </span></span><br><span class="line"></span><br><span class="line">/usr/share/nginx/html <span class="comment"># ls</span></span><br><span class="line">50x.html      __MACOSX      h5_games      h5_games.zip  index.html</span><br><span class="line"></span><br><span class="line">8ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.101/h5_games</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240903120700780.png" alt="image-20240903120700780"></p><p>ä»¥ä¸Šæ“ä½œéƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”å¦‚æœè¿™ä¸ªå®¹å™¨åäº†ï¼Œèµ·ä¸æ¥äº†ï¼Œéœ€è¦é‡å¤æ‰§è¡Œä»€ä¹ˆçš„æ“ä½œï¼Œ</p><p>æ–¹æ³•ä¸€ï¼šæŠŠæ­£åœ¨è¿è¡Œçš„å®¹å™¨æ‰“æˆä¸€ä¸ªé•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ–°å¼€ä¸€ä¸ªçª—å£æ“ä½œ</span><br><span class="line">[root@docker01 ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">76a4b880872b   nginx:alpine   <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   22 minutes ago   Up 22 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   funny_sinoussi</span><br><span class="line"></span><br><span class="line">2ã€#æŠŠæ­£åœ¨è¿è¡Œçš„å®¹å™¨æ‰“æˆä¸€ä¸ªé•œåƒ</span><br><span class="line">[root@docker01 ~]# docker commit 76a4b880872b h5:v1</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">h5           v1        6fcc45b1c065   51 seconds ago   89.9MB</span><br><span class="line"></span><br><span class="line">3ã€æŠŠæ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ é™¤</span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">rm</span> -f $(docker ps -qa)</span><br><span class="line">76a4b880872b</span><br><span class="line"></span><br><span class="line">4ã€ç°åœ¨æ²¡æœ‰ä»»ä½•å®¹å™¨è¿è¡Œï¼Œå°†æ‰“çš„é•œåƒå¯¼å…¥</span><br><span class="line">å¯¼å…¥åœ¨æœ¬åœ°è¿è¡Œï¼šdocker run -p80:80 -d h5:v1</span><br><span class="line">å¯¼å‡ºåˆ°å…¶ä»–æœºå™¨è¿è¡Œï¼š</span><br><span class="line">docker save h5:v1 -o /tmp/h5.tgz</span><br><span class="line">scp /tmp/h5.tgz 10.0.0.102:/tmp</span><br><span class="line">docker load &lt; /tmp/h5.tgz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€è¿è¡Œå¯¼å…¥çš„å®¹å™¨</span><br><span class="line">[root@docker02 ~]# docker run -p80:80 -d h5:v1</span><br><span class="line"></span><br><span class="line">6ã€æµè§ˆå™¨è®¿é—®</span><br><span class="line">10.0.0.102/h5_games</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼šå¯ä»¥ä½¿ç”¨æ–‡ä»¶æ˜ å°„</p><h3 id="5ã€Dockerå®¹å™¨æ–‡ä»¶æ˜ å°„">5ã€<strong>Dockerå®¹å™¨æ–‡ä»¶æ˜ å°„</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-v ï¼šæ•°æ®å·æ˜ å°„ </span><br><span class="line">-v ï¼šå®¿ä¸»æœºç»å¯¹è·¯å¾„:å®¹å™¨ç»å¯¹è·¯å¾„  (å¸¸ç”¨)</span><br><span class="line">-v ï¼šå®¹å™¨ç›®å½•     <span class="comment">#åˆ›å»ºä¸€ä¸ªéšæœºå·,æ¥æŒä¹…åŒ–å®¹å™¨çš„ç›®å½•ä¸‹çš„æ•°æ®ï¼Œé€‚åˆä¿å­˜å˜åŒ–çš„æ•°æ®</span></span><br><span class="line">-v ï¼šå·å:å®¹å™¨ç›®å½• <span class="comment">#åˆ›å»ºä¸€ä¸ªå›ºå®šåå­—çš„å·,æ¥æŒä¹…åŒ–å®¹å™¨çš„ç›®å½•ä¸‹çš„æ•°æ®ï¼Œé€‚åˆæ•°æ®å…±äº«</span></span><br><span class="line"></span><br><span class="line">1ã€#åˆ¶ä½œä¸€ä¸ªæ•°æ®å·æ˜ å°„</span><br><span class="line">[root@docker02 ~]# docker run --name h5 -p 80:80 -v  /code/h5_games:/usr/share/nginx/html -d nginx:alpine</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€codeç›®å½•ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œåªéœ€è¦å°†ä»£ç è§£å‹åˆ°codeç›®å½•</span><br><span class="line">[root@docker02 ~]# unzip h5_games.zip -d /code/</span><br><span class="line">[root@docker02 ~]# <span class="built_in">ls</span> /code/h5_games/</span><br><span class="line">ceshi  game  img  index.html  readme.txt</span><br><span class="line"></span><br><span class="line">3ã€è¿æ¥è¿›å»,å¹¶æŸ¥çœ‹ç«™ç‚¹ç›®å½•æ˜¯å¦å­˜åœ¨ä»£ç </span><br><span class="line">[root@docker02 ~]# docker <span class="built_in">exec</span> -it h5 /bin/sh</span><br><span class="line">/ <span class="comment"># ls /usr/share/nginx/html</span></span><br><span class="line">ceshi       game        img         index.html  readme.txt</span><br><span class="line"></span><br><span class="line">4ã€è®¿é—®ç½‘é¡µ</span><br><span class="line">10.0.0.102   å‡ºç°å°æ¸¸æˆçš„é¡µé¢å°±æ˜ å°„å®Œæˆ</span><br></pre></td></tr></table></figure><h3 id="6ã€æ‰‹åŠ¨åˆ¶ä½œh5å°æ¸¸æˆçš„é•œåƒ">6ã€<strong>æ‰‹åŠ¨åˆ¶ä½œh5å°æ¸¸æˆçš„é•œåƒ</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">1ã€è¿è¡Œä¸€ä¸ªåŸºç¡€é•œåƒå¹¶è¿è¿›å»</span><br><span class="line">[root@docker01 ~]# docker run -it centos:7 /bin/bash</span><br><span class="line"></span><br><span class="line">2ã€å› ä¸ºä½¿ç”¨centosé•œåƒï¼Œé‡Œé¢æ²¡æœ‰nginx,éœ€è¦å®‰è£…nginx</span><br><span class="line">[root@afc3071510f6 /]#  yum -y install nginx</span><br><span class="line">å‘ç°æ²¡æœ‰æº</span><br><span class="line"></span><br><span class="line">3ã€æ¢æº</span><br><span class="line">[root@afc3071510f6 /]#  curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.huaweicloud.com/repository/conf/CentOS-7-anon.repo</span><br><span class="line">[root@afc3071510f6 /]#  curl -o /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"></span><br><span class="line">4ã€ä¼˜åŒ–æº</span><br><span class="line">[root@afc3071510f6 /]# vi /etc/yum.repos.d/CentOS-Base.repo  </span><br><span class="line">[updates]</span><br><span class="line">....</span><br><span class="line">enabled=0</span><br><span class="line"></span><br><span class="line">5ã€ä¸‹è½½nginx</span><br><span class="line">[root@afc3071510f6 /]# yum -y install nginx</span><br><span class="line"></span><br><span class="line">6ã€æ¸…ç©ºç«™ç‚¹ç›®å½•</span><br><span class="line">[root@afc3071510f6 /]# <span class="built_in">rm</span> -rf /usr/share/nginx/html/*</span><br><span class="line"></span><br><span class="line">7ã€æ–°å¼€ä¸€ä¸ªçª—å£ï¼Œå°†è§£å‹ä»£ç ä¸Šä¼ åˆ°å®¹å™¨çš„ç«™ç‚¹ç›®å½•</span><br><span class="line">root@docker01 ~]# unzip h5_games.zip </span><br><span class="line">[root@docker01 ~]# docker <span class="built_in">cp</span> h5_games afc3071510f6:/usr/share/nginx/html</span><br><span class="line"></span><br><span class="line">8ã€å®¹å™¨æŸ¥çœ‹ä»£ç ä¸Šä¼ æˆåŠŸï¼Œå¹¶æŠŠä»£ç ç§»åŠ¨åˆ°ç«™ç‚¹ç›®å½•</span><br><span class="line">[root@afc3071510f6 /]# <span class="built_in">mv</span> /usr/share/nginx/html/h5_games/* /usr/share/nginx/html/</span><br><span class="line">[root@afc3071510f6 /]# <span class="built_in">ls</span> /usr/share/nginx/html/</span><br><span class="line">ceshi  game  h5_games  img  index.html  readme.txt</span><br><span class="line"></span><br><span class="line">9ã€å¯åŠ¨nginx  curlä¸€ä¸‹æ˜¯å¦æˆåŠŸ</span><br><span class="line">[root@afc3071510f6 /]# nginx</span><br><span class="line">[root@afc3071510f6 /]# curl 127.0.0.1</span><br><span class="line"></span><br><span class="line">10ã€å¦‚æœç°åœ¨é€€å‡ºè¿›è¡Œï¼Œè¿™ä¸ªå®¹å™¨å°±ä¼šé€€å‡ºï¼Œnginxå°±ä¼šç»“æŸï¼Œè¿™ä¸ªé•œåƒç›¸å½“äºæ²¡èµ·nginx,æ²¡æœ‰åŠæ³•è®©è¿™ä¸ªå®¹å™¨èµ·æ¥</span><br><span class="line">[root@docker01 ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE      COMMAND       CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">afc3071510f6   centos:7   <span class="string">&quot;/bin/bash&quot;</span>   24 minutes ago   Exited (0) 8 seconds ago             friendly_wozniak</span><br><span class="line"></span><br><span class="line">11ã€æ‰“é•œåƒ</span><br><span class="line">[root@docker01 ~]# docker commit afc3071510f6 h5_game:v2</span><br><span class="line"></span><br><span class="line">12ã€è¿è¡Œè¿™ä¸ªé•œåƒ</span><br><span class="line">[root@docker01 ~]# docker run --name h5 -p 80:80 -d h5_game:v2 /sbin/nginx -g <span class="string">&#x27;daemon off;&#x27;</span></span><br><span class="line"></span><br><span class="line">/sbin/nginxï¼šnginxå¯åŠ¨</span><br><span class="line">daemon off;ï¼šå¡ä¸»</span><br><span class="line"></span><br><span class="line">13ã€æµè§ˆå™¨è®¿é—®ç½‘é¡µ</span><br><span class="line"></span><br><span class="line">ç¼ºç‚¹ï¼š</span><br><span class="line">1.ä½“ç§¯å¤ªå¤§</span><br><span class="line">2.å¯åŠ¨ä¸æ–¹ä¾¿</span><br><span class="line">3.æ— æ³•ç›´æ¥ä¿®æ”¹CMD</span><br><span class="line">4.æ²¡æœ‰å£°æ˜ç«¯å£</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240903185831846.png" alt="image-20240903185831846"></p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¡ä¸€ã€Dockerå®¹å™¨çš„ä»‹ç»å’Œéƒ¨ç½²</title>
      <link href="/posts/a56cb35d.html"/>
      <url>/posts/a56cb35d.html</url>
      
        <content type="html"><![CDATA[<h2 id="dockerå®¹å™¨">dockerå®¹å™¨</h2><p>Dockerä¾¿ç”¨G00g1eå…¬å¸æ¨å‡ºWG0è¯­è¨€è¿›è¡Œå¼€å‹å®ç°ï¼ŒåŸºäºæ“ä½œæ¡ç»Ÿå†…å­©ä¸­æ—¶Cgroup(è´·æºæ§åˆ¶)NameSpace(èµ„æºéš”ç¦»)ä¸0verlayFS(æ•°æ®å­˜å‚¨)ç­‰æŠ€æœ¯ï¼Œå®ç°åŸºäºæ“ä½œç³»ç»Ÿå±‚é¢çš„(åº”ç”¨)è™šæ‹ŸåŒ–æŠ€æœ¯,<br>æœ€åˆå®ç°æ˜¯åŸºäºLXCæŠ€æœ¯ï¼Œä»0.7ç‰ˆæœ¬ä»¥åå¼€å§‹å»é™¤LXCï¼Œè½¬è€Œä½¿ç”¨è‡ªè¡Œå¼€å‘çš„libcontainer(å®¹å™¨ç®¡ç†æŠ€æœ¯)ã€‚</p><p>å®¹å™¨æŠ€æœ¯å‘å±•æ¶æ„å›¾ï¼š</p><p><img src="../image/study_img/image-20240902083945201.png" alt="image-20240902083945201"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ä¸ºä»€ä¹ˆæœ‰äº‘å¹³å°ï¼šå› ä¸ºæ–¹ä¾¿å¿«æ·ï¼Œè¿˜ä¾¿å®œ</span><br><span class="line">è´­ä¹°ç‰©ç†æœºï¼Œä¸ä»…è¿˜è¦ä¹°æœåŠ¡å™¨ï¼Œè¿˜è¦ç§Ÿæœºæˆ¿</span><br><span class="line"></span><br><span class="line">VMware Workstation:è™šæ‹ŸåŒ–å·¥å…·ï¼Œå¯åŠ¨è™šæ‹Ÿæœºçš„ï¼Œä½¿ç”¨çš„ç¼–æ’å·¥å…·æ˜¯çš„ï¼šVcenter server</span><br><span class="line">KVMï¼šè™šæ‹ŸåŒ–å·¥å…·ï¼Œå¯åŠ¨è™šæ‹Ÿæœºçš„    ä½¿ç”¨çš„ç¼–æ’å·¥å…·æ˜¯çš„ï¼šOpenStack</span><br><span class="line">Dockerï¼šå®¹å™¨åŒ–å·¥å…·ï¼Œå®¹å™¨è¿è¡Œæ—¶   ä½¿ç”¨çš„ç¼–æ’å·¥å…·æ˜¯çš„ï¼š(dockerè‡ªå·±å†™çš„ç¼–æ’å·¥å…·)Docker-swarmã€mesosã€kubernetes(æœ€çµæ´»çš„,å¸¸ç”¨çš„)</span><br><span class="line">K8s,è°·æ­Œçš„äº§å“</span><br><span class="line"></span><br><span class="line">ç¼–æ’å·¥å…·çš„ä½œç”¨ï¼šä½¿éƒ¨ç½²è™šæ‹ŸåŒ–çš„äº§å“å˜æˆä¸€ä¸ªé›†ç¾¤</span><br><span class="line"></span><br><span class="line">ä¸‹è½½ä¸€ä¸ªå·¥å…· tightVNC ,å°±å¯ä»¥è¿æ¥è™šæ‹Ÿæœºé‡Œé¢åˆ›å»ºçš„è™šæ‹Ÿæœºäº†</span><br></pre></td></tr></table></figure><p>å®¹å™¨ä¸è™šæ‹Ÿæœºå¯¹æ¯”<br>ä¼ ç»Ÿè™šæ‹ŸåŒ–å’Œdockeråˆ†å±‚å¯¹æ¯”</p><p><img src="../image/study_img/image-20240902092008550.png" alt="image-20240902092008550"></p><p>å®¹å™¨åŒ–äº§å“æ¦‚å¿µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å†…æ ¸çš„æŠ€æœ¯  (ç³»ç»Ÿæ˜¯åœ¨å†…æ ¸çš„åŸºç¡€ä¸Šå°è£…å‡ºæ¥çš„)</span></span><br><span class="line">Namespaceï¼šåç§°ç©ºé—´ï¼Œå‘½åç©ºé—´(ä½œç”¨æ˜¯ï¼šèµ„æºéš”ç¦»)èµ·ä¸€ä¸ªå®¹å™¨å°±æ˜¯èµ·ä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åå†åšèµ„æºéš”ç¦»</span><br><span class="line">Cgroupï¼šèµ„æºæ§åˆ¶ã€èµ„æºè®¡ç®—</span><br><span class="line"></span><br><span class="line">dockeræ˜¯è°ƒç”¨å†…æ ¸æ¥å£çš„å·¥å…·</span><br></pre></td></tr></table></figure><p>VMè™šæ‹ŸåŒ–å’ŒDockerç‰¹æ€§å¯¹æ¯”</p><table><thead><tr><th>ç‰¹æ€§</th><th>Docker</th><th>VM</th></tr></thead><tbody><tr><td>å¯åŠ¨é€Ÿåº¦</td><td>ç§’çº§</td><td>åˆ†é’Ÿçº§</td></tr><tr><td>ç¡¬ç›˜ä½¿ç”¨</td><td>ä¸€èˆ¬ä¸ºMB</td><td>ä¸€èˆ¬ä¸ºGB</td></tr><tr><td>æ€§èƒ½</td><td>æ¥è¿‘åŸç”Ÿå•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨</td><td>å¼±äºåŸç”Ÿ</td></tr><tr><td>ç³»ç»Ÿæ”¯æŒé‡</td><td>å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨</td><td>ä¸€èˆ¬å‡ åä¸ª</td></tr><tr><td>éš”ç¦»æ€§</td><td>å®‰å…¨éš”ç¦»</td><td>å®Œå…¨éš”ç¦»</td></tr></tbody></table><p>å®¹å™¨åŒ–äº§å“çš„æ¦‚å¿µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Container Runtimeï¼šå®¹å™¨è¿è¡Œæ—¶</span></span><br><span class="line">- docker</span><br><span class="line">- CRI-O</span><br><span class="line">- containerd</span><br><span class="line"></span><br><span class="line"><span class="comment">## å†…æ ¸æŠ€æœ¯</span></span><br><span class="line">Namespaceï¼šåç§°ç©ºé—´ï¼Œå‘½åç©ºé—´ï¼ˆèµ„æºéš”ç¦»ï¼‰https://man7.org/linux/man-pages/man7/namespaces.7.html</span><br><span class="line"></span><br><span class="line">Cgroupï¼šèµ„æºæ§åˆ¶ã€èµ„æºè®¡ç®— https://man7.org/linux/man-pages/man7/cgroups.7.html</span><br><span class="line"></span><br><span class="line">èµ„æºé™åˆ¶ï¼šä¾‹å¦‚è®¾å®šä»»åŠ¡æŒ‡å®šå†…å­˜</span><br><span class="line">ä¼˜å…ˆçº§åˆ†é…ï¼šæ¯”å¦‚è·Ÿä»»åŠ¡åˆ†é…çš„CPUæ—¶é—´ï¼Œç‰‡æ•°ï¼Œç£ç›˜IOï¼Œå¸¦å®½å¤§å°æ¥æ§åˆ¶ä»»åŠ¡çš„ä¼˜å…ˆçº§</span><br><span class="line">èµ„æºç»Ÿè®¡ï¼šç»Ÿè®¡CPUï¼Œå†…å­˜ï¼ŒIOç­‰èµ„æºä½¿ç”¨æ—¶é•¿ï¼Œè¯¥åŠŸèƒ½æ¯”è¾ƒé€‚åˆç”¨äºè®¡è´¹</span><br><span class="line">ä»»åŠ¡æ§åˆ¶ï¼šcgroupå¯ä»¥å¯¹ä»»åŠ¡è¿›è¡Œ è¿è¡Œï¼ŒæŒ‚èµ·ï¼Œæ¢å¤ç­‰æ“ä½œ</span><br></pre></td></tr></table></figure><h3 id="1ã€Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ">1ã€<strong>Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#images(é•œåƒ)</span></span><br><span class="line">Dockeré•œåƒå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€è¦çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®æ–‡ä»¶ä»¥å¤–ï¼Œè¿˜åŒ…åˆäº†ä¸€äº›ä¸ºè¿è¡Œæ—¶ï¼Œå‡†å¤‡çš„é…ç½®å‚æ•°(åŒ¿åå·ï¼Œç¯å¢ƒå˜é‡ï¼Œç”¨æˆ·...),é•œåƒæ˜¯ä¸å¯æ›´æ”¹çš„</span><br><span class="line">Dockerå®¹å™¨çš„å‚¨å­˜æ–¹å¼ï¼šé€šè¿‡overlayFSæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå‚¨å­˜</span><br><span class="line">upper</span><br><span class="line">lower</span><br><span class="line">merge</span><br><span class="line"></span><br><span class="line">ä¸ºäº†ç¯å¢ƒçš„ç»Ÿä¸€ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†</span><br><span class="line"></span><br><span class="line"><span class="comment">#Container(å®¹å™¨)</span></span><br><span class="line">å®¹å™¨çš„å®šä¹‰å’Œé•œåƒï¼Œå‡ ä¹æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼Œå”¯ä¸€åŒºåˆ«åœ¨äºå®¹å™¨çš„æœ€ä¸Šé¢é‚£ä¸€å±‚æ˜¯å¯è¯»å¯å†™çš„ã€‚</span><br><span class="line">(ç±»ä¼¼äºç”¨Docker1èµ·çš„ä¸€å°è™šæ‹Ÿæœº)</span><br><span class="line">ç†è§£ï¼šä¸€ä¸ªå®¹å™¨å°±æ˜¯ä¸€å°è™šæ‹Ÿæœº</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Repository(ä»“åº“)</span></span><br><span class="line">ä¸Šä¼ é•œåƒï¼Œå­˜æ”¾é•œåƒ</span><br><span class="line"></span><br><span class="line">ä»“åº“æ˜¯Dockerç”¨æ¥å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰å¸¸ç”¨çš„ä»£ç ä»“åº“ã€‚</span><br><span class="line">é€šå¸¸ä¸€ä¸ªä»“åº“ä¼šåŒ…å«ï¼ŒåŒä¸€ä¸ªè½¯ä»¶ï¼Œä¸åŒç‰ˆæœ¬çš„é•œåƒ</span><br><span class="line">æˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;ä»“åº“å&gt;:&lt;æ ‡ç­¾&gt;æ ¼å¼æ¥æŒ‡å®šå…·ä½“ä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„é•œåƒï¼Œå¦‚æœä¸ç»™æ ‡ç­¾ï¼Œé‚£ä¹ˆé»˜è®¤ä»¥Latestä½œä¸ºé»˜è®¤æ ‡ç­¾</span><br><span class="line"></span><br><span class="line"><span class="comment">#dockerçš„ä»“åº“æœ‰2ç§</span></span><br><span class="line">1ã€Harbor   å›¾å½¢åŒ–ä»“åº“</span><br><span class="line">2ã€Registry å‘½ä»¤è¡Œä»“åº“</span><br></pre></td></tr></table></figure><h3 id="2ã€Dockerçš„ç»„æˆ">2ã€<strong>Dockerçš„ç»„æˆ</strong></h3><p>Dockeræ˜¯C/Sç»“æ„çš„æœåŠ¡    <code>docker client</code> å’Œ <code>docker server</code></p><p>Dockerå®¢æˆ·ç«¯æ˜¯Dockerç”¨æˆ·ä¸Dockeräº¤äº’çš„ä¸»è¦æ–¹å¼<br>å½“ä½¿ç”¨Dockerå‘½ä»¤è¡Œè¿è¡Œå‘½ä»¤æ—¶ï¼ŒDockerå®¢æˆ·ç«¯å°†è¿™äº›å‘½ä»¤å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ‰§è¡Œè¿™äº›å‘½ä»¤Dockerå‘½ä»¤ä½¿ç”¨DockerAPI<br>Dockerå®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªæœåŠ¡ç«¯è¿›è¡Œé€šè®¯</p><p><img src="../image/study_img/image-20240902110827668.png" alt="image-20240902110827668"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Dockerçš„å®¢æˆ·ç«¯ï¼š</span><br><span class="line">- å‘½ä»¤è¡Œ docker</span><br><span class="line">- å›¾å½¢åŒ– dashboard(UIç•Œé¢)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç”¨æˆ·â€”â€”â€”&gt;ä½¿ç”¨dockerå®¢æˆ·ç«¯â€”â€”â€”&gt;è°ƒç”¨DOckerçš„æ¥å£â€”â€”â€”&gt;è¿æ¥åˆ°DOcker serverâ€”â€”&gt;è°ƒç”¨å†…æ ¸Namespaceã€cgroup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¨³å®šçš„ç‰ˆæœ¬</span></span><br><span class="line">docker 19.3</span><br><span class="line">k8 1.19</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆ</span><br><span class="line">ä¸‹äº†ä¸€ä¸ªnginxå®¹å™¨ï¼Œæƒ³è®©ä»–å˜æˆwebæœåŠ¡å™¨</span><br></pre></td></tr></table></figure><h3 id="3ã€éƒ¨ç½²DOcker">3ã€<strong>éƒ¨ç½²DOcker</strong></h3><p>1ã€å®‰è£…docker-ce</p><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>docker01</td><td>10.0.0.101  /  172.16.1.101</td><td></td></tr><tr><td>docker02</td><td>10.0.0.102  /  172.16.1.102</td><td></td></tr><tr><td>docker03</td><td>10.0.0.103  /  172.16.1.103</td><td></td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1ã€å¸è½½ä¹‹å‰å®‰è£…çš„DOcker</span><br><span class="line">yum remove docker \</span><br><span class="line">docker-client \</span><br><span class="line">docker-client-latest \</span><br><span class="line">docker-common \</span><br><span class="line">docker-latest \</span><br><span class="line">docker-latest-logrotate \</span><br><span class="line">docker-logrotate \</span><br><span class="line">docker-engine</span><br><span class="line"></span><br><span class="line">2ã€æ¢æº</span><br><span class="line">[root@docker01 ~]# vim /etc/yum.repos.d/docker-ce.repo </span><br><span class="line">[docker-ce-stable]</span><br><span class="line">name=Docker CE Stable - <span class="variable">$basearch</span></span><br><span class="line">baseurl=https://download.docker.com/linux/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/stable</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://download.docker.com/linux/centos/gpg</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# sed -i <span class="string">&#x27;s+download.docker.com+mirrors.huaweicloud.com/docker-ce+&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">3ã€ä¸‹è½½docker</span><br><span class="line">[root@docker01 ~]# yum install -y docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸‹è½½çš„æ…¢ï¼ŒæŠŠbaseæºé‡Œé¢çš„updatå…³é—­</p><p>[root@docker03 ~]# vim /etc/yum.repos.d/CentOS-Base.repo</p><p><img src="../image/study_img/image-20240902114920501.png" alt="image-20240902114920501"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">4ã€å¯åŠ¨</span><br><span class="line">[root@docker01 ~]# systemctl start docker</span><br><span class="line">[root@docker01 ~]# systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹dockerä¿¡æ¯</span><br><span class="line">[root@docker01 ~]# docker info</span><br><span class="line"></span><br><span class="line">Docker Root Dir: /var/lib/docker  <span class="comment">#Dockerçš„å‚¨å­˜ç›®å½•(å·¥ä½œç›®å½•)</span></span><br><span class="line"></span><br><span class="line">6ã€å¯åŠ¨dockerå°±ä¼šç”Ÿæˆä¸€ä¸ªsocketæ–‡ä»¶</span><br><span class="line">[root@docker01 ~]# ll /var/run/docker.sock </span><br><span class="line">srw-rw---- 1 root docker 0 Sep  2 12:17 /var/run/docker.sock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7ã€åŠ é€Ÿé•œåƒ</span><br><span class="line">[root@docker01 ~]# <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">[root@docker01 ~]# <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;dns&quot;</span>: [<span class="string">&quot;8.8.8.8&quot;</span>, <span class="string">&quot;8.8.4.4&quot;</span>],</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://dockerproxy.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.nju.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://registry.docker-cn.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;https://mirror.baidubce.com&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¤‡ç”¨åŠ é€Ÿï¼š</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>:[<span class="string">&quot;https://docker.1panel.live&quot;</span>, <span class="string">&quot;https://hub.rat.dev/&quot;</span>, <span class="string">&quot;https://docker.chenby.cn&quot;</span>, <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# systemctl daemon-reload</span><br><span class="line">[root@docker01 ~]# systemctl restart docker</span><br><span class="line"></span><br><span class="line">8ã€æµ‹è¯•æ‹‰å–nginxé•œåƒ</span><br><span class="line">[root@docker02 ~]# docker pull nginx</span><br><span class="line">ç­‰å¾…2åˆ†é’Ÿæ‰æ‹‰å–çš„ä¸‹æ¥</span><br><span class="line"></span><br><span class="line">[root@docker01 ~]# docker pull nginx:alpine     (æœ€å°çš„æ“ä½œç³»ç»Ÿalpine)</span><br><span class="line">[root@docker01 ~]# docker pull nginx:latest</span><br><span class="line">[root@docker01 ~]# docker pull busybox</span><br><span class="line"></span><br><span class="line">9ã€æŸ¥çœ‹æ‹‰å–çš„é•œåƒ</span><br><span class="line">[root@docker01 ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx        alpine    0f0eda053dc5   2 weeks ago     43.3MB</span><br><span class="line">nginx        latest    5ef79149e0ec   2 weeks ago     188MB</span><br><span class="line">busybox      latest    87ff76f62d36   15 months ago   4.26MB</span><br><span class="line">centos       7         eeb6ee3f44bd   2 years ago     204MB</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•12ã€MHAé«˜å¯ç”¨</title>
      <link href="/posts/74c516b4.html"/>
      <url>/posts/74c516b4.html</url>
      
        <content type="html"><![CDATA[<h2 id="MHAé«˜å¯ç”¨">MHAé«˜å¯ç”¨</h2><h3 id="1ã€MHAè½¯ä»¶ä»‹ç»"><strong>1ã€MHAè½¯ä»¶ä»‹ç»</strong></h3><p><font color=red>åŸç†ï¼šå½“Masterå‡ºç°æ•…éšœæ—¶ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å°†æœ€æ–°æ•°æ®çš„Slaveæå‡ä¸ºæ–°çš„Master,ç„¶åå°†æ‰€æœ‰å…¶ä»–çš„Slaveé‡æ–°æŒ‡å‘æ–°çš„Masterã€‚</font></p><p>MHAèƒ½å¤Ÿåœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å®ç°è‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œæ•…éšœè½¬ç§»ï¼Œé€šå¸¸åœ¨10-30ç§’ä»¥å†…;åœ¨å¤åˆ¶æ¡†æ¶ä¸­ï¼ŒMHAèƒ½å¤Ÿå¾ˆå¥½åœ°è§£å†³å¤åˆ¶è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œç”±äºä¸éœ€è¦åœ¨ç°æœ‰çš„replicationä¸­æ·»åŠ é¢å¤–çš„æœåŠ¡å™¨ï¼Œä»…éœ€è¦ä¸€ä¸ªmanagerèŠ‚ç‚¹ï¼Œè€Œä¸€ä¸ªManagerèƒ½ç®¡ç†å¤šå¥—å¤åˆ¶ï¼Œæ‰€ä»¥èƒ½å¤§å¤§åœ°èŠ‚çº¦æœåŠ¡å™¨çš„æ•°é‡;å¦å¤–ï¼Œå®‰è£…ç®€å•ï¼Œæ— æ€§èƒ½æŸè€—ï¼Œä»¥åŠä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„å¤åˆ¶éƒ¨ç½²ä¹Ÿæ˜¯å®ƒçš„ä¼˜åŠ¿ä¹‹å¤„ã€‚</p><p><img src="../image/study_img/image-20240827090218613.png" alt="image-20240827090218613"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ä»åº“ä¸æ›´æ–°binlog,åªæ›´æ–°relay-log,è¿™ä¸ªå¯ä»¥è§£å†³çš„ï¼Œå¯ä»¥é…ç½®è®©ä»–æ›´æ–°binlog,åŠ å‚æ•°</span><br><span class="line"></span><br><span class="line">Rvså°±æ˜¯é˜¿é‡Œäº‘ä¸Šçš„æ•°æ®åº“ï¼Œecsæ˜¯äº‘ä¸»æœº</span><br><span class="line"></span><br><span class="line">Heartbeat+DRBD  ä¹Ÿæ˜¯åšé«˜å¯ç”¨çš„ å¿ƒè·³æ£€æµ‹</span><br><span class="line"></span><br><span class="line">MHAçš„manageræœ€å¥½ä¸è¦å®‰è£…åœ¨ä¸»åº“ä¸Šï¼Œå°±æ€•æ–­ç”µäº†ï¼Œmhaä¸èƒ½å·¥ä½œï¼Œå®‰è£…åœ¨3å°ä»åº“ä¸Šå¯ä»¥ï¼Œæˆ–è€…é‡æ–°æ‰¾ä¸€å°æ–°æœºå™¨å®‰è£…MHA(MHAå°±æ˜¯ä¸€ä¸ªç›‘æ§è½¯ä»¶ã€‚ç›‘æ§ä¸»åº“å¿ƒè·³çš„)</span><br></pre></td></tr></table></figure><p><strong>å·¥ä½œæµç¨‹</strong></p><p>1)æŠŠå®•æœºçš„masteräºŒè¿›åˆ¶æ—¥å¿—ä¿å­˜ä¸‹æ¥ã€‚<br>2)æ‰¾åˆ°binlogä½ç½®ç‚¹æœ€æ–°çš„slaveã€‚<br>3)åœ¨binlogä½ç½®ç‚¹æœ€æ–°çš„slaveä¸Šç”¨relay logï¼ˆå·®å¼‚æ—¥å¿—ï¼‰ä¿®å¤å…¶å®ƒslaveã€‚<br>4)å°†å®•æœºçš„masterä¸Šä¿å­˜ä¸‹æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—æ¢å¤åˆ°å«æœ‰æœ€æ–°ä½ç½®ç‚¹çš„slaveä¸Šã€‚<br>5)å°†å«æœ‰æœ€æ–°ä½ç½®ç‚¹binlogæ‰€åœ¨çš„slaveæå‡ä¸ºmasterã€‚<br>6)å°†å…¶å®ƒslaveé‡æ–°æŒ‡å‘æ–°æå‡çš„masterï¼Œå¹¶å¼€å¯ä¸»ä»å¤åˆ¶ã€‚</p><p><img src="../image/study_img/image-20240827093920829.png" alt="image-20240827093920829"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">keepalivedæœ‰å±€é™æ€§ï¼Œä»–æ€ä¹ˆçŸ¥é“å“ªå°æœºå™¨çš„æ•°æ®æœ€æ–°ï¼Ÿ</span><br><span class="line"></span><br><span class="line">MHAåšå®Œåˆ‡æ¢ï¼Œè¿ç»´æ— æ„ŸçŸ¥ï¼Œéœ€è¦æœ‰ä¸€ä¸ªé€šçŸ¥ï¼ŒMHAè‡ªå¸¦ä¸€ä¸ªé€šçŸ¥å·¥å…·</span><br><span class="line"></span><br><span class="line">é—®é¢˜ï¼š</span><br><span class="line">1ã€binlogçš„ä¿å­˜ä½ç½®åœ¨å“ª       (è°è¢«æå‡ä¸ºä¸»åº“å°±å‘ç¼ºå¤±æ•°æ®é€ç»™è°)</span><br><span class="line">2ã€downæœºçš„ä¸»åº“ä¿®å¤å¥½ä¹‹åï¼Œå¦‚ä½•åŠ å…¥é›†ç¾¤ï¼Ÿ</span><br><span class="line">3ã€downæœºçš„ä¸»åº“ä¿®å¤å¥½ä¹‹åï¼ŒåŠ å…¥é›†ç¾¤çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ</span><br></pre></td></tr></table></figure><h3 id="2ã€MHAæ¶æ„å›¾"><strong>2ã€MHAæ¶æ„å›¾</strong></h3><p><img src="../image/study_img/image-20240827101716633.png" alt="image-20240827101716633"></p><p><strong>MHAçš„å·¥å…·</strong></p><p>MHA nodeçš„å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@dbe1 bin]# 11</span><br><span class="line">-rwxrwxr-x1 root root 17639 Mar 23 2018 apply_diff relay_logs      <span class="comment">#å¯¹æ¯”relay log,æ‰¾åˆ°æ–°ä¸»åº“</span></span><br><span class="line">-rwxrwxr-x 1 root root 4807 Mar 23 2018 filter mysqlbinlog         <span class="comment">#æˆªå–binlog</span></span><br><span class="line">-rwxrwxr-x 1 root root 8337 Mar 23 2018 purge_relay_logs           <span class="comment">#åˆ é™¤relay log</span></span><br><span class="line">-rwxrwxr-x 1 root root 7525 Mar 23 2018 save binary logs           <span class="comment">#ä¿å­˜binlog</span></span><br></pre></td></tr></table></figure><p>MHA manager</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  manageré‡Œé¢çš„å·¥å…·ç¨‹åºä¼šè‡ªåŠ¨è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">[root@dbe1 bin]# 11</span><br><span class="line">-rwxrwxr-x 1 root root 1995 Mar 232018 masterha_check_repl          <span class="comment">#æ£€æµ‹ä¸»ä»å¤åˆ¶</span></span><br><span class="line">-rwxrwxr-x 1 root root 1779 Mar 232018 masterha_check_ssh           <span class="comment">#æ£€æµ‹sshå…å¯†</span></span><br><span class="line">-rwxrwxr-x 1 root root 1865 Mar 232018 masterha_check_status        <span class="comment">#æ£€æµ‹mhaçš„è¿è¡ŒçŠ¶æ€(ç›¸å½“äºsystemctl status mha)</span></span><br><span class="line">-rwxrwxr-x 1 root root 3201 Mar 232018 masterha_conf_host           <span class="comment">#mhaè™šæ‹Ÿä¸»æœºé…ç½®(MHAåšå®Œåˆ‡æ¢åï¼Œä¼šå°†å®•æœºä¸»åº“ä»é…ç½®æ–‡ä»¶ä¸­æ‘˜é™¤)</span></span><br><span class="line">-rwxrwxr-x 1 root root 2517 Mar 232018 masterha_manager             <span class="comment">#MHAçš„å¯åŠ¨å‘½ä»¤(ç›¸å½“äºsystemctl start mha)</span></span><br><span class="line">-rwxrwxr-x 1 root root 2165 Mar 232018 masterha_master_monitor      <span class="comment">#æ£€æµ‹ä¸»åº“å¿ƒè·³</span></span><br><span class="line">-rwxrwxr-x 1 root root 2373 Mar 232018 masterha_master_switch       <span class="comment">#åˆ‡æ¢å·¥å…·</span></span><br><span class="line">-rwxrwxr-x 1 root root 5172 Mar 232018 masterha_secondary_check     <span class="comment">#æ£€æµ‹ICP/IPè¿æ¥</span></span><br><span class="line">-rwxrwxr-x 1 root root 1739 Mar 232018 masterha_stop                <span class="comment">#åœæ­¢MHAçš„å‘½ä»¤(ç›¸å½“äºsystemctl stop mha)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#/root/mha4mysgl-manager-0.58/samples/scripts</span></span><br><span class="line">-rwxrwxr-x 1 root root  3648 Mar 23 2018 master_ip_failover</span><br><span class="line">-rwxrwxr-x 1 root root  9870 Mar 23 2018 master_ip_online_change</span><br><span class="line">-rwxrwxr-x 1 root root 11867 Mar 23 2018 power_manager</span><br><span class="line">-rwxrwxr-x 1 root root  1360 Mar 23 2818 send_report</span><br></pre></td></tr></table></figure><p>MHAä¼˜ç‚¹æ€»ç»“</p><p>1ï¼‰Masterfailover and slave promotion can be done very quickly<br>è‡ªåŠ¨æ•…éšœè½¬ç§»å¿«</p><p>2ï¼‰Mastercrash does not result in data inconsistency<br>ä¸»åº“å´©æºƒä¸å­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜</p><p>3ï¼‰Noneed to modify current MySQL settings (MHA works with regular MySQL)<br>ä¸éœ€è¦å¯¹å½“å‰mysqlç¯å¢ƒåšé‡å¤§ä¿®æ”¹</p><p>4ï¼‰Noneed to increase lots of servers<br>ä¸éœ€è¦æ·»åŠ é¢å¤–çš„æœåŠ¡å™¨(ä»…ä¸€å°managerå°±å¯ç®¡ç†ä¸Šç™¾ä¸ªreplication)</p><p>5ï¼‰Noperformance penalty<br>æ€§èƒ½ä¼˜ç§€ï¼Œå¯å·¥ä½œåœ¨åŠåŒæ­¥å¤åˆ¶å’Œå¼‚æ­¥å¤åˆ¶ï¼Œå½“ç›‘æ§mysqlçŠ¶æ€æ—¶ï¼Œä»…éœ€è¦æ¯éš”Nç§’å‘masterå‘é€pingåŒ…(é»˜è®¤3ç§’)ï¼Œæ‰€ä»¥å¯¹æ€§èƒ½æ— å½±å“ã€‚ä½ å¯ä»¥ç†è§£ä¸ºMHAçš„æ€§èƒ½å’Œç®€å•çš„ä¸»ä»å¤åˆ¶æ¡†æ¶æ€§èƒ½ä¸€æ ·ã€‚</p><p>6ï¼‰Works with any storage engine<br>åªè¦replicationæ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼ŒMHAéƒ½æ”¯æŒï¼Œä¸ä¼šå±€é™äºinnodb</p><h3 id="3ã€éƒ¨ç½²MHA"><strong>3ã€éƒ¨ç½²MHA</strong></h3><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th><th>åº”ç”¨</th></tr></thead><tbody><tr><td>db01</td><td>10.0.0.51  /  172.16.1.51</td><td>æš‚æ—¶çš„ä¸»åº“ã€MHAå®¢æˆ·ç«¯</td><td>mysql 5.6ã€MHA node</td></tr><tr><td>db02</td><td>10.0.0.52  /  172.16.1.52</td><td>æš‚æ—¶çš„ä»åº“ã€MHAå®¢æˆ·ç«¯</td><td>mysql 5.6ã€MHA node</td></tr><tr><td>db03</td><td>10.0.0.53  /  172.16.1.53</td><td>æš‚æ—¶çš„ä»åº“ã€MHAå®¢æˆ·ç«¯</td><td>mysql 5.6ã€MHA node</td></tr><tr><td>db04</td><td>10.0.0.54 /  172.16.1.54</td><td>æš‚æ—¶çš„ä»åº“ã€MHAå®¢æˆ·ç«¯</td><td>mysql 5.6ã€MHA node</td></tr><tr><td>lb01</td><td>10.0.0.5 /  172.16.1.5</td><td>MHAçš„ç®¡ç†ç«¯</td><td>MHA managerã€mariadb</td></tr></tbody></table><p>1ã€MHAå…ˆå†³æ¡ä»¶ï¼Œéœ€è¦å…ˆéƒ¨ç½²ä¸»ä»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¼ ç»Ÿä¸»ä»å¤åˆ¶</span></span><br><span class="line">1ã€ä¸»åº“å¼€å¯binlog,ä¸»åº“ä¸å¼€</span><br><span class="line">2ã€ä¸»åº“å’Œä»åº“server_idä¸åŒï¼Œä»åº“ä¹‹é—´å¯ä»¥ç›¸åŒ</span><br><span class="line">3ã€ä¸»åº“è¦åˆ›å»ºä¸»ä»å¤åˆ¶ç”¨æˆ·ï¼Œä»åº“å¯ä»¥ä¸åˆ›å»º</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŸºäºMHAçš„ä¸»ä»å¤åˆ¶</span></span><br><span class="line">1ã€ä¸»åº“ã€ä»åº“ä¹Ÿè¦å¼€å¯binlog</span><br><span class="line">2ã€ä¸»åº“ã€ä»åº“server_idä¸åŒï¼Œä»åº“ä¹‹é—´ä¹Ÿä¸èƒ½ç›¸åŒ</span><br><span class="line">3ã€ä¸»åº“ã€ä»åº“å¿…é¡»åˆ›å»ºä¸»ä»å¤åˆ¶ç”¨æˆ·</span><br><span class="line">4ã€å…³é—­åªè¯»</span><br><span class="line"></span><br><span class="line">1ã€ä¸»åº“é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line">innodb_data_file_path=ibdata1:76M;ibdata2:50M:autoextend</span><br><span class="line">binlog_format=row</span><br><span class="line"><span class="comment">#æŒ‡å®šæ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line">slow_query_log=1</span><br><span class="line"><span class="comment">#æŒ‡å®šæ…¢æ—¥å¿—æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼ˆé»˜è®¤åœ¨dataï¼‰</span></span><br><span class="line">slow_query_log_file=/app/mysql-5.6.50/data/db01-slow.log</span><br><span class="line"><span class="comment">#è®¾å®šæ…¢æŸ¥è¯¢çš„é˜€å€¼(é»˜è®¤10s)</span></span><br><span class="line">long_query_time=0.05</span><br><span class="line"><span class="comment">#ä¸ä½¿ç”¨ç´¢å¼•çš„æ…¢æŸ¥è¯¢è¯­å¥æ˜¯å¦è®°å½•åˆ°æ—¥å¿—</span></span><br><span class="line">log_queries_not_using_indexes</span><br><span class="line"><span class="comment">#æŸ¥è¯¢æ£€æŸ¥è¿”å›å°‘äºè¯¥å‚æ•°æŒ‡å®šè¡Œçš„SQLä¸è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—  ï¼ˆé¸¡è‚‹ï¼‰</span></span><br><span class="line">min_examined_row_limit=100</span><br><span class="line">skip_name_resolve</span><br><span class="line">relay_log_purge = 0</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line">åˆ›å»ºç”¨æˆ·</span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ä»åº“é…ç½®æ–‡ä»¶</span><br><span class="line"><span class="comment">#db02</span></span><br><span class="line">[root@db02 data]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=2</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">skip-name-resolve</span><br><span class="line">relay_log_purge = 0</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line">[root@db02 data]#  /etc/init.d/mysqld restart</span><br><span class="line">åˆ›å»ºç”¨æˆ·</span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#db03</span></span><br><span class="line">[root@db03 data]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=3</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">skip-name-resolve</span><br><span class="line">relay_log_purge = 0</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line">[root@db03 data]#  /etc/init.d/mysqld restart</span><br><span class="line">åˆ›å»ºç”¨æˆ·</span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#db04</span></span><br><span class="line">[root@db04 data]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=4</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">skip-name-resolve</span><br><span class="line">relay_log_purge = 0</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db04 data]#  /etc/init.d/mysqld restart</span><br><span class="line">åˆ›å»ºç”¨æˆ·</span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#3å°ä»åº“è®¾ç½®åªè¯»ï¼Œ(åœ¨å‘½ä»¤è¡Œä¸´æ—¶è®¾ç½®)ï¼Œä¸èƒ½åœ¨é…ç½®æ–‡ä»¶è®¾ç½®ï¼Œ(mhaåˆ‡æ¢çš„æ—¶å€™ä¼šé‡å¯mysql,è®©åªè¯»é‡å¯å¤±æ•ˆï¼Œä¸´æ—¶è®¾ç½®é‡å¯ä¼šå¤±æ•ˆ)</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> global read_only=1;</span><br><span class="line"></span><br><span class="line">4ã€#4å°æ•°æ®åº“å…³é—­relay-logè‡ªåŠ¨åˆ é™¤åŠŸèƒ½(ä¸´æ—¶ç”Ÿæ•ˆ)</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> global relay_log_purge = 0;</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸´æ—¶+æ°¸ä¹…ï¼Œä¸ç”¨é‡å¯    (æ°¸ä¹…ç”Ÿæ•ˆ)</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">relay_log_purge=0</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">relay_log_purge=0</span><br><span class="line"></span><br><span class="line">[root@db03 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">relay_log_purge=0</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">relay_log_purge=0</span><br></pre></td></tr></table></figure><p>2ã€å®‰è£…nodeã€managerã€sshå…å¯†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysql5.6ç‰ˆæœ¬ä½¿ç”¨ 0.56ç‰ˆæœ¬çš„mha</span></span><br><span class="line">wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-manager-0.56-0.el6.noarch.rpm</span><br><span class="line"></span><br><span class="line">wget http://test.driverzeng.com/MySQL_plugins/mha4mysql-node-0.56-0.el6.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql5.7ç‰ˆæœ¬ä½¿ç”¨ 0.58ç‰ˆæœ¬çš„mha</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€æ¨é€nodeåŒ…åœ¨å„å°æœºå™¨</span><br><span class="line">[root@db01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 5 52 53 54;<span class="keyword">do</span> scp mha4mysql-node-0.56-0.el7.centos.noarch.rpm 172.16.1.<span class="variable">$i</span>:/root;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">2ã€5å°æœºå™¨å®‰è£…node</span><br><span class="line">[root@db03 ~]# yum -y localinstall mha4mysql-node-0.56-0.el6.noarch.rpm </span><br><span class="line"></span><br><span class="line">3ã€(lb01) mhaç®¡ç†æœºå®‰è£…manager</span><br><span class="line">[root@lb01 ~]# yum -y localinstall mha4mysql-manager-0.56-0.el6.noarch.rpm</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# rpm -qa |grep mha</span><br><span class="line">mha4mysql-manager-0.56-0.el6.noarch</span><br><span class="line">mha4mysql-node-0.56-0.el6.noarch</span><br><span class="line"></span><br><span class="line">4ã€4å°æœºå™¨åšè½¯è¿æ¥</span><br><span class="line">[root@db01 ~]# <span class="built_in">ln</span> -s /app/mysql-5.6.50/bin/mysqlbinlog  /usr/bin/mysqlbin;<span class="built_in">ln</span> -s /app/mysql-5.6.50/bin/mysql  /usr/bin/mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€5å°æœºå™¨åšå…å¯†ï¼Œè‡ªå·±ä¹Ÿè¦ç»™è‡ªå·±åšå…å¯†</span><br><span class="line"><span class="comment">#ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">ssh-keygen -t dsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_dsa &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¨é€å…¬é’¥</span></span><br><span class="line">[root@db01 ~]# ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.5</span><br><span class="line">[root@db01 ~]# ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.51</span><br><span class="line">[root@db01 ~]# ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.52</span><br><span class="line">[root@db01 ~]# ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.53</span><br><span class="line">[root@db01 ~]# ssh-copy-id -i ~/.ssh/id_dsa.pub root@172.16.1.54</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ£€æµ‹æ˜¯å¦å…å¯†æˆåŠŸ</span></span><br><span class="line">[root@db01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 5 51 52 53 54;<span class="keyword">do</span> ssh root@172.16.1.<span class="variable">$i</span> <span class="string">&quot;ifconfig|awk &#x27;NR==2&#123;print <span class="variable">$2</span>&#125;&#x27;&quot;</span>;<span class="keyword">done</span></span><br><span class="line">è¾“å‡ºä¿¡æ¯å°±å…å¯†æˆåŠŸ</span><br><span class="line">        inet 10.0.0.5  netmask 255.255.255.0  broadcast 10.0.0.255</span><br><span class="line">        inet 10.0.0.51  netmask 255.255.255.0  broadcast 10.0.0.255</span><br><span class="line">        inet 10.0.0.52  netmask 255.255.255.0  broadcast 10.0.0.255</span><br><span class="line">        inet 10.0.0.53  netmask 255.255.255.0  broadcast 10.0.0.255</span><br><span class="line">        inet 10.0.0.54  netmask 255.255.255.0  broadcast 10.0.0.255</span><br></pre></td></tr></table></figure><p>3ã€é…ç½®MHA</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">1ã€åˆ›å»ºMHAé…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br><span class="line">[root@lb01 ~]# <span class="built_in">mkdir</span> /etc/mha</span><br><span class="line"></span><br><span class="line">2ã€ç¼–å†™é…ç½®æ–‡ä»¶      <span class="comment">#app1æ˜¯é¡¹ç›®å</span></span><br><span class="line">[root@lb01 ~]# vim /etc/mha/app1.cnf    </span><br><span class="line">[server default]</span><br><span class="line">manager_log=/etc/mha/logs/manager.log</span><br><span class="line">manager_workdir=/etc/mha/app1</span><br><span class="line">master_binlog_dir=/app/mysql-5.6.50/data</span><br><span class="line">user=mha</span><br><span class="line">password=mha</span><br><span class="line"><span class="comment">#å¿ƒè·³æ£€æµ‹é—´éš”æ—¶é—´2sæ£€æµ‹ä¸€æ¬¡</span></span><br><span class="line">ping_interval=2</span><br><span class="line">repl_password=123</span><br><span class="line">repl_user=rep</span><br><span class="line">ssh_user=root</span><br><span class="line">ssh_port=22</span><br><span class="line"></span><br><span class="line">[server1]</span><br><span class="line">hostname=172.16.1.51</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server2]</span><br><span class="line"><span class="comment">#candidate_master=1</span></span><br><span class="line"><span class="comment">#check_repl_delay=0</span></span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server3]</span><br><span class="line">hostname=172.16.1.53</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">[server4]</span><br><span class="line">hostname=172.16.1.54</span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line">3ã€db01ä¸»åº“åˆ›å»ºmhaçš„ç®¡ç†ç”¨æˆ·,å…¶ä»–ä»åº“åšäº†ä¸»ä»å¤åˆ¶ï¼Œä¼šæŠŠè¿™ä¸ªç”¨æˆ·å¤åˆ¶è¿‡å»</span><br><span class="line">grant all on *.* to mha@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">4ã€åˆ›å»ºå·¥ä½œç›®å½•ã€æ—¥å¿—ç›®å½•</span><br><span class="line">[root@lb01 ~]# <span class="built_in">mkdir</span> /etc/mha/&#123;logs,app1&#125;</span><br><span class="line">[root@lb01 ~]# ll /etc/mha/</span><br><span class="line">drwxr-xr-x 2 root root   6 Aug 27 20:20 app1</span><br><span class="line">-rw-r--r-- 1 root root 449 Aug 27 20:17 app1.cnf</span><br><span class="line">drwxr-xr-x 2 root root   6 Aug 27 20:20 logs</span><br><span class="line"></span><br><span class="line">4ã€æ£€æµ‹MHAçš„SSHå…å¯†</span><br><span class="line">[root@lb01 ~]#  masterha_check_ssh --conf=/etc/mha/app1.cnf</span><br><span class="line"></span><br><span class="line">5ã€æ¯æ¬¡å¯åŠ¨å‰å…ˆæ£€æµ‹mhaçš„ä¸»ä»å¤åˆ¶</span><br><span class="line">[root@lb01 ~]#  masterha_check_repl --conf=/etc/mha/app1.cnf</span><br></pre></td></tr></table></figure><p>æ£€æµ‹å…å¯†ç»“æœæ˜¾ç¤ºæˆåŠŸ</p><p><img src="../image/study_img/image-20240827150707399.png" alt="image-20240827150707399"></p><p>æ£€æµ‹mhaçš„ä¸»ä»å¤åˆ¶OK</p><p><img src="../image/study_img/image-20240827150324053.png" alt="image-20240827150324053"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">7ã€å¯åŠ¨MHA</span><br><span class="line">[root@lb01 ~]# <span class="built_in">nohup</span> masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover &lt; /dev/null &gt; /etc/mha/logs/manager.log 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line">masterha_managerï¼š         å¯åŠ¨å‘½ä»¤</span><br><span class="line">--conf=/etc/mha/app1.cnfï¼š æŒ‡å®šé…ç½®æ–‡ä»¶</span><br><span class="line">--remove_dead_master_confï¼šåšå®Œåˆ‡æ¢åï¼Œä»é…ç½®æ–‡ä»¶ä¸­æ‘˜é™¤å®•æœºçš„ä¸»åº“</span><br><span class="line">--ignore_last_failoverï¼š   å¿½ç•¥ä¸Šä¸€æ¬¡åˆ‡æ¢(åˆ‡æ¢å®Œäº†ï¼Œä¸ç”Ÿäº§é”æ–‡ä»¶)</span><br><span class="line"></span><br><span class="line"><span class="comment">#MHAåˆ‡æ¢æœºåˆ¶ï¼š</span></span><br><span class="line">1).MHAåœ¨åšä¸€æ¬¡åˆ‡æ¢åï¼Œä¼šç”Ÿæˆä¸€ä¸ªé”æ–‡ä»¶ï¼ˆapp1.failover.completeï¼‰åœ¨å·¥ä½œç›®å½•ï¼Œ8ä¸ªå°æ—¶ä¹‹å†…ï¼Œæ— æ³•åšç¬¬äºŒæ¬¡åˆ‡æ¢    ç”Ÿæˆé”æ–‡ä»¶çš„ç›®çš„(ä¸‹ä¸€æ¬¡åˆ‡æ¢çš„æ—¶å€™ä¼šçœ‹ä¸€ä¸‹è¿™ä¸ªé”æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œé”æ–‡ä»¶å­˜åœ¨ä¸åˆ‡æ¢ï¼Œè¿™ä¸ªé”æ–‡ä»¶ä¼šå­˜åœ¨8å°æ—¶)</span><br><span class="line">2).MHAåˆ‡æ¢å®Œæˆåï¼Œä¼šè‡ªåŠ¨ç»“æŸMHAçš„è¿›ç¨‹</span><br><span class="line">[root@lb01 ~]# ll /etc/mha/app1</span><br><span class="line">-rw-r--r-- 1 root root    0 Aug 28 11:25 app1.failover.complete</span><br><span class="line"><span class="comment">#é€‰ä¸»æœºåˆ¶</span></span><br><span class="line">1).åœ¨æ‰€æœ‰ä»åº“ç›¸åŒæ—¶ï¼ŒMHAä¼šé€‰æ‹©é…ç½®æ–‡ä»¶ä¸­serveræ ‡ç­¾<span class="built_in">id</span>æœ€å°çš„ä½œä¸ºä¸»åº“</span><br><span class="line"></span><br><span class="line">8ã€å¯åŠ¨åæ£€æŸ¥</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">æ˜¾ç¤ºç»“æœå°±OKï¼š</span><br><span class="line">app1 (pid:18582) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"><span class="comment">#é¡¹ç›®(é…ç½®æ–‡ä»¶å)                         ä¸»åº“IP</span></span><br></pre></td></tr></table></figure><p>4ã€ä½¿ç”¨systemdç®¡ç†MHA</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1ã€åœæ­¢mha</span><br><span class="line">[root@lb01 ~]# masterha_stop --conf=/etc/mha/app1.cnf</span><br><span class="line"></span><br><span class="line">2ã€ä½¿ç”¨systemctlç®¡ç†</span><br><span class="line">[root@lb01 ~]# vim /usr/lib/systemd/system/mha.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=MHA</span><br><span class="line">After=network.target sshd-keygen.service</span><br><span class="line">Wants=sshd-keygen.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=sample</span><br><span class="line">ExecStart=/usr/bin/masterha_manager --conf=/etc/mha/app1.cnf --remove_dead_master_conf --ignore_last_failover &gt; /etc/mha/logs/manager.log</span><br><span class="line">ExecStop=/usr/bin/masterha_stop --conf=/etc/mha/app1.cnf</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# systemctl daemon-reload</span><br><span class="line">[root@lb01 ~]# systemctl start mha</span><br><span class="line">[root@lb01 ~]# systemctl <span class="built_in">enable</span> mha</span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨åæ£€æŸ¥</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:19243) is running(0:PING_OK), master:172.16.1.51</span><br></pre></td></tr></table></figure><h3 id="4ã€MHAæ—¥å¿—åˆ†æ"><strong>4ã€MHAæ—¥å¿—åˆ†æ</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 ~]# tailf -100 /etc/mha/logs/manager.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#GITDä¸»ä»æ²¡æœ‰å¼€å¯</span></span><br><span class="line">GTID failover mode = 0</span><br><span class="line">Starting Non-GTID based failover.</span><br><span class="line"></span><br><span class="line"><span class="comment"># VIPæ¼‚ç§»çš„è„šæœ¬æ²¡æœ‰è®¾ç½®</span></span><br><span class="line">master_ip_failover_script is not <span class="built_in">set</span>. Skipping invalidating dead master IP address.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ²¡æœ‰é…ç½® Candidate masters</span></span><br><span class="line">Candidate masters from the configuration file:</span><br><span class="line">Non-candidate masters:</span><br><span class="line"></span><br><span class="line">candidate_master=1 // è®¾ç«‹å¤ªå­ï¼Œä½†æ˜¯å¦‚æœå¤ªå­è½åå…¶ä»–æœºå™¨æ•°æ®è¶…è¿‡100Mï¼Œå°±åºŸå‚¨</span><br><span class="line">check_repl_delay=0 // å…³é—­å¯¹å¤ªå­è½åçš„æ£€æµ‹</span><br><span class="line"></span><br><span class="line"><span class="comment"># change masterè¯­å¥</span></span><br><span class="line">All other slaves should start replication from here. Statement should be:</span><br><span class="line">CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;172.16.1.54&#x27;</span>, MASTER_PORT=3306,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000003&#x27;</span>, MASTER_LOG_POS=878597, MASTER_USER=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure><p>MHAæ—¥å¿—æ–‡ä»¶é‡Œé¢çš„ç›¸å…³å·¥å…·å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">save_binary_logs</span><br><span class="line">--<span class="built_in">command</span>=save</span><br><span class="line">--start_file=mysql-bin.000001</span><br><span class="line">--start_pos=878597</span><br><span class="line">--binlog_dir=/app/mysql/data</span><br><span class="line">--output_file=/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">--handle_raw_binlog=1</span><br><span class="line">--disable_log_bin=0</span><br><span class="line">--manager_version=0.58</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pply_diff_relay_logs</span><br><span class="line">--<span class="built_in">command</span>=apply</span><br><span class="line">--slave_user=<span class="string">&#x27;mha&#x27;</span></span><br><span class="line">--slave_host=172.16.1.54</span><br><span class="line">--slave_ip=172.16.1.54</span><br><span class="line">--slave_port=3306</span><br><span class="line">--</span><br><span class="line">apply_files=/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">--workdir=/var/tmp</span><br><span class="line">--target_version=5.7.42-<span class="built_in">log</span></span><br><span class="line">--timestamp=20240827154042</span><br><span class="line">--handle_raw_binlog=1</span><br><span class="line">--disable_log_bin=0</span><br><span class="line">--manager_version=0.58</span><br><span class="line">--slave_pass=xxx</span><br></pre></td></tr></table></figure><p>MHAæ—¥å¿—æ–‡ä»¶é‡Œé¢çš„binlogçš„è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å…ˆå°†binlogä¿å­˜åœ¨å®•æœºä¸»åº“çš„ /var/tmp/</span></span><br><span class="line">[root@db02 ~]# ll /var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">-rw-r--r-- 1 root root 177 Aug 27 15:40</span><br><span class="line">/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å°†binlogä»å®•æœºä¸»åº“ä¿å­˜åˆ°manageræ‰€åœ¨çš„æœºå™¨</span></span><br><span class="line">[root@mha-manager ~]# ll /etc/mha/app1/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">-rw-r--r-- 1 root root 177 Aug 27 15:40 /etc/mha/app1/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.å°†binlogä»manageræ‰€åœ¨çš„æœºå™¨å‘é€ç»™æ–°ä¸»åº“</span></span><br><span class="line">[root@db04 ~]# ll /var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br><span class="line">-rw-r--r-- 1 root root 177 Aug 27 15:40</span><br><span class="line">/var/tmp/saved_master_binlog_from_172.16.1.52_3306_20240827154042.binlog</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240828202522903.png" alt="image-20240828202522903"></p><p><img src="../image/study_img/image-20240827195935226.png" alt="image-20240827195935226"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mhaé…ç½®æ–‡ä»¶ä»¥è¦†ç›–çš„å½¢å¼æ‘˜é™¤</span><br></pre></td></tr></table></figure><h3 id="5ã€MHAé›†ç¾¤çš„æ¢å¤"><strong>5ã€MHAé›†ç¾¤çš„æ¢å¤</strong></h3><p>1ã€å®•æ‰db01ä¸»åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1ã€åœæ­¢mysql</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">2ã€db02</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">3ã€db03  <span class="comment">#çœ‹åˆ°ä¸»åº“å·²å˜æˆdb02äº†</span></span><br><span class="line">root@localhost:(none) &gt;  show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.52</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000008</span><br><span class="line">          Read_Master_Log_Pos: 120</span><br><span class="line">               Relay_Log_File: db03-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 283</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000008</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">            </span><br><span class="line">4ã€db04  <span class="comment">#çœ‹åˆ°ä¸»åº“å·²å˜æˆdb02äº†</span></span><br><span class="line">root@localhost:(none) &gt;  show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.52</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000008</span><br><span class="line">          Read_Master_Log_Pos: 120</span><br><span class="line">               Relay_Log_File: db04-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 283</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000008</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">            </span><br><span class="line">5ã€æŸ¥çœ‹lb01MHAç®¡ç†æœºå™¨çš„é…ç½®æ–‡ä»¶ï¼Œå·²æ‘˜é™¤db01çš„serveræ ‡ç­¾</span><br></pre></td></tr></table></figure><p>2ã€ä¿®å¤å®•æœºçš„ä¸»åº“ï¼Œå¹¶åŠ å…¥é›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¿®å¤å®•æœºçš„ä¸»åº“(db01)</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line">2ã€#æ‰¾åˆ°æœ€åä¸€ä¸ªchange masterè¯­å¥ï¼Œåˆ°å®•æœºçš„ä¸»åº“æ‰§è¡Œ</span><br><span class="line">[root@lb01 ~]# grep -i <span class="string">&#x27;change master to&#x27;</span> /etc/mha/logs/manager.log|<span class="built_in">tail</span> -1</span><br><span class="line">CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;172.16.1.52&#x27;</span>, MASTER_PORT=3306, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000008&#x27;</span>, MASTER_LOG_POS=120, MASTER_USER=<span class="string">&#x27;rep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3ã€#db01æ‰§è¡Œchange msater è¯­å¥,å¯åŠ¨ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; CHANGE MASTER TO MASTER_HOST=<span class="string">&#x27;172.16.1.52&#x27;</span>, MASTER_PORT=3306, MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000008&#x27;</span>, MASTER_LOG_POS=120, MASTER_USER=<span class="string">&#x27;rep&#x27;</span>, MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.52</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000008</span><br><span class="line">          Read_Master_Log_Pos: 120</span><br><span class="line">               Relay_Log_File: db01-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 283</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000008</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">4ã€#MHAä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†db01çš„ä¿¡æ¯åŠ å…¥mhaé…ç½®æ–‡ä»¶</span><br><span class="line">[root@lb01 ~]# vim /etc/mha/app1.cnf </span><br><span class="line">.....</span><br><span class="line">[server1]</span><br><span class="line">hostname=172.16.1.51</span><br><span class="line">port=3306</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€#å¯åŠ¨mha</span><br><span class="line">[root@lb01 ~]# systemctl start mha</span><br><span class="line"></span><br><span class="line">6ã€æ£€æŸ¥è°æ˜¯ä¸»åº“ï¼Œä¼šæŠ¥é”™ï¼Œéœ€è¦å®‰è£…mysqlå‘½ä»¤</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line"></span><br><span class="line">7ã€å®‰è£…mysqlå‘½ä»¤</span><br><span class="line">å®‰è£…mysqlæº</span><br><span class="line">[root@lb01 ~]# rpm -ivh https://dev.mysql.com/get/mysql84-community-release-el7-1.noarch.rpm</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# vim /etc/yum.repos.d/mysql-community.repo </span><br><span class="line"><span class="comment">#å°±ä¿®æ”¹è¿™ä¸ªæ ‡ç­¾,å…¶ä»–çš„åˆ é™¤ï¼Œæ–‡ä»¶é‡Œé¢å°±ä¿ç•™è¿™å‡ è¡Œ</span></span><br><span class="line">[mysql56-community]</span><br><span class="line">name=MySQL 5.6 Community Server</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-5.6-community/el/7/<span class="variable">$basearch</span></span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# yum -y install mysql</span><br><span class="line"></span><br><span class="line">8ã€å†æ¬¡æ‰§è¡Œ</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:27835) is running(0:PING_OK), master:172.16.1.51</span><br></pre></td></tr></table></figure><h3 id="6ã€å†™è„šæœ¬æ¢å¤é›†ç¾¤ï¼Œæ”¾åˆ°mhaæœºå™¨">6ã€<strong>å†™è„šæœ¬æ¢å¤é›†ç¾¤ï¼Œæ”¾åˆ°mhaæœºå™¨</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:27835) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line">2ã€å†™è„šæœ¬æ¢å¤ï¼Œæ”¾åˆ°mhaæœºå™¨</span><br><span class="line">[root@lb01 ~]# vim recover.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#è„šæœ¬åŠŸèƒ½ï¼šé›†ç¾¤æ¢å¤è„šæœ¬</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">log_file=<span class="string">&#x27;/etc/mha/logs/manager.log&#x27;</span></span><br><span class="line">mha_conf=<span class="string">&#x27;/etc/mha/app1.cnf&#x27;</span></span><br><span class="line">repl_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">mha_user=$(awk -F= <span class="string">&#x27;/^user/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">mha_password=$(awk -F= <span class="string">&#x27;/^password/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line"><span class="comment">#å®•æœºçš„ä¸»åº“æ˜¯å“ªä¸€å°</span></span><br><span class="line">dowm_master=$(sed -nr <span class="string">&#x27;s#^Master (.*)\(.*\).*!$#\1#gp&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1)</span><br><span class="line"><span class="comment">#æŸ¥æ‰¾change master è¯­å¥</span></span><br><span class="line">change_master=$(grep -i <span class="string">&#x27;change master to&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1|awk -F: <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|sed <span class="string">&quot;s#xxx#<span class="variable">$&#123;repl_pass&#125;</span>#g&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨  éœ€è¦å†™è„šæœ¬æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨ä¿®å¤ä¸»åº“.....&quot;</span></span><br><span class="line">ssh <span class="variable">$&#123;dowm_master&#125;</span> <span class="string">&#x27;/etc/init.d/mysqld start&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">      mysqladmin -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;dowm_master&#125;</span> ping &amp;&gt;/dev/null</span><br><span class="line">      <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">           <span class="comment">#æ‰§è¡Œchange masterè¯­å¥</span></span><br><span class="line">           mysql -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;dowm_master&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;change_master&#125;</span>;start slave&quot;</span></span><br><span class="line">           <span class="built_in">echo</span> <span class="string">&quot;ä¸»åº“ä¿®å¤å®Œæˆ.....&quot;</span></span><br><span class="line">           <span class="built_in">break</span></span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨è¡¥å…¨MHAé…ç½®æ–‡ä»¶...&quot;</span></span><br><span class="line"><span class="comment">#è¦†ç›–é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#cat &gt; $&#123;mha_conf&#125; &lt;&lt;-EOF  è¿™æ ·å­å†™ï¼Œcaté‡Œé¢çš„å†…å®¹å°±ä¸ç”¨é¡¶æ ¼å†™</span></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$&#123;mha_conf&#125;</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[server default]</span></span><br><span class="line"><span class="string">manager_log=/etc/mha/logs/manager.log</span></span><br><span class="line"><span class="string">manager_workdir=/etc/mha/app1</span></span><br><span class="line"><span class="string">master_binlog_dir=/app/mysql-5.6.50/data</span></span><br><span class="line"><span class="string">master_ip_failover_script=/etc/mha/app1/master_ip_failover</span></span><br><span class="line"><span class="string">password=$&#123;mha_password&#125;</span></span><br><span class="line"><span class="string">ping_interval=2</span></span><br><span class="line"><span class="string">repl_password=123</span></span><br><span class="line"><span class="string">repl_user=rep</span></span><br><span class="line"><span class="string">ssh_port=22</span></span><br><span class="line"><span class="string">ssh_user=root</span></span><br><span class="line"><span class="string">user=$&#123;mha_user&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server1]</span></span><br><span class="line"><span class="string">hostname=172.16.1.51</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server2]</span></span><br><span class="line"><span class="string">hostname=172.16.1.52</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server3]</span></span><br><span class="line"><span class="string">hostname=172.16.1.53</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server4]</span></span><br><span class="line"><span class="string">hostname=172.16.1.54</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#[binlog1]</span></span><br><span class="line"><span class="string">#(è¿™ä¸ªé…ç½®äº†ï¼Œå°±æ°¸è¿œä¸ä¼šæå‡ä¸ºä¸»åº“)</span></span><br><span class="line"><span class="string">#no_master=1 </span></span><br><span class="line"><span class="string">#hostname=172.16.1.5</span></span><br><span class="line"><span class="string">#master_binlog_dir=/data/mysql/binlog</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨mha</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨å¯åŠ¨MHA.....&quot;</span></span><br><span class="line">systemctl start mha</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        masterha_check_status --conf=<span class="variable">$&#123;mha_conf&#125;</span> &amp;&gt;/dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">              action <span class="string">&quot;MHA managerå¯åŠ¨&quot;</span> /bin/true</span><br><span class="line">              <span class="built_in">break</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#æ‰§è¡Œè„šæœ¬</span><br><span class="line">sh -x recover.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€vipçš„æ¼‚ç§»</span><br><span class="line">2ã€é…åˆzabbixçš„è‡ªæ„ˆæ¨¡å¼ï¼Œè¦ç­‰åˆ‡æ¢å®Œæ‰å¯ä»¥æ‰§è¡Œè„šæœ¬  </span><br><span class="line">ä¸Šä¸€æ¬¡å®•æœºçš„ä¸»åº“ï¼Œå’Œè¿™ä¸€æ¬¡çš„æ–°ä¸»åº“ï¼Œéƒ½è¦è®°å½•ä¸€ä¸‹ï¼Œå†åˆ¤æ–­è¿™ä¸ªæ—¥å¿—é‡Œé¢ï¼Œè¿™ä¸€æ¬¡å®•æœºçš„ä¸»åº“ï¼Œæ˜¯ä¸æ˜¯ä¸Šä¸€æ¬¡å®•æœºçš„ä¸»åº“  è¦åœ¨è„šæœ¬å‰é¢åˆ¤æ–­ä¸Šä¸€æ¬¡åˆ‡æ¢æ˜¯å¦å®Œæˆï¼Œå°±æ˜¯çœ‹æŠ¥å‘Šæ˜¯å¦å‡ºæ¥</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ï¼šæ ¹æ®æ•°æ®æœ€æ–°çš„æå‡ä¸ºä¸»åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç›®å‰ç¯å¢ƒï¼š </span></span><br><span class="line">ä¸»åº“ï¼šdb01</span><br><span class="line">ä»åº“ï¼šdb02ã€db03ã€db04</span><br><span class="line"></span><br><span class="line"><span class="comment">#éœ€æ±‚ï¼šæƒ³è®©db03çš„æ•°æ®æœ€æ–°ï¼Œå…¶ä»–2ä¸ªçš„æ•°æ®è½åï¼Œdb03çš„æ•°æ®æœ€æ–°ï¼Œå°±ä¼šåˆ‡ä¸ºä¸»åº“</span></span><br><span class="line"></span><br><span class="line">1ã€#å½“ä¸çŸ¥é“è°æ˜¯ä¸»åº“æ—¶ï¼Œæ‰§è¡Œè¿™æ¡å‘½ä»¤</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:27835) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#db01æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">3ã€#æƒ³è®©db03æ•°æ®æœ€æ–°ï¼Œå¾—è®©å…¶ä»–2ä¸ªåº“çš„relaylogè½å</span><br><span class="line">(db02)</span><br><span class="line">root@localhost:(none) &gt; stop slave io_thread;</span><br><span class="line">(db04)</span><br><span class="line">root@localhost:(none) &gt; stop slave io_thread;</span><br><span class="line"></span><br><span class="line">æ£€æŸ¥æ•°æ®æ˜¯å¦è½å</span><br><span class="line"><span class="keyword">select</span> * from prod.prod</span><br><span class="line"></span><br><span class="line">4ã€#åœæ­¢ä¸»åº“db01,åœæ­¢è„šæœ¬</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db01 ~]# sh insert.sh ^C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€#db02ã€db04æ£€æŸ¥ä¸»ä»çŠ¶æ€,å·²ç»å˜æˆä¸»åº“</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.53</span><br><span class="line">                  </span><br><span class="line">6ã€#æ‰§è¡Œè„šæœ¬ï¼Œå°†å®•æ‰çš„db01åŠ å…¥é›†ç¾¤ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼Œé›†ç¾¤çš„ä¸»åº“å˜æˆdb03</span><br><span class="line">[root@lb01 ~]#  sh recover.sh </span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:31397) is running(0:PING_OK), master:172.16.1.53</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è„šæœ¬é‡Œé¢çš„ï¼šstart slave ä¼šæŠŠsqlã€ioçº¿ç¨‹èµ·æ¥</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ï¼šè®¾ç½®å‚¨å›å‚æ•°(å°†æŸå°æ•°æ®åº“çš„æ•°æ®ä¸€ç›´è½å)ï¼Œé€‰ä¸»æ—¶ï¼Œè¯¥æ•°æ®åº“è¢«é€‰ä¸ºä¸»åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è®¾ç«‹å¤ªå­ï¼Œä½†æ˜¯å¦‚æœå¤ªå­è½åå…¶ä»–æœºå™¨æ•°æ®è¶…è¿‡100Mï¼Œå°±åºŸå‚¨</span></span><br><span class="line">candidate_master=1 </span><br><span class="line"><span class="comment">#å…³é—­å¯¹å¤ªå­è½åçš„æ£€æµ‹</span></span><br><span class="line">check_repl_delay=0 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®©db02æ•°æ®è½åï¼Œé€‰ä¸»æ—¶ï¼Œå¼ºè¡Œè¢«é€‰ä¸ºä¸»åº“</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€ä¿®æ”¹mhaé…ç½®æ–‡ä»¶</span><br><span class="line">[root@lb01 ~]# vim /etc/mha/app1.cnf </span><br><span class="line">.....</span><br><span class="line">[server2]</span><br><span class="line"><span class="comment">#è®¾ç«‹å¤ªå­ï¼Œä½†æ˜¯å¦‚æœå¤ªå­è½åå…¶ä»–æœºå™¨æ•°æ®è¶…è¿‡100Mï¼Œå°±åºŸå‚¨</span></span><br><span class="line">candidate_master=1</span><br><span class="line"><span class="comment">#å…³é—­å¯¹å¤ªå­è½åçš„æ£€æµ‹</span></span><br><span class="line">check_repl_delay=0 </span><br><span class="line">hostname=172.16.1.52</span><br><span class="line">port=3306</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">2ã€é‡å¯mha</span><br><span class="line">[root@lb01 ~]# systemctl restart mha</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:31957) is running(0:PING_OK), master:172.16.1.53</span><br><span class="line"></span><br><span class="line">3ã€ä¸»åº“db03æ‰§è¡Œå†™å…¥æ•°æ®è„šæœ¬</span><br><span class="line">[root@db03 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">4ã€è®¾ç½®db02æ•°æ®è½å </span><br><span class="line">root@localhost:(none) &gt; stop slave io_thread;</span><br><span class="line">æ­¤æ—¶ï¼Œdb02çš„æ•°æ®è‚¯å®šè½å</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€åœæ­¢db03æ•°æ®åº“ï¼Œåœæ­¢è„šæœ¬</span><br><span class="line">[root@db03 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">[root@db03 ~]# sh insert.sh ^C</span><br><span class="line"></span><br><span class="line">6ã€æŸ¥çœ‹db01ã€db04ä¸»ä»çŠ¶æ€ï¼Œä¸»åº“å¼ºåˆ¶å˜æˆäº†db02</span><br><span class="line">root@localhost:(none) &gt;  show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.52</span><br></pre></td></tr></table></figure><h3 id="7ã€-MHAçš„vipæ¼‚ç§»">7ã€ MHAçš„vipæ¼‚ç§»</h3><p>VIPæ¼‚ç§»çš„ä¸¤ç§æ–¹å¼<br>1ï¼‰é€šè¿‡keepalivedçš„æ–¹å¼ï¼Œç®¡ç†è™šæ‹ŸIPçš„æ¼‚ç§»<br>2ï¼‰é€šè¿‡MHAè‡ªå¸¦è„šæœ¬æ–¹å¼ï¼Œç®¡ç†è™šæ‹ŸIPçš„æ¼‚ç§»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MHA + keepalivedæ–¹æ¡ˆ</span></span><br><span class="line"></span><br><span class="line">1ã€keepalivedå¦‚ä½•å¯ä»¥æ‰¾åˆ°æœ€æ–°çš„ä»åº“</span><br><span class="line">2ã€è¦å†™4ä¸ªè„šæœ¬ï¼Œæ¯å°æœºå™¨æ”¾ä¸€ä¸ªï¼Œåˆ‡æ¢çš„æ—¶å€™å®¹æ˜“å‡ºç°è„‘è£‚</span><br><span class="line">3ã€éœ€è¦ç­‰å¾…MHAåˆ‡æ¢å®Œæˆå†æ¼‚ç§»VIP</span><br><span class="line">4ã€å¤šä¸ªè„šæœ¬åŒæ—¶æ‰§è¡Œï¼Œéœ€è¦å»æ£€æµ‹ä¸åŒæœºå™¨ä¸Šslaveçš„å¤åˆ¶æƒ…å†µ</span><br><span class="line">5ã€ç½‘ä¸Šçš„æ–‡æ¡£å°±2å°ä¹‹é—´æ¼‚ç§»ï¼Œä¸ä¼šåš4å°ï¼Œå¦‚æœ2å°åˆ‡æ¢ï¼Œå¦‚ä½•ä¿è¯åˆ‡åˆ°çš„æ•°æ®æœ€æ–°å‘¢(åšåŠåŒæ­¥å¯ä»¥è§£å†³)</span><br><span class="line">6ã€åŠåŒæ­¥é˜»å¡æ•°æ®å†™å…¥ï¼Œå½±å“ä¸»åº“æ€§èƒ½(è¿™ä¸ªæœºå™¨ä¸æä¾›æœåŠ¡å°±å¯ä»¥è§£å†³)</span><br><span class="line">7ã€äº’ç›¸åˆ‡æ¢çš„2å°ä¸»åº“å‡é…ç½®ï¼Œ(51 51å‡é…ï¼Œ53 54ä¸å‡é…ç½®)</span><br><span class="line"></span><br><span class="line">6ã€7 è¿™2ç‚¹å°±æ˜¯åœ¨ç ¸é’±</span><br><span class="line"></span><br><span class="line">mhaå¯ä»¥æ‰¾åˆ°æœ€æ–°çš„ä»åº“æ›¿æ¢ä¸ºä¸»åº“</span><br></pre></td></tr></table></figure><p><strong>é…ç½®MHA + master_ip_failover  (MHAè‡ªå¸¦è„šæœ¬æ–¹å¼çš„VIPæ¼‚ç§»)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ›´æ”¹MHAçš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@lb01 ~]# vim /etc/mha/app1/master_ip_failover </span><br><span class="line">master_ip_failover_script=/etc/mha/app1/master_ip_failover</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€ä¸‹è½½å†™å¥½çš„å°†è„šæœ¬æ”¾åˆ°å·¥ä½œç›®å½•</span><br><span class="line">[root@lb01 ~]# wget http://test.driverzeng.com/MySQL_File/master_ip_failover</span><br><span class="line"><span class="comment">#ifconfig eth1:1 172.16.1.55/24</span></span><br><span class="line"><span class="comment">#å°±æ˜¯åœ¨è„šæœ¬ä¸­æ·»åŠ VIPçš„å®šä¹‰</span></span><br><span class="line">my <span class="variable">$vip</span> = <span class="string">&#x27;172.16.1.55/24&#x27;</span>;</span><br><span class="line">my <span class="variable">$key</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">my <span class="variable">$ssh_start_vip</span> = <span class="string">&quot;/sbin/ifconfig eth1:<span class="variable">$key</span> <span class="variable">$vip</span>&quot;</span>;</span><br><span class="line">my <span class="variable">$ssh_stop_vip</span> = <span class="string">&quot;/sbin/ifconfig eth1:<span class="variable">$key</span> down&quot;</span>;</span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# <span class="built_in">mv</span> master_ip_failover  /etc/mha/app1</span><br><span class="line"></span><br><span class="line">3ã€æ£€æµ‹MHAçŠ¶æ€</span><br><span class="line">[root@lb01 ~]#  masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:32555) is running(0:PING_OK), master:172.16.1.52</span><br><span class="line"></span><br><span class="line">3ã€æ‰‹åŠ¨åœ¨ä¸»åº“ä¸Šç»‘å®šVIP</span><br><span class="line">[root@db02 ~]# ifconfig eth1:1 172.16.1.55/24</span><br><span class="line"></span><br><span class="line">4ã€ç»™è„šæœ¬æ‰§è¡Œæƒé™</span><br><span class="line">[root@lb01 ~]# <span class="built_in">chmod</span> +x /etc/mha/app1/master_ip_failover</span><br><span class="line"></span><br><span class="line">5ã€é‡å¯mha</span><br><span class="line">[root@lb01 ~]# systemctl stop mha</span><br><span class="line">[root@lb01 ~]# systemctl start mha</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ è„šæœ¬é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡å¯ä¸æ¥</span></span><br><span class="line">1.æƒé™é—®é¢˜</span><br><span class="line">2ã€è¯­æ³•é—®é¢˜</span><br><span class="line">3ã€æ ¼å¼é—®é¢˜   dos2nuix /etc/mha/app1/master_ip_failover</span><br><span class="line">[root@lb01 ~]#  dos2unix /etc/mha/app1/master_ip_failover</span><br><span class="line">dos2unix: converting file /etc/mha/app1/master_ip_failover to Unix format ...</span><br><span class="line"></span><br><span class="line">5ã€é‡å¯mha</span><br><span class="line">[root@lb01 ~]# systemctl stop mha</span><br><span class="line">[root@lb01 ~]# systemctl start mha</span><br><span class="line"></span><br><span class="line">6ã€æŠŠæ·»åŠ çš„é…ç½®å†™åˆ°è„šæœ¬é‡Œé¢ï¼Œä»¥åè„šæœ¬æœ‰ä»€ä¹ˆæ”¹åŠ¨ï¼Œå°±è¦å†™åœ¨è„šæœ¬é‡Œ</span><br><span class="line">MHAèƒ½å¤Ÿæ‰¾åˆ°æœ€æ–°æ•°æ®çš„ä»åº“</span><br></pre></td></tr></table></figure><p>VIPæ¼‚ç§»åˆ‡æ¢æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">æ—¢ç„¶æœ‰äº†VIP,é‚£ä¹ˆä»¥åç¨‹åºå°±å¾€VIPé‡Œé¢å†™æ•°æ®ï¼Œç°åœ¨è¦æ›´æ”¹å†™æ•°æ®çš„è„šæœ¬</span><br><span class="line"></span><br><span class="line">1ã€æ£€æµ‹ç›®å‰è°æ˜¯ä¸»åº“</span><br><span class="line">[root@lb01 ~]#  masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:51306) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line">2ã€å…ˆå®æ—¶è¿½è¸ªæ—¥å¿—</span><br><span class="line">[root@lb01 ~]# tailf  /etc/mha/logs/manager.log</span><br><span class="line"></span><br><span class="line">3ã€æ¯ä¸ªæœºå™¨ä¸Šéƒ½ä¿®æ”¹å†™å…¥æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db01 ~]# vim insert.sh </span><br><span class="line"><span class="comment">#ä¿®æ”¹ä¸ºVIP</span></span><br><span class="line">master_ip=172.16.1.55</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@db02 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">5ã€åœæ­¢å½“å‰çš„ä¸»åº“</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">6ã€å¯çœ‹åˆ°å†™å…¥æ•°æ®çš„ç¨‹åºå¼€å§‹æŠ¥é”™</span><br><span class="line">ERROR 2003 (HY000): Can<span class="string">&#x27;t connect to MySQL server on &#x27;</span>172.16.1.55<span class="string">&#x27; (111)</span></span><br><span class="line"><span class="string">Warning: Using a password on the command line interface can be insecure.</span></span><br><span class="line"><span class="string">ERROR 2003 (HY000): Can&#x27;</span>t connect to MySQL server on <span class="string">&#x27;172.16.1.55&#x27;</span> (111)</span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">ERROR 2003 (HY000): Can<span class="string">&#x27;t connect to MySQL server on &#x27;</span>172.16.1.55<span class="string">&#x27; (111)</span></span><br><span class="line"><span class="string">Warning: Using a password on the command line interface can be insecure.</span></span><br><span class="line"><span class="string">ERROR 2003 (HY000): Can&#x27;</span>t connect to MySQL server on <span class="string">&#x27;172.16.1.55&#x27;</span> (111)</span><br><span class="line"></span><br><span class="line">7ã€çœ‹åˆ°æ—¥å¿—å¼€å§‹æœ‰æ•°æ®è¾“å‡ºï¼Œå¼€å§‹å°†VIPæ¼‚ç§»åˆ°æ–°ä¸»åº“</span><br><span class="line"></span><br><span class="line">8ã€æŸ¥çœ‹db01çš„å†™å…¥æ•°æ®è„šæœ¬å¼€å§‹æ¢å¤æ•°æ®å†™å…¥ï¼Œè¯´æ˜æ•°æ®å†™å…¥åˆ°æ–°ä¸»åº“db02</span><br><span class="line">[root@lb01 ~]# systemctl start mha</span><br><span class="line">[root@lb01 ~]#  masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:55464) is running(0:PING_OK), master:172.16.1.52</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# ifconfig</span><br><span class="line">......</span><br><span class="line">eth1:1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.16.1.55  netmask 255.255.255.0  broadcast </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment">#9ã€æƒ³è¦æŠŠå®•æœºçš„db01æ¢å¤åˆ°é›†ç¾¤ä½œä¸ºä»åº“ï¼Œå°±æ‰§è¡Œæ¢å¤è„šæœ¬</span></span><br></pre></td></tr></table></figure><h3 id="8ã€MYSQL-binlogå®æ—¶åŒæ­¥">8ã€MYSQL binlogå®æ—¶åŒæ­¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sersync + rsync</span></span><br><span class="line">1ã€åŒæ­¥åˆ°rsyncæœåŠ¡ç«¯çš„å“ªä¸ªç›®å½•</span><br><span class="line">2ã€MHAå‡­ä»€ä¹ˆå»rsyncæœåŠ¡ç«¯çš„backupç›®å½•ä¸‹æ‰¾   (åœ¨mhaçš„é…ç½®æ–‡ä»¶é‡Œé¢é…ç½®)</span><br><span class="line">3ã€ä¸»åº“å˜æˆä»åº“äº†ï¼Œæ€ä¹ˆåŠ(æ¯å°ä»åº“éƒ½å®‰è£…sersync,ä½†ä¸èƒ½å…¨éƒ¨èµ·)</span><br><span class="line">è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥å®æ–½ï¼Œä½†æ˜¯éå¸¸éº»çƒ¦ï¼Œå°±æ€•mysqlå¾ˆåƒå†…å­˜ï¼Œå°±æ€•ç»™rsyncæ€äº†ï¼Œä½†æ˜¯rsyncå¾ˆè½»é‡çº§</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œå¦‚æœä½¿ç”¨sersync,è„šæœ¬é‡Œé¢çš„systemdå†™ç»å¯¹è·¯å¾„</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240828105224674.png" alt="image-20240828105224674"></p><p><strong>ä½¿ç”¨mysqlbinlogåŒæ­¥binlog</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">1ã€MHA é…ç½®binlog server,éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶,åŒæ­¥æ˜¯å¾€MHAç®¡ç†æœºåŒæ­¥</span><br><span class="line">[root@lb01 ~]# vim /etc/mha/app1.cnf</span><br><span class="line">....</span><br><span class="line">[binlog1]</span><br><span class="line"><span class="comment">#(å½“mysqå’Œmhaå®‰è£…åœ¨åŒä¸€ä¸ªæœºå™¨é‡Œé¢,è¿™ä¸ªé…ç½®äº†,å°±æ°¸è¿œä¸ä¼šæå‡ä¸ºä¸»åº“)</span></span><br><span class="line"><span class="comment">#no_master=1 </span></span><br><span class="line">hostname=172.16.1.5</span><br><span class="line">master_binlog_dir=/data/mysql/binlog</span><br><span class="line"></span><br><span class="line">2ã€åœ¨è„šæœ¬é‡Œé¢æ›´æ–°ä¸Šè¿™ä¸ªé…ç½®</span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºbinlogç›®å½•</span><br><span class="line">[root@lb01 ~]# <span class="built_in">mkdir</span> -p /data/mysql/binlog</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹ä¸»åº“æ˜¯è°</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:36583) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€ä¸€å®šè¦å…ˆè¿›å…¥ç›®å½•å†ï¼Œå®æ—¶åŒæ­¥binlog</span><br><span class="line">[root@lb01 ~]# <span class="built_in">cd</span> /data/mysql/binlog/</span><br><span class="line">[root@lb01 binlog]# mysqlbinlog -R --host=172.16.1.51 --user=mha --password=123 --raw --stop-never mysql-bin.000001 &amp;</span><br><span class="line">è¾“å…¥å›è½¦</span><br><span class="line">[1] 60923</span><br><span class="line"><span class="comment">#--host=ä¸»åº“IP</span></span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹172.16.1.51çš„binlogæ˜¯å¦åŒæ­¥è¿‡æ¥</span><br><span class="line">[root@lb01 binlog]# <span class="built_in">pwd</span></span><br><span class="line">/data/mysql/binlog</span><br><span class="line">[root@lb01 binlog]# ll</span><br><span class="line">total 12016</span><br><span class="line">-rw-rw---- 1 root root     440 Aug 29 18:20 mysql-bin.000001</span><br><span class="line">-rw-rw---- 1 root root     143 Aug 29 18:20 mysql-bin.000002</span><br><span class="line"></span><br><span class="line">6ã€éªŒè¯æ˜¯å¦å®æ—¶åŒæ­¥</span><br><span class="line">172.16.1.51 db01æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh </span><br><span class="line">[root@lb01 binlog]# ll /data/mysql/binlog/</span><br><span class="line">total 12016</span><br><span class="line">-rw-rw---- 1 root root     440 Aug 29 18:20 mysql-bin.000001</span><br><span class="line">-rw-rw---- 1 root root     143 Aug 29 18:20 mysql-bin.000002</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æœ€åä¸€ä¸ªbinlogçš„Â·å¤§å°æ˜¯å¦å˜åŒ–ï¼Œå˜åŒ–åˆ™å®æ—¶åŒæ­¥binlog,å†å’Œdb01ä¸»åº“çš„binlogå¯¹æ¯”ï¼ŒæŸ¥çœ‹å¤§å°æ˜¯å¦ä¸€æ ·ï¼Œä¸€æ ·åˆ™åŒæ­¥æˆåŠŸ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ·æ–°binlog  å†åˆ°mhaç®¡ç†æœºä¸ŠæŸ¥çœ‹æ˜¯å¦æœ‰æ–°çš„binlog</span></span><br><span class="line">[root@db01 ~]# mysqladmin -uroot -p123 flush-log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7ã€å½“db02å˜æˆä»åº“æ—¶ï¼Œå°±ä¸èƒ½ç”¨ä¸Šæ¡å‘½ä»¤å»æ‹‰å–binlog,æ‰€ä»¥hostè¦æ”¹æˆvipï¼Œå°±æ¯”è¾ƒæ–¹ä¾¿</span><br><span class="line">[root@lb01 binlog]# <span class="built_in">kill</span> %1     </span><br><span class="line">æˆ–è€…killall  mysqlbinlog</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨VIPæ‹‰å–binlog</span></span><br><span class="line">[root@lb01 ~]# <span class="built_in">cd</span> /data/mysql/binlog/</span><br><span class="line">[root@lb01 binlog]# mysqlbinlog -R --host=172.16.1.55 --user=mha --password=123 --raw --stop-never mysql-bin.000001 &amp;</span><br><span class="line">è¾“å…¥å›è½¦</span><br><span class="line">[1] 60923</span><br><span class="line"><span class="comment">#--host=VIP</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">[root@lb01 ~]# vim /root/failover_status</span><br><span class="line">new_master=$(sed -nr <span class="string">&#x27;s#^app1.*failover (.*)\(.*\) to (.*)\(.*\) succeeded$#\2#gp&#x27;</span> /etc/mha/logs/manager.log|<span class="built_in">tail</span> -1)</span><br><span class="line">old_master=$(sed -nr <span class="string">&#x27;s#^app1.*failover (.*)\(.*\) to (.*)\(.*\) succeeded$#\1#gp&#x27;</span> /etc/mha/logs/manager.log|<span class="built_in">tail</span> -1)</span><br><span class="line"><span class="comment">#app1: MySQL Master failover 172.16.1.51(172.16.1.51:3306) to 172.16.1.52(172.16.1.52:3306) succeeded</span></span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# vim vip-recover.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">. /etc/init.d/functions</span><br><span class="line">. /root/failover_status</span><br><span class="line">log_file=<span class="string">&#x27;/etc/mha/logs/manager.log&#x27;</span></span><br><span class="line">mha_conf=<span class="string">&#x27;/etc/mha/app1.cnf&#x27;</span></span><br><span class="line">repl_pass=<span class="string">&#x27;123&#x27;</span></span><br><span class="line">mha_user=$(awk -F= <span class="string">&#x27;/^user/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line">mha_password=$(awk -F= <span class="string">&#x27;/^password/&#123;print $2&#125;&#x27;</span> <span class="variable">$&#123;mha_conf&#125;</span>)</span><br><span class="line"><span class="comment">#å®•æœºçš„ä¸»åº“æ˜¯å“ªä¸€å°</span></span><br><span class="line">dowm_master=$(sed -nr <span class="string">&#x27;s#^Master (.*)\(.*\).*!$#\1#gp&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"><span class="comment">#çœ‹çœ‹down_masterå’Œæ–‡ä»¶é‡Œé¢æ—§ä¸»åº“æ˜¯å¦ä¸€è‡´</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$&#123;dowm_master&#125;</span> == <span class="variable">$&#123;old_master&#125;</span> ];<span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥æ‰¾change master è¯­å¥</span></span><br><span class="line">change_master=$(grep -i <span class="string">&#x27;change master to&#x27;</span> <span class="variable">$&#123;log_file&#125;</span>|<span class="built_in">tail</span> -1|awk -F: <span class="string">&#x27;&#123;print $4&#125;&#x27;</span>|sed <span class="string">&quot;s#xxx#<span class="variable">$&#123;repl_pass&#125;</span>#g&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨  éœ€è¦å†™è„šæœ¬æ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨ä¿®å¤ä¸»åº“.....&quot;</span></span><br><span class="line">ssh <span class="variable">$&#123;dowm_master&#125;</span> <span class="string">&#x27;/etc/init.d/mysqld start&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">      mysqladmin -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;dowm_master&#125;</span> ping &amp;&gt;/dev/null</span><br><span class="line">      <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">           <span class="comment">#æ‰§è¡Œchange masterè¯­å¥</span></span><br><span class="line">           mysql -u<span class="variable">$&#123;mha_user&#125;</span> -p<span class="variable">$&#123;mha_password&#125;</span> -h<span class="variable">$&#123;dowm_master&#125;</span> -e <span class="string">&quot;<span class="variable">$&#123;change_master&#125;</span>;start slave&quot;</span></span><br><span class="line">           <span class="built_in">echo</span> <span class="string">&quot;ä¸»åº“ä¿®å¤å®Œæˆ.....&quot;</span></span><br><span class="line">           <span class="built_in">break</span></span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨è¡¥å…¨MHAé…ç½®æ–‡ä»¶...&quot;</span></span><br><span class="line"><span class="comment">#è¦†ç›–é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#cat &gt; $&#123;mha_conf&#125; &lt;&lt;-EOF  è¿™æ ·å­å†™ï¼Œcaté‡Œé¢çš„å†…å®¹å°±ä¸ç”¨é¡¶æ ¼å†™</span></span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$&#123;mha_conf&#125;</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">[server default]</span></span><br><span class="line"><span class="string">manager_log=/etc/mha/logs/manager.log</span></span><br><span class="line"><span class="string">manager_workdir=/etc/mha/app1</span></span><br><span class="line"><span class="string">master_binlog_dir=/app/mysql-5.6.50/data</span></span><br><span class="line"><span class="string">master_ip_failover_script=/etc/mha/app1/master_ip_failover</span></span><br><span class="line"><span class="string">password=$&#123;mha_password&#125;</span></span><br><span class="line"><span class="string">ping_interval=2</span></span><br><span class="line"><span class="string">repl_password=123</span></span><br><span class="line"><span class="string">repl_user=rep</span></span><br><span class="line"><span class="string">ssh_port=22</span></span><br><span class="line"><span class="string">ssh_user=root</span></span><br><span class="line"><span class="string">user=$&#123;mha_user&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server1]</span></span><br><span class="line"><span class="string">hostname=172.16.1.51</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server2]</span></span><br><span class="line"><span class="string">hostname=172.16.1.52</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server3]</span></span><br><span class="line"><span class="string">hostname=172.16.1.53</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[server4]</span></span><br><span class="line"><span class="string">hostname=172.16.1.54</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[binlog1]</span></span><br><span class="line"><span class="string">#(è¿™ä¸ªé…ç½®äº†ï¼Œå°±æ°¸è¿œä¸ä¼šæå‡ä¸ºä¸»åº“)</span></span><br><span class="line"><span class="string">#no_master=1 </span></span><br><span class="line"><span class="string">hostname=172.16.1.5</span></span><br><span class="line"><span class="string">master_binlog_dir=/data/mysql/binlog</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨mha</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨å¯åŠ¨MHA.....&quot;</span></span><br><span class="line">systemctl start mha</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line">        masterha_check_status --conf=<span class="variable">$&#123;mha_conf&#125;</span> &amp;&gt;/dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">              action <span class="string">&quot;MHA managerå¯åŠ¨&quot;</span> /bin/true</span><br><span class="line">              <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">else</span> </span><br><span class="line">     <span class="built_in">continue</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="9ã€åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶"><strong>9ã€åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœæ­¢mha</span></span><br><span class="line">[root@lb01 ~]# systemctl stop mha</span><br><span class="line">å› ä¸ºåœä¸»åº“çš„æ—¶å€™é˜²æ­¢MHAåˆ‡æ¢</span><br><span class="line"></span><br><span class="line">å› ä¸ºMHAå•¥æ ·çš„ä¸»ä»å¤åˆ¶éƒ½å¯ä»¥ç»“åˆï¼Œä¸éœ€è¦å¯¹å½“å‰çš„ä¸»ä»å¤åˆ¶åšä»»ä½•æ”¹åŠ¨ï¼Œç°åœ¨æ­å»ºGTIDçš„ä¸»ä»å¤åˆ¶ï¼Œçœ‹çœ‹MHAæ˜¯å¦ç»“åˆå…¼å®¹æ‰€æœ‰çš„ä¸»ä»å¤åˆ¶</span><br></pre></td></tr></table></figure><p><strong>ä»€ä¹ˆæ˜¯GTID</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GTIDï¼šäº‹åŠ¡æäº¤åšçš„ä¸»ä»å¤åˆ¶(å…¨å±€äº‹åŠ¡æ ‡è¯†ç¬¦)</span><br><span class="line">æ ‡è¯†ç¬¦æ˜¯ç”±UUID + TIDç»„æˆ</span><br><span class="line">UUIDï¼šä¸»åº“çš„èº«ä»½è¯å·</span><br><span class="line">TIDï¼šäº‹åŠ¡æäº¤å·</span><br></pre></td></tr></table></figure><p>GTIDç‰¹æ€§<br>(1).æ”¯æŒå¤šçº¿ç¨‹å¤åˆ¶ï¼šäº‹å®ä¸Šæ˜¯é’ˆå¯¹æ¯ä¸ªdatabaseå¼€å¯ç›¸åº”çš„ç‹¬ç«‹çº¿ç¨‹,å³æ¯ä¸ªåº“æœ‰ä¸€ä¸ªå•ç‹¬çš„(sqlthread).<br>(2).æ”¯æŒå¯ç”¨GTID,åœ¨é…ç½®ä¸»ä»å¤åˆ¶,ä¼ ç»Ÿçš„æ–¹å¼é‡Œ,ä½ éœ€è¦æ‰¾åˆ°binlogå’ŒPOSç‚¹,ç„¶åchange master toæŒ‡å‘.<br>åœ¨mysql5.6é‡Œ,æ— é¡»å†çŸ¥é“binlogå’ŒPOSç‚¹,åªéœ€è¦çŸ¥é“masterçš„IP/ç«¯å£/è´¦å·å¯†ç å³å¯,å› ä¸ºåŒæ­¥å¤åˆ¶æ˜¯è‡ªåŠ¨çš„,MySQLé€šè¿‡å†…éƒ¨æœºåˆ¶GTIDè‡ªåŠ¨æ‰¾ç‚¹åŒæ­¥.<br>(3).åŸºäºRowå¤åˆ¶åªä¿å­˜æ”¹å˜çš„åˆ—,å¤§å¤§èŠ‚çœDisk Space/Network resourceså’ŒMemory usage.<br>(4).æ”¯æŒæŠŠMaster å’ŒSlaveçš„ç›¸å…³ä¿¡æ¯è®°å½•åœ¨Tableä¸­åŸæ¥æ˜¯è®°å½•åœ¨æ–‡ä»¶é‡Œ,è®°å½•åœ¨è¡¨é‡Œ,å¢å¼ºå¯ç”¨æ€§<br>(5).æ”¯æŒå»¶è¿Ÿå¤åˆ¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">1ã€è¿æ¥è¿›å»å…³é—­ä¹‹å‰çš„ä¸»ä»å¤åˆ¶</span><br><span class="line">stop slave;reset slave all;show slave status\G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">################# ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ­¥éª¤</span></span><br><span class="line"><span class="comment"># 1.ä¿®æ”¹ä¸»åº“é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=1</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=2</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=3</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=4</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åœ¨ä¸»åº“ä¸Šåˆ›å»ºä¸»ä»å¤åˆ¶ç”¨æˆ·</span></span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.ä¸»åº“æŸ¥çœ‹binlogå’Œä½ç½®ç‚¹</span></span><br><span class="line">mysql&gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File             | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000012 | 154      |</span><br><span class="line">+------------------+----------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.ä»åº“change master</span></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000012&#x27;</span>,</span><br><span class="line">master_log_pos=154;</span><br><span class="line"><span class="comment"># 6.å¼€å¯ä¸»ä»å¤åˆ¶</span></span><br><span class="line">start slave;</span><br></pre></td></tr></table></figure><p>åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶</p><p><em>å…ˆå†³æ¡ä»¶</em><br>1ï¼‰ä¸»åº“å’Œä»åº“éƒ½è¦å¼€å¯binlog<br>2ï¼‰ä¸»åº“å’Œä»åº“server-idä¸åŒ<br>3ï¼‰è¦æœ‰ä¸»ä»å¤åˆ¶ç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">1ã€è¿æ¥è¿›å»å…³é—­ä¹‹å‰çš„ä¸»ä»å¤åˆ¶</span><br><span class="line">stop slave;reset slave all;show slave status\G</span><br><span class="line"></span><br><span class="line">2ã€ä¿®æ”¹ä¸»åº“é…ç½®æ–‡ä»¶</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=1</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">3ã€ä¿®æ”¹ä»åº“é…ç½®æ–‡ä»¶</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=2</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=3</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">server_id=4</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line">4ã€åœ¨ä¸»åº“ä¸Šåˆ›å»ºä¸»ä»å¤åˆ¶ç”¨æˆ·</span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶ä¸ç”¨å»è®°ä½ç½®ç‚¹ï¼Œä»–ä¼šæ ¹æ®äº‹åŠ¡å»æ‰¾ä½ç½®ç‚¹</span><br><span class="line"></span><br><span class="line">5ã€ä»åº“æ‰§è¡Œchange masterè¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_auto_position=1;</span><br><span class="line"></span><br><span class="line"><span class="comment">## ##æŠ¥é”™ï¼š</span></span><br><span class="line">mysql&gt; change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_auto_position=1;</span><br><span class="line">ERROR 1777 (HY000): CHANGE MASTER TO MASTER_AUTO_POSITION = 1 cannot be executed because @@GLOBAL.GTID_MODE = OFF.</span><br><span class="line">(#GLOBAL.GTID_MODE = OFF GTIDçš„æ¨¡å¼æ²¡æœ‰å¼€)</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%gtid%&#x27;</span>;</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line">| Variable_name                   | Value     |</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line">| binlog_gtid_simple_recovery     | ON        |</span><br><span class="line">| enforce_gtid_consistency        | OFF       |</span><br><span class="line">| gtid_executed                   | 1000      |</span><br><span class="line">| gtid_mode                       | OFF       |#GTIDçš„æ¨¡å¼æ²¡æœ‰å¼€</span><br><span class="line">| gtid_next                       | AUTOMATIC |</span><br><span class="line">| gtid_owned                      |           |</span><br><span class="line">| gtid_purged                     |           |</span><br><span class="line">| simplified_binlog_gtid_recovery | OFF       |</span><br><span class="line">+---------------------------------+-----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#########    MySQL5.6å¼€å¯GTID  ######</span></span><br><span class="line">6ã€4å°MYSQLæœºå™¨ [mysqld]æ ‡ç­¾ é…ç½®æ–‡ä»¶åŠ å…¥è¿™å‡ ä¸ªé…ç½®</span><br><span class="line"><span class="comment">#è¿™ä¸ªé…ç½®å°±åœ¨é…ç½®æ–‡ä»¶é‡Œé¢ï¼Œä¸ç”¨åˆ é™¤ï¼Œå³ä½¿ä½¿ç”¨ä¼ ç»Ÿçš„ä¹Ÿä¸å½±å“</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db03 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db04 ~]# vim /etc/my.cnf</span><br><span class="line">.....</span><br><span class="line"><span class="comment">#å¼€GTIDæ¨¡å—</span></span><br><span class="line">gtid_mode=ON</span><br><span class="line"><span class="comment">#ä¿è¯GTIDæ•°æ®å¼ºä¸€è‡´æ€§</span></span><br><span class="line">enforce_gtid_consistency</span><br><span class="line"><span class="comment">#ä»åº“æ—¥å¿—çš„æ›´æ–°ï¼ˆ1.åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶ 2.åŒä¸»+keepalived 3.çº§è”å¤åˆ¶ï¼‰</span></span><br><span class="line">log-slave-updates</span><br><span class="line"><span class="comment">#å¼€å¯binlog</span></span><br><span class="line">log_bin=mysql-bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#########    MySQL5.7å¼€å¯GTID  ######</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">gtid_mode=ON</span><br><span class="line">enforce_gtid_consistency</span><br></pre></td></tr></table></figure><p>[root@db02 ~]# tailf -100 /app/mysql-5.6.50/data/db02.err</p><p><img src="../image/study_img/image-20240828121147681.png" alt="image-20240828121147681"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">7ã€é‡å¯</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">8ã€è¿æ¥è¿›å»ä»åº“ï¼Œä»åº“æ‰§è¡Œchange masterè¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_auto_position=1;</span><br><span class="line"></span><br><span class="line">9ã€å¼€å¯ä¸»ä»å¤åˆ¶ï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">start slave;show slave status\G</span><br><span class="line"></span><br><span class="line"> Auto_Position: 1</span><br><span class="line"> </span><br><span class="line"> 10ã€MHAåˆ‡æ¢ä¸»ä»çš„æ—¶å€™è„šæœ¬é‡Œé¢ä¼šæ‰§è¡Œchange masterè¯­å¥ï¼Œé‚£ä¸ªè„šæœ¬é‡Œé¢çš„ä¹Ÿæ˜¯æ‰§è¡Œmaster_auto_position=1;</span><br><span class="line"> </span><br><span class="line"> 11ã€ä¸»åº“åˆ›å»ºä¸€ä¸ªåº“</span><br><span class="line"> root@localhost:(none) &gt; create database gtid;</span><br><span class="line"> root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+-----------------------------------------------------------------------------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set                                                                       |</span><br><span class="line">+------------------+----------+--------------+------------------+-----------------------------------------------------------------------------------------+</span><br><span class="line">| mysql-bin.000048 |   221998 |              |                  | a45796f8-61ca-11ef-808a-000c29688028:1-1058,</span><br><span class="line">df4b2d8a-54d3-11ef-ac00-000c29d088a4:1-564 |</span><br><span class="line">+------------------+----------+--------------+------------------+-----------------------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> 12ã€ä»åº“æŸ¥çœ‹çŠ¶æ€</span><br><span class="line"> *************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.51</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                  .......</span><br><span class="line">Retrieved_Gtid_Set: df4b2d8a-54d3-11ef-ac00-000c29d088a4:563-564 Executed_Gtid_Set: a45796f8-61ca-11ef-808a-000c29688028:1-1058</span><br></pre></td></tr></table></figure><p>ç»™åŸºäºGTIDçš„ä¸»ä»å¤åˆ¶ç»‘å®šVIP,å®ç°VIPæ¼‚ç§»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹ä¹‹å‰ç»‘å®šçš„VIPåœ¨å“ªï¼Œå‘ç°åœ¨db02ä¸Šé¢ï¼Œéœ€è¦è§£ç»‘vip</span><br><span class="line">[root@db02 ~]# ifconfig eth1:1 down</span><br><span class="line"></span><br><span class="line">2ã€æˆ‘æƒ³è®©db01ä½œä¸ºä¸»åº“ï¼Œéœ€è¦åœ¨ä¸»åº“ä¸Šé¢ç»‘å®šVIP</span><br><span class="line">[root@db01 ~]# ifconfig eth1:1 172.16.1.55/24</span><br><span class="line"></span><br><span class="line">3ã€å…ˆæ£€æŸ¥æ‹‰å–binlogçš„å‘½ä»¤æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨ï¼Œå°±å¯åŠ¨</span><br><span class="line">[root@lb01 binlog]# <span class="built_in">jobs</span></span><br><span class="line">[2]+  Running                 mysqlbinlog -R --host=172.16.1.55 --user=mha --password=123 --raw --stop-never mysql-bin.000001 &amp;</span><br><span class="line"></span><br><span class="line">4ã€MHAç®¡ç†æœºæ£€æµ‹repl</span><br><span class="line">[root@lb01 ~]# masterha_check_repl --conf=/etc/mha/app1.cnf</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">5ã€å¯åŠ¨mha,æ£€æµ‹å½“å‰çš„ä¸»åº“</span><br><span class="line">[root@lb01 ~]# systemctl start mha</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:76089) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line">6ã€æµ‹è¯•ï¼Œdb01æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh</span><br><span class="line"></span><br><span class="line">7ã€å®æ—¶è¿½è¸ªmhaæ—¥å¿—æ–‡ä»¶</span><br><span class="line">[root@lb01 ~]# tailf /etc/mha/logs/manager.log</span><br><span class="line"></span><br><span class="line">8ã€ç­‰å¾…ä¸€ä¼šï¼Œåœæ­¢db01æ•°æ®åº“</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">9ã€å†™å…¥æ•°æ®çš„è„šæœ¬å¼€å§‹æ‰§è¡Œé”™è¯¯ï¼Œç­‰å¾…ä¸€ä¼šï¼Œè„šæœ¬æ¢å¤æ­£å¸¸å†™å…¥ï¼Œè¯´æ˜vipæ¼‚ç§»åˆ°db02æœºå™¨</span><br></pre></td></tr></table></figure><p><strong>æŠ¥é”™è§£å†³</strong></p><p>æŠ¥é”™1ã€downæ‰ä¸»åº“ï¼Œvipåˆ‡æ¢äº†ï¼Œæƒ³è¦å°†å®•æ‰çš„ä¸»åº“åŠ å…¥é›†ç¾¤ï¼Œæ£€æµ‹replæ˜¯å¦å¥åº·ï¼Œå‡ºç°æŠ¥é”™</p><p><img src="../image/study_img/image-20240830001104977.png" alt="image-20240830001104977"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1ã€å…ˆæ£€æŸ¥mysqlbinlogæ˜¯å¦è¿è¡Œï¼Œå¦‚æœæ²¡æœ‰è¿è¡Œå°±å…ˆè¿è¡Œ</span><br><span class="line">[root@db02 ~]# <span class="built_in">jobs</span></span><br><span class="line">[1]+  Running                 mysqlbinlog -R --host=172.16.1.55 --user=mha --password=123 --raw --stop-never mysql-bin.000001 &amp;</span><br><span class="line"></span><br><span class="line">2ã€æ£€æŸ¥vipæ˜¯å¦å­˜åœ¨åœ¨æŸä¸ªæ•°æ®åº“ä¸Šé¢ï¼Œå¦‚æœåœ¨ï¼Œé‚£ä¹ˆæœ‰vipçš„å°†ä½œä¸ºä¸»åº“ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç»™ä¸»åº“ç»‘å®švip</span><br><span class="line"></span><br><span class="line">3ã€æ£€æŸ¥ä¸»ä»å¤åˆ¶æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœæ¯ä¸ªæœºå™¨çš„ä¸»ä»å¤åˆ¶éƒ½ä¸æ­£å¸¸ï¼Œä»åº“éœ€è¦é‡æ–°æ‰§è¡Œchange master è¯­å¥</span><br><span class="line">stop slave;</span><br><span class="line"></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_auto_position=1;</span><br><span class="line">    </span><br><span class="line">stop slave; start slave;show slave status\G </span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹ä¸»ä»å¤åˆ¶æ¢å¤æ­£å¸¸ä¹‹åï¼Œæ£€æŸ¥å¥åº·çŠ¶æ€ï¼Œå¦‚æœæ£€æŸ¥çŠ¶æ€æ²¡é—®é¢˜ï¼Œå°±å¯åŠ¨mha</span><br></pre></td></tr></table></figure><p>æŠ¥é”™2ï¼šåŸºäºä¼ ç»Ÿå¤åˆ¶çš„åŸºç¡€ä¸Šåšäº†GTIDä¸»ä»å¤åˆ¶ä¹‹åï¼Œå½“ä¸»ä»å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„ç°è±¡ï¼Œéœ€è¦å¯¹ä¸»åº“è¿›è¡Œå…¨å¤‡ï¼Œä½†æ˜¯å…¨å¤‡çš„binlogé‡Œé¢åŒ…å«ä¼ ç»Ÿçš„ä¸»ä»å¤åˆ¶binlog,å¯¼å…¥æ•°æ®æ—¶æŠ¥é”™ï¼ŒSQLçº¿ç¨‹æŠ¥é”™</p><p><img src="../image/study_img/image-20240902214618651.png" alt="image-20240902214618651"></p><p><img src="../image/study_img/image-20240902214644529.png" alt="image-20240902214644529"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§£å†³åŠæ³•ï¼š</span></span><br><span class="line"></span><br><span class="line">1ã€ä»åº“å…³é—­ä¸»ä»å¤åˆ¶ï¼Œå…³é—­è‡ªåŠ¨æŸ¥æ‰¾ä½ç½®ç‚¹</span><br><span class="line">root@localhost:(none) &gt; STOP SLAVE;</span><br><span class="line">root@localhost:(none) &gt; change master to master_auto_position=0;</span><br><span class="line"></span><br><span class="line">2ã€ä¸»åº“æ‰“ç‚¹å…¨å¤‡ï¼Œåœ¨æ¢å¤æ—¶å…³é—­GTIDå‚æ•°</span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=1 --single-transaction --set-gtid-purged=off|gzip &gt; /tmp/full.sql.gz</span><br><span class="line"></span><br><span class="line">3ã€ä¸»åº“å°†å…¨å¤‡çš„æ•°æ®å‘ç»™å…¶ä»–ä»åº“</span><br><span class="line">[root@db02 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 51 53 54 ;<span class="keyword">do</span> scp /tmp/full.sql.gz 172.16.1.<span class="variable">$i</span>:/tmp;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">4ã€ä»åº“å¯¼å…¥å…¨å¤‡æ•°æ®</span><br><span class="line">[root@db01 ~]# zcat /tmp/full.sql.gz |mysql -uroot -p123</span><br><span class="line">[root@db03 ~]# zcat /tmp/full.sql.gz |mysql -uroot -p123</span><br><span class="line">[root@db04 ~]# zcat /tmp/full.sql.gz |mysql -uroot -p123</span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹æ‰“ç‚¹çš„ä½ç½®ç‚¹</span><br><span class="line">[root@db01 ~]# zcat /tmp/full.sql.gz |<span class="built_in">head</span>  -25</span><br><span class="line">CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000001&#x27;</span>, MASTER_LOG_POS=151;</span><br><span class="line"></span><br><span class="line">6ã€æ‰€æœ‰ä»åº“æ‰§è¡Œchange masterè¯­å¥ï¼Œé‡å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.52&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=151,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">start slave;show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.52</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000001</span><br><span class="line">          Read_Master_Log_Pos: 151</span><br><span class="line">               Relay_Log_File: db01-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 314</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000001</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">            </span><br><span class="line"><span class="comment">#æ­¤æ—¶è™½ç„¶çœ‹åˆ°å˜æˆä¼ ç»Ÿçš„ä¸»ä»å¤åˆ¶ï¼Œä½†æ˜¯åªè¦é…ç½®æ–‡ä»¶é‡Œé¢å†™äº†å¼€å¯GTIDçš„Â·1é…ç½®ï¼Œå¾€æ•°æ®åº“é‡Œé¢å†™æ•°æ®ï¼Œå°±ä¼šå˜æˆCTIDä¸»ä»å¤åˆ¶ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.52&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_auto_position=1;</span><br><span class="line">    </span><br><span class="line">stop slave; start slave;show slave status\G </span><br></pre></td></tr></table></figure><h3 id="10ã€Mysqlçš„è¯»å†™åˆ†ç¦»">10ã€<strong>Mysqlçš„è¯»å†™åˆ†ç¦»</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯»å†™åˆ†ç¦»è½¯ä»¶</span><br><span class="line">1.mysql-proxy</span><br><span class="line">2.Atlas  360å†™çš„</span><br><span class="line">3.MyCat (é‡é‡çº§ï¼Œæ¯”è¾ƒå èµ„æº)</span><br></pre></td></tr></table></figure><p>Atlasç®€ä»‹<br>Atlasæ˜¯ç”± Qihoo 360å…¬å¸Webå¹³å°éƒ¨åŸºç¡€æ¶æ„å›¢é˜Ÿå¼€å‘ç»´æŠ¤çš„ä¸€ä¸ªåŸºäºMySQLåè®®çš„æ•°æ®ä¸­é—´å±‚é¡¹ç›®ã€‚å®ƒåœ¨MySQLå®˜æ–¹æ¨å‡ºçš„MySQL-Proxy 0.8.2ç‰ˆæœ¬çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹äº†å¤§é‡bugï¼Œæ·»åŠ äº†å¾ˆå¤šåŠŸèƒ½ç‰¹æ€§ã€‚å®ƒåœ¨MySQLå®˜æ–¹æ¨å‡ºçš„MySQL-Proxy 0.8.2ç‰ˆæœ¬çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹äº†å¤§é‡bugï¼Œæ·»åŠ äº†å¾ˆå¤šåŠŸèƒ½ç‰¹æ€§ã€‚</p><p>Atlasä¸»è¦åŠŸèƒ½<br>1.è¯»å†™åˆ†ç¦»<br>2.ä»åº“è´Ÿè½½å‡è¡¡<br>3.IPè¿‡æ»¤<br>4.è‡ªåŠ¨åˆ†è¡¨(å…¬å¸æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œè¡¨æ˜¯ä¼šè¢«é€»è¾‘æ‹†åˆ†çš„ï¼Œæ°´å¹³æ‹†åˆ†è¿˜åœ¨å‚ç›´æ‹†åˆ†)<br>5.DBAå¯å¹³æ»‘ä¸Šä¸‹çº¿DB<br>6.è‡ªåŠ¨æ‘˜é™¤å®•æœºçš„DB</p><p>Atlasç›¸å¯¹äºå®˜æ–¹MySQL-Proxyçš„ä¼˜åŠ¿</p><p>1.å°†ä¸»æµç¨‹ä¸­æ‰€æœ‰Luaä»£ç ç”¨Cé‡å†™ï¼ŒLuaä»…ç”¨äºç®¡ç†æ¥å£<br>2.é‡å†™ç½‘ç»œæ¨¡å‹ã€çº¿ç¨‹æ¨¡å‹<br>3.å®ç°äº†çœŸæ­£æ„ä¹‰ä¸Šçš„è¿æ¥æ± <br>4.ä¼˜åŒ–äº†é”æœºåˆ¶ï¼Œæ€§èƒ½æé«˜æ•°åå€</p><p><img src="../image/study_img/image-20240828155022313.png" alt="image-20240828155022313"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">é˜¿é‡Œäº‘ä¸èƒ½ç»‘å®šVIPï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¼¹æ€§å…¬ç½‘IP</span><br><span class="line"></span><br><span class="line">vim 1.per</span><br><span class="line"><span class="comment">#!/user/bin/env prel</span></span><br><span class="line">system (<span class="string">&#x27;echo 123&#x27;</span>);</span><br><span class="line">system (<span class="string">&#x27;ifconfig&#x27;</span>);</span><br><span class="line"></span><br><span class="line">chmode +x 1.prel</span><br></pre></td></tr></table></figure><h3 id="11ã€å®‰è£…é…ç½®Atlasï¼ˆç‹¬ç«‹çš„æœºå™¨ï¼‰">11ã€<strong>å®‰è£…é…ç½®Atlasï¼ˆç‹¬ç«‹çš„æœºå™¨ï¼‰</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹å½“å‰ä¸»ä»ä¿¡æ¯</span><br><span class="line">[root@lb01 binlog]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:125895) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line">2ã€ä¸‹è½½atlas</span><br><span class="line">[root@lb01 ~]# wget http://test.driverzeng.com/MySQL_plugins/Atlas-2.2.1.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">3ã€å®‰è£…atlas</span><br><span class="line">[root@lb01 ~]# rpm -ivh Atlas-2.2.1.el6.x86_64.rpm </span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹å®‰è£…å®Œçš„ç¨‹åºç›¸å…³æ–‡ä»¶</span><br><span class="line">[root@lb01 ~]# ll /usr/local/mysql-proxy/</span><br><span class="line">drwxr-xr-x 2 root root  75 Aug 28 15:57 bin       <span class="comment">#ç¨‹åºç›¸å…³å‘½ä»¤</span></span><br><span class="line">drwxr-xr-x 2 root root  22 Aug 28 15:57 conf      <span class="comment">#ç¨‹åºç›¸å…³é…ç½®</span></span><br><span class="line">drwxr-xr-x 3 root root 331 Aug 28 15:57 lib       <span class="comment">#ç¨‹åºç›¸å…³åˆ›å»º</span></span><br><span class="line">drwxr-xr-x 2 root root   6 Dec 17  2014 <span class="built_in">log</span>       <span class="comment">#ç¨‹åºç›¸å…³æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line">5ã€åŠ å¯†å¯†ç </span><br><span class="line">[root@lb01 ~]# <span class="built_in">cd</span> /usr/local/mysql-proxy/bin</span><br><span class="line">[root@lb01 bin]# ./encrypt 123</span><br><span class="line">3yb5jEku5h4=</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@lb01 ~]# vim /usr/local/mysql-proxy/conf/test.cnf </span><br><span class="line">[mysql-proxy]</span><br><span class="line"><span class="comment">#å¸¦#å·çš„ä¸ºéå¿…éœ€çš„é…ç½®é¡¹ç›®</span></span><br><span class="line"><span class="comment">#ç®¡ç†æ¥å£çš„ç”¨æˆ·å</span></span><br><span class="line">admin-username = user</span><br><span class="line"><span class="comment">#ç®¡ç†æ¥å£çš„å¯†ç </span></span><br><span class="line">admin-password = <span class="built_in">pwd</span></span><br><span class="line"><span class="comment">#Atlasåç«¯è¿æ¥çš„MySQLä¸»åº“çš„IPå’Œç«¯å£ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œç”¨é€—å·åˆ†éš”(å¯ä»¥å†™VIP,ä¹Ÿå¯ä»¥å†™ä¸»åº“IP)</span></span><br><span class="line">proxy-backend-addresses = 172.16.1.55:3306</span><br><span class="line"><span class="comment">#Atlasåç«¯è¿æ¥çš„MySQLä»åº“çš„IPå’Œç«¯å£ï¼Œ@åé¢çš„æ•°å­—ä»£è¡¨æƒé‡ï¼Œç”¨æ¥ä½œè´Ÿè½½å‡è¡¡ï¼Œè‹¥çœç•¥åˆ™é»˜è®¤ä¸º1ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œç”¨é€—å·åˆ†éš”</span></span><br><span class="line">proxy-read-only-backend-addresses = 172.16.1.52:3306,172.16.1.53:3306,172.16.1.54:3306</span><br><span class="line"><span class="comment">#ç”¨æˆ·åä¸å…¶å¯¹åº”çš„åŠ å¯†è¿‡çš„MySQLå¯†ç ï¼Œå¯†ç ä½¿ç”¨PREFIX/binç›®å½•ä¸‹çš„åŠ å¯†ç¨‹åºencryptåŠ å¯†ï¼Œä¸‹è¡Œçš„user1å’Œuser2ä¸ºç¤ºä¾‹ï¼Œå°†å…¶æ›¿æ¢ä¸ºä½ çš„MySQLçš„ç”¨æˆ·åå’ŒåŠ å¯†å¯†ç ï¼(æ­¤å¤„æœ€åä¸è¦ç”¨root,rottçš„æƒé™éå¸¸å¤§,è¯»å†™åˆ†ç¦»å¯¹ä»–ä¸èµ·ä½œç”¨)</span></span><br><span class="line">pwds = mha:3yb5jEku5h4=,root:3yb5jEku5h4=</span><br><span class="line"><span class="comment">#è®¾ç½®Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶ä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼ï¼Œè®¾ä¸ºfalseæ—¶ä¸ºå‰å°æ–¹å¼ï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue,trueåé¢ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</span></span><br><span class="line">daemon = <span class="literal">true</span></span><br><span class="line"><span class="comment">#è®¾ç½®Atlasçš„è¿è¡Œæ–¹å¼ï¼Œè®¾ä¸ºtrueæ—¶Atlasä¼šå¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªä¸ºmonitorï¼Œä¸€ä¸ªä¸ºworkerï¼Œmonitoråœ¨workeræ„å¤–é€€å‡ºåä¼šè‡ªåŠ¨å°†å…¶é‡å¯ï¼Œè®¾ä¸ºfalseæ—¶åªæœ‰workerï¼Œæ²¡æœ‰monitorï¼Œä¸€èˆ¬å¼€å‘è°ƒè¯•æ—¶è®¾ä¸ºfalseï¼Œçº¿ä¸Šè¿è¡Œæ—¶è®¾ä¸ºtrue,trueåé¢ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</span></span><br><span class="line">keepalive = <span class="literal">true</span></span><br><span class="line"><span class="comment">#å·¥ä½œçº¿ç¨‹æ•°ï¼Œå¯¹Atlasçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œå¯æ ¹æ®æƒ…å†µé€‚å½“è®¾ç½®</span></span><br><span class="line">event-threads = 8</span><br><span class="line"><span class="comment">#æ—¥å¿—çº§åˆ«ï¼Œåˆ†ä¸ºmessageã€warningã€criticalã€errorã€debugäº”ä¸ªçº§åˆ«</span></span><br><span class="line">log-level = error</span><br><span class="line"><span class="comment">#æ—¥å¿—å­˜æ”¾çš„è·¯å¾„</span></span><br><span class="line">log-path = /usr/local/mysql-proxy/log</span><br><span class="line"><span class="comment">#SQLæ—¥å¿—çš„å¼€å…³ï¼Œå¯è®¾ç½®ä¸ºOFFã€ONã€REALTIMEï¼ŒOFFä»£è¡¨ä¸è®°å½•SQLæ—¥å¿—ï¼ŒONä»£è¡¨è®°å½•SQLæ—¥å¿—ï¼ŒREALTIMEä»£è¡¨è®°å½•SQLæ—¥å¿—ä¸”å®æ—¶å†™å…¥ç£ç›˜ï¼Œé»˜è®¤ä¸ºOFF</span></span><br><span class="line">sql-log = ON</span><br><span class="line"><span class="comment">#æ…¢æ—¥å¿—è¾“å‡ºè®¾ç½®ã€‚å½“è®¾ç½®äº†è¯¥å‚æ•°æ—¶ï¼Œåˆ™æ—¥å¿—åªè¾“å‡ºæ‰§è¡Œæ—¶é—´è¶…è¿‡sql-log-slowï¼ˆå•ä½ï¼šms)çš„æ—¥å¿—è®°å½•ã€‚ä¸è®¾ç½®è¯¥å‚æ•°åˆ™è¾“å‡ºå…¨éƒ¨æ—¥å¿—ã€‚</span></span><br><span class="line">sql-log-slow = 10</span><br><span class="line"><span class="comment">#å®ä¾‹åç§°ï¼Œç”¨äºåŒä¸€å°æœºå™¨ä¸Šå¤šä¸ªAtlaså®ä¾‹é—´çš„åŒºåˆ†</span></span><br><span class="line">instance = <span class="built_in">test</span></span><br><span class="line"><span class="comment">#Atlasç›‘å¬çš„å·¥ä½œæ¥å£IPå’Œç«¯å£</span></span><br><span class="line">proxy-address = 0.0.0.0:3306</span><br><span class="line"><span class="comment">#Atlasç›‘å¬çš„ç®¡ç†æ¥å£IPå’Œç«¯å£</span></span><br><span class="line">admin-address = 0.0.0.0:2345</span><br><span class="line"><span class="comment">#åˆ†è¡¨è®¾ç½®ï¼Œæ­¤ä¾‹ä¸­personä¸ºåº“åï¼Œmtä¸ºè¡¨åï¼Œidä¸ºåˆ†è¡¨å­—æ®µï¼Œ3ä¸ºå­è¡¨æ•°é‡ï¼Œå¯è®¾ç½®å¤šé¡¹ï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸åˆ†è¡¨åˆ™ä¸éœ€è¦è®¾ç½®è¯¥é¡¹</span></span><br><span class="line"><span class="comment">#tables = person.mt.id.3</span></span><br><span class="line"><span class="comment">#é»˜è®¤å­—ç¬¦é›†ï¼Œè®¾ç½®è¯¥é¡¹åå®¢æˆ·ç«¯ä¸å†éœ€è¦æ‰§è¡ŒSET NAMESè¯­å¥</span></span><br><span class="line">charset = utf8</span><br><span class="line"><span class="comment">#å…è®¸è¿æ¥Atlasçš„å®¢æˆ·ç«¯çš„IPï¼Œå¯ä»¥æ˜¯ç²¾ç¡®IPï¼Œä¹Ÿå¯ä»¥æ˜¯IPæ®µï¼Œä»¥é€—å·åˆ†éš”ï¼Œè‹¥ä¸è®¾ç½®è¯¥é¡¹åˆ™å…è®¸æ‰€æœ‰IPè¿æ¥ï¼Œå¦åˆ™åªå…è®¸åˆ—è¡¨ä¸­çš„IPè¿æ¥</span></span><br><span class="line">client-ips = 127.0.0.1, 172.16.1</span><br><span class="line"><span class="comment">#Atlaså‰é¢æŒ‚æ¥çš„LVSçš„ç‰©ç†ç½‘å¡çš„IP(æ³¨æ„ä¸æ˜¯è™šIP)ï¼Œè‹¥æœ‰LVSä¸”è®¾ç½®äº†client-ipsåˆ™æ­¤é¡¹å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™å¯ä»¥ä¸è®¾ç½®</span></span><br><span class="line"><span class="comment">#lvs-ips = 192.168.1.1</span></span><br><span class="line"></span><br><span class="line">7ã€å¯åŠ¨</span><br><span class="line">[root@lb01 ~]# /usr/local/mysql-proxy/bin/mysql-proxyd <span class="built_in">test</span> start</span><br><span class="line">OK: MySQL-Proxy of <span class="built_in">test</span> is started</span><br><span class="line"></span><br><span class="line">8ã€åœæ­¢</span><br><span class="line">[root@lb01 ~]# /usr/local/mysql-proxy/bin/mysql-proxyd <span class="built_in">test</span> stop</span><br><span class="line">OK: MySQL-Proxy of <span class="built_in">test</span> is stopped</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">9ã€å¦‚æœæƒ³è¦è®©å®ä¾‹åä¸€æ ·ï¼Œå°±ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@lb01 ~]# vim /usr/local/mysql-proxy/conf/test.cnf </span><br><span class="line">42è¡Œï¼š instance = app1</span><br><span class="line">[root@lb01 binlog]# <span class="built_in">mv</span> /usr/local/mysql-proxy/conf/&#123;<span class="built_in">test</span>,app1&#125;.cnf</span><br><span class="line"></span><br><span class="line">10ã€å¯åŠ¨</span><br><span class="line">[root@lb01 binlog]# /usr/local/mysql-proxy/bin/mysql-proxyd app1 start</span><br><span class="line">OK: MySQL-Proxy of app1 is started</span><br><span class="line">[root@lb01 binlog]# netstat -lntup</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:2345            0.0.0.0:*               LISTEN      127355/mysql-proxy  </span><br><span class="line">tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      127355/mysql-proxy </span><br><span class="line"><span class="comment">#çœ‹åˆ°3306ç«¯å£ï¼Œ2345ç«¯å£èµ·æ¥äº†å°±ok</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=========================è®°å½•ä¸€ä¸‹</span><br><span class="line"><span class="comment">#ç®¡ç†æ¥å£çš„ç”¨æˆ·å</span></span><br><span class="line">admin-username = user</span><br><span class="line"><span class="comment">#ç®¡ç†æ¥å£çš„å¯†ç </span></span><br><span class="line">admin-password = <span class="built_in">pwd</span></span><br><span class="line"><span class="comment">#Atlasç›‘å¬çš„ç®¡ç†æ¥å£IPå’Œç«¯å£</span></span><br><span class="line">admin-address = 0.0.0.0:2345</span><br><span class="line">================================</span><br></pre></td></tr></table></figure><p>Atlasç®¡ç†æ¥å£ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1ã€è¿æ¥ç®¡ç†æ¥å£ç™»å½•</span><br><span class="line">[root@lb01 ~]# mysql -uuser -ppwd -h127.0.0.1 -P2345</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; show databases;</span><br><span class="line">ERROR 1105 (07000): use <span class="string">&#x27;SELECT * FROM help&#x27;</span> to see the supported commands</span><br><span class="line">MySQL [(none)]&gt; <span class="keyword">select</span> * from <span class="built_in">help</span>;</span><br><span class="line">+----------------------------+---------------------------------------------------------+</span><br><span class="line">| <span class="built_in">command</span>                    | description                                             |</span><br><span class="line">+----------------------------+---------------------------------------------------------+</span><br><span class="line">| SELECT * FROM <span class="built_in">help</span>         | shows this <span class="built_in">help</span>                                         |#æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">| SELECT * FROM backends     | lists the backends and their state                      |#æŸ¥çœ‹åç«¯æ•°æ®åº“</span><br><span class="line">| SET OFFLINE <span class="variable">$backend_id</span>    | <span class="built_in">set</span> offline 2;         | <span class="comment">#å¹³æ»‘ä¸‹çº¿æ•°æ®åº“</span></span><br><span class="line">| SET ONLINE <span class="variable">$backend_id</span>     | <span class="built_in">set</span> online 2;           |#å¹³æ»‘ä¸Šçº¿æ•°æ®åº“</span><br><span class="line">| ADD MASTER <span class="variable">$backend</span>        | example: <span class="string">&quot;add master 172.16.1.88:3306;&quot;</span>, ...               |#æ·»åŠ ä¸€ä¸ªä¸»åº“</span><br><span class="line">| ADD SLAVE <span class="variable">$backend</span>         | example: <span class="string">&quot;add slave 172.16.1.77:3306;&quot;</span>, ...                |#æ·»åŠ ä¸€ä¸ªä»åº“</span><br><span class="line">| REMOVE BACKEND <span class="variable">$backend_id</span> | example: <span class="string">&quot;remove backend 2;&quot;</span>, ...                        |#åˆ é™¤åç«¯æ•°æ®åº“</span><br><span class="line">| SELECT * FROM clients      | <span class="keyword">select</span> * from clients                                       |#æŸ¥çœ‹å¯è¿æ¥çš„å®¢æˆ·ç«¯</span><br><span class="line">| ADD CLIENT <span class="variable">$client</span>         | example: <span class="string">&quot;add client 10.0.0;&quot;</span>, ...                  |#æ·»åŠ ä¸€ä¸ªå…è®¸è¿æ¥çš„å®¢æˆ·ç«¯</span><br><span class="line">| REMOVE CLIENT <span class="variable">$client</span>      | example: <span class="string">&quot;remove client 10.0.0&quot;</span>, ...               |#åˆ é™¤å¯è¿æ¥çš„å®¢æˆ·ç«¯</span><br><span class="line">| SELECT * FROM pwds         | <span class="keyword">select</span> * from pwds;                                          |#æŸ¥çœ‹åœ¨é…ç½®æ–‡ä»¶é‡Œé¢è®¾ç½®çš„ç”¨æˆ·å’ŒåŠ å¯†çš„å¯†ç </span><br><span class="line">| ADD PWD <span class="variable">$pwd</span>               | example: <span class="string">&quot;add pwd user:raw_password&quot;</span>, ...               |#æ·»åŠ ä¸€ä¸ªæ˜æ–‡çš„å¯†ç ç”¨æˆ·</span><br><span class="line">| ADD ENPWD <span class="variable">$pwd</span>             | example: <span class="string">&quot;add enpwd user:encrypted_password&quot;</span>, ...       |#æ·»åŠ ä¸€ä¸ªåŠ å¯†åçš„ç”¨æˆ·å¯†ç </span><br><span class="line">| REMOVE PWD <span class="variable">$pwd</span>            | example: <span class="string">&quot;remove pwd user&quot;</span>, ...                         |#åˆ é™¤ç”¨æˆ·</span><br><span class="line">| SAVE CONFIG                | save the backends to config file                        |#ç›´æ¥ä¿æŒé…ç½®æ–‡ä»¶</span><br><span class="line">| SELECT VERSION             | display the version of Atlas                            |#æŸ¥çœ‹atlasç‰ˆæœ¬å·</span><br><span class="line">+----------------------------+---------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹åç«¯æ•°æ®åº“</span></span><br><span class="line">MySQL [(none)]&gt; SELECT * FROM backends;</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">| backend_ndx | address          | state | <span class="built_in">type</span> |</span><br><span class="line">+-------------+------------------+-------+------+</span><br><span class="line">|           1 | 172.16.1.51:3306 | up    | rw   |</span><br><span class="line">|           2 | 172.16.1.52:3306 | up    | ro   |</span><br><span class="line">|           3 | 172.16.1.53:3306 | up    | ro   |</span><br><span class="line">|           4 | 172.16.1.54:3306 | up    | ro   |</span><br><span class="line">+-------------+------------------+-------+------+</span><br></pre></td></tr></table></figure><p>é€šè¿‡altasä»£ç†å†™å…¥æ•°æ®</p><p><img src="../image/study_img/image-20240830223037955.png" alt="image-20240830223037955"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">atlasä½œä¸ºä»£ç†ï¼Œç»™(VIP)172.16.1.55ä»£ç†ï¼Œæ‰€æœ‰atlasçš„é…ç½®æ–‡ä»¶é‡Œé¢éœ€è¦æ”¹æˆä»£ç†çš„vip</span><br><span class="line"></span><br><span class="line">1ã€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†vipæ·»åŠ </span><br><span class="line">[root@lb01 ~]# vim /usr/local/mysql-proxy/conf/app1.cnf </span><br><span class="line">12è¡Œ  <span class="comment">#ä»£è¡¨ä¸»åº“æ°¸è¿œæ˜¯55</span></span><br><span class="line">proxy-backend-addresses = 172.16.1.55:3306</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###è¿™è¡Œæš‚æ—¶ä¸è¦ä¿®æ”¹</span></span><br><span class="line"><span class="comment">#è¿™ä¸€è¡Œï¼Œå‡å¦‚52å˜æˆä¸»åº“ï¼Œvipåœ¨52ä¸Šé¢ï¼Œå°±æŠŠ52çš„ipå»æ‰ï¼Œå½“51å˜æˆä»åº“ï¼Œå°±æŠŠ51çš„ipæ·»åŠ è¿›æ¥</span></span><br><span class="line">proxy-read-only-backend-addresses = 172.16.1.52:3306,172.16.1.53:3306,172.16.1.54:3306</span><br><span class="line"></span><br><span class="line">2ã€é‡å¯</span><br><span class="line">[root@lb01 ~]# /usr/local/mysql-proxy/bin/mysql-proxyd app1 restart</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€å°†å†™å…¥æ•°æ®çš„è„šæœ¬é‡Œé¢çš„ipä¿®æ”¹æˆä»£ç†ip</span><br><span class="line">[root@db01 ~]# vim insert.sh </span><br><span class="line">master_ip=172.16.1.5</span><br><span class="line"><span class="comment">#æ³¨æ„ï¼Œè„šæœ¬é‡Œé¢è¿œç¨‹ç™»å½•çš„ç”¨æˆ·ï¼Œå¿…é¡»åœ¨atlasé…ç½®æ–‡ä»¶é‡Œé¢å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±ä¸èƒ½å†™å…¥æ•°æ®</span></span><br><span class="line"></span><br><span class="line">4ã€æ£€æŸ¥ä¸»ä»çŠ¶æ€ï¼Œç°åœ¨ä¸»åº“æ˜¯51</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:125895) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line">5ã€æ‰§è¡Œè„šæœ¬ï¼ŒæŸ¥çœ‹æ˜¯å¦èƒ½å¤Ÿå†™å…¥æ•°æ®ï¼Œå¹¶æ£€æŸ¥æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|       28 |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€ä¸ªæœºå™¨å®‰è£…atlasï¼Œå°±è¦åšatlasçš„é«˜å¯ç”¨ï¼Œä¸‡ä¸€atlaså®•æœºäº†ï¼Œä¸»åº“ï¼Œä»åº“å°±ä¸èƒ½å†™æ•°æ®äº†ï¼Œè¿˜ä¸å¦‚æ¯ä¸ªæœºå™¨éƒ½å®‰è£…ï¼Œæ‰€ä»¥ä¸‹é¢ä¼šéƒ¨ç½²å¤šå°æœºå™¨éƒ¨ç½²atlas</span></span><br></pre></td></tr></table></figure><h3 id="12ã€å¤šå°æœºå™¨éƒ¨ç½²Atlas">12ã€<strong>å¤šå°æœºå™¨éƒ¨ç½²Atlas</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">1ã€åœæ­¢lb01æœºå™¨ä¸Šé¢çš„atlasæœåŠ¡</span><br><span class="line">[root@lb01 ~]#  /usr/local/mysql-proxy/bin/mysql-proxyd app1 stop</span><br><span class="line"></span><br><span class="line">2ã€å°†atlasåŒ…ã€é…ç½®æ–‡ä»¶å‘é€ç»™å…¶ä»–4å°æ•°æ®åº“</span><br><span class="line">[root@lb01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 51 52 53 54;<span class="keyword">do</span> scp Atlas-2.2.1.el6.x86_64.rpm 172.16.1.<span class="variable">$&#123;i&#125;</span>:/root;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@lb01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 51 52 53 54;<span class="keyword">do</span> scp /usr/local/mysql-proxy/conf/app1.cnf 172.16.1.<span class="variable">$&#123;i&#125;</span>:/usr/local/mysql-proxy/conf/;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">3ã€4ä¸ªåº“å®‰è£…atlas</span><br><span class="line">[root@lb01 ~]# <span class="keyword">for</span> i <span class="keyword">in</span> 51 52 53 54;<span class="keyword">do</span> ssh root@172.16.1.<span class="variable">$&#123;i&#125;</span> <span class="string">&quot;rpm -ivh Atlas-2.2.1.el6.x86_64.rpm&quot;</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹é…ç½®æ–‡ä»¶æ˜¯å¦æ”¶åˆ°</span><br><span class="line">[root@db01 ~]# ll /usr/local/mysql-proxy/conf/</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 2832 Aug 31 14:30 app1.cnf</span><br><span class="line">-rw-r--r-- 1 root root 2810 Dec 17  2014 test.cnf</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# rpm -aq |grep Atlas</span><br><span class="line">Atlas-2.2.1-1.x86_64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€ç›®å‰3306ç«¯å£æ•°æ®åº“åœ¨è¿è¡Œï¼Œæ‰€ä»¥æ”¹mysqlç«¯å£ä¸å¤ªè¡Œï¼Œæ‰€ä»¥å…ˆæ›´æ”¹atlasç«¯å£ï¼Œæ”¹æˆ3307</span><br><span class="line">ï¼Œå¦‚æœæœ‰ç”Ÿäº§ç¯å¢ƒï¼Œè¿™ä¸ªç«¯å£ä¼šæå‰é…ç½®å¥½ï¼Œä»–å°±æ˜¯3306ï¼Œæ”¹æ•°æ®åº“çš„ç«¯å£å°±å¥½</span><br><span class="line">[root@db01 ~]# vim /usr/local/mysql-proxy/conf/app1.cnf </span><br><span class="line"><span class="comment">#Atlasç›‘å¬çš„å·¥ä½œæ¥å£IPå’Œç«¯å£    45è¡Œ</span></span><br><span class="line">proxy-address = 0.0.0.0:3307</span><br><span class="line"></span><br><span class="line">sed -i  <span class="string">&#x27;s#proxy-address = 0.0.0.0:3306#proxy-address = 0.0.0.0:3307#g&#x27;</span>  /usr/local/mysql-proxy/conf/app1.cnf  </span><br><span class="line"></span><br><span class="line">5ã€4å°æ•°æ®åº“å¯åŠ¨atlas,å¹¶ä¸”æ£€æŸ¥ç«¯å£ 2345  3307ç«¯å£</span><br><span class="line">/usr/local/mysql-proxy/bin/mysql-proxyd app1 start</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# netstat -lntup</span><br><span class="line"></span><br><span class="line">6ã€atlaséœ€è¦ä½¿ç”¨systemdç®¡ç†ï¼Œä¸ç„¶æ²¡æ³•åŠ å…¥å¼€æœºè‡ªå¯åŠ¨</span><br><span class="line"></span><br><span class="line">7ã€æ›´æ”¹ç¨‹åºå†™æ•°æ®çš„è„šæœ¬ï¼Œè¿˜å¾—åŠ å‚æ•°-P3307,å¾€atlasé‡Œé¢å†™æ•°æ®</span><br><span class="line">[root@db01 ~]# vim insert.sh</span><br><span class="line"><span class="comment">#ç”¨vipï¼Œè¿˜æ˜¯å¾€ä¸»åº“çš„altlasé‡Œé¢å†™æ•°æ®ï¼Œå³ä¾¿æ˜¯vipæ¼‚ç§»äº†ï¼Œè¿˜æ˜¯å¾€atlasé‡Œé¢å†™ï¼Œæ¯”å¦‚è¯´51æŒ‚äº†ï¼Œvipæ¼‚åˆ°53ï¼Œè¿˜æ˜¯å¾€55çš„3307é‡Œé¢å†™æ•°æ®ï¼Œè¿™æ ·å°±ä¸è¦ä½¿ç”¨keepalivedç»™atlasåšé«˜å¯ç”¨äº†</span></span><br><span class="line">master_ip=172.16.1.55</span><br><span class="line">mysql_cli=<span class="string">&quot;mysql -uroot -p123 -h<span class="variable">$&#123;master_ip&#125;</span> -P3307&quot;</span></span><br><span class="line"></span><br><span class="line">8ã€æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh      </span><br><span class="line"><span class="comment">#å¯ä»¥å¾€é‡Œé¢å†™æ•°æ®</span></span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br></pre></td></tr></table></figure><p>atlasç»“åˆMHAè„šæœ¬ä½¿ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ£€æŸ¥MHAæ˜¯å¦å¯åŠ¨</span><br><span class="line">[root@lb01 ~]# masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:125895) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line"><span class="comment">#MHAåˆ‡æ¢å®Œäº†ï¼Œatlasé…ç½®æ–‡ä»¶é‡Œé¢çš„ä»åº“ipä¹Ÿè¦æ”¹ï¼Œæœ‰ä¸€ä¸ªhmaçš„åˆ‡æ¢è„šæœ¬ï¼Œå•¥æ—¶å€™æ¼‚VIPï¼Œå°±å•¥æ—¶å€™æ”¹atlasé…ç½®æ–‡ä»¶ï¼Œè€Œä¸”4å°atlasé…ç½®æ–‡ä»¶è¦ä¸€è‡´</span></span><br><span class="line"></span><br><span class="line">2ã€åœ¨ä¸»ä»æœåŠ¡å™¨ä¸Šç¼–å†™è„šæœ¬</span><br><span class="line">[root@db01 ~]# vim atlas_mha.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">mha_log=<span class="string">&quot;/etc/mha/logs/manager.log&quot;</span></span><br><span class="line"><span class="comment">#å®•æœºçš„master</span></span><br><span class="line">down_master=$(grep <span class="string">&#x27;(current master)&#x27;</span> <span class="variable">$&#123;mha_log&#125;</span>|awk -F <span class="string">&#x27;(&#x27;</span>  <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|<span class="built_in">tail</span> -1)</span><br><span class="line"><span class="comment">#down_master=$(sed -nr &#x27;s#(.*)\(.*\) \(current master\)$#\1#gp&#x27; $&#123;mha_log&#125;|tail -1)</span></span><br><span class="line"><span class="comment">#æ–°çš„master</span></span><br><span class="line">new_master=$(grep <span class="string">&#x27;(new master)&#x27;</span> <span class="variable">$&#123;mha_log&#125;</span>|awk -F <span class="string">&#x27;(&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>|<span class="built_in">tail</span> -1)</span><br><span class="line"><span class="comment">#new_master=$(sed -nr &#x27;s#(.*)\(.*\) \(new master\)$#\1#gp&#x27; $&#123;mha_log&#125;|tail -1)</span></span><br><span class="line"><span class="comment">#æ“ä½œç®¡ç†æ¥å£   #mysql -uuser -ppwd  -P2345 -h172.16.1.51</span></span><br><span class="line"><span class="comment">#atlasé…ç½®æ–‡ä»¶ç®¡ç†æ¥å£çš„ç”¨æˆ·å</span></span><br><span class="line">atlas_user=<span class="string">&#x27;user&#x27;</span></span><br><span class="line"><span class="comment">#atlasé…ç½®æ–‡ä»¶ç®¡ç†æ¥å£çš„å¯†ç </span></span><br><span class="line">atlas_password=<span class="string">&#x27;pwd&#x27;</span></span><br><span class="line"><span class="comment">##atlasé…ç½®æ–‡ä»¶ç®¡ç†æ¥å£çš„ç«¯å£</span></span><br><span class="line">atlas_port=<span class="string">&#x27;2345&#x27;</span></span><br><span class="line">atlas_conn=<span class="string">&#x27;mysql -u$&#123;atlas_user&#125; -p$&#123;atlas_password&#125; -P$&#123;atlas_port&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è·å–down_masterçš„backend_id,51ä¸»åº“è¦åšçš„æ“ä½œæ˜¯åˆ é™¤è¢«æå‡ä¸ºä¸»åº“çš„new_master</span></span><br><span class="line"><span class="keyword">for</span> atlas_ip <span class="keyword">in</span> 51 52 53 54;<span class="keyword">do</span></span><br><span class="line">      down_master_backend_id=$(<span class="variable">$&#123;atlas_conn&#125;</span> -h172.16.1.<span class="variable">$&#123;atlas_ip&#125;</span> -e <span class="string">&#x27;select * from backends&#x27;</span>| grep <span class="string">&quot;<span class="variable">$&#123;new_master&#125;</span>&quot;</span>|awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">      <span class="variable">$&#123;atlas_conn&#125;</span> -h172.16.1.<span class="variable">$&#123;atlas_ip&#125;</span> -e <span class="string">&#x27;remove backend $&#123;down_master_backend_id&#125;&#x27;</span></span><br><span class="line">      <span class="variable">$&#123;atlas_conn&#125;</span> -h172.16.1.<span class="variable">$&#123;atlas_ip&#125;</span> -e <span class="string">&#x27;add slave $&#123;down_master&#125;:3306;save config&#x27;</span></span><br><span class="line"><span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line">3ã€è„šæœ¬ç»“åˆMHAä¸€èµ·ä½¿ç”¨ï¼Œä¿®æ”¹MHAvipæ¼‚ç§»çš„è„šæœ¬  åœ¨mhaæœºå™¨ä¸Šä¿®æ”¹  </span><br><span class="line">[root@lb01 ~]# vim /etc/mha/app1/master_ip_failover</span><br><span class="line">sub <span class="function"><span class="title">start_vip</span></span>() &#123;</span><br><span class="line">    `ssh <span class="variable">$ssh_user</span>\@<span class="variable">$new_master_host</span> \&quot; <span class="variable">$ssh_start_vip</span> \&quot;`;</span><br><span class="line">    `/bin/sh -x \&quot;/root/atlas_mha.sh\&quot;`;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#-x å°†è„šæœ¬çš„æ‰§è¡Œè¿‡ç¨‹è¾“å‡ºåˆ°æ—¥å¿—é‡Œé¢</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ£€æŸ¥ä¸»ä»ï¼Œå¹¶ä¸”æ£€æŸ¥vipåœ¨ä¸»åº“ä¸Šé¢</span><br><span class="line">[root@lb01 ~]#  masterha_check_status --conf=/etc/mha/app1.cnf</span><br><span class="line">app1 (pid:125895) is running(0:PING_OK), master:172.16.1.51</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# ip a</span><br><span class="line"></span><br><span class="line">2ã€æ‰§è¡Œå†™å…¥æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh</span><br><span class="line"></span><br><span class="line">3ã€å…ˆå®æ—¶è¿½è¸ªæ—¥å¿—</span><br><span class="line">[root@lb01 ~]# tailf  /etc/mha/logs/manager.log</span><br><span class="line"></span><br><span class="line">4ã€å‡†å¤‡åˆ‡æ¢ï¼Œåœæ­¢ä¸»åº“æ•°æ®åº“</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld stop</span><br><span class="line"> change master to</span><br><span class="line">    master_host=<span class="string">&#x27;172.16.1.52&#x27;</span>,</span><br><span class="line">    master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">    master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    master_auto_position=1;</span><br><span class="line"> start slave;show slave status\G</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> STOP SLAVE;RESET SLAVE ALL;change master to</span><br><span class="line">    master_host=<span class="string">&#x27;172.16.1.52&#x27;</span>,</span><br><span class="line">    master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">    master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">    master_auto_position=1;start slave;show slave status\G</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•11ã€mysqlä¸»ä»å¤åˆ¶</title>
      <link href="/posts/106fae33.html"/>
      <url>/posts/106fae33.html</url>
      
        <content type="html"><![CDATA[<h3 id="1ã€-mysqlä¸»ä»å¤åˆ¶">1ã€ mysqlä¸»ä»å¤åˆ¶</h3><p><strong>ä¸ºä»€ä¹ˆè¦åšä¸»ä»å¤åˆ¶</strong><br>1ã€ä¸ºäº†åšé«˜å¯ç”¨<br>2ã€ä¸ºäº†è§£å†³MySQLçš„å•ç‚¹æ•…éšœ<br>3ã€åˆ†æ‘Šä¸»åº“çš„å‹åŠ›<br>4ã€åšå¤‡ä»½çš„æƒ…å†µ(å»¶è¿Ÿä»åº“)</p><p><strong>Mysqlä¸»ä»å¤åˆ¶åŸç†</strong></p><p><img src="../image/study_img/image-20240823161157907.png" alt="image-20240823161157907"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">åŒæ­¥ï¼šIOçº¿ç¨‹æ‹¿åˆ°æ•°æ®äº¤ç»™SQLçº¿ç¨‹ï¼Œsqlçº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼ŒIOçº¿ç¨‹å†å»è¦ä¸‹ä¸€æ¡æ•°æ®(ç±»ä¼¼äºæˆ‘ç»™ä½ ä¼ æ–‡ä»¶ï¼Œæˆ‘è¦ç­‰ä½ æ¥æ”¶å®Œ)</span><br><span class="line">å¼‚æ­¥ï¼šIOçº¿ç¨‹æŠŠæ•°æ®æ”¾åˆ°ç¼“å­˜é‡Œ,ä¸ç®¡SQLçº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œï¼ŒIOçº¿ç¨‹éƒ½ä¼šå»è¦ä¸‹ä¸€æ¡æ•°æ®</span><br><span class="line"></span><br><span class="line">å¦‚æœçœ‹åˆ°SQLæ˜¾ç¤ºNO,å¯èƒ½æ˜¯æ•°æ®çš„é—®é¢˜ï¼Œå¯èƒ½ä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">master.info å‚¨å­˜ä¸»åº“ä¿¡æ¯çš„æ–‡ä»¶</span><br><span class="line">relay-log  ä¸­ç»§æ—¥å¿—ï¼Œä¹Ÿå«å·®å¼‚æ—¥å¿—(ä¸»åº“é‡Œæœ‰ï¼Œä»åº“é‡Œæ²¡æœ‰ï¼Œè¿˜éœ€è¦ä»åº“æ‰§è¡Œçš„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“å’Œä»åº“çš„æ•°æ®å·®å¼‚çš„)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åŸç†</span></span><br><span class="line">1ï¼‰é€šè¿‡change master toè¯­å¥å‘Šè¯‰ä»åº“ä¸»åº“çš„ipï¼Œportï¼Œuserï¼Œpasswordï¼Œfileï¼Œpos</span><br><span class="line">2ï¼‰ä»åº“é€šè¿‡start slaveå‘½ä»¤å¼€å¯å¤åˆ¶å¿…è¦çš„IOçº¿ç¨‹å’ŒSQLçº¿ç¨‹</span><br><span class="line">3ï¼‰ä»åº“é€šè¿‡IOçº¿ç¨‹æ‹¿ç€change master toç”¨æˆ·å¯†ç ç›¸å…³ä¿¡æ¯ï¼Œè¿æ¥ä¸»åº“ï¼ŒéªŒè¯åˆæ³•æ€§</span><br><span class="line">4ï¼‰ä»åº“è¿æ¥æˆåŠŸåï¼Œä¼šæ ¹æ®binlogçš„posé—®ä¸»åº“ï¼Œæœ‰æ²¡æœ‰æ¯”è¿™ä¸ªæ›´æ–°çš„</span><br><span class="line">5ï¼‰ä¸»åº“æ¥æ”¶åˆ°ä»åº“è¯·æ±‚åï¼Œæ¯”è¾ƒä¸€ä¸‹binlogä¿¡æ¯ï¼Œå¦‚æœæœ‰å°±å°†æœ€æ–°æ•°æ®é€šè¿‡dumpçº¿ç¨‹ç»™ä»åº“IOçº¿ç¨‹</span><br><span class="line">6ï¼‰ä»åº“é€šè¿‡IOçº¿ç¨‹æ¥æ”¶åˆ°ä¸»åº“å‘æ¥çš„binlogäº‹ä»¶ï¼Œå­˜å‚¨åˆ°TCP/IPç¼“å­˜ä¸­ï¼Œå¹¶è¿”å›ACKæ›´æ–°master.info</span><br><span class="line">7ï¼‰å°†TCP/IPç¼“å­˜ä¸­çš„å†…å®¹å­˜åˆ°relay-logä¸­</span><br><span class="line">8ï¼‰SQLçº¿ç¨‹è¯»å–relay-log.infoï¼Œè¯»å–åˆ°ä¸Šæ¬¡å·²ç»æ‰§è¡Œè¿‡çš„relay-logä½ç½®ç‚¹ï¼Œç»§ç»­æ‰§è¡Œåç»­çš„relay-logæ—¥å¿—ï¼Œæ‰§è¡Œå®Œæˆåï¼Œæ›´æ–°relay-log.info</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_passwd=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=446</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQLä¸»ä»å¤åˆ¶å’Œ3ä¸ªçº¿ç¨‹ï¼Œ4ä¸ªæ–‡ä»¶æœ‰å…³ç³»</span></span><br><span class="line">1ã€#3ä¸ªçº¿ç¨‹ï¼š</span><br><span class="line">      - ä»åº“ä¸Šçš„IOçº¿ç¨‹ï¼š(å’Œä¸»åº“å»ºç«‹è¿æ¥ï¼Œæ¥æ”¶ä¸»åº“çš„æ•°æ®)</span><br><span class="line">      - ä»åº“ä¸Šçš„SQLçº¿ç¨‹ï¼š(å°†IOçº¿ç¨‹å–å‡ºçš„æ•°æ®åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä¸€éï¼Œä»–ä¸¤ä¹‹å‰æ˜¯å¼‚æ­¥çš„)</span><br><span class="line">      </span><br><span class="line">      - ä¸»åº“ä¸Šçš„dumpçº¿ç¨‹ï¼š(æ¥å—IOçº¿ç¨‹çš„è¯·æ±‚ï¼Œä»binlogä¸­å–å‡ºæ•°æ®è¿”å›ç»™IOçº¿ç¨‹)</span><br><span class="line">      </span><br><span class="line">2ã€#4ä¸ªæ–‡ä»¶</span><br><span class="line">      - ä»åº“ï¼šmaster.info(å­˜ä¸Šä¸€æ¬¡ä¸»åº“binlogçš„åå­—å’Œä½ç½®ç‚¹)ï¼šæ‰§è¡Œstart slaveä¼šæŠŠä¸»åº“ä¿¡æ¯è®°å½•åœ¨master.info,æ–¹ä¾¿ä¸‹ä¸€æ¬¡å–æ•°æ®</span><br><span class="line">      - ä»åº“ï¼šrelay-log.infoï¼š(è®°å½•sqlè¯­å¥ä¸Šä¸€å›æ‰§è¡Œåˆ°ä¸­ç»§æ—¥å¿—çš„ä½ç½®ç‚¹ï¼Œä¸‹å›å†æ‰§è¡Œçš„æ—¶å€™å°±ä»è¿™ä¸ªä½ç½®ç‚¹å¾€åæ‰§è¡Œ)</span><br><span class="line">      - ä»åº“ï¼šrelay-logï¼š(å­˜å‚¨binlogä¸­æ–°å¢çš„æ•°æ®ï¼ˆä¸æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼‰å¤åˆ¶SQLçº¿ç¨‹åœ¨æ‰§è¡Œå®Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰äº‹ä»¶å¹¶ä¸”ä¸å†éœ€è¦å®ƒåï¼Œä¼šè‡ªåŠ¨åˆ é™¤æ¯ä¸ªä¸­ç»§æ—¥å¿—æ–‡ä»¶)</span><br><span class="line">      </span><br><span class="line">      - ä¸»åº“ï¼šbin-log(äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ä¸»åº“æ‰€æœ‰å¯¹æ•°æ®è¡¨å‘ç”Ÿå˜åŒ–çš„è¯­å¥)</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line"><span class="comment">#é—®é¢˜ï¼šrelay-logä¼šä¸€ç›´å­˜åœ¨å—,å¦‚æœä¸æ˜¯ï¼Œä¼šå­˜åœ¨å¤šä¹…ï¼Ÿ</span></span><br><span class="line">å®˜ç½‘ç»™çš„ç­”æ¡ˆï¼š</span><br><span class="line">https://dev.mysql.com/doc/refman/5.7/en/replica-logs-relaylog.html</span><br><span class="line"></span><br><span class="line">The replication SQL thread automatically deletes each relay <span class="built_in">log</span> file after it has executed all events <span class="keyword">in</span> the file and no longer needs it. There is no explicit mechanism <span class="keyword">for</span> deleting relay logs because the replication SQL thread takes care of doing so. However, FLUSH LOGS rotates relay logs, <span class="built_in">which</span> influences when the replication SQL thread deletes them.</span><br><span class="line">(å¤åˆ¶SQLçº¿ç¨‹åœ¨æ‰§è¡Œå®Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰äº‹ä»¶å¹¶ä¸”ä¸å†éœ€è¦å®ƒåï¼Œä¼šè‡ªåŠ¨åˆ é™¤æ¯ä¸ªä¸­ç»§æ—¥å¿—æ–‡ä»¶ã€‚æ²¡æœ‰æ˜ç¡®çš„æœºåˆ¶æ¥åˆ é™¤ä¸­ç»§æ—¥å¿—ï¼Œå› ä¸ºå¤åˆ¶SQLçº¿ç¨‹ä¼šè´Ÿè´£è¿™æ ·åšã€‚ä½†æ˜¯ï¼ŒFLUSH logsä¼šè½®æ¢ä¸­ç»§æ—¥å¿—ï¼Œè¿™ä¼šå½±å“å¤åˆ¶SQLçº¿ç¨‹ä½•æ—¶åˆ é™¤å®ƒä»¬ã€‚)</span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´SQLçº¿ç¨‹æ‰§è¡Œå®Œrelay-logçš„æ‰€æœ‰äº‹ä»¶ä¹‹åï¼Œä¼šå®šæœŸçš„åˆ é™¤relay-logï¼Œä½†æ˜¯ä¸çŸ¥é“å¤šä¹…åˆ é™¤ä¸€æ¬¡ï¼Œå®˜æ–¹æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„æ—¶é—´</span><br><span class="line"></span><br><span class="line">æ¶‰åŠåˆ°3ä¸ªçº¿ç¨‹ 4ä¸ªæ–‡ä»¶</span><br><span class="line"><span class="comment">#ä»ï¼šmaster inifo  </span></span><br><span class="line">relay.loh  </span><br><span class="line">relayï¼šè®°å½•sqlè¯­å¥ä¸Šä¸€å›æ‰§è¡Œåˆ°ä¸­ç»§æ—¥å¿—çš„é‚£ä¸ªä½ç½®ç‚¹äº†</span><br></pre></td></tr></table></figure><p><strong>éƒ¨ç½²ä¼ ç»Ÿä¸»ä»å¤åˆ¶</strong></p><p>ç¯å¢ƒå‡†å¤‡</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th><th>åº”ç”¨</th></tr></thead><tbody><tr><td>db01</td><td>10.0.0.51  /  172.16.1.51</td><td><strong>ä¸»åº“</strong></td><td>mysql 5.6</td></tr><tr><td>db02</td><td>10.0.0.52  /  172.16.1.52</td><td>ä»åº“</td><td>mysql 5.6</td></tr><tr><td>db03</td><td>10.0.0.53  /  172.16.1.53</td><td>ä»åº“</td><td>mysql 5.6</td></tr><tr><td>db04</td><td>10.0.0.54 /  172.16.1.54</td><td>ä»åº“</td><td>mysql 5.6</td></tr></tbody></table><p>1ã€ä¸»åº“æ“ä½œdb01</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¸»åº“æ“ä½œ</span><br><span class="line"><span class="comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">skip-name-resolve</span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db04 ~]#  /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#åˆ›å»ºä¸€ä¸ªä¸»ä»å¤åˆ¶çš„ç”¨æˆ·</span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">4ã€#æŸ¥çœ‹binlog(master)çš„ä¿¡æ¯</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File             | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000016 |      327 |</span><br><span class="line">+------------------+----------+</span><br></pre></td></tr></table></figure><p>2ã€ä»åº“æ“ä½œ   å…ˆé…ç½®db02  db03</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db03 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">ä»åº“binlogä¸éœ€è¦å¼€å¯</span><br><span class="line"><span class="comment">#log_bin=mysql-bin</span></span><br><span class="line"><span class="comment">#server_idä¸ä¸€æ ·</span></span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">skip-name-resolve</span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db03 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#æ‰§è¡Œmasterè¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=327,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">4ã€#å¼€å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line">5ã€#æŸ¥çœ‹ä¸»ä»å¤åˆ¶çŠ¶æ€</span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000016</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">            </span><br><span class="line">           <span class="comment">#2ä¸ªyeså°±OK</span></span><br></pre></td></tr></table></figure><p><strong>ä¸»ä»å¤åˆ¶æ•…éšœå¤„ç†</strong></p><p>IOçº¿ç¨‹æ•…éšœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¤§æ¦‚ç‡æ˜¯è¿æ¥å‡ºé—®é¢˜</span></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=327,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">1ã€#æ£€æŸ¥IPæ˜¯å¦æ­£å¸¸(å’Œchange masterçš„IPä¸€æ ·ï¼Œä¸è¦å†™å¤–ç½‘IP)</span><br><span class="line">ping 172.16.1.51</span><br><span class="line"></span><br><span class="line">2ã€#æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£å¸¸(å’Œchange masterçš„IPä¸€æ ·ï¼Œä¸è¦å†™å¤–ç½‘IP)</span><br><span class="line">telent 172.16.1.51 3306</span><br><span class="line">ç«¯å£ä¸é€šï¼š</span><br><span class="line">      - é˜²ç«å¢™ selinux</span><br><span class="line">      - æœåŠ¡æ²¡æœ‰èµ·</span><br><span class="line">      - æ²¡æœ‰åˆ›å»ºè¿œç¨‹è¿æ¥çš„ç”¨æˆ·</span><br><span class="line">      </span><br><span class="line">3ã€#æ£€æµ‹ç”¨æˆ·åå’Œå¯†ç   ä»åº“ç”¨repç”¨æˆ·è¿æ¥åˆ°ä¸»åº“</span><br><span class="line">[root@db03 ~]# mysql -urep -p123 -h172.16.1.51</span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æ£€æŸ¥binglogåå­—å’Œä½ç½®ç‚¹æ˜¯å¦æ­£ç¡®(ä½ç½®ç‚¹å¯ä»¥å°‘ï¼Œä¸èƒ½å¤šï¼Œå¤šäº†æ‰¾ä¸åˆ°é‚£ä¸ªç‚¹)</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+-</span><br><span class="line">| File             | Position | </span><br><span class="line">+------------------+----------+-</span><br><span class="line">| mysql-bin.000016 |    32858 | </span><br><span class="line">+------------------+----------+-</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240823175441790.png" alt="image-20240823175441790"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠ¥é”™åŸå› ï¼š</span></span><br><span class="line">ä¸»åº“å’Œä»åº“çš„server_idç›¸åŒ</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240823175520693.png" alt="image-20240823175520693"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠ¥é”™åŸå› ï¼š</span></span><br><span class="line">ä¸»åº“å’Œä»åº“çš„UUIDç›¸åŒ</span><br></pre></td></tr></table></figure><p>SQLçº¿ç¨‹æ•…éšœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ¹æœ¬åŸå› ï¼šä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´</span></span><br><span class="line"></span><br><span class="line">1ã€ä¸»åº“çš„æ•°æ®æ¯”ä»åº“å¤š(ä¸»åº“é‡Œé¢æœ‰ä¸€ä¸ªjiaoyiè¡¨ï¼Œä»åº“æ²¡æœ‰ï¼Œæˆ‘åœ¨ä¸»åº“é‡Œé¢çš„jiaoyiè¡¨æ’å…¥æ•°æ®ï¼Œä»åº“SQLçº¿ç¨‹å°±ä¼šæŠ¥é”™)</span><br><span class="line"></span><br><span class="line">2ã€ä»åº“çš„æ•°æ®æ¯”ä¸»åº“å¤š(ä»åº“å·²ç»å­˜åœ¨ä¸€ä¸ªtabl1è¡¨ï¼Œå½“ä¸»åº“åˆ›å»ºtable1è¡¨æ—¶ï¼Œä»åº“QLçº¿ç¨‹å°±ä¼šæŠ¥é”™)</span><br></pre></td></tr></table></figure><p>1ã€ä¸»åº“çš„æ•°æ®æ¯”ä»åº“å¤š  æŠ¥é”™</p><p><img src="../image/study_img/image-20240823160331343.png" alt="image-20240823160331343"></p><p>2ã€ä»åº“çš„æ•°æ®æ¯”ä¸»åº“å¤š  æŠ¥é”™</p><p><img src="../image/study_img/image-20240823180522184.png" alt="image-20240823180522184"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§£å†³æ–¹æ³•ï¼š</span></span><br><span class="line"></span><br><span class="line">æ–¹æ³•1ï¼š:ä¸æ¨è  ä¸´æ—¶çš„è§£å†³æ–¹æ³•  </span><br><span class="line">(è·³è¿‡è¿™ä¸ªæŠ¥é”™çš„æŒ‡é’ˆ)</span><br><span class="line"><span class="comment"># ä¸´æ—¶åœæ­¢åŒæ­¥</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line"><span class="comment"># å°†åŒæ­¥æŒ‡é’ˆå‘ä¸‹ç§»åŠ¨ä¸€ä¸ªï¼ˆå¯é‡å¤æ“ä½œï¼‰</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global sql_slave_skip_counter=1;</span><br><span class="line"><span class="comment"># å¼€å¯åŒæ­¥</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ–¹æ³•2ï¼šä¸æ¨è  ä¸´æ—¶çš„è§£å†³æ–¹æ³•</span><br><span class="line">(åœ¨mysqlæ ‡ç­¾ä¸»æ·»åŠ è·³è¿‡é”™è¯¯ä»£ç çš„é…ç½®)</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line"><span class="comment">#åœ¨[mysqld]æ ‡ç­¾ä¸‹æ·»åŠ ä»¥ä¸‹å‚æ•°</span></span><br><span class="line">slave-skip-errors=1032,1062,1007,1146</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½†æ˜¯ä»¥ä¸Šæ“ä½œéƒ½æ˜¯æœ‰é£é™©å­˜åœ¨çš„,å¯¼è‡´ä»åº“æ•°æ®ç¼ºå¤±ï¼Œè¿™ä¸ªæ•°æ®ä»åº“é‡Œé¢æ°¸è¿œæ²¡æœ‰ï¼ŒæŸ¥ä¸åˆ°æ•°æ®ï¼Œä»–è·³è¿‡è¿™ä¸ªé”™è¯¯ï¼Œé…ç½®æ–‡ä»¶é‡Œé¢å†™äº†ï¼Œæ•°æ®ä¸å¤åˆ¶,è¿™ä¸ªåªæ˜¯è¡¨é¢ä¸Šçœ‹åˆ°yes,å®é™…ä¸Šæ²¡æœ‰æ„ä¹‰ï¼Œè·³è¿‡ç›¸å½“äºä»åº“å°‘æ•°æ®</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°æ®ä¸ä¸€è‡´çš„åŸå› å¯èƒ½å¦‚ä¸‹ï¼š</span></span><br><span class="line">1ã€åœ¨ç”Ÿäº§ä¸­è¿è¡Œå·²æœ‰çš„æ•°æ®åº“çš„ä¸»åº“ï¼Œæ–°ä»åº“ç›´æ¥ä»å½“å‰ä½ç½®ç‚¹å¤åˆ¶</span><br><span class="line">è§£å†³æ–¹æ³•ï¼šç»™ä¸»åº“å…¨å¤‡ï¼Œå¯¼å…¥åˆ°æ–°ä»åº“ä¸­ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</span><br><span class="line"></span><br><span class="line">2ã€ç›´æ¥åœ¨ä»åº“ä¸­æ“ä½œæ•°æ®åº“</span><br><span class="line">è§£å†³æ–¹æ³•ï¼šä»åº“è®¾ç½®ä¸å…è®¸å†™å…¥ ï¼Œä»åº“è®¾ç½®ä¸ºåªè¯»(è¯»å†™åˆ†ç¦»)</span><br><span class="line"><span class="comment"># åœ¨å‘½ä»¤è¡Œä¸´æ—¶è®¾ç½®</span></span><br><span class="line"><span class="built_in">set</span> global read_only=1;</span><br><span class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­æ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line">read_only=1</span><br><span class="line">å‘½ä»¤è¡Œ+é…ç½®æ–‡ä»¶ ä¸éœ€è¦é‡å¯å°±æ˜¯æ°¸ä¹…å¤±æ•ˆ</span><br><span class="line"><span class="comment">#ä½†æ˜¯ç”¨rootç”¨æˆ·ï¼Œå¯¹rootä¸ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure><p>3ã€</p><p><img src="../image/study_img/image-20240826150832618.png" alt="image-20240826150832618"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§£å†³åŠæ³•</span></span><br><span class="line">1ã€ä¸»åº“åœæ­¢ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">2ã€åœ¨ä¸»åº“ä¸ŠæŸ¥çœ‹å½“å‰ä½ç½®ç‚¹</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000016 |  5235939 |              |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line">3ã€ä»åº“æ‰“ç‚¹å…¨å¤‡ï¼Œåˆ°ä»åº“ï¼Œ</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=1 --single-transaction|gzip &gt; /tmp/full.sql.gz</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp</span><br><span class="line"></span><br><span class="line">4ã€ä»åº“å†ä»å½“å‰ä½ç½®ç‚¹å¼€å§‹å¤åˆ¶</span><br><span class="line">[root@db02 ~]# zcat /tmp/full.sql.gz |mysql -uroot -p123</span><br><span class="line">[root@db02 ~]# mysql -uroot -p123</span><br><span class="line"></span><br><span class="line">5ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=5235939,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€#ä»åº“å¼€å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line">æŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><p><strong>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚ä½•æ·»åŠ ä¸€å°ä»åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–°ä»åº“ç¯å¢ƒåˆå§‹åŒ–  (db04)</span></span><br><span class="line">ç›®å‰db01ä¸»åº“å·²ç»æœ‰ä¸€äº›æ•°æ®äº†ï¼Œå‡è®¾db01æ˜¯ç”Ÿäº§ç¯å¢ƒçš„ä¸»åº“ï¼Œè¿˜æœ‰æ•°æ®åœ¨ç½‘é‡Œé¢å†™å…¥</span><br><span class="line">è¿è¡Œè„šæœ¬</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start; mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">1ã€#ä¸»åº“æ‰“ç‚¹å…¨å¤‡(çƒ­å¤‡ ä¸é”è¡¨)</span><br><span class="line">[root@db01 ~]#  mysqldump -uroot -p123 -A -R --triggers --master-data=1 --single-transaction|gzip &gt; /tmp/full.sql.gz</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯zcatçš„æ–‡ä»¶é‡Œé¢æœ‰loca table ä¸ºä»€ä¹ˆé”è¡¨å‘¢ï¼Ÿ</span><br><span class="line">å®ƒæ˜¯ç”¨è¿™ä¸ªæ–‡ä»¶å¾€é‡Œæ¢å¤æ•°æ®çš„æ—¶å€™é”è¡¨ï¼Œæ–‡ä»¶æ˜¾ç¤ºçš„æ˜¯æ¢å¤è¿‡ç¨‹ï¼Œå¤‡ä»½çš„æ—¶å€™ä¸é”è¡¨çš„ï¼Œä¸æ˜¯å¤‡ä»½çš„è¿‡ç¨‹ï¼Œæ˜¯åœ¨æ¢å¤çš„æ—¶å€™é”ä½</span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“æ¢å¤ä¸»åº“å…¨å¤‡æ•°æ®</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.54:/tmp</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# zcat /tmp/full.sql.gz |mysql -uroot -p123</span><br><span class="line"></span><br><span class="line">3ã€#ä»æŸ¥çœ‹æ•°æ®å°‘äº†ï¼ŒæŸ¥çœ‹ç‚¹ä½ï¼Œç›´æ¥ä»æ‰“ç‚¹çš„ä½ç½®å¼€å§‹å¤åˆ¶</span><br><span class="line">[root@db01 ~]# zcat /tmp/full.sql.gz |<span class="built_in">head</span> -25</span><br><span class="line">CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000016&#x27;</span>, MASTER_LOG_POS=984578;</span><br><span class="line"></span><br><span class="line">5ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=984578,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">6ã€#ä»åº“å¼€å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line">æŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h3 id="2ã€å»¶æ—¶å¤åˆ¶">2ã€å»¶æ—¶å¤åˆ¶</h3><p><strong>ä¼ ç»Ÿä¸»ä»å¤åˆ¶çš„ç¼ºé™·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ— æ³•å¤‡ä»½</span><br><span class="line">2ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ— æ³•è¿‡æ»¤å¤åˆ¶</span><br><span class="line">3ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶é€Ÿåº¦ç›¸å¯¹æ¥è¯´æ¯”è¾ƒæ…¢</span><br><span class="line">4ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œä»åº“æ•°æ®å»¶è¿Ÿ(æ¯å°ä»åº“æ•°æ®ä¸æ˜¯ç™¾åˆ†ç™¾ä¸€è‡´ï¼Œæ¯å°ä»åº“çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä½†è¿™ä¸ªæ˜¯ä¸å¯é¿å…çš„ï¼Œåœ¨ç”Ÿäº§ä¸­ä¸€å®šæœ‰å»¶è¿Ÿ)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on prod.* to slave@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">ERROR 1221 (HY000): Incorrect usage of DB GRANT and GLOBAL PRIVILEGES</span><br><span class="line"><span class="comment">#replication è¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„æƒé™</span></span><br></pre></td></tr></table></figure><p><strong>å»¶æ—¶ä»åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¼ä¸šä¸€èˆ¬ä¼šå»¶æ—¶3~6å°æ—¶</span></span><br><span class="line">1ã€åšå»¶æ—¶ä»åº“çš„æœåŠ¡å™¨æ— æ³•åœ¨ç”Ÿäº§ä¸­æä¾›æœåŠ¡(è¿™ä¸ªæœºå™¨å°±æ˜¯ä¸€ä¸ªå¤‡æœº)</span><br><span class="line">2ã€å¤‡ä»½</span><br><span class="line">3ã€æ¢å¤æ•°æ®é€Ÿåº¦æ›´å¿«</span><br><span class="line">4ã€å»¶æ—¶ä»åº“ä¸å½±å“é«˜å¯ç”¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å»¶æ—¶ä»åº“çš„åŸç†ï¼šåœ¨SQLçº¿ç¨‹åšæ‰‹è„šï¼ŒIOçº¿ç¨‹ç»§ç»­æ‹¿æ•°æ®ï¼ŒSQLçº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´åï¼Œå»¶æ—¶æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">(æ€ä¹ˆåšï¼Œæ‰èƒ½è®©ä»–å»¶è¿Ÿ3~6å°æ—¶ï¼Ÿ)</span><br><span class="line"><span class="comment">#ä¼šè®¾ç½®SQLçº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´åå†æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p>å»¶æ—¶ä»åº“çš„åŸç†</p><p><img src="../image/study_img/image-20240826144421626.png" alt="image-20240826144421626"></p><p><strong>é…ç½®å»¶æ—¶ä»åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‘½ä»¤ï¼šé‡ç½®ä¸»ä»å¤åˆ¶ :ä»–ä¼šæŠŠæ‰€æœ‰ç›¸å…³æ–‡ä»¶é‡ç½®</span></span><br><span class="line">éœ€è¦ä¿®æ”¹æŸäº›å‚æ•°çš„æ—¶å€™æ‰ç”¨(æ¯”å¦‚è¯´ä½ç½®ç‚¹å†™é”™äº†ï¼Œå¯†ç å†™é”™äº†)</span><br><span class="line">mysql&gt; change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,master_user=<span class="string">&#x27;rep&#x27;</span>,master_password=<span class="string">&#x27;123&#x27;</span>,master_log_file=<span class="string">&#x27;mysql-bin.000003&#x27;</span>,master_log_pos=154;</span><br><span class="line"></span><br><span class="line">reset slave;     ä¼šä¿ç•™ä¹‹å‰chang masetrçš„ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">reset slave all;  (å®Œå…¨é‡ç½®ä¸»ä»ï¼Œä¿ç•™ä»»ä½•ä¿¡æ¯ï¼Œå–æ¶ˆä»åº“èº«ä»½çš„æ—¶å€™)</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢ä¸»ä»å¤åˆ¶</span></span><br><span class="line">stop slave;  </span><br><span class="line"></span><br><span class="line"><span class="comment">#å°±æ˜¯åœ¨SQL-DelayåŠ å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">#å°†db04å˜æˆå»¶æ—¶ä»åº“</span></span><br><span class="line"></span><br><span class="line">1ã€#åœæ­¢ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">2ã€#é‡ç½®ä¸»ä»ä¿¡æ¯</span><br><span class="line">root@localhost:(none) &gt; reset salve;</span><br><span class="line"></span><br><span class="line">3ã€#é…ç½®SQLçº¿ç¨‹å»¶è¿Ÿå¤åˆ¶æ—¶é—´   180 3min</span><br><span class="line">root@localhost:(none) &gt; chang master to master_delay=180;</span><br><span class="line"></span><br><span class="line">4ã€#å¼€å¯ä¸»ä»å¤åˆ¶ï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">               Master_Host: 172.16.1.51</span><br><span class="line">               ......</span><br><span class="line">               SQL_Delay: 180</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®å»¶æ—¶ä»åº“ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå½“è®©æ•°æ®ä¸€è‡´çš„è§£å†³åŠæ³•</span></span><br><span class="line">1ã€#ä»åº“æ“ä½œ</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line">root@localhost:(none) &gt; reset slave;</span><br><span class="line">root@localhost:(none) &gt; change master to master_delay=0;</span><br><span class="line"></span><br><span class="line">2ã€ä¸»åº“æ“ä½œ</span><br><span class="line">[root@db01 ~]#  mysqldump -A -uroot -p123 &gt; /tmp/full.sql</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp</span><br><span class="line"></span><br><span class="line">3ã€ä»åº“æ¢å¤æ•°æ®</span><br><span class="line">root@localhost:world &gt; <span class="built_in">source</span> /tmp/full.sql;</span><br><span class="line"></span><br><span class="line">4ã€ä¸»åº“æŸ¥çœ‹ä½ç½®ç‚¹</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000016 |  5366820 |              |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line">5ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=5366820,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; start slave;</span><br><span class="line">root@localhost:world &gt; show slave status\G</span><br></pre></td></tr></table></figure><p><strong>å»¶æ—¶ä»åº“æ¢å¤æ¡ˆä¾‹</strong></p><p>æ€»æ•°æ®é‡çº§500Gï¼Œæ­£å¸¸å¤‡ä»½å»æ¢å¤éœ€è¦1.5-2å°æ—¶<br>1ï¼‰é…ç½®å»¶æ—¶3600ç§’<br>mysql&gt;CHANGE MASTER TO MASTER_DELAY = 3600;</p><p>2ï¼‰ä¸»åº“<br>drop database db;</p><p>3ï¼‰æ€ä¹ˆåˆ©ç”¨å»¶æ—¶ä»åº“ï¼Œæ¢å¤æ•°æ®ï¼Ÿ</p><p>1ã€æ¨¡æ‹Ÿæ•°æ®å‡†å¤‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¸»åº“db01æ‰§è¡Œå†™å…¥æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€å…ˆä¿è¯å…¶ä»–ä»åº“çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œä¸»ä»åŒæ­¥æ²¡é—®é¢˜</span><br><span class="line"></span><br><span class="line">3ã€ä¸»åº“åˆ›å»ºä¸€ä¸ªåº“ï¼Œå†™å…¥æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; create database asm;</span><br><span class="line">root@localhost:(none) &gt; flush logs;</span><br><span class="line">root@localhost:(none) &gt; use asm</span><br><span class="line">root@localhost:(none) &gt; create table asm(<span class="built_in">id</span> int);</span><br><span class="line">root@localhost:(none) &gt; insert into asm values(1),(2),(3);</span><br><span class="line">root@localhost:(none) &gt; update asm <span class="built_in">set</span> <span class="built_in">id</span>=10 <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line"></span><br><span class="line">4ã€ä¸»åº“æ‰“ç‚¹å…¨å¤‡</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction  &gt; /tmp/full.sql.gz</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp</span><br><span class="line"></span><br><span class="line">5ã€ä»åº“ä»åº“ä½ç½®ç‚¹</span><br><span class="line">[root@db02 ~]# <span class="built_in">head</span> -25 /tmp/full.sql.gz </span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000017&#x27;</span>, MASTER_LOG_POS=99930;</span><br><span class="line">[root@db02 ~]#  mysql -uroot -p123 &lt; /tmp/full.sql.gz </span><br><span class="line"></span><br><span class="line">6ã€è®©ä»åº“db02å˜æˆä¸€ä¸ªå»¶æ—¶ä»åº“</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from asm.asm;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line">root@localhost:world &gt; stop slave;</span><br><span class="line">root@localhost:world &gt; reset slave all;</span><br><span class="line"></span><br><span class="line">7ã€ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000017&#x27;</span>,</span><br><span class="line">master_log_pos=99930,</span><br><span class="line">master_port=3306,</span><br><span class="line">master_delay=180;</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; start slave;</span><br><span class="line">root@localhost:world &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Slave_IO_Running: Yes</span><br><span class="line">          Slave_SQL_Running: Yes</span><br><span class="line">          .........</span><br><span class="line">          SQL_Delay: 180</span><br><span class="line">          SQL_Remaining_Delay: 0</span><br><span class="line">          </span><br><span class="line"></span><br><span class="line">8ã€ä¸»åº“é‡Œé¢å†å†™ç‚¹æ•°æ®ï¼Œä»åº“é‡Œé¢æŸ¥çœ‹ç°åœ¨æ•°æ®è¿˜æ²¡æœ‰å†™è¿‡æ¥ï¼ŒæŠŠä¸»åº“çš„åº“åˆ é™¤</span><br><span class="line">root@localhost:asm &gt; insert into asm values(4),(5),(6);</span><br><span class="line">root@localhost:asm &gt; <span class="keyword">select</span> * from asm.asm;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">|    5 |</span><br><span class="line">|    6 |</span><br><span class="line">+------+      </span><br><span class="line">root@localhost:(none) &gt; drop database asm;</span><br></pre></td></tr></table></figure><p>2ã€æ¢å¤æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">(ä¼ä¸šä¸­çš„ç›˜)SAS  Flash(æœ€æ¥è¿‘å†…å­˜æ€§èƒ½çš„ç›˜) </span><br><span class="line">SATA(ç”µè„‘çš„ç›˜)</span><br><span class="line">mysq1&gt; change master to master_delay=0;  å–æ¶ˆå»¶æ—¶å¤åˆ¶</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¢å¤æ€è·¯    ç”¨db02åšå»¶æ—¶ä»åº“</span></span><br><span class="line">1ã€#åœæ­¢db02å»¶æ—¶ä»åº“çš„SQLçº¿ç¨‹</span><br><span class="line">root@localhost:(none) &gt; stop slave SQL_thread;</span><br><span class="line"></span><br><span class="line">2ã€#å‡†å¤‡æ–°ç¯å¢ƒ</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start; mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">3ã€#å»¶æ—¶ä»åº“åšå…¨å¤‡  (ä»åº“æ²¡æœ‰å¼€binlog  ä¸ç”¨æ‰“ç‚¹å…¨å¤‡)</span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -A -R --triggers &gt; /tmp/full_new.sql</span><br><span class="line"></span><br><span class="line">4ã€#æˆªå–åˆ åº“ä¹‹å‰relay-log.infoæ•°æ®  (æŸ¥çœ‹ä»åº“æ‰§è¡Œåˆ°å“ªä¸ªä½ç½®ç‚¹)</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /app/mysql-5.6.50/data/relay-log.info </span><br><span class="line">7</span><br><span class="line">./db02-relay-bin.000002  <span class="comment">#ç»“æŸä½ç½®ç‚¹çš„æ–‡ä»¶</span></span><br><span class="line">171031  <span class="comment">#å¼€å§‹ä½ç½®ç‚¹</span></span><br><span class="line">mysql-bin.000017</span><br><span class="line">270678</span><br><span class="line">180</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š171031  </span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/db02-relay-bin.000002 | grep -iC 10 drop</span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š194850</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --start-position=171031 --stop-position=194850  /app/mysql-5.6.50/data/db02-relay-bin.000002 &gt; /tmp/inc1.sql</span><br><span class="line"></span><br><span class="line">5ã€æˆªå–åˆ åº“ä¹‹åçš„æ•°æ® éœ€è¦åœæ­¢æ•°æ®å†™å…¥</span><br><span class="line">[root@db01 ~]# sh insert.sh ^C</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     3442 |</span><br><span class="line">+----------+  <span class="comment">#è®°å½•åœåº“å‰æ•°æ®æœ€åå†™å…¥çš„çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">6ã€æˆªå–åˆ åº“ä¹‹å‰çš„ä½ç½®ç‚¹~åœåº“çš„ä½ç½®ç‚¹æ•°æ®</span><br><span class="line">[root@db02 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/db02-relay-bin.000002 | grep -iC 10 drop</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š194939 </span><br><span class="line"></span><br><span class="line">[root@db02 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql   489751 Aug 26 17:21 db02-relay-bin.000002</span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š489751</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --start-position=194939 --stop-position=489751  /app/mysql-5.6.50/data/db02-relay-bin.000002 &gt; /tmp/inc2.sql</span><br><span class="line"></span><br><span class="line">7ã€å‡†å¤‡æ–°ç¯å¢ƒ<span class="string">&#x27;db03&#x27;</span></span><br><span class="line">[root@db03 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db03 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db03 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db03 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db03 ~]# /etc/init.d/mysqld start; mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">7ã€å°†å»¶æ—¶ä»åº“çš„å…¨å¤‡å¯¼å…¥æ–°ç¯å¢ƒ</span><br><span class="line">[root@db02 ~]# scp /tmp/full_new.sql  172.16.1.53:/tmp</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123 &lt; /tmp/full_new.sql </span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ–°ç¯å¢ƒçš„æ•°æ®çŠ¶æ€</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     1731 |</span><br><span class="line">+----------+  <span class="comment">#å¯ä»¥çœ‹åˆ°æ•°æ®è¿˜ä¸å…¨</span></span><br><span class="line"></span><br><span class="line">8ã€æ¢å¤å»¶è¿ŸæŸ¥çœ‹æˆªå–çš„ç¬¬ä¸€æ®µï¼Œç¬¬äºŒæ®µæ–°å¢æ•°æ®åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db02 ~]# scp /tmp/inc1.sql   172.16.1.53:/tmp</span><br><span class="line">[root@db02 ~]# scp /tmp/inc2.sql   172.16.1.53:/tmp</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123 &lt; /tmp/inc1.sql</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123 &lt; /tmp/inc2.sql</span><br><span class="line"></span><br><span class="line">9ã€æ–°ç¯å¢ƒdb03æŸ¥çœ‹æ•°æ®æ˜¯å¦æ¢å¤</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     3442 |</span><br><span class="line">+----------+</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from asm.asm;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">|    5 |</span><br><span class="line">|    6 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">10ã€åº”ç”¨å‰²æ¥</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å–æ¶ˆå»¶æ—¶ä»åº“çš„æ­¥éª¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å°†db02å»¶æ—¶ä»åº“å–æ¶ˆé…ç½®</span></span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; change master to master_delay=0;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line"><span class="comment">#æŸ¥çœ‹çº¿ç¨‹å¯èƒ½æœ‰æŠ¥é”™</span></span><br><span class="line">ä¸»åº“æ‰“ç‚¹å…¨å¤‡</span><br><span class="line">[root@db01 ~]#  mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction  &gt; /tmp/full.sql.gz</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp </span><br><span class="line">[root@db01 ~]# <span class="built_in">head</span> -25 /tmp/full.sql.gz</span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000017&#x27;</span>, MASTER_LOG_POS=589398;</span><br><span class="line"></span><br><span class="line">ã€ä»åº“æ¢å¤æ•°æ®</span><br><span class="line">root@localhost:world &gt; <span class="built_in">source</span> /tmp/full.sql;</span><br><span class="line"></span><br><span class="line">ã€ä¸»åº“æŸ¥çœ‹ä½ç½®ç‚¹</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000017 |  589398  |              |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000017&#x27;</span>,</span><br><span class="line">master_log_pos=589398,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; start slave;</span><br><span class="line">root@localhost:world &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.51</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000017</span><br><span class="line">          Read_Master_Log_Pos: 589398</span><br><span class="line">               Relay_Log_File: db02-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 283</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000017</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure><h3 id="3ã€åŠåŒæ­¥å¤åˆ¶">3ã€<strong>åŠåŒæ­¥å¤åˆ¶</strong></h3><p>åŠåŒæ­¥å¤åˆ¶å‡ºç°çš„åŸå› ï¼šä¸ºäº†ä¿è¯ä¸»åº“å’Œä»åº“çš„æ•°æ®ä¸€è‡´æ€§</p><p>ä»åº“çš„IOçº¿ç¨‹åœ¨æ²¡æœ‰æ¥æ”¶åˆ°ACKä¹‹å‰ï¼Œä¼šé˜»å¡ä¸»åº“å†™å…¥æ“ä½œ<br>åŠåŒæ­¥ç¼ºç‚¹ï¼šé˜»å¡ä¸»åº“å†™å…¥æ•°æ®ï¼Œå½±å“ä¸»åº“æ€§èƒ½ï¼Œé™ä½ç”¨æˆ·ä½“éªŒ<br>åŠåŒæ­¥ä¼˜ç‚¹ï¼šä¸»åº“å’Œä»åº“æ•°æ®ä¿è¯äº†ä¸€è‡´æ€§ï¼Œä¸ä¼šä¸¢æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ä»MYSQL5.5å¼€å§‹ï¼Œæ”¯æŒåŠè‡ªåŠ¨å¤åˆ¶ã€‚ä¹‹å‰ç‰ˆæœ¬çš„MySQL Replicationéƒ½æ˜¯å¼‚æ­¥ï¼ˆasynchronousï¼‰çš„ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œä¸€äº›äº‹åŠ¡åï¼Œæ˜¯ä¸ä¼šç®¡å¤‡åº“çš„è¿›åº¦çš„ã€‚å¦‚æœå¤‡åº“ä¸å¹¸è½åï¼Œè€Œæ›´ä¸å¹¸çš„æ˜¯ä¸»åº“æ­¤æ—¶åˆå‡ºç°Crashï¼ˆä¾‹å¦‚å®•æœºï¼‰ï¼Œè¿™æ—¶å¤‡åº“ä¸­çš„æ•°æ®å°±æ˜¯ä¸å®Œæ•´çš„ã€‚ç®€è€Œè¨€ä¹‹ï¼Œåœ¨ä¸»åº“å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨å¤‡åº“æ¥ç»§ç»­æä¾›æ•°æ®ä¸€è‡´çš„æœåŠ¡äº†ã€‚</span><br><span class="line"></span><br><span class="line">åŠåŒæ­¥å¤åˆ¶ï¼ˆSemi synchronous Replicationï¼‰åˆ™ä¸€å®šç¨‹åº¦ä¸Šä¿è¯æäº¤çš„äº‹åŠ¡å·²ç»ä¼ ç»™äº†è‡³å°‘ä¸€ä¸ªå¤‡åº“ã€‚</span><br><span class="line">å‡ºå‘ç‚¹æ˜¯ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå®‰å…¨çš„è€ƒè™‘ã€‚</span><br><span class="line">5.5 å‡ºç°æ¦‚å¿µï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨ï¼Œæ€§èƒ½å¤ªå·®</span><br><span class="line">5.6å‡ºç°group commit ç»„æäº¤åŠŸèƒ½ï¼Œæ¥æå‡å¼€å¯åŠåŒæ­¥å¤åˆ¶çš„æ€§èƒ½</span><br><span class="line">5.7æ›´åŠ å®Œå–„äº†ï¼Œåœ¨group commitåŸºç¡€ä¸Šå‡ºç°äº†MGR</span><br><span class="line">5.7çš„å¢å¼ºåŠåŒæ­¥å¤åˆ¶çš„æ–°ç‰¹æ€§ï¼šafter commitï¼› after <span class="built_in">sync</span>ï¼›</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»€ä¹ˆæƒ…å†µä¸‹ä»£è¡¨æ•°æ®å†™å®Œäº†ï¼Œè€Œä¸”å®Œæ•´</span></span><br><span class="line">TCPç¼“å­˜ä¼šè¿”å›ä¸€ä¸ªACKç»™IOçº¿ç¨‹</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠåŒæ­¥å¤åˆ¶(åœ¨IOçº¿ç¨‹åšæ‰‹è„š)</span></span><br><span class="line">IOçº¿ç¨‹å–å‡ºæ•°æ®åï¼ŒIOçº¿ç¨‹ä¸è¿”å›ACKï¼ŒIOçº¿ç¨‹å°±ä¸å»ç»™Dumpçº¿ç¨‹è¦æ•°æ®</span><br><span class="line">åªè¦ä»åº“IOçº¿ç¨‹æ²¡æœ‰æ¥åˆ°ACKä¹‹å‰ï¼Œä¼šé˜»å¡ä¸»åº“å†™å…¥æ“ä½œ(ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½±å“ä¸»åº“æ€§èƒ½å¯¼è‡´ç”¨æˆ·çš„ä½“éªŒä¸‹é™)</span><br><span class="line"><span class="comment">#å¼€ä¸å¼€åŠåŒæ­¥å–å†³äºå…¬å¸ï¼Œä½†å‡ ä¹å¾ˆå°‘å¼€</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240826181704110.png" alt="image-20240826181704110"></p><p>åŠåŒæ­¥çš„æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/lib/plugin/</span><br><span class="line">-rwxr-xr-x 1 mysql mysql 515584 Aug  7 19:52 semisync_master.so</span><br><span class="line">-rwxr-xr-x 1 mysql mysql 276296 Aug  7 19:52 semisync_slave.so</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆä¸æ˜¯è‡ªåŠ¨å®‰è£…è¿™ä¸¤ä¸ªæ’ä»¶ï¼Ÿ</span><br><span class="line">1ã€ä¸æ˜¯æ¯ä¸ªå…¬å¸éƒ½æœ‰å¼€åŠåŒæ­¥</span><br><span class="line">2ã€å…ˆåšä¸»ä»ä¹‹åæ‰èƒ½å¼€åŠåŒæ­¥</span><br></pre></td></tr></table></figure><p><strong>åŠåŒæ­¥å¤åˆ¶çš„é…ç½®</strong></p><p>1ã€db01ä¸»åº“æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸»åº“æŸ¥çœ‹æ˜¯å¦æ”¯æŒåŠåŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show global variables like <span class="string">&#x27;have_dynamic_loading&#x27;</span>;</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name        | Value |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| have_dynamic_loading | YES   |</span><br><span class="line">+----------------------+-------+</span><br><span class="line"></span><br><span class="line">2ã€ä¸»åº“éœ€è¦å®‰è£…åŠåŒæ­¥æ’ä»¶</span><br><span class="line">root@localhost:(none) &gt; install plugin rpl_semi_sync_master soname<span class="string">&#x27;semisync_master.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨æ’ä»¶+è®¾ç½®è¶…æ—¶æ—¶é—´(ä¸´æ—¶çš„) </span><br><span class="line">root@localhost:(none) &gt; SET GLOBAL rpl_semi_sync_master_enabled = 1;</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> global rpl_semi_sync_master_timeout = 1000;</span><br><span class="line"></span><br><span class="line">4ã€#æ°¸ä¹…å¯åŠ¨å†™åœ¨é…ç½®æ–‡ä»¶é‡Œé¢+è¶…æ—¶æ—¶é—´  è®¾ç½®è¶…æ—¶ 1000ms=1s</span><br><span class="line">è¶…è¿‡10sè¿˜æ²¡æœ‰å†™å®Œæ•°æ®ï¼Œä¼šåœæ­¢åŠåŒæ­¥ï¼Œæ¢å¤æˆå¼‚æ­¥å¤åˆ¶(å¦‚æœæƒ³è¦æ°¸ä¹…å¤±æ•ˆå°±å†™åœ¨é…ç½®æ–‡ä»¶é‡Œé¢)</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout = 1000</span><br><span class="line"></span><br><span class="line">5ã€æ£€æŸ¥</span><br><span class="line">root@localhost:(none) &gt; show variables like<span class="string">&#x27;rpl%&#x27;</span>;</span><br><span class="line">root@localhost:(none) &gt; show variables like<span class="string">&#x27;rpl%&#x27;</span>;</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line">| Variable_name                      | Value    |</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | ON       |#å¼€å¯</span><br><span class="line">| rpl_semi_sync_master_timeout       | 1000     |#è¶…æ—¶æ—¶é—´</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32       |#è·¯ç”±çš„çº§åˆ«</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON       |</span><br><span class="line">| rpl_stop_slave_timeout             | 31536000 |#åœæ­¢ä»åº“çš„è¶…æ—¶æ—¶é—´</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 0     |#0ä»£è¡¨å®¢æˆ·ç«¯è¿˜æ²¡æœ‰</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 0     |</span><br><span class="line">+--------------------------------------------+-------+</span><br></pre></td></tr></table></figure><p>2ã€db02ä»åº“é…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»åº“é…ç½®</span></span><br><span class="line">1ã€å®‰è£…æ’ä»¶</span><br><span class="line">root@localhost:world &gt; INSTALL PLUGIN rpl_semi_sync_slave SONAME<span class="string">&#x27;semisync_slave.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨æ’ä»¶(ä¸´æ—¶å¯åŠ¨)</span><br><span class="line">root@localhost:world &gt; SET GLOBAL rpl_semi_sync_slave_enabled = 1;</span><br><span class="line">æ°¸ä¹…ç”Ÿæ•ˆ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line">rpl_semi_sync_slave_enabled = 1</span><br><span class="line"></span><br><span class="line">4ã€é‡å¯IOçº¿ç¨‹</span><br><span class="line">root@localhost:world &gt; stop slave io_thread;</span><br><span class="line">root@localhost:world &gt; start slave io_thread;</span><br><span class="line"></span><br><span class="line">5ã€åˆ°ä¸»åº“æŸ¥çœ‹æ˜¯å¦æœ‰ä»åº“å˜æˆåŠåŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 1     |#æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 0     |</span><br><span class="line">+--------------------------------------------+-------+</span><br></pre></td></tr></table></figure><p>3ã€æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸»åº“åˆ›å»ºä¸€ä¸ªåº“</span><br><span class="line">root@localhost:(none) &gt; create database abc111;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)   <span class="comment">#é…ç½®ä¹‹åï¼Œä¸»åº“å»ºåº“æ—¶é—´å˜å¿«</span></span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; create database abc112;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; create database abc113;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; create database abc114;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹çŠ¶æ€ï¼Œä¼šè®°å½•å¹³å‡ç­‰å¾…æ—¶é—´  ï¼ˆmsä¸ºå•ä½ï¼‰</span><br><span class="line">root@localhost:(none) &gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 1     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 4199  |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 16799 |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 4     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 4286  |#å¹³å‡ç­‰å¾…æ—¶é—´ </span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 17144 |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 4     |#ä¸€å…±4æ¡è¯­å¥</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 4     |#æˆåŠŸæ‰§è¡Œ4æ¡è¯­å¥</span><br><span class="line">+--------------------------------------------+-------+</span><br></pre></td></tr></table></figure><p>å…³é—­åŠåŒæ­¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:world &gt; SET GLOBAL rpl_semi_sync_slave_enabled = 0;</span><br><span class="line">é…ç½®æ–‡ä»¶å–æ¶ˆ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line"><span class="comment">#rpl_semi_sync_slave_enabled = 1</span></span><br></pre></td></tr></table></figure><h3 id="4ã€mysqlçš„è¿‡æ»¤å¤åˆ¶">4ã€<strong>mysqlçš„è¿‡æ»¤å¤åˆ¶</strong></h3><p>æ¯ä¸ªä»åº“åªæƒ³å¤åˆ¶ä¸€ä¸ªåº“</p><p><img src="../image/study_img/image-20240826200642230.png" alt="image-20240826200642230"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ–¹æ³•ï¼š</span><br><span class="line">å¯ä»¥åœ¨ä¸»åº“é…ç½®ï¼šé…ç½®ç™½åå•æˆ–è€…é»‘åå•</span><br><span class="line">å¯ä»¥åœ¨ä»åº“é…ç½®ï¼šé…ç½®ç™½åå•æˆ–è€…é»‘åå•</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•ä¸€ï¼šä¸»åº“é…ç½®(ä¸€èˆ¬ä¸ç”¨)</strong></p><ul><li>binlog-do-dbï¼šç™½åå•ï¼šåªè®°å½•ç™½åå•ä¸­åˆ—å‡ºçš„åº“çš„äºŒè¿›åˆ¶æ—¥å¿—</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">è§„èŒƒçš„sqlè¯­å¥å…ˆuseä¸€ä¸ªåº“ï¼Œå†å†™æ•°æ®</span><br><span class="line"><span class="comment">#åœ¨binlogåšæ‰‹è„šï¼šbinlogåªè®°å½•prodåº“çš„æ•°æ®ï¼Œå…¶ä»–çš„ä¸è®°å½•</span></span><br><span class="line"></span><br><span class="line">1ã€#åªå¤åˆ¶å•åº“</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-do-db=prod</span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000018 |      120 | prod         |#ä»åº“åªå¤åˆ¶prodè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¤åˆ¶å¤šä¸ªåº“</span></span><br><span class="line">1ã€#é…ç½®æ–‡ä»¶å†™åº“åå­—ï¼Œæœ‰å‡ ä¸ªåº“å°±å†™å‡ è¡Œ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-do-db=prod</span><br><span class="line">binlog-do-db=world</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000019 |      120 | prod,world   |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•</span></span><br><span class="line">1ã€#ä¸»åº“å¾€prodåº“é‡Œé¢å†™æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; use prod</span><br><span class="line">root@localhost:prod &gt; insert into prod values(77777);</span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“æŸ¥çœ‹</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from prod.prod;</span><br><span class="line">+-------+</span><br><span class="line">| 77777 |</span><br><span class="line">+-------+</span><br></pre></td></tr></table></figure><ul><li>binlog-ignore-dbï¼šé»‘åå•ï¼šä¸è®°å½•é»‘åå•åˆ—å‡ºçš„åº“çš„äºŒè¿›åˆ¶æ—¥å¿—</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨binlogåšæ‰‹è„šï¼šbinlogä¸è®°å½•abcåº“çš„æ•°æ®ï¼Œå…¶ä»–çš„éƒ½è®°å½•</span></span><br><span class="line"></span><br><span class="line">1ã€#ä¸å¤åˆ¶å•åº“</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-ignore-db=abc</span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">root@localhost:prod &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| mysql-bin.000020 |      120 |              | abc              | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line"><span class="comment">#ä»åº“ä¸å¤åˆ¶abcè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸å¤åˆ¶å¤šä¸ªåº“</span></span><br><span class="line">1ã€#é…ç½®æ–‡ä»¶å†™åº“åå­—ï¼Œæœ‰å‡ ä¸ªåº“å°±å†™å‡ è¡Œ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-ignore-db=abc</span><br><span class="line">binlog-ignore-db=aaa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| mysql-bin.000020 |      120 |              | abc,aaa          | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒï¼šä»åº“é…ç½®(å¸¸ç”¨)</strong></p><p>ç™½åå•ï¼šåªæ‰§è¡Œç™½åå•ä¸­åˆ—å‡ºçš„åº“æˆ–è€…è¡¨çš„ä¸­ç»§æ—¥å¿—</p><ul><li>replicate-do-db=prod    (åº“é‡Œæ‰€æœ‰è¡¨éƒ½å¤åˆ¶)</li><li>replicate-do-table=prod.prod     (åº“é‡Œçš„æŸä¸€å¼ è¡¨å¤åˆ¶)</li><li>replicate-wild-do-table=prod.p*    (åº“é‡Œä»¥på¼€å¤´çš„è¡¨éƒ½å¤åˆ¶)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">binlogä¸è®°å½•æŒ‡å®šçš„åº“ï¼Œå…¶ä»–çš„éƒ½è®°å½•</span><br><span class="line"></span><br><span class="line">è¡¨é‡Œé¢SQLçº¿ç¨‹åªæ‰§è¡Œ Replicat_Do_DBæŒ‡å®šçš„åº“çš„SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">1ã€#ä»åº“é…ç½®æ–‡ä»¶é…ç½®</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-do-db=prod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“é‡å¯</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#ä»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">.....</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: prod   <span class="comment">#åªå¤åˆ¶prodåº“</span></span><br></pre></td></tr></table></figure><p>é»‘åå•ï¼šä¸æ‰§è¡Œé»‘åå•ä¸­åˆ—å‡ºçš„åº“æˆ–è€…è¡¨çš„ä¸­ç»§æ—¥å¿—</p><ul><li>replicate-ignore-db=abc    (åº“é‡Œæ‰€æœ‰è¡¨ä¸å¤åˆ¶)</li><li>replicate-ignore-table=abc.abc    (åº“é‡Œçš„æŸä¸€å¼ è¡¨ä¸å¤åˆ¶)</li><li>replicate-wild-ignore-table=abc.a*      (åº“é‡Œä»¥på¼€å¤´çš„è¡¨éƒ½ä¸å¤åˆ¶)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SQLçº¿ç¨‹ä¸æ‰§è¡Œ Replicat_Ignore_DBæŒ‡å®šçš„åº“çš„SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">1ã€#ä»åº“é…ç½®æ–‡ä»¶é…ç½®</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-ignore-db=abc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“é‡å¯</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#ä»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">.....</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: abc   <span class="comment">#ä¸å¤åˆ¶abcåº“</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•10ã€MySQLæ•°æ®å¤‡ä»½å’Œæ¢å¤</title>
      <link href="/posts/42021c83.html"/>
      <url>/posts/42021c83.html</url>
      
        <content type="html"><![CDATA[<h3 id="mysqlæ—¥å¿—ç®¡ç†">mysqlæ—¥å¿—ç®¡ç†</h3><p><strong>Mysqlæ—¥å¿—ç®¡ç†</strong></p><p><img src="../image/study_img/image-20240820084820991.png" alt="image-20240820084820991"></p><p>1ã€é”™è¯¯æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½œç”¨ï¼šMySqlå¯åŠ¨æŠ¥é”™çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸ºäº†æ’æŸ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é»˜è®¤æ˜¯å¦å¼€å¯ï¼šå¼€å¯</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚¨å­˜ä½ç½®ï¼š</span></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql   179797 Aug 20 10:31 db01.err</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%err%&#x27;</span>;</span><br><span class="line">+---------------------+--------------+</span><br><span class="line">| Variable_name       | Value        |</span><br><span class="line">+---------------------+--------------+</span><br><span class="line">| log_error           | ./db01.err   | </span><br><span class="line">+---------------------+--------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#åå­—ï¼šhostname.err</span></span><br><span class="line">./db01.err </span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®mysqlé”™è¯¯æ—¥å¿—çš„ä½ç½®ï¼Œä½†æ˜¯éœ€è¦æå‰åˆ›å»ºè¿™ä¸ªæ—¥å¿—æ–‡ä»¶å¹¶ä¸”æˆæƒ</span></span><br><span class="line">1ã€åˆ›å»ºå‡ºé”™è¯¯æ—¥å¿—æ–‡ä»¶,å¹¶æˆæƒ</span><br><span class="line">[root@db01 ~]# <span class="built_in">touch</span> /opt/mysql_error.txt</span><br><span class="line">[root@db01 ~]# <span class="built_in">chown</span> mysql.mysql /opt/mysql_error.txt</span><br><span class="line"></span><br><span class="line">2ã€ä¿®æ”¹mysqlé…ç½®æ–‡ä»¶</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line"><span class="comment">#åœ¨[mysqld]æ ‡ç­¾éšä¾¿æ·»åŠ ä¸€è¡Œå†™å…¥ï¼š</span></span><br><span class="line">log_error=/opt/mysql_error.txt  <span class="comment">#åé¢å†™ä¸Šä½ è¦å­˜æ”¾çš„è·¯å¾„</span></span><br><span class="line"></span><br><span class="line">3ã€é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br></pre></td></tr></table></figure><p>2ã€å¸¸è§„æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½œç”¨ï¼šè®°å½•å¸¸è§„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é»˜è®¤æ˜¯å¦å¼€å¯ï¼šå¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚¨å­˜ä½ç½®ï¼š</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%general_log%&#x27;</span>;</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| Variable_name    | Value                           |</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line">| general_log      | OFF                             |</span><br><span class="line">| general_log_file | /app/mysql-5.6.50/data/db01.<span class="built_in">log</span> |</span><br><span class="line">+------------------+---------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#åå­—ï¼šhostname.log</span></span><br><span class="line">db01.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹æ–¹å¼ï¼š</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">general_log=1</span><br><span class="line">general_log_file=/app/mysql/data/db01.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p>3ã€äºŒè¿›åˆ¶æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½œç”¨ï¼šåªè®°å½•å¯¹æ•°æ®å‘ç”Ÿå˜åŒ–çš„è¯­å¥</span></span><br><span class="line">è®°å½•å·²æäº¤çš„DMLè¯­å¥ï¼Œå¹¶æ‹†åˆ†ä¸ºå¤šä¸ªäº‹ä»¶(event)æ¥è¿›è¡Œè®°å½• è®°å½•æ‰€æœ‰DDL,DML,DCL</span><br><span class="line"></span><br><span class="line"><span class="comment">#é»˜è®¤æ˜¯å¦å¼€å¯ï¼šå¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‚¨å­˜ä½ç½®ï¼š</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br><span class="line">+---------------------------------+----------------------------------------+</span><br><span class="line">| Variable_name                   | Value                                  |</span><br><span class="line">+---------------------------------+----------------------------------------+</span><br><span class="line">| log_bin                         | ON                                     |</span><br><span class="line">| log_bin_basename                | /app/mysql-5.6.50/data/mysql-bin       |</span><br><span class="line">| log_bin_index                   | /app/mysql-5.6.50/data/mysql-bin.index |</span><br><span class="line">| log_bin_trust_function_creators | OFF                                    |</span><br><span class="line">| log_bin_use_v1_row_events       | OFF                                    |</span><br><span class="line">| sql_log_bin                     | ON                                     |</span><br><span class="line">+---------------------------------+----------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹æ–¹æ³• MySQL5.6</span></span><br><span class="line">ä¿®æ”¹mysqlé…ç½®æ–‡ä»¶</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line"><span class="comment">#åœ¨ç©ºè¡Œéšä¾¿æ·»åŠ ä¸€ä¸ª</span></span><br><span class="line">[mysqld]</span><br><span class="line">.....</span><br><span class="line">log_bin=mysql_bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹æ–¹æ³• MySQL5.7  (éœ€è¦å’Œserver_idé…åˆä½¿ç”¨)</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">.....</span><br><span class="line">server_id=1</span><br><span class="line">log-bin=mysql-bin</span><br></pre></td></tr></table></figure><p><strong>äºŒè¿›åˆ¶çš„3ç§å·¥ä½œæ¨¡å¼</strong></p><p>1ã€statement        è¯­å¥æ¨¡å¼(mysql5.6çš„é»˜è®¤æ¨¡å¼)<br>2ã€row                  è¡Œçº§æ¨¡å¼(mysql5.7çš„é»˜è®¤æ¨¡å¼)<br>3ã€mixed              æ··åˆæ¨¡å¼</p><ul><li>statement      è¯­å¥æ¨¡å¼(mysql5.6çš„é»˜è®¤æ¨¡å¼)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰mysql5.6é»˜è®¤æ¨¡å¼</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%binlog_format%&#x27;</span>;</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| Variable_name | Value     |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| binlog_format | STATEMENT |</span><br><span class="line">+---------------+-----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰mysql5.7é»˜è®¤æ¨¡å¼</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%binlog_format%&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| binlog_format | ROW   |</span><br><span class="line">+---------------+-------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¯­å¥æ¨¡å¼çš„æ¯ä¸€æ¡è¯­å¥éƒ½å¾ˆæ¸…æ™°</span></span><br><span class="line">ä¼˜ç‚¹ï¼šç®€å•æ˜“è¯»ï¼Œå ç”¨ç£ç›˜ç©ºé—´å°</span><br><span class="line">ç¼ºç‚¹ï¼šä¸æ˜“è¯»</span><br></pre></td></tr></table></figure><ul><li>row                 è¡Œçº§æ¨¡å¼(mysql5.7çš„é»˜è®¤æ¨¡å¼   ä¼ä¸šå¸¸ç”¨çš„æ¨¡å¼)</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä¼˜ç‚¹ï¼šä¸¥è°¨è®°å½•åŸæ•°æ®å’Œæ•°æ®çš„å˜åŒ–è¿‡ç¨‹ï¼Œä¸å®¹æ˜“ä¸¢æ•°æ®</span><br><span class="line">ç¼ºç‚¹ï¼šå ç”¨ç£ç›˜ç©ºé—´å¤§ï¼Œä¸æ˜“è¯»</span><br><span class="line"></span><br><span class="line"><span class="comment">#5.6å¼€å¯è¡Œçº§æ¨¡å¼</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">.....</span><br><span class="line">binlog_format=row</span><br></pre></td></tr></table></figure><ul><li>mixed              æ··åˆæ¨¡å¼(ä¸Šé¢2ç§æ¨¡å¼çš„æ··åˆ     ä¸å¸¸ç”¨)</li></ul><p><strong>äºŒè¿›åˆ¶æ—¥å¿—çš„æŸ¥çœ‹æ–¹å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#äºŒè¿›åˆ¶æ—¥å¿—æŸ¥çœ‹æ–¹å¼</span></span><br><span class="line">[root@db01 ~]# mysqlbinlog /app/mysql-5.6.50/data/mysql-bin.000010 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db04 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.7.44/data/mysql-bin.000001 </span><br><span class="line"><span class="built_in">base64</span>åŠ å¯†ç®—å‘½å»ç»™ä»–è§£ç </span><br><span class="line">decode-rows:è½¬ç </span><br><span class="line">incode  ç¼–ç </span><br><span class="line"></span><br><span class="line"><span class="comment">#åªçœ‹å’ŒæŸä¸ªbinlogåº“ç›¸å…³çš„æ•°æ®   -d+åº“å</span></span><br><span class="line">[root@db04 ~]# mysqlbinlog --base64-output=decode-rows -vvv -d binlog /app/mysql-5.7.44/data/mysql-bin.000001 </span><br><span class="line"></span><br><span class="line">mysql5.6:ä¸€èˆ¬æ–°æ•°æ®åº“at 120ä½ç½®ç‚¹ä¹‹åå°±æ˜¯å†™å…¥çš„æ•°æ®</span><br><span class="line">mysql5.7:ä¸€èˆ¬æ–°æ•°æ®åº“at 154ä½ç½®ç‚¹ä¹‹åå°±æ˜¯å†™å…¥çš„æ•°æ®</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#mysqlbinlogç”¨çš„ä»€ä¹ˆå·¥ä½œæ¨¡å¼ï¼Œæ€ä¹ˆè§£ææ•°æ®çš„ï¼Ÿ  é¢è¯•é—®é¢˜</span></span><br><span class="line">è¡Œçº§æ¨¡å¼</span><br><span class="line">mysqlbinlog --base64-output=decode-rows -vvv    å°±å¯ä»¥è§£æå‡ºæ¥</span><br></pre></td></tr></table></figure><p><strong>äºŒè¿›åˆ¶æ—¥å¿—çš„æ“ä½œ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¼€å¯æ–¹å¼ </span></span><br><span class="line"><span class="comment">#æ³¨æ„:åœ¨mysql5.7ä¸­å¼€å¯binlogå¿…é¡»è¦åŠ ä¸Šserver-idã€‚</span></span><br><span class="line">[root@db01 data]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">.....</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog_format=row</span><br><span class="line">server_id=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰æœ‰å“ªäº›binlog  ä»¥åŠbinlogçš„å¤§å°</span></span><br><span class="line">ç‰©ç†æ–¹æ³•</span><br><span class="line">[root@db04 ~]# ll /app/mysql-5.7.44/data/</span><br><span class="line">-rw-r----- 1 mysql mysql      688 Aug 20 14:26 mysql-bin.000001</span><br><span class="line"></span><br><span class="line">mysqlå‘½ä»¤è¡ŒæŸ¥çœ‹</span><br><span class="line">root@localhost:(none) &gt; show binary logs;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰æœ€æ–°çš„binlogå’Œä½ç½®ç‚¹</span></span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æŒ‡å®šbinlogä¸­çš„æ‰€æœ‰äº‹ä»¶ï¼Œä¸é€‚åˆçœ‹è¡Œçº§æ¨¡å¼</span></span><br><span class="line">root@localhost:(none) &gt; show binlog events <span class="keyword">in</span>  <span class="string">&#x27;mysql-bin.000012&#x27;</span>;</span><br></pre></td></tr></table></figure><p>äº‹ä»¶ä»‹ç»<br>1ï¼‰åœ¨binlogä¸­æœ€å°çš„è®°å½•å•å…ƒä¸ºevent<br>2ï¼‰ä¸€ä¸ªäº‹åŠ¡ä¼šè¢«æ‹†åˆ†æˆå¤šä¸ªäº‹ä»¶ï¼ˆeventï¼‰</p><p><strong>äº‹ä»¶çš„ç‰¹æ€§(binlogçš„ç‰¹æ€§)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1ï¼‰æ¯ä¸ªeventéƒ½æœ‰ä¸€ä¸ªå¼€å§‹ä½ç½®ï¼ˆstart positionï¼‰å’Œç»“æŸä½ç½®ï¼ˆstop positionï¼‰ã€‚</span><br><span class="line">2ï¼‰æ‰€è°“çš„ä½ç½®å°±æ˜¯eventå¯¹æ•´ä¸ªäºŒè¿›åˆ¶çš„æ–‡ä»¶çš„ç›¸å¯¹ä½ç½®ï¼ˆæ–‡ä»¶å¤§å°ï¼‰</span><br><span class="line">3ï¼‰å¯¹äºä¸€ä¸ªäºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œå‰120ä¸ªpositionæ˜¯æ–‡ä»¶æ ¼å¼ä¿¡æ¯é¢„ç•™ç©ºé—´ï¼ˆMySQL5.6ï¼‰ã€‚</span><br><span class="line">   å¯¹äºä¸€ä¸ªäºŒè¿›åˆ¶æ—¥å¿—ä¸­ï¼Œå‰154ä¸ªpositionæ˜¯æ–‡ä»¶æ ¼å¼ä¿¡æ¯é¢„ç•™ç©ºé—´ï¼ˆMySQL5.7ï¼‰</span><br><span class="line">4ï¼‰MySQLç¬¬ä¸€ä¸ªè®°å½•çš„äº‹ä»¶ï¼Œéƒ½æ˜¯ä»120å¼€å§‹çš„</span><br></pre></td></tr></table></figure><p><strong>åˆ©ç”¨äºŒè¿›åˆ¶æ—¥å¿—æ¢å¤æ•°æ®    ï¼ˆMySQL 5.6ï¼‰</strong></p><p>1ã€æ¨¡æ‹Ÿæ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">1ã€#åˆ·æ–°çš„binlog,å¹¶ä¸”ä»120å¼€å§‹</span><br><span class="line">root@localhost:(none) &gt; flush logs;</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000012 |      120 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line"></span><br><span class="line">2ã€#åˆ›å»ºbinlogåº“ è¡¨ </span><br><span class="line">root@localhost:(none) &gt; create database binlog;</span><br><span class="line">root@localhost:(none) &gt; use binlog;</span><br><span class="line">root@localhost:binlog &gt; create table binlog_table(<span class="built_in">id</span> int);</span><br><span class="line"></span><br><span class="line">3ã€#æ’å…¥æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; insert into binlog_table values(1);</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">4ã€#å†æ’å…¥æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; insert into binlog_table values(2);</span><br><span class="line">root@localhost:binlog &gt; insert into binlog_table values(3);</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">5ã€#åˆ é™¤ä¸€æ¡æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; delete from binlog_table <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line">root@localhost:binlog:18: &gt;<span class="keyword">select</span> * from binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">| 2    |</span><br><span class="line">| 3    |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">6ã€#ä¿®æ”¹ä¸€æ¡æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; update binlog_table <span class="built_in">set</span> <span class="built_in">id</span>=22 <span class="built_in">where</span> <span class="built_in">id</span>=2;</span><br><span class="line">root@localhost:binlog &gt; <span class="keyword">select</span> * from binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   22 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">7ã€#åˆ è¡¨</span><br><span class="line">root@localhost:binlog &gt; drop table binlog_table;</span><br><span class="line"></span><br><span class="line">8ã€#åˆ åº“</span><br><span class="line">root@localhost:binlog &gt; drop database binlog;</span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨bin log æ¢å¤æ•°æ®åˆ°deleteä¹‹å‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">æ¢å¤åˆ°ï¼š </span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">ä½ è¦çŸ¥é“ä½ åœ¨è¿™ä¸ªçŠ¶æ€ä¹‹åæ‰§è¡Œäº†ä»€ä¹ˆï¼šæ‰§è¡Œäº†delete</span><br><span class="line"></span><br><span class="line">1ã€#å‡†å¤‡ä¸€ä¸ªæ–°ç¯å¢ƒ db02</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line">2ã€#æŠŠæ—§ç¯å¢ƒçš„æ•°æ®åº“è¿›è¡Œå…¨å¤‡</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A &gt; /tmp/full.sql</span><br><span class="line"></span><br><span class="line">3ã€#æ–°ç¯å¢ƒdb02åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è¿æ¥çš„ç”¨æˆ·(å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¯ä»¥åˆ›å»ºç”¨æˆ·è¿œç¨‹æ¢å¤)</span><br><span class="line">root@localhost:(none) &gt; grant all on *.* to root@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | %         |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#db01å°†å…¨å¤‡æ¢å¤åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db01 ~]# mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/full.sql </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€#æ—§ç¯å¢ƒæˆªå–binlog</span><br><span class="line">å› ä¸ºä¸€å¼€å§‹åˆ·æ–°çš„binlog,æ‰€ä»¥èµ·å§‹ä½ç½®ç‚¹ä»120å¼€å§‹ mysql-bin.000012</span><br><span class="line">èµ·å§‹ä½ç½®ç‚¹ï¼š120</span><br><span class="line">ç»“æŸä½ç½®ç‚¹: <span class="built_in">id</span>ä¸º1 2 3 ä¹‹åï¼Œæ‰§è¡Œäº†delete   </span><br><span class="line">[root@db01 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000012 | grep -iC 10 delete</span><br><span class="line"><span class="comment"># at 937</span></span><br><span class="line"><span class="comment">#240820 11:18:12 server id 1  end_log_pos 1011 CRC32 0x9073f227         Query   thread_id=2     exec_time=0     error_code=0</span></span><br><span class="line">SET TIMESTAMP=1724123892/*!*/;</span><br><span class="line">BEGIN</span><br><span class="line">/*!*/;</span><br><span class="line">......</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line"></span><br><span class="line">æŸ¥åˆ°ç»“æŸä½ç½®ç‚¹å°±æ˜¯ï¼š937 (ä¸Šä¸‹10è¡Œ begin å‰é¢çš„at 937)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆªå–</span></span><br><span class="line">[root@db01 ~]# mysqlbinlog --start-position=120 --stop-position=937 /app/mysql-5.6.50/data/mysql-bin.000012 &gt; /tmp/binlog.sql</span><br><span class="line"></span><br><span class="line">6ã€#æ¢å¤æˆªå–çš„æ•°æ®åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db01 ~]# mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/binlog.sql </span><br><span class="line"></span><br><span class="line">7ã€#db02æ–°ç¯å¢ƒæŸ¥çœ‹æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from binlog.binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">8ã€#å…¨å¤‡å®Œäº†ï¼Œç”¨æˆ·å¦‚æœè¿˜åœ¨å¾€æ—§æ•°æ®åº“å†™æ•°æ®ï¼Œéœ€è¦æ¢å¤</span><br><span class="line"></span><br><span class="line">9ã€#åº”ç”¨å‰²æ¥</span><br><span class="line">      - å¼€å‘æ”¹ä»£ç </span><br><span class="line">      - è¿ç»´å¯¼å‡ºæ–°ç¯å¢ƒçš„æ•°æ®åˆ°æ—§ç¯å¢ƒ</span><br></pre></td></tr></table></figure><p><strong>å­˜åœ¨é—®é¢˜</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç”Ÿäº§ä¸­ä¸ä¼šåˆ·æ–°binlog</span><br><span class="line"></span><br><span class="line">2ã€ç”Ÿäº§ä¸­è‚¯å®šä¼šä¸€ç›´æä¾›æœåŠ¡ï¼Œå®æ—¶éƒ½åœ¨å†™å…¥æ•°æ®</span><br><span class="line"></span><br><span class="line">3ã€ç”Ÿäº§ä¸­æˆªå–æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šæˆªå–åˆ°å…¶ä»–åº“çš„æ•°æ®</span><br><span class="line">åŠ ä¸Š-d  åªæˆªå–å’Œbinlogç›¸å…³çš„åº“</span><br><span class="line">[root@db01 data]# mysqlbinlog --base64-output=decode-rows -vvv -d binlog</span><br><span class="line">/app/mysql/data/mysql-bin.000030</span><br><span class="line"></span><br><span class="line">120~937ä½ç½®ç‚¹ä¸­åŒ…å«binlogåº“çš„æ•°æ®</span><br><span class="line">[root@db01 data]# mysqlbinlog --start-position=120 --stop-position=937 -d binlog /app/mysql/data/mysql-bin.000030 &gt; /tmp/binlog.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰€ä»¥ä¸èƒ½å•ç‹¬ä½¿ç”¨binlogæˆªå–æ•°æ®ï¼Œå¯ä»¥æ¯å¤©å‡Œæ™¨ä¸€ç‚¹åœ¨å®šæ—¶ä»»åŠ¡é‡Œé¢åšä¸€æ¬¡å…¨å¤‡</span></span><br><span class="line"><span class="comment">#binlogåªèƒ½ç”¨æ¥å½“æˆæ˜¯å¢é‡æ•°æ®çš„å¤‡ä»½ï¼Œä¸€å®šè¦é…åˆmysqldumé€»è¾‘å¤‡ä»½çš„å…¨å¤‡ä¸€èµ·ä½¿ç”¨ï¼Œå•ç‹¬ä½¿ç”¨éå¸¸ç´¯</span></span><br></pre></td></tr></table></figure><p><strong>binlogçš„åˆ·æ–°å’Œåˆ é™¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#binlogåˆ·æ–°</span></span><br><span class="line">1ã€é‡å¯mysqlæ•°æ®åº“</span><br><span class="line">2ã€æ‰§è¡Œflush logs;</span><br><span class="line">3ã€mysqladmin -uroot -p123 flush-log</span><br><span class="line">4ã€å½“binlogå¤§å°åˆ°è¾¾1G,ä¼šè‡ªåŠ¨åˆ·æ–°</span><br><span class="line"></span><br><span class="line"><span class="comment">#binlogè¦å®šæœŸæ¸…ç†å’Œåˆ é™¤</span></span><br><span class="line">1ã€æ ¹æ®æ—¶é—´åˆ é™¤</span><br><span class="line"><span class="comment">#ä¸´æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line">root@localhost:(none) &gt; SET GLOBAL expire_logs_days = 7;</span><br><span class="line"><span class="comment">#æ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line">[root@db01 data]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">expire_logs_days = 7</span><br><span class="line"></span><br><span class="line">2ã€æ ¹æ®æ—¶é—´åˆ é™¤</span><br><span class="line">root@localhost:(none) &gt; PURGE BINARY LOGS BEFORE now() - INTERVAL 3 day;</span><br><span class="line"></span><br><span class="line">3ã€æ ¹æ®æ–‡ä»¶ååˆ é™¤(å¸¸ç”¨)</span><br><span class="line">root@localhost:(none) &gt; PURGE BINARY LOGS TO <span class="string">&#x27;mysql-bin.000020&#x27;</span>;</span><br><span class="line">20  ä¼šæŠŠ20ä¹‹å‰çš„å…¨éƒ¨åˆ é™¤</span><br></pre></td></tr></table></figure><p>4ã€æ…¢æŸ¥è¯¢æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">åªè¦ä¼šå¼€å¯ä»–å°±è¡Œäº† ä»–æ˜¯è®°å½•æ‰§è¡Œæ¯”è¾ƒæ…¢çš„SQLè¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½œç”¨ï¼šè®°å½•æ‰§è¡Œçš„æ¯”è¾ƒæ…¢çš„SQLè¯­å¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æ˜¯å¦å¼€å¯ï¼šå¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨ä½ç½®ï¼š/app/mysql/data/</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%slow%&#x27;</span>;</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| Variable_name             | Value                                |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line">| log_slow_admin_statements | OFF                                  |</span><br><span class="line">| log_slow_slave_statements | OFF                                  |</span><br><span class="line">| slow_launch_time          | 2                                    |</span><br><span class="line">| slow_query_log            | OFF                                  |</span><br><span class="line">| slow_query_log_file       | /app/mysql-5.6.50/data/db01-slow.log |</span><br><span class="line">+---------------------------+--------------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå­—ï¼šhostname-slow.log</span></span><br><span class="line">db01-slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–¹å¼</span></span><br><span class="line"><span class="comment">## ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment">#æŒ‡å®šæ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line">slow_query_log=1</span><br><span class="line"><span class="comment">#æŒ‡å®šæ…¢æ—¥å¿—æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼ˆé»˜è®¤åœ¨dataï¼‰</span></span><br><span class="line">slow_query_log_file=/app/mysql-5.6.50/data/db01-slow.log</span><br><span class="line"><span class="comment">#è®¾å®šæ…¢æŸ¥è¯¢çš„é˜€å€¼(é»˜è®¤10s)</span></span><br><span class="line">long_query_time=0.05</span><br><span class="line"><span class="comment">#ä¸ä½¿ç”¨ç´¢å¼•çš„æ…¢æŸ¥è¯¢è¯­å¥æ˜¯å¦è®°å½•åˆ°æ—¥å¿—</span></span><br><span class="line">log_queries_not_using_indexes</span><br><span class="line"><span class="comment">#æŸ¥è¯¢æ£€æŸ¥è¿”å›å°‘äºè¯¥å‚æ•°æŒ‡å®šè¡Œçš„SQLä¸è¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—  ï¼ˆé¸¡è‚‹ï¼‰</span></span><br><span class="line">min_examined_row_limit=100</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ¨¡æ‹Ÿæ…¢æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">#è¿›å…¥worldåº“</span></span><br><span class="line">mysql&gt; use world</span><br><span class="line"><span class="comment">#æŸ¥çœ‹è¡¨</span></span><br><span class="line">mysql&gt; show tables</span><br><span class="line"><span class="comment">#å°†cityè¡¨ä¸­æ‰€æœ‰å†…å®¹åŠ åˆ°t1è¡¨ä¸­</span></span><br><span class="line">mysql&gt; create table t1 <span class="keyword">select</span> * from city;</span><br><span class="line"><span class="comment">#æŸ¥çœ‹t1çš„è¡¨ç»“æ„</span></span><br><span class="line">mysql&gt; desc t1;</span><br><span class="line"><span class="comment">#å°†t1è¡¨æ‰€æœ‰å†…å®¹æ’å…¥åˆ°t1è¡¨ä¸­ï¼ˆå¤šæ’å…¥å‡ æ¬¡ï¼‰</span></span><br><span class="line">mysql&gt; insert into t1 <span class="keyword">select</span> * from t1;</span><br><span class="line">mysql&gt; insert into t1 <span class="keyword">select</span> * from t1;</span><br><span class="line">mysql&gt; insert into t1 <span class="keyword">select</span> * from t1;</span><br><span class="line">mysql&gt; insert into t1 <span class="keyword">select</span> * from t1;</span><br><span class="line"><span class="comment">#åˆ é™¤t1è¡¨ä¸­id&gt;2000çš„æ•°æ®</span></span><br><span class="line">mysql&gt; delete from t1 <span class="built_in">where</span> <span class="built_in">id</span>&gt;2000;</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ…¢æ—¥å¿—</span></span><br><span class="line">[root@db01 ~]# <span class="built_in">cat</span> /application/mysql/data/mysql-db01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db01 ~]# mysqldumpslow /app/mysql-5.6.50/data/db01-slow.log</span><br><span class="line">-sï¼šæŒ‡å®šæ’åºé¡ºåº</span><br><span class="line">      cï¼šCount æ‰§è¡Œæ¬¡æ•°</span><br><span class="line">      tï¼šTime æ‰§è¡Œæ—¶é—´ æ€»æ—¶é—´</span><br><span class="line">      rï¼šRows ç»“æœè¡Œæ•° æ€»è¡Œæ•°</span><br><span class="line">      lï¼šLock é”è¡¨æ—¶é—´ æ€»é”è¡¨æ—¶é—´</span><br><span class="line">      </span><br><span class="line">      atï¼šå¹³å‡æ—¶é—´</span><br><span class="line">      arï¼šå¹³å‡è¡Œæ•°</span><br><span class="line">      alï¼šå¹³å‡é”è¡¨æ—¶é—´</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨perconaå…¬å¸æä¾›çš„pt-query-digestå·¥å…·åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">https://www.percona.com/  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€ä¸‹è½½å¹¶å®‰è£…</span><br><span class="line">[root@db01 ~]# yum install -y https://downloads.percona.com/downloads/percona-toolkit/3.6.0/binary/redhat/7/x86_64/percona-toolkit-3.6.0-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">2ã€è¿™æ¡å‘½ä»¤å°±å¯ä»¥åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—</span><br><span class="line">[root@db01 ~]# pt-query-digest /app/mysql-5.6.50/data/db01-slow.log </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¯è§†åŒ–ç•Œé¢ï¼š</span><br><span class="line">AnemometeråŸºäºpt-query-digestå°†MySQLæ…¢æŸ¥è¯¢å¯è§†åŒ–</span><br><span class="line">httpss://www.percona.com/downloads/percona-toolkit/LATEST/ æ…¢æ—¥å¿—åˆ†æå·¥å…·ä¸‹è½½</span><br><span class="line">httpss://github.com/box/Anemometer å¯è§†åŒ–ä»£ç ä¸‹è½½</span><br></pre></td></tr></table></figure><p><strong>åœ¨æ¢å¤æ•°æ®æ—¶ï¼Œæ•°æ®åº“åœ¨å®æ—¶å†™å…¥æ•°æ®ï¼Œæ€ä¹ˆæ¢å¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¾€æ•°æ®åº“ä¸€ç›´å†™æ•°æ®çš„è„šæœ¬</span></span><br><span class="line">[root@db01 ~]# vim insert.sh </span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">master_ip=$(hostname -I|awk  <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">mysql_cli=<span class="string">&quot;mysql -uroot -p123 -h<span class="variable">$&#123;master_ip&#125;</span>&quot;</span></span><br><span class="line"><span class="variable">$&#123;mysql_cli&#125;</span> -e <span class="string">&#x27;drop database if exists prod;&#x27;</span></span><br><span class="line"><span class="variable">$&#123;mysql_cli&#125;</span> -e <span class="string">&#x27;create database if not exists prod;&#x27;</span></span><br><span class="line"><span class="variable">$&#123;mysql_cli&#125;</span> -e <span class="string">&#x27;create table if not exists prod.prod(id int primary key auto_increment);&#x27;</span></span><br><span class="line">num=1</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span></span><br><span class="line"> <span class="variable">$&#123;mysql_cli&#125;</span> -e <span class="string">&quot;insert into prod.prod values(<span class="subst">$((num++)</span>));commit;&quot;</span></span><br><span class="line"> <span class="built_in">sleep</span> 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>1ã€æ¨¡æ‹Ÿå†™æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">1ã€#è¿è¡Œè„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh</span><br><span class="line"></span><br><span class="line">2ã€#åˆ›å»ºbinlogåº“ è¡¨ </span><br><span class="line">root@localhost:(none) &gt; create database binlog;</span><br><span class="line">root@localhost:(none) &gt; use binlog;</span><br><span class="line">root@localhost:binlog &gt; create table binlog_table(<span class="built_in">id</span> int);</span><br><span class="line"></span><br><span class="line">3ã€#æ’å…¥æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; insert into binlog_table values(1);</span><br><span class="line"></span><br><span class="line">4ã€#å†æ’å…¥æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; insert into binlog_table values(2);</span><br><span class="line">root@localhost:binlog &gt; insert into binlog_table values(3);</span><br><span class="line"></span><br><span class="line">5ã€#åˆ é™¤ä¸€æ¡æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; delete from binlog_table <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line"></span><br><span class="line">6ã€#ä¿®æ”¹ä¸€æ¡æ•°æ®</span><br><span class="line">root@localhost:binlog &gt; update binlog_table <span class="built_in">set</span> <span class="built_in">id</span>=22 <span class="built_in">where</span> <span class="built_in">id</span>=2;</span><br><span class="line"></span><br><span class="line">7ã€#åˆ è¡¨</span><br><span class="line">root@localhost:binlog &gt; drop table binlog_table;</span><br><span class="line"></span><br><span class="line">8ã€#åˆ åº“</span><br><span class="line">root@localhost:binlog &gt; drop database binlog;</span><br></pre></td></tr></table></figure><p>2ã€æ¢å¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">æ¢å¤åˆ°ï¼š </span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">ä½ è¦çŸ¥é“ä½ åœ¨è¿™ä¸ªçŠ¶æ€ä¹‹åæ‰§è¡Œäº†ä»€ä¹ˆï¼šæ‰§è¡Œäº†delete</span><br><span class="line">å¦‚æœæ—§ç¯å¢ƒè¿˜èƒ½æä¾›æœåŠ¡å°±æš‚æ—¶ä¸åœæ­¢åº“ï¼Œä¸€ä¼šå†åœæ­¢</span><br><span class="line"></span><br><span class="line">1ã€#å‡†å¤‡ä¸€ä¸ªæ–°ç¯å¢ƒ db02</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#æ—§ç¯å¢ƒæˆªå–binlogæ•°æ®çš„ä½ç½®ç‚¹</span><br><span class="line">[root@db01 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015|grep -iC 10  <span class="string">&#x27;create database binlog&#x27;</span></span><br><span class="line">å¼€å§‹ä½ç½®ï¼š11999</span><br><span class="line">[root@db01 ~]#  mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015|grep -iC 10 <span class="string">&#x27;delete from `binlog`&#x27;</span></span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š30114</span><br><span class="line"></span><br><span class="line">åªæ¢å¤binlogåº“æ•°æ®çš„æˆªå–</span><br><span class="line">[root@db01 ~]# mysqlbinlog --start-position=11999 --stop-position=30114 -d binlog /app/mysql-5.6.50/data/mysql-bin.000015 &gt; /tmp/binlog.sql </span><br><span class="line"></span><br><span class="line">3ã€#æ–°ç¯å¢ƒdb02åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿œç¨‹è¿æ¥çš„ç”¨æˆ·(å¦‚æœæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¯ä»¥åˆ›å»ºç”¨æˆ·è¿œç¨‹æ¢å¤)</span><br><span class="line">root@localhost:(none) &gt; grant all on *.* to root@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">4ã€#db01å°†æˆªå–çš„æ•°æ®æ¢å¤åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db01 ~]# mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/binlog.sql </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€#æ–°ç¯å¢ƒæŸ¥çœ‹æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; show databases;</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from binlog.binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">6ã€#åº”ç”¨å‰²æ¥   è¿ç»´å¯¼å‡ºæ–°ç¯å¢ƒbinlogçš„æ•°æ®åˆ°æ—§ç¯å¢ƒ</span><br><span class="line">[root@db02 ~]# mysqldump -B binlog &gt; /tmp/binlog2.sql</span><br><span class="line">[root@db02 ~]# scp /tmp/binlog2.sql 172.16.1.51:/tmp</span><br><span class="line"></span><br><span class="line">7ã€#æŒ‚ç»´æŠ¤é¡µï¼Œåœæ­¢è¿æ¥æ•°æ®åº“çš„ç¨‹åºtomcat phpï¼Œä¸èƒ½åœæ­¢æ•°æ®åº“ï¼Œå› ä¸ºå¯¼å…¥æ•°æ®éœ€è¦ä½¿ç”¨mysqlå®¢æˆ·ç«¯çš„å‘½ä»¤</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8ã€#æ–°ç¯å¢ƒå…³é—­binlogçš„è®°å½•ï¼Œé˜²æ­¢binlogè¢«æ±¡æŸ“,å†æ¢å¤æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line">root@localhost:binlog &gt; <span class="built_in">source</span> /tmp/binlog2.sql;</span><br><span class="line"></span><br><span class="line">9ã€#å¼€å¯binlogçš„è®°å½•</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line">root@localhost:binlog &gt; <span class="keyword">select</span> * from binlog_table;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">10ã€#å–æ¶ˆç»´æŠ¤é¡µï¼Œå¼€å¯è¿æ¥æ•°æ®åº“çš„æœåŠ¡</span><br></pre></td></tr></table></figure><h3 id="MySQLæ•°æ®å¤‡ä»½å’Œæ¢å¤">MySQLæ•°æ®å¤‡ä»½å’Œæ¢å¤</h3><p><strong>å¤‡ä»½çš„åŸå› </strong><br>è¿ç»´å·¥ä½œçš„æ ¸å¿ƒç®€å•æ¦‚æ‹¬å°±ä¸¤ä»¶äº‹:<br>1ï¼‰ç¬¬ä¸€ä¸ªæ˜¯ä¿æŠ¤å…¬å¸çš„æ•°æ®.<br>2ï¼‰ç¬¬äºŒä¸ªæ˜¯è®©ç½‘ç«™èƒ½7*24å°æ—¶æä¾›æœåŠ¡(ç”¨æˆ·ä½“éªŒ)ã€‚</p><p><strong>å¤‡ä»½çš„ç±»å‹</strong><br>å†·å¤‡ä»½(åœæœåŠ¡åšå¤‡ä»½)ï¼š(mysqldumpåšä¸äº†)<br>è¿™äº›å¤‡ä»½åœ¨ç”¨æˆ·ä¸èƒ½è®¿é—®æ•°æ®æ—¶è¿›è¡Œï¼Œå› æ­¤æ— æ³•è¯»å–æˆ–ä¿®æ”¹æ•°æ®ã€‚è¿™äº›è„±æœºå¤‡ä»½ä¼šé˜»æ­¢æ‰§è¡Œä»»ä½•ä½¿ç”¨æ•°æ®çš„æ´»åŠ¨ã€‚è¿™äº›ç±»å‹çš„å¤‡ä»½ä¸ä¼šå¹²æ‰°æ­£å¸¸è¿è¡Œçš„ç³»ç»Ÿçš„æ€§èƒ½ã€‚ä½†æ˜¯ï¼Œå¯¹äºæŸäº›åº”ç”¨ç¨‹åºï¼Œä¼šæ— æ³•æ¥å—å¿…é¡»åœ¨ä¸€æ®µè¾ƒé•¿çš„æ—¶é—´é‡Œé”å®šæˆ–å®Œå…¨é˜»æ­¢ç”¨æˆ·è®¿é—®æ•°æ®ã€‚</p><p>æ¸©å¤‡ä»½(ä¸åœæœåŠ¡åšå¤‡ä»½ï¼Œä½†æ˜¯å¤‡ä»½è¿‡ç¨‹ä¸­ä¼šé”è¡¨)ï¼š<br>è¿™äº›å¤‡ä»½åœ¨è¯»å–æ•°æ®æ—¶è¿›è¡Œï¼Œä½†åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨è¿›è¡Œå¤‡ä»½æ—¶ä¸èƒ½ä¿®æ”¹æ•°æ®æœ¬èº«ã€‚è¿™ç§ä¸­é€”å¤‡ä»½ç±»å‹çš„ä¼˜ç‚¹æ˜¯ä¸å¿…å®Œå…¨é”å®šæœ€ç»ˆç”¨æˆ·ã€‚ä½†æ˜¯ï¼Œå…¶ä¸è¶³ä¹‹å¤„åœ¨äºæ— æ³•åœ¨è¿›è¡Œå¤‡ä»½æ—¶ä¿®æ”¹æ•°æ®é›†ï¼Œè¿™å¯èƒ½ä½¿è¿™ç§ç±»å‹çš„å¤‡ä»½ä¸é€‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºã€‚åœ¨å¤‡ä»½è¿‡ç¨‹ä¸­æ— æ³•ä¿®æ”¹æ•°æ®å¯èƒ½äº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚</p><p>çƒ­å¤‡ä»½(ä¸åœæœåŠ¡åšå¤‡ä»½ï¼Œä¹Ÿä¸é”è¡¨)ï¼š<br>è¿™äº›åŠ¨æ€å¤‡ä»½åœ¨è¯»å–æˆ–ä¿®æ”¹æ•°æ®çš„è¿‡ç¨‹ä¸­è¿›è¡Œï¼Œå¾ˆå°‘ä¸­æ–­æˆ–è€…ä¸ä¸­æ–­ä¼ è¾“æˆ–å¤„ç†æ•°æ®çš„åŠŸèƒ½ã€‚ä½¿ç”¨çƒ­å¤‡ä»½æ—¶ï¼Œç³»ç»Ÿä»å¯ä¾›è¯»å–å’Œä¿®æ”¹æ•°æ®çš„æ“ä½œè®¿é—®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ¢å¤æ•°æ®çš„æ—¶å€™ä¸€å®šè¦è·Ÿå¼€å‘ç¡®è®¤å¥½</span><br><span class="line"></span><br><span class="line">é€»è¾‘å¤‡ä»½ ç‰©ç†å¤‡ä»½å¯ä»¥ä¸€èµ·ç”¨ï¼Œå“ªç§é€Ÿåº¦å¿«ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨</span><br></pre></td></tr></table></figure><p><strong>å¤‡ä»½çš„å·¥å…·</strong></p><p>1ã€mysqldump (é€»è¾‘)<br>mysqlåŸç”Ÿè‡ªå¸¦å¾ˆå¥½ç”¨çš„é€»è¾‘å¤‡ä»½å·¥å…·</p><p>2ã€mysqlbinlog (é€»è¾‘)<br>å®ç°binlogå¤‡ä»½çš„åŸç”Ÿæ€å‘½ä»¤</p><p>3ã€xtrabackup (ç‰©ç†)<br>preconaå…¬å¸å¼€å‘çš„æ€§èƒ½å¾ˆé«˜çš„ç‰©ç†å¤‡ä»½å·¥å…·</p><p><strong>å¤‡ä»½çš„æ–¹å¼</strong></p><ul><li>é€»è¾‘å¤‡ä»½</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">åŸºäºSQLè¯­å¥çš„å¤‡ä»½</span><br><span class="line">1ï¼‰binlog</span><br><span class="line">2ï¼‰into outfile</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">secure-file-priv=/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸ªæ˜¯æ¢å¤è¡¨é‡Œé¢çš„çœŸå®æ•°æ®</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from world.city into outfile <span class="string">&#x27;/tmp/world_city.data&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ï¼‰mysqldump</span><br><span class="line">4ï¼‰replication(ä¸»ä»å¤åˆ¶)</span><br><span class="line">5) mysqlbinlog</span><br></pre></td></tr></table></figure><ul><li><p>ç‰©ç†å¤‡ä»½</p><p>åŸºäºæ•°æ®æ–‡ä»¶çš„å¤‡ä»½<br>1ï¼‰Xtrabackupï¼ˆperconaå…¬å¸å†™çš„)</p></li></ul><p><strong>å¤‡ä»½ç­–ç•¥</strong></p><ul><li>å…¨å¤‡ï¼šå¤‡ä»½æ‰€æœ‰æ•°æ®</li><li>å¢å¤‡ï¼šæ¯æ¬¡åŸºäºä¸Šä¸€æ¬¡å¤‡ä»½åæ–°å¢çš„æ•°æ®</li><li>å·®å¼‚å¤‡ä»½ï¼š(æ¯æ¬¡éƒ½åŸºäºå…¨å¤‡)</li></ul><p><img src="../image/study_img/image-20240821103326915.png" alt="image-20240821103326915"></p><p><strong>mysqldumpé€»è¾‘å¤‡ä»½å·¥å…·</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®¢æˆ·ç«¯å‘½ä»¤é€‰é¡¹</span></span><br><span class="line">-uï¼šæŒ‡å®šç”¨æˆ·</span><br><span class="line">-pï¼šæŒ‡å®šå¯†ç </span><br><span class="line">-hï¼šæŒ‡å®šä¸»æœº</span><br><span class="line">-Pï¼šæŒ‡å®šç«¯å£</span><br><span class="line">-Sï¼šæŒ‡å®šsocketæ–‡ä»¶</span><br></pre></td></tr></table></figure><p><strong>å¤‡ä»½å‘½ä»¤çš„é€‰é¡¹</strong></p><p>1ã€å…¨å¤‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-A  /  --all-databases :å¤‡ä»½mysqlçš„æ‰€æœ‰åº“å’Œæ‰€æœ‰è¡¨</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -A &gt; /tmp/full.sql  </span><br></pre></td></tr></table></figure><p>2ã€åº“çº§å¤‡ä»½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-B    /   --databases  ï¼šæŒ‡å®šåº“åšå¤‡ä»½</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysqldupm -uroot -p123 -B åº“å  åº“å åº“å  åº“å...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡å®šå•ä¸ªåº“åšå¤‡ä»½    (å¤‡ä»½å‡ºæ¥çš„æ–‡ä»¶æœ‰å»ºåº“è¯­å¥)</span></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -B world &gt; /tmp/world.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¢å¤æ–¹å¼</span></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 &lt; /tmp/world.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡å®šå¤šä¸ªåº“åšå¤‡ä»½</span></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -B world student &gt; /tmp/world_stu.sql</span><br></pre></td></tr></table></figure><p>3ã€è¡¨çº§å¤‡ä»½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸åŠ é€‰é¡¹ï¼Œç›´æ¥å†™åº“åå­—</span></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 world &gt; /tmp/world1.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¢å¤æ–¹å¼(æ¢å¤æ—¶éœ€è¦æŒ‡å®šä¸€ä¸ªåº“)</span></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 <span class="built_in">test</span> &lt; /tmp/world1.sql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># mysqldump -uroot -p123 åº“å è¡¨å è¡¨å è¡¨å è¡¨å...</span></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 linux8 city &gt; /tmp/linux8_city.sql</span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 linux8 prod &gt; /tmp/linux8_prod.sql</span><br></pre></td></tr></table></figure><p>4ã€æ‰“ç‚¹å¤‡ä»½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ‰“ç‚¹å¤‡ä»½(å¤‡ä»½ä½ç½®ç‚¹å’Œåå­—) </span></span><br><span class="line">å¥½å¤„ï¼šè¿™æ¬¡å…¨å¤‡å°±è®°å½•åˆ°è¿™ä¸ªä½ç½®ç‚¹äº†ï¼Œæ–°å¢çš„æ•°æ®å°±æ˜¯è¿™ä¸ªç‚¹ä¹‹åçš„ï¼Œæƒ³æˆªå–binlogï¼Œå¼€å§‹ä½ç½®ç‚¹å°±çœ‹è¿™ä¸ªç‚¹ï¼Œç»“æŸä½ç½®ç‚¹å»binlogé‡Œé¢æˆªå–</span><br><span class="line"></span><br><span class="line">--master-data=[0|1|2] ï¼š(æ¸©å¤‡é€‰é¡¹)  </span><br><span class="line"></span><br><span class="line">his option will turn --lock-all-tables on(ä½¿ç”¨è¿™ä¸ªé€‰é¡¹æ—¶ï¼Œä¼šæ‰“å¼€ --lock--all-tablesé€‰é¡¹ï¼Œä¼šé”è¡¨)</span><br><span class="line">unless --single-transaction is specified too(é™¤éåŠ å…¥ --single-transactionè¿™ä¸ªé€‰é¡¹ï¼Œå°±ä¸ä¼šè¢«é”è¡¨(å¿«ç…§)) </span><br><span class="line"></span><br><span class="line">0ï¼šå…³é—­è¿™ä¸ªé€‰é¡¹ï¼Œè·Ÿä¸å†™è¿™ä¸ªé€‰é¡¹ä¸€æ ·ï¼Œæ²¡æœ‰change masterçš„è®°å½•</span><br><span class="line">1ï¼šIf equal to 1, will <span class="built_in">print</span> it as a CHANGE MASTER <span class="built_in">command</span>; </span><br><span class="line">    <span class="comment">#æ‰“å°chenge masterè¯­å¥</span></span><br><span class="line">2ï¼š<span class="keyword">if</span> equal to 2, that <span class="built_in">command</span> will be prefixed with a comment symbol.</span><br><span class="line">    <span class="comment">#chenge masterå°†ä¼šè¢«æ³¨é‡Šæ‰(ä¸»ä»å¤åˆ¶å¯ä»¥ç”¨ 2æ¯”è¾ƒå¸¸ç”¨)  æ–‡ä»¶çš„22è¡Œè®°å½•</span></span><br></pre></td></tr></table></figure><p>5ã€å¿«ç…§å¤‡ä»½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¿«ç…§å¤‡ä»½</span></span><br><span class="line">--single--transactionï¼š(çƒ­å¤‡é€‰é¡¹) ä¸é”è¡¨ï¼Œä¸å½±å“ç”¨æˆ·æŒç»­å†™å…¥æ•°æ®</span><br><span class="line"></span><br><span class="line">åŠ å…¥è¿™ä¸ªé€‰é¡¹ï¼Œåœ¨å¤‡ä»½çš„æ—¶å€™å°±ç›¸å½“äºæ‹äº†å¿«ç…§ï¼Œå°±å¤‡ä»½åˆ°ç›®å‰çš„æŒ‡å®šä½ç½®ï¼Œåé¢ç”¨æˆ·å†™å…¥çš„æ•°æ®æˆ‘ä¸å¤‡ä»½ï¼Œåªæœ‰å¿«ç…§æˆ‘ä¸çŸ¥é“å¤‡ä»½åˆ°å“ªé‡Œï¼Œéœ€è¦é…åˆæ‰“ç‚¹å¤‡ä»½ä½¿ç”¨ï¼Œç”¨æˆ·å†™å…¥çš„æ•°æ®å°±æ˜¯è¿™ä¸ªç‚¹ä¹‹åçš„æ•°æ®</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¨å¤‡ä¸”çƒ­å¤‡çš„å‘½ä»¤</span></span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A --master-data=2 --single-transaction &gt; /tmp/full.sgl</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# vim /tmp/full.sgl</span><br><span class="line">22è¡Œï¼š</span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000015&#x27;</span>, MASTER_LOG_POS=105700;</span><br><span class="line">è®°å½•è¿™æ¬¡å…¨å¤‡ï¼Œå¤‡ä»½åˆ°mysql-bin.000015ï¼Œä½ç½®ç‚¹æ˜¯ï¼š10500ï¼Œè¿™ä¸ªç‚¹ä¹‹åçš„æ•°æ®å°±æ˜¯æ–°å¢æ•°æ®</span><br></pre></td></tr></table></figure><p>6ã€å¤‡ä»½å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Rï¼š å‡½æ•°å’Œå‚¨å­˜è¿‡ç¨‹æ˜¯å¼€å‘å†™ç¨‹åºçš„æ—¶å€™å†™çš„(å¦‚æœæœ‰å°±å¤‡ä»½ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸å¤‡ä»½ï¼Œä½†æ˜¯åŠ ä¸Šè¿™ä¸ªé€‰é¡¹ä¹Ÿæ²¡æœ‰ä»»ä½•å½±å“)</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123 -A -R --master-data=2 --single-transaction &gt; /tmp/full.sgl</span><br></pre></td></tr></table></figure><p>7ã€å¤‡ä»½è§¦å‘å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--triggers:  å¤‡ä»½è§¦å‘å™¨ (å¦‚æœå¼€å‘å†™äº†å°±å¤‡ä»½ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸å¤‡ä»½,åŠ ä¸Šè¿™ä¸ªé€‰é¡¹ä¹Ÿæ²¡æœ‰ä»»ä½•å½±å“)</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction &gt; /tmp/full.sgl</span><br><span class="line"></span><br><span class="line"><span class="comment">#å‹ç¼©</span></span><br><span class="line">mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction |gzip &gt; /tmp/full.sgl</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®Œæ•´çš„å¤‡ä»½è¯­å¥</span></span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction|gzip &gt; /tmp/full_$(<span class="built_in">date</span> +%F).sql.gz</span><br></pre></td></tr></table></figure><p>8ã€åˆ·æ–°binlogå¤‡ä»½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-Fï¼šåšå¤‡ä»½çš„åŒæ—¶ï¼Œæ¯å¤‡ä»½ä¸€ä¸ªåº“ï¼Œåˆ·æ–°ä¸€ä¸ªæ–°çš„binlogå‡ºæ¥(ä¸å¸¸ç”¨)</span><br><span class="line">å‡ºæ¥çš„æ˜¯æ²¡æœ‰ç”¨çš„binlog,å°æ–‡ä»¶å°±ä¼šå¤šï¼Œä¼šå¯¼è‡´inodeè¢«æ²¾æ»¡</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -B table1 table2 table3 -F &gt; /tmp/test_binlog.sql</span><br><span class="line">ä¼šåˆ·æ–°3ä¸ªbinlogå‡ºæ¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¤è¯†ï¼Œä½†ä¸ç”¨çš„é€‰é¡¹</span></span><br><span class="line">-d:ä»…å¤‡ä»½è¡¨ç»“æ„</span><br><span class="line">-t:ä»…å¤‡ä»½æ•°æ®</span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´çš„çƒ­å¤‡è¯­å¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ä»»ä½•åœºæ™¯çš„å¤‡ä»½å‘½ä»¤ï¼š</span><br><span class="line">å‹ç¼©ï¼Œå¹¶ä¸”è®°å½•å¤‡ä»½æ—¶é—´æˆ³,å†™è„šæœ¬ä¹Ÿé€‚ç”¨</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction|gzip &gt; /tmp/full_$(<span class="built_in">date</span> +%F).sql.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-rw-r--r--  1 root root 252419 Aug 22 00:55 full_2024-08-22.sql.gz</span><br><span class="line"><span class="comment">#è§£å‹ï¼Œæ¢å¤æ•°æ®ä¸éœ€è¦è§£å‹çš„</span></span><br><span class="line">[root@db01 ~]# gzip -d /tmp/full_2024-08-22.sql.gz </span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¢å¤æ•°æ®</span></span><br><span class="line">[root@db01 ~]# zcat /tmp/full_2024-08-22.sql.gz |mysql -uroot -p123</span><br></pre></td></tr></table></figure><p><font color = red> æ³¨æ„ï¼š</font><br>1ï¼‰mysqldumpåœ¨å¤‡ä»½å’Œæ¢å¤æ—¶éƒ½éœ€è¦MySQLå®ä¾‹å¯åŠ¨ä¸ºå‰æ<br>2ï¼‰ä¸€èˆ¬æ•°æ®é‡çº§100Gä»¥å†…ï¼Œå¤§çº¦15-30åˆ†é’Ÿå¯ä»¥æ¢å¤ï¼ˆPBã€EBå°±éœ€è¦è€ƒè™‘åˆ«çš„æ–¹å¼ï¼‰<br>3ï¼‰mysqldumpæ˜¯ä»¥è¦†ç›–çš„å½¢å¼æ¢å¤æ•°æ®çš„</p><p><strong>ä¼ä¸šæ•…éšœæ¢å¤æ¡ˆä¾‹1</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">èƒŒæ™¯ï¼š</span><br><span class="line">æ­£åœ¨è¿è¡Œçš„ç½‘ç«™ç³»ç»Ÿï¼ŒMySQLæ•°æ®åº“ï¼Œæ•°æ®é‡25Gï¼Œæ—¥ä¸šåŠ¡å¢é‡10-15Mã€‚</span><br><span class="line"></span><br><span class="line">å¤‡ä»½ç­–ç•¥ï¼š</span><br><span class="line">æ¯å¤©23ï¼š00ï¼Œè®¡åˆ’ä»»åŠ¡è°ƒç”¨mysqldumpæ‰§è¡Œå…¨å¤‡è„šæœ¬</span><br><span class="line"></span><br><span class="line">æ•…éšœæ—¶é—´ç‚¹ï¼š</span><br><span class="line">ä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="comment">#23~10ç‚¹çš„å¢é‡æ•°æ®è¦æˆªå–</span></span><br><span class="line"><span class="comment">#åˆ è¡¨è¯­å¥åé¢æ–°å¢çš„æ•°æ®ä¹Ÿè¦æˆªå–</span></span><br><span class="line"></span><br><span class="line">æ€è·¯ï¼š</span><br><span class="line">1ï¼‰åœä¸šåŠ¡é¿å…æ•°æ®çš„äºŒæ¬¡ä¼¤å®³</span><br><span class="line">2ï¼‰æ‰¾ä¸€ä¸ªä¸´æ—¶çš„åº“ï¼Œæ¢å¤å‰ä¸€å¤©çš„å…¨å¤‡</span><br><span class="line">3ï¼‰æˆªå–å‰ä¸€å¤©23ï¼š00åˆ°ç¬¬äºŒå¤©10ç‚¹è¯¯åˆ é™¤ä¹‹é—´çš„binlogï¼Œæ¢å¤åˆ°ä¸´æ—¶åº“</span><br><span class="line">4ï¼‰æµ‹è¯•å¯ç”¨æ€§å’Œå®Œæ•´æ€§</span><br><span class="line">5ï¼‰å¼€å¯ä¸šåŠ¡å‰çš„ä¸¤ç§æ–¹å¼</span><br><span class="line">    a.ç›´æ¥ä½¿ç”¨ä¸´æ—¶åº“é¡¶æ›¿åŸç”Ÿäº§åº“ï¼Œå‰ç«¯åº”ç”¨å‰²æ¥åˆ°æ–°åº“</span><br><span class="line">    b.å°†è¯¯åˆ é™¤çš„è¡¨å•ç‹¬å¯¼å‡ºï¼Œç„¶åå¯¼å…¥åˆ°åŸç”Ÿäº§ç¯å¢ƒ</span><br><span class="line">6ï¼‰å¼€å¯ä¸šåŠ¡</span><br></pre></td></tr></table></figure><p>1ã€æ•…éšœæ¨¡æ‹Ÿæ¼”ç»ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1ã€#å…ˆæ‰§è¡Œå†™å…¥æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€#åˆ›å»ºåº“åˆ›è¡¨</span><br><span class="line">root@localhost:(none) &gt; create database hexin;</span><br><span class="line">root@localhost:(none) &gt; use hexin;</span><br><span class="line">root@localhost:hexin &gt; create table hexin(<span class="built_in">id</span> int);</span><br><span class="line"></span><br><span class="line">3ã€#è¿è¡Œé‚£ä¹ˆä¹…äº†ï¼Œå¾€é‡Œé¢å†™ç‚¹æ•°æ®</span><br><span class="line">root@localhost:hexin &gt; insert into hexin values(1),(2),(3),(4);</span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">4ã€#å‡è®¾ç°åœ¨åˆ°æ™šä¸Š23ç‚¹äº†ï¼Œä»»åŠ¡è®¡åˆ’è‡ªåŠ¨åšå…¨å¤‡</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction|gzip &gt; /tmp/full_$(<span class="built_in">date</span> +%F).sql.gz</span><br><span class="line"></span><br><span class="line">5ã€#æ¨¡æ‹Ÿæ–°å¢æ•°æ®</span><br><span class="line">root@localhost:hexin &gt; update hexin <span class="built_in">set</span> <span class="built_in">id</span>=10 <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">root@localhost:hexin &gt; delete from hexin <span class="built_in">where</span> <span class="built_in">id</span>=3;</span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">6ã€#ä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨</span><br><span class="line">root@localhost:hexin &gt; drop table hexin;</span><br><span class="line"></span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">ERROR 1146 (42S02): Table <span class="string">&#x27;hexin.hexin&#x27;</span> doesn<span class="string">&#x27;t exist</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¦‚æœç½‘ç«™ä¸èƒ½æä¾›æœåŠ¡äº†å°±åœæ­¢æ•°æ®åº“ï¼Œå¦‚æœç½‘ç«™è¿˜èƒ½ä½¿ç”¨ï¼Œå°±å¯ä»¥ä¸åœæ­¢æ•°æ®åº“</span></span><br></pre></td></tr></table></figure><p>2ã€æ¢å¤(ä¸åœåº“)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">+------+   <span class="comment">#æ¢å¤åˆ°è¿™é‡Œ</span></span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€#å‡†å¤‡æ–°ç¯å¢ƒ  db02</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#æ–°ç¯å¢ƒåˆ›å»ºä¸€ä¸ªè¿œç¨‹è¿æ¥çš„ç”¨æˆ·</span><br><span class="line">root@localhost:(none) &gt; grant all on *.* to root@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#å°†å¤´ä¸€å¤©çš„å…¨å¤‡æ¢å¤åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db01 ~]# zcat /tmp/full_2024-08-22.sql.gz |mysql -uroot -p123 -h172.16.1.52</span><br><span class="line">æ–°ç¯å¢ƒæŸ¥çœ‹</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from hexin.hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">3ã€#æˆªå–binlogæ–°å¢æ•°æ®</span><br><span class="line">[root@db01 ~]# zcat /tmp/full_2024-08-22.sql.gz |<span class="built_in">head</span> -25</span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000015&#x27;</span>, MASTER_LOG_POS=527709;</span><br><span class="line">åœ¨å…¨å¤‡é‡Œé¢   <span class="string">&#x27;mysql-bin.000015   </span></span><br><span class="line"><span class="string">å¼€å§‹ä½ç½®ç‚¹ï¼š527709</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç»“æŸä½ç½®ç‚¹ï¼šä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨</span></span><br><span class="line"><span class="string">drop table hexinè¿™ä¸ªè¯­å¥ä¹‹å‰å°±æ˜¯ç»“æŸä½ç½®ç‚¹</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015 |grep -iC 10 &#x27;</span>drop table `hexin`<span class="string">&#x27;</span></span><br><span class="line"><span class="string">ç»“æŸä½ç½®ç‚¹ï¼š584459</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqlbinlog --start-position=527709 --stop-position=584459 /app/mysql-5.6.50/data/mysql-bin.000015 &gt; /tmp/inc1.sql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4ã€#å°†ç¬¬ä¸€æ®µçš„æ•°æ®æ¢å¤åˆ°æ–°ç¯å¢ƒ</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/inc1.sql </span></span><br><span class="line"><span class="string">æ–°ç¯å¢ƒæŸ¥çœ‹</span></span><br><span class="line"><span class="string">root@localhost:(none) &gt; select * from hexin.hexin;</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string">| id   |</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string">|   10 |</span></span><br><span class="line"><span class="string">|    2 |</span></span><br><span class="line"><span class="string">|    4 |</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5ã€#æŒ‚ç»´æŠ¤é¡µï¼Œåœæ­¢è¿æ¥æ•°æ®åº“çš„ç¨‹åº</span></span><br><span class="line"><span class="string">è¿™ä¸ªæ—¶å€™å¯ä»¥åœæ­¢è„šæœ¬æ‰§è¡Œ</span></span><br><span class="line"><span class="string">æŸ¥çœ‹æ€»çš„æ•°æ®</span></span><br><span class="line"><span class="string">root@localhost:hexin &gt; select count(*) from prod.prod;</span></span><br><span class="line"><span class="string">+----------+</span></span><br><span class="line"><span class="string">| count(*) |</span></span><br><span class="line"><span class="string">+----------+</span></span><br><span class="line"><span class="string">|     4366 |</span></span><br><span class="line"><span class="string">+----------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6ã€#æˆªå–åˆ è¡¨ä¹‹åçš„æ–°å¢æ•°æ®</span></span><br><span class="line"><span class="string">å¼€å§‹ä½ç½®ç‚¹ï¼šä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨</span></span><br><span class="line"><span class="string">drop table hexinè¿™ä¸ªè¯­å¥ä½ç½®ç‚¹ï¼Œçš„åé¢ä¸€ä¸ªä½ç½®ç‚¹</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015 |grep -iC 10 &#x27;</span>drop table `hexin`<span class="string">&#x27;</span></span><br><span class="line"><span class="string">SET @@session.pseudo_thread_id=2475/*!*/;</span></span><br><span class="line"><span class="string">DROP TABLE `hexin` /* generated by server */</span></span><br><span class="line"><span class="string">/*!*/;</span></span><br><span class="line"><span class="string"># at 584579</span></span><br><span class="line"><span class="string">#240822  1:54:12 server id 1</span></span><br><span class="line"><span class="string">å¼€æŸä½ç½®ç‚¹ï¼š584579</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç»“æŸä½ç½®ç‚¹ï¼š(éœ€è¦åœæ­¢è¿æ¥æ•°æ®åº“çš„æœåŠ¡æ‰å¥½æ‰¾ï¼Œä¸è¦å¾€æ•°æ®åº“é‡Œé¢å†™æ•°æ®)</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015|tail</span></span><br><span class="line"><span class="string"># at 940180                     ç»“æŸä½ç½®ç‚¹</span></span><br><span class="line"><span class="string">240822  2:26:40 server id 1  &#x27;</span>end_log_pos 940211<span class="string">&#x27; CRC32 0xd479131d       Xid = 26217</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æˆ–è€…ç›´æ¥çœ‹æ–‡ä»¶å¤§å°å°±å¯ä»¥ï¼Œç»“æŸä½ç½®ç‚¹å’Œbinlogæ–‡ä»¶åœæ­¢å†™å…¥çš„å¤§å°ä¸€æ ·</span></span><br><span class="line"><span class="string">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span></span><br><span class="line"><span class="string">-rw-rw---- 1 mysql mysql   940211 Aug 22 02:26 mysql-bin.000015</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç»“æŸä½ç½®ç‚¹ï¼š940211    (end_log_pos 940211)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqlbinlog --start-position=584579 --stop-position=940211 /app/mysql-5.6.50/data/mysql-bin.000015 &gt; /tmp/inc2.sql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7ã€#å°†ç¬¬äºŒæ®µçš„æ–°å¢æ•°æ®æ¢å¤åˆ°æ–°ç¯å¢ƒ</span></span><br><span class="line"><span class="string">[root@db01 ~]#  mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/inc2.sql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æ–°ç¯å¢ƒæŸ¥çœ‹æ€»çš„æ•°æ®ï¼Œå’Œæ—§ç¯å¢ƒçš„æ•°æ®ä¸€æ ·</span></span><br><span class="line"><span class="string">root@localhost:(none) &gt; select count(*) from prod.prod;</span></span><br><span class="line"><span class="string">+----------+</span></span><br><span class="line"><span class="string">| count(*) |</span></span><br><span class="line"><span class="string">+----------+</span></span><br><span class="line"><span class="string">|     4366 |</span></span><br><span class="line"><span class="string">+----------+</span></span><br><span class="line"><span class="string">1 row in set (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">root@localhost:(none) &gt; select * from hexin.hexin;</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string">| id   |</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string">|   10 |</span></span><br><span class="line"><span class="string">|    2 |</span></span><br><span class="line"><span class="string">|    4 |</span></span><br><span class="line"><span class="string">+------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">8ã€#åº”ç”¨å‰²æ¥</span></span><br><span class="line"><span class="string">        - è¿ç»´ï¼šæ–°ç¯å¢ƒå…¨å¤‡ï¼Œå¯¼å…¥æ—§ç¯å¢ƒ</span></span><br><span class="line"><span class="string">        - å¼€å‘ï¼šä¿®æ”¹è¿æ¥æ•°æ®åº“çš„ä»£ç </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">9ã€#å–æ¶ˆæŠ¤é¡µï¼Œå¼€å¯è¿æ¥æ•°æ®åº“çš„ç¨‹åº</span></span><br></pre></td></tr></table></figure><p><strong>ä¼ä¸šæ•…éšœæ¢å¤æ¡ˆä¾‹2</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">èƒŒæ™¯ï¼š</span><br><span class="line">æ­£åœ¨è¿è¡Œçš„ç½‘ç«™ç³»ç»Ÿï¼ŒMySQLæ•°æ®åº“ï¼Œæ•°æ®é‡25Gï¼Œæ—¥ä¸šåŠ¡å¢é‡10-15Mã€‚</span><br><span class="line"></span><br><span class="line">å¤‡ä»½ç­–ç•¥ï¼š</span><br><span class="line">æ¯å¤©23ï¼š00ï¼Œè®¡åˆ’ä»»åŠ¡è°ƒç”¨mysqldumpæ‰§è¡Œå…¨å¤‡è„šæœ¬</span><br><span class="line"></span><br><span class="line">æ•…éšœæ—¶é—´ç‚¹ï¼š</span><br><span class="line">ä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨ä¹‹å‰ï¼Œ<span class="string">&#x27;è¿˜è¯¯ä¿®æ”¹äº†ä¸€æ¡æ•°æ®,è¯¯å°†1æ”¹æˆ10äº†&#x27;</span>ï¼Œå¦‚ä½•æ¢å¤ï¼Ÿ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æœ€ç»ˆè¦æ¢å¤çš„æ•°æ®æ˜¯ï¼š</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆªå–æ€è·¯</span></span><br><span class="line">1ã€æˆªå–å…¨å¤‡~updateä¹‹å‰</span><br><span class="line">2ã€updateä¹‹å~(drop table hexin)ä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨ä¹‹å‰</span><br><span class="line">3ã€(drop table hexin)ä¹‹å~åœåº“</span><br></pre></td></tr></table></figure><p>1ã€æ•…éšœæ¨¡æ‹Ÿæ¼”ç»ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1ã€#å…ˆæ‰§è¡Œå†™å…¥æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€#åˆ›å»ºåº“åˆ›è¡¨</span><br><span class="line">root@localhost:(none) &gt; create database hexin;</span><br><span class="line">root@localhost:(none) &gt; use hexin;</span><br><span class="line">root@localhost:hexin &gt; create table hexin(<span class="built_in">id</span> int);</span><br><span class="line"></span><br><span class="line">3ã€#è¿è¡Œé‚£ä¹ˆä¹…äº†ï¼Œå¾€é‡Œé¢å†™ç‚¹æ•°æ®</span><br><span class="line">root@localhost:hexin &gt; insert into hexin values(1),(2),(3),(4);</span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">4ã€#å‡è®¾ç°åœ¨åˆ°æ™šä¸Š23ç‚¹äº†ï¼Œä»»åŠ¡è®¡åˆ’è‡ªåŠ¨åšå…¨å¤‡</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction|gzip &gt; /tmp/full_$(<span class="built_in">date</span> +%F).sql.gz</span><br><span class="line"></span><br><span class="line">5ã€#æ¨¡æ‹Ÿæ–°å¢æ•°æ®</span><br><span class="line">root@localhost:hexin &gt; update hexin <span class="built_in">set</span> <span class="built_in">id</span>=10 <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">root@localhost:hexin &gt; delete from hexin <span class="built_in">where</span> <span class="built_in">id</span>=3;</span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">6ã€#ä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨</span><br><span class="line">root@localhost:hexin &gt; drop table hexin;</span><br><span class="line"></span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> * from hexin;</span><br><span class="line">ERROR 1146 (42S02): Table <span class="string">&#x27;hexin.hexin&#x27;</span> doesn<span class="string">&#x27;t exist</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å¦‚æœç½‘ç«™ä¸èƒ½æä¾›æœåŠ¡äº†å°±åœæ­¢æ•°æ®åº“ï¼Œå¦‚æœç½‘ç«™è¿˜èƒ½ä½¿ç”¨ï¼Œå°±å¯ä»¥ä¸åœæ­¢æ•°æ®åº“</span></span><br></pre></td></tr></table></figure><p>2ã€æ¢å¤(ä¸åœåº“)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">+------+   <span class="comment">#æ¢å¤åˆ°è¿™é‡Œ</span></span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€#å‡†å¤‡æ–°ç¯å¢ƒ  db02</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">skip-name-resolve</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#æ–°ç¯å¢ƒåˆ›å»ºä¸€ä¸ªè¿œç¨‹è¿æ¥çš„ç”¨æˆ·</span><br><span class="line">root@localhost:(none) &gt; grant all on *.* to root@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;   <span class="comment">#å½“å…¨å¤‡æ¢å¤è¿‡æ¥ï¼Œè¿™ä¸ªç”¨æˆ·å°±ä¸åœ¨äº†ï¼Œæˆ‘ä»¬åé¢ç”¨è¿œç¨‹ç”¨æˆ·å¯¼æ•°æ®ï¼Œæ˜¯æ²¡æœ‰åˆ·æ–°è¡¨æˆ–è€…é‡å¯mysqlï¼Œå¦‚æœä¸€æ—¦åšäº†é‡å¯æˆ–è€…åˆ·æ–°ï¼Œè¿™ä¸ªç”¨æˆ·å°±ä¸èƒ½ç”¨äº†</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#å°†å¤´ä¸€å¤©çš„å…¨å¤‡æ¢å¤åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db01 ~]# zcat /tmp/full_2024-08-22.sql.gz |mysql -uroot -p123 -h172.16.1.52</span><br><span class="line">æ–°ç¯å¢ƒæŸ¥çœ‹</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from hexin.hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆªå–æ€è·¯</span></span><br><span class="line">1ã€æˆªå–å…¨å¤‡~updateä¹‹å‰</span><br><span class="line">2ã€updateä¹‹å~(drop table hexin)ä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨ä¹‹å‰</span><br><span class="line">3ã€(drop table hexin)ä¹‹å~åœåº“</span><br><span class="line"></span><br><span class="line">3ã€#æˆªå–å…¨å¤‡~updateä¹‹å‰</span><br><span class="line">[root@db01 ~]# zcat /tmp/full_2024-08-22.sql.gz |<span class="built_in">head</span> -25</span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000015&#x27;</span>, MASTER_LOG_POS=969876;</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š969876</span><br><span class="line"></span><br><span class="line">[root@db01 ~]#  mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015 |grep -iC 10 <span class="string">&#x27;update `hexin`&#x27;</span></span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š971995</span><br><span class="line"></span><br><span class="line">mysqlbinlog --start-position=969876 --stop-position=971995 /app/mysql-5.6.50/data/mysql-bin.000015 &gt; /tmp/inc1.sql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#æˆªå–updateä¹‹å~ä¸Šåˆ10ç‚¹å¼€å‘äººå‘˜è¯¯åˆ é™¤ä¸€ä¸ªæ ¸å¿ƒä¸šåŠ¡è¡¨</span><br><span class="line">[root@db01 ~]#  mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015 |grep -iC 10 <span class="string">&#x27;update `hexin`&#x27;</span></span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š972090</span><br><span class="line"></span><br><span class="line">[root@db01 ~]#  mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015 |grep -iC 10 <span class="string">&#x27;drop table `hexin`&#x27;</span></span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š979382</span><br><span class="line"></span><br><span class="line">mysqlbinlog --start-position=972090 --stop-position=979382 /app/mysql-5.6.50/data/mysql-bin.000015 &gt; /tmp/inc2.sql</span><br><span class="line"></span><br><span class="line">5ã€#æŒ‚ç»´æŠ¤é¡µï¼Œåœæ­¢è¿æ¥æ•°æ®åº“çš„ç¨‹åº</span><br><span class="line">è¿™ä¸ªæ—¶å€™å¯ä»¥åœæ­¢è„šæœ¬æ‰§è¡Œ</span><br><span class="line">æŸ¥çœ‹æ€»çš„æ•°æ®</span><br><span class="line">root@localhost:hexin &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     2115 |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line">6ã€#æˆªå–(drop table hexin)ä¹‹å~åœåº“(åœæ­¢è¿æ¥æ•°æ®åº“çš„ç¨‹åº)</span><br><span class="line">[root@db01 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/mysql-bin.000015 |grep -iC 10 <span class="string">&#x27;drop table `hexin`&#x27;</span></span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š979502</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql  1334948 Aug 22 04:25 mysql-bin.000015</span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š1334948</span><br><span class="line"></span><br><span class="line">mysqlbinlog --start-position=979502 --stop-position=1334948 /app/mysql-5.6.50/data/mysql-bin.000015 &gt; /tmp/inc3.sql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7ã€#å°†æ•°æ®æ¢å¤åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/inc1.sql</span><br><span class="line">mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/inc2.sql</span><br><span class="line">mysql -uroot -p123 -h172.16.1.52 &lt; /tmp/inc3.sql</span><br><span class="line"></span><br><span class="line">æ–°ç¯å¢ƒæŸ¥çœ‹æ€»çš„æ•°æ®ï¼Œå’Œæ—§ç¯å¢ƒçš„æ•°æ®ä¸€æ ·</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     2115 |</span><br><span class="line">+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from hexin.hexin;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    4 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">8ã€#åº”ç”¨å‰²æ¥</span><br><span class="line">        - è¿ç»´ï¼šæ–°ç¯å¢ƒå…¨å¤‡ï¼Œå¯¼å…¥æ—§ç¯å¢ƒ</span><br><span class="line">        - å¼€å‘ï¼šä¿®æ”¹è¿æ¥æ•°æ®åº“çš„ä»£ç </span><br><span class="line">        </span><br><span class="line">9ã€#å–æ¶ˆæŠ¤é¡µï¼Œå¼€å¯è¿æ¥æ•°æ®åº“çš„ç¨‹åº</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚æœåœ¨å°±æœåŠ¡å™¨é‡Œé¢æ¢å¤ï¼Œå…ˆæˆªå–ä½¿ç”¨æ•°æ®ï¼ŒæŠŠæ‰€æœ‰éœ€è¦çš„æ•°æ®æˆªå–å‡†å¤‡å¥½ï¼ŒåœæœåŠ¡ï¼ŒæŒ‰é¡ºåºä¸€æ¡ä¸€æ¡å¾€é‡Œé¢æ¢å¤</span><br></pre></td></tr></table></figure><h3 id="mysqlç‰©ç†å¤‡ä»½">mysqlç‰©ç†å¤‡ä»½</h3><p><strong>å®‰è£…xtrabackup</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½2.4ç‰ˆæœ¬çš„xtrabckup   db02</span><br><span class="line">[root@db02 ~]# wget https://downloads.percona.com/downloads/Percona-XtraBackup-2.4/Percona-XtraBackup-2.4.29/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.29-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">2ã€å®‰è£…</span><br><span class="line">[root@db02 ~]# yum localinstall -y percona-xtrabackup-24-2.4.29-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">3ã€å¯ä»¥tablå‡ºè¿™ä¸¤ä¸ªå‘½ä»¤å°±å®‰è£…æˆåŠŸ</span><br><span class="line"><span class="comment">#(çƒ­å¤‡çš„å‘½ä»¤,ä¸“é—¨innodbå‚¨å­˜å¼•æ“åšå¤‡ä»½çš„)</span></span><br><span class="line">[root@db02 ~]# innobackupex </span><br><span class="line"></span><br><span class="line"><span class="comment">#(è€ç‰ˆæœ¬çš„å‘½ä»¤,ä»–ä¹Ÿå¯ä»¥åšinnodbçš„å­˜å‚¨å¼•æ“,è¦é”è¡¨,ç›¸å½“äºæ¸©å¤‡äº†,å¯ä»¥å¤‡ä»»ä½•å‚¨å­˜å¼•æ“,å±äºæ¸©å¤‡)</span></span><br><span class="line">[root@db02 ~]# xtrabackup  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€é…ç½®æ–‡ä»¶åŠ ä¸Šsocketè·¯å¾„ï¼Œmysqlç”¨æˆ·éœ€è¦æœ‰è¿›å…¥è¿™ä¸ªç›®å½•çš„æƒé™</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line"><span class="comment">#äºŒè¿›åˆ¶å®‰è£…çš„mysqlé»˜è®¤åœ¨tmpä¸‹</span></span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"><span class="comment">#å®¢æˆ·ç«¯éœ€è¦æŒ‡å®šsocketæ–‡ä»¶ï¼Œä¸ç„¶å¤‡ä»½çš„æ—¶å€™ä¼šæŠ¥é”™</span></span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">5ã€å‡†å¤‡æ–°ç¯å¢ƒ  db02</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -fr /app/mysql/data</span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line">6ã€#å…ˆç»™rootç”¨æˆ·é…ç½®ä¸€ä¸ªå¯†ç </span><br><span class="line">[root@db02 ~]# mysqladmin -u root -p password 123</span><br><span class="line">Enter password: <span class="comment">#ç›´æ¥å›è½¦</span></span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">åˆ›å»ºä¸€ä¸ªç”¨æˆ·</span><br><span class="line">root@localhost:(none) &gt; grant all on *.* to root@<span class="string">&#x27;172.16.1.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>; </span><br></pre></td></tr></table></figure><p><strong>Xtrabackupä»‹ç»</strong><br>1ï¼‰å¯¹äºéinnodbè¡¨ï¼ˆæ¯”å¦‚myisamï¼‰æ˜¯ç›´æ¥é”è¡¨cpæ•°æ®æ–‡ä»¶ï¼Œå±äºä¸€ç§æ¸©å¤‡ã€‚<br>2ï¼‰å¯¹äºinnodbçš„è¡¨ï¼ˆæ”¯æŒäº‹åŠ¡ï¼‰ï¼Œä¸é”è¡¨ï¼Œcpæ•°æ®é¡µæœ€ç»ˆä»¥æ•°æ®æ–‡ä»¶æ–¹å¼ä¿å­˜ä¸‹æ¥ï¼Œå¹¶ä¸”æŠŠredoå’Œundoä¸€å¹¶å¤‡èµ°ï¼Œå±äºçƒ­å¤‡æ–¹å¼ã€‚<br>3ï¼‰å¤‡ä»½/æ¢å¤æ—¶è¯»å–é…ç½®æ–‡ä»¶/etc/my.cnf</p><p><strong>å…¨å¤‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">çƒ­å¤‡ï¼šå¤‡ä»½çš„æ—¶å€™ï¼Œå¯ä»¥å†™æ•°æ®</span><br><span class="line">æ¸©å¤‡ï¼šå¤‡ä»½çš„æ—¶å€™ï¼Œåªèƒ½è¯»ï¼Œä¸èƒ½å†™</span><br><span class="line"></span><br><span class="line">1ã€#ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line"><span class="comment">#äºŒè¿›åˆ¶å®‰è£…çš„mysqlé»˜è®¤åœ¨tmpä¸‹</span></span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line"><span class="comment">#å®¢æˆ·ç«¯éœ€è¦æŒ‡å®šsocketæ–‡ä»¶ï¼Œä¸ç„¶å¤‡ä»½çš„æ—¶å€™ä¼šæŠ¥é”™</span></span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#(çƒ­å¤‡)å…¨å¤‡çš„å‘½ä»¤</span><br><span class="line">rootæ— å¯†ç  (backupä¸éœ€è¦æå‰åˆ›å»ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºçš„)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root /backup</span><br><span class="line">rootæœ‰å¯†ç </span><br><span class="line">[root@db02 ~]# innobackupex --user=root  --password=<span class="string">&#x27;123&#x27;</span> /backup</span><br><span class="line">è¯·æ³¨æ„å¤‡ä»½ç»“æœæ˜¯å¦å®Œæˆ</span><br><span class="line">xtrabackup: Transaction <span class="built_in">log</span> of lsn (1625997) to (1625997) was copied.</span><br><span class="line">240822 15:16:57 completed OK!</span><br><span class="line"></span><br><span class="line"><span class="comment">#(é”è¡¨æ¸©å¤‡)å…¨å¤‡çš„å‘½ä»¤   å¦‚æœå…¬å¸ä¸æ˜¯inodbçš„å‚¨å­˜å¼•æ“ã€‚å°±ç”¨æ¸©å¤‡</span></span><br><span class="line">[root@db02 ~]# xtrabackup --user-root --password=123 --backup --target-dir=/tmp/full_$(<span class="built_in">date</span> +%F)</span><br><span class="line">è¯·æ³¨æ„å¤‡ä»½ç»“æœæ˜¯å¦å®Œæˆ</span><br><span class="line">xtrabackup: Transaction <span class="built_in">log</span> of lsn (1625997) to (1625997) was copied.</span><br><span class="line">240822 15:15:52 completed OK!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶</span><br><span class="line">[root@db02 ~]# ll /backup/2024-08-22_15-16-55/</span><br><span class="line">total 12316</span><br><span class="line">-rw-r----- 1 root root      481 Aug 22 15:16 backup-my.cnf   <span class="comment">#mysqlçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">-rw-r----- 1 root root 12582912 Aug 22 15:16 ibdata1         <span class="comment">#å…±äº«è¡¨ç©ºé—´,undoåœ¨é‡Œé¢</span></span><br><span class="line">drwxr-x--- 2 root root     4096 Aug 22 15:16 mysql</span><br><span class="line">drwxr-x--- 2 root root     4096 Aug 22 15:16 performance_schema</span><br><span class="line">drwxr-x--- 2 root root       20 Aug 22 15:16 <span class="built_in">test</span></span><br><span class="line">-rw-r----- 1 root root       21 Aug 22 15:16 xtrabackup_binlog_info  <span class="comment">#è®°å½•æ‰“ç‚¹å¤‡ä»½ å¤‡ä»½åˆ°çš„ä½ç½®ç‚¹</span></span><br><span class="line">-rw-r----- 1 root root      135 Aug 22 15:16 xtrabackup_checkpoints <span class="comment">#form_lsn  to_lsn  æŸ¥çœ‹å¢é‡å¤‡ä»½æ˜¯å¦è¡”æ¥</span></span><br><span class="line">-rw-r----- 1 root root      465 Aug 22 15:16 xtrabackup_info    <span class="comment">#è¿™æ¬¡å¤‡ä»½çš„ä¿¡æ¯</span></span><br><span class="line">-rw-r----- 1 root root     2560 Aug 22 15:16 xtrabackup_logfile   <span class="comment">#redo</span></span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/2024-08-22_15-16-55/xtrabackup_checkpoints</span><br><span class="line">backup_type = full-backuped   <span class="comment">#å¤‡ä»½ç±»å‹=å…¨å¤‡</span></span><br><span class="line">from_lsn = 0                  <span class="comment">#æ—¥å¿—ç‰ˆæœ¬å·èµ·ç‚¹ï¼šlsn:æ—¥å¿—ç‰ˆæœ¬å·  ä»0å·æ—¥å¿—ç‰ˆæœ¬å·å¼€å§‹å¤‡ä»½</span></span><br><span class="line">to_lsn = 1625997              <span class="comment">#æ—¥å¿—ç‰ˆæœ¬å·å¤‡ä»½åˆ°çš„ç‚¹ä½   å¤‡ä»½ç»“æŸä½ç½®ï¼š1625997</span></span><br><span class="line">last_lsn = 1625997            <span class="comment">#æœ€æ–°çš„æ—¥å¿—ç‰ˆæœ¬å·   å¦‚æœæœ‰ç”¨æˆ·å¾€é‡Œé¢å†™å…¥æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šæ¯”to_lsnå¤§</span></span><br><span class="line">compact = 0</span><br><span class="line">recover_binlog_info = 0       <span class="comment">#æ˜¯å¦è¦†ç›–äºŒè¿›åˆ¶çš„logä¿¡æ¯  0ï¼šå…³é—­</span></span><br><span class="line">flushed_lsn = 1625997         <span class="comment">#å¤‡ä»½å®Œæˆåè·å–åˆ°çš„æœ€æ–°lsn</span></span><br><span class="line">å¢å¤‡çš„from_lsn ä¸€å®šæ˜¯ä¸Šä¸€æ¬¡å¢å¤‡çš„to_lsn,è¦æ£€æŸ¥æ˜¯å¦è¡”æ¥ä¸Šï¼Œæ²¡æœ‰è¿æ¥ä¸Šï¼Œåšçš„å¢å¤‡æ•°æ®å°±ä¸å¯¹</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å°±å¥½æ¯”æ‰“ç‚¹å¤‡ä»½  æƒ³æˆªbinlog å¼€å§‹ä½ç½®ç‚¹å°±åœ¨è¿™é‡Œé¢çœ‹</span></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/2024-08-22_16-05-44/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000004        24251</span><br></pre></td></tr></table></figure><p><strong>å…¨å¤‡æ¢å¤</strong></p><p>æ¢å¤å…¨å¤‡çš„æ¡ä»¶ï¼š<br>1ã€è¢«æ¢å¤çš„ç›®å½•å¿…é¡»æ˜¯ç©ºçš„(dataç›®å½•æ˜¯ç©ºçš„)<br>2ã€è¢«æ¢å¤çš„æ•°æ®å®ä¾‹æ˜¯å…³é—­çš„(éœ€è¦åœåº“)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…¨å¤‡æ¢å¤ä¹‹å‰ï¼šéœ€è¦æ‰‹åŠ¨æ¨¡æ‹ŸCSRçš„æ¢å¤è¿‡ç¨‹ï¼ŒæŠŠredoä¸­çš„æ•°æ® é‡åšï¼Œundoä¸­çš„æ•°æ®  å›æ»š</span></span><br><span class="line">å› ä¸ºè¡¨ç©ºé—´é‡Œé¢çš„æ•°æ®æ˜¯ä¸å…¨çš„ï¼Œæœ‰ä¸€éƒ¨åˆ†åœ¨redo,å¦‚æœåªåšredo,redoé‡Œé¢å­˜åœ¨ä¸€ä¸‹æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œundoä¹Ÿè¦åšä¸€é</span><br><span class="line"></span><br><span class="line">1ã€#å…ˆåˆ é™¤ä¸€ä¸ªprodåº“,å†æ¢å¤æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     1077 |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; drop database prod;</span><br><span class="line"></span><br><span class="line">2ã€#å› ä¸ºæ˜¯ç‰©ç†å¤‡ä»½ï¼Œåšredo undoä¹‹å‰éœ€è¦åœæ­¢æ•°æ®åº“</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">3ã€#æ¨¡æ‹ŸCSRæ¢å¤è¿‡ç¨‹ï¼šæŠŠredoä¸­çš„æ•°æ® é‡åšï¼Œundoä¸­çš„æ•°æ®  å›æ»šï¼Œè¿™ä¸ªå‘½ä»¤ä¸éœ€è¦è¿æ¥æœåŠ¡ç«¯ï¼Œæ‰€ä»¥æ¢å¤æ•°æ®çš„æ—¶å€™å¯ä»¥åœåº“</span><br><span class="line">è¿™ä¸ªé‡åšè¦å°å¿ƒè°¨æ…ï¼Œè¿™ä¸ªæ˜¯ä¸€æ¬¡æ€§çš„ï¼Œåšå®Œäº†è¿™æ¬¡å¤‡ä»½å°±ä¸èƒ½ç”¨äº†ï¼Œåé¢æœ‰å¢é‡æ•°æ®ï¼Œå°±ä¸èƒ½ä»è¿™ä¸ªçš„åŸºç¡€ä¸Šåšå¢é‡å¤‡ä»½äº†</span><br><span class="line">innobackupex --apply-log +å…¨å¤‡çš„è·¯å¾„</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log /backup/2024-08-22_16-05-44/</span><br><span class="line"></span><br><span class="line">4ã€#æ¨¡æ‹Ÿå®Œæˆï¼ŒæŸ¥çœ‹ç›®å½•ï¼Œå¤šäº†å¥½å‡ ä¸ªä¸œè¥¿</span><br><span class="line">[root@db02 ~]# ll /backup/2024-08-22_16-05-44/</span><br><span class="line"></span><br><span class="line">5ã€#æ¢å¤  æ¸…ç©ºdataç›®å½•</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">æ¢å¤æ•°æ®</span><br><span class="line">innobackupex --copy-bak +å…¨å¤‡çš„è·¯å¾„</span><br><span class="line">[root@db02 ~]# innobackupex --copy-back /backup/2024-08-22_16-54-47/</span><br><span class="line">æˆæƒ</span><br><span class="line">[root@db02 ~]# <span class="built_in">chown</span> -R mysql.mysql /app/mysql-5.6.50/data</span><br><span class="line">å¯åŠ¨</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line">æŸ¥çœ‹æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|       53 |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line">----------------------ä¸ç”¨è¿™ç§æ–¹æ³•ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯åº•å±‚åŸç†---------------------</span><br><span class="line">5ã€#æ¢å¤  æ¸…ç©ºdataç›®å½•</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">æ¢å¤æ•°æ®</span><br><span class="line">[root@db02 ~]# <span class="built_in">mv</span> /backup/2024-08-22_16-05-44/ /app/mysql-5.6.50/data</span><br><span class="line">æˆæƒ</span><br><span class="line">[root@db02 ~]# <span class="built_in">chown</span> -R mysql.mysql /app/mysql-5.6.50/data</span><br><span class="line">å¯åŠ¨</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line">æŸ¥çœ‹æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|       53 |</span><br><span class="line">+----------+</span><br><span class="line">----------------------------------------------------------</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@db02 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€ç­‰å¾…ä¸€ä¼š åšå…¨å¤‡</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=<span class="string">&#x27;123&#x27;</span> /backup</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹æ•°æ®é‡Œé¢æ˜¯å¦æœ‰æ•°æ®ï¼Œå¹¶åˆ é™¤æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|      211 |</span><br><span class="line">+----------+</span><br><span class="line">root@localhost:(none) &gt; drop database prod;</span><br><span class="line"></span><br><span class="line">4ã€ç­‰å¾…ä¸€ä¼šï¼Œåœæ­¢è„šæœ¬ï¼Œè¿›è¡Œæ•°æ®çš„æ¢å¤</span><br><span class="line">[root@db02 ~]# sh insert.sh ^C</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">æ¨¡æ‹ŸCSR</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log /backup/2024-08-22_17-09-10/</span><br><span class="line">æ¨¡æ‹Ÿå®Œæˆï¼ŒæŸ¥çœ‹ç›®å½•ï¼Œå¤šäº†å¥½å‡ ä¸ªä¸œè¥¿</span><br><span class="line">[root@db02 ~]# ll /backup/2024-08-22_17-09-10/</span><br><span class="line">[root@db02 ~]# innobackupex --copy-back /backup/2024-08-22_17-09-10/</span><br><span class="line">[root@db02 ~]# <span class="built_in">chown</span> -R mysql.mysql /app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line">æŸ¥çœ‹æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|      113 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure><p><strong>å¢é‡å¤‡ä»½å’Œæ¢å¤</strong></p><p>å¤‡ä»½æ–¹å¼<br>1ï¼‰åŸºäºä¸Šä¸€æ¬¡å¤‡ä»½è¿›è¡Œå¢é‡<br>2ï¼‰å¢é‡å¤‡ä»½æ— æ³•å•ç‹¬æ¢å¤ï¼Œå¿…é¡»åŸºäºå…¨å¤‡è¿›è¡Œæ¢å¤<br>3ï¼‰æ‰€æœ‰å¢é‡å¿…é¡»è¦æŒ‰é¡ºåºåˆå¹¶åˆ°å…¨å¤‡å½“ä¸­</p><p>1ã€å¤‡ä»½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">1ã€æ‰§è¡Œè„šæœ¬</span><br><span class="line">[root@db02 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€å…¨å¤‡  ç­‰å¾…ä¸€ä¼š åšå…¨å¤‡ä¸å¸¦æ—¶é—´æˆ³ï¼Œå¹¶æŸ¥çœ‹ä½ç½®ç‚¹</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp /backup/full_$(<span class="built_in">date</span> +%F)</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_checkpoints </span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 3252565</span><br><span class="line">last_lsn = 3260144</span><br><span class="line"></span><br><span class="line">3ã€ç¬¬ä¸€æ¬¡å¢é‡å¤‡ä»½</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/full_2024-08-22 /backup/inc1_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc1_2024-08-22-17/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3252565   <span class="comment">#è¦å’Œå…¨å¤‡çš„to_lsnä¸€æ ·</span></span><br><span class="line">to_lsn = 3473250</span><br><span class="line">last_lsn = 3477650</span><br><span class="line"></span><br><span class="line">4ã€ç¬¬äºŒæ¬¡å¢å¤‡</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/inc1_2024-08-22-17 /backup/inc2_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc2_2024-08-22-17/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3473250   <span class="comment">#è¦å’Œinc1çš„to_lsnä¸€æ ·</span></span><br><span class="line">to_lsn = 3540803</span><br><span class="line">last_lsn = 3554601</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€ç¬¬ä¸‰æ¬¡å¢å¤‡</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/inc2_2024-08-22-17 /backup/inc3_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc3_2024-08-22-18/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3540803   <span class="comment">#è¦å’Œinc2çš„to_lsnä¸€æ ·</span></span><br><span class="line">to_lsn = 3576288</span><br><span class="line">last_lsn = 3590568</span><br><span class="line"></span><br><span class="line">6ã€ç¬¬å››æ¬¡å¢å¤‡</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/inc3_2024-08-22-18 /backup/inc4_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-18/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3576288</span><br><span class="line">to_lsn = 3625448</span><br><span class="line">last_lsn = 3626012</span><br><span class="line"></span><br><span class="line">ç¬¬å››æ¬¡å¢é‡å¤‡ä»½ä¹‹åçš„æ•°æ®åªèƒ½å»binlogé‡Œé¢å»æŸ¥æ‰¾</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# ll /backup</span><br><span class="line">drwxr-x--- 8 root root  268 Aug 22 17:42 full_2024-08-22</span><br><span class="line">drwxr-x--- 7 root root  267 Aug 22 17:53 inc1_2024-08-22-17</span><br><span class="line">drwxr-x--- 7 root root  267 Aug 22 17:58 inc2_2024-08-22-17</span><br><span class="line">drwxr-x--- 7 root root  267 Aug 22 18:00 inc3_2024-08-22-18</span><br><span class="line">drwxr-x--- 7 root root  267 Aug 22 18:02 inc4_2024-08-22-18</span><br><span class="line"></span><br><span class="line">å½“å‰ç³»ç»Ÿæ—¶é—´-1h</span><br><span class="line"><span class="built_in">date</span> +%F-%H -d <span class="string">&#x27;-1hour&#x27;</span></span><br><span class="line"><span class="built_in">date</span> +%F-%H -d <span class="string">&#x27;-1day&#x27;</span></span><br><span class="line"><span class="built_in">date</span> +%F-%H -d <span class="string">&#x27;-1minute&#x27;</span></span><br></pre></td></tr></table></figure><p>2ã€æ¢å¤</p><p>1ï¼‰full+inc1+inc2+inc3+inc4<br>2ï¼‰éœ€è¦å°†inc1å’Œinc2æŒ‰é¡ºåºåˆå¹¶åˆ°fullä¸­<br>3ï¼‰åˆ†æ­¥éª¤è¿›è¡Œâ€“apply-log</p><p><img src="../image/study_img/image-20240822114534116.png" alt="image-20240822114534116"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">1ã€#å…ˆæŸ¥çœ‹é‡Œé¢æœ‰å¤šå°‘æ•°æ®ï¼Œå†åˆ é™¤prodåº“</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     2181 |</span><br><span class="line">+----------+</span><br><span class="line">root@localhost:(none) &gt; drop database prod;</span><br><span class="line">è„šæœ¬å¼€å§‹æŠ¥é”™æ— æ³•å†™å…¥æ•°æ®ï¼Œåœæ­¢è„šæœ¬å³å¯</span><br><span class="line">[root@db02 ~]# sh insert.sh ^C</span><br><span class="line"></span><br><span class="line">2ã€#åœæ­¢æ•°æ®åº“</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">3ã€#æŒªèµ°dataç›®å½•</span><br><span class="line">[root@db02 ~]# <span class="built_in">mv</span> /app/mysql-5.6.50/data /tmp/</span><br><span class="line"></span><br><span class="line">4ã€#ç¬¬ä¸€æ­¥ï¼šåœ¨å…¨å¤‡ä¸­apply-logæ—¶ï¼Œåªåº”ç”¨redoï¼Œä¸åº”ç”¨undo    æŠŠå¢å¤‡æŒ‰ç…§é¡ºåºåˆå¹¶åˆ°å…¨å¤‡</span><br><span class="line">å…¨å¤‡æ¨¡æ‹ŸCSRåªåšredoï¼Œä¸åšundo,å› ä¸ºä¸€æ¡æ•°æ®å†™è¿›æ¥ï¼Œæ²¡æœ‰æäº¤å…¨å¤‡åšå®Œäº†ï¼Œä½†åœ¨ä¸‹ä¸€ä¸ªå¢å¤‡é‡Œé¢æäº¤äº†ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æŠŠundoåšäº†ï¼Œæ•°æ®å°±å›æ»šäº†</span><br><span class="line">innobackupex --apply-log --redo-noly /backup/å…¨å¤‡</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_checkpoints</span><br><span class="line">backup_type = log-applied  <span class="comment">#çŠ¶æ€å˜äº†</span></span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 3252565</span><br><span class="line">last_lsn = 3260144</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å…¨å¤‡çš„ä½ç½®ç‚¹æœ‰æ— å˜åŒ–å¹¶è®°å½•ä¸‹æ¥</span></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001       </span><br><span class="line"></span><br><span class="line">5ã€#ç¬¬äºŒæ­¥ï¼šåˆå¹¶inc1åˆå¹¶åˆ°fullä¸­ï¼Œå¹¶ä¸”apply-logï¼Œåªåº”ç”¨redoï¼Œä¸åº”ç”¨undo</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only --incremental-dir=/backup/inc1_2024-08-22-17 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc1_2024-08-22-17/xtrabackup_checkpoints</span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3252565</span><br><span class="line">to_lsn = 3473250</span><br><span class="line">last_lsn = 3477650</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001  </span><br><span class="line"></span><br><span class="line">6ã€#ç¬¬ä¸‰æ­¥ï¼šåˆå¹¶inc2åˆå¹¶åˆ°fullä¸­ï¼Œåªåšredoï¼Œä¸åšundo</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only --incremental-dir=/backup/inc2_2024-08-22-17 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc2_2024-08-22-17/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3473250</span><br><span class="line">to_lsn = 3540803</span><br><span class="line">last_lsn = 3554601</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001  </span><br><span class="line"></span><br><span class="line">7ã€#ç¬¬å››æ­¥ï¼šåˆå¹¶inc3åˆå¹¶åˆ°fullä¸­ï¼Œåªåšredoï¼Œä¸åšundo</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only --incremental-dir=/backup/inc3_2024-08-22-18 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc3_2024-08-22-18/xtrabackup_checkpoints</span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3540803</span><br><span class="line">to_lsn = 3576288</span><br><span class="line">last_lsn = 3590568</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001  </span><br><span class="line"></span><br><span class="line">8ã€#ç¬¬äº”æ­¥ï¼šåˆå¹¶inc4ï¼ˆæœ€åä¸€æ¬¡ï¼‰åˆå¹¶åˆ°fullä¸­ï¼Œredoå’Œundoéƒ½åš</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --incremental-dir=/backup/inc4_2024-08-22-18 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-18/xtrabackup_checkpoints</span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 3576288</span><br><span class="line">to_lsn = 3625448</span><br><span class="line">last_lsn = 3626012</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001  </span><br><span class="line"></span><br><span class="line">9ã€#å°†å…¨å¤‡--apply-logï¼Œredoå’Œundoéƒ½åº”ç”¨</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">10ã€#æ¢å¤æ•°æ®</span><br><span class="line">[root@db02 ~]# innobackupex --copy-back /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">11ã€#æˆæƒ  å¯åŠ¨</span><br><span class="line">[root@db02 ~]# <span class="built_in">chown</span> -R mysql.mysql /app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line">12ã€#è¿æ¥è¿›å»æŸ¥çœ‹ä¸€ä¸‹æ•°æ®æ˜¯å¦å¯¹å¾—ä¸Š</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     1517 |</span><br><span class="line">+----------+  <span class="comment">#å¯ä»¥çœ‹åˆ°æ•°æ®å°‘äº†ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ•°æ®ï¼Œåœ¨binlogé‡Œé¢</span></span><br><span class="line"></span><br><span class="line">13ã€#æˆªå–binlog</span><br><span class="line">åˆå¹¶å®Œäº†ï¼Œè¿™ä¸ªbinlogçš„ä½ç½®ç‚¹ä¹Ÿä¼šåˆå¹¶</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        282633</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š282633</span><br><span class="line"></span><br><span class="line">ç”±äºä¹‹å‰çš„dataç›®å½•è¢«æŒªåˆ°tmpäº†</span><br><span class="line">[root@db02 ~]# mysqlbinlog --base64-output=decode-rows /tmp/data/mysql-bin.000001 |grep  -iC 10 <span class="string">&#x27;drop database&#x27;</span></span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š407253</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --start-position=282633 --stop-position=407253 /tmp/data/mysql-bin.000001 &gt; /tmp/inc5.sql</span><br><span class="line"></span><br><span class="line">14ã€#è¿›å…¥æ•°æ®åº“</span><br><span class="line">å…³é—­binlog,é˜²æ­¢binlogè¢«æ±¡æŸ“ï¼Œè®©binlogä»120å¼€å§‹</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line"></span><br><span class="line">å¯¼å…¥æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">source</span> /tmp/inc5.sql</span><br><span class="line"></span><br><span class="line">å¼€å¯binlog</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ•°æ®ï¼Œå·²ç»æ¢å¤</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     2187 |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¢é‡å¤‡ä»½æŒºéº»çƒ¦çš„ æ‰€ä»¥ä¼ä¸šé‡Œé¢éƒ½æ˜¯åšå·®å¼‚å¤‡ä»½</span><br><span class="line">ä½†æ˜¯å·®å¼‚å¤‡ä»½æ¯”è¾ƒå ç£ç›˜ç©ºé—´</span><br></pre></td></tr></table></figure><p><strong>ä¼ä¸šçº§å¢é‡æ¢å¤å®æˆ˜</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">èƒŒæ™¯ï¼š</span><br><span class="line">æŸå¤§å‹ç½‘ç«™ï¼Œmysqlæ•°æ®åº“ï¼Œæ•°æ®é‡500Gï¼Œæ¯æ—¥æ›´æ–°é‡100M-200M</span><br><span class="line"></span><br><span class="line">å¤‡ä»½ç­–ç•¥ï¼š</span><br><span class="line">xtrabackupï¼Œæ¯å‘¨å…­0:00è¿›è¡Œå…¨å¤‡ï¼Œå‘¨ä¸€åˆ°å‘¨äº”åŠå‘¨æ—¥00:00è¿›è¡Œå¢é‡å¤‡ä»½ã€‚</span><br><span class="line"></span><br><span class="line">æ•…éšœåœºæ™¯ï¼š</span><br><span class="line">å‘¨ä¸‰ä¸‹åˆ2ç‚¹å‡ºç°æ•°æ®åº“æ„å¤–åˆ é™¤è¡¨æ“ä½œã€‚</span><br><span class="line">å¦‚ä½•æ¢å¤ï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¨å¤‡+å¢å¤‡+binlog</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240822201507914.png" alt="image-20240822201507914"></p><p>1ã€æ¨¡æ‹Ÿå¤‡ä»½åˆ æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">1ã€#æ‰§è¡Œå†™æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db02 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€#ç­‰å¾…ä¸€ä¼šï¼Œå…¨å¤‡ (å‘¨å…­)</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /backup/*</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp /backup/full_$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_checkpoints </span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 4215962</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#ç­‰å¾…ä¸€ä¼šï¼Œå¢å¤‡inc1 (å‘¨æ—¥)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/full_2024-08-22/ /backup/inc1_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc1_2024-08-22-20/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4215962</span><br><span class="line">to_lsn = 4333233</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#ç­‰å¾…ä¸€ä¼šï¼Œå¢å¤‡inc2 (å‘¨ä¸€)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/inc1_2024-08-22-20/ /backup/inc2_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc2_2024-08-22-20/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4333233</span><br><span class="line">to_lsn = 4395658</span><br><span class="line"></span><br><span class="line">5ã€#ç­‰å¾…ä¸€ä¼šï¼Œå¢å¤‡inc3 (å‘¨äºŒ)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/inc2_2024-08-22-20/ /backup/inc3_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc3_2024-08-22-20/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4395658</span><br><span class="line">to_lsn = 4411035</span><br><span class="line"></span><br><span class="line">6ã€#ç­‰å¾…ä¸€ä¼šï¼Œå¢å¤‡inc4 (å‘¨ä¸‰)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/inc3_2024-08-22-20/ /backup/inc4_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-20/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4411035</span><br><span class="line">to_lsn = 4455757</span><br><span class="line"></span><br><span class="line">7ã€#å‘¨ä¸‰ä¸‹åˆ2ç‚¹å‡ºç°æ•°æ®åº“æ„å¤–åˆ é™¤è¡¨æ“ä½œï¼Œå…ˆæŸ¥çœ‹æ•°æ®ï¼Œå†åˆ è¡¨</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     1199 |</span><br><span class="line">+----------+</span><br><span class="line">root@localhost:(none) &gt; drop table prod.prod;</span><br><span class="line">åœæ­¢è„šæœ¬è¿è¡Œ</span><br><span class="line">[root@db02 ~]# sh insert.sh ^C</span><br></pre></td></tr></table></figure><p>2ã€æ¢å¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">1ã€#åœæ­¢æ•°æ®åº“</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">3ã€#æŒªèµ°dataç›®å½•</span><br><span class="line">[root@db02 ~]# <span class="built_in">mv</span> /app/mysql-5.6.50/data /tmp/</span><br><span class="line"></span><br><span class="line">2ã€#ç¬¬ä¸€æ­¥ï¼šåœ¨å…¨å¤‡ä¸­apply-logæ—¶ï¼Œåªåº”ç”¨redoï¼Œä¸åº”ç”¨undo</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_checkpoints </span><br><span class="line">backup_type = log-applied</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 4215962</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        55527</span><br><span class="line"></span><br><span class="line">3ã€#ç¬¬äºŒæ­¥ï¼šåˆå¹¶inc1åˆå¹¶åˆ°fullä¸­ï¼Œå¹¶ä¸”apply-logï¼Œåªåº”ç”¨redoï¼Œä¸åº”ç”¨undo  (å‘¨æ—¥å’Œå‘¨å…­åˆå¹¶)</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only --incremental-dir=/backup/inc1_2024-08-22-20 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc1_2024-08-22-20/xtrabackup_checkpoints</span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4215962</span><br><span class="line">to_lsn = 4333233</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc1_2024-08-22-20/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        112629</span><br><span class="line"></span><br><span class="line">4ã€#ç¬¬ä¸‰æ­¥ï¼šåˆå¹¶inc2åˆå¹¶åˆ°fullä¸­ï¼Œåªåšredoï¼Œä¸åšundo    (å‘¨ä¸€å’Œå‘¨å…­åˆå¹¶)</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only --incremental-dir=/backup/inc2_2024-08-22-20 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc2_2024-08-22-20/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4333233</span><br><span class="line">to_lsn = 4395658</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc2_2024-08-22-20/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        144249</span><br><span class="line"></span><br><span class="line">5ã€#ç¬¬å››æ­¥ï¼šåˆå¹¶inc3åˆå¹¶åˆ°fullä¸­ï¼Œåªåšredoï¼Œä¸åšundo    (å‘¨äºŒå’Œå‘¨å…­åˆå¹¶)</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only --incremental-dir=/backup/inc3_2024-08-22-20 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc3_2024-08-22-20/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4395658</span><br><span class="line">to_lsn = 4411035</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc3_2024-08-22-20/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        163965</span><br><span class="line"></span><br><span class="line">6ã€#ç¬¬äº”æ­¥ï¼šåˆå¹¶inc4ï¼ˆæœ€åä¸€æ¬¡ï¼‰åˆå¹¶åˆ°fullä¸­ï¼Œredoå’Œundoéƒ½åš   (å‘¨ä¸‰å’Œå‘¨å…­åˆå¹¶)</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --incremental-dir=/backup/inc4_2024-08-22-20 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-20/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4411035</span><br><span class="line">to_lsn = 4455757</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-20/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        186099</span><br><span class="line"></span><br><span class="line">7ã€#å°†å…¨å¤‡--apply-logï¼Œredoå’Œundoéƒ½åº”ç”¨</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">8ã€#æ¢å¤æ•°æ®</span><br><span class="line">[root@db02 ~]# innobackupex --copy-back /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">9ã€#æˆæƒ  å¯åŠ¨</span><br><span class="line">[root@db02 ~]# <span class="built_in">chown</span> -R mysql.mysql /app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line">10ã€#è¿æ¥è¿›å»æŸ¥çœ‹ä¸€ä¸‹æ•°æ®æ˜¯å¦å¯¹å¾—ä¸Š</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|      998 |</span><br><span class="line">+----------+  <span class="comment">#å¯ä»¥çœ‹åˆ°æ•°æ®å°‘äº†ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ•°æ®ï¼Œåœ¨binlogé‡Œé¢</span></span><br><span class="line"></span><br><span class="line">11ã€#æˆªå–binlog</span><br><span class="line">åˆå¹¶å®Œäº†ï¼Œè¿™ä¸ªbinlogçš„ä½ç½®ç‚¹ä¹Ÿä¼šåˆå¹¶</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        186099</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š186099</span><br><span class="line">ç”±äºä¹‹å‰çš„dataç›®å½•è¢«æŒªåˆ°tmpäº†</span><br><span class="line">[root@db02 ~]# mysqlbinlog --base64-output=decode-rows /tmp/data/mysql-bin.000001 |grep  -iC 10 <span class="string">&#x27;drop table&#x27;</span></span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š223640</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --start-position=186099 --stop-position=223640 /tmp/data/mysql-bin.000001 &gt; /tmp/inc5.sql</span><br><span class="line"></span><br><span class="line">12ã€#è¿›å…¥æ•°æ®åº“</span><br><span class="line">å…³é—­binlog,é˜²æ­¢binlogè¢«æ±¡æŸ“ï¼Œè®©binlogä»120å¼€å§‹</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line"></span><br><span class="line">å¯¼å…¥æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">source</span> /tmp/inc5.sql</span><br><span class="line"></span><br><span class="line">å¼€å¯binlog</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ•°æ®ï¼Œå·²ç»æ¢å¤</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     1199 |</span><br><span class="line">+----------+</span><br></pre></td></tr></table></figure><p><strong>xtrabackupexè¿›è¡Œå·®å¼‚å¤‡ä»½</strong></p><p><img src="../image/study_img/image-20240822212220010.png" alt="image-20240822212220010"></p><p><img src="../image/study_img/image-20240822214839115.png" alt="image-20240822214839115"></p><p>1ã€æ¨¡æ‹Ÿå¤‡ä»½åˆ æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">1ã€#æ‰§è¡Œå†™æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db02 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€#ç­‰å¾…ä¸€ä¼šï¼Œå…¨å¤‡ (å‘¨å…­)</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /backup/*</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp /backup/full_$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_checkpoints </span><br><span class="line">backup_type = full-backuped</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 4915321</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#ç­‰å¾…ä¸€ä¼šï¼Œå·®å¼‚å¤‡inc1 (å‘¨æ—¥)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/full_2024-08-22/ /backup/inc1_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc1_2024-08-22-21/xtrabackup_checkpoints</span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4915321</span><br><span class="line">to_lsn = 4987544</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#ç­‰å¾…ä¸€ä¼šï¼Œå·®å¼‚å¤‡inc2 (å‘¨ä¸€)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/full_2024-08-22/ /backup/inc2_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc2_2024-08-22-21/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = </span><br><span class="line">to_lsn = </span><br><span class="line"></span><br><span class="line">5ã€#ç­‰å¾…ä¸€ä¼šï¼Œå·®å¼‚å¤‡inc3 (å‘¨äºŒ)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/full_2024-08-22/ /backup/inc3_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc3_2024-08-22-21/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = </span><br><span class="line">to_lsn = </span><br><span class="line"></span><br><span class="line">6ã€#ç­‰å¾…ä¸€ä¼šï¼Œå·®å¼‚å¤‡inc4 (å‘¨ä¸‰)</span><br><span class="line">[root@db02 ~]# innobackupex --user=root --password=123 --no-timestamp --incremental --incremental-basedir=/backup/full_2024-08-22/ /backup/inc4_$(<span class="built_in">date</span> +%F-%H)</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-21/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = </span><br><span class="line">to_lsn = </span><br><span class="line"></span><br><span class="line">7ã€#å‘¨ä¸‰ä¸‹åˆ2ç‚¹å‡ºç°æ•°æ®åº“æ„å¤–åˆ é™¤è¡¨æ“ä½œï¼Œå…ˆæŸ¥çœ‹æ•°æ®ï¼Œå†åˆ è¡¨</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|      497 |</span><br><span class="line">+----------+</span><br><span class="line">root@localhost:(none) &gt; drop table prod.prod;</span><br><span class="line">åœæ­¢è„šæœ¬è¿è¡Œ</span><br><span class="line">[root@db02 ~]# sh insert.sh ^C</span><br></pre></td></tr></table></figure><p>2ã€æ¢å¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">1ã€#åœæ­¢æ•°æ®åº“</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">3ã€#æŒªèµ°dataç›®å½•</span><br><span class="line">[root@db02 ~]# <span class="built_in">mv</span> /app/mysql-5.6.50/data /tmp/</span><br><span class="line"></span><br><span class="line">2ã€#ç¬¬ä¸€æ­¥ï¼šåœ¨å…¨å¤‡ä¸­apply-logæ—¶ï¼Œåªåº”ç”¨redoï¼Œä¸åº”ç”¨undo</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --redo-only /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_checkpoints </span><br><span class="line">backup_type = log-applied</span><br><span class="line">from_lsn = 0</span><br><span class="line">to_lsn = 4915321</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        9399</span><br><span class="line"></span><br><span class="line">3ã€#ç¬¬äºŒæ­¥ï¼šåˆå¹¶inc4ï¼ˆæœ€åä¸€æ¬¡çš„å·®å¼‚å¤‡ä»½ï¼‰åˆ°fullä¸­ï¼Œredoå’Œundoéƒ½åš   (å‘¨ä¸‰å’Œå‘¨å…­åˆå¹¶)</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log --incremental-dir=/backup/inc4_2024-08-22-21 /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-21/xtrabackup_checkpoints </span><br><span class="line">backup_type = incremental</span><br><span class="line">from_lsn = 4915321</span><br><span class="line">to_lsn = 5067923</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/inc4_2024-08-22-21/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001         85473</span><br><span class="line"></span><br><span class="line">4ã€#å°†å…¨å¤‡--apply-logï¼Œredoå’Œundoéƒ½åº”ç”¨</span><br><span class="line">[root@db02 ~]# innobackupex --apply-log /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">5ã€#æ¢å¤æ•°æ®</span><br><span class="line">[root@db02 ~]# innobackupex --copy-back /backup/full_2024-08-22/</span><br><span class="line"></span><br><span class="line">6ã€#æˆæƒ  å¯åŠ¨</span><br><span class="line">[root@db02 ~]# <span class="built_in">chown</span> -R mysql.mysql /app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line"></span><br><span class="line">7ã€#è¿æ¥è¿›å»æŸ¥çœ‹ä¸€ä¸‹æ•°æ®æ˜¯å¦å¯¹å¾—ä¸Š</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|      457 |</span><br><span class="line">+----------+  <span class="comment">#å¯ä»¥çœ‹åˆ°æ•°æ®å°‘äº†ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ•°æ®ï¼Œåœ¨binlogé‡Œé¢</span></span><br><span class="line"></span><br><span class="line">8ã€#æˆªå–binlog</span><br><span class="line">åˆå¹¶å®Œäº†ï¼Œè¿™ä¸ªbinlogçš„ä½ç½®ç‚¹ä¹Ÿä¼šåˆå¹¶</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /backup/full_2024-08-22/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001        85473</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š85473</span><br><span class="line">ç”±äºä¹‹å‰çš„dataç›®å½•è¢«æŒªåˆ°tmpäº†</span><br><span class="line">[root@db02 ~]# mysqlbinlog --base64-output=decode-rows /tmp/data/mysql-bin.000001 |grep  -iC 10 <span class="string">&#x27;drop table&#x27;</span></span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š93068</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --start-position=85473 --stop-position=93068 /tmp/data/mysql-bin.000001 &gt; /tmp/inc5.sql</span><br><span class="line"></span><br><span class="line">9ã€#è¿›å…¥æ•°æ®åº“</span><br><span class="line">å…³é—­binlog,é˜²æ­¢binlogè¢«æ±¡æŸ“ï¼Œè®©binlogä»120å¼€å§‹</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line"></span><br><span class="line">å¯¼å…¥æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">source</span> /tmp/inc5.sql</span><br><span class="line"></span><br><span class="line">å¼€å¯binlog</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ•°æ®ï¼Œå·²ç»æ¢å¤</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|      497 |</span><br><span class="line">+----------+  <span class="comment">#å·®å¼‚å¤‡ä»½æ¢å¤å®Œæˆ</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•9ã€Mysqlå­˜å‚¨å¼•æ“å’ŒDTL</title>
      <link href="/posts/23751c6b.html"/>
      <url>/posts/23751c6b.html</url>
      
        <content type="html"><![CDATA[<h3 id="mysqlå­˜å‚¨å¼•æ“-DTL">mysqlå­˜å‚¨å¼•æ“&amp;DTL</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">.idb ç»“å°¾çš„æ–‡ä»¶å«è¡¨ç©ºé—´</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQLå¼•æ“åŠŸèƒ½ï¼š</span><br><span class="line">é™¤äº†å¯ä»¥æä¾›åŸºæœ¬çš„å­˜å–åŠŸèƒ½ï¼Œè¿˜æœ‰æ›´å¤šåŠŸèƒ½äº‹åŠ¡åŠŸèƒ½ã€é”å®šã€å¤‡ä»½å’Œæ¢å¤ã€ä¼˜åŒ–ä»¥åŠç‰¹æ®ŠåŠŸèƒ½</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MySQL æä¾›ä»¥ä¸‹å­˜å‚¨å¼•æ“:</span><br><span class="line"><span class="string">&#x27;01ï¼‰InnoDB&#x27;</span>    <span class="comment">#ä¸»æµçš„</span></span><br><span class="line"><span class="string">&#x27;02ï¼‰MyISAM&#x27;</span></span><br><span class="line">03ï¼‰MEMORY</span><br><span class="line">04ï¼‰ARCHIVE</span><br><span class="line">05ï¼‰FEDERATED</span><br><span class="line">06ï¼‰EXAMPLE</span><br><span class="line">07ï¼‰BLACKHOLE</span><br><span class="line">08ï¼‰MERGE</span><br><span class="line">09ï¼‰NDBCLUSTER</span><br><span class="line">10ï¼‰CSV</span><br><span class="line"></span><br><span class="line">æ•°æ®å®šä¹‰è¯­è¨€ï¼Œå»ºåº“å»ºè¡¨</span><br></pre></td></tr></table></figure><p>mysqlè‡ªå¸¦çš„å­˜å‚¨å¼•æ“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹mysqlè‡ªå¸¦çš„å­˜å‚¨å¼•æ“</span></span><br><span class="line">root@localhost:(none) &gt; show engines;</span><br><span class="line">+--------------------+</span><br><span class="line">| Engine             |</span><br><span class="line">+--------------------+</span><br><span class="line">| FEDERATED          |</span><br><span class="line">| MRG_MYISAM         |</span><br><span class="line">| MyISAM             |#</span><br><span class="line">| BLACKHOLE          |</span><br><span class="line">| CSV                |</span><br><span class="line">| MEMORY             |</span><br><span class="line">| ARCHIVE            |</span><br><span class="line">| InnoDB             | <span class="comment">#</span></span><br><span class="line">| PERFORMANCE_SCHEMA |</span><br><span class="line">+--------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹mysqlæ•°æ®åº“ä¸­å“ªäº›è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯InnoDB</span></span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from information_schema.tables  <span class="built_in">where</span> ENGINE=<span class="string">&#x27;InnoDB&#x27;</span>\G;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ•°æ®åº“ä¸­å“ªäº›è¡¨æ˜¯myisam</span></span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from information_schema.tables <span class="built_in">where</span> engine=<span class="string">&#x27;myisam&#x27;</span>\G</span><br></pre></td></tr></table></figure><p><strong>InnoDBå’Œmyisamçš„åŒºåˆ«</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é¢è¯•é—®é¢˜InnoDBå’Œmyisamçš„åŒºåˆ«</span></span><br><span class="line">mysiamçš„ç‰©ç†æ–‡ä»¶æœ‰3ä¸ªï¼ŒInodbçš„ç‰©ç†æ–‡ä»¶æœ‰2ä¸ª</span><br><span class="line">Inodbæ˜¯è¡Œçº§é”ï¼Œmysiamæ˜¯è¡¨çº§é”</span><br><span class="line">inodbæ”¯æŒäº‹åŠ¡ï¼Œredoå’Œundoæ˜¯å®ç°CSRè¿‡ç¨‹çš„2ä¸ªäº‹åŠ¡æ—¥å¿—ï¼Œæ‰€ä»¥æœ‰CSRè‡ªåŠ¨æ•…éšœæ¢å¤ï¼›</span><br><span class="line">mysiamä¸æ”¯æŒäº‹åŠ¡ï¼Œæ²¡æœ‰redoå’Œundoï¼Œæ²¡æœ‰CSRè‡ªåŠ¨æ•…éšœæ¢å¤</span><br><span class="line">Inodbæ˜¯è¡Œçº§é”ï¼Œæ”¯æŒMVCCé«˜ç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼›mysiamä¸æ”¯æŒï¼Œå› ä¸ºmysiamæ˜¯è¡¨çº§é”(æ”¹ä¸€è¡Œï¼Œæ•´ä¸ªè¡¨éƒ½é”äº†)</span><br><span class="line">é«˜ç‰ˆæœ¬å¹¶å‘æ§åˆ¶ç±»ä¼¼äºè¡Œçº§é”ï¼Œä½ æ”¹è¿™è¡Œæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–è¡Œçš„æ•°æ®åˆ«äººä¹Ÿæ˜¯å¯ä»¥æ”¹çš„ï¼Œå› ä¸ºæœ‰å…±äº«é”+æ’ä»–é”+ä¹è§‚é”æ„æˆ</span><br><span class="line">Inodbæ”¯æŒçƒ­å¤‡ï¼Œmysiamä¸æ”¯æŒ</span><br><span class="line">(çƒ­å¤‡æ˜¯æŒ‰ç…§äº‹åŠ¡çš„æäº¤åšçš„å¤‡ä»½)</span><br></pre></td></tr></table></figure><p>1ã€ç‰©ç†åŒºåˆ«ï¼šæœ€åº•å±‚çš„æ•°æ®æ–‡ä»¶ä¸åŒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysiamæ•°æ®æ–‡ä»¶  frm=fotmat ç»“æ„</span></span><br><span class="line"><span class="comment">#myisamçš„æ•°æ®æ–‡ä»¶ç”±3ä¸ªç»„æˆ</span></span><br><span class="line">1ã€æŸ¥çœ‹mysqlçš„å®‰è£…ç›®å½•ä¸‹çš„æ‰€æœ‰useræ–‡ä»¶</span><br><span class="line">[root@db01 ~]# <span class="built_in">cd</span> /app/mysql-5.6.50/data/mysql</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹æ‰€æœ‰userçš„æ–‡ä»¶</span><br><span class="line">[root@db01 mysql]# ll user*</span><br><span class="line">-rw-rw---- 1 mysql mysql 10684 Aug  7 23:30 user.frm</span><br><span class="line">-rw-rw---- 1 mysql mysql   664 Aug 13 15:27 user.MYD</span><br><span class="line">-rw-rw---- 1 mysql mysql  2048 Aug 13 22:01 user.MYI</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#InoDdçš„æ•°æ®æ–‡ä»¶ç”±2ä¸ªç»„æˆ</span></span><br><span class="line">è¿›å…¥éšæ„ä¸€ä¸ªåº“æ–‡ä»¶</span><br><span class="line">[root@db01 student]# <span class="built_in">cd</span> /app/mysql-5.6.50/data/student</span><br><span class="line">[root@db01 student]# ll</span><br><span class="line">-rw-rw---- 1 mysql mysql   8726 Aug 13 03:17 stu1.frm</span><br><span class="line">-rw-rw---- 1 mysql mysql  98304 Aug 15 20:52 stu1.ibd</span><br></pre></td></tr></table></figure><p>2ã€é€»è¾‘åŒºåˆ«</p><p><img src="../image/study_img/image-20240816090213485.png" alt="image-20240816090213485"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mvccå«å¤šç‰ˆæœ¬è¿›åŒ–æ§åˆ¶</span><br><span class="line"></span><br><span class="line">é”å®šç²’åº¦ï¼šåœ¨ä¿®æ”¹ä¸€è¡Œæ•°æ®ä¸­ï¼Œåˆ«çš„ç”¨æˆ·è¿‡æ¥æ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„</span><br><span class="line"></span><br><span class="line">æŠŠæ”¹çš„æ•°æ®æ”¾åˆ°ç¼“å­˜é‡Œï¼Œå…ˆæä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæŠŠæ”¹çš„å¤´åƒæ”¾åˆ°ç¼“å­˜é‡Œé¢ï¼Œç­‰ä¸Šä¸€ä¸ªäººä¿®æ”¹å®Œæˆåï¼Œå†æŠŠä½ çš„å¤´åƒæ”¾åˆ°æ•°æ®åº“ä¸­ï¼Œæ‰€ä»¥æ”¹å¤´åƒè¦åˆ·æ–°ä¸€ä¼šæ‰çœ‹åˆ°æ–°æ”¹çš„å¤´åƒ</span><br><span class="line"></span><br><span class="line">å†·å¤‡ï¼šæŠŠæœåŠ¡åœæ‰ï¼Œåšå¤‡ä»½</span><br><span class="line">çƒ­å¤‡ï¼šä¸åœæœåŠ¡å™¨ï¼Œåšå¤‡ä»½</span><br><span class="line">æ¸©å¤‡ï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#innodbæ ¸å¿ƒç‰¹æ€§</span></span><br><span class="line">é‡ç‚¹:</span><br><span class="line">MVCC</span><br><span class="line">äº‹åŠ¡</span><br><span class="line">è¡Œçº§é”</span><br><span class="line">çƒ­å¤‡ä»½</span><br><span class="line">Crash Safe Recoveryï¼ˆè‡ªåŠ¨æ•…éšœæ¢å¤ï¼‰</span><br><span class="line"></span><br><span class="line">mysiamæ²¡æœ‰äº‹åŠ¡ å°±æ²¡æœ‰äº‹åŠ¡æ—¥å¿—redo undo</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹é»˜è®¤çš„å­˜å‚¨å¼•æ“çš„3ç§æ–¹æ³•ï¼š</span></span><br><span class="line">1ã€#ä½¿ç”¨ SELECT ç¡®è®¤ä¼šè¯å­˜å‚¨å¼•æ“</span><br><span class="line">root@localhost:(none) &gt; SELECT @@default_storage_engine;</span><br><span class="line">+--------------------------+</span><br><span class="line">| @@default_storage_engine |</span><br><span class="line">+--------------------------+</span><br><span class="line">| InnoDB                   |</span><br><span class="line">+--------------------------+</span><br><span class="line"></span><br><span class="line">2ã€#ä½¿ç”¨ show ç¡®è®¤æ¯ä¸ªè¡¨çš„å­˜å‚¨å¼•æ“</span><br><span class="line">root@localhost:(none) &gt; show create table world.city;</span><br><span class="line">å»ºè¡¨è¯­å¥æœ€åä¸€è¡Œæ˜¾ç¤ºå­˜å‚¨å¼•æ“</span><br><span class="line">ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1</span><br><span class="line"></span><br><span class="line">3ã€#ä½¿ç”¨  informattion_schema ç¡®è®¤æ¯ä¸ªè¡¨çš„å­˜å‚¨å¼•æ“</span><br><span class="line"><span class="keyword">select</span> table_name, engine from information_schema.tables <span class="built_in">where</span> table_name=<span class="string">&#x27;city&#x27;</span> and table_schema=<span class="string">&#x27;world&#x27;</span>\G</span><br><span class="line"></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">table_name: city</span><br><span class="line">    engine: InnoDB</span><br></pre></td></tr></table></figure><p>å­˜å‚¨å¼•æ“çš„è®¾ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#.å­˜å‚¨å¼•æ“çš„è®¾ç½®     #ä¸è¦å»çæ”¹ï¼Œä½¿ç”¨é»˜è®¤çš„å°±è¡Œ</span></span><br><span class="line">1ï¼‰#åœ¨é…ç½®æ–‡ä»¶çš„[mysqld]æ ‡ç­¾ä¸‹æ·»åŠ  (æ°¸ä¹…ç”Ÿæ•ˆ)</span><br><span class="line">[mysqld]</span><br><span class="line">default-storage-engine=InnoDB  <span class="comment">#è¿™è¡Œé…ç½®å°±æ”¹ä½ éœ€è¦çš„å­˜å‚¨å¼•æ“</span></span><br><span class="line">æ³¨æ„ï¼šæ”¹äº†é…ç½®æ–‡ä»¶éœ€è¦é‡å¯</span><br><span class="line"></span><br><span class="line">2ï¼‰#åœ¨MySQLå‘½ä»¤è¡Œä¸­ä¸´æ—¶è®¾ç½®(ä¸´æ—¶ç”Ÿæ•ˆ)</span><br><span class="line">SET @@storage_engine=InnoDB</span><br><span class="line"></span><br><span class="line">3ï¼‰#å»ºè¡¨çš„æ—¶å€™æŒ‡å®šå­˜å‚¨å¼•æ“</span><br><span class="line">create table t (i int) engine = InnoDB;</span><br></pre></td></tr></table></figure><p><strong>ä¼ä¸šæ¡ˆä¾‹1</strong></p><p>é¡¹ç›®èƒŒæ™¯ï¼š<br>å…¬å¸åŸæœ‰çš„æ¶æ„ï¼šä¸€ä¸ªå±•ç¤ºå‹çš„ç½‘ç«™ï¼ŒLAMTï¼ŒMySQL5.1.77ç‰ˆæœ¬ï¼ˆMYISAMï¼‰ï¼Œ50Mæ•°æ®é‡ã€‚</p><p>å°é—®é¢˜ä¸æ–­ï¼š<br>1ã€è¡¨çº§é”ï¼šå¯¹è¡¨ä¸­ä»»æ„ä¸€è¡Œæ•°æ®ä¿®æ”¹ç±»æ“ä½œæ—¶ï¼Œæ•´ä¸ªè¡¨éƒ½ä¼šé”å®šï¼Œå¯¹å…¶ä»–è¡Œçš„æ“ä½œéƒ½ä¸èƒ½åŒæ—¶è¿›è¡Œã€‚<br>2ã€myisamä¸æ”¯æŒæ•…éšœè‡ªåŠ¨æ¢å¤ï¼ˆCSRï¼‰ï¼šå½“æ–­ç”µæ—¶æœ‰å¯èƒ½ä¼šå‡ºç°æ•°æ®æŸåæˆ–ä¸¢å¤±çš„é—®é¢˜ã€‚</p><p>å¦‚ä½•è§£å†³ï¼š<br>1ã€å»ºè®®å°†ç°æœ‰çš„myisamå¼•æ“æ›¿æ¢ä¸ºInnodbï¼Œå°†ç‰ˆæœ¬æ›¿æ¢ä¸º5.7<br>1ï¼‰å¦‚æœä½¿ç”¨MYISAMä¼šäº§ç”Ÿâ€å°é—®é¢˜â€ï¼Œæ€§èƒ½å®‰å…¨ä¸èƒ½å¾—åˆ°ä¿è¯ï¼Œä½¿ç”¨innodbå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>2ï¼‰5.7ç‰ˆæœ¬å¯¹äºinnodbå¼•æ“æ”¯æŒä¸å¤Ÿå®Œå–„ï¼Œ5.7ç‰ˆæœ¬å¯¹innodbæ”¯æŒéå¸¸å®Œå–„äº†ã€‚</p><p>2ã€å®æ–½è¿‡ç¨‹å’Œæ³¨æ„è¦ç´ ï¼šä½†æ˜¯è¿™ä¸ªä»£ç ä¸Šé¢æœ‰å¾ˆå¤§çš„æ”¹åŠ¨ï¼Œå¼€å‘æ”¹å¥½ä»£ç æ‰åšå‡çº§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">å‡çº§çš„æ—¶å€™ä¸èƒ½å½±å“åˆ°ç”¨æˆ·</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸åœåº“çš„æ“ä½œ</span></span><br><span class="line">1ã€å‡†å¤‡ä¸€ä¸ªæ–°ç¯å¢ƒï¼Œæ¥ä¸€å°æ–°æœºå™¨ï¼Œå› ä¸ºæœ‰é—®é¢˜çš„æœºå™¨ä¸èƒ½åŠ¨</span><br><span class="line"></span><br><span class="line">2ã€åœ¨æ–°ç¯å¢ƒä¸­äºŒè¿›åˆ¶å®‰è£…ä¸€ä¸ªmysql5.7.44ï¼Œå¦‚æœæ˜¯å®¹å™¨çš„è¯å°±dockerèµ·ä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">3ã€ç»™å½“å‰æ­£åœ¨æä¾›æœåŠ¡çš„ç”Ÿäº§åº“ï¼Œè¿›è¡Œä¸€ä¸ªå…¨å¤‡ï¼ˆæ‰“ç‚¹å…¨å¤‡ï¼Œè®°å½•å½“å‰å¤‡ä»½çš„ä½ç½®ç‚¹ï¼‰</span><br><span class="line">ä¸ºä»€ä¹ˆåšå…¨å¤‡ï¼šå› ä¸ºåœ¨ç”Ÿäº§çš„æ•°æ®åº“è™½ç„¶ä¸ç”¨äº†ï¼Œä½†é‡Œé¢æœ‰å¾ˆå¤šç³»ç»Ÿè¡¨ï¼Œmysqlçš„userè¡¨,åˆ›å»ºçš„ç”¨æˆ·ï¼Œç»™å¼€å‘å¼€çš„ç”¨æˆ·ï¼Œå¼€å‘å†™çš„ç¨‹åºè¿æ¥æ•°æ®åº“çš„ç”¨æˆ·éƒ½åœ¨é‡Œé¢ï¼ŒåŒ…æ‹¬è¦æ±‚çš„æˆæƒï¼Œè„±æ•çš„æˆæƒï¼Œå¦‚æœå†å»ä¸€ä¸ªä¸€ä¸ªåˆ›å»ºå°±æ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚æœè¦ä¿è¯è¿™äº›éƒ½è¿˜åœ¨ï¼Œå°±è¦åšå…¨å¤‡</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysql]   <span class="comment">#è¿™ä¸ªæ ‡ç­¾æ‰€æœ‰å®¢æˆ·ç«¯éƒ½è¯†åˆ«</span></span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -A --triggers -R --master-data=2 &gt;/tmp/full.sql</span><br><span class="line">-A         å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“ã€‚</span><br><span class="line">--triggers ç¡®ä¿è§¦å‘å™¨ä¹Ÿè¢«å¯¼å‡º</span><br><span class="line">-R         å¯¼å‡ºå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ã€‚</span><br><span class="line">--master-data=2 å¯¼å‡ºçš„SQLæ–‡ä»¶ä¸­åŒ…å«CHANGE MASTER TOè¯­å¥ï¼Œè¿™äº›è¯­å¥åŒ…å«äº†äºŒè¿›åˆ¶æ—¥å¿—çš„ä½ç½®ä¿¡æ¯ï¼Œè¿™å¯¹äºè®¾ç½®å¤åˆ¶ç¯å¢ƒéå¸¸æœ‰ç”¨ã€‚=2 çš„æ„æ€æ˜¯ï¼Œè¿™äº›è¯­å¥ä¼šè¢«æ³¨é‡Šæ‰ï¼Œä½¿å¾—å®ƒä»¬é»˜è®¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†ä½ å¯ä»¥æ ¹æ®éœ€è¦å–æ¶ˆæ³¨é‡Šå®ƒä»¬ã€‚</span><br><span class="line"></span><br><span class="line">4ã€å°†å…¨å¤‡æ¢å¤åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db01 ~]# mysql -uroot -p123 &lt; /tmp/full.sql</span><br><span class="line"></span><br><span class="line">5ã€ä»æ–°ç¯å¢ƒå¤‡ä»½å‡ºç¨‹åºåº“çš„æ‰€æœ‰è¡¨æ•°æ®(åšä¸€ä¸ªå•åº“çš„å¤‡ä»½)</span><br><span class="line">mysqldump -uroot -p123 -B ç¨‹åºåº“ &gt; /tmp/ç¨‹åºåº“.sql</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -B student &gt; /tmp/student.sql</span><br><span class="line"></span><br><span class="line">6ã€ä¿®æ”¹è¡¨çš„å­˜å‚¨å¼•æ“</span><br><span class="line">[root@db01 ~]# sed -i <span class="string">&#x27;s#ENGINE=MYISAM#ENGINE=INNODB#g&#x27;</span> /tmp/student.sql</span><br><span class="line"></span><br><span class="line">7ã€å°†ä¿®æ”¹åçš„ç¨‹åºåº“æ•°æ®åˆ°æ–°ç¯å¢ƒ</span><br><span class="line"><span class="comment">#æ–°ç¯å¢ƒæ²¡å¼€bin_logçš„å¯¼å…¥æ–¹æ³•</span></span><br><span class="line">[root@db01 student]# mysqldump -uroot -p123 &lt; /tmp/student.sql</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–°ç¯å¢ƒå¼€bin_logçš„å¯¼å…¥æ–¹æ³•ï¼šéœ€è¦åŠ å…¥æ•°æ®åº“</span></span><br><span class="line">1ï¼‰å…³é—­bin_logçš„è®°å½•</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=0;</span><br><span class="line"></span><br><span class="line">2ï¼‰å¯¼å…¥æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">source</span> /tmp/student.sql</span><br><span class="line"></span><br><span class="line">3ï¼‰å¼€å¯bin_logçš„è®°å½•</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> sql_log_bin=1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœåº“æ“ä½œ</span></span><br><span class="line">8ã€å…ˆæŒ‚ç»´æŠ¤é¡µï¼Œæ—§ç¯å¢ƒåœæ­¢è¿æ¥æ•°æ®åº“çš„æœåŠ¡ã€æ•°æ®åº“</span><br><span class="line">[root@db02 ~]# systemctl stop tomcat;systemctl stop php-fpm;systemctl stop mysql</span><br><span class="line"></span><br><span class="line">9ã€ä»bin_logä¸­æˆªå–å¢é‡æ•°æ®</span><br><span class="line"></span><br><span class="line">10ã€å¯åŠ¨æ–°ç¯å¢ƒæ•°æ®åº“</span><br><span class="line"></span><br><span class="line">11ã€æ¢å¤æˆªå–çš„å¢é‡æ•°æ®åˆ°æ–°ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">12ã€æµ‹è¯•ç¯å¢ƒè¿æ¥æ–°åº“ï¼Œæµ‹è¯•æ‰€æœ‰åŠŸèƒ½</span><br><span class="line">    </span><br><span class="line">13ã€åº”ç”¨å‰²æ¥åˆ°æ–°æ•°æ®åº“(æ”¹ç¨‹åºä»£ç è¿æ¥åˆ°æ•°æ®åº“çš„ä¿¡æ¯,å¦‚æœæ˜¯äº‘ä¸»æœºå°±æ”¹äº‘ä¸»æœºçš„ip,ç‰©ç†æœºä¿®æ”¹ç½‘å¡çš„ipå¾ˆéº»çƒ¦,æ”¹ç¨‹åºä»£ç è¿æ¥åˆ°æ•°æ®åº“)</span><br><span class="line"></span><br><span class="line">14ã€å¯åŠ¨è¿æ¥æ•°æ®åº“çš„æœåŠ¡</span><br><span class="line"></span><br><span class="line">15ã€å–æ¶ˆç»´æŠ¤é¡µ</span><br><span class="line"></span><br><span class="line">é¡¹ç›®ç»“æœï¼š</span><br><span class="line">è§£å†³äº†<span class="string">&#x27;å°é—®é¢˜&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>mysqlä¸­çš„è¡¨ç©ºé—´</strong></p><p>åœ¨mysqlä¸­è¡¨ç©ºé—´æœ‰2ç§<br>1ã€å…±äº«è¡¨ç©ºé—´(éœ€è¦åšåˆ‡å‰²)ï¼Œæ‰€æœ‰è¡¨éƒ½èƒ½å…±äº«è¿™é‡Œçš„æ•°æ®<br>â€“  ç”¨æ¥å­˜å‚¨ç³»ç»Ÿæ•°æ®çš„<br>â€“  å­˜undo<br>â€“  ä¸´æ—¶è¡¨(ç±»ä¼¼äºè¿è¡¨æŸ¥è¯¢å‡ºæ¥çš„è¡¨)<br>2ã€ç‹¬ç«‹è¡¨ç©ºé—´(inodbçœ‹åˆ°çš„idbæ–‡ä»¶)<br>â€“  å­˜å‚¨ç”¨æˆ·çœŸå®æ•°æ®<br>â€“  æ¯ä¸€å¼ inodbå­˜å‚¨å¼•æ“çš„è¡¨éƒ½æœ‰ä¸€ä¸ªè‡ªå·±ç‹¬ç«‹è¡¨ç©ºé—´</p><ul><li>å…±äº«è¡¨ç©ºé—´ï¼šç”¨æ¥å­˜å‚¨ç³»ç»Ÿæ•°æ®ã€å­˜undoã€å­˜ä¸´æ—¶è¡¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹å…±äº«è¡¨ç©ºé—´</span></span><br><span class="line"><span class="comment">#ç‰©ç†æŸ¥çœ‹</span></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql       56 Aug  7 23:44 auto.cnf  <span class="comment">#UUIDæ–‡ä»¶</span></span><br><span class="line">-rw-rw---- 1 mysql mysql 79691776 Aug 15 20:56 ibdata1   <span class="comment">#å…±äº«è¡¨ç©ºé—´</span></span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Aug 15 20:56 ib_logfile0</span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Aug  7 23:30 ib_logfile1</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å…±äº«è¡¨ç©ºé—´çš„é…ç½®</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%path%&#x27;</span>;</span><br><span class="line">+----------------------------------+------------------------+</span><br><span class="line">| Variable_name                    | Value                  |</span><br><span class="line">+----------------------------------+------------------------+</span><br><span class="line">| innodb_data_file_path            | ibdata1:12M:autoextend |</span><br><span class="line">+----------------------------------+------------------------+</span><br><span class="line">è¿™ä¸ªè¡¨ç©ºé—´é»˜è®¤å¤§å†™åªèƒ½å­˜å‚¨12Mæ•°æ®   autoextendè‡ªåŠ¨æ‰©å±•ï¼šå¦‚æœè¯´å…±äº«è¡¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå­˜å‚¨ç³»ç»Ÿæ•°æ®çš„ã€å­˜undoã€ä¸´æ—¶è¡¨çš„é€Ÿåº¦è¶Šæ¥è¶Šæ…¢ï¼Œæ‰€ä»¥å…±äº«è¡¨ç©ºé—´è¦åšåˆ‡å‰²</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…±äº«è¡¨ç©ºé—´çš„åˆ‡å‰²</span></span><br><span class="line">1ã€ç¼–è¾‘é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">innodb_data_file_path=ibdata1:50M;ibdata2:50M:autoextend  <span class="comment">#åé¢å†åˆ‡çš„è¯æ”¹ibdata3 ibdata4å°±è¡Œäº†</span></span><br><span class="line"></span><br><span class="line">2ã€é‡å¯æ•°æ®åº“å¤±è´¥</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL.... ERROR! The server quit without updating PID file (/app/mysql-5.6.50/data/db01.pid).</span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹æ—¥å¿—</span><br><span class="line">[root@db01 ~]# tailf -200 /app/mysql-5.6.50/data/db01.err </span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240816162945793.png" alt="image-20240816162945793"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ†æï¼š</span></span><br><span class="line">mysqlé‡Œé¢æœ€å°çš„æ•°æ®å•ä½æ˜¯é¡µï¼Œä¸€é¡µ16K</span><br><span class="line">æŠ¥é”™æ˜¾ç¤ºidbdata1çš„å¤§å°æ˜¯4864é¡µ,è€Œæˆ‘åœ¨é…ç½®æ–‡ä»¶é…ç½®çš„æ˜¯3200é¡µ</span><br><span class="line">(4864*16)/1024=76M                (3200*16)/1024=50M</span><br><span class="line">åŸæœ¬ibdata1å…±äº«è¡¨ç©ºé—´çš„å¤§å°ä¸º76Mï¼Œä½†æ˜¯é…ç½®æ–‡ä»¶ä¸­åªç»™äº†50Mä¸å¤Ÿ</span><br><span class="line"></span><br><span class="line">4ã€æ‰€ä»¥æˆ‘åœ¨æ”¹çš„æ—¶å€™ä¸€å®šè¦çœ‹ä¸€ä¸‹ibdata1å…±äº«è¡¨ç©ºé—´å¤šå¤§ï¼Œæ”¹æˆä¸€æ¨¡ä¸€æ ·çš„å¤§å°å°±å¥½,åé¢çš„æ— æ‰€è°“ï¼Œå› ä¸ºåé¢çš„è¿˜æ²¡æœ‰ç”Ÿæˆ</span><br><span class="line">[root@db01 ~]# <span class="built_in">du</span> -sh /app/mysql-5.6.50/data/ibdata1</span><br><span class="line">76M     /app/mysql-5.6.50/data/ibdata1</span><br><span class="line">è¡¨ç¤ºibdata1 æ–‡ä»¶å ç”¨äº†å¤§çº¦ 76M çš„ç£ç›˜ç©ºé—´</span><br><span class="line"></span><br><span class="line">5ã€é‡æ–°ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå†å¯åŠ¨</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">innodb_data_file_path=ibdata1:76M;ibdata2:50M:autoextend</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">6ã€åˆ‡å‰²å®ŒæˆæŸ¥çœ‹å¤šå‡ºibdata2ï¼Œä»¥åå°±å¾€ibdata2ä¿å­˜ç³»ç»Ÿæ•°æ®ï¼Œundoã€ä¸´æ—¶è¡¨ï¼Œibdata1å°±å›ºå®šåœ¨76Mäº†</span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql 79691776 Aug 16 11:07 ibdata1</span><br><span class="line">-rw-rw---- 1 mysql mysql 52428800 Aug 16 11:07 ibdata2  <span class="comment">#ä¼šæ–°å¢è¿™ä¸ª</span></span><br></pre></td></tr></table></figure><ul><li>ç‹¬ç«‹è¡¨ç©ºé—´ï¼šå­˜å‚¨ç”¨æˆ·çœŸå®æ•°æ®ã€æ¯ä¸€å¼ inodbå­˜å‚¨å¼•æ“çš„è¡¨éƒ½æœ‰ä¸€ä¸ªè‡ªå·±ç‹¬ç«‹è¡¨ç©ºé—´</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">æ‰€æœ‰çš„idbæ–‡ä»¶ï¼Œå°±æ˜¯æ¯ä¸€å¼ è¡¨çš„ç‹¬ç«‹è¡¨ç©ºé—´</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç‹¬ç«‹è¡¨ç©ºé—´</span></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/student/stu*</span><br><span class="line">-rw-rw---- 1 mysql mysql   8726 Aug 13 03:17 stu1.frm</span><br><span class="line">-rw-rw---- 1 mysql mysql  98304 Aug 15 20:52 stu1.ibd    <span class="comment">#ç‹¬ç«‹è¡¨ç©ºé—´</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç‹¬ç«‹è¡¨ç©ºé—´æ˜¯å¦å¼€å¯ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%per_table%&#x27;</span>;</span><br><span class="line">+-----------------------+-------+</span><br><span class="line">| Variable_name         | Value |</span><br><span class="line">+-----------------------+-------+</span><br><span class="line">| innodb_file_per_table | ON    |</span><br><span class="line">+-----------------------+-------+</span><br></pre></td></tr></table></figure><p>5.7ç‰ˆæœ¬ä¸­é»˜è®¤ä¼šå°†undoå’Œä¸´æ—¶è¡¨ç‹¬ç«‹å‡ºæ¥ï¼Œ5.6ç‰ˆæœ¬ä¹Ÿå¯ä»¥ç‹¬ç«‹ï¼Œåªä¸è¿‡éœ€è¦åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œé…ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5.7çš„ä¸´æ—¶è¡¨</span></span><br><span class="line">[root@db03 ~]# ll /app/mysql-5.7.44/data/</span><br><span class="line">-rw-r----- 1 mysql mysql 12582912 Aug  9 05:40 ibtmp1</span><br></pre></td></tr></table></figure><p><strong>ä¼ä¸šæ¡ˆä¾‹2</strong></p><p>åœ¨æ²¡æœ‰å¤‡ä»½æ•°æ®çš„æƒ…å†µä¸‹ï¼Œçªç„¶æ–­ç”µå¯¼è‡´è¡¨ç»“æ„æŸåï¼Œæ‰“ä¸å¼€æ•°æ®åº“ã€‚</p><p>ç¯å¢ƒå‡†å¤‡ï¼š</p><table><thead><tr><th>ä¸»æœºå</th><th>ip</th><th>è§’è‰²</th></tr></thead><tbody><tr><td>db01</td><td>10.0.0.51  /  172.16.1.51</td><td>æ–°ç¯å¢ƒ</td></tr><tr><td>bdb02</td><td>10.0.0.52  /  172.16.1.52</td><td>æ—§ç¯å¢ƒï¼šè¡¨ç»“æ„æŸåçš„æ•°æ®åº“</td></tr></tbody></table><p>æ¨¡æ‹Ÿæ•°æ®æŸå</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¨¡æ‹Ÿè¡¨ç»“æ„æŸå</span></span><br><span class="line">å‡†å¤‡æ•°æ®åº“çš„å¤‡ä»½æ–‡ä»¶ä¼ é€’åˆ°å…¶ä»–æœºå™¨</span><br><span class="line">[root@db01 ~]# <span class="built_in">cd</span> /app/mysql-5.6.50/data/</span><br><span class="line">[root@db01 data]# tar zcf world.tgz world</span><br><span class="line">[root@db01 data]# scp world.tgz 172.16.1.52:/root</span><br><span class="line"></span><br><span class="line">bdb02æ“ä½œï¼š</span><br><span class="line">1ã€å°†åº“æ–‡ä»¶è§£å‹åˆ°mysqlçš„dataç›®å½•</span><br><span class="line">[root@db02 ~]# tar xf world.tgz -C /app/mysql-5.6.50/data/</span><br><span class="line"></span><br><span class="line">2ã€é‡å¯mysql</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€è¿æ¥æ•°æ®åº“ï¼ŒæŸ¥çœ‹åº“æ˜¯å¦å¯¼å…¥æˆåŠŸ</span><br><span class="line">[root@db02 ~]# mysql</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| world              |</span><br><span class="line"></span><br><span class="line">4ã€æŸ¥çœ‹è¡¨é‡Œé¢çš„æ•°æ®ï¼ŒæŠ¥é”™</span><br><span class="line">mysql&gt; use world</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+-----------------+</span><br><span class="line">| Tables_in_world |</span><br><span class="line">+-----------------+</span><br><span class="line">| city            |</span><br><span class="line">| country         |</span><br><span class="line">| countrylanguage |</span><br><span class="line">| score           |</span><br><span class="line">+-----------------+</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from city;</span><br><span class="line">ERROR 1146 (42S02): Table <span class="string">&#x27;world.city&#x27;</span> doesn<span class="string">&#x27;t exist</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; select * from country;</span></span><br><span class="line"><span class="string">ERROR 1146 (42S02): Table &#x27;</span>world.country<span class="string">&#x27; doesn&#x27;</span>t exist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚ä¸‹æ¢å¤çš„æ“ä½œéœ€è¦å‡†å¤‡æ–°ç¯å¢ƒï¼Œä½†æ˜¯æƒ³ä¿ç•™2ä¸ªæœºå™¨ä¹‹å‰çš„æ•°æ®ï¼Œå»ºè®®ç»™db01ã€db02æ‹æ‘„å¿«ç…§</span></span><br></pre></td></tr></table></figure><p>æ¢å¤æ€è·¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">1ã€#å…ˆåœæ­¢db02è¿æ¥mysqlçš„æ‰€æœ‰æœåŠ¡ï¼Œåœæ­¢mysqlæ•°æ®åº“ï¼Œå‡†å¤‡æ–°ç¯å¢ƒ</span><br><span class="line">ç”±äºæˆ‘æŠŠdb01å½“ä½œæ–°ç¯å¢ƒï¼Œå¹¶ä¸”æ‹æ‘„äº†å¿«ç…§ï¼Œæˆ‘å¯ä»¥æŠŠä¹‹å‰çš„æ•°æ®æ–‡ä»¶æ¸…ç†æ‰</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db01 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data/</span><br><span class="line"></span><br><span class="line">é‡æ–°åˆå§‹åŒ–ï¼Œå°±å¯ä»¥å½“ä½œæ–°ç¯å¢ƒçš„æ•°æ®åº“</span><br><span class="line">[root@db01 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db01 ~]# <span class="built_in">echo</span> $?</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">æ–°ç¯å¢ƒOK,å¯åŠ¨mysql</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.Logging to <span class="string">&#x27;/app/mysql-5.6.50/data/db01.err&#x27;</span>.</span><br><span class="line">.. SUCCESS! </span><br><span class="line"></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">total 229028</span><br><span class="line">-rw-rw---- 1 mysql mysql       56 Aug 17 02:16 auto.cnf</span><br><span class="line">-rw-rw---- 1 mysql mysql     1995 Aug 17 02:16 db01.err</span><br><span class="line">-rw-rw---- 1 mysql mysql        5 Aug 17 02:16 db01.pid</span><br><span class="line">-rw-rw---- 1 mysql mysql 79691776 Aug 17 02:16 ibdata1</span><br><span class="line">-rw-rw---- 1 mysql mysql 52428800 Aug 17 02:15 ibdata2</span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Aug 17 02:16 ib_logfile0</span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Aug 17 02:15 ib_logfile1</span><br><span class="line">drwx------ 2 mysql mysql     4096 Aug 17 02:15 mysql</span><br><span class="line">-rw-rw---- 1 mysql mysql    69408 Aug 17 02:15 mysql-bin.000001</span><br><span class="line">-rw-rw---- 1 mysql mysql  1640526 Aug 17 02:15 mysql-bin.000002</span><br><span class="line">-rw-rw---- 1 mysql mysql      120 Aug 17 02:16 mysql-bin.000003</span><br><span class="line">-rw-rw---- 1 mysql mysql       57 Aug 17 02:16 mysql-bin.index</span><br><span class="line">drwx------ 2 mysql mysql     4096 Aug 17 02:15 performance_schema</span><br><span class="line">drwx------ 2 mysql mysql        6 Aug 17 02:15 <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">2ã€#æ—§ç¯å¢ƒçš„è¡¨ç»“æ„(å­—æ®µï¼Œæ•°æ®ç±»å‹ï¼Œçº¦æŸ)å·²ç»æŸåï¼Œéœ€è¦æ‰¾å¼€å‘è¦è¡¨ç»“æ„ï¼ˆå°±æ˜¯å»ºè¡¨è¯­å¥ï¼‰</span><br><span class="line"><span class="comment">#åˆ æ‰å¤–é”®åˆ›å»ºè¯­å¥:  CONSTRAINT `city_ibfk_1` FOREIGN KEY (`CountryCode`) REFERENCES `country` (`Code`)</span></span><br><span class="line"></span><br><span class="line"> CREATE TABLE world.city (</span><br><span class="line">  `ID` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `Name` char(35) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `CountryCode` char(3) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `District` char(20) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `Population` int(11) NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `CountryCode` (`CountryCode`),</span><br><span class="line">  KEY `Population` (`Population`),</span><br><span class="line">  KEY `inx_aa` (`CountryCode`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#ç™»é™†æ–°ç¯å¢ƒçš„æ•°æ®åº“ï¼Œåˆ›å»ºåº“ã€è¡¨</span><br><span class="line">[root@db01 ~]# mysql </span><br><span class="line">root@localhost:(none) &gt; create database world;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; CREATE TABLE world.city (</span><br><span class="line">  `ID` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `Name` char(35) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `CountryCode` char(3) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `District` char(20) NOT NULL DEFAULT <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `Population` int(11) NOT NULL DEFAULT <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  PRIMARY KEY (`ID`),</span><br><span class="line">  KEY `CountryCode` (`CountryCode`),</span><br><span class="line">  KEY `Population` (`Population`),</span><br><span class="line">  KEY `inx_aa` (`CountryCode`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1;</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹è¡¨ç»“æ„å®Œæ•´ï¼Œä½†æ˜¯æ²¡æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; desc world.city;</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field       | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line">| ID          | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| Name        | char(35) | NO   |     |         |                |</span><br><span class="line">| CountryCode | char(3)  | NO   | MUL |         |                |</span><br><span class="line">| District    | char(20) | NO   |     |         |                |</span><br><span class="line">| Population  | int(11)  | NO   | MUL | 0       |                |</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from world.city;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">é‚£ä¹ˆæ•°æ®åœ¨å“ªé‡Œå‘¢ï¼Œæ•°æ®åœ¨ç‹¬ç«‹è¡¨ç©ºé—´</span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/world/</span><br><span class="line">total 16</span><br><span class="line">-rw-rw---- 1 mysql mysql 8710  Aug 17 02:24 city.frm</span><br><span class="line">-rw-rw---- 1 mysql mysql 147456 Aug 17 02:24 city.idb <span class="comment">#ç‹¬ç«‹è¡¨ç©ºé—´</span></span><br><span class="line">-rw-rw---- 1 mysql mysql   61 Aug 17 02:22 db.opt</span><br><span class="line"></span><br><span class="line">4ã€#åˆ é™¤æ–°ç¯å¢ƒçš„ç‹¬ç«‹è¡¨ç©ºé—´</span><br><span class="line">root@localhost:(none) &gt; alter table world.city discard tablespace;</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/world/</span><br><span class="line">total 16</span><br><span class="line">-rw-rw---- 1 mysql mysql 8710 Aug 17 02:24 city.frm</span><br><span class="line">-rw-rw---- 1 mysql mysql   61 Aug 17 02:22 db.opt</span><br><span class="line"><span class="comment">#ç‹¬ç«‹è¡¨ç©ºé—´è¢«åˆ é™¤</span></span><br><span class="line"></span><br><span class="line">5ã€#ä»æ—§ç¯å¢ƒdb02å°†cityè¡¨çš„è¡¨ç©ºé—´å¤åˆ¶è¿‡æ¥</span><br><span class="line">[root@db02 ~]# <span class="built_in">cd</span> /app/mysql-5.6.50/data/world/</span><br><span class="line">[root@db02 world]# scp city.ibd 172.16.1.51:/app/mysql-5.6.50/data/world/</span><br><span class="line"></span><br><span class="line">6ã€#æ–°ç¯å¢ƒdb01ç»™ç‹¬ç«‹è¡¨ç©ºé—´æˆæƒ</span><br><span class="line">[root@db01 ~]# <span class="built_in">chown</span> -R mysql.mysql /app/mysql-5.6.50/data/world</span><br><span class="line"></span><br><span class="line">7ã€#æ–°ç¯å¢ƒdb01å¯¼å…¥è¡¨ç©ºé—´</span><br><span class="line">root@localhost:(none) &gt; alter table world.city import tablespace;</span><br><span class="line"></span><br><span class="line">8ã€#æŸ¥è¯¢æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from world.city;</span><br><span class="line"></span><br><span class="line">9ã€#ç¨‹åºè¿˜åœ¨æ—§æ•°æ®åº“ä¸Šï¼Œæµ‹è¯•æ²¡é—®é¢˜ä¹‹åï¼Œå°±ç”¨äºå‰²æ¥</span><br><span class="line">   - æ–¹æ³•ä¸€ï¼šå¼€å‘ä¿®æ”¹ä»£ç è¿æ¥æ•°æ®åº“çš„IPï¼Œå¼€å‘æ”¹å®Œä»£ç è¦èµ°ä»£ç ä¸Šçº¿çš„æµç¨‹ï¼Œå®¡æ‰¹ï¼Œæµ‹è¯•ï¼Œ..å‘å¸ƒ</span><br><span class="line">   - æ–¹æ³•äºŒï¼šè¿ç»´å¯¼å‡ºæ–°ç¯å¢ƒçš„æ•°æ®ï¼Œæ¢å¤åˆ°æ—§ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">10ã€#å¯åŠ¨è¿æ¥æ•°æ®åº“çš„æœåŠ¡</span><br></pre></td></tr></table></figure><h3 id="Innodbæ ¸å¿ƒç‰¹æ€§â€”â€”äº‹åŠ¡"><strong>Innodbæ ¸å¿ƒç‰¹æ€§â€”â€”äº‹åŠ¡</strong></h3><p><strong>ä»€ä¹ˆæ˜¯äº‹åŠ¡</strong><br>ä¸»è¦é’ˆå¯¹DMLè¯­å¥ï¼ˆupdateï¼Œdeleteï¼Œinsertï¼‰</p><p>ä¸€ç»„æ•°æ®æ“ä½œæ‰§è¡Œæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤è¢«è§†ä¸ºä¸€ä¸ªå·¥ä½œå•å…ƒ:<br>1ï¼‰ç”¨äºå¯¹å¤šä¸ªè¯­å¥è¿›è¡Œåˆ†ç»„<br>2ï¼‰å¯ä»¥åœ¨å¤šä¸ªå®¢æˆ·æœºå¹¶å‘è®¿é—®åŒä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ—¶ä½¿ç”¨</p><p>**äº‹ç‰©çš„ç”Ÿå‘½å‘¨æœŸï¼š**æ‰€æœ‰æ­¥éª¤éƒ½æˆåŠŸæˆ–éƒ½å¤±è´¥<br>1ï¼‰å¦‚æœæ‰€æœ‰æ­¥éª¤æ­£å¸¸ï¼Œåˆ™æ‰§è¡Œ<br>2ï¼‰å¦‚æœæ­¥éª¤å‡ºç°é”™è¯¯æˆ–ä¸å®Œæ•´ï¼Œåˆ™å–æ¶ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æˆåŠŸçš„äº‹ç‰©</span></span><br><span class="line"><span class="comment">#å¼€å¯äº‹ç‰©</span></span><br><span class="line">beginï¼š</span><br><span class="line">ç„¶åæ‰§è¡ŒDMLè¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="comment">#æäº¤äº‹ç‰©</span></span><br><span class="line">commit;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¤±è´¥çš„äº‹ç‰©</span></span><br><span class="line"><span class="comment">#å¼€å¯äº‹ç‰©</span></span><br><span class="line">beginï¼š</span><br><span class="line">ç„¶åæ‰§è¡ŒDMLè¯­å¥</span><br><span class="line"></span><br><span class="line"><span class="comment">#å›æ»šäº‹ç‰©</span></span><br><span class="line">rollback     </span><br><span class="line"></span><br><span class="line">æ‰§è¡Œcommitæˆ–è€…rollback,äº‹ç‰©ä¸ä¼šç›´æ¥å†™åœ¨ç£ç›˜é‡Œï¼Œæ˜¯å…ˆå†™åœ¨æ—¥å¿—é‡Œé¢ï¼Œå†™å…¥æ—¥å¿—æ¯”è¾ƒå¿«ï¼Œæ—¥å¿—ä¼˜å…ˆå†™</span><br></pre></td></tr></table></figure><p>äº‹ç‰©çš„é€šä¿—ç†è§£ï¼šä¼´éšç€â€œäº¤æ˜“â€å‡ºç°çš„æ•°æ®åº“æ¦‚å¿µã€‚æˆ‘ä»¬ç†è§£çš„â€œäº¤æ˜“â€æ˜¯ä»€ä¹ˆï¼Ÿ<br>1ï¼‰ç‰©ä¸ç‰©çš„äº¤æ¢ï¼ˆå¤ä»£ï¼‰<br>2ï¼‰è´§å¸ç°é‡‘ä¸å®ç‰©çš„äº¤æ¢ï¼ˆç°ä»£1ï¼‰<br>3ï¼‰è™šæ‹Ÿè´§å¸ä¸å®ç‰©çš„äº¤æ¢ï¼ˆç°ä»£2ï¼‰<br>4ï¼‰è™šæ‹Ÿè´§å¸ä¸è™šæ‹Ÿå®ç‰©äº¤æ¢ï¼ˆç°ä»£3ï¼‰</p><p><strong>äº‹ç‰©çš„ç‰¹æ€§</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Aï¼šåŸå­æ€§ï¼šå¼€å¯ä¸€ä¸ªäº‹ç‰©ï¼Œè¦ä¹ˆæ“ä½œå…¨éƒ¨æˆåŠŸï¼Œäº‹ç‰©æ‰ä¼šç»“æŸï¼Œå¦‚æœå¤±è´¥ä¸€æ¬¡ï¼Œå°±å›æ»š</span><br><span class="line">Cï¼šä¸€è‡´æ€§ï¼šäº‹ç‰©å¼€å¯ä¹‹å‰å’Œäº‹ç‰©æ‰§è¡Œç»“æŸåï¼Œæ•°æ®çŠ¶æ€ä¿å­˜ä¸€è‡´</span><br><span class="line">Iï¼šéš”ç¦»æ€§ï¼šäº‹ç‰©ä¸äº‹ç‰©ä¹‹é—´æ˜¯éš”ç¦»çš„(å’Œé”æœ‰å…³ç³»ï¼Œé”åˆå’Œéš”ç¦»çº§åˆ«æœ‰å…³ç³»)</span><br><span class="line">Dï¼šæŒä¹…æ€§ï¼šäº‹ç‰©æ“ä½œå®Œæˆåè¦æŒä¹…åŒ–</span><br></pre></td></tr></table></figure><p>äº‹ç‰©æµç¨‹ä¸¾ä¾‹</p><p><img src="../image/study_img/image-20240816121313252.png" alt="image-20240816121313252"></p><p><strong>äº‹ç‰©çš„æµç¨‹æ§åˆ¶è¯­å¥ (DTL ï¼šDatabases Transaction Language)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">DTLä¹Ÿå«TCL(Transaction Control Language)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¨¡æ‹Ÿæ“ä½œäº‹ç‰©(é“¶è¡Œå–é’±)</span></span><br><span class="line">1ã€#åˆ›å»ºä¸€ä¸ªäº¤æ˜“è¡¨ï¼Œå¹¶æ’å…¥æ•°æ®(ä¸€å¼€å§‹ä¸¤ä¸ªäººçš„åˆå§‹ä½™é¢æ˜¯500)</span><br><span class="line">root@localhost:student &gt; create table jiaoyi(money int,name varchar(10));</span><br><span class="line">root@localhost:student &gt; insert into  jiaoyi values(500,<span class="string">&#x27;zhang3&#x27;</span>),(500,<span class="string">&#x27;lisi&#x27;</span>);</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from jiaoyi;</span><br><span class="line">+-------+--------+</span><br><span class="line">| money | name   |</span><br><span class="line">+-------+--------+</span><br><span class="line">|   500 | zhang3 |</span><br><span class="line">|   500 | lisi   |</span><br><span class="line">+-------+--------+</span><br><span class="line"></span><br><span class="line">2ã€#å¼€å¯äº‹ç‰©</span><br><span class="line">root@localhost:student &gt; start transaction;  <span class="comment">#æˆ–è€…beginï¼šéƒ½å¯ä»¥æ˜¾ç¤ºå¼€å¯ä¸€ä¸ªæ–°äº‹ç‰©</span></span><br><span class="line"></span><br><span class="line">3ã€#è¿›è¡Œäº¤æ˜“ï¼Œzhang3ç»™lisiè½¬è´¦300</span><br><span class="line">root@localhost:student &gt; update jiaoyi <span class="built_in">set</span> money=800 <span class="built_in">where</span> name=<span class="string">&#x27;lisi&#x27;</span>;</span><br><span class="line">root@localhost:student &gt; update jiaoyi <span class="built_in">set</span> money=200 <span class="built_in">where</span> name=<span class="string">&#x27;zhang3&#x27;</span>;</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from jiaoyi;</span><br><span class="line">+-------+--------+</span><br><span class="line">| money | name   |</span><br><span class="line">+-------+--------+</span><br><span class="line">|   200 | zhang3 |</span><br><span class="line">|   800 | lisi   |</span><br><span class="line">+-------+--------+</span><br><span class="line"></span><br><span class="line">4ã€#å¼€å¯ä¸€ä¸ªæ–°ç»ˆç«¯Bï¼ŒæŸ¥çœ‹æ•°æ®ï¼Œæ²¡æœ‰å˜åŒ–ï¼Œå› ä¸ºäº‹ç‰©è¿˜æ²¡æœ‰ç»“æŸ</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from jiaoyi;</span><br><span class="line">+-------+--------+</span><br><span class="line">| money | name   |</span><br><span class="line">+-------+--------+</span><br><span class="line">|   500 | zhang3 |</span><br><span class="line">|   500 | lisi   |</span><br><span class="line">+-------+--------+</span><br><span class="line"></span><br><span class="line">5ã€#ç»“æŸäº‹ç‰©</span><br><span class="line">Aç»ˆç«¯ç»“æŸäº‹ç‰©</span><br><span class="line">root@localhost:student &gt; commit;</span><br><span class="line"></span><br><span class="line">Bç»ˆç«¯æŸ¥çœ‹æ•°æ®</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from jiaoyi;</span><br><span class="line">+-------+--------+</span><br><span class="line">| money | name   |</span><br><span class="line">+-------+--------+</span><br><span class="line">|   200 | zhang3 |</span><br><span class="line">|   800 | lisi   |</span><br><span class="line">+-------+--------+</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ç°åœ¨çš„è¿™ä¸ªè¡¨å¯¹äºmysqlæ¥è¯´ï¼Œå°±æ˜¯ä¸€è¡Œï¼Œç°åœ¨çœ‹åˆ°çš„æ ¼å¼åŒ–çš„è¡¨ï¼Œæ˜¯å­˜å‚¨å¼•æ“åšçš„æ ¼å¼åŒ–ï¼Œå¦‚æœæƒ³è®©mysqlè®¤ä¸ºæ˜¯ä¸¤è¡Œæ•°æ®ï¼Œè¡¨é‡Œé¢å¿…é¡»è¦åŠ ä¸»é”®</span><br><span class="line">1ã€#ç»™è¡¨å¢åŠ ä¸»é”®ï¼Œåˆå§‹åŒ–ä½™é¢</span><br><span class="line">root@localhost:student &gt; alter table jiaoyi add <span class="built_in">id</span> int primary key auto_increment first;</span><br><span class="line">root@localhost:student &gt; update jiaoyi <span class="built_in">set</span> money=500 <span class="built_in">where</span> <span class="built_in">id</span>=2;</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from jiaoyi;</span><br><span class="line">+----+-------+--------+</span><br><span class="line">| <span class="built_in">id</span> | money | name   |</span><br><span class="line">+----+-------+--------+</span><br><span class="line">|  1 |   500 | zhang3 |</span><br><span class="line">|  2 |   500 | lisi   |</span><br><span class="line">+----+-------+--------+</span><br><span class="line"></span><br><span class="line">2ã€#Aç»ˆç«¯å¼€å¯ä¸€ä¸ªäº‹ç‰©ï¼Œè¿›è¡Œäº¤æ˜“ï¼Œzhang3ç»™lisiè½¬è´¦300</span><br><span class="line">root@localhost:student &gt; begin;</span><br><span class="line">root@localhost:student &gt; update jiaoyi <span class="built_in">set</span> money=800 <span class="built_in">where</span> <span class="built_in">id</span>=2;#è¿™ä¸ªæ—¶å€™æ¡ä»¶å¿…é¡»ç”¨<span class="built_in">id</span>,å¦‚æœç”¨name,å¯¹äºMySQLæ¥è¯´ï¼Œä¸èƒ½è¯†åˆ«ä¸ºä¸€è¡Œ</span><br><span class="line">root@localhost:student &gt; update jiaoyi <span class="built_in">set</span> money=200 <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from jiaoyi;</span><br><span class="line">+----+-------+--------+</span><br><span class="line">| <span class="built_in">id</span> | money | name   |</span><br><span class="line">+----+-------+--------+</span><br><span class="line">|  1 |   200 | zhang3 |</span><br><span class="line">|  2 |   800 | lisi   |</span><br><span class="line">+----+-------+--------+</span><br><span class="line"></span><br><span class="line">3ã€#Bç»ˆç«¯å¼€å¯ä¸€ä¸ªäº‹ç‰©ï¼Œæœ‰äººå¾€zhang3çš„è´¦å·è½¬1000å…ƒ</span><br><span class="line">root@localhost:student &gt; begin;</span><br><span class="line">root@localhost:student &gt; update jiaoyi <span class="built_in">set</span> money=1000 <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line">ä¸åŒçš„è¡Œï¼Œäº‹ç‰©ä¸äº‹ç‰©ä¹‹é—´ä¸å½±å“</span><br><span class="line">å¦‚æœæ˜¯åŒä¸€è¡Œï¼Œéƒ½åœ¨æ“ä½œäº‹ç‰©ï¼Œå°±è¦ç­‰å…ˆå¼€å¯çš„äº‹ç‰©å®Œæˆæ“ä½œä¹‹åï¼Œåå¼€å¯çš„äº‹ç‰©æ‰è¿›è¡Œæ“ä½œ</span><br><span class="line"></span><br><span class="line">4ã€ABç»ˆç«¯ç»“æŸäº‹ç‰©</span><br><span class="line">root@localhost:student &gt; commit;</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from jiaoyi;</span><br><span class="line">+----+-------+--------+</span><br><span class="line">| <span class="built_in">id</span> | money | name   |</span><br><span class="line">+----+-------+--------+</span><br><span class="line">|  1 |  1200 | zhang3 |</span><br><span class="line">|  2 |   800 | lisi   |</span><br><span class="line">+----+-------+--------+</span><br></pre></td></tr></table></figure><p><strong>äº‹ç‰©çš„è‡ªåŠ¨æäº¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">mysqlä¸æ˜¯æ‰§è¡Œbeginçš„æ—¶å€™å¼€å¯äº‹ç‰©ï¼Œæ˜¯æ‰§è¡ŒDMLè¯­å¥åï¼Œä¼šè‡ªåŠ¨å¼€å¯äº‹ç‰©ï¼Œå› ä¸ºmysqlé‡Œé¢é»˜è®¤æœ‰ä¸€ä¸ªé…ç½®ï¼š</span><br><span class="line">root@localhost:student &gt; show variables like <span class="string">&#x27;%auto%&#x27;</span>;</span><br><span class="line">+-----------------------------+-------+</span><br><span class="line">| Variable_name               | Value |</span><br><span class="line">+-----------------------------+-------+</span><br><span class="line">| auto_increment_increment    | 1     |</span><br><span class="line">| auto_increment_offset       | 1     |</span><br><span class="line">| autocommit                  | ON    |#é»˜è®¤mysqlå¼€å¯è‡ªåŠ¨æäº¤</span><br><span class="line">| automatic_sp_privileges     | ON    |</span><br><span class="line">| innodb_autoextend_increment | 64    |</span><br><span class="line">| innodb_autoinc_lock_mode    | 1     |</span><br><span class="line">| innodb_stats_auto_recalc    | ON    |</span><br><span class="line">| sql_auto_is_null            | OFF   |</span><br><span class="line">+-----------------------------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹bin_logæ—¥å¿—</span></span><br><span class="line">[root@db01 ~]# mysqlbinlog --base64-output=decode rows -vvv /app/mysql-5.6.50/data/mysql-bin.000010</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€#åœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼Œå¦‚æœæ‰§è¡ŒDDLã€DCLè¯­å¥ï¼Œéƒ½ä¼šå¯¼è‡´äº‹ç‰©è‡ªåŠ¨æäº¤</span><br><span class="line"></span><br><span class="line">2ã€#åœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼Œå¦‚æœæ‰§è¡Œbeginï¼Œä¼šè‡ªåŠ¨æäº¤ä¸Šä¸€æ¬¡äº‹ç‰©ï¼Œå¼€å¯ä¸€ä¸ªæ–°äº‹ç‰©</span><br><span class="line"></span><br><span class="line">3ã€#åœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼Œå¦‚æœæ‰§è¡Œé”å®šè¯­å¥(lock tablesã€unlock tables),ä¼šè‡ªåŠ¨æäº¤äº‹ç‰©</span><br><span class="line"></span><br><span class="line">4ã€#åœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œå¯¼å‡ºæ•°æ®(load data infile)</span><br><span class="line"></span><br><span class="line">5ã€#åœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼Œæ‰§è¡Œ(<span class="keyword">select</span> <span class="keyword">for</span> update)</span><br><span class="line"></span><br><span class="line">6ã€#åœ¨æ‰§è¡Œautocommit=1çš„æ—¶å€™</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## å…³äºäº‹åŠ¡çš„è¯­å¥</span></span><br><span class="line">START TRANSACTIONï¼ˆæˆ– BEGINï¼‰ï¼šæ˜¾å¼å¼€å§‹ä¸€ä¸ªæ–°äº‹åŠ¡</span><br><span class="line"><span class="comment"># SAVEPOINTï¼šåˆ†é…äº‹åŠ¡è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œä»¥ä¾›å°†æ¥å¼•ç”¨</span></span><br><span class="line">root@localhost:(none):47: &gt;savepoint lzd_1000;</span><br><span class="line"><span class="comment"># COMMITï¼šæ°¸ä¹…è®°å½•å½“å‰äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</span></span><br><span class="line"><span class="comment"># ROLLBACKï¼šå–æ¶ˆå½“å‰äº‹åŠ¡æ‰€åšçš„æ›´æ”¹</span></span><br><span class="line"><span class="comment"># ROLLBACK TO SAVEPOINTï¼šå–æ¶ˆåœ¨ savepoint ä¹‹åæ‰§è¡Œçš„æ›´æ”¹</span></span><br><span class="line">root@localhost:(none):48: &gt;rollback to savepoint lzd_1000;</span><br><span class="line"><span class="comment"># RELEASE SAVEPOINTï¼šåˆ é™¤ savepoint æ ‡è¯†ç¬¦</span></span><br><span class="line">root@localhost:(none):49: &gt;release savepoint lzd_1000;</span><br><span class="line"><span class="comment"># ä¸´æ—¶è®¾ç½®è‡ªåŠ¨æäº¤</span></span><br><span class="line">SET AUTOCOMMITï¼šä¸ºå½“å‰è¿æ¥ç¦ç”¨æˆ–å¯ç”¨é»˜è®¤ autocommit æ¨¡å¼</span><br><span class="line">root@localhost:(none):50: &gt;<span class="built_in">set</span> autocommit=1;</span><br><span class="line">root@localhost:(none):50: &gt;<span class="built_in">set</span> autocommit=0;</span><br></pre></td></tr></table></figure><h3 id="äº‹ç‰©æ—¥å¿—redo"><strong>äº‹ç‰©æ—¥å¿—redo</strong></h3><p>MySQLç‰¹æ€§ï¼šWALç‰¹æ€§  Write Ahead Log æ—¥å¿—ä¼˜å…ˆå†™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹mysqlçš„redo   åœ¨ç£ç›˜ä¸Šé¢å­˜ç€</span></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Aug 18 00:20 ib_logfile0</span><br><span class="line">-rw-rw---- 1 mysql mysql 50331648 Aug  7 23:30 ib_logfile1</span><br><span class="line"></span><br><span class="line">redoçš„æ„æ€ï¼šé‡åš</span><br></pre></td></tr></table></figure><p>redologçš„å·¥ä½œæµç¨‹</p><p><img src="../image/study_img/image-20240819151513794.png" alt="image-20240819151513794"></p><p><strong>è‡ªåŠ¨æ•…éšœæ¢å¤CSR  æŠŠæ•°æ®è¯¥æ¨¡æ‹Ÿçš„æ¨¡æ‹Ÿï¼Œè¯¥å˜åŒ–çš„å˜åŒ–ï¼Œå†™å…¥åˆ°è¡¨ç©ºé—´</strong></p><p>æ–­ç”µï¼š</p><p>1ã€æ•°æ®commit,æ•°æ®å†™å…¥ib_logfile(redolog)æ—¶ï¼Œçªç„¶æ–­ç”µ</p><p>2ã€æ²¡æœ‰commit,æ•°æ®å†™å…¥ib_logfile(redo log)æ—¶</p><p>3ã€æ•°æ®æ²¡æœ‰commit,æ²¡æœ‰è®°å½•åœ¨redo logä¸­</p><p>è¿™3ç§æƒ…å†µçš„æ•°æ®å¦‚ä½•å¤„ç†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æƒ…å†µ1:æ•°æ®commit,æ•°æ®å†™å…¥ib_logfile(redolog)æ—¶ï¼Œçªç„¶æ–­ç”µï¼Œè¡¨ç©ºé—´çš„æ•°æ®æ€ä¹ˆæ¢å¤ï¼Œå¦‚æœä¸æ¢å¤ï¼Œç”¨æˆ·çœ‹åˆ°æ•°æ®è¿˜æ˜¯500ï¼Œæ˜¯ä¸å¯¹çš„</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240819154720922.png" alt="image-20240819154720922"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æƒ…å†µ2ï¼šæ²¡æœ‰commit,æ•°æ®å†™å…¥ib_logfile(redo log)æ—¶ï¼Œçªç„¶æ–­ç”µ</span></span><br><span class="line"></span><br><span class="line">è¿™ç§æƒ…å†µä¼šå‡ºç°é—®é¢˜ï¼Œæ•°æ®ä¸èƒ½æ¢å¤ï¼Œåªèƒ½å°†å˜åŒ–è¿‡ç¨‹è®°å½•åˆ°redo <span class="built_in">log</span>ï¼Œä¸èƒ½æŠŠæ¨¡æ‹Ÿå‡ºæ¥çš„800å†™å…¥ç‹¬ç«‹è¡¨ç©ºé—´,æ‰€ä»¥éœ€è¦é…åˆundo</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240819155546706.png" alt="image-20240819155546706"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æƒ…å†µ3ï¼šæ²¡æœ‰commit,ä¹Ÿæ²¡æœ‰å†™å…¥ib_logfile(redo log)æ—¶ï¼Œçªç„¶æ–­ç”µ</span></span><br><span class="line"></span><br><span class="line">æ²¡æœ‰commit,ä¹Ÿæ²¡æœ‰å†™å…¥ib_logfile(redo <span class="built_in">log</span>)æ—¶ï¼Œå°±ä¸ä¼šæœ‰å˜åŒ–è¿‡ç¨‹ï¼ŒåŸæ•°æ®è¿˜æ˜¯åŸæ•°æ®ï¼Œæ²¡ä»€ä¹ˆå˜åŒ–</span><br></pre></td></tr></table></figure><p><strong>äº‹ç‰©æ—¥å¿—undo</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹mysqlçš„undo</span></span><br><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql 79691776 Aug 18 00:20 ibdata1</span><br><span class="line">-rw-rw---- 1 mysql mysql 52428800 Aug 18 00:20 ibdata2</span><br><span class="line"></span><br><span class="line">undoï¼šä¸åš   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">äº‹åŠ¡æ—¥å¿—undo</span><br><span class="line">1ï¼‰undoæ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">undo,é¡¾åæ€ä¹‰â€œå›æ»šæ—¥å¿—â€ï¼Œæ˜¯äº‹åŠ¡æ—¥å¿—çš„ä¸€ç§ã€‚</span><br><span class="line"></span><br><span class="line">_2ï¼‰ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">åœ¨äº‹åŠ¡ACIDè¿‡ç¨‹ä¸­ï¼Œå®ç°çš„æ˜¯â€œAâ€åŸå­æ€§çš„ä½œç”¨ã€‚å½“ç„¶CIçš„ç‰¹æ€§ä¹Ÿå’Œundoæœ‰å…³</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é¢è¯•é—®é¢˜ï¼š</span><br><span class="line"><span class="comment">#mysql CSRçš„è¿‡ç¨‹å’Œä»€ä¹ˆæœ‰å…³</span></span><br><span class="line">CSRå’Œ2ä¸ªæ—¥å¿—æ–‡ä»¶æœ‰å…³ï¼Œäº‹ç‰©æ—¥å¿—redoã€undoï¼Œredoé‡åšæ•°æ®ï¼Œundoä¸åšæ•°æ®ï¼Œä»–ä»¬åˆ†åˆ«åœ¨MySQLçš„dataç›®å½•ä¸‹</span><br><span class="line">redoå°±åœ¨æ•°æ®ç›®å½•ä¸‹</span><br><span class="line">undo:åœ¨MySQL5.6ç‰ˆæœ¬ä¸­undoæ˜¯åœ¨ibdata(å…±äº«è¡¨ç©ºé—´)æ–‡ä»¶ä¸­ï¼Œåœ¨MySQL5.7ç‰ˆæœ¬ä¼šç‹¬ç«‹å‡ºæ¥ã€‚</span><br></pre></td></tr></table></figure><p><strong>MYSQL CSRçš„è¿‡ç¨‹   æ–­ç”µä¹‹åï¼Œundoç»“åˆredoï¼Œæ¢å¤æ•°æ®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æƒ…å†µ1:æ•°æ®commit,æ•°æ®å†™å…¥ib_logfile(redolog)æ—¶ï¼Œçªç„¶æ–­ç”µï¼Œè¡¨ç©ºé—´çš„æ•°æ®æ€ä¹ˆæ¢å¤ï¼Œ</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240819170447907.png" alt="image-20240819170447907"></p><p>çªç„¶æ–­ç”µï¼Œå†…å­˜é‡Œé¢çš„æ•°æ®æ²¡äº†</p><p><img src="../image/study_img/image-20240819172903983.png" alt="image-20240819172903983"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æƒ…å†µ2ï¼šæ²¡æœ‰commit,æ•°æ®å†™å…¥ib_logfile(redo log)æ—¶ï¼Œçªç„¶æ–­ç”µ</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240819174134262.png" alt="image-20240819174134262"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ–­ç”µæ—¶ï¼Œredoé…åˆundoæ¢å¤æ•°æ®</span><br><span class="line"><span class="comment">#æƒ…å†µ3:æ²¡æœ‰commit,æ²¡æœ‰å†™å…¥ib_logfile(redolog)æ—¶ï¼Œçªç„¶æ–­ç”µ,è¡¨ç©ºé—´çš„æ•°æ®æ€ä¹ˆæ¢å¤</span></span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240819175306313.png" alt="image-20240819175306313"></p><p><strong>äº‹ç‰©ä¸­çš„é”</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1ï¼‰ä»€ä¹ˆæ˜¯â€œé”â€ï¼Ÿ</span><br><span class="line">â€œé”â€é¡¾åæ€ä¹‰å°±æ˜¯é”å®šçš„æ„æ€ã€‚</span><br><span class="line"></span><br><span class="line">2ï¼‰â€œé”â€çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line">åœ¨äº‹åŠ¡ACIDç‰¹æ€§è¿‡ç¨‹ä¸­ï¼Œâ€œé”â€å’Œâ€œéš”ç¦»çº§åˆ«â€ä¸€èµ·æ¥å®ç°â€œIâ€éš”ç¦»æ€§çš„ä½œç”¨ã€‚</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240819111236391.png" alt="image-20240819111236391"></p><p>æœ€åçš„æ•°æ®A=2   å› ä¸ºè°å…ˆæäº¤ï¼Œä»¥è°ä¸ºå‡†ï¼Œæ¡ä»¶åé¢çš„A=1æ²¡æœ‰äº†ï¼Œè¢«ç¬¬äºŒä¸ªäº‹åŠ¡æ”¹æ‰äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ’ä»–é”ï¼šæ‰€è°“çš„è¡ŒåŠé”å°±æ˜¯æ’ä»–é”é€ æˆçš„ï¼Œåœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´,ä¸å…è®¸å…¶ä»–äº‹ç‰©æ‰§è¡Œä¿®æ”¹æ“ä½œ</span><br><span class="line">å…±äº«é”ï¼šåœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼Œå…è®¸æ‰€æœ‰äº‹ç‰©æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</span><br><span class="line"></span><br><span class="line">ä»–ä¸¤ç»“åˆå°±æ˜¯ï¼šé˜»å¡ä¿®æ”¹åˆ é™¤æ“ä½œï¼Œä¸é˜»å¡æŸ¥è¯¢æ“ä½œ</span><br><span class="line"></span><br><span class="line">ä¹è§‚é”ï¼šè°å…ˆæäº¤ä»¥è°ä¸ºå‡†</span><br><span class="line">æ‚²è§‚é”ï¼šåœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼Œé˜»å¡å…¶ä»–äº‹ç‰©çš„æŸ¥è¯¢æ“ä½œã€‚å‰©1å¼ ç¥¨ï¼Œæˆ‘æŠ¢äº†ï¼Œä¸ç®¡æ˜¯å¦ä»˜æ¬¾ï¼Œä½ çœ‹ä¸åˆ°è¿™ä¸ªç¥¨</span><br></pre></td></tr></table></figure><p><strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(MVCC)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1ï¼‰åªé˜»å¡ä¿®æ”¹ç±»æ“ä½œï¼Œä¸é˜»å¡æŸ¥è¯¢ç±»æ“ä½œ</span><br><span class="line">2ï¼‰ä¹è§‚é”çš„æœºåˆ¶ï¼ˆè°å…ˆæäº¤è°ä¸ºå‡†ï¼‰ï¼Œmysqlä¸èƒ½æ¼”ç¤ºï¼Œå› ä¸ºéš”ç¦»çº§åˆ«å­˜åœ¨</span><br><span class="line"></span><br><span class="line"><span class="comment">#é”çš„ç²’åº¦</span></span><br><span class="line">MyIsamï¼šä½å¹¶å‘é”ï¼ˆè¡¨çº§é”ï¼‰</span><br><span class="line">Innodbï¼šé«˜å¹¶å‘é”ï¼ˆè¡Œçº§é”ï¼‰</span><br></pre></td></tr></table></figure><p><strong>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹éš”ç¦»çº§åˆ«</span></span><br><span class="line">root@localhost:(none) &gt; show variables like <span class="string">&#x27;%iso%&#x27;</span>;</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| Variable_name | Value           |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| tx_isolation  | REPEATABLE-READ |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line"></span><br><span class="line">å››ç§éš”ç¦»çº§åˆ«ï¼š</span><br><span class="line">1ã€#READ UNCOMMITTEDï¼ˆæœªæäº¤è¯»ï¼‰ <span class="comment">#RUçº§åˆ«</span></span><br><span class="line">å…è®¸äº‹åŠ¡æŸ¥çœ‹å…¶ä»–äº‹åŠ¡æ‰€è¿›è¡Œçš„æœªæäº¤æ›´æ”¹</span><br><span class="line"></span><br><span class="line">2ã€#READ COMMITTED(å·²æäº¤è¯»)  <span class="comment">#RCçº§åˆ«</span></span><br><span class="line">å…è®¸äº‹åŠ¡æŸ¥çœ‹å…¶ä»–äº‹åŠ¡æ‰€è¿›è¡Œçš„å·²æäº¤æ›´æ”¹</span><br><span class="line"></span><br><span class="line">3ã€#REPEATABLE READï¼ˆé‡å¤è¯»ï¼‰ <span class="comment">#RRçº§åˆ«</span></span><br><span class="line">ç¡®ä¿æ¯ä¸ªäº‹åŠ¡çš„ SELECT è¾“å‡ºä¸€è‡´ï¼Œæ¯”å¦‚è¯´ï¼Œä½ å†²é’±äº†ï¼Œè¦åˆ·æ–°æˆ–è€…é€€å‡ºï¼Œæ‰å¯ä»¥çœ‹åˆ°æ›´æ–°åçš„é’±</span><br><span class="line">InnoDB çš„é»˜è®¤çº§åˆ«</span><br><span class="line"></span><br><span class="line">4ã€#SERIALIZABLE (ä¸²è¡ŒåŒ–)  <span class="comment">#ä¸ç”¨è¿™ä¸ªçº§åˆ«</span></span><br><span class="line">å°†ä¸€ä¸ªäº‹åŠ¡çš„ç»“æœä¸å…¶ä»–äº‹åŠ¡å®Œå…¨éš”ç¦»</span><br><span class="line">åœ¨äº‹ç‰©æ‰§è¡ŒæœŸé—´ï¼ŒæŸ¥è¯¢åˆ°çš„æ•°æ®æ˜¯undoé‡Œé¢=çš„æ•°æ®ï¼Œ</span><br><span class="line">æŸ¥è¯¢çš„æ—¶å€™ï¼Œé˜»å¡ä¿®æ”¹</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹éš”ç¦»çº§åˆ«</span></span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%iso%&#x27;</span>;</span><br><span class="line"><span class="comment">#ä¿®æ”¹éš”ç¦»çº§åˆ«ä¸ºRU</span></span><br><span class="line">[mysqld]</span><br><span class="line">transaction_isolation=read-uncommit</span><br><span class="line">mysql&gt; use oldboy</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from stu;</span><br><span class="line">mysql&gt; insert into stu(<span class="built_in">id</span>,name,sex,money) values(2,<span class="string">&#x27;li4&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,123);</span><br><span class="line"><span class="comment">#ä¿®æ”¹éš”ç¦»çº§åˆ«ä¸ºRC  ä¸éœ€è¦ä¿®æ”¹ï¼ŒçŸ¥é“ä¿®æ”¹æ–¹æ³•</span></span><br><span class="line">[mysqld]</span><br><span class="line">transaction_isolation=read-commit</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysqlä»¥å‰ç‰ˆæœ¬å­˜åœ¨çš„é—®é¢˜ï¼šåˆ†åˆ«æ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Œç®€å•äº†è§£è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">1ã€è„è¯»:éš”ç¦»çº§åˆ«æ˜¯RUçº§åˆ«å°±äº§ç”Ÿè„è¯»ï¼Œè„è¯»è¯»å–åˆ°çš„æ˜¯å…¶ä»–äº‹åŠ¡ä¸­æœªæäº¤çš„æ•°æ®ã€‚æ¯”å¦‚è¯´æœ‰ä¸€ä¸ªäº‹åŠ¡ï¼ŒAç»™Bè½¬é’±ï¼Œä¸€å¼€å§‹ä¸¤ä¸ªäººéƒ½æ˜¯500ï¼ŒAç»™Bè½¬300ï¼ŒBå°±æœ‰800å¹¶å»æŸ¥ï¼ŒæŸ¥çœ‹åˆ°800ï¼Œä½†æ˜¯Aæ²¡æœ‰æäº¤ï¼ŒBçœ‹åˆ°çš„å°±æ˜¯è„æ•°æ®ï¼Œå› ä¸ºAçš„ä½™é¢å¯èƒ½ä¸è¶³ï¼Œå›æ»šè½¬é’±     </span><br><span class="line"></span><br><span class="line">è§£å†³åŠæ³•ï¼šæé«˜éš”ç¦»åŸºæœ¬RCçº§åˆ«ï¼Œå¯ä»¥è§£å†³è„è¯»çš„é—®é¢˜</span><br><span class="line"></span><br><span class="line">2ã€å¹»è¯»ï¼šå·²æäº¤è¯»å¼€2ä¸ªäº‹åŠ¡ï¼Œå»æŸ¥çœ‹åŒä¸€è¡Œæ•°æ®</span><br><span class="line">åœ¨ä¸€ä¸ªä¸»é”®ä¸­æ˜æ˜æ²¡æœ‰æŸ¥åˆ°ä¸»é”®ä¸ºXçš„æ•°æ®ï¼Œä½†ä¸»é”®ä¸ºXçš„æ•°æ®å°±æ˜¯æ’ä¸è¿›å»ï¼Œå°±åƒæŸç§å¹»è§‰ä¸€æ ·</span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨RRçº§åˆ«è§£å†³ï¼Œä½¿ç”¨äº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ¥é¿å…å¹»è¯»ã€‚ä¸è„è¯»ç±»ä¼¼ï¼Œé€šè¿‡è®¾ç½®åˆé€‚çš„éš”ç¦»çº§åˆ«å¯ä»¥è§£å†³å¹»è¯»é—®é¢˜ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è¡Œçº§é”æˆ–è¡¨çº§é”æ¥é™åˆ¶æŸ¥è¯¢çš„èŒƒå›´ï¼Œä»è€Œé¿å…å¹»è¯»çš„å‘ç”Ÿã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡å…ˆåæ‰§è¡ŒåŒä¸€æ¡SQL,ä½†2æ¬¡è¯»å–åˆ°çš„æ•°æ®ä¸åŒï¼Œå°±æ˜¯ä¸å¯é‡å¤è¯»</span><br><span class="line"></span><br><span class="line">è§£å†³æ–¹æ¡ˆï¼šåŒæ ·å¯ä»¥ä½¿ç”¨äº‹åŠ¡çš„éš”ç¦»çº§åˆ«å’Œè¡Œçº§é”æ¥é¿å…ä¸å¯é‡å¤è¯»ã€‚å¦å¤–ï¼ŒMySQLè¿˜æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„é”â€”â€”å¯é‡å¤è¯»é”ï¼ˆRepeatable Readï¼‰ï¼Œå®ƒå¯ä»¥é¿å…ä¸å¯é‡å¤è¯»çš„é—®é¢˜ã€‚è¦ä½¿ç”¨å¯é‡å¤è¯»é”ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢è¯­å¥å‰åŠ ä¸ŠFOR REPLICATE READå…³é”®å­—ï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è„è¯»æ˜¯è¯»åˆ°äº†å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼Œè€Œä¸å¯é‡å¤è¯»æ˜¯è¯»åˆ°äº†å…¶ä»–äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œä½†å‰åæŸ¥è¯¢çš„ç»“æœä¸åŒï¼Œè€Œå¹»è¯»åˆ™æ˜¯æ˜æ˜æŸ¥è¯¢ä¸åˆ°ï¼Œä½†å°±æ˜¯æ’å…¥ä¸äº†ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#rediså­˜åœ¨çš„é—®é¢˜</span></span><br><span class="line">ç¼“å­˜å‡»ç©¿ï¼šå½“æœ‰1ä¸ªkeyï¼Œè®¾ç½®æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥åï¼ŒæŸ¥è¯¢è¿™ä¸ªå¯ä»¥æ—¶ï¼Œåˆšå¥½è¿™ä¸ªkeyåˆ°æœŸäº†ï¼Œç›´æ¥ç©¿è¿‡ç¼“å­˜ï¼Œæ‰“åˆ°æ•°æ®åº“ä¸Šã€‚å½“æœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ä¸Šï¼Œä¼šå¯¼è‡´æ•°æ®åº“è¢«æ‰“å®</span><br><span class="line"></span><br><span class="line">ç¼“å­˜ç©¿é€ï¼šæ„å‘³ç€è¿™ä¸ªæ•°æ®ï¼Œæ•°æ®åº“é‡Œé¢æ²¡æœ‰ï¼Œæ‰€ä»¥ä¸ä¼šæŠŠæ•°æ®æ”¾åˆ°redisç¼“å­˜é‡Œï¼Œåªè¦æœ‰äººæ¥æŸ¥è¯¢ï¼Œå°±ä¸€å®šç¼“å­˜ä¸­æŸ¥ä¸åˆ°ï¼Œæ‰€ä»¥ä¸€å®šè¦èµ°æ•°æ®åº“</span><br><span class="line">é‚£ä¹ˆï¼Œå‡è®¾å¾ˆå¤šäººï¼Œæ•…æ„å»æŸ¥é‚£äº›æ•°æ®åº“é‡Œä¹Ÿæ²¡æœ‰çš„è®°å½•ï¼Œæˆ‘ä»¬çš„ redis å°±èµ·ä¸åˆ°å±éšœçš„ä½œç”¨ï¼Œå› ä¸º redis é‡Œä¸å¯èƒ½æœ‰æ•°æ®ï¼Œæ‰€ä»¥å¹¶å‘æŸ¥è¯¢å°±ä¸€å®šä¼šæ‰“åˆ°æ•°æ®åº“çš„èº«ä¸Šã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å‡»ç©¿ï¼šæ•°æ®åº“é‡Œ<span class="string">&#x27;æœ‰&#x27;</span>æ•°æ®</span><br><span class="line">ç©¿é€ï¼šæ•°æ®åº“é‡Œ<span class="string">&#x27;æ²¡æœ‰&#x27;</span>æ•°æ®</span><br><span class="line"></span><br><span class="line">ç¼“å­˜é›ªå´©ï¼šå¤§é¢ç§¯çš„keyåŒæ—¶è¿‡æœŸï¼Œå¤§é‡çš„å¹¶å‘æ‰“åˆ°æ•°æ®åº“</span><br><span class="line">ä¸åƒç¼“å†²å‡»ç©¿ï¼Œåªæ˜¯å› ä¸ºä¸€ä¸ªkeyçš„è¿‡æœŸï¼Œæ‰€ä»¥ï¼Œå¯¹äºé›ªå´©æ¥è¯´ï¼Œä¸€èˆ¬å°‘é‡çš„keyå¤±æ•ˆï¼Œæ‰€å¸¦æ¥çš„æ•°æ®åº“å¹¶å‘å‹åŠ›ä¸æ˜¯å¾ˆå¤§ï¼Œè€Œå¤§é‡çš„keyåŒæ—¶å¤±æ•ˆï¼Œå¯¼è‡´keyçš„å¹¶å‘åŠ èµ·æ¥ï¼Œä¼šå½±å“åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ã€‚é‚£å°±ç®—ä¸€ä¸ªkeyå¤±æ•ˆï¼Œä¹Ÿä¼šå¯¹æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å½±å“ï¼Œé‚£ä¹ˆæŠŠé›ªå´©çš„æ‰€æœ‰keyæ‹†é™¤ä¸€ä¸ªä¸€ä¸ªè¿‡æœŸçš„keyæ¥çœ‹ï¼Œä¹Ÿå°±æ˜¯é›ªå´©å¯ä»¥æ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªç¼“å­˜å‡»ç©¿çš„é›†åˆï¼ŒæŠŠæ•°æ®åº“æ‰“å´©</span><br><span class="line"></span><br><span class="line">è§£å†³è¿™äº›é—®é¢˜éƒ½æ˜¯å¼€å‘å†™ä»£ç å»è§£å†³</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•8ã€Mysqlçš„ç´¢å¼•æ‰§è¡Œè®¡åˆ’</title>
      <link href="/posts/116a6ae3.html"/>
      <url>/posts/116a6ae3.html</url>
      
        <content type="html"><![CDATA[<h2 id="Mysqlçš„ç´¢å¼•æ‰§è¡Œè®¡åˆ’">Mysqlçš„ç´¢å¼•æ‰§è¡Œè®¡åˆ’</h2><p><strong>ç´¢å¼•çš„ä»‹ç»</strong><br>1ï¼‰ç´¢å¼•å°±å¥½æ¯”ä¸€æœ¬ä¹¦çš„ç›®å½•ï¼Œå®ƒèƒ½è®©ä½ æ›´å¿«çš„æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„å†…å®¹ã€‚<br>2ï¼‰è®©è·å–çš„æ•°æ®æ›´æœ‰ç›®çš„æ€§ï¼Œä»è€Œæé«˜æ•°æ®åº“æ£€ç´¢æ•°æ®çš„æ€§èƒ½ã€‚</p><p><strong>ç´¢å¼•ç®—æ³•ç±»å‹</strong></p><p><font color=red>1ã€Btreeç®—æ³•ï¼šBæ ‘ç®—æ³•  ï¼ˆå½“å‰mysqlé»˜è®¤çš„ç®—æ³•ï¼‰</font>&gt;<br>2ã€HASHï¼šå“ˆå¸Œç®—æ³•<br>3ã€Fulltextï¼šå…¨æ–‡ç®—æ³•<br>4ã€Rtreeï¼šRæ•°ç®—æ³•<br>ä½¿ç”¨ä»€ä¹ˆç®—æ³•çš„ç´¢å¼•ï¼Œæ ¹mysqlçš„å­˜å‚¨å¼•æ“æœ‰å…³ï¼ˆinnodbï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:(none) &gt; show engines;</span><br><span class="line">å“ˆå¸Œç®—æ³•åªèƒ½ç”¨åœ¨MEMORY </span><br></pre></td></tr></table></figure><p><strong>Btreeç®—æ³•</strong></p><p><img src="../image/study_img/image-20240815090340158.png" alt="image-20240815090340158"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§„å¾‹ï¼š ä¸‰è·¯Btree</span></span><br><span class="line">1ã€æ¯ä¸€ä¸ªæ•°æ®é¡µä¸Šé¢éƒ½æœ‰3ä¸ªæ•°æ®</span><br><span class="line">2ã€P1  P2  P3å«æ•°æ®é¡µ</span><br><span class="line">3ã€æ¯ä¸€é¡µä¸Šçš„å€¼ï¼Œéƒ½æ˜¯ä¸‹ä¸€è·¯æ•°æ®ä¸Šçš„æœ€å°å€¼</span><br><span class="line"></span><br><span class="line">Btreeç®—æ³•æ˜¯åˆ›å»ºç´¢å¼•ä¹‹åçš„æ’åºè§„åˆ™</span><br><span class="line">æ ¹åˆ†æ”¯ï¼š(æ ¹èŠ‚ç‚¹)   </span><br><span class="line">ä¸­é—´éƒ¨åˆ†ï¼šæèŠ‚ç‚¹</span><br><span class="line">æœ€é¡¶ä¸Šï¼šå¶å­èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç²¾ç¡®æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>=32;    è¿™æ¡è¯­å¥ç»è¿‡3æ¬¡IO</span><br><span class="line">å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œä¸€ç›´æ‰«æåˆ°100ï¼Œç„¶åå†æŠŠ32å–å‡ºæ¥</span><br><span class="line"></span><br><span class="line"><span class="comment">#èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>&gt;25 and <span class="built_in">id</span>&lt;36;  9æ¬¡IO</span><br><span class="line">èŒƒå›´è¶Šå¤§ï¼ŒIOæ¬¡æ•°è¶Šå¤š</span><br></pre></td></tr></table></figure><p><strong>B+tree ç´¢å¼• (mysqlé»˜è®¤çš„ç®—æ³•)</strong></p><p><img src="../image/study_img/image-20240815084835397.png" alt="image-20240815084835397"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§„å¾‹ï¼š ä¸‰è·¯Btree</span></span><br><span class="line">1ã€æ¯ä¸€ä¸ªæ•°æ®é¡µä¸Šé¢éƒ½æœ‰3ä¸ªæ•°æ®</span><br><span class="line">2ã€P1  P2  P3å«æ•°æ®é¡µ</span><br><span class="line">3ã€æ¯ä¸€é¡µä¸Šçš„å€¼ï¼Œéƒ½æ˜¯ä¸‹ä¸€è·¯æ•°æ®ä¸Šçš„æœ€å°å€¼</span><br><span class="line"></span><br><span class="line">Btreeç®—æ³•æ˜¯åˆ›å»ºç´¢å¼•ä¹‹åçš„æ’åºè§„åˆ™</span><br><span class="line">æ ¹åˆ†æ”¯ï¼š(æ ¹èŠ‚ç‚¹)   </span><br><span class="line">ä¸­é—´éƒ¨åˆ†ï¼šæèŠ‚ç‚¹</span><br><span class="line">æœ€é¡¶ä¸Šï¼šå¶å­èŠ‚ç‚¹</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç²¾ç¡®æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>=32;            3æ¬¡IO</span><br><span class="line">å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œä¸€ç›´æ‰«æåˆ°100ï¼Œç„¶åå†æŠŠ32å–å‡ºæ¥</span><br><span class="line"></span><br><span class="line"><span class="comment">#èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> * from tb1 <span class="built_in">where</span> <span class="built_in">id</span>&gt;25 and <span class="built_in">id</span>&lt;36;  5æ¬¡IO,å› ä¸ºä»–ä¸å›åˆ°æ ¹èŠ‚ç‚¹</span><br><span class="line">IOå‘ç”Ÿçš„æ¬¡æ•°è¶Šå°‘ï¼Œæ•ˆç‡è¶Šå¿«</span><br><span class="line"></span><br><span class="line"><span class="comment">#Btreeç®—æ³•å’ŒB+treeçš„åŒºåˆ«</span></span><br><span class="line">1ã€B+treeç®—æ³•ä¼˜åŒ–äº†èŒƒå›´æŸ¥è¯¢</span><br><span class="line">2ã€åœ¨ç›¸é‚»çš„å¶å­èŠ‚ç‚¹ä¸Šæ·»åŠ äº†æŒ‡é’ˆ(Qå°±æ˜¯æŒ‡é’ˆ)</span><br></pre></td></tr></table></figure><p><strong>B*tree  åŸºæœ¬ä¸Šä¸æ€ä¹ˆç”¨</strong></p><p><img src="../image/study_img/image-20240815132635119.png" alt="image-20240815132635119"></p><h2 id="ç´¢å¼•çš„åˆ†ç±»"><strong>ç´¢å¼•çš„åˆ†ç±»</strong></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¸»é”®ç´¢å¼•(èšç°‡ç´¢å¼•)ï¼šindex</span><br><span class="line">   - å¯ä»¥åˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#å”¯ä¸€é”®ç´¢å¼•ï¼šunique key</span><br><span class="line">   - å¯ä»¥åˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line">   - å¯ä»¥åˆ›å»ºå‰ç¼€ç´¢å¼•</span><br><span class="line"></span><br><span class="line">3ã€#æ™®é€šç´¢å¼•ï¼šprimary key</span><br><span class="line">   - å¯ä»¥åˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line">   - å¯ä»¥åˆ›å»ºå‰ç¼€ç´¢å¼•</span><br><span class="line">   </span><br><span class="line"><span class="comment">#æŸ¥çœ‹ä¸€å¼ è¡¨çš„ç´¢å¼•æ–¹æ³•ï¼š</span></span><br><span class="line">æŸ¥çœ‹è¡¨ç»“æ„çš„æ–¹æ³•ï¼š</span><br><span class="line">root@localhost:(none) &gt; desc mysql.user;  </span><br><span class="line">----</span><br><span class="line"> Key   <span class="comment">#keyåˆ—çš„å°±æ˜¯ç´¢å¼•</span></span><br><span class="line">----</span><br><span class="line"> PRI</span><br><span class="line"> PRI</span><br><span class="line"> </span><br><span class="line">å»ºè¡¨è¯­å¥çš„æ–¹æ³•æŸ¥çœ‹ï¼š</span><br><span class="line">root@localhost:(none) &gt; show create table mysql.user;</span><br><span class="line"> PRIMARY KEY (`Host`,`User`)</span><br><span class="line"> </span><br><span class="line">æŸ¥çœ‹ä¸€å¼ è¡¨é‡Œé¢éƒ½æœ‰å“ªäº›ç´¢å¼•</span><br><span class="line">show index from è¡¨å;</span><br><span class="line">root@localhost:(none) &gt; show index from mysql.user;</span><br><span class="line"></span><br><span class="line">Key_name  <span class="comment">#ç´¢å¼•åå­—     </span></span><br><span class="line">PRIMARY </span><br><span class="line">PRIMARY </span><br><span class="line"></span><br><span class="line">Index_type  <span class="comment">#ç´¢å¼•ç±»å‹  Bæ ‘ç®—æ³•çš„ç»Ÿç§°éƒ½å«Btree</span></span><br><span class="line">BTREE     </span><br><span class="line">BTREE    </span><br></pre></td></tr></table></figure><p><font color=red>æ³¨æ„ï¼šç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œé¿å…ç»™å¤§åˆ—åˆ›å»ºç´¢å¼•</font>&gt;<br>1.ç´¢å¼•ä¼šè¿›è¡Œæ’åºï¼Œå¤§åˆ—åˆ›å»ºç´¢å¼•é€Ÿåº¦æ…¢<br>2.ç´¢å¼•è¶Šå¤šå ç”¨ç£ç›˜ç©ºé—´è¶Šå¤§</p><p>1ã€é¦–å…ˆä½ ç»™ä¸€ä¸ªå­—æ®µæ·»åŠ ç´¢å¼•ï¼Œmysqlçš„åº•å±‚ä¼šè¿›è¡ŒBtreeç®—æ³•è¿›è¡Œæ’åºï¼Œåœ¨æ’åºçš„æ—¶å€™å°±è¦èŠ±æ—¶é—´ï¼Œ<br>2ã€ç´¢å¼•è¶Šå¤šå ç”¨ç£ç›˜ç©ºé—´ï¼Œ<br>3ã€è™½ç„¶æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œinsertã€updateã€deleteå¤„ç†æ•°æ®çš„æ—¶å€™ä¼šè€—æ—¶ï¼Œä»–ä¼šé‡æ–°æ’åº</p><h3 id="ç´¢å¼•çš„æ“ä½œ"><strong>ç´¢å¼•çš„æ“ä½œ</strong></h3><p><strong>1ã€æ™®é€šç´¢å¼•  index</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨ä¼ä¸šä¸­ï¼Œä¸ç¡®å®šè¡¨é‡Œé¢æœ‰å¤šå°‘æ•°æ®ï¼Œæ•¢ä¸æ•¢ç”¨select *ï¼Ÿ</span></span><br><span class="line"><span class="comment">#å…ˆç»Ÿè®¡ä¸€ä¸‹è¡Œæ•°</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> count(*) from world.city;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     4079 |</span><br><span class="line">+----------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; desc stu5;</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)     | NO   |     | 0       |       |</span><br><span class="line">| name  | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">1ã€æ·»åŠ æ™®é€šç´¢å¼•</span><br><span class="line"><span class="comment">#ç»™nameå­—æ®µæ·»åŠ æ™®é€šç´¢å¼•ï¼ˆé‡Œé¢çš„å€¼å¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥é‡å¤ï¼Œå°±æ˜¯ä¸ºäº†æŸ¥è¯¢çš„é€Ÿåº¦å¿«ï¼‰</span></span><br><span class="line">alter table è¡¨å add index ç´¢å¼•å(å­—æ®µ);</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; alter table stu5 add index idx_name(name);</span><br><span class="line">root@localhost:student &gt;  desc stu5;</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)     | NO   |     | 0       |       |</span><br><span class="line">| name  | varchar(10) | YES  | MUL | NULL    |       |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">root@localhost:student &gt; show index from stu5;</span><br><span class="line"></span><br><span class="line">2ã€åˆ é™¤æ™®é€šç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table stu5 drop index idx_name;</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; show index from stu5;   <span class="comment">#æŸ¥çœ‹è¡¨é‡Œé¢æœ‰å“ªäº›ç´¢å¼•ï¼Œå‘ç°æ˜¯ç©ºçš„ï¼Œåˆ é™¤æˆåŠŸ</span></span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç´¢å¼•æ²¡æœ‰æ”¹ åªèƒ½å¢åˆ æŸ¥</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">æœ‰ç´¢å¼•å’Œæ— ç´¢å¼•çš„åŒºåˆ«</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹è¡¨é‡Œé¢çš„å…¨éƒ¨ç´¢å¼•</span></span><br><span class="line">show index from world.city;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¡¨é‡Œé¢4079ï¼Œè¯»çš„æ—¶å€™è¯»äº†4188è¡Œ</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> *  from world.city;</span><br><span class="line">4079 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line">åˆ†æsqlè¯­å¥</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> *  from world.city;</span><br><span class="line">rows   <span class="comment">#è¡Œæ•°</span></span><br><span class="line">----</span><br><span class="line">4188</span><br><span class="line">ç²¾ç¡®æŸ¥è¯¢ä¸€ä¸ªåŸå¸‚ï¼Œè¿˜æ˜¯4188è¡Œ</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> *  from world.city <span class="built_in">where</span> name=<span class="string">&#x27;Odessa&#x27;</span>;</span><br><span class="line">rows</span><br><span class="line">----</span><br><span class="line">4188</span><br><span class="line">åŸå› ï¼šåœ¨æ²¡æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå…¨è¡¨æ‰«æäº†</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æœ‰ç´¢å¼•çš„å­—æ®µåï¼Œå¹¶è¿›è¡Œåˆ†æ</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population=92020;</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population=92020;</span><br><span class="line">rows   <span class="comment">#è¡Œæ•°åªè¦1è¡Œ</span></span><br><span class="line">----</span><br><span class="line">   1</span><br><span class="line">åœ¨æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ï¼ŒåªæŸ¥å‡ºäº†1è¡Œï¼Œå› ä¸ºæ·»åŠ ç´¢å¼•ä¹‹åï¼Œå·²ç»æ’å¥½åºäº†</span><br></pre></td></tr></table></figure><p><strong>2ã€å”¯ä¸€é”®ç´¢å¼•  unique key</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ä¸»é”®ç´¢å¼•çš„é€Ÿåº¦ä¸€å®šæ˜¯æœ€å¿«çš„ï¼Œä½†æ˜¯ä¸€å¼ è¡¨é‡Œé¢åªæœ‰ä¸€ä¸ªä¸»é”®ï¼Œä¼˜å…ˆè€ƒè™‘å”¯ä¸€é”®ç´¢å¼•ï¼Œä»–çš„é€Ÿåº¦ä»…æ¬¡äºä¸»é”®ç´¢å¼•</span><br><span class="line">åˆ›å»ºå”¯ä¸€é”®ç´¢å¼•çš„å‰æä¸èƒ½æœ‰é‡å¤çš„å€¼</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ¤æ–­ä¸€ä¸ªåˆ—èƒ½ä¸èƒ½åˆ›å»ºå”¯ä¸€é”®ç´¢å¼•çš„æ–¹æ³•ï¼š</span></span><br><span class="line">1ã€å…ˆç»Ÿè®¡ä¸€ä¸‹æœ‰å¤šå°‘è¡Œ</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> count(population) from world.city;</span><br><span class="line">+-------------------+</span><br><span class="line">| count(population) |</span><br><span class="line">+-------------------+</span><br><span class="line">|              4079 |</span><br><span class="line">+-------------------+</span><br><span class="line">2ã€å†å»ç»Ÿè®¡ä¸€ä¸‹å»é‡åçš„è¡Œæ•°</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> count(distinct(population)) from world.city;</span><br><span class="line">+-----------------------------+</span><br><span class="line">| count(distinct(population)) |</span><br><span class="line">+-----------------------------+</span><br><span class="line">|                        3897 |</span><br><span class="line">+-----------------------------+</span><br><span class="line">3ã€å¯¹æ¯”æ•°æ®ï¼Œå‘ç°æ•°æ®å˜å°‘äº†ï¼Œè¯´æ˜æœ‰é‡å¤çš„å€¼ï¼Œä¸èƒ½ä½¿ç”¨å”¯ä¸€é”®ç´¢å¼•ï¼Œåªèƒ½åˆ›å»ºæ™®é€šç´¢å¼•</span><br><span class="line">4ã€åˆ›å»ºæ™®é€šç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table world.city add index idx_population(population);</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºå”¯ä¸€é”®ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; alter table stu3 add unique key uni_phone(phone);</span><br><span class="line">æŸ¥çœ‹</span><br><span class="line">root@localhost:student &gt; show index from stu3;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤å”¯ä¸€é”®ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; alter table stu3 drop index uni_phone;</span><br></pre></td></tr></table></figure><p><strong>3ã€ä¸»é”®ç´¢å¼•(èšç°‡ç´¢å¼•)ï¼šprimary key</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å»ºè¡¨æ—¶åˆ›å»ºä¸»é”®ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; create table stu4(<span class="built_in">id</span> int primary key auto_increment,name varchar(10));</span><br><span class="line">root@localhost:student &gt; create table stu4(<span class="built_in">id</span> int auto_increment,name varchar(10),primary key(<span class="built_in">id</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ ä¸»é”®ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; create table stu5(<span class="built_in">id</span> int,name varchar(10));</span><br><span class="line">root@localhost:student &gt; desc stu5;</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)     | YES  |     | NULL    |       |</span><br><span class="line">| name  | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">è¿™ä¸ªè¡¨åˆ›å»ºçš„æ—¶å€™æ²¡æœ‰åŠ ä¸»é”®ï¼Œéœ€è¦æ·»åŠ ä¸»é”®</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; alter table stu5 add primary key(<span class="built_in">id</span>);</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; desc stu5;   <span class="comment">#æŸ¥çœ‹åˆ°ä¸»é”®ç´¢å¼•å·²æ·»åŠ </span></span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>    | int(11)     | NO   | PRI | 0       |       |</span><br><span class="line">| name  | varchar(10) | YES  |     | NULL    |       |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤ä¸»é”®ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; alter table stu5 drop primary key;</span><br><span class="line">å¦‚æœç´¢å¼•é‡Œé¢æœ‰æ•°æ® æ˜¯åˆ ä¸æ‰çš„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç´¢å¼•æœ‰ä¸“é—¨çš„æ·»åŠ æ–¹å¼ï¼Œä¸èƒ½ç”¨æ”¹å­—æ®µçš„æ–¹å¼å»ä¿®æ”¹</span></span><br></pre></td></tr></table></figure><ul><li>å‰ç¼€ç´¢å¼•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ä¸ºä»€ä¹ˆæœ‰å‰ç¼€ç´¢å¼•ï¼šè§£å†³ç»™å¤§åˆ—åˆ›å»ºçš„ç´¢å¼•æ’åºæ—¶ï¼Œè§£å†³æ’åºé€Ÿåº¦æ…¢çš„é—®é¢˜</span><br><span class="line"></span><br><span class="line">1ã€#æ™®é€šç´¢å¼•åˆ›å»ºä¸€ä¸ªå‰ç¼€ç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table stu3 add index idex_phone(phone(3));</span><br><span class="line">æŒ‡å®šè¿™ä¸ªå­—æ®µæ’åºæ—¶ï¼Œä¼˜å…ˆæŒ‰å‰3ä¸ªå­—ç¬¦æ’åºï¼Œå°±ä¸æ˜¯æŒ‰å®Œæ•´å­—ç¬¦æ’åºäº†</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å»ºè¡¨è¯­å¥ï¼š å¯ä»¥çœ‹åˆ°ä»–æ˜¯å‰ç¼€ç´¢å¼•ï¼ŒæŒ‰3ä¸ªå­—ç¬¦æ’åº</span></span><br><span class="line">root@localhost:student &gt; show create table stu3;</span><br><span class="line">  KEY `idex_phone` (`phone`(3))</span><br><span class="line">root@localhost:student &gt; show index from  stu3;</span><br><span class="line">Sub_part </span><br><span class="line">---------</span><br><span class="line">       3 </span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">2ã€#å”¯ä¸€ç´¢å¼•åˆ›å»ºå‰ç¼€ç´¢å¼•  å‰ææ¡ä»¶ï¼ŒæŒ‡å®šçš„å‰å‡ ä¸ªå­—ç¬¦ä¸èƒ½é‡å¤</span><br><span class="line">å…ˆæŠŠä¸Šæ¬¡åˆ›å»ºçš„å‰ç¼€ç´¢å¼•åˆ é™¤</span><br><span class="line">root@localhost:student &gt; alter table stu3 drop index idex_phone;</span><br><span class="line">root@localhost:student &gt; alter table stu3 add unique key uni_phone(phone(3));  <span class="comment">#ä¼šæŠ¥é”™</span></span><br><span class="line">ERROR 1062 (23000): Duplicate entry <span class="string">&#x27;123&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;uni_phone&#x27;</span></span><br><span class="line">å”¯ä¸€ç´¢å¼•å‰ç¼€ï¼šæŒ‰å‰3ä¸ªå­—ç¬¦æ’åºï¼Œä½†æ˜¯å‰3ä¸ªå­—ç¬¦ä¸èƒ½ä¸€æ ·</span><br><span class="line"></span><br><span class="line">æŒ‰æœ€åä¸€ä¸ªå­—ç¬¦æ’åº</span><br><span class="line">root@localhost:student &gt; alter table stu3 add unique key uni_phone(phone(11));</span><br><span class="line">root@localhost:student &gt; show index from stu3;</span><br><span class="line">Sub_part </span><br><span class="line">----------</span><br><span class="line">NULL   <span class="comment">#æ‰‹æœºå·çš„æ€»é•¿åº¦å°±æ˜¯11ï¼Œç›¸å½“äºæ²¡å†™è¿™ä¸ªå‰ç¼€ï¼Œé™¤éå‰ç¼€ä¸ä¸€æ ·ï¼Œä¸é‡å¤</span></span><br><span class="line"><span class="comment"># ä¸€èˆ¬æ‰‹æœºå·çš„åˆ—ï¼Œå¾ˆå°‘åˆ›å»ºå”¯ä¸€ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#ä¸»é”®ç´¢å¼•åˆ›å»ºå‰ç¼€ç´¢å¼•  <span class="comment">#æ— æ³•åˆ›å»ºï¼Œä¸»é”®ç´¢å¼•ä¸æ”¯æŒå‰ç¼€</span></span><br><span class="line">alter table stu2 add primary key(<span class="built_in">id</span>(3));</span><br></pre></td></tr></table></figure><ul><li>è”åˆç´¢å¼•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">ä¸€å¼ è¡¨é‡Œé¢å“ªäº›å­—æ®µéœ€è¦åˆ›å»ºç´¢å¼•ï¼Œå–å†³äºï¼šç”¨æˆ·éœ€æ±‚</span><br><span class="line">ä¸€ä¸ªæ•°æ®ï¼Œç”¨æˆ·ç»å¸¸æŸ¥ï¼Œä¸€å®šæ˜¯å¯¹è¿™ä¸ªå­—æ®µéœ€æ±‚é‡æ¯”è¾ƒå¤§ï¼Œå°±è¦æé«˜è¿™ä¸ªå­—æ®µæŸ¥è¯¢çš„æ•ˆç‡</span><br><span class="line"></span><br><span class="line">å½“ä¸€å¼ è¡¨ä¸­ï¼Œéœ€è¦åˆ›å»ºç´¢å¼•çš„å­—æ®µæ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç”¨è”åˆç´¢å¼•</span><br><span class="line"></span><br><span class="line">1ã€#åˆ›å»ºæ™®é€šç´¢å¼•çš„è”åˆç´¢å¼•</span><br><span class="line">å¤šä¸ªå­—æ®µå»ºç«‹ä¸€ä¸ªç´¢å¼•</span><br><span class="line"><span class="comment">#åŸåˆ™ï¼šæŠŠæœ€å¸¸ç”¨æ¥åšä¸ºæ¡ä»¶æŸ¥è¯¢çš„åˆ—æ”¾åœ¨æœ€å‰é¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºç›¸äº²è¡¨</span></span><br><span class="line">create table xiangqin(<span class="built_in">id</span> int comment <span class="string">&#x27;åºå·&#x27;</span>,</span><br><span class="line">name varchar(10) comment <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">gender enum(<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>) comment <span class="string">&#x27;æ€§åˆ«&#x27;</span>,</span><br><span class="line">high int comment <span class="string">&#x27;èº«é«˜&#x27;</span>,</span><br><span class="line">weight int comment <span class="string">&#x27;ä½“é‡&#x27;</span>,</span><br><span class="line">body varchar(10) comment <span class="string">&#x27;èº«æ&#x27;</span>,</span><br><span class="line">salary int) comment <span class="string">&#x27;æ”¶å…¥&#x27;</span>;</span><br><span class="line"></span><br><span class="line">1)ã€#å‡è®¾ç”¨æˆ·æœ€å…³æ³¨çš„æ˜¯ï¼š</span><br><span class="line">æ€§åˆ«ï¼šgender</span><br><span class="line">æ”¶å…¥ï¼šsalary</span><br><span class="line">èº«æï¼šbody</span><br><span class="line"></span><br><span class="line">2)ã€#æ ¹æ®ç”¨æˆ·å–œå¥½åˆ›å»ºè”åˆç´¢å¼•åˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table xiangqin add index idx_all(gender,salary,body);</span><br><span class="line">å¦‚æœåˆ›å»ºçš„æ—¶å€™ï¼ŒæŠŠbodyæ”¾ç¬¬ä¸€ä¸ªï¼Œç”¨æˆ·æŸ¥è¯¢çš„æ—¶å€™å°±ä¸èµ°ç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•ç­‰äºæ²¡å»º</span><br><span class="line">æŸ¥çœ‹ï¼š</span><br><span class="line">root@localhost:student &gt; show index from xiangqin;</span><br><span class="line"></span><br><span class="line">åˆ›å»ºè”åˆç´¢å¼•+å‰ç¼€ç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table xiangqin add index idex_all(gender,salary(4),body);</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; desc xiangqin;</span><br><span class="line">| gender | enum(<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>) | YES  | MUL | NULL    |  <span class="comment">#åªçœ‹åˆ°æ’åºçš„ç¬¬ä¸€ä¸ªæœ‰ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; show index from xiangqin;  <span class="comment">#å¯ä»¥çœ‹å…¨</span></span><br><span class="line"></span><br><span class="line">ä¾‹ï¼š</span><br><span class="line">å½“ï¼ša.å¥³ç”Ÿ and b.èº«é«˜ and c.ä½“é‡ and d.èº«æå¥½</span><br><span class="line">index(a,b,c)</span><br><span class="line">ç‰¹ç‚¹ï¼šå‰ç¼€ç”Ÿæ•ˆç‰¹æ€§</span><br><span class="line">a,ab,ac,abc,abcd å¯ä»¥èµ°ç´¢å¼•æˆ–éƒ¨åˆ†èµ°ç´¢å¼•</span><br><span class="line">b bc bcd <span class="built_in">cd</span> c d ba ... ä¸èµ°ç´¢å¼•  åªè¦aä¸åœ¨å‰é¢ï¼Œå°±ä¸èµ°ç´¢å¼•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#å”¯ä¸€ç´¢å¼•åˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line">å…ˆåˆ é™¤ä¸Šæ¬¡åˆ›å»ºçš„ç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table xiangqin drop index idx_all;</span><br><span class="line">å­—æ®µçš„æ•°æ®ä¸èƒ½é‡å¤</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; alter table xiangqin add unique key uni_all(gender,salary,body);</span><br><span class="line"></span><br><span class="line">3ã€#ä¸»é”®ç´¢å¼•åˆ›å»ºè”åˆç´¢å¼•</span><br><span class="line">å…ˆåˆ é™¤ä¸Šæ¬¡åˆ›å»ºçš„ç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table xiangqin drop index uni_all;</span><br><span class="line"></span><br><span class="line">åˆ›å»ºä¸»é”®ç´¢å¼•</span><br><span class="line">root@localhost:student &gt; alter table xiangqin add primary key(gender,salary,body);</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; desc xiangqing     <span class="comment">#3ä¸ªéƒ½æ˜¾ç¤º</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åˆ†ææ…¢æŸ¥è¯¢è¯­å¥ï¼Œéœ€è¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä»–ä¼šæŠŠæ…¢çš„sqlè¯­å¥è®°å½•è¿›å»</span><br><span class="line"></span><br><span class="line">mysqlæ‰§è¡Œæ…¢ï¼Œå¯èƒ½å’Œæ‰«ææœ‰å…³</span><br></pre></td></tr></table></figure><p><strong>Mysqlæ•°æ®æ‰«æ</strong></p><p>1ã€å…¨è¡¨æ‰«æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°å…¨è¡¨æ‰«æ</span></span><br><span class="line">æƒ…å†µ1ã€<span class="keyword">select</span> * from tb1;</span><br><span class="line">æƒ…å†µ2ã€<span class="keyword">select</span> æŸ¥è¯¢æ•°æ®æ—¶ï¼Œ<span class="built_in">where</span>æ¡ä»¶æ¥çš„å­—æ®µï¼Œæ²¡æœ‰åˆ›å»ºç´¢å¼•   (ä¸èµ°ç´¢å¼•ï¼Œå°±æ˜¯å…¨è¡¨æ‰«æ)</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys | key  | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL | 4188 |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯ALL æ‰«æçš„è¡Œæ•°æ˜¯4188è¡Œ</span></span><br></pre></td></tr></table></figure><p>2ã€ç´¢å¼•æ‰«æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç´¢å¼•æ‰«æå°±æ˜¯èµ°ç´¢å¼•æŸ¥è¯¢(èµ°ç´¢å¼•ï¼Œä¹Ÿæœ‰å¿«æ…¢ä¹‹åˆ†ï¼Œä¸æ˜¯èµ°ç´¢å¼•äº†å°±ä¸€å®šå¿«)</span></span><br><span class="line"></span><br><span class="line">å¸¸è§çš„èµ°ç´¢å¼•æ‰«æç±»å‹:</span><br><span class="line">1ï¼‰index</span><br><span class="line">2ï¼‰range</span><br><span class="line">3ï¼‰ref</span><br><span class="line">4ï¼‰eq_ref</span><br><span class="line">5ï¼‰constã€system</span><br><span class="line">6ï¼‰null</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€# indexï¼šå…¨ç´¢å¼•æ‰«æ(æœ€æ…¢ï¼Œå’Œå…¨è¡¨æ‰«ææ²¡ä»€ä¹ˆåŒºåˆ«)</span><br><span class="line">root@localhost:student &gt; show index from world.city;</span><br><span class="line">å®ƒåšäº†æ™®é€šç´¢å¼•çš„ï¼ŒåªæŸ¥countrycodeè¿™ä¸€åˆ—</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> countrycode from world.city;</span><br><span class="line"><span class="comment">#explainå°±æ˜¯åˆ†æsqlè¯­å¥</span></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> countrycode from world.city;</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys | key         | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | index | NULL          | CountryCode | 3       | NULL | 4188 |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯index æ‰«æçš„è¡Œæ•°æ˜¯4188è¡Œ</span></span><br><span class="line"></span><br><span class="line">2ã€# rangeï¼šèŒƒå›´æŸ¥è¯¢å¹¶åˆ›å»ºäº†ç´¢å¼•    åªè¦èƒ½è¾¾åˆ°rangçº§åˆ«ï¼Œå°±æ˜¯OKçš„  å¦‚æœæƒ³æŠŠrangeä¼˜åŒ–åˆ°systemçš„çº§åˆ«ï¼Œæ˜¯ä¸èƒ½å®ç°çš„ï¼Œsystemçº§åˆ«åªèƒ½ä¸»é”®ç´¢å¼•èƒ½åˆ°åº•</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population&lt;1000;</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population&lt;1000;</span><br><span class="line">+----+-------------+-------+-------+----------------+----------------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys  | key            | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+-------+----------------+----------------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | range | idx_population | idx_population | 4       | NULL |   11 |</span><br><span class="line">+----+-------------+-------+-------+----------------+----------------+---------+------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯range æ‰«æçš„è¡Œæ•°æ˜¯11è¡Œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸¤ä¸ªæ•ˆç‡ä¸€æ ·</span></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> or countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode <span class="keyword">in</span> (<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys | key         | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | range | CountryCode   | CountryCode | 3       | NULL |  637 |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯range æ‰«æçš„è¡Œæ•°æ˜¯637è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼˜åŒ–åˆ°refçº§åˆ«</span></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> union all <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line">+----+--------------+------------+------+---------------+-------------+---------+-------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type  | table      | <span class="built_in">type</span> | possible_keys | key         | key_len | ref   | rows |</span><br><span class="line">+----+--------------+------------+------+---------------+-------------+---------+-------+------+</span><br><span class="line">|  1 | PRIMARY      | city       | ref  | CountryCode   | CountryCode | 3       | const |  363 |</span><br><span class="line">|  2 | UNION        | city       | ref  | CountryCode   | CountryCode | 3       | const |  274 |</span><br><span class="line">| NULL | UNION RESULT | &lt;union1,2&gt; | ALL  | NULL          | NULL        | NULL    | NULL  | NULL</span><br><span class="line">+----+--------------+------------+------+---------------+-------------+---------+-------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯ref æ‰«æçš„è¡Œæ•°æ˜¯åˆ†å¼€çš„</span></span><br><span class="line"></span><br><span class="line">3ã€# refï¼šè”åˆæŸ¥è¯¢ã€æ™®é€šç´¢å¼•çš„ç²¾ç¡®æŸ¥è¯¢</span><br><span class="line">è”åˆæŸ¥è¯¢</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span> union all <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"></span><br><span class="line">æ™®é€šç´¢å¼•çš„ç²¾ç¡®æŸ¥è¯¢æ‰èƒ½åˆ°åº•refçº§åˆ«</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode=<span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line">+----+-------------+-------+------+---------------+-------------+---------+-------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys | key         | key_len | ref   | rows |</span><br><span class="line">+----+-------------+-------+------+---------------+-------------+---------+-------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | ref  | CountryCode   | CountryCode | 3       | const |  363 |</span><br><span class="line">+----+-------------+-------+------+---------------+-------------+---------+-------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯ref æ‰«æçš„è¡Œæ•°æ˜¯363è¡Œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€# eq_refï¼šåªæœ‰åœ¨è¿è¡¨æŸ¥è¯¢ä½¿ç”¨ <span class="built_in">join</span> on,ä¸”å°è¡¨åœ¨å‰ï¼Œå¤§è¡¨åœ¨å</span><br><span class="line"><span class="built_in">join</span> B </span><br><span class="line">on A.sid=B.sid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€# constã€systemï¼šä¸»é”®æŸ¥è¯¢çš„ç²¾ç¡®æŸ¥è¯¢</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> <span class="built_in">id</span>=10;</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys | key     | key_len | ref   | rows |</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | const | PRIMARY       | PRIMARY | 4       | const |    1 |</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯const æ‰«æçš„è¡Œæ•°æ˜¯1è¡Œ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€# nullï¼šè®©mysqlå•¥ä¹Ÿä¸å¹² æ€§èƒ½æ‰æ˜¯æœ€é«˜çš„ï¼Œè¿™ä¸ªåŸºæœ¬ä¸Šä¸ä¼šå‡ºç°çš„</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population&gt;10000000000;   <span class="comment">#æŒ‰Btreeç®—æ³•æ¥çœ‹ï¼Œå·²ç»ä¸åœ¨æ’åºèŒƒå›´äº†ï¼Œå·²ç»è¶…è¿‡è®°å½•äº†</span></span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys | key  | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | NULL  | NULL | NULL          | NULL | NULL    | NULL | NULL |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line"><span class="comment">#å¯ä»¥çœ‹åˆ°typeç±»å‹æ˜¯NULL æ‰«æçš„è¡Œæ•°æ˜¯NULLè¡Œ</span></span><br><span class="line"></span><br><span class="line">éè¦ä¼˜åŒ–åˆ°systemçº§åˆ«çš„ åªèƒ½åˆ›å»ºä¸»é”®ç´¢å¼•ï¼Œä½†æ˜¯ä¸»é”®ç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ª æ‰€ä»¥ä¸èƒ½ä¼˜åŒ–</span><br><span class="line">ä¸æ˜¯åˆ›å»ºäº†ç´¢å¼•ï¼Œå°±èµ°ç´¢å¼•æ‰«æ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_lençš„åˆ—: è¶Šå°è¶Šå¥½ï¼Œå¯ä»¥æ‹¿å‰ç¼€ç´¢å¼•å»æ§åˆ¶</span><br><span class="line">rowsçš„åˆ—: è¶Šå°è¶Šå¥½</span><br></pre></td></tr></table></figure><p><strong>ç´¢å¼•çš„åˆ›å»ºè§„èŒƒ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿™ä¸ªå¯èƒ½ç”¨ä¸åˆ°ï¼Œå› ä¸ºä¸€èˆ¬ä¼ä¸šé‡Œé¢çš„è¡¨æ—©å°±å»ºå¥½äº†</span></span><br><span class="line">ä¸ºäº†ä½¿ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡æ›´é«˜ï¼Œåœ¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œå¿…é¡»è€ƒè™‘åœ¨å“ªäº›å­—æ®µä¸Šåˆ›å»ºç´¢å¼•å’Œåˆ›å»ºä»€ä¹ˆç±»å‹çš„ç´¢å¼•ã€‚</span><br><span class="line">1ã€æ¯å¼ è¡¨å¿…é¡»æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•</span><br><span class="line"></span><br><span class="line">2ã€ä¸»é”®ç´¢å¼•åªèƒ½åˆ›å»ºä¸€ä¸ªï¼Œä½†è¦å¯¹æŸä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œä¼˜å…ˆè€ƒè™‘èƒ½åˆ›å»ºå”¯ä¸€ç´¢å¼•å°±åˆ›å»ºå”¯ä¸€ç´¢å¼•</span><br><span class="line"><span class="comment">#éœ€è¦å…ˆåˆ¤æ–­æ˜¯å¦èƒ½åˆ›å»ºå”¯ä¸€ç´¢å¼•</span></span><br><span class="line">root@localhost:zls 10:12:29&gt; <span class="keyword">select</span> count(population) from world.city;</span><br><span class="line">root@localhost:zls 10:12:43&gt; <span class="keyword">select</span> count(distinct(population)) from world.city;</span><br><span class="line"></span><br><span class="line">3ã€å¦‚æœé‡å¤å€¼æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œè”åˆç´¢æ˜¯ä¼˜å…ˆçš„ï¼Œå¯ä»¥ç”¨æ™®é€šç´¢å¼•çš„è”åˆç´¢å¼•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€ä¸ºç»å¸¸éœ€è¦æ’åºã€åˆ†ç»„å’Œè”åˆæ“ä½œçš„å­—æ®µå»ºç«‹ç´¢å¼•</span><br><span class="line">ä¾‹å¦‚:</span><br><span class="line">ç»å¸¸éœ€è¦ORDER BYã€GROUP BYã€DISTINCTå’ŒUNIONç­‰æ“ä½œçš„å­—æ®µï¼Œæ’åºæ“ä½œä¼šæµªè´¹å¾ˆå¤šæ—¶é—´ã€‚</span><br><span class="line">å¦‚æœä¸ºå…¶å»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æœ‰æ•ˆåœ°é¿å…æ’åºæ“ä½œ</span><br><span class="line"></span><br><span class="line">5ã€ä¸ºå¸¸ä½œä¸ºæŸ¥è¯¢æ¡ä»¶çš„å­—æ®µå»ºç«‹ç´¢å¼•</span><br><span class="line">å¦‚æœæŸä¸ªå­—æ®µç»å¸¸ç”¨æ¥åšæŸ¥è¯¢æ¡ä»¶ï¼Œé‚£ä¹ˆè¯¥å­—æ®µçš„æŸ¥è¯¢é€Ÿåº¦ä¼šå½±å“æ•´ä¸ªè¡¨çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</span><br><span class="line">å› æ­¤ï¼Œä¸ºè¿™æ ·çš„å­—æ®µå»ºç«‹ç´¢å¼•ï¼Œå¯ä»¥æé«˜æ•´ä¸ªè¡¨çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šå¦‚æœç»å¸¸ä½œä¸ºæ¡ä»¶çš„åˆ—ï¼Œé‡å¤å€¼ç‰¹åˆ«å¤šï¼Œå¯ä»¥å»ºç«‹è”åˆç´¢å¼•</span><br><span class="line"></span><br><span class="line">6ã€å°½é‡ä½¿ç”¨å‰ç¼€æ¥ç´¢å¼•ï¼Œåˆ›å»ºçš„ç´¢å¼•èƒ½åŠ å‰ç¼€çš„åŠ å‰ç¼€ï¼Œå”¯ä¸€ç´¢å¼•ä¹Ÿå¯ä»¥åŠ </span><br></pre></td></tr></table></figure><ul><li>é™åˆ¶ç´¢å¼•çš„æ•°ç›®<br>ç´¢å¼•çš„æ•°ç›®ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚æ¯ä¸ªç´¢å¼•éƒ½éœ€è¦å ç”¨ç£ç›˜ç©ºé—´ï¼Œç´¢å¼•è¶Šå¤šï¼Œéœ€è¦çš„ç£ç›˜ç©ºé—´å°±è¶Šå¤§ã€‚<br>ä¿®æ”¹è¡¨æ—¶ï¼Œå¯¹ç´¢å¼•çš„é‡æ„å’Œæ›´æ–°å¾ˆéº»çƒ¦ã€‚è¶Šå¤šçš„ç´¢å¼•ï¼Œä¼šä½¿æ›´æ–°è¡¨å˜å¾—å¾ˆæµªè´¹æ—¶é—´ã€‚</li><li>åˆ é™¤ä¸å†ä½¿ç”¨æˆ–è€…å¾ˆå°‘ä½¿ç”¨çš„ç´¢å¼•<br>ç”¨æˆ·çš„å–œå¥½ä¼šå‘ç”Ÿå˜åŒ–çš„ï¼Œè¦ç»å¸¸è°ƒç”¨å“ªäº›å­—æ®µç”¨æˆ·æŸ¥è¯¢å‡å°‘ï¼ŒæŠŠè¡¨ä¸­çš„æ•°æ®è¢«å¤§é‡æ›´æ–°ï¼Œæˆ–è€…æ•°æ®çš„ä½¿ç”¨æ–¹å¼è¢«æ”¹å˜åï¼ŒåŸæœ‰çš„ä¸€äº›ç´¢å¼•å¯èƒ½ä¸å†éœ€è¦ã€‚æ•°æ®åº“ç®¡ç†å‘˜åº”å½“å®šæœŸæ‰¾å‡ºè¿™äº›ç´¢å¼•ï¼Œå°†å®ƒä»¬åˆ é™¤ï¼Œä»è€Œå‡å°‘ç´¢å¼•å¯¹æ›´æ–°æ“ä½œçš„å½±å“ã€‚</li></ul><p><strong>æ€ä¹ˆåˆ¤æ–­ä¸èµ°ç´¢å¼•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸æ˜¯åˆ›å»ºäº†ç´¢å¼•ï¼Œå°±ä¸€å®šèµ°ç´¢å¼•</span></span><br><span class="line">ä½¿ç”¨explainåˆ¤æ–­æ˜¯å¦èµ°ç´¢å¼•</span><br><span class="line"></span><br><span class="line">1ã€#æ²¡åˆ›å»ºç´¢å¼•</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#å½“ä½ æŸ¥çš„æ•°æ®çš„ç»“æœé›†è¶…è¿‡æ€»æ•°æ®25%  ä½ çš„æ•°æ®æœ‰100æ¡ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„æ—¶å€™æœ‰125æ¡</span><br><span class="line">ç¤ºä¾‹</span><br><span class="line">å‡è®¾ä¸€ä¸ªæ•°æ®åº“è¡¨studentsï¼ŒåŒ…å«100æ¡è®°å½•ã€‚æ‰§è¡Œäº†ä¸€ä¸ªæŸ¥è¯¢æ¥æŸ¥æ‰¾å¹´é¾„å¤§äº18å²çš„å­¦ç”Ÿï¼Œå¹¶å¾—åˆ°äº†30æ¡è®°å½•ä½œä¸ºç»“æœé›†ã€‚</span><br><span class="line">æ€»æ•°æ®é‡ï¼š100æ¡è®°å½•</span><br><span class="line">ç»“æœé›†å¤§å°ï¼š30æ¡è®°å½•</span><br><span class="line">æ¯”ä¾‹è®¡ç®—ï¼š(30 / 100) * 100% = 30%</span><br><span class="line">ç»“è®ºï¼šç»“æœé›†è¶…è¿‡äº†æ€»æ•°æ®çš„25%ï¼ˆå› ä¸º30% &gt; 25%ï¼‰</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> Population&gt;1000;</span><br><span class="line">4068 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)  <span class="comment">#å¾—åˆ°çš„ç»“æœé›†4068</span></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> Population&gt;1000;</span><br><span class="line">+----+-------------+-------+------+----------------+------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys  | key  | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+------+----------------+------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | ALL  | idx_population | NULL | NULL    | NULL | 4188 |</span><br><span class="line">+----+-------------+-------+------+----------------+------+---------+------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼˜åŒ–æ–¹æ¡ˆï¼š ä½¿ç”¨limitï¼Œåˆ†é¡µæŸ¥è¯¢</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population&gt;1000 <span class="built_in">limit</span> 10;</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> population&gt;1000 <span class="built_in">limit</span> 10;</span><br><span class="line">+----+-------------+-------+-------+----------------+----------------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys  | key            | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+-------+----------------+----------------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | range | idx_population | idx_population | 4       | NULL | 4067 |</span><br><span class="line">+----+-------------+-------+-------+----------------+----------------+---------+------+------+</span><br><span class="line"></span><br><span class="line">3ã€#ä½¿ç”¨å­—æ®µåšè®¡ç®—  <span class="built_in">id</span>+1=10è¿™æ ·ä½¿ç”¨å­—æ®µåšè®¡ç®—ï¼Œä¸èµ°ç´¢å¼•  <span class="built_in">id</span>=10-1 ä¼šèµ°ç´¢å¼•</span><br><span class="line"><span class="comment">#id=10-1 ä¼šèµ°ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> <span class="built_in">id</span>=10-1;</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> <span class="built_in">id</span>=10-1;</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys | key     | key_len | ref   | rows |</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | const | PRIMARY       | PRIMARY | 4       | const |    1 |</span><br><span class="line">+----+-------------+-------+-------+---------------+---------+---------+-------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#id+1=10 ä¸èµ°ç´¢å¼•</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from world.city <span class="built_in">where</span> <span class="built_in">id</span>+1=10;</span><br><span class="line">+----+-----------+-------------+---------------+------------+</span><br><span class="line">| ID | Name      | CountryCode | District      | Population |</span><br><span class="line">+----+-----------+-------------+---------------+------------+</span><br><span class="line">|  9 | Eindhoven | NLD         | Noord-Brabant |     201843 |</span><br><span class="line">+----+-----------+-------------+---------------+------------+</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> <span class="built_in">id</span>+1=10;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys | key  | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL | 4188 |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line"></span><br><span class="line">4ã€#éšå¼è½¬æ¢å¯¼è‡´ä¸èµ°ç´¢å¼•</span><br><span class="line">phoneå­—æ®µæ˜¯charç±»å‹çš„ æ’å…¥çš„æ—¶å€™æ²¡æœ‰åŠ å¼•å·</span><br><span class="line">1ï¼‰ã€å…ˆæŸ¥çœ‹è¿™ä¸ªè¡¨ï¼Œphoneæœ‰ç´¢å¼•ï¼Œæ•°æ®ç±»å‹æ˜¯char(11) </span><br><span class="line">root@localhost:student &gt; desc stu3;</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line">| Field     | Type                | Null | Key | Default           | Extra          |</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line">| <span class="built_in">id</span>        | int(11)             | NO   | PRI | NULL              | auto_increment |</span><br><span class="line">| name      | varchar(20)         | NO   |     | NULL              |                |</span><br><span class="line">| age       | tinyint(4) unsigned | NO   |     | NULL              |                |</span><br><span class="line">| gender    | enum(<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;f&#x27;</span>)       | NO   |     | m                 |                |</span><br><span class="line">| phone     | char(11)            | NO   | PRI | NULL              |                |</span><br><span class="line">| come_time | datetime            | NO   |     | CURRENT_TIMESTAMP |                |</span><br><span class="line">| status    | enum(<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)       | NO   |     | 0                 |                |</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line">2ï¼‰ã€æ’å…¥ä¸€æ¡æ•°æ®</span><br><span class="line">root@localhost:student &gt; insert into stu3 values(8,<span class="string">&#x27;wang6u&#x27;</span>,22,<span class="string">&#x27;m&#x27;</span>,12121212127,now(),<span class="string">&#x27;0&#x27;</span>);   <span class="comment">#phoneæ’å…¥çš„æ—¶å€™æ²¡æœ‰åŠ å¼•å·</span></span><br><span class="line">3ï¼‰ã€æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿæ˜¯æ²¡æœ‰åŠ å¼•å·ï¼Œæ²¡æœ‰èµ°ç´¢å¼•</span><br><span class="line">root@localhost:student &gt;  explain <span class="keyword">select</span> * from stu3 <span class="built_in">where</span> phone=12121212127;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys | key  | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | stu3  | ALL  | uni_phone     | NULL | NULL    | NULL |    7 |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">4ï¼‰æŸ¥è¯¢çš„æ—¶å€™åŠ å¼•å·ï¼Œèµ°ç´¢å¼•</span><br><span class="line">root@localhost:student &gt;  explain <span class="keyword">select</span> * from stu3 <span class="built_in">where</span> phone=<span class="string">&#x27;12121212127&#x27;</span>;</span><br><span class="line">+----+-------------+-------+-------+---------------+-----------+---------+-------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys | key       | key_len | ref   | rows |</span><br><span class="line">+----+-------------+-------+-------+---------------+-----------+---------+-------+------+</span><br><span class="line">|  1 | SIMPLE      | stu3  | const | uni_phone     | uni_phone | 33      | const |    1 |</span><br><span class="line">+----+-------------+-------+-------+---------------+-----------+---------+-------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼˜åŒ–ï¼šæŸ¥è¯¢å­—æ®µçš„æ•°æ®ç±»å‹æŒ‰ç…§æŒ‡å®šçš„æ•°æ®ç±»å‹è¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€#æ¨¡ç³ŠæŸ¥è¯¢   %ä¸èƒ½æ”¾å‰é¢ï¼Œå› ä¸º%ä¸å›ºå®šï¼Œå…¨è¡¨éƒ½è¦æ‰«æï¼ŒèŒƒå›´å¤§</span><br><span class="line">%æ”¾å‰é¢ï¼Œä¸èµ°ç´¢å¼•</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode like <span class="string">&#x27;%H&#x27;</span>;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys | key  | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | ALL  | NULL          | NULL | NULL    | NULL | 4188 |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line"></span><br><span class="line">%æ²¡æ”¾å‰é¢ï¼Œèµ°ç´¢å¼•</span><br><span class="line">root@localhost:student &gt; root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode like <span class="string">&#x27;H%&#x27;</span>;</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys | key         | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | range | CountryCode   | CountryCode | 3       | NULL |   22 |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼˜åŒ–ï¼šå¦‚æœç”Ÿäº§ä¸­æœ‰å¤§é‡çš„è¿™ç§%æ”¾å‰é¢æ‰èƒ½æŸ¥è¯¢çš„éœ€æ±‚ï¼Œé‚£å°±ä¸ä½¿ç”¨mysql,</span></span><br><span class="line"><span class="comment">#å¯ä»¥ç”¨elasticsearch,ä»–æ˜¯ä¸“é—¨åšæœç´¢å¼•æ“çš„æ•°æ®åº“</span></span><br><span class="line"></span><br><span class="line">6ã€#èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨&lt;&gt;ã€ not <span class="keyword">in</span> ã€!=</span><br><span class="line">ä½¿ç”¨è¿™ç§æ–¹æ³•å¿…ç„¶ä¼šä¸èµ°ç´¢å¼•ï¼Œå› ä¸ºä¸ç­‰äº1ä¸ªå€¼ï¼Œå…¶å®ƒçš„éƒ½å‡ºæ¥äº†ï¼Œç»“æœé›†å¿…å®š&gt;25%</span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode != <span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span> | possible_keys | key  | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | ALL  | CountryCode   | NULL | NULL    | NULL | 4188 |</span><br><span class="line">+----+-------------+-------+------+---------------+------+---------+------+------+</span><br><span class="line">å½’æ ¹ç»“åº•è¿˜æ˜¯ç»“æœé›†å¯¼è‡´ä¸èµ°ç´¢å¼•</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼˜åŒ–ï¼šä½¿ç”¨limit</span></span><br><span class="line">root@localhost:student &gt; explain <span class="keyword">select</span> * from world.city <span class="built_in">where</span> countrycode != <span class="string">&#x27;CHN&#x27;</span> <span class="built_in">limit</span> 10;</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">| <span class="built_in">id</span> | select_type | table | <span class="built_in">type</span>  | possible_keys | key         | key_len | ref  | rows |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line">|  1 | SIMPLE      | city  | range | CountryCode   | CountryCode | 3       | NULL | 3715 |</span><br><span class="line">+----+-------------+-------+-------+---------------+-------------+---------+------+------+</span><br><span class="line"></span><br><span class="line">7ã€#è”åˆç´¢å¼•ï¼šå½“æ²¡æœ‰æŒ‰ç…§ç´¢å¼•åˆ›å»ºé¡ºåºæŸ¥è¯¢ï¼Œå¯¼è‡´ä¸èµ°ç´¢å¼•</span><br><span class="line"><span class="comment">#ä¼˜åŒ–æ–¹æ¡ˆï¼šåšå¥½è°ƒç ”ï¼Œæ—¥å¿—åˆ†ææ•°æ®ï¼ŒæŒ‰ç…§ç”¨æˆ·éœ€æ±‚ï¼Œåˆ›å»ºè”åˆç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">8ã€ç´¢å¼•æœ¬èº«å¤±æ•ˆ  </span><br><span class="line"><span class="comment">#ä¼˜åŒ–æ–¹æ¡ˆï¼šåˆ é™¤é‡å»º</span></span><br><span class="line">åˆ¤æ–­ç´¢å¼•æ˜¯å¦å¤±æ•ˆï¼Œå°±æ˜¯æŠŠä¸Šé¢çš„åˆ¤æ–­å®Œäº†ï¼Œéƒ½èµ°ç´¢å¼•äº†</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç½‘ç«™è®¿é—®æ…¢ï¼Œæˆ–è€…é¢è¯•é—®</span><br><span class="line">å¦‚æœæ˜¯ç‰©ç†æœºï¼Œå°±å…ˆæ’é™¤ç¡¬ä»¶ï¼Œæˆ–è€…ç½‘ç»œï¼Œæ˜¯ä¸æ˜¯ç½‘ç»œå»¶è¿Ÿé«˜ï¼Œä¼ è¾“å±‚ï¼Œtcpï¼Œæ’æŸ¥ä¸ƒå±‚æ¨¡å‹ï¼Œæœ€ååˆ°åº”ç”¨å±‚ï¼Œnginxçš„é…ç½®ï¼Œæ˜¯ä¸æ˜¯å‹åŠ›å¤§æŠ—ä¸ä½</span><br><span class="line">mysqlæ˜¯ä¸æ˜¯æ…¢æŸ¥è¯¢å¯¼è‡´çš„é€Ÿåº¦æ…¢ï¼Œä»–ä¼šè®°å½•åœ¨æ—¥å¿—é‡Œé¢ï¼Œæ‹¿å‡ºæ¥ï¼ŒåŠ ä¸Šexplain åˆ†æï¼Œ</span><br><span class="line">åˆ†ææ˜¯å…¨è¡¨æ‰«æè¿˜æ˜¯ç´¢å¼•æ‰«æï¼Œç´¢å¼•æ‰«æäº†ï¼Œæ˜¯å“ªä¸ªçº§åˆ«ï¼Œ</span><br><span class="line">å¦‚æœæ˜¯å…¨è¡¨æ‰«æï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯æ²¡æœ‰åˆ›å»ºç´¢å¼•ï¼Œå¦‚æœåˆ›å»ºäº†ç´¢å¼•ï¼Œè¿˜æ˜¯å…¨è¡¨æ‰«æï¼Œé‚£åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">mysqlçš„è§†å›¾å’Œè§¦å‘å™¨ æ˜¯å¼€å‘å†™çš„</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•7ã€Mysqlçš„è¿è¡¨æŸ¥è¯¢</title>
      <link href="/posts/257eb32c.html"/>
      <url>/posts/257eb32c.html</url>
      
        <content type="html"><![CDATA[<h3 id="mysqlçš„è¿è¡¨æŸ¥è¯¢">mysqlçš„è¿è¡¨æŸ¥è¯¢</h3><p><strong>å­—ç¬¦é›†çš„ä»‹ç»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦ç¼–ç ï¼šç°åœ¨èƒ½å¤Ÿçœ‹åˆ°çš„å­—ç¬¦ä¸² æ•°å­— ç‰¹æ®Šç¬¦å·ï¼Œéƒ½æ˜¯å­—ç¬¦ç¼–ç è¡¨æä¾›çš„</span><br><span class="line"></span><br><span class="line">å­—ç¬¦é›†ï¼šæ˜¯ä¸€ä¸ªç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰æŠ½è±¡å­—ç¬¦çš„é›†åˆã€‚å­—ç¬¦æ˜¯å„ç§æ–‡å­—å’Œç¬¦å·çš„æ€»ç§°ï¼ŒåŒ…æ‹¬å„å›½å®¶æ–‡å­—ã€æ ‡ç‚¹ç¬¦å·ã€å›¾å½¢ç¬¦å·ã€æ•°å­—ç­‰ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç£ç›˜å­˜å‚¨æ•°æ®æ˜¯äºŒè¿›åˆ¶çš„æ•°æ®ï¼Œåœ¨ç³»ç»Ÿçš„æœ€åº•å±‚ï¼ŒäºŒè¿›åˆ¶çš„æ•°æ®å°±æ˜¯0 1ï¼ŒäºŒè¿›åˆ¶çš„æˆ‘ä»¬çœ‹ä¸æ‡‚ï¼Œæœ€åº•å±‚æœ‰ä¸€ä¸ªACSç è¡¨ï¼Œç»è¿‡ä»–çš„è½¬æ¢ï¼ŒäºŒè¿›åˆ¶çš„æ•°æ®å°±å˜æˆæˆ‘ä»¬èƒ½å¤Ÿçœ‹æ‡‚çš„å­—ç¬¦ä¸²</span><br><span class="line">ACSç è¡¨å¤šå¤§å‘¢ï¼Œå°±ä¸€é¡µï¼Œä¸æŒ‡å®šå­—ç¬¦é›†ï¼Œå°±ä¼šä¹±ç </span><br><span class="line"></span><br><span class="line">å¦‚æœè½¯ä»¶æƒ³è¦å¯¹å›½å¤–æä¾›æœåŠ¡ï¼Œå¼€å‘è¯­è¨€æŠŠæ¥æ”¶åˆ°çš„æ•°æ®è½¬åŒ–ä¸ºjson,å«åºåˆ—åŒ–</span><br><span class="line">jsonè½¬åŒ–ä¸ºå…¶ä»–è¯­è¨€ï¼Œå«ååºåˆ—åŒ–</span><br><span class="line">å¦‚æœç”¨ä¸‡å›½ç¼–ç å¼€å‘ï¼Œå¼€å‘å‡ºæ¥çš„ç¨‹åºç‰¹åˆ«å¤§</span><br><span class="line"></span><br><span class="line">2.MySQLæ•°æ®åº“çš„å­—ç¬¦é›†</span><br><span class="line">     1ï¼‰å­—ç¬¦é›†ï¼ˆCHARACTERï¼‰</span><br><span class="line">     2ï¼‰æ ¡å¯¹è§„åˆ™ï¼ˆCOLLATIONï¼‰</span><br><span class="line"></span><br><span class="line">3.MySQLä¸­å¸¸è§çš„å­—ç¬¦é›†</span><br><span class="line">     1ï¼‰UTF8</span><br><span class="line">     2ï¼‰LATIN1</span><br><span class="line">     3ï¼‰GBK</span><br><span class="line">     </span><br><span class="line">4.å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹</span><br><span class="line">     mysql&gt; show charset;</span><br><span class="line">     mysql&gt; show collationï¼š</span><br><span class="line"></span><br><span class="line">5.å¸¸è§æ ¡å¯¹è§„åˆ™</span><br><span class="line">     Collation çš„åˆ—  ciç»“å°¾ï¼šå¤§å°å†™ä¸æ•æ„Ÿ</span><br><span class="line">                    csæˆ–binç»“å°¾ï¼šå¤§å°å†™æ•æ„Ÿ</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240814084651245.png" alt="image-20240814084651245"></p><p><strong>å­—ç¬¦é›†çš„è®¾ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å­—ç¬¦é›†éœ€è¦ç»Ÿä¸€</span></span><br><span class="line">1ã€éœ€è¦è®¾ç½®è¿œç¨‹è¿æ¥å·¥å…·çš„å­—ç¬¦é›†</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹æ“ä½œç³»ç»Ÿè®¾ç½®å­—ç¬¦é›†</span><br><span class="line">[root@db01 ~]# <span class="built_in">echo</span> SLANG</span><br><span class="line">SLANG</span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¸´æ—¶ä¿®æ”¹ç³»ç»Ÿå­—ç¬¦é›†</span></span><br><span class="line">[root@db04 ~]# <span class="built_in">export</span> LANG=en_US.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ°¸ä¹…ä¿®æ”¹ CentOS7</span></span><br><span class="line">[root@db04 ~]# vim /etc/locale.conf</span><br><span class="line">LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## æ°¸ä¹…ä¿®æ”¹ CentOS6</span></span><br><span class="line">[root@db04 ~]# vim /etc/sysconfig/i18n</span><br><span class="line">LANG=<span class="string">&quot;en_US.UTF-8&quot;</span></span><br><span class="line"></span><br><span class="line">3ã€mysqlæœåŠ¡å­—ç¬¦é›†çš„ä¿®æ”¹</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">#æƒ³çŸ¥é“æˆ‘ä»¬åº“é‡Œé¢å“ªäº›è¡¨ä¸æ˜¯utf8</span></span><br><span class="line">root@localhost:(none) &gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema | <span class="comment">#è¿™ä¸ªåº“å­˜å…ƒæ•°æ®ï¼Œåœ¨ç£ç›˜ä¸Šçœ‹ä¸è§</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from information_schema.tables <span class="built_in">where</span> table_collation not like <span class="string">&#x27;%utf8%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>åº“è¡¨ä¿®æ”¹å­—ç¬¦é›†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:(none) &gt; show create database mysql;</span><br><span class="line">+----------+----------------------------------------------------------------+</span><br><span class="line">| Database | Create Database                                                |</span><br><span class="line">+----------+----------------------------------------------------------------+</span><br><span class="line">| mysql    | CREATE DATABASE `mysql` /*!40100 DEFAULT CHARACTER SET utf8 */ |</span><br><span class="line">+----------+----------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">1ã€#ä¿®æ”¹å­—ç¬¦é›†</span><br><span class="line">mysql&gt; alter database mysql charset utf8;</span><br><span class="line"></span><br><span class="line">2ã€#æŸ¥çœ‹æ‰€æœ‰åº“é‡Œé¢å“ªäº›è¡¨çš„å­—ç¬¦é›†ä¸æ˜¯UTF8çš„</span><br><span class="line"><span class="keyword">select</span> * from information_schema.tables <span class="built_in">where</span> table_collation not like <span class="string">&#x27;%utf8%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3ã€# ä¿®æ”¹å•å¼ è¡¨å­—ç¬¦é›†</span><br><span class="line">mysql&gt; alter table zls.test111 charset utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰¹é‡ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</span></span><br><span class="line">å¯ä»¥æŠŠè¡¨åå–å‡ºæ¥ï¼Œæ”¾åˆ°æ–‡ä»¶é‡Œé¢ï¼Œå¾ªç¯æ–‡ä»¶é‡Œé¢çš„å†…å®¹å»ä¿®æ”¹</span><br><span class="line"><span class="comment">## æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line">[root@db04 ~]# <span class="keyword">for</span> n <span class="keyword">in</span> `<span class="built_in">seq</span> 7`;<span class="keyword">do</span> mysql -uroot -p123 -e <span class="string">&quot;alter table</span></span><br><span class="line"><span class="string">zabbix.zabbix<span class="variable">$n</span> charset utf8&quot;</span> ;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">å¯¼å‡ºæ•°æ®åº“ï¼Œç¼–è¾‘å¯¼å‡ºçš„æ•°æ®æ–‡ä»¶ï¼Œç¼–è¾‘æ•°æ®æ–‡ä»¶ï¼ŒæŠŠå­—ç¬¦é›†ä¿®æ”¹ï¼Œå†å¯¼å…¥æ•°æ®</span><br><span class="line"><span class="comment"># æ–¹æ³•äºŒï¼š</span></span><br><span class="line">[root@db04 ~]# mysqldump -uroot -p123 -B zabbix &gt; /tmp/zabbix.sql</span><br><span class="line">[root@db04 ~]# vim /tmp/zabbix.sql</span><br><span class="line">:%s#CHARSET=latin1#CHARSET=utf8#g</span><br><span class="line">[root@db04 ~]# sed -i <span class="string">&#x27;s#CHARSET=latin1#CHARSET=utf8#g&#x27;</span> /tmp/zabbix.sql</span><br><span class="line">[root@db04 ~]# mysql -uroot -p123 &lt; /tmp/zabbix.sql</span><br><span class="line"></span><br><span class="line">å­—ç¬¦é›†ä¸å¤Ÿç”¨å°±æ”¹ï¼ŒæŠŠå°çš„å­—ç¬¦é›†å¾€å¤§æ”¹</span><br></pre></td></tr></table></figure><p><strong>select è¿è¡¨æŸ¥è¯¢ ï¼ˆå¤šè¡¨è¿æŸ¥ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">1     2      3</span><br><span class="line">[li4,zhang3,wang5]  <span class="comment">#å­¦ç”Ÿè¡¨</span></span><br><span class="line"></span><br><span class="line"> 1   2  3</span><br><span class="line">[80,90,100]    <span class="comment">#æˆç»©è¡¨</span></span><br><span class="line"></span><br><span class="line"> 2    1   3</span><br><span class="line">[è¯­æ–‡,æ•°å­¦,è‹±è¯­]  <span class="comment">#å­¦ç§‘è¡¨</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; use aaa</span><br><span class="line">root@localhost:aaa &gt; create table stu(<span class="built_in">id</span> int,name varchar(10));</span><br><span class="line">root@localhost:aaa &gt; insert into stu values(1,<span class="string">&#x27;lis4&#x27;</span>),(2,<span class="string">&#x27;zhang3&#x27;</span>),(3,<span class="string">&#x27;wang5&#x27;</span>);</span><br><span class="line">root@localhost:aaa &gt; <span class="keyword">select</span> * from stu;</span><br><span class="line">+------+--------+</span><br><span class="line">| <span class="built_in">id</span>   | name   |</span><br><span class="line">+------+--------+</span><br><span class="line">|    1 | lis4   |</span><br><span class="line">|    2 | zhang3 |</span><br><span class="line">|    3 | wang5  |</span><br><span class="line">+------+--------+</span><br><span class="line"></span><br><span class="line">root@localhost:aaa &gt; create table mark(<span class="built_in">id</span> int,mark tinyint unsigned);</span><br><span class="line">root@localhost:aaa &gt; insert into mark values(1,80),(2,90),(3,100);</span><br><span class="line">root@localhost:aaa &gt; <span class="keyword">select</span> * from mark;</span><br><span class="line">+------+------+</span><br><span class="line">| <span class="built_in">id</span>   | mark |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 |   80 |</span><br><span class="line">|    2 |   90 |</span><br><span class="line">|    3 |  100 |</span><br><span class="line">+------+------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥è¯¢å¼ ä¸‰çš„æˆç»©</span></span><br><span class="line">åå­—ï¼šstu  name</span><br><span class="line">åˆ†æ•°ï¼šmark mark</span><br><span class="line"></span><br><span class="line">root@localhost:aaa &gt; <span class="keyword">select</span> stu.name,mark.mark from stu,mark <span class="built_in">where</span> stu.id=mark.id and stu.name=<span class="string">&#x27;zhang3&#x27;</span>;   <span class="comment">#è¿™ç§æ–¹å¼å«ä¼ ç»Ÿè¿æ¥</span></span><br><span class="line">+--------+------+</span><br><span class="line">| name   | mark |</span><br><span class="line">+--------+------+</span><br><span class="line">| zhang3 |   90 |</span><br><span class="line">+--------+------+     </span><br></pre></td></tr></table></figure><p><strong>select ä¼ ç»Ÿè¿æ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">1ã€å…ˆæŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">root@localhost:world &gt; desc city;</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field       | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line">| ID          | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| Name        | char(35) | NO   |     |         |                |</span><br><span class="line">| CountryCode | char(3)  | NO   | MUL |         |                |</span><br><span class="line">| District    | char(20) | NO   |     |         |                |</span><br><span class="line">| Population  | int(11)  | NO   |     | 0       |                |</span><br><span class="line">+-------------+----------+------+-----+---------+----------------+</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; desc country;</span><br><span class="line">+----------------+---------------------------------------------------------------------------------------+------+-----+---------+-------+</span><br><span class="line">| Field          | Type                                                                                  | Null | Key | Default | Extra |</span><br><span class="line">+----------------+---------------------------------------------------------------------------------------+------+-----+---------+-------+</span><br><span class="line">| Code           | char(3)                                                                               | NO   | PRI |         |       |</span><br><span class="line">| Name           | char(52)                                                                              | NO   |     |         |       |</span><br><span class="line">| Continent      | enum(<span class="string">&#x27;Asia&#x27;</span>,<span class="string">&#x27;Europe&#x27;</span>,<span class="string">&#x27;North America&#x27;</span>,<span class="string">&#x27;Africa&#x27;</span>,<span class="string">&#x27;Oceania&#x27;</span>,<span class="string">&#x27;Antarctica&#x27;</span>,<span class="string">&#x27;South America&#x27;</span>) | NO   |     | Asia    |       |</span><br><span class="line">| Region         | char(26)                                                                              | NO   |     |         |       |</span><br><span class="line">| SurfaceArea    | <span class="built_in">float</span>(10,2)                                                                           | NO   |     | 0.00    |       |</span><br><span class="line">| IndepYear      | smallint(6)                                                                           | YES  |     | NULL    |       |</span><br><span class="line">| Population     | int(11)                                                                               | NO   |     | 0       |       |</span><br><span class="line">| LifeExpectancy | <span class="built_in">float</span>(3,1)                                                                            | YES  |     | NULL    |       |</span><br><span class="line">| GNP            | <span class="built_in">float</span>(10,2)                                                                           | YES  |     | NULL    |       |</span><br><span class="line">| GNPOld         | <span class="built_in">float</span>(10,2)                                                                           | YES  |     | NULL    |       |</span><br><span class="line">| LocalName      | char(45)                                                                              | NO   |     |         |       |</span><br><span class="line">| GovernmentForm | char(45)                                                                              | NO   |     |         |       |</span><br><span class="line">| HeadOfState    | char(60)                                                                              | YES  |     | NULL    |       |</span><br><span class="line">| Capital        | int(11)                                                                               | YES  |     | NULL    |       |</span><br><span class="line">| Code2          | char(2)                                                                               | NO   |     |         |       |</span><br><span class="line">+----------------+---------------------------------------------------------------------------------------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; desc countrylanguage;</span><br><span class="line">+-------------+---------------+------+-----+---------+-------+</span><br><span class="line">| Field       | Type          | Null | Key | Default | Extra |</span><br><span class="line">+-------------+---------------+------+-----+---------+-------+</span><br><span class="line">| CountryCode | char(3)       | NO   | PRI |         |       |</span><br><span class="line">| Language    | char(30)      | NO   | PRI |         |       |</span><br><span class="line">| IsOfficial  | enum(<span class="string">&#x27;T&#x27;</span>,<span class="string">&#x27;F&#x27;</span>) | NO   |     | F       |       |</span><br><span class="line">| Percentage  | <span class="built_in">float</span>(4,1)    | NO   |     | 0.0     |       |</span><br><span class="line">+-------------+---------------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#æŸ¥è¯¢ä¸–ç•Œä¸Šå°äº100äººçš„äººå£åŸå¸‚æ˜¯å“ªä¸ªå›½å®¶çš„ï¼Ÿ</span><br><span class="line">æ‰¾åˆ°ä½ è¦çš„å­—æ®µ</span><br><span class="line">å›½å®¶                   åŸå¸‚            åŸå¸‚äººå£æ•°          </span><br><span class="line">country.name         city.name        city.population</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population</span><br><span class="line">from country,city</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code</span><br><span class="line">and city.population&lt;100;</span><br><span class="line">+----------+-----------+------------+</span><br><span class="line">| name     | name      | population |</span><br><span class="line">+----------+-----------+------------+</span><br><span class="line">| Pitcairn | Adamstown |         42 |</span><br><span class="line">+----------+-----------+------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#nameéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥å†™åˆ«å</span></span><br><span class="line"><span class="keyword">select</span> country.name as å›½å®¶å,city.name as åŸå¸‚å,city.population as åŸå¸‚äººå£æ•°é‡</span><br><span class="line">from country,city</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code</span><br><span class="line">and city.population&lt;100;</span><br><span class="line">+-----------+-----------+--------------------+</span><br><span class="line">| å›½å®¶å    | åŸå¸‚å    | åŸå¸‚äººå£æ•°é‡       |</span><br><span class="line">+-----------+-----------+--------------------+</span><br><span class="line">| Pitcairn  | Adamstown |                 42 |</span><br><span class="line">+-----------+-----------+--------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#æŸ¥è¯¢ä¸–ç•Œä¸Šå°äº100äººçš„äººå£åŸå¸‚æ˜¯å“ªä¸ªå›½å®¶çš„è¯´çš„ä»€ä¹ˆè¯­è¨€ï¼Ÿ</span><br><span class="line">æ‰¾åˆ°ä½ è¦çš„å­—æ®µ</span><br><span class="line">å›½å®¶               åŸå¸‚         åŸå¸‚äººå£æ•°         è¯­è¨€ </span><br><span class="line">country.name    city.name     city.population    countrylanguage.language</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population,countrylanguage.language</span><br><span class="line">from city,countrylanguage,country</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code and country.code=countrylanguage.countrycode</span><br><span class="line">and city.population&lt;100;</span><br><span class="line">+----------+-----------+------------+-------------+</span><br><span class="line">| name     | name      | population | language    |</span><br><span class="line">+----------+-----------+------------+-------------+</span><br><span class="line">| Pitcairn | Adamstown |         42 | Pitcairnese |</span><br><span class="line">+----------+-----------+------------+-------------+</span><br></pre></td></tr></table></figure><p><strong>select è‡ªè¿æ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> è‡ªè¿æ¥natural <span class="built_in">join</span>    <span class="comment">#è‡ªè¿æ¥ç”¨çš„å°‘</span></span><br><span class="line"><span class="comment">#è‡ªåŠ¨å…³è”å¤šå¼ è¡¨çš„æ•°æ®(è‡ªåŠ¨å¸®æˆ‘ä»¬æ‰¾åˆ°ç­‰ä»·æ¡ä»¶)å­—æ®µå¿…é¡»ç›¸åŒ</span></span><br><span class="line">root@localhost:aaa &gt; <span class="keyword">select</span> stu.name,mark.mark from stu natural <span class="built_in">join</span> mark <span class="built_in">where</span> stu.name=<span class="string">&#x27;zhang3&#x27;</span>;</span><br><span class="line">+--------+------+</span><br><span class="line">| name   | mark |</span><br><span class="line">+--------+------+</span><br><span class="line">| zhang3 |   90 |</span><br><span class="line">+--------+------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1ã€#æŸ¥è¯¢ä¸–ç•Œä¸Šå°äº100äººçš„äººå£åŸå¸‚æ˜¯å“ªä¸ªå›½å®¶çš„ï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼ ç»Ÿè¿æ¥æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population</span><br><span class="line">from country,city</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code</span><br><span class="line">and city.population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è‡ªè¿æ¥æŸ¥è¯¢  æ— æ³•å®ç°ï¼Œç­‰ä»·çš„æ¡ä»¶æœ‰ï¼Œä½†æ˜¯å­—æ®µåä¸ç›¸åŒ</span></span><br><span class="line">æ‰¾åˆ°ä½ è¦çš„å­—æ®µ</span><br><span class="line">å›½å®¶                   åŸå¸‚            åŸå¸‚äººå£æ•°          </span><br><span class="line">country.name         city.name        city.population</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population</span><br><span class="line">from country natural <span class="built_in">join</span> city</span><br><span class="line"><span class="built_in">where</span> city.population&lt;100;</span><br><span class="line"></span><br><span class="line">2ã€#æŸ¥è¯¢ä¸–ç•Œä¸Šå°äº100äººçš„äººå£åŸå¸‚æ˜¯å“ªä¸ªå›½å®¶çš„è¯´çš„ä»€ä¹ˆè¯­è¨€ï¼Ÿ</span><br><span class="line">æ‰¾åˆ°ä½ è¦çš„å­—æ®µ</span><br><span class="line">å›½å®¶               åŸå¸‚         åŸå¸‚äººå£æ•°         è¯­è¨€ </span><br><span class="line">country.name    city.name     city.population    countrylanguage.language</span><br><span class="line"><span class="comment">#ä¼ ç»Ÿè¿æ¥æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population,countrylanguage.language</span><br><span class="line">from city,countrylanguage,country</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code and country.code=countrylanguage.countrycode</span><br><span class="line">and city.population&lt;100;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">city   countrylanguage</span><br><span class="line"><span class="comment">#è‡ªè¿æ¥æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span>  city.countrycode,city.name,city.population,countrylanguage.language</span><br><span class="line">from city natural <span class="built_in">join</span> countrylanguage</span><br><span class="line"><span class="built_in">where</span> city.population&lt;100;</span><br><span class="line">+-------------+-----------+------------+-------------+</span><br><span class="line">| countrycode | name      | population | language    |</span><br><span class="line">+-------------+-----------+------------+-------------+</span><br><span class="line">| PCN         | Adamstown |         42 | Pitcairnese |</span><br><span class="line">+-------------+-----------+------------+-------------+</span><br></pre></td></tr></table></figure><p><strong>select å†…è¿æ¥ï¼ˆinner joinï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">tb1 <span class="built_in">join</span> tb2 on ç­‰ä»·æ¡ä»¶ <span class="built_in">where</span></span><br><span class="line">tb1 <span class="built_in">join</span> tb2 on ç­‰ä»·æ¡ä»¶ <span class="built_in">join</span> tb3 on ç­‰ä»·æ¡ä»¶  <span class="built_in">where</span></span><br><span class="line"></span><br><span class="line">1ã€#æŸ¥è¯¢ä¸–ç•Œä¸Šå°äº100äººçš„äººå£åŸå¸‚æ˜¯å“ªä¸ªå›½å®¶çš„ï¼Ÿ</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼ ç»Ÿè¿æ¥æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population</span><br><span class="line">from country,city</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code</span><br><span class="line">and city.population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†…è¿æ¥æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population</span><br><span class="line">from city <span class="built_in">join</span> country</span><br><span class="line">on city.countrycode=country.code</span><br><span class="line"><span class="built_in">where</span> city.population&lt;100;</span><br><span class="line">+----------+-----------+------------+</span><br><span class="line">| name     | name      | population |</span><br><span class="line">+----------+-----------+------------+</span><br><span class="line">| Pitcairn | Adamstown |         42 |</span><br><span class="line">+----------+-----------+------------+</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">2ã€#æŸ¥è¯¢ä¸–ç•Œä¸Šå°äº100äººçš„äººå£åŸå¸‚æ˜¯å“ªä¸ªå›½å®¶çš„è¯´çš„ä»€ä¹ˆè¯­è¨€ï¼Ÿ</span><br><span class="line">æ‰¾åˆ°ä½ è¦çš„å­—æ®µ</span><br><span class="line">å›½å®¶               åŸå¸‚         åŸå¸‚äººå£æ•°         è¯­è¨€ </span><br><span class="line">country.name    city.name     city.population    countrylanguage.language</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼ ç»Ÿè¿æ¥æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population,countrylanguage.language</span><br><span class="line">from city,countrylanguage,country</span><br><span class="line"><span class="built_in">where</span> city.countrycode=country.code and country.code=countrylanguage.countrycode</span><br><span class="line">and city.population&lt;100;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†…è¿æ¥æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">select</span> country.name,city.name,city.population,countrylanguage.language</span><br><span class="line">from city <span class="built_in">join</span> countrylanguage </span><br><span class="line">on  city.countrycode=countrylanguage.countrycode</span><br><span class="line"><span class="built_in">join</span> country</span><br><span class="line">on country.code=city.countrycode</span><br><span class="line"><span class="built_in">where</span> city.population&lt;100;</span><br><span class="line">+----------+-----------+------------+-------------+</span><br><span class="line">| name     | name      | population | language    |</span><br><span class="line">+----------+-----------+------------+-------------+</span><br><span class="line">| Pitcairn | Adamstown |         42 | Pitcairnese |</span><br><span class="line">+----------+-----------+------------+-------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸ºäº†æ€§èƒ½</span></span><br><span class="line"><span class="built_in">join</span> on å†…è¿æ¥æŸ¥è¯¢ï¼Œå¿…é¡»å°è¡¨åœ¨å‰ï¼Œå¤§è¡¨åœ¨åï¼Œå†…è¿æ¥çš„æ€§èƒ½æ¯”ä¼ ç»Ÿè¿æ¥çš„æ€§èƒ½é«˜</span><br><span class="line">è°çš„æ•°æ®é‡å¤šè°å±äºå¤§è¡¨ <span class="keyword">select</span> * from city</span><br></pre></td></tr></table></figure><p><strong>select å¤–è¿æ¥</strong></p><ul><li>å·¦è¿æ¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">æ²¡å……é’±  çœ‹ä¸åˆ°æ•°æ® å°±ç”¨å·¦ å¤–  å³å¤–  </span><br><span class="line">å……é’± ï¼Œå°±å˜æˆä¼ ç»Ÿè¿æ¥</span><br><span class="line"><span class="comment">#left outer join       left join</span></span><br><span class="line"><span class="keyword">select</span> city.name,city.countrycode,country.name</span><br><span class="line">from city left <span class="built_in">join</span> country on city.countrycode=country.code and</span><br><span class="line">city.population&lt;100 <span class="built_in">limit</span> 10;</span><br><span class="line">+----------------+-------------+------+</span><br><span class="line">| name           | countrycode | name |</span><br><span class="line">+----------------+-------------+------+</span><br><span class="line">| Kabul          | AFG         | NULL |</span><br><span class="line">| Qandahar       | AFG         | NULL |</span><br><span class="line">| Herat          | AFG         | NULL |</span><br><span class="line">| Mazar-e-Sharif | AFG         | NULL |</span><br><span class="line">| Amsterdam      | NLD         | NULL |</span><br><span class="line">| Rotterdam      | NLD         | NULL |</span><br><span class="line">| Haag           | NLD         | NULL |</span><br><span class="line">| Utrecht        | NLD         | NULL |</span><br><span class="line">| Eindhoven      | NLD         | NULL |</span><br><span class="line">| Tilburg        | NLD         | NULL |</span><br><span class="line">+----------------+-------------+------+</span><br></pre></td></tr></table></figure><ul><li>å³è¿æ¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#right outer join             right join</span></span><br><span class="line"><span class="keyword">select</span> city.name,city.countrycode,country.name</span><br><span class="line">from city right <span class="built_in">join</span> country on city.countrycode=country.code and</span><br><span class="line">city.population&lt;100 <span class="built_in">limit</span> 10;</span><br><span class="line">+------+-------------+----------------------+</span><br><span class="line">| name | countrycode | name                 |</span><br><span class="line">+------+-------------+----------------------+</span><br><span class="line">| NULL | NULL        | Aruba                |</span><br><span class="line">| NULL | NULL        | Afghanistan          |</span><br><span class="line">| NULL | NULL        | Angola               |</span><br><span class="line">| NULL | NULL        | Anguilla             |</span><br><span class="line">| NULL | NULL        | Albania              |</span><br><span class="line">| NULL | NULL        | Andorra              |</span><br><span class="line">| NULL | NULL        | Netherlands Antilles |</span><br><span class="line">| NULL | NULL        | United Arab Emirates |</span><br><span class="line">| NULL | NULL        | Argentina            |</span><br><span class="line">| NULL | NULL        | Armenia              |</span><br><span class="line">+------+-------------+----------------------+</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•6ã€MYSQLçš„DMLã€DCLè¯­è¨€</title>
      <link href="/posts/abf1dc60.html"/>
      <url>/posts/abf1dc60.html</url>
      
        <content type="html"><![CDATA[<h2 id="DML-DCLè¯­è¨€">DML. DCLè¯­è¨€</h2><p><strong>DML ï¼ˆDatabase Modification Languageï¼‰æ•°æ®æ“ä½œè¯­è¨€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ›´æ”¹å¯†ç è°ƒç”¨passwordå‡½æ•°å¯¹å¯†ç è¿›è¡ŒåŠ å¯†</span></span><br><span class="line">update mysql.user <span class="built_in">set</span> password=PASSWORD(<span class="string">&#x27;123&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span> and host=<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">è°ƒç”¨å‡½æ•°å°±æ˜¯å‡½æ•°å+()</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¢ï¼šinster</span></span><br><span class="line"><span class="comment">#åˆ ï¼šdelete</span></span><br><span class="line"><span class="comment">#æ”¹ï¼šupdate</span></span><br><span class="line"><span class="comment">#æŸ¥ï¼šselect</span></span><br></pre></td></tr></table></figure><p>æ•°æ®çš„æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¢ï¼šinster</span></span><br><span class="line">åº“.è¡¨   <span class="comment">#ä¸åœ¨åº“é‡Œé¢</span></span><br><span class="line">è¡¨      <span class="comment">#åœ¨åº“é‡Œé¢</span></span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; desc stu300;</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line">| Field     | Type                | Null | Key | Default           | Extra          |</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line">| <span class="built_in">id</span>        | int(11)             | NO   | PRI | NULL              | auto_increment |</span><br><span class="line">| name      | varchar(20)         | NO   |     | NULL              |                |</span><br><span class="line">| age       | tinyint(4) unsigned | NO   |     | NULL              |                |</span><br><span class="line">| gender    | enum(<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;f&#x27;</span>)       | NO   |     | m                 |                |</span><br><span class="line">| phone     | char(11)            | NO   | PRI | NULL              |                |</span><br><span class="line">| come_time | datetime            | NO   |     | CURRENT_TIMESTAMP |                |</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line"></span><br><span class="line">1ã€#ä¸è§„èŒƒ  å¾€stu300è¡¨é‡Œé¢å¢åŠ æ•°æ®</span><br><span class="line">root@localhost:student &gt; insert into stu300 values(5,<span class="string">&#x27;ccc&#x27;</span>,23,<span class="string">&#x27;f&#x27;</span>,12312312388,now());   <span class="comment">#å°±æ˜¯æŒ‰ç…§é¡ºåºå†™æ‰€æœ‰å­—æ®µï¼Œå°‘ä¸€ä¸ªéƒ½ä¸è¡Œ</span></span><br><span class="line"></span><br><span class="line">2ã€#è§„èŒƒå†™æ³•  å¾€stu300è¡¨é‡Œé¢å¢åŠ æ•°æ®</span><br><span class="line">root@localhost:student &gt; insert into stu300(name,age,phone,class) values(<span class="string">&#x27;ddd&#x27;</span>,18,12312312399);       <span class="comment">#ä½ è¦å¾€å“ªä¸ªå­—æ®µæ·»åŠ æ•°æ®ï¼Œå°±å†™ä¸Šå“ªä¸ªå­—æ®µ</span></span><br><span class="line"></span><br><span class="line">3ã€#æ’å…¥å¤šæ¡æ•°æ®</span><br><span class="line">inster stu2 è¡¨å(å­—æ®µ1,å­—æ®µ2,å­—æ®µ3)  values(1ï¼Œ2ï¼Œ3),(1,2,4),(1,3,5);</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; insert into stu300(name,age,phone) values(<span class="string">&#x27;eee&#x27;</span>,27,2312312389),(<span class="string">&#x27;fff&#x27;</span>,27,2313312389),(<span class="string">&#x27;bbb&#x27;</span>,27,3312312389);</span><br><span class="line"></span><br><span class="line">4ã€#intoå¯ä»¥çœç•¥</span><br><span class="line">inster è¡¨å(å­—æ®µ1,å­—æ®µ2,å­—æ®µ3)  values(1ï¼Œ2ï¼Œ3); </span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; insert stu300(name,age,phone) values(<span class="string">&#x27;ggg&#x27;</span>,21,2333312389);</span><br><span class="line"></span><br><span class="line">æ‰‹æœºå·ä½æ•°ä¸å¯¹ï¼Œéƒ½æ˜¯å‰ç«¯æ‰“å°çš„ï¼Œæ•°æ®åº“åšä¸åˆ°æ‰‹æœºå·ä½æ•°ä¸å¯¹æŠ¥é”™ jwtåŒ¹é…åº“</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###åˆ ï¼šdelete + where</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from stu300;                               </span><br><span class="line">+----+------+-----+--------+-------------+---------------------+</span><br><span class="line">| <span class="built_in">id</span> | name | age | gender | phone       | come_time           |</span><br><span class="line">+----+------+-----+--------+-------------+---------------------+</span><br><span class="line">|  1 | aaa  |  13 | m      | 12345465666 | 2024-08-12 21:20:05 |</span><br><span class="line">|  3 | cc   |  12 | m      | 23456781234 | 2024-08-12 21:22:25 |</span><br><span class="line">|  5 | ccc  |  23 | f      | 12312312388 | 2024-08-13 14:08:27 |</span><br><span class="line">|  6 | ddd  |  18 | m      | 12312312399 | 2024-08-13 14:10:08 |</span><br><span class="line">|  7 | eee  |  27 | m      | 2312312389  | 2024-08-13 14:12:43 |</span><br><span class="line">|  8 | fff  |  27 | m      | 2313312389  | 2024-08-13 14:12:43 |</span><br><span class="line">|  9 | bbb  |  27 | m      | 3312312389  | 2024-08-13 14:12:43 |</span><br><span class="line">| 10 | ggg  |  21 | m      | 2333312389  | 2024-08-13 14:15:08 |</span><br><span class="line">+----+------+-----+--------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line">delleteåˆ é™¤å¿…é¡»æ¥æ¡ä»¶  æ‰“å®Œdelete å°±è¦æ‰“<span class="built_in">where</span></span><br><span class="line">delete from è¡¨ <span class="built_in">where</span> <span class="built_in">id</span>=5 </span><br><span class="line">1ã€#ä¸è§„èŒƒçš„å†™æ³•,è°¨æ…ä½¿ç”¨ï¼Œä¼šåˆ é™¤è¡¨é‡Œé¢çš„å…¨éƒ¨æ•°æ®</span><br><span class="line">delete from stu300;</span><br><span class="line"></span><br><span class="line">2ã€#è§„èŒƒå†™æ³•  PRIMARY KEY (`Host`,`User`) è”åˆä¸»é”®ï¼Œå°±è¦2ä¸ªç»„ä»¶ä¸€èµ·åˆ é™¤</span><br><span class="line">root@localhost:student &gt; delete from stu300 <span class="built_in">where</span> <span class="built_in">id</span>=8;</span><br><span class="line"></span><br><span class="line">3ã€#å¤šæ¡ä»¶ and  </span><br><span class="line">root@localhost:student &gt; delete from stu300 <span class="built_in">where</span> <span class="built_in">id</span>=10 and name=<span class="string">&#x27;ggg&#x27;</span>;</span><br><span class="line"></span><br><span class="line">4ã€#ä¸ºäº†å…»æˆä¸€ä¸ªå¥½ä¹ æƒ¯delete + <span class="built_in">where</span>ï¼Œè‹¥è¦æ¸…é™¤å…¨éƒ¨æ•°æ®ï¼Œè¡¨åä¸æ¸…é™¤</span><br><span class="line">root@localhost:student &gt;delete form stu1 <span class="built_in">where</span> 1=1;  <span class="comment">#æ¥ä¸€ä¸ªæ°¸è¿œæˆç«‹çš„æ¡ä»¶</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ”¹ï¼šupdate + where</span></span><br><span class="line">1ã€#ä¸è§„èŒƒå†™æ³•  å¦‚æœä¸åŠ <span class="built_in">where</span> æ‰€æœ‰çš„nameéƒ½å«ä¸€æ ·çš„åå­—</span><br><span class="line">update stu300 <span class="built_in">set</span> name=<span class="string">&#x27;lisi&#x27;</span> </span><br><span class="line"></span><br><span class="line">2ã€#å°†<span class="built_in">id</span>ä¸º1çš„ç”¨æˆ·æ”¹åä¸ºå¼ ä¸‰</span><br><span class="line">root@localhost:student &gt; update stu300 <span class="built_in">set</span> name=<span class="string">&#x27;zhangsan&#x27;</span> <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line"></span><br><span class="line">3ã€#å°†<span class="built_in">id</span>æ˜¯7ï¼Œå’Œ9 çš„ç”¨æˆ·åå­—æ”¹ä¸ºæå››</span><br><span class="line">root@localhost:student &gt; update stu300 <span class="built_in">set</span> name=<span class="string">&#x27;lisi&#x27;</span> <span class="built_in">where</span> <span class="built_in">id</span>=7 or <span class="built_in">id</span>=9;</span><br><span class="line"></span><br><span class="line">4ã€#è¦å…¨éƒ¨æ”¹ï¼Œåé¢æ¥ä¸€ä¸ªæˆç«‹çš„æ¡ä»¶</span><br><span class="line">update stu300 <span class="built_in">set</span> name=<span class="string">&#x27;zhang3&#x27;</span> <span class="built_in">where</span> 1=1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥ï¼šselect</span></span><br><span class="line"><span class="keyword">select</span> * from stu300;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * from stu300 <span class="built_in">where</span> status=<span class="string">&#x27;1&#x27;</span>;</span><br></pre></td></tr></table></figure><p><strong>ä½¿ç”¨updateä»£æ›¿deleteä»£æ›¿ä¼ªåˆ é™¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1ã€#éœ€è¦æ·»åŠ ä¸€ä¸ªçŠ¶æ€åˆ—(æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºçŠ¶æ€çš„å­—æ®µ)</span><br><span class="line">root@localhost:student &gt; alter table stu300 add status enum(<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>) not null default <span class="string">&#x27;0&#x27;</span> comment <span class="string">&#x27;çš®è‚¤è´­ä¹°çŠ¶æ€,0ä»£è¡¨æœªè´­ä¹°ï¼Œ1ä»£è¡¨å·²è´­ä¹°&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#å¤§å®¶éƒ½èŠ±é’±äº† ä¹°äº†</span><br><span class="line">root@localhost:student &gt; update stu300 <span class="built_in">set</span> status=<span class="string">&#x27;1&#x27;</span> <span class="built_in">where</span> 1=1;</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from stu300;</span><br><span class="line">+---+----------+-----+--------+-------------+---------------------+--------+</span><br><span class="line">| <span class="built_in">id</span>| name     | age | gender | phone       | come_time           | status |</span><br><span class="line">+---+----------+-----+--------+-------------+---------------------+--------+</span><br><span class="line">|  1| zhangsan |  13 | m      | 12345465666 | 2024-08-12 21:20:05 | 1      |</span><br><span class="line">|  3| cc       |  12 | m      | 23456781234 | 2024-08-12 21:22:25 | 1      |</span><br><span class="line">|  5| ccc      |  23 | f      | 12312312388 | 2024-08-13 14:08:27 | 1      |</span><br><span class="line">|  6| ddd      |  18 | m      | 12312312399 | 2024-08-13 14:10:08 | 1      |</span><br><span class="line">|  7| lisi     |  27 | m      | 2312312389  | 2024-08-13 14:12:43 | 1      |</span><br><span class="line">|  9| lisi     |  27 | m      | 3312312389  | 2024-08-13 14:12:43 | 1      |</span><br><span class="line">+---+----------+-----+--------+-------------+---------------------+--------+</span><br><span class="line"></span><br><span class="line">3ã€#ä½¿ç”¨updateä»£æ›¿delete   å¼ ä¸‰ä¹°çš„çš®è‚¤èµ é€ç»™åˆ«äººäº† </span><br><span class="line">root@localhost:student &gt; update stu300 <span class="built_in">set</span> status=<span class="string">&#x27;0&#x27;</span> <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line"></span><br><span class="line">4ã€#æŸ¥è¯¢çš„æ—¶å€™æ¥ä¸Šæ¡ä»¶</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from stu300 <span class="built_in">where</span> status=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">+----+------+-----+--------+-------------+---------------------+--------+</span><br><span class="line">| <span class="built_in">id</span> | name | age | gender | phone       | come_time           | status |</span><br><span class="line">+----+------+-----+--------+-------------+---------------------+--------+</span><br><span class="line">|  3 | cc   |  12 | m      | 23456781234 | 2024-08-12 21:22:25 | 1      |</span><br><span class="line">|  5 | ccc  |  23 | f      | 12312312388 | 2024-08-13 14:08:27 | 1      |</span><br><span class="line">|  6 | ddd  |  18 | m      | 12312312399 | 2024-08-13 14:10:08 | 1      |</span><br><span class="line">|  7 | lisi |  27 | m      | 2312312389  | 2024-08-13 14:12:43 | 1      |</span><br><span class="line">|  9 | lisi |  27 | m      | 3312312389  | 2024-08-13 14:12:43 | 1      |</span><br><span class="line">+----+------+-----+--------+-------------+---------------------+--------+</span><br><span class="line"></span><br><span class="line">å½“å‰ç«¯æ‹¿åˆ°statusæ˜¯0çš„æ—¶å€™å°±æ˜¯æ²¡æœ‰çš®è‚¤ï¼Œå‰ç«¯æ€ä¹ˆå†™æ˜¯å‰ç«¯çš„äº‹ï¼Œupdateå¹¶æ²¡æœ‰åˆ é™¤ï¼Œåªæ˜¯æ¥äº†æ¡ä»¶çŠ¶æ€ç­›é€‰äº†ï¼Œå¦‚æœçœŸæœ‰å®¢æˆ·è¦æ±‚æ¢å¤ï¼ŒæŠŠçŠ¶æ€é¡µä¿®æ”¹ä¸€ä¸‹å°±å¯ä»¥ï¼Œæ•°æ®å¹¶æ²¡æœ‰çœŸæ­£çš„åˆ é™¤ï¼Œè¿™æ ·çš„æ•ˆç‡æ¯”è¾ƒé«˜</span><br><span class="line"></span><br><span class="line"><span class="comment">#selete * ä¸æ¥æ¡ä»¶æ‰€æœ‰æ•°æ®éƒ½è¿˜åœ¨</span></span><br></pre></td></tr></table></figure><p><strong>DCL(Databases Control Language)æ•°æ®æ§åˆ¶è¯­è¨€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ç»™å¼€å‘æˆæƒ</span><br><span class="line">root@localhost:student &gt; grant insert,update,<span class="keyword">select</span> on student.* to dev@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">2ã€#with grant optionèµ‹äºˆç”¨æˆ·grantæƒé™ï¼Œä¸€èˆ¬è¶…çº§ç”¨æˆ·å¯ä»¥ç»™ä»–</span><br><span class="line">root@localhost:student &gt; grant all  on  *.* to leader@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span> with grant option;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#revote å›æ”¶æƒé™  <span class="comment">#ä¼ä¸šä¸­å¾ˆå°‘ç”¨</span></span><br><span class="line">æŸ¥çœ‹devé›…è™çš„æƒé™</span><br><span class="line">root@localhost:student &gt; show grants <span class="keyword">for</span> dev@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">+----------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants <span class="keyword">for</span> dev@%                                                                                   |</span><br><span class="line">+----------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY PASSWORD <span class="string">&#x27;*23AE809DDACAF96AF0FD78ED04B6A265E05AA257&#x27;</span> |</span><br><span class="line">| GRANT SELECT, INSERT, UPDATE ON `student`.* TO <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>                                           |</span><br><span class="line">+----------------------------------------------------------------------------------------------------+</span><br><span class="line"> </span><br><span class="line">4ã€#å›æ”¶devç”¨æˆ·çš„<span class="keyword">select</span>æƒé™</span><br><span class="line">root@localhost:student &gt; revoke <span class="keyword">select</span> on student.* from dev@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">5ã€#å†æ¬¡æŸ¥çœ‹æƒé™</span><br><span class="line">root@localhost:student &gt; show grants <span class="keyword">for</span> dev@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">+----------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants <span class="keyword">for</span> dev@%                                                                                   |</span><br><span class="line">+----------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT USAGE ON *.* TO <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY PASSWORD <span class="string">&#x27;*23AE809DDACAF96AF0FD78ED04B6A265E05AA257&#x27;</span> |</span><br><span class="line">| GRANT INSERT, UPDATE ON `student`.* TO <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;%&#x27;</span>                                                   |</span><br><span class="line">+----------------------------------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶ä»–å‚æ•°ï¼ˆæ‰©å±•ï¼‰</span></span><br><span class="line">max_queries_per_hourï¼šä¸€ä¸ªç”¨æˆ·æ¯å°æ—¶å¯å‘å‡ºçš„æŸ¥è¯¢æ•°é‡</span><br><span class="line">max_updates_per_hourï¼šä¸€ä¸ªç”¨æˆ·æ¯å°æ—¶å¯å‘å‡ºçš„æ›´æ–°æ•°é‡</span><br><span class="line">max_connections_per_hourï¼šä¸€ä¸ªç”¨æˆ·æ¯å°æ—¶å¯è¿æ¥åˆ°æœåŠ¡å™¨çš„æ¬¡æ•°</span><br><span class="line">max_user_connectionsï¼šå…è®¸åŒæ—¶è¿æ¥æ•°é‡</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1hæ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢è¯­å¥  è¿æ¥æ•°æ®åº“çš„æ—¶å€™ä¼šè¿›è¡Œä¸€æ¬¡æŸ¥è¯¢</span><br><span class="line">5ã€# max_queries_per_hourï¼šä¸€ä¸ªç”¨æˆ·æ¯å°æ—¶å¯å‘å‡ºçš„æŸ¥è¯¢æ•°é‡</span><br><span class="line">grant insert,update,<span class="keyword">select</span> on dev.* to dev3@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span> with</span><br><span class="line">max_queries_per_hour 3;</span><br><span class="line"></span><br><span class="line">6ã€# max_updates_per_hourï¼šä¸€ä¸ªç”¨æˆ·æ¯å°æ—¶å¯å‘å‡ºçš„æ›´æ–°æ•°é‡ï¼Œupdateå…ˆæŸ¥è¯¢åœ¨ä¿®æ”¹</span><br><span class="line">grant insert,update,<span class="keyword">select</span> on dev.* to dev4@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span> with</span><br><span class="line">max_queries_per_hour 3 max_updates_per_hour 1;</span><br><span class="line"></span><br><span class="line">7ã€# max_connections_per_hourï¼šä¸€ä¸ªç”¨æˆ·æ¯å°æ—¶å¯è¿æ¥åˆ°æœåŠ¡å™¨çš„æ¬¡æ•°</span><br><span class="line">grant insert,update,<span class="keyword">select</span></span><br><span class="line">on dev.*</span><br><span class="line">to dev5@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">identified by <span class="string">&#x27;123&#x27;</span></span><br><span class="line">with max_queries_per_hour 3</span><br><span class="line">max_updates_per_hour 1</span><br><span class="line">max_connections_per_hour 1;</span><br><span class="line"></span><br><span class="line">8ã€# max_user_connectionsï¼šå…è®¸åŒæ—¶è¿æ¥æ•°é‡</span><br><span class="line">grant insert,update,<span class="keyword">select</span></span><br><span class="line">on dev.*</span><br><span class="line">to dev6@<span class="string">&#x27;%&#x27;</span></span><br><span class="line">identified by <span class="string">&#x27;123&#x27;</span></span><br><span class="line">with max_user_connections 1;</span><br></pre></td></tr></table></figure><p><strong>DQL ï¼ˆDatabase Query Languageï¼‰æ•°æ®æŸ¥è¯¢è¯­è¨€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½æ•°æ®å¹¶å¯¼å…¥æ•°æ®åº“</span><br><span class="line">[root@db01 ~]# wget http://test.driverzeng.com/MySQL_File/world.sql</span><br><span class="line">[root@db01 ~]# mysql -uroot -p123 &lt; /root/world.sql </span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æœ‰å‡ å¼ è¡¨ï¼Œå‡ ä¸ªåº“ï¼Œæ¯ä¸ªè¡¨çš„ç»“æ„ å­—æ®µæ˜¯ä»€ä¹ˆæ„æ€</span></span><br><span class="line">åº“ï¼šworld</span><br><span class="line">root@localhost:world &gt; show tables from world;</span><br><span class="line">+-----------------+</span><br><span class="line">| Tables_in_world |</span><br><span class="line">+-----------------+</span><br><span class="line">| city            |</span><br><span class="line">| country         |</span><br><span class="line">| countrylanguage |</span><br><span class="line">+-----------------+</span><br></pre></td></tr></table></figure><p><strong>DQLçš„åŸºç¡€ç”¨æ³•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#show</span></span><br><span class="line">1ã€#æŸ¥çœ‹æ‰€æœ‰åº“</span><br><span class="line">root@localhost:student &gt; show databases;</span><br><span class="line"></span><br><span class="line">2ã€#æŸ¥çœ‹å½“å‰åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br><span class="line">root@localhost:student &gt; show tables;</span><br><span class="line">root@localhost:student &gt; show tables from student;</span><br><span class="line"></span><br><span class="line">3ã€#æŸ¥çœ‹å»ºåº“è¯­å¥</span><br><span class="line">root@localhost:student &gt; show create database student;</span><br><span class="line"></span><br><span class="line">4ã€#æŸ¥çœ‹å»ºè¡¨è¯­å¥</span><br><span class="line">root@localhost:student &gt; show create table stu300;</span><br><span class="line"></span><br><span class="line">5ã€#æŸ¥çœ‹åˆ›å»ºç”¨æˆ·çš„è¯­å¥</span><br><span class="line">root@localhost:student &gt; show grants <span class="keyword">for</span> dev@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">6ã€#æŸ¥çœ‹MYSQLè‡ªå¸¦çš„å­˜å‚¨å¼•æ“</span><br><span class="line">root@localhost:student &gt; show engines;</span><br><span class="line"></span><br><span class="line">7ã€#å­—ç¬¦é›†</span><br><span class="line">root@localhost:student &gt; show variables like <span class="string">&#x27;%char%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">8ã€#æŸ¥çœ‹å­—ç¬¦é›†æ”¯æŒçš„æ ¡éªŒè§„åˆ™</span><br><span class="line">root@localhost:student &gt; show collation;</span><br><span class="line"></span><br><span class="line">9ã€#æŸ¥çœ‹sqlè¯­å¥æ‰§è¡ŒçŠ¶æ€ï¼Œæ‹¿è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹å“ªæ¡sqlè¯­å¥æ‰§è¡Œçš„æ…¢</span><br><span class="line">root@localhost:student &gt; show processlist;</span><br><span class="line">root@localhost:student &gt; show full processlist;</span><br><span class="line">SHOW FULL PROCESSLISTæ˜¯SHOW PROCESSLISTçš„ä¸€ä¸ªæ‰©å±•ï¼Œå®ƒæä¾›äº†æ›´å¤šä¿¡æ¯</span><br><span class="line"></span><br><span class="line">10ã€#æŸ¥çœ‹mysqlå†…ç½®æ‰€æœ‰çš„å˜é‡</span><br><span class="line">root@localhost:student &gt; show variables;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###desc </span></span><br><span class="line">1ã€#æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">root@localhost:student &gt; desc stu1;</span><br><span class="line"></span><br><span class="line"><span class="comment">#descå¯ä»¥åšåˆ†æï¼Œåˆ†æè¯­å¥ï¼Œæ…¢æŸ¥è¯¢è¯­å¥</span></span><br><span class="line">desc <span class="keyword">select</span> * from stu1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¡¨ç»“æ„ï¼šå»ºè¡¨çš„è¦æ±‚</span><br><span class="line">è¡¨ç©ºé—´ï¼šå°±æ˜¯åœ¨è¡¨é‡Œé¢å­˜å‚¨çš„æ•°æ®</span><br></pre></td></tr></table></figure><p>selectæŸ¥è¯¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#selectï¼ˆæ¯”è¾ƒéš¾ï¼‰</span></span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; use world;</span><br><span class="line"></span><br><span class="line">1ã€#å…¨è¡¨æ‰«æ</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city;  <span class="comment">#è¿™ä¸ªè¯­å¥ä¸è¦å‡ºç°ï¼Œå°±å¥½æ¯”ä¸€ä¸ªcatä¸€ä¸ªå¤§æ–‡ä»¶ï¼Œä¼šå ç”¨å†…å­˜</span></span><br><span class="line"></span><br><span class="line">2ã€#å…¨è¡¨æ‰«æï¼Œæ¥æ¡ä»¶</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> <span class="built_in">id</span>=10;</span><br><span class="line"></span><br><span class="line">3ã€#å¤šæ¡ä»¶æŸ¥è¯¢ or ä¸­å›½å’Œç¾å›½çš„</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> CountryCode=<span class="string">&#x27;CHN&#x27;</span> or CountryCode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> CountryCode=<span class="string">&#x27;and&#x27;</span> or CountryCode=<span class="string">&#x27;afg&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#æˆå‘˜æŸ¥è¯¢</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> CountryCode <span class="keyword">in</span> (<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line"><span class="comment">#å¤šæ¡ä»¶å’Œæˆå‘˜æŸ¥è¯¢æ•ˆç‡ä¸€æ ·çš„</span></span><br><span class="line"></span><br><span class="line">5ã€#è”åˆæŸ¥è¯¢     æ•ˆç‡æœ€é«˜ è”åˆæŸ¥è¯¢ï¼Œä»–æ‰«æè¡¨çš„æ–¹å¼æ˜¯ï¼š...</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> CountryCode=<span class="string">&#x27;CHN&#x27;</span> union all <span class="keyword">select</span> * from city <span class="built_in">where</span> CountryCode=<span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line"></span><br><span class="line">6ã€#èŒƒå›´æŸ¥è¯¢ &gt;ã€&lt;ã€=ã€!=ã€&gt;=ã€&lt;=</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> <span class="built_in">id</span>&lt;10;</span><br><span class="line"></span><br><span class="line">7ã€#æ¨¡ç³ŠæŸ¥è¯¢</span><br><span class="line">sroot@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> CountryCode like <span class="string">&#x27;%H%&#x27;</span>; <span class="comment">#åªè¦å¸¦Hçš„å°±å¯ä»¥ï¼Œä¸ç®¡Håœ¨å‰é¢è¿˜æ˜¯åé¢ï¼Œ%ä¸å ä½</span></span><br><span class="line"><span class="string">&#x27;%H&#x27;</span>  ç»“å°¾</span><br><span class="line"><span class="string">&#x27;H%&#x27;</span>  Hå¼€å¤´</span><br><span class="line"></span><br><span class="line">8ã€#æ’åºæŸ¥è¯¢  order by</span><br><span class="line"><span class="comment">#æŸ¥è¯¢CountryCodeå¸¦Hçš„ï¼ŒæŒ‰äººå£æ•°é‡æ’åº  é»˜è®¤æ­£åº</span></span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode like <span class="string">&#x27;%H%&#x27;</span> order by Population;</span><br><span class="line"><span class="comment">#å€’åº</span></span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">where</span> countrycode like <span class="string">&#x27;%H%&#x27;</span> orfer by Population desc;</span><br><span class="line"></span><br><span class="line">ä»¥classé™åºæŸ¥è¯¢Studentè¡¨çš„æ‰€æœ‰è®°å½•ã€‚</span><br><span class="line"><span class="keyword">select</span> * from stu1 order by class desc;</span><br><span class="line"></span><br><span class="line">ä»¥snoå‡åºã€marké™åºæŸ¥è¯¢Scoreè¡¨çš„æ‰€æœ‰è®°å½•</span><br><span class="line"><span class="keyword">select</span> * from score order by sno,mark desc;</span><br><span class="line"></span><br><span class="line">9ã€#åˆ†é¡µæŸ¥è¯¢</span><br><span class="line">äº¬ä¸œ  ä¸€é¡µå•†å“60ä¸ªï¼Œå¦‚æœæŠŠæ‰€æœ‰å•†å“åŠ è½½å‡ºæ¥ï¼Œè‚¯å®šä¸è¡Œï¼Œæ‰€ä»¥äº¬ä¸œå±•ç¤ºå•†å“çš„æ—¶å€™æ˜¯ä½¿ç”¨äº†åˆ†é¡µæŸ¥è¯¢</span><br><span class="line"><span class="keyword">select</span> * from city <span class="built_in">limit</span> 60,60 ;  </span><br><span class="line"><span class="keyword">select</span> * from city <span class="built_in">limit</span> 120,60;</span><br><span class="line"><span class="keyword">select</span> * from city <span class="built_in">limit</span> 180,60;</span><br><span class="line">å†™å˜é‡è‡ªå¢60ï¼Œæ‰€ä»¥ä¸€é¡µå•†å“æ˜¾ç¤º60ä¸ª</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å‰10ä¸ªæ•°æ®</span></span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">limit</span> 10; æŸ¥çœ‹å‰10ä¸ªæ•°æ®  20 å°±æ˜¯æŸ¥çœ‹20ä¸ª</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from city <span class="built_in">limit</span> 1;</span><br><span class="line">+----+-------+-------------+----------+------------+</span><br><span class="line">| ID | Name  | CountryCode | District | Population |</span><br><span class="line">+----+-------+-------------+----------+------------+</span><br><span class="line">|  1 | åŸå¸‚å | å›½å®¶ä»£ç      | çœ       |    æ€»äººå£æ•° |</span><br><span class="line">+----+-------+-------------+----------+------------+</span><br><span class="line"><span class="comment">#åˆ†ç»„æŸ¥è¯¢ group by  å…ˆäº†è§£å‡½æ•°</span></span><br><span class="line">MySQLè‡ªå¸¦çš„å‡½æ•°ï¼š</span><br><span class="line">password()</span><br><span class="line">now()</span><br><span class="line">distinct()</span><br><span class="line"><span class="comment">#group by + èšåˆå‡½æ•°   èšåˆå‡½æ•°ç§ç±»ï¼š</span></span><br><span class="line">max()ï¼šæœ€å¤§å€¼</span><br><span class="line">min()ï¼šæœ€å°å€¼</span><br><span class="line">avg()ï¼šå¹³å‡å€¼</span><br><span class="line"><span class="built_in">sum</span>()ï¼šæ±‚å’Œ</span><br><span class="line">count()ï¼šç»Ÿè®¡æœ‰å‡ è¡Œæ•°æ®</span><br><span class="line"><span class="comment">#å£è¯€</span></span><br><span class="line">1ã€é‡åˆ°ç»Ÿè®¡æƒ³å‡½æ•°</span><br><span class="line">2ã€å½¢å®¹è¯å‰group by</span><br><span class="line">3ã€å‡½æ•°ä¸­å¤®æ˜¯åè¯</span><br><span class="line">4ã€åˆ—å<span class="keyword">select</span>åæ·»åŠ </span><br><span class="line"></span><br><span class="line">10ã€#ç»Ÿè®¡ä¸–ç•Œä¸Šæ¯ä¸ªå›½å®¶çš„æ€»äººå£æ•°æ®</span><br><span class="line">åˆ†æï¼šæˆ‘è¦çš„æ˜¯å›½å®¶ã€äººå£æ•° è¿™ä¸¤ä¸ªå­—æ®µ</span><br><span class="line">1ã€é‡åˆ°ç»Ÿè®¡æƒ³å‡½æ•°        <span class="built_in">sum</span>()</span><br><span class="line">2ã€å½¢å®¹è¯å‰group by     <span class="string">&#x27;å›½å®¶çš„&#x27;</span>æ˜¯å½¢å®¹è¯ ..çš„  ..çš„   group by CountryCode</span><br><span class="line">3ã€å‡½æ•°ä¸­å¤®æ˜¯åè¯        <span class="built_in">sum</span>(Population)  å½¢å®¹è¯åé¢æ˜¯åè¯ï¼Œæ‰€ä»¥åè¯å°±æ˜¯<span class="string">&quot;æ€»äººå£æ•°&quot;</span></span><br><span class="line">4ã€åˆ—å<span class="keyword">select</span>åæ·»åŠ      å›½å®¶ã€äººå£æ•° è¿™ä¸¤ä¸ªå­—æ®µï¼š<span class="keyword">select</span> CountryCode Population</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> CountryCode,<span class="built_in">sum</span>(Population) from city group by CountryCode;</span><br><span class="line"></span><br><span class="line">11ã€#ç»Ÿè®¡ä¸­å›½å„ä¸ªçœçš„äººå£æ•°é‡</span><br><span class="line">åˆ†æï¼šæˆ‘è¦çš„æ˜¯å›½å®¶ã€çœã€äººå£æ•° è¿™3ä¸ªå­—æ®µ</span><br><span class="line">1ã€é‡åˆ°ç»Ÿè®¡æƒ³å‡½æ•°       <span class="built_in">sum</span>()</span><br><span class="line">2ã€å½¢å®¹è¯å‰group by    group by District</span><br><span class="line">3ã€å‡½æ•°ä¸­å¤®æ˜¯åè¯       <span class="built_in">sum</span>(Population)</span><br><span class="line">4ã€åˆ—å<span class="keyword">select</span>åæ·»åŠ     <span class="keyword">select</span> CountryCode District <span class="built_in">sum</span>(Population)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> CountryCode,District,<span class="built_in">sum</span>(Population) from city <span class="built_in">where</span> CountryCode=<span class="string">&#x27;CHN&#x27;</span> group by District;</span><br><span class="line"></span><br><span class="line">12ã€#ç»Ÿè®¡æ¯ä¸ªå›½å®¶çš„åŸå¸‚æ•°é‡  </span><br><span class="line">1ã€é‡åˆ°ç»Ÿè®¡æƒ³å‡½æ•°        count()</span><br><span class="line">2ã€å½¢å®¹è¯å‰group by     group by CountryCode</span><br><span class="line">3ã€å‡½æ•°ä¸­å¤®æ˜¯åè¯        count(Name)</span><br><span class="line">4ã€åˆ—å<span class="keyword">select</span>åæ·»åŠ      <span class="keyword">select</span> CountryCode,count(Name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> CountryCode,count(Name) from city group by CountryCode order by count(Name);</span><br><span class="line"></span><br><span class="line">13ã€#ç»Ÿæ¯ä¸ªå›½å®¶çš„æ¯ä¸ªçœçš„åŸå¸‚æ•°é‡(ç»ƒä¹ )</span><br><span class="line">1ã€é‡åˆ°ç»Ÿè®¡æƒ³å‡½æ•°         count()</span><br><span class="line">2ã€å½¢å®¹è¯å‰group by      group by CountryCode,District å½¢å®¹è¯å›½å®¶çš„,çœçš„</span><br><span class="line">3ã€å‡½æ•°ä¸­å¤®æ˜¯åè¯         count(Name)</span><br><span class="line">4ã€åˆ—å<span class="keyword">select</span>åæ·»åŠ </span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> CountryCode,District,count(Name) from city group by CountryCode,District order by count(Name);</span><br><span class="line"></span><br><span class="line">14ã€#ç»Ÿä¸­å›½çš„æ¯ä¸ªçœçš„åŸå¸‚æ•°é‡(ç»ƒä¹ )</span><br><span class="line">1ã€é‡åˆ°ç»Ÿè®¡æƒ³å‡½æ•°         count()</span><br><span class="line">2ã€å½¢å®¹è¯å‰group by      group by CountryCode,District å½¢å®¹è¯ä¸­å›½çš„,çœçš„</span><br><span class="line">3ã€å‡½æ•°ä¸­å¤®æ˜¯åè¯         count(Name)</span><br><span class="line">4ã€åˆ—å<span class="keyword">select</span>åæ·»åŠ        </span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> CountryCode,District,count(Name) from city <span class="built_in">where</span> CountryCode=<span class="string">&#x27;CHN&#x27;</span> group by CountryCode,District  order by count(Name);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•5ã€MYSQLçš„DDLè¯­å¥</title>
      <link href="/posts/d6548714.html"/>
      <url>/posts/d6548714.html</url>
      
        <content type="html"><![CDATA[<h3 id="MYSQLçš„DDLè¯­å¥">MYSQLçš„DDLè¯­å¥</h3><p><strong>mysqlçš„é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä½œç”¨ï¼šå½±å“æœåŠ¡ç«¯çš„å¯åŠ¨    [server]æ ‡ç­¾</span><br><span class="line">     å½±å“å®¢æˆ·ç«¯çš„è¿æ¥    [client]æ ‡ç­¾</span><br></pre></td></tr></table></figure><p><strong>mysqlå®¢æˆ·ç«¯å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysqlè¿æ¥è¿›æ¥ï¼Œä¸€äº›ç®€åŒ–çš„æ“ä½œï¼š</span></span><br><span class="line">?:æŸ¥çœ‹å¸®åŠ©</span><br><span class="line">\qï¼šquit <span class="built_in">exit</span>  é€€å‡º</span><br><span class="line">\cï¼šç»ˆæ­¢å‘½ä»¤ï¼ŒMySQL5.7 Ctrl + c</span><br><span class="line">\Gï¼šæ ¼å¼åŒ–è¾“å‡º</span><br><span class="line">\sï¼šæŸ¥çœ‹mysqlçš„çŠ¶æ€ </span><br><span class="line">\.ï¼š<span class="built_in">source</span> å¯¼å…¥æ•°æ®</span><br><span class="line">\!ï¼šsystem+ç³»ç»Ÿå‘½ä»¤ </span><br><span class="line">mysql&gt; system <span class="built_in">ls</span> /</span><br><span class="line">app  boot  dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">bin  data  etc  lib   media  opt  root  sbin  sys  usr</span><br><span class="line">mysql&gt; \! vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ¢å¤æ­¥éª¤</span><br><span class="line">1ã€mysql&gt; <span class="built_in">set</span> sql_log_bin=0  å…³é—­äºŒè¿›åˆ¶æ—¥å¿—çš„è®°å½•</span><br><span class="line">2ã€mysql&gt; <span class="built_in">source</span> æ•°æ®çš„è·¯å¾„</span><br><span class="line">          <span class="built_in">source</span> /tmp/mysql.sql</span><br></pre></td></tr></table></figure><p><strong>mysqladminå®¢æˆ·ç«¯å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">1ã€#æ£€æŸ¥mysqlæ˜¯å¦å­˜æ´»</span><br><span class="line">[root@db01 ~]# mysqladmin -uroot -p123 ping</span><br><span class="line">Warning: Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">mysqld is alive   <span class="comment">#å­˜æ´»çš„çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">åœæ­¢mysql</span><br><span class="line">[root@db01 ~]# mysqladmin -uroot -p123 ping</span><br><span class="line">mysqladmin: connect to server at <span class="string">&#x27;localhost&#x27;</span> failed</span><br><span class="line">error: <span class="string">&#x27;Can&#x27;</span>t connect to <span class="built_in">local</span> MySQL server through socket <span class="string">&#x27;/app/mysql-5.6.50/tmp/mysql.sock&#x27;</span> (2)<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Check that mysqld is running and that the socket: &#x27;</span>/app/mysql-5.6.50/tmp/mysql.sock<span class="string">&#x27; exists!  #æœåŠ¡ç«¯åœæ­¢çš„çŠ¶æ€ï¼Œå°±æ˜¯æ‰¾ä¸åˆ°sockæ–‡ä»¶</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2ã€#Zabbixç›‘æ§mysqlæ˜¯å¦å­˜æ´»ï¼Œå¯ä»¥å†™è„šæœ¬</span></span><br><span class="line"><span class="string">[root@db01 ~]# vim check_db.sh</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">db_user=root</span></span><br><span class="line"><span class="string">db_pass=123</span></span><br><span class="line"><span class="string">mysqladmin -u$&#123;db_user&#125; -p$&#123;db_pass&#125;  ping &amp;&gt; /dev/null</span></span><br><span class="line"><span class="string">if [ $? -nq 0 ];then</span></span><br><span class="line"><span class="string">    #ä¸=0ï¼Œå°±æ˜¯ä¸å­˜æ´»ï¼Œå°±echo 0ï¼Œ0ä»£è¡¨ä¸å­˜æ´»</span></span><br><span class="line"><span class="string">    echo 0</span></span><br><span class="line"><span class="string"> else</span></span><br><span class="line"><span class="string">    echo 1</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">æµ‹è¯•ï¼š</span></span><br><span class="line"><span class="string">[root@db01 ~]# /etc/init.d/mysqld stop</span></span><br><span class="line"><span class="string">Shutting down MySQL... SUCCESS! </span></span><br><span class="line"><span class="string">[root@db01 ~]# sh check_db.sh</span></span><br><span class="line"><span class="string">0  #ä¸å­˜æ´»0ä¸ªè¿›ç¨‹</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@db01 ~]# /etc/init.d/mysqld start</span></span><br><span class="line"><span class="string">Starting MySQL. SUCCESS! </span></span><br><span class="line"><span class="string">[root@db01 ~]# sh check_db.sh</span></span><br><span class="line"><span class="string">1  #å­˜æ´»</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3ã€#åœæ­¢mysqlæœåŠ¡</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123 shutdown</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4ã€#æŸ¥çœ‹mysqlé»˜è®¤çš„é…ç½®(å†…ç½®å˜é‡)</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123 variables</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5ã€#åˆ·æ–°mysqçš„bin_logæ—¥å¿—</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123 flush-log</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; show master status;</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">| mysql-bin.000004 |      120 |              |                  |                   |</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">1 row in set (0.01 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; system mysqladmin -uroot -p123 flush-log; #åˆ·æ–°æ—¥å¿—</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; show master status;</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">| mysql-bin.000005 |      120 |              |                  |                   |</span></span><br><span class="line"><span class="string">+------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="string">#åˆ·æ–°ä¹‹åï¼Œå˜æˆ mysql-bin.000005</span></span><br><span class="line"><span class="string">å¦‚æœä¸åˆ·æ–°ï¼Œè¿è¡Œ10å¹´çš„æ—¥å¿—å°±åœ¨ä¸€ä¸ªlogé‡Œé¢ï¼Œæ—¥å¿—å¤ªå¤§</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">6ã€#æŸ¥çœ‹mysqlçš„çŠ¶æ€</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123 status</span></span><br><span class="line"><span class="string">Uptime: 215  Threads: 3  Questions: 31  Slow queries: 0  Opens: 70  Flush tables: 1  Open tables: 63  Queries per second avg: 0.144</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7ã€#åœ¨åº“å¤–åˆ›å»ºåº“å’Œåˆ é™¤åº“  è¿™ä¸ªå‘½ä»¤æ²¡å•¥ç”¨ï¼Œå¦‚æœçœŸæƒ³åœ¨åº“å¤–åˆ›å»ºæˆ–è€…åˆ é™¤ï¼Œå¯ä»¥ç”¨ mysql -e</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123 create aa1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@db01 ~]# mysql -uroot -p123 -e &quot;show databases;&quot;</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string">| Database           |</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string">| information_schema |</span></span><br><span class="line"><span class="string">| aa1                |#åˆ›å»ºæˆåŠŸ</span></span><br><span class="line"><span class="string">| db3306             |</span></span><br><span class="line"><span class="string">| mysql              |</span></span><br><span class="line"><span class="string">| performance_schema |</span></span><br><span class="line"><span class="string">| test               |</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#åœ¨åº“å¤–åˆ åº“</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123 drop aa1</span></span><br><span class="line"><span class="string">Do you really want to drop the &#x27;</span>aa1<span class="string">&#x27; database [y/N] y  #è¾“å…¥y</span></span><br><span class="line"><span class="string">Database &quot;aa1&quot; dropped</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@db01 ~]# mysql -uroot -p123 -e &quot;show databases;&quot;</span></span><br><span class="line"><span class="string">Warning: Using a password on the command line interface can be insecure.</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string">| Database           |</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string">| information_schema |</span></span><br><span class="line"><span class="string">| db3306             |</span></span><br><span class="line"><span class="string">| mysql              |</span></span><br><span class="line"><span class="string">| performance_schema |</span></span><br><span class="line"><span class="string">| test               |</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string">#aa1è¡¨è¢«åˆ é™¤</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">8ã€#é‡æ–°åŠ è½½æ•°æ®åº“(åˆ·æ–°æˆæƒè¡¨)</span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123  reload</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">9ã€#ä¿®æ”¹å¯†ç </span></span><br><span class="line"><span class="string">[root@db01 ~]# mysqladmin -uroot -p123  password &#x27;</span>1234<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>MYSQLç»“æ„åŒ–æŸ¥è¯¢</strong></p><p>å¼€å‘è§„èŒƒï¼š</p><ol><li>åº“ã€è¡¨åä¸èƒ½å¤§å†™,æ•°å­—å¼€å¤´,16ä¸ªå­—ç¬¦ä¸²</li><li>è¡¨åå’Œä¸šåŠ¡æœ‰å…³</li><li>drop è¯­å¥ç¦æ­¢</li><li>é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹</li><li>å¿…é¡»è¦æœ‰ä¸»é”®</li><li>åˆ—å°½é‡éç©ºçº¦æŸ</li><li>å‡å°‘å¤–é”®çº¦æŸ</li><li>å¿…é¡»è®¾ç½®å­˜å‚¨å¼•æ“å’Œå­—ç¬¦é›†</li><li>åˆ—å¿…é¡»è¦æœ‰æ³¨é‡Š</li><li>å¯¹äºéè´Ÿæ•°è®¾ç½®æ•°æ®ç±»å‹çº¦æŸâ€“æ— ç¬¦å·</li></ol><p><strong>SQLè¯­è¨€çš„ç±»å‹</strong></p><p>DDLï¼š(Databases Definition Language)æ•°æ®å®šä¹‰è¯­è¨€</p><p>DMLï¼š(Data Manipulation Language) æ•°æ®æ“ä½œè¯­è¨€</p><p>DCLï¼šDCL(Data Control Language) æ•°æ®æ§åˆ¶è¯­è¨€</p><p>DQL(æœ€éš¾)ï¼š(Database Query Language)æ•°æ®æŸ¥è¯¢è¯­è¨€</p><p>DTL ï¼š(Transaction Control Language) äº‹åŠ¡æ§åˆ¶è¯­è¨€  å­˜å‚¨å¼•æ“çš„Â·ï¼Œæ“ä½œäº‹ç‰©çš„è¯­å¥</p><p><strong>DDLï¼š(Databases Definition Language)æ•°æ®å®šä¹‰è¯­è¨€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ã€DDL(Data Define Language) æ•°æ®å®šä¹‰è¯­è¨€</span><br><span class="line">åŒ…æ‹¬ CREATEã€DROPã€ALTER ç­‰å¯¹æ•°æ®åº“æ•°æ®ç»“æ„è¿›è¡Œæ“ä½œçš„è¯­è¨€</span><br><span class="line"></span><br><span class="line">äºŒã€DML(Data Manipulation Language) æ•°æ®æ“ä½œè¯­è¨€</span><br><span class="line">åŒ…æ‹¬ INSERTã€DELETEã€UPDATE ç­‰å¯¹æ•°æ®åº“æ•°æ®è¿›è¡Œæ“ä½œçš„è¯­è¨€</span><br><span class="line"></span><br><span class="line">ä¸‰ã€DQL(Data Query Language) æ•°æ®æŸ¥è¯¢è¯­è¨€</span><br><span class="line">ä½¿ç”¨ SELECT å¯¹æ•°æ®è¿›è¡ŒæŸ¥è¯¢çš„è¯­è¨€</span><br><span class="line"></span><br><span class="line">å››ã€DCL(Data Control Language) æ•°æ®æ§åˆ¶è¯­è¨€</span><br><span class="line">åŒ…æ‹¬ GRANTã€REVOKE æ•°æ®åº“æƒé™è®¾ç½®è¯­è¨€</span><br><span class="line"></span><br><span class="line">äº”ã€TCL(Transaction Control Language) äº‹åŠ¡æ§åˆ¶è¯­è¨€</span><br><span class="line">åŒ…æ‹¬ COMMITã€ROLLBACKã€SAVEPOINT ç­‰å¯¹æ•°æ®åº“äº‹åŠ¡è¿›è¡Œæ“ä½œçš„è¯­è¨€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ¥æ”¶ç”¨æˆ·çš„SQLè¯­å¥</span><br><span class="line">1.ä»€ä¹ˆæ˜¯SQL</span><br><span class="line">ç»“æ„åŒ–çš„æŸ¥è¯¢è¯­å¥</span><br><span class="line"></span><br><span class="line">2.SQLçš„ç§ç±»</span><br><span class="line">DDLï¼šæ•°æ®å®šä¹‰è¯­è¨€</span><br><span class="line"></span><br><span class="line">åº“å¯¹è±¡ï¼šåº“åå­—ã€åº“å±æ€§</span><br><span class="line">å¼€å‘è§„èŒƒï¼šåº“åå°å†™</span><br><span class="line"></span><br><span class="line">åˆ›å»ºåº“ï¼šcreate database|schema   åº“åä¸èƒ½å¤§å†™,å› ä¸ºmysqlçš„ç‰©ç†ç»“æ„æ˜¯ï¼šæœ€åº•å±‚çš„æ•°æ®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysqlå®¢æˆ·ç«¯æ˜¾ç¤ºæ‰€åœ¨è·¯å¾„(æ‰€åœ¨åº“)</span></span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">...</span><br><span class="line">lower_case_table=1  <span class="comment">#å¿½ç•¥å¤§å°å†™</span></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºæ‰€åœ¨è·¯å¾„åœ¨å®¢æˆ·ç«¯æ ‡ç­¾ä¸­æ·»åŠ </span></span><br><span class="line">[client]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d \\r:\\m:\\s&gt; &quot;</span>     <span class="comment">#\\r:\\m:\\sè¿™ä¸ªæ˜¯æ˜¾ç¤ºæ—¶é—´ï¼Œä¸æƒ³è¦å¯ä»¥åˆ é™¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•ï¼šæ˜¾ç¤ºæ‰€åœ¨è¡¨ï¼Œå½“å‰ç”¨æˆ·ï¼Œä¸»æœºåŸŸ</span></span><br><span class="line">[root@db01 ~]# mysql -uroot -p123</span><br><span class="line">root@localhost:(none) 01:45:01&gt; use mysql;</span><br><span class="line">root@localhost:mysql 01:45:24&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db01 ~]# mysql -urep -p123</span><br><span class="line">rep@localhost:(none) 01:47:41&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1ã€åº“çš„æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###############å¢ï¼šcreate</span></span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">help</span> create database;</span><br><span class="line"><span class="comment">#è¯­æ³• Syntax:</span></span><br><span class="line">CREATE &#123;DATABASE | SCHEMA&#125; [IF NOT EXISTS] db_name</span><br><span class="line">create database åº“åå­—;</span><br><span class="line">create schema åº“åå­—;</span><br><span class="line"><span class="comment">#åˆ›å»ºçš„é€‰é¡¹</span></span><br><span class="line">create_option: [DEFAULT] &#123;</span><br><span class="line">    CHARACTER SET [=] charset_name <span class="comment">#æŒ‡å®šå­—ç¬¦é›†</span></span><br><span class="line">  | COLLATE [=] collation_name   <span class="comment">#æŒ‡å®šå­—ç¬¦é›†çš„æ ¡éªŒè§„åˆ™</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">1ã€åˆ›å»ºæ•°æ®åº“</span><br><span class="line">root@localhost:(none) &gt; create database aaa;</span><br><span class="line"></span><br><span class="line">2ã€å¦‚æœaaaåº“å­˜åœ¨ï¼Œå°±ä¸åˆ›å»ºï¼Œè€Œä¸”ä¸æŠ¥é”™</span><br><span class="line">root@localhost:(none) &gt; create database <span class="keyword">if</span> not exists aaa;</span><br><span class="line"></span><br><span class="line">3ã€åˆ›å»ºåº“çš„æ—¶å€™æ·»åŠ å­—ç¬¦é›†</span><br><span class="line">root@localhost:(none) &gt; create database bbb character utf8;</span><br><span class="line">æŸ¥çœ‹å­—ç¬¦é›†</span><br><span class="line">root@localhost:(none) &gt; show create database bbb;</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| Database | Create Database                                              |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| bbb      | CREATE DATABASE `bbb` /*!40100 DEFAULT CHARACTER SET utf8 */ |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">4ã€äºŒè¿›åˆ¶å®‰è£…çš„é»˜è®¤å­—ç¬¦é›†æ˜¯latin</span><br><span class="line">mysql&gt; show create database <span class="built_in">test</span>;</span><br><span class="line">+---------+---------------------------------------------------------------+</span><br><span class="line">| Database| Create Database                                                 </span><br><span class="line">+---------+---------------------------------------------------------------+</span><br><span class="line">| <span class="built_in">test</span>    |CREATE DATABASE `<span class="built_in">test</span>` /*!40100 DEFAULT CHARACTER SET latin1 */|</span><br><span class="line">+---------+---------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">5ã€#å¦‚æœè¦ä¿®æ”¹é»˜è®¤çš„å­—ç¬¦é›†ï¼Œå°±è¦ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">æŸ¥çœ‹å…¨éƒ¨å­—ç¬¦é›†</span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%char%&#x27;</span>;</span><br><span class="line">+--------------------------+-----------------------------------+</span><br><span class="line">| Variable_name            | Value                             |</span><br><span class="line">+--------------------------+-----------------------------------+</span><br><span class="line">| character_set_client     | utf8                              |</span><br><span class="line">| character_set_connection | utf8                              |</span><br><span class="line">| character_set_database   | latin1                            |</span><br><span class="line">| character_set_filesystem | binary                            |</span><br><span class="line">| character_set_results    | utf8                              |</span><br><span class="line">| character_set_server     | latin1                            |</span><br><span class="line">| character_set_system     | utf8                              |</span><br><span class="line">| character_sets_dir       | /app/mysql-5.6.50/share/charsets/ |</span><br><span class="line">+--------------------------+-----------------------------------+</span><br><span class="line"><span class="comment">#ä¿®æ”¹å­—ç¬¦é›†</span></span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line">character_set_server=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹ä¹‹åé‡å¯mysql</span></span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysql </span><br><span class="line">mysql&gt; create database b1;</span><br><span class="line">mysql&gt; show create database b1;</span><br><span class="line">+----------+-------------------------------------------------------------+</span><br><span class="line">| Database | Create Database                                             |</span><br><span class="line">+----------+-------------------------------------------------------------+</span><br><span class="line">| b1       | CREATE DATABASE `b1` /*!40100 DEFAULT CHARACTER SET utf8 */ |</span><br><span class="line">+----------+-------------------------------------------------------------+</span><br><span class="line">ç°åœ¨åˆ›å»ºåº“é»˜è®¤å°±æ˜¯utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å­—ç¬¦é›†çš„æ ¡éªŒè§„åˆ™</span></span><br><span class="line">root@localhost:(none) &gt; show  collation;</span><br><span class="line"></span><br><span class="line">6ã€åˆ›å»ºåº“çš„æ—¶å€™æŒ‡å®šæ ¡éªŒè§„åˆ™å’Œå­—ç¬¦é›†</span><br><span class="line">root@localhost:(none) &gt; create database [<span class="keyword">if</span> not exists] zls123 charset utf8 collate utf8_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">#################åˆ ï¼šdrop</span></span><br><span class="line">root@localhost:(none) &gt; drop database bbb;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœå­˜åœ¨ï¼Œå°±åˆ é™¤</span></span><br><span class="line">root@localhost:(none) &gt; drop database <span class="keyword">if</span> exists bbb;</span><br><span class="line"></span><br><span class="line"><span class="comment">#############æ”¹:alter</span></span><br><span class="line">åº“åå­—ä¸èƒ½æ”¹ï¼Œä¸€èˆ¬éƒ½æ˜¯æ”¹åº“çš„å­—ç¬¦é›†ã€æ ¡éªŒè§„åˆ™</span><br><span class="line">1ã€æ›´æ”¹åº“çš„å­—ç¬¦é›†</span><br><span class="line">root@localhost:(none) &gt; alter database aaa charset latin5;</span><br><span class="line"></span><br><span class="line">2ã€æ›´æ”¹åº“æ ¡éªŒè§„åˆ™ï¼Œä¸€èˆ¬å’Œå­—ç¬¦é›†ä¸€èµ·æ”¹</span><br><span class="line">root@localhost:(none) &gt; alter database aaa charset utf8 collate utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="comment">###############æŸ¥(DQL)</span></span><br><span class="line">1ã€æŸ¥çœ‹æ•°æ®åº“</span><br><span class="line">root@localhost:(none) &gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| aaa                |</span><br><span class="line">| bbb                |</span><br><span class="line">| db3306             |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| <span class="built_in">test</span>               |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><p>2ã€è¡¨çš„æ“ä½œ</p><p>æ•°æ®ç±»å‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ•°å­—ç±»å‹</span></span><br><span class="line">init :   æ•´å‹      -2^31~2^31   -2147483648 ~ 2147483647</span><br><span class="line">tinyint: æœ€å°æ•´å‹  -128~127    ä¸€èˆ¬ç”¨æ¥å­˜<span class="string">&quot;å¹´é¾„&quot;</span> æ— ç¬¦å·ï¼š0-255</span><br><span class="line"><span class="built_in">float</span>ï¼š  æµ®ç‚¹æ•°  å•ç²¾åº¦</span><br><span class="line">doubleï¼š æµ®ç‚¹æ•° åŒç²¾åº¦</span><br><span class="line"></span><br><span class="line"><span class="comment">#å­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line">char:å®šé•¿å­—ç¬¦ä¸²         char(3)  å¼ ä¸‰ï¼Œå­˜2ä¸ªä¹Ÿæ˜¯å 3ä¸ªå­—ç¬¦ è¿™ä¸ªä¸€èˆ¬ç”¨æ¥å­˜<span class="string">&quot;æ‰‹æœºå·&quot;</span>ï¼Œ<span class="string">&quot;èº«ä»½è¯å·&quot;</span>char(18)</span><br><span class="line">varcharï¼šå˜é•¿å­—ç¬¦ä¸²     varchar(3) æœ€é•¿å­˜3ä¸ªï¼Œä¸€èˆ¬ç”¨æ¥å­˜åå­—</span><br><span class="line">enumï¼šæšä¸¾              enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>)  enum(<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>) ä¸€èˆ¬ç”¨æ¥é€‰æ‹©</span><br><span class="line">ä¸€ä¸ªä¸­æ–‡å 3ä¸ªå­—èŠ‚</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ—¶é—´ç±»å‹</span></span><br><span class="line">timestamp:æ—¶é—´æˆ³ç±»å‹ï¼Œç±»å‹çš„å€¼èŒƒå›´ä»1970-01-01 00:00:01 UTCåˆ° 2038-01-19 03:14:07UTC <span class="comment">#ä¸€èˆ¬ä¸ç”¨è¿™ç§æ—¶é—´ç±»å‹</span></span><br><span class="line">datetime:æ—¶é—´  ç±»å‹çš„å€¼èŒƒå›´ä»1000-01-01 00:00:00åˆ° 9999-12-31 23:59:59</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¸¸ç”¨çš„çº¦æŸ</span></span><br><span class="line">NULL ï¼šå¯ä»¥ä¸ºç©º</span><br><span class="line">NOT NULLï¼šä¸èƒ½ä¸ºç©ºï¼Œéç©º</span><br><span class="line">defaultï¼šé»˜è®¤å€¼</span><br><span class="line">primary keyï¼šä¸»é”® ç‰¹ç‚¹ï¼šå”¯ä¸€  ä¸”  éç©ºï¼Œæ„æ€æ˜¯è¿™ä¸ªå­—æ®µçš„æ•°æ®å¿…é¡»çš„å¡«ï¼Œä¸èƒ½é‡å¤ï¼Œä¸€èˆ¬ä¸»é”®é…åˆauto_increment:è‡ªå¢  ä½¿ç”¨  </span><br><span class="line">ä¸€å¼ è¡¨åªèƒ½è®¾ç½®ä¸€ä¸ªä¸»é”®ï¼Œä¸èƒ½è®¾ç½®å¤šä¸ªï¼Œä¸»é”®çš„å¥½å¤„å°±æ˜¯è®©æŸ¥è¯¢é€Ÿåº¦æ›´å¿«</span><br><span class="line"></span><br><span class="line">nuique keyï¼šå”¯ä¸€é”®ï¼Œå”¯ä¸€ï¼Œä½†å¯ä»¥ä¸ºç©º</span><br><span class="line">unsingnedï¼šæ— ç¬¦å·  å¯ä»¥ç†è§£ä¸ºéè´Ÿæ•°ï¼Œ<span class="string">&quot;å¹´é¾„&quot;</span>çš„çº¦æŸï¼Œå°±ä¸èƒ½å†™è´Ÿæ•°</span><br><span class="line">zerofill: 0å¡«å†² ä¸€èˆ¬å’Œintæ­é…ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">commentï¼šæ³¨é‡Š</span><br></pre></td></tr></table></figure><p>æ“ä½œè¡¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¢ï¼šåˆ›å»ºè¡¨</span></span><br><span class="line">1ã€åœ¨studentåº“é‡Œåˆ›å»ºå­¦ç”Ÿè¡¨stu1ï¼š<span class="built_in">id</span> å­¦å·,name åå­—,age å¹´é¾„ï¼Œgender æ€§åˆ«,phone æ‰‹æœºå·,comr_time å…¥å­¦æ—¶é—´</span><br><span class="line">root@localhost:(none) &gt; create database student;</span><br><span class="line">root@localhost:(none) &gt; use student;</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; create table stu1(<span class="built_in">id</span> int,name varchar(10),age tinyint,gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>),phone char(11),come_time datetime);</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹è¡¨</span><br><span class="line">root@localhost:student &gt; show tables;</span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_student |</span><br><span class="line">+-------------------+</span><br><span class="line">| stu1              |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">show tables from+è¡¨å  <span class="comment">#ä¸åœ¨è¡¨é‡Œé¢çš„æŸ¥çœ‹æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">3ã€æŸ¥çœ‹è¡¨ç»“æ„</span><br><span class="line">root@localhost:student &gt; desc stu1;</span><br><span class="line">+-----------+---------------+------+-----+---------+-------+</span><br><span class="line">| Field     | Type          | Null | Key | Default | Extra |</span><br><span class="line">+-----------+---------------+------+-----+---------+-------+</span><br><span class="line">| <span class="built_in">id</span>        | int(11)       | YES  |     | NULL    |       |</span><br><span class="line">| name      | varchar(10)   | YES  |     | NULL    |       |</span><br><span class="line">| age       | tinyint(4)    | YES  |     | NULL    |       |</span><br><span class="line">| gender    | enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) | YES  |     | NULL    |       |</span><br><span class="line">| phone     | char(11)      | YES  |     | NULL    |       |</span><br><span class="line">| come_time | datetime      | YES  |     | NULL    |       |</span><br><span class="line">+-----------+---------------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line">4ã€å¾€è¡¨é‡Œé¢æ’å…¥æ•°æ®</span><br><span class="line">root@localhost:student &gt; insert into student.stu1(<span class="built_in">id</span>,name,age,gender,phone,come_time) values(1,<span class="string">&#x27;zhangsan&#x27;</span>,18,<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;12345678901&#x27;</span>,NOW());</span><br><span class="line"></span><br><span class="line">male(ç”·çš„) female(å¥³çš„)</span><br><span class="line">NOW()å½“å‰æ—¶é—´</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ•°æ®</span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from stu1;</span><br><span class="line">+------+----------+------+--------+-------------+---------------------+</span><br><span class="line">| <span class="built_in">id</span>   | name     | age  | gender | phone       | come_time           |</span><br><span class="line">+------+----------+------+--------+-------------+---------------------+</span><br><span class="line">|    1 | zhangsan |   18 | f      | 12345678901 | 2024-08-13 03:25:18 |</span><br><span class="line">+------+----------+------+--------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#è§„èŒƒåŒ–å»ºè¡¨</span></span><br><span class="line">root@localhost:student &gt; create table stu2(</span><br><span class="line">      <span class="built_in">id</span> int primary key auto_increment comment <span class="string">&#x27;å­¦ç”Ÿå­¦å·&#x27;</span>,</span><br><span class="line">      name varchar(10) not null comment <span class="string">&#x27;å­¦ç”Ÿå§“å&#x27;</span>,</span><br><span class="line">      age tinyint unsigned not null comment <span class="string">&#x27;å­¦ç”Ÿå¹´é¾„&#x27;</span>,</span><br><span class="line">      gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) not null default <span class="string">&#x27;m&#x27;</span> comment <span class="string">&#x27;å­¦ç”Ÿæ€§åˆ«&#x27;</span>,</span><br><span class="line">      phone char(11) not null unique key comment <span class="string">&#x27;å­¦æ‰‹æœºå·&#x27;</span>,</span><br><span class="line">      come_time datetime not null default NOW() comment <span class="string">&#x27;å…¥å­¦æ—¶é—´&#x27;</span>);</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">create table stu2(</span><br><span class="line"><span class="built_in">id</span> int primary key auto_increment comment <span class="string">&#x27;å­¦ç”Ÿå­¦å·&#x27;</span>, <span class="comment">#ä¸»é”®+è‡ªå¢</span></span><br><span class="line">name varchar(10) not null comment <span class="string">&#x27;å­¦ç”Ÿå§“å&#x27;</span>,</span><br><span class="line">age tinyint unsigned not null comment <span class="string">&#x27;å­¦ç”Ÿå¹´é¾„&#x27;</span>,   <span class="comment">#æ— ç¬¦å·,ä¸èƒ½å†™è´Ÿæ•°,å…ˆå†™unsigned,å†å†™not null</span></span><br><span class="line">gender enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) not null default <span class="string">&#x27;m&#x27;</span> comment <span class="string">&#x27;å­¦ç”Ÿæ€§åˆ«&#x27;</span>, <span class="comment">#ç»™é»˜è®¤å€¼</span></span><br><span class="line">phone char(11) not null unique key comment <span class="string">&#x27;å­¦ç”Ÿæ‰‹æœºå·&#x27;</span>,    <span class="comment">#å”¯ä¸€</span></span><br><span class="line">come_time datetime not null default NOW() comment <span class="string">&#x27;å…¥å­¦æ—¶é—´&#x27;</span>); <span class="comment">#ç»™é»˜è®¤å€¼</span></span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; desc stu2;</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line">| Field     | Type                | Null | Key | Default           | Extra          |</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line">| <span class="built_in">id</span>        | int(11)             | NO   | PRI | NULL              | auto_increment |</span><br><span class="line">| name      | varchar(10)         | NO   |     | NULL              |                |</span><br><span class="line">| age       | tinyint(3) unsigned | NO   |     | NULL              |                |</span><br><span class="line">| gender    | enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>)       | NO   |     | m                 |                |</span><br><span class="line">| phone     | char(11)            | NO   | UNI | NULL              |                |</span><br><span class="line">| come_time | datetime            | NO   |     | CURRENT_TIMESTAMP |                |</span><br><span class="line">+-----------+---------------------+------+-----+-------------------+----------------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ’å…¥æ•°æ®ï¼Œæœ‰çš„æ˜¯é»˜è®¤å€¼å¯ä»¥ä¸éœ€è¦å†™</span></span><br><span class="line">root@localhost:student &gt; insert into student.stu2(name,age,phone) values(<span class="string">&#x27;lisi&#x27;</span>,20,<span class="string">&#x27;12312312312&#x27;</span>);</span><br><span class="line">root@localhost:student &gt; insert into student.stu2(name,age,phone) values(<span class="string">&#x27;wangwu&#x27;</span>,22,<span class="string">&#x27;12312312355&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ•°æ®</span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from stu2;</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line">| <span class="built_in">id</span> | name   | age | gender | phone       | come_time           |</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line">|  1 | lisi   |  20 | m      | 12312312312 | 2024-08-13 04:19:56 |</span><br><span class="line">|  2 | wangwu |  22 | m      | 12312312355 | 2024-08-13 04:21:46 |</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ³¨é‡Šï¼Œå»ºè¡¨è¯­å¥é‡Œé¢æœ‰</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å»ºè¡¨è¯­å¥</span></span><br><span class="line">root@localhost:student &gt; show create table stu2;</span><br><span class="line">| stu2  | CREATE TABLE `stu2` (</span><br><span class="line">  `<span class="built_in">id</span>` int(11) NOT NULL AUTO_INCREMENT COMMENT <span class="string">&#x27;å­¦ç”Ÿå­¦å·&#x27;</span>,</span><br><span class="line">  `name` varchar(10) NOT NULL COMMENT <span class="string">&#x27;å­¦ç”Ÿå§“å&#x27;</span>,</span><br><span class="line">  `age` tinyint(3) unsigned NOT NULL COMMENT <span class="string">&#x27;å­¦ç”Ÿå¹´é¾„&#x27;</span>,</span><br><span class="line">  `gender` enum(<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;m&#x27;</span>) NOT NULL DEFAULT <span class="string">&#x27;m&#x27;</span> COMMENT <span class="string">&#x27;å­¦ç”Ÿæ€§åˆ«&#x27;</span>,</span><br><span class="line">  `phone` char(11) NOT NULL COMMENT <span class="string">&#x27;å­¦æ‰‹æœºå·&#x27;</span>,</span><br><span class="line">  `come_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT <span class="string">&#x27;å…¥å­¦æ—¶é—´&#x27;</span>,</span><br><span class="line">  PRIMARY KEY (`<span class="built_in">id</span>`),</span><br><span class="line">  UNIQUE KEY `phone` (`phone`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ‰§è¡Œå¤±è´¥çš„è¯­å¥ä¹Ÿä¼šè‡ªå¢ï¼Œèƒ½ä¸èƒ½æ’è¿›å»å°±æ˜¯ä½ çš„äº‹ï¼Œä½†æ˜¯ä¸æ’åˆ°è¡¨é‡Œé¢ï¼Œç”Ÿäº§ä¸­ä¸ä¼šå‡ºç°è¿ç»­çš„è‡ªå¢ï¼Œç”¨æˆ·æƒ³åˆ è‡ªå·±çš„æ•°æ®å°±åˆ ï¼Œå¦‚æœæƒ³è¦åœ¨ç”Ÿäº§ä¸­è¿å·ï¼Œå°±éå¸¸ç´¯ï¼Œæ‰€ä»¥ä¸éœ€è¦åœ¨ä¹<span class="built_in">id</span>å·ä¸è¿ç»­</span><br><span class="line">å¦‚æœæŠŠè¡¨é‡Œé¢çš„æ•°æ®å…¨éƒ¨åˆ é™¤ï¼Œå†æ’å…¥æ•°æ®ï¼Œè¿˜æ˜¯ä¹‹å‰çš„åºå·è®°å½•è¿˜æ˜¯åœ¨ï¼Œåºå·ä¸ä¼šä»1å¼€å§‹</span><br></pre></td></tr></table></figure><p>å›¾å½¢åŒ–å·¥å…·(Navicat Premium)å»ºè¡¨</p><p>å·¦ä¸Šè§’  æ–‡ä»¶â€”â€”&gt;æ–°å»ºè¿æ¥â€”â€”&gt;é€‰æ‹©mysqlè¿æ¥çš„æ–¹å¼</p><p><img src="../image/study_img/image-20240812205646797.png" alt="image-20240812205646797"></p><p><img src="../image/study_img/image-20240812205757441.png" alt="image-20240812205757441"></p><p>ç‚¹å‡»æµ‹è¯•è¿æ¥ï¼Œè¿æ¥okæ˜¾ç¤ºç»¿è‰²</p><p><img src="../image/study_img/image-20240812205857192.png" alt="image-20240812205857192"></p><p>å›¾å½¢åŒ–å·¥å…·å»ºç«‹å‡ºæ¥çš„è¡¨</p><p><img src="../image/study_img/image-20240812211405705.png" alt="image-20240812211405705"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»ç»ˆç«¯æŸ¥çœ‹ä½¿ç”¨å›¾å½¢åŒ–åˆ›å»ºçš„è¡¨</span></span><br><span class="line">root@localhost:student &gt; show tables;</span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_student |</span><br><span class="line">+-------------------+</span><br><span class="line">| stu1              |</span><br><span class="line">| stu2              |</span><br><span class="line">| stu3              |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; desc stu3;</span><br><span class="line">+-----------+---------------+------+-----+-------------------+----------------+</span><br><span class="line">| Field     | Type          | Null | Key | Default           | Extra          |</span><br><span class="line">+-----------+---------------+------+-----+-------------------+----------------+</span><br><span class="line">| <span class="built_in">id</span>        | int(11)       | NO   | PRI | NULL              | auto_increment |</span><br><span class="line">| name      | varchar(20)   | NO   |     | NULL              |                |</span><br><span class="line">| age       | tinyint(4)    | NO   |     | NULL              |                |</span><br><span class="line">| gender    | enum(<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;f&#x27;</span>) | NO   |     | m                 |                |</span><br><span class="line">| phone     | char(11)      | NO   | PRI | NULL              |                |</span><br><span class="line">| come_time | datetime      | NO   |     | CURRENT_TIMESTAMP |                |</span><br><span class="line">+-----------+---------------+------+-----+-------------------+----------------+</span><br><span class="line"></span><br><span class="line">è¡¨ä¸­è™½ç„¶çœ‹åˆ°2ä¸ªä¸»é”®ï¼Œå®é™…ä¸Šæ˜¯1ä¸ªä¸»é”®ï¼Œå«åšè”åˆä¸»é”®ï¼Œç›¸å½“äºä¸€ä¸ªä¸»é”®åŒ…å«2ä¸ªå­—æ®µï¼ˆåŒ…å«<span class="built_in">id</span>  phoneå­—æ®µï¼‰</span><br></pre></td></tr></table></figure><p>åˆ è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åˆ </span></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from stu2;                                 </span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line">| <span class="built_in">id</span> | name   | age | gender | phone       | come_time           |</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line">|  1 | lisi   |  20 | m      | 12312312312 | 2024-08-13 04:19:56 |</span><br><span class="line">|  2 | wangwu |  22 | m      | 12312312355 | 2024-08-13 04:21:46 |</span><br><span class="line">|  3 | aaa    |  17 | m      | 12312312366 | 2024-08-13 04:29:08 |</span><br><span class="line">|  4 | bbb    |  24 | m      | 12312312377 | 2024-08-13 04:29:31 |</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line">1ã€åˆ é™¤<span class="built_in">id</span>ä¸º3çš„è¡Œ</span><br><span class="line">root@localhost:student &gt; delete from stu2 <span class="built_in">where</span> <span class="built_in">id</span>=3;</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; <span class="keyword">select</span> * from stu2;</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line">| <span class="built_in">id</span> | name   | age | gender | phone       | come_time           |</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line">|  1 | lisi   |  20 | m      | 12312312312 | 2024-08-13 04:19:56 |</span><br><span class="line">|  2 | wangwu |  22 | m      | 12312312355 | 2024-08-13 04:21:46 |</span><br><span class="line">|  4 | bbb    |  24 | m      | 12312312377 | 2024-08-13 04:29:31 |</span><br><span class="line">+----+--------+-----+--------+-------------+---------------------+</span><br><span class="line"></span><br><span class="line">2ã€åˆ é™¤è¡¨</span><br><span class="line">root@localhost:student &gt; drop table stu100; <span class="comment">#å°†æ–‡ä»¶ä»ç£ç›˜ä¸Šåˆ é™¤ï¼Œç›¸å½“äºrm</span></span><br><span class="line">root@localhost:student &gt;delete table stu100; <span class="comment">#ç›¸å½“äºvim åªèƒ½æŠŠè¡¨é‡Œé¢çš„æ•°æ®æ¸…æ‰ï¼Œä½†è¡¨åè¿˜åœ¨</span></span><br><span class="line"></span><br><span class="line">3ã€åˆ é™¤è¡¨é‡Œé¢çš„å…¨éƒ¨å†…å®¹</span><br><span class="line">root@localhost:student &gt; delete from stu2;  <span class="comment">#å†æ¬¡æ’å…¥æ•°æ®æ—¶,åºå·ä¸æ˜¯ä»1å¼€å§‹</span></span><br><span class="line">root@localhost:student &gt; <span class="built_in">truncate</span> stu1;     <span class="comment">#å†æ¬¡æ’å…¥æ•°æ®æ—¶,åºå·ä»1å¼€å§‹</span></span><br></pre></td></tr></table></figure><p>æ”¹è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ”¹ï¼šalter</span></span><br><span class="line">æ”¹è¡¨éº»çƒ¦ï¼Œé‡Œé¢çš„æ•°æ®ç±»å‹éƒ½éœ€è¦æ”¹</span><br><span class="line"></span><br><span class="line">1ã€#ä¿®æ”¹è¡¨å  rename</span><br><span class="line">root@localhost:student &gt; alter table stu3 rename stu300;</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; show tables;</span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_student |</span><br><span class="line">+-------------------+</span><br><span class="line">| stu1              |</span><br><span class="line">| stu2              |</span><br><span class="line">| stu300            |</span><br><span class="line">+-------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#å¯¹å­—æ®µçš„ä¿®æ”¹  å­—æ®µçš„å¢ã€åˆ ã€æ”¹ã€æŸ¥</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ å­—æ®µï¼šæ·»åŠ ä¸€ä¸ªclasså­—æ®µ    add   (é»˜è®¤æ·»åŠ åœ¨æœ€åé¢)</span></span><br><span class="line">root@localhost:student &gt; alter table stu2 add class varchar(10) not null;</span><br><span class="line">root@localhost:student &gt; desc stu2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ leveå­—æ®µåœ¨nameçš„åé¢ï¼ˆæ·»åŠ åœ¨æŒ‡å®šå­—æ®µåé¢ï¼‰</span></span><br><span class="line">root@localhost:student &gt; alter table stu2 add leve char(5) after name;</span><br><span class="line">root@localhost:student &gt; desc stu2;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ aaaå­—æ®µåœ¨æœ€å‰é¢ï¼ˆå°†å­—æ®µæ·»åŠ åœ¨æœ€å‰é¢ï¼‰</span></span><br><span class="line">root@localhost:student &gt; alter table stu2  add aaa char(3) first;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#åˆ é™¤æŒ‡å®šçš„å­—æ®µ</span><br><span class="line">alter table stu10 drop +å­—æ®µå</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; alter table stu2 drop aaa;</span><br><span class="line">root@localhost:student &gt; alter table stu2 drop leve;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#ä¿®æ”¹å­—æ®µï¼Œä¸¤ç§æ–¹æ³•    modify  change</span><br><span class="line">char(11)ï¼Œæ”¹æˆvarchar(11)</span><br><span class="line"></span><br><span class="line"><span class="comment"># modify(åªèƒ½ä¿®æ”¹å­—æ®µç±»å‹å’Œçº¦æŸ)</span></span><br><span class="line">alter table stu10 modify ä½ è¦æ”¹çš„å­—æ®µå ä½ è¦æ”¹çš„ç±»å‹</span><br><span class="line"></span><br><span class="line">root@localhost:student &gt; alter table stu2 modify phone varchar(11);</span><br><span class="line"></span><br><span class="line"><span class="comment">#change(å¯ä»¥ä¿®æ”¹å­—æ®µç±»å‹å’Œçº¦æŸã€å­—æ®µå)</span></span><br><span class="line">alter table stu2 change æ—§å­—æ®µ æ–°å­—æ®µ æ–°å­—æ®µçš„ç±»å‹;</span><br><span class="line">root@localhost:student &gt; alter table stu2 change <span class="built_in">id</span> ID varchar(11);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•2ã€MYSQLçš„ç»“æ„ä½“ç³»</title>
      <link href="/posts/666852d5.html"/>
      <url>/posts/666852d5.html</url>
      
        <content type="html"><![CDATA[<h3 id="MYSQLçš„ç»“æ„ä½“ç³»">MYSQLçš„ç»“æ„ä½“ç³»</h3><p><strong>å®¢æˆ·ç«¯æœåŠ¡å™¨æ¨¡å‹</strong></p><p>C/Sç»“æ„çš„æœåŠ¡</p><p><img src="../image/study_img/image-20240808095924000.png" alt="image-20240808095924000"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysqlçš„å®¢æˆ·ç«¯</span><br><span class="line"></span><br><span class="line">mysqldump</span><br><span class="line">mysqladmin</span><br><span class="line">mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.mysqlæ˜¯ä¸€ä¸ªå…¸å‹çš„C/SæœåŠ¡ç»“æ„</span><br><span class="line">Â  1.1 mysqlè‡ªå¸¦çš„å®¢æˆ·ç«¯ç¨‹åºï¼ˆ/application/mysql/binï¼‰</span><br><span class="line">Â  Â  mysql</span><br><span class="line">Â  Â  mysqladmin</span><br><span class="line">Â  Â  mysqldump</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">1.2 mysqldä¸€ä¸ªäºŒè¿›åˆ¶ç¨‹åºï¼Œåå°çš„å®ˆæŠ¤è¿›ç¨‹</span><br><span class="line">Â  å•è¿›ç¨‹</span><br><span class="line">Â  å¤šçº¿ç¨‹</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">MySQLè¿æ¥æ–¹å¼</span><br><span class="line">Â  TCP/IPçš„è¿æ¥æ–¹å¼</span><br><span class="line">Â  åˆ—å¦‚ï¼šmysql -uroot -p123 -h172.16.1.51</span><br><span class="line">Â  Socketè¿æ¥</span><br><span class="line">Â  åˆ—å¦‚ï¼šmysql -uroot -p123  -S /tmp/mysql.scoket</span><br><span class="line">Â  </span><br><span class="line">Â  \så¯ä»¥çœ‹ä»–æ˜¯ä»€ä¹ˆè¿æ¥æ–¹å¼</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123 <span class="comment">#Socketè¿æ¥</span></span><br><span class="line">mysql -uroot -p123 -h172.16.1.51 <span class="comment">#TCP/IPçš„è¿æ¥æ–¹å¼</span></span><br><span class="line">mysql -uroot -p123 -hlocalhost#Socketè¿æ¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------é”™è¯¯å†™æ³•ï¼Œä½†ä¹Ÿæ˜¯TCPè¿æ¥----</span><br><span class="line">mysql -uroot -p123 -h172.16.1.51 -S /tmp/mysql.scoket</span><br><span class="line">mysql -uroot -p123 -S /tmp/mysql.scoket -h172.16.1.51</span><br></pre></td></tr></table></figure><p><strong>MYSQLæœåŠ¡å™¨æ„æˆ</strong></p><p>MYSQLæœåŠ¡ï¼šå®ˆæŠ¤è¿›ç¨‹</p><p>å®ä¾‹ï¼šä¸€ä¸ªè¿›ç¨‹+ä¸€ä¸ªçº¿ç¨‹+ä¸€ä¸ªé¢„åˆ†é…çš„å†…å­˜ç»“æ„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@db03 mysql-5.7.44]# mysqladmin -uroot -p123 variables|grep innodb_buffer_pool_size</span><br><span class="line">mysqladmin: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line"><span class="comment">#å¾—åˆ°mysqlçš„å†…å­˜é…ç½®</span></span><br><span class="line">| innodb_buffer_pool_size                                  | 134217728 </span><br><span class="line"></span><br><span class="line">MYSQLçš„å†…å­˜è¦å ç‰©ç†æœºå†…å­˜çš„75%~80%</span><br><span class="line"></span><br><span class="line">æ¯”è¾ƒå¤§ï¼Œå¯ä»¥æ›´æ”¹ä¸€ä¸‹ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db04 mysql-5.7.44]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">......</span><br><span class="line">innodb_buffer_pool_size=512M    <span class="comment">#è®¾ç½®mysqlå¯åŠ¨èµ·æ¥,å ç”¨ç‰©ç†æœº512M</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœç”¨ansibleæ¨é€é…ç½®æ–‡ä»¶ï¼Œå†…å­˜é‚£é‡Œè¦å†™å˜é‡</span></span><br><span class="line">innodb_buffer_pool_size = &#123;&#123; (ansible_memtotal_mb * 0.8)|init &#125;&#125;M</span><br><span class="line">ä¸èƒ½æœ‰å°æ•°ç‚¹,é…ç½®æ–‡ä»¶é‡Œé¢æœ‰å¸¦å°æ•°ç‚¹ï¼Œmysqlå°±èµ·ä¸æ¥</span><br></pre></td></tr></table></figure><p><strong>mysqlçš„åº•å±‚åŸç†</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åº•å±‚åˆ†ä¸º3å±‚  è¿æ¥å±‚  SQLå±‚  å­˜å‚¨å¼•æ“å±‚</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240808114234093.png" alt="image-20240808114234093"></p><p>è¿æ¥å±‚ä½œç”¨ï¼š</p><p>1ã€æä¾›2ç§è¿æ¥æ–¹å¼</p><ul><li>TCPè¿æ¥</li><li>Socketè¿æ¥</li></ul><p>2ã€éªŒè¯ç”¨æˆ·çš„åˆæ³•æ€§ï¼ˆç”¨æˆ·å  å¯†ç   IP   æƒé™ï¼‰</p><p>3ã€æä¾›ä¸€ä¸ªäºSQLå±‚äº¤äº’çš„çº¿ç¨‹</p><p>SQLå±‚ä½œç”¨ï¼š<br>1ã€æ¥æ”¶è¿æ¥å±‚ä¼ é€’è¿‡æ¥çš„SQLè¯­å¥<br>2ã€éªŒè¯è¯­æ³•<br>3ã€éªŒè¯è¯­ä¹‰ï¼šå°±æ˜¯éªŒè¯ä½ æ˜¯è¦å¢åˆ æ”¹æŸ¥  DDL DML  DCL DQL DTL<br>4ã€å‘½ä»¤è§£é‡Šå™¨ ï¼šè§£æè¾“å…¥çš„SQLè¯­å¥<br>5ã€ä¼˜åŒ–å™¨ï¼šç®€å•çš„ä¼˜åŒ–SQLè¯­å¥<br>6ã€æ‰§è¡Œå™¨ï¼šæ‰§è¡Œä¼˜åŒ–å™¨é€‰æ‹©çš„æœ€ä¼˜ä¸€ç§æ–¹å¼çš„è¯­å¥<br>æä¾›ä¸€ä¸ªå’Œå­˜å‚¨å¼•æ“å±‚äº¤äº’çš„çº¿ç¨‹<br>æ¥æ”¶å­˜å‚¨å¼•æ“å±‚è¿”å›çš„ç»“æ„åŒ–æˆè¡¨çš„æ•°æ®<br>7ã€ç¼“å­˜<br>8ã€è®°å½•æ—¥å¿—ï¼ˆbinlogï¼‰</p><p>å­˜å‚¨å¼•æ“å±‚ä½œç”¨<br>1ã€æ¥æ”¶SQLå±‚ä¼ é€’è¿‡æ¥çš„sqlè¯­å¥<br>2ã€äºç£ç›˜äº¤äº’å–å‡ºæŒ‡å®šçš„æ•°æ®<br>3ã€å°†æ•°æ®ç»“æ„åŒ–æˆè¡¨è¿”å›ç»™SQLå±‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@db03 mysql-5.7.44]# mysql -uroot -p123 -e <span class="string">&#x27;show databases;&#x27;</span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.   <span class="comment">#è¿™è¡Œä¸æ˜¯æ ‡å‡†è¾“å‡ºï¼Œä¹Ÿä¸æ˜¯é”™è¯¯è¾“å‡ºï¼Œè¿™ä¸ªè¾“å‡ºä¸æ˜¯è¿™æ¡å‘½ä»¤ç»™çš„ï¼Œæ˜¯å»ä¸æ‰çš„</span></span><br><span class="line"></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |#å…ƒæ•°æ®åº“ï¼Œå†…å­˜åº“ï¼Œåœ¨ç£ç›˜ä¸Šçœ‹ä¸åˆ°ï¼Œä»–æ˜¯åŠ è½½åœ¨å†…å­˜é‡Œçš„</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><p><strong>MySQLçš„ç»“æ„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MySQLçš„2ç§ç»“æ„</span><br><span class="line">é€»è¾‘ç»“æ„ï¼ˆç†Ÿæ‚‰ï¼‰</span><br><span class="line">ç‰©ç†ç»“æ„</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">MySQLçš„é€»è¾‘ç»“æ„ï¼šæ•°æ®åº“ç®¡ç†äººå‘˜æˆ–è€…å¼€å‘äººå‘˜å¯æ“ä½œçš„å¯¹è±¡</span><br><span class="line">1ã€åº“ã€è¡¨(å…ƒæ•°æ®+çœŸå®æ•°æ®è¡Œ)  å…ƒæ•°æ®æ˜¯ï¼šå­—æ®µå+å­—æ®µçš„æè¿°ä¿¡æ¯....</span><br><span class="line">å­—æ®µåˆåˆ†ä¸ºå­—æ®µåï¼Œæ•°æ®ç±»å‹ï¼Œçº¦æŸ</span><br><span class="line"></span><br><span class="line">3ã€å…ƒæ•°æ®ï¼šåˆ—+å…¶å®ƒå±æ€§ï¼ˆè¡Œæ•°+å ç”¨ç©ºé—´å¤§å°+æƒé™ï¼‰</span><br><span class="line">4ã€åˆ—ï¼šåˆ—åå­—+æ•°æ®ç±»å‹+å…¶ä»–çº¦æŸï¼ˆéç©ºã€å”¯ä¸€ã€ä¸»é”®ã€éè´Ÿæ•°ã€è‡ªå¢é•¿ã€é»˜è®¤å€¼ï¼‰</span><br><span class="line"></span><br><span class="line">MYSQLçš„ç‰©ç†ç»“æ„ï¼šæœ€åº•å±‚çš„æ•°æ®æ–‡ä»¶</span><br><span class="line">1ï¼‰MySQLçš„æœ€åº•å±‚çš„ç‰©ç†ç»“æ„æ˜¯æ•°æ®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­˜å‚¨å¼•æ“å±‚ï¼Œæ‰“äº¤é“çš„æ–‡ä»¶ï¼Œæ˜¯æ•°æ®æ–‡ä»¶ã€‚</span><br><span class="line">2ï¼‰å­˜å‚¨å¼•æ“åˆ†ä¸ºå¾ˆå¤šç§ç±»ï¼ˆLinuxä¸­çš„FSï¼‰</span><br><span class="line">3ï¼‰ä¸åŒå­˜å‚¨å¼•æ“çš„åŒºåˆ«ï¼šå­˜å‚¨æ–¹å¼ã€å®‰å…¨æ€§ã€æ€§èƒ½</span><br></pre></td></tr></table></figure><p><strong>mysqlçš„å•ä½</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ®µã€åŒºã€é¡µï¼ˆå—ï¼‰</span><br><span class="line"></span><br><span class="line">1ã€æ®µ(ä¸€å¼ è¡¨)ï¼šç†è®ºä¸Šä¸€ä¸ªè¡¨å°±æ˜¯ä¸€ä¸ªæ®µï¼Œç”±å¤šä¸ªåŒºæ„æˆï¼Œï¼ˆåˆ†åŒºè¡¨æ˜¯ä¸€ä¸ªåˆ†åŒºä¸€ä¸ªæ®µï¼‰</span><br><span class="line">2ã€åŒºï¼šä¸€ä¸ªåŒºç”±è¿ç»­çš„å¤šä¸ªé¡µæ„æˆ  ï¼ˆ1Mï¼‰</span><br><span class="line">3ã€é¡µï¼šä¸€ä¸ªé¡µæœ€å°çš„æ•°æ®å­˜å‚¨å•å…ƒï¼Œé»˜è®¤æ˜¯16k     blockæ²¡å æ»¡çš„åŒºåŸŸå«è„æ•°æ®</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1ã€#æœ‰çš„æ•°æ®åº“å®‰è£…ä¹‹åï¼Œä¼šç”Ÿæˆç©ºç”¨æˆ·</span><br><span class="line">mysql&gt;  <span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | 127.0.0.1 |</span><br><span class="line">| root | ::1       |</span><br><span class="line">|      | db02      |</span><br><span class="line">| root | db02      |</span><br><span class="line">|      | localhost |</span><br><span class="line">| root | localhost |</span><br><span class="line">+------+-----------+</span><br><span class="line"></span><br><span class="line">2ã€#ä½¿ç”¨ç©ºç”¨æˆ·è¿æ¥ï¼Œä¹Ÿå¯ä»¥è¿æ¥ï¼Œè¿™äº›æ˜¯éå¸¸å±é™©çš„å­˜åœ¨</span><br><span class="line">[root@db02 ~]# mysql -u<span class="string">&#x27;&#x27;</span> -hlocalhost</span><br><span class="line"></span><br><span class="line">3ã€æŠŠç©ºç”¨æˆ·åˆ é™¤</span><br><span class="line">mysql&gt; drop user root@<span class="string">&#x27;::1&#x27;</span>;</span><br><span class="line">mysql&gt; drop user <span class="string">&#x27;&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™æ¡å‘½ä»¤è™½ç„¶ä¹Ÿå¯ä»¥åˆ é™¤ï¼Œä½†æ˜¯ä¸èƒ½ç”¨ï¼Œä»–ä¼šæŠŠrootç”¨æˆ·ä¹Ÿåˆ é™¤ï¼ŒçŸ¥é“æœ‰è¿™ä¸ªå‘½ä»¤å°±è¡Œäº†ï¼Œä¸è¦å»æ‰§è¡Œåˆ é™¤mysql&gt;  truncate mysql.user;   å·kingç‰¹</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ä¼ä¸šä¸­è¯¯åˆ é™¤äº†rootç”¨æˆ·ï¼Œæ€ä¹ˆè§£å†³</span><br><span class="line"></span><br><span class="line">1ã€å…ˆåœæ­¢æœåŠ¡</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld stop</span><br><span class="line"></span><br><span class="line">2ã€è·³è¿‡æˆæƒè¡¨ï¼Œå¿½ç•¥ç½‘ç»œè¿æ¥å»å¯åŠ¨æ•°æ®åº“</span><br><span class="line">[root@db01 ~]# mysqld_safe --skip-grant-tables --skip-networking</span><br><span class="line"></span><br><span class="line">3ã€ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ç™»é™†mysqlï¼Œæ— éœ€å¯†ç </span><br><span class="line">[root@db01 ~]# mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€é‡æ–°æ·»åŠ rootç”¨æˆ·</span><br><span class="line"><span class="comment">#æ–¹æ³•ä¸€:é‡æ–°æ·»åŠ rootç”¨æˆ·  æ²¡æœ‰ç»™rootç”¨æˆ·è®¾ç½®å¯†ç </span></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; insert into user <span class="built_in">set</span> user=<span class="string">&#x27;root&#x27;</span>,ssl_cipher=<span class="string">&#x27;&#x27;</span>,x509_issuer=<span class="string">&#x27;&#x27;</span>,x509_subject=<span class="string">&#x27;&#x27;</span>;update user <span class="built_in">set</span> Host=<span class="string">&#x27;localhost&#x27;</span>,select_priv=<span class="string">&#x27;y&#x27;</span>, insert_priv=<span class="string">&#x27;y&#x27;</span>,update_priv=<span class="string">&#x27;y&#x27;</span>, Alter_priv=<span class="string">&#x27;y&#x27;</span>,delete_priv=<span class="string">&#x27;y&#x27;</span>,create_priv=<span class="string">&#x27;y&#x27;</span>,drop_priv=<span class="string">&#x27;y&#x27;</span>,reload_priv=<span class="string">&#x27;y&#x27;</span>,shutdown_priv=<span class="string">&#x27;y&#x27;</span>,Process_priv=<span class="string">&#x27;y&#x27;</span>,file_priv=<span class="string">&#x27;y&#x27;</span>,grant_priv=<span class="string">&#x27;y&#x27;</span>,References_priv=<span class="string">&#x27;y&#x27;</span>,index_priv=<span class="string">&#x27;y&#x27;</span>,create_user_priv=<span class="string">&#x27;y&#x27;</span>,show_db_priv=<span class="string">&#x27;y&#x27;</span>,super_priv=<span class="string">&#x27;y&#x27;</span>,create_tmp_table_priv=<span class="string">&#x27;y&#x27;</span>,Lock_tables_priv=<span class="string">&#x27;y&#x27;</span>,execute_priv=<span class="string">&#x27;y&#x27;</span>,repl_slave_priv=<span class="string">&#x27;y&#x27;</span>,repl_client_priv=<span class="string">&#x27;y&#x27;</span>,create_view_priv=<span class="string">&#x27;y&#x27;</span>,show_view_priv=<span class="string">&#x27;y&#x27;</span>,create_routine_priv=<span class="string">&#x27;y&#x27;</span>,alter_routine_priv=<span class="string">&#x27;y&#x27;</span>,create_user_priv=<span class="string">&#x27;y&#x27;</span>,event_priv=<span class="string">&#x27;y&#x27;</span>,trigger_priv=<span class="string">&#x27;y&#x27;</span>,create_tablespace_priv=<span class="string">&#x27;y&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;                                   </span><br><span class="line">+------+-----------+</span><br><span class="line">| user | host      |</span><br><span class="line">+------+-----------+</span><br><span class="line">| root | localhost |</span><br><span class="line">+------+-----------+</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–¹æ³•äºŒï¼šåˆ·æ–°æˆæƒè¡¨  ç„¶åæˆ‘ç»™rootè®¾ç½®çš„å¯†ç æ˜¯123</span></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; grant all on *.* to root@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span> with grant option;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€æŸ¥çœ‹æƒé™</span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from mysql.user\G;</span><br><span class="line"></span><br><span class="line">6ã€é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•1ã€MySQLç®€ä»‹åŠå®‰è£…</title>
      <link href="/posts/fb2c21f2.html"/>
      <url>/posts/fb2c21f2.html</url>
      
        <content type="html"><![CDATA[<h3 id="MySQLç®€ä»‹åŠå®‰è£…"><strong>MySQLç®€ä»‹åŠå®‰è£…</strong></h3><p>ä»€ä¹ˆæ˜¯æ•°æ®?<br>æ•°æ®(data)æ˜¯äº‹å®æˆ–è§‚å¯Ÿçš„ç»“æœï¼Œæ˜¯å¯¹å®¢è§‚äº‹ç‰©çš„é€»è¾‘å½’çº³ï¼Œæ˜¯ç”¨äºè¡¨ç¤ºå®¢è§‚äº‹ç‰©çš„æœªç»åŠ å·¥çš„çš„åŸå§‹ç´ æã€‚<br>æ•°æ®å¯ä»¥æ˜¯è¿ç»­çš„å€¼ï¼Œæ¯”å¦‚å£°éŸ³ã€å›¾åƒï¼Œç§°ä¸ºæ¨¡æ‹Ÿæ•°æ®ã€‚ä¹Ÿå¯ä»¥æ˜¯ç¦»æ•£çš„ï¼Œå¦‚ç¬¦å·ã€æ–‡å­—ï¼Œç§°ä¸ºæ•°å­—æ•°æ®ã€‚<br>åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæ•°æ®ä»¥äºŒè¿›åˆ¶ä¿¡æ¯å•å…ƒ0,1çš„å½¢å¼è¡¨ç¤ºã€‚</p><p>æ•°æ®çš„å®šä¹‰: æ•°æ®æ˜¯æŒ‡å¯¹å®¢è§‚äº‹ä»¶è¿›è¡Œè®°å½•å¹¶å¯ä»¥é‰´åˆ«çš„ç¬¦å·ï¼Œæ˜¯å¯¹å®¢è§‚äº‹ç‰©çš„æ€§è´¨ã€çŠ¶æ€ä»¥åŠç›¸äº’å…³ç³»ç­‰è¿›è¡Œè®°è½½çš„ç‰©ç†ç¬¦å·æˆ–è¿™äº›ç‰©ç†ç¬¦å·çš„ç»„åˆã€‚å®ƒæ˜¯å¯è¯†åˆ«çš„ã€æŠ½è±¡çš„ç¬¦å·ã€‚*</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5.6  5.7  ç‰ˆæœ¬æ˜¯å¸‚é¢ä¸Šç”¨å¾—æœ€å¤šçš„ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">linuxä¸­æ•°æ®å‚¨å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿé‡Œé¢</span><br><span class="line">å°†ä»£ç çš„æ•°æ®æ ¼å¼è½¬æ¢ä¸ºJSONæ ¼å¼ï¼šå«åºåˆ—åŒ–</span><br><span class="line">å°†ä»£ç æ¥æ”¶åˆ°çš„JSONæ ¼å¼çš„æ•°æ®åï¼Œè½¬åŒ–æˆè‡ªå·±çš„ä»£ç ï¼Œå«ï¼šååºåˆ—åŒ–</span><br></pre></td></tr></table></figure><p><strong>æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç±»å‹</strong></p><ul><li><p>å…³ç³»å‹æ•°æ®åº“ RDBMS</p><p>æ‰€æœ‰çš„è¡¨éƒ½æ˜¯æœ‰äºŒç»´è¡¨ç»„æˆ</p><p>è¡¨ä¸è¡¨ä¹‹é—´æœ‰å…³è”</p><p>ä½¿ç”¨SQLï¼ˆç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼‰è¯­å¥æ¥ç®¡ç†</p></li><li><p>éå…³ç³»å‹æ•°æ®åº“</p><p>ä¸éœ€è¦ä½¿ç”¨SQLè¯­å¥ï¼Œæ²¡æœ‰äºŒç»´è¡¨</p></li></ul><p><strong>å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»å‹æ•°æ®åº“å¸¸è§çš„åº”ç”¨</strong></p><p>å…³ç³»å‹ï¼šMySQLã€mariadbã€Oracleã€PostgreSQLã€MMSQL<br>éå…³ç³»å‹ï¼šRdis(é”®å€¼å¯¹)ã€MongDB(æ–‡æ¡£å‹æ•°æ®åº“)ã€elasticsearch(æœç´¢å¼•æ“æ•°æ®åº“)ã€memcache(é”®å€¼å¯¹)</p><p>InfluxDB/OpenTSDB:Time Series æ—¶åºæ•°æ®åº“(é€‚åˆå‡ºå›¾ï¼ŒæŸ¥è¯¢æ—¶é—´è½´æ•°æ®æ–¹ä¾¿)<br>etcdï¼šé”®å€¼å¯¹æ•°æ®åº“(é…ç½®æ–‡ä»¶ç®¡ç†ä¸­å¿ƒ,æ‰€æœ‰çš„webè¿åˆ°ä»–ï¼Œå°±å¯ä»¥è¯»å–é…ç½®)</p><p>JAVAç¨‹åºï¼Œæœ‰è‡ªå·±çš„ç®¡ç†ä¸­å¿ƒzookeeperï¼Œæ­é…kafkaä½¿ç”¨</p><h3 id="MySQLå®‰è£…æ–¹å¼"><strong>MySQLå®‰è£…æ–¹å¼</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1. rpmã€yumå®‰è£…ï¼šå®‰è£…æ–¹ä¾¿ã€å®‰è£…é€Ÿåº¦å¿«ï¼Œæ— æ³•å®šåˆ¶</span><br><span class="line">Â </span><br><span class="line">2. äºŒè¿›åˆ¶ï¼šä¸éœ€è¦å®‰è£…ï¼Œè§£å‹å³å¯ä½¿ç”¨ï¼Œä¸èƒ½å®šåˆ¶åŠŸèƒ½</span><br><span class="line">Â </span><br><span class="line">3. ç¼–è¯‘å®‰è£…</span><br><span class="line">Â  3.1 å¯å®šåˆ¶ï¼Œå®‰è£…æ…¢</span><br><span class="line">Â  3.2 å››ä¸ªæ­¥éª¤ï¼š</span><br><span class="line">Â  Â  3.2.1 è§£å‹ï¼ˆtarï¼‰</span><br><span class="line">Â  Â  3.2.2 ç”Ÿæˆï¼ˆ./configureï¼‰cmake</span><br><span class="line">Â  Â  3.2.3 ç¼–è¯‘ï¼ˆmakeï¼‰</span><br><span class="line">Â  Â  3.2.4 å®‰è£…ï¼ˆmake installï¼‰</span><br><span class="line">Â  3.3Â  5.5ç‰ˆæœ¬ä¹‹å‰ï¼štar ./configure make make install</span><br><span class="line">Â  3.4Â  5.5ç‰ˆæœ¬ä¹‹åï¼šcmake gmake</span><br><span class="line">Â </span><br><span class="line">4. å…ˆç¼–è¯‘ï¼Œç„¶åå®šåˆ¶rpmåŒ…ï¼Œåˆ¶ä½œyumä»“åº“ï¼Œç„¶åyumå®‰è£…</span><br><span class="line">Â  4.1 ç®€å•ï¼Œé€Ÿåº¦å¿«ï¼Œå¯å®šåˆ¶ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œåˆ¶ä½œæ—¶é—´æé•¿</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">5. ä¼ä¸šä¸­é€‰æ‹©çš„å®‰è£…æ–¹å¼</span><br><span class="line">Â  5.1 ä¸­å°å‹ä¼ä¸šï¼šä»¥ä¸Šæ–¹å¼éƒ½å¯ä»¥ï¼Œè¿ç»´åå‘ç¼–è¯‘ï¼Œdbaåå‘äºŒè¿›åˆ¶ è¿ç»´ä¹Ÿåå‘äºŒè¿›åˆ¶</span><br><span class="line">Â  5.2 å¤§å‹ä¼ä¸šï¼šå¯ä»¥é€‰æ‹©: å…ˆç¼–è¯‘ç„¶åå®šåˆ¶rpmåŒ…ï¼Œåˆ¶ä½œyumä»“åº“ï¼Œç„¶åyumå®‰è£…</span><br><span class="line">Â  </span><br><span class="line">6. dockerå®¹å™¨</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½Mysqlå®‰è£…åŒ…"><strong>ä¸‹è½½Mysqlå®‰è£…åŒ…</strong></h3><p><a href="https://www.mysql.com/">https://www.mysql.com/</a></p><p><img src="../image/study_img/image-20240807105637146.png" alt="image-20240807105637146"></p><p><img src="../image/study_img/image-20240807105944871.png" alt="image-20240807105944871"></p><p><img src="../image/study_img/image-20240807110117554.png" alt="image-20240807110117554"></p><p><img src="../image/study_img/image-20240807150422738.png" alt="image-20240807150422738"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MYSQLç‰ˆæœ¬é€‰æ‹©çš„æ½œè§„åˆ™</span></span><br><span class="line">MYSQL5.6ï¼šGA 6-12ä¸ªæœˆï¼Œå°±æ˜¯ä»–å‘å¸ƒåˆ°ç°åœ¨ä½ çš„å…·ä½“æ—¶é—´ï¼Œè¿‡äº†å¤šä¹…ï¼Œé€‰æ‹©åœ¨6-12ä¸ªæœˆå†…ï¼Œå°ç‰ˆæœ¬å·ä¸ºå¶æ•°çš„</span><br><span class="line"></span><br><span class="line">MySQL5.7ï¼šGA 6-12ä¸ªæœˆï¼Œå°ç‰ˆæœ¬å·ä¸ºå¶æ•°ç‰ˆçš„ï¼Œ5.7.20ä»¥ä¸Šç‰ˆæœ¬ï¼ˆMGRæ˜¯MySQLè‡ªå¸¦çš„é«˜å¯ç”¨åŠŸèƒ½ï¼‰</span><br></pre></td></tr></table></figure><p><strong>æ–¹å¼ä¸€ï¼šæºç å®‰è£…mysql5.6</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">1ã€#è§£å‹</span><br><span class="line">[root@db01 ~]# <span class="built_in">mkdir</span> /app</span><br><span class="line">[root@db01 ~]# tar xf mysql-5.6.50.tar.gz </span><br><span class="line"></span><br><span class="line">2ã€#æºç å®‰è£…éœ€è¦cmakeå‘½ä»¤ã€ä¾èµ–</span><br><span class="line">[root@db01 ~]# yum -y install cmake  openssl-devel ncurses-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€#ç”Ÿæˆï¼Œéœ€è¦å…ˆåŠ å…¥å·¥ä½œç›®å½•</span><br><span class="line">[root@db01 ~]# <span class="built_in">cd</span> mysql-5.6.50/</span><br><span class="line"></span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/app/mysql-5.6.50 \</span><br><span class="line">-DMYSQL_DATADIR=/app/mysql-5.6.50/data \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/app/mysql-5.6.50/tmp/mysql.sock \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DWITH_EXTRA_CHARSETS=all \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_ZLIB=bundled \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line">-DENABLE_DOWNLOADS=1 \</span><br><span class="line">-DWITH_DEBUG=0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŒ‡å®šç¼–è¯‘å¥½çš„ç¨‹åºå­˜æ”¾ä½ç½®</span></span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/app/mysql-5.6.50 \</span><br><span class="line"><span class="comment">#æ•°æ®å­˜æ”¾ä½ç½®</span></span><br><span class="line">-DMYSQL_DATADIR=/app/mysql-5.6.50/data \</span><br><span class="line"><span class="comment">#socketæ–‡ä»¶å­˜æ”¾ä½ç½®</span></span><br><span class="line">-DMYSQL_UNIX_ADDR=/app/mysql-5.6.50/tmp/mysql.sock \</span><br><span class="line"><span class="comment">#ä½¿ç”¨utf8å­—ç¬¦é›†</span></span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line"><span class="comment">#æ ¡éªŒè§„åˆ™</span></span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line"><span class="comment">#ä½¿ç”¨å…¶ä»–é¢å¤–çš„å­—ç¬¦é›†</span></span><br><span class="line">-DWITH_EXTRA_CHARSETS=all \</span><br><span class="line"><span class="comment">#æ”¯æŒçš„å­˜å‚¨å¼•æ“</span></span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line"><span class="comment">#ç¦ç”¨çš„å­˜å‚¨å¼•æ“</span></span><br><span class="line">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \</span><br><span class="line"><span class="comment">#å¯ç”¨zlibåº“æ”¯æŒï¼ˆzibã€gzibç›¸å…³ï¼‰</span></span><br><span class="line">-DWITH_ZLIB=bundled \</span><br><span class="line"><span class="comment">#å¯ç”¨SSLåº“æ”¯æŒï¼ˆå®‰å…¨å¥—æ¥å±‚ï¼‰</span></span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line"><span class="comment">#å¯ç”¨æœ¬åœ°æ•°æ®å¯¼å…¥æ”¯æŒ</span></span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line"><span class="comment">#ç¼–è¯‘åµŒå…¥å¼æœåŠ¡å™¨æ”¯æŒ</span></span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line"><span class="comment"># mysql5.6æ”¯æŒäº†googleçš„c++mockæ¡†æ¶äº†ï¼Œå…è®¸ä¸‹è½½ï¼Œå¦åˆ™ä¼šå®‰è£…æŠ¥é”™ã€‚</span></span><br><span class="line">-DENABLE_DOWNLOADS=1 \</span><br><span class="line"><span class="comment">#ç¦ç”¨debugï¼ˆé»˜è®¤ä¸ºç¦ç”¨ï¼‰</span></span><br><span class="line">-DWITH_DEBUG=0</span><br><span class="line"></span><br><span class="line">å¦‚æœcmakeå¤±è´¥ï¼Œè¯·å°†CMakeCache.txtç¼“å­˜ç§»é™¤</span><br><span class="line">4ã€#ç¼–è¯‘ã€å®‰è£…</span><br><span class="line">[root@db01 mysql-5.6.50]# make &amp;&amp; make insatll</span><br><span class="line"></span><br><span class="line">5ã€åˆ›å»ºmysqlç¨‹åºç”¨æˆ·</span><br><span class="line">[root@db01 ~]# useradd mysql -s /sbin/nologin -M</span><br><span class="line"></span><br><span class="line">6ã€#ä¿®æ”¹MySQLçš„é…ç½®æ–‡ä»¶åˆ°åªç•™ä¸‹[mysqld]æ ‡ç­¾</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">7ã€#æ‹·è´å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@db01 ~]# <span class="built_in">cp</span> /app/mysql-5.6.50/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">8ã€#å¯åŠ¨</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld start</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240807151940351.png" alt="image-20240807151940351"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">9ã€#è§£å†³åŠæ³•ï¼Œå®‰è£…perlæ¨¡å—ï¼Œå†åˆå§‹åŒ–MYSQL    ä¸è¦å®‰è£…perl-devel,è¿™é‡Œé¢æ˜¯perlçš„æ‰€æœ‰æ¨¡å—ï¼Œè¿™æ ·è£…çš„æ¨¡å—å¤ªå¤šäº†ï¼Œåªéœ€è¦å®‰è£…autoconfè¿™ä¸ªæ¨¡å—</span><br><span class="line">[root@db01 ~]# yum -y install autoconf</span><br><span class="line">[root@db01 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰¾åˆ°2ä¸ªokï¼Œå°±åˆå§‹åŒ–å®Œæˆäº†</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">10ã€#å†æ¬¡å¯åŠ¨  è¿˜æ˜¯æŠ¥é”™</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.Logging to <span class="string">&#x27;/app/mysql-5.6.50/data/db01.err&#x27;</span>.</span><br><span class="line">240807 23:35:33 mysqld_safe Directory <span class="string">&#x27;/app/mysql-5.6.50/tmp&#x27;</span> <span class="keyword">for</span> UNIX socket file don<span class="string">&#x27;t exists.</span></span><br><span class="line"><span class="string"> ERROR! The server quit without updating PID file (/app/mysql-5.6.50/data/db01.pid).</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> #æŠ¥é”™åŸå› :æŒ‡å®šsoketæ–‡ä»¶å­˜æ”¾åœ¨/app/mysql-5.6.50/tmpï¼Œè€Œä¸”å­˜æ”¾soketæ–‡ä»¶çš„ç›®å½•æ²¡æœ‰æƒé™</span></span><br><span class="line"><span class="string"> #è§£å†³åŠæ³•</span></span><br><span class="line"><span class="string">[root@db01 ~]# mkdir /app/mysql-5.6.50/data/db01.err</span></span><br><span class="line"><span class="string">[root@db01 ~]# chown -R mysql.mysql /app</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">11ã€#å†æ¬¡å¯åŠ¨ æˆåŠŸ</span></span><br><span class="line"><span class="string">[root@db01 ~]# /etc/init.d/mysqld start</span></span><br><span class="line"><span class="string">Starting MySQL... SUCCESS! </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">12ã€#æ·»åŠ ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="string">[root@db01 ~]# echo &#x27;</span><span class="built_in">export</span> PATH=<span class="string">&quot;/app/mysql-5.6.50/bin:<span class="variable">$PATH</span>&quot;</span><span class="string">&#x27; &gt; /etc/profile.d/mysql.sh</span></span><br><span class="line"><span class="string">[root@db01 ~]# source /etc/profile</span></span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒï¼šäºŒè¿›åˆ¶å®‰è£…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…</span><br><span class="line">[root@db02 ~]# wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.6.50-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºappç›®å½•ï¼Œå¹¶è§£å‹ï¼Œæ”¹å</span><br><span class="line">[root@db02 ~]# <span class="built_in">mkdir</span> /app</span><br><span class="line">[root@db02 ~]# tar xf mysql-5.6.50-linux-glibc2.12-x86_64.tar.gz -C /app</span><br><span class="line">[root@db02 ~]# <span class="built_in">mv</span> /app/mysql-5.6.50-linux-glibc2.12-x86_64/ /app/mysql-5.6.50</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3ã€åˆ›å»ºmysqlç¨‹åºç”¨æˆ·</span><br><span class="line">[root@db02 ~]# useradd mysql -s /sbin/nologin -M</span><br><span class="line"></span><br><span class="line">4ã€æ‹·è´MySQLçš„é…ç½®æ–‡ä»¶åˆ°etcä¸‹ï¼Œå¹¶æŠŠé…ç½®æ–‡ä»¶å†…çš„æ³¨é‡Šæ¸…é™¤æ‰ï¼Œåªç•™ä¸‹[mysqld]</span><br><span class="line">[root@db02 ~]# \<span class="built_in">cp</span> /app/mysql-5.6.50/support-files/my-default.cnf /etc/my.cnf</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€æ‹·è´å¯åŠ¨è„šæœ¬</span><br><span class="line">[root@db02 ~]# <span class="built_in">cp</span> /app/mysql-5.6.50/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">6ã€åˆå§‹åŒ–MYSQL</span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">FATAL ERROR: please install the following Perl modules before executing /app/mysql-5.6.50/scripts/mysql_install_db:</span><br><span class="line">Data::Dumper</span><br><span class="line"><span class="comment">#æŠ¥é”™ï¼ŒåŸå› ç¼ºå°‘peræ¨¡å—</span></span><br><span class="line">å®‰è£…perlæ¨¡å—</span><br><span class="line">[root@db02 ~]# yum -y install autoconf</span><br><span class="line"></span><br><span class="line"><span class="comment">#å†æ¬¡åˆå§‹åŒ–</span></span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">ok</span><br><span class="line">...</span><br><span class="line">ok</span><br><span class="line">WARNING: Default config file /etc/my.cnf exists on the system</span><br><span class="line">This file will be <span class="built_in">read</span> by default by the MySQL server</span><br><span class="line">If you <span class="keyword">do</span> not want to use this, either remove it, or use the</span><br><span class="line">--defaults-file argument to mysqld_safe when starting the server</span><br><span class="line">æ‰§è¡ŒæˆåŠŸ</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# ll /app/mysql-5.6.50/support-files/</span><br><span class="line">total 32</span><br><span class="line">-rwxr-xr-x 1 7161 31415  1153 Sep 23  2020 binary-configure</span><br><span class="line">-rw-r--r-- 1 7161 31415   773 Sep 23  2020 magic</span><br><span class="line">-rw-r--r-- 1 7161 31415  1126 Sep 23  2020 my-default.cnf#é…ç½®æ–‡ä»¶</span><br><span class="line">-rwxr-xr-x 1 7161 31415  1061 Sep 23  2020 mysqld_multi.server</span><br><span class="line">-rwxr-xr-x 1 7161 31415   894 Sep 23  2020 mysql-log-rotate</span><br><span class="line">-rwxr-xr-x 1 7161 31415 10565 Sep 23  2020 mysql.server#å¯åŠ¨è„šæœ¬</span><br><span class="line"></span><br><span class="line">7ã€å¯åŠ¨mysql</span><br><span class="line"><span class="comment">#å¯åŠ¨æŠ¥é”™ </span></span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start</span><br><span class="line">/etc/init.d/mysqld: line 244: my_print_defaults: <span class="built_in">command</span> not found</span><br><span class="line">/etc/init.d/mysqld: line 264: <span class="built_in">cd</span>: /usr/local/mysql: No such file or directory</span><br><span class="line">Starting MySQL ERROR! Couldn<span class="string">&#x27;t find MySQL server (/usr/local/mysql/bin/mysqld_safe)</span></span><br><span class="line"><span class="string">åŸå› ï¼šäºŒè¿›åˆ¶å®‰è£…çš„mysqlï¼Œmysqlæ²¡æœ‰å®‰è£…åœ¨/usr/local/mysqlç›®å½•ä¸‹</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#è§£å†³æ–¹æ³•ä¸€ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ (æ¨èè¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºåœ¨è¯»å–çš„æ—¶å€™ä¼˜å…ˆè¯»å–é…ç½®æ–‡ä»¶)</span></span><br><span class="line"><span class="string">[root@db02 ~]# vim /etc/my.cnf</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">basedir=/app/mysql-5.6.50</span></span><br><span class="line"><span class="string">datadir=/app/mysql-5.6.50/data</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#è§£å†³æ–¹æ³•äºŒï¼šä¿®æ”¹è„šæœ¬</span></span><br><span class="line"><span class="string">[root@db02 ~]# vim /etc/init.d/mysqld</span></span><br><span class="line"><span class="string">åº•è¡Œæ¨¡å¼è¾“å…¥ï¼š</span></span><br><span class="line"><span class="string">%s#/usr/local/mysql#/app/mysql-5.6.50#g</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#å†æ¬¡å¯åŠ¨ï¼Œå¯åŠ¨æˆåŠŸ</span></span><br><span class="line"><span class="string">[root@db02 ~]# /etc/init.d/mysqld start</span></span><br><span class="line"><span class="string">Starting MySQL.Logging to &#x27;</span>/app/mysql-5.6.50/data/db02.err<span class="string">&#x27;.</span></span><br><span class="line"><span class="string">.... SUCCESS! </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">8ã€ç™»é™†mysql</span></span><br><span class="line"><span class="string">[root@db02 ~]# mysql</span></span><br><span class="line"><span class="string">-bash: mysql: command not found</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æ·»åŠ ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="string">[root@db02 ~]# echo &#x27;</span><span class="built_in">export</span> PATH=<span class="string">&quot;/app/mysql-5.6.50/bin:<span class="variable">$PATH</span>&quot;</span><span class="string">&#x27; &gt; /etc/profile.d/mysql.sh</span></span><br><span class="line"><span class="string">[root@db02 ~]# source /etc/profile</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">9ã€ç™»é™†è¿æ¥æ•°æ®åº“</span></span><br><span class="line"><span class="string">[root@db02 ~]# mysql</span></span><br><span class="line"><span class="string">mysql&gt; show databases;</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string">| Database           |</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string">| information_schema |</span></span><br><span class="line"><span class="string">| mysql              |</span></span><br><span class="line"><span class="string">| performance_schema |</span></span><br><span class="line"><span class="string">| test               |</span></span><br><span class="line"><span class="string">+--------------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è„šæœ¬ä¸èƒ½å†™source /etc/profile  ,ä¼šä¸ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure><p><strong>æºç å®‰è£…MYSQL5.7</strong></p><p>MySQL5.6ä¸MySQL5.7å®‰è£…çš„åŒºåˆ«<br>1ã€cmakeçš„æ—¶å€™åŠ å…¥äº†bostorg<br>2ã€åˆå§‹åŒ–æ—¶ ä½¿ç”¨mysqld --initialize æ›¿ä»£mysql_install_dbï¼Œå…¶å®ƒå‚æ•°æ²¡æœ‰å˜åŒ–ï¼šâ€“user= --basedir= --datadir=<br>3ã€â€“initializeä¼šç”Ÿæˆä¸€ä¸ªä¸´æ—¶å¯†ç </p><p>4ã€è¿˜å¯ä»¥ç”¨å¦å¤–ä¸€ä¸ªå‚æ•°â€“initialize-insecure</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½æºç åŒ…åˆ°rootç›®å½•</span><br><span class="line"><span class="comment">#ä¸‹è½½CGIçš„æ¡†æ¶  æ³¨æ„è¿™ä¸ªä¸‹è½½éå¸¸éå¸¸æ…¢</span></span><br><span class="line">[root@db03 ~]# wget https://downloads.mysql.com/archives/get/p/23/file/mysql-boost-5.7.44.tar.gz</span><br><span class="line"> </span><br><span class="line">[root@db03 ~]# wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.44.tar.gz</span><br><span class="line"></span><br><span class="line">2ã€å®‰è£…ä¾èµ–</span><br><span class="line">[root@db03 mysql-5.7.44]# yum -y install cmake  openssl-devel ncurses-devel autoconf</span><br><span class="line"></span><br><span class="line">3ã€åˆ›å»ºappç›®å½•ï¼Œå¹¶è§£å‹ï¼Œæ”¹å</span><br><span class="line">[root@db03 ~]# <span class="built_in">mkdir</span> /app</span><br><span class="line">[root@db03 ~]# tar xf boost_1_59_0.tar.gz -C /app/</span><br><span class="line">[root@db03 ~]# <span class="built_in">cd</span> mysql-5.7.44/</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”Ÿæˆ  ç¼–è¯‘å®‰è£…mysqlå’Œboost</span></span><br><span class="line">[root@db03 ~]# <span class="built_in">cd</span> /app/mysql-5.7.44/</span><br><span class="line"></span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/app/mysql-5.7.44 \</span><br><span class="line">-DWITH_BOOST=/app/boost_1_59_0/ \</span><br><span class="line">-DMYSQL_DATADIR=/app/mysql-5.7.44/data \</span><br><span class="line">-DMYSQL_UNIX_ADDR=/app/mysql-5.7.44/tmp/mysql.sock \</span><br><span class="line">-DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DWITH_EXTRA_CHARSETS=all \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_ZLIB=bundled \</span><br><span class="line">-DWITH_SSL=system \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line">-DENABLE_DOWNLOADS=1 \</span><br><span class="line">-DWITH_DEBUG=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼–è¯‘å®‰è£…</span></span><br><span class="line">[root@db03 mysql-5.7.44]# make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">4ã€åˆ›å»ºç”¨æˆ·ï¼Œåˆ›å»ºæ•°æ®åº“ç›®å½•</span><br><span class="line">[root@db03 mysql-5.7.44]# useradd mysql -s /sbin/nologin -M</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.7.44</span><br><span class="line">datadir=/app/mysql-5.7.44/data</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# <span class="built_in">cp</span> /app/mysql-5.7.44/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# <span class="built_in">cd</span> /app/mysql-5.7.44/</span><br><span class="line"></span><br><span class="line">5ã€#åˆ›å»ºdataç›®å½•ï¼Œå¹¶æˆäºˆç›¸å…³æƒé™</span><br><span class="line">root@db04 mysql-5.7.44]# <span class="built_in">mkdir</span> &#123;mysql-files,data,tmp&#125;</span><br><span class="line">[root@db04 mysql-5.7.44]# <span class="built_in">chown</span> -R mysql.mysql /app/</span><br><span class="line"></span><br><span class="line">6ã€#åˆå§‹åŒ–æ•°æ®åº“ ç”Ÿæˆä¸€ä¸ªéšæœºå¯†ç </span><br><span class="line">[root@db04 mysql-5.7.44]# /app/mysql-5.7.44/bin/mysqld --initialize --user=mysql --basedir=/app/mysql-5.7.44 --datadir=/app/mysql-5.7.44/data</span><br><span class="line">.....</span><br><span class="line">....</span><br><span class="line">2024-08-07T21:01:19.358769Z 1 [Note] A temporary password is generated <span class="keyword">for</span> root@localhost: XaD%I7h-&amp;laU</span><br><span class="line"></span><br><span class="line">7ã€å¯åŠ¨</span><br><span class="line">[root@db04 mysql-5.7.44]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.Logging to <span class="string">&#x27;/app/mysql-5.7.44/data/db04.err&#x27;</span>.</span><br><span class="line">.. SUCCESS! </span><br><span class="line"></span><br><span class="line">8ã€#æ·»åŠ ç¯å¢ƒå˜é‡</span><br><span class="line">[root@db03 ~]# <span class="built_in">echo</span> <span class="string">&#x27;export PATH=&quot;/app/mysql-5.7.44/bin:$PATH&quot;&#x27;</span> &gt; /etc/profile.d/mysql.sh</span><br><span class="line">[root@db03 ~]# <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">9ã€#ç™»é™†ä½¿ç”¨éšæœºå¯†ç ç™»é™†</span><br><span class="line">[root@db03 mysql-5.7.44]# mysql -uroot -p<span class="string">&#x27;XaD%I7h-&amp;laU&#x27;</span></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</span><br><span class="line"></span><br><span class="line">10ã€#æé†’éœ€è¦é‡æ–°è®¾ç½®å¯†ç </span><br><span class="line">mysql&gt; ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><p><strong>äºŒè¿›åˆ¶å®‰è£…MYSQL5.7</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½äºŒè¿›åˆ¶åŒ…</span><br><span class="line">[root@db04 ~]#  wget https://downloads.mysql.com/archives/get/p/23/file/mysql-5.7.44-linux-glibc2.12-x86_64.tar</span><br><span class="line">è§£å‹å‡ºæ¥æœ‰2ä¸ªåŒ…ï¼Œåˆ é™¤å¸¦<span class="built_in">test</span>çš„åŒ…</span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»º/appï¼Œå¹¶æŠŠè§£å‹åçš„æ–‡ä»¶æ”¾åˆ°/appç›®å½•</span><br><span class="line">[root@db04 ~]# <span class="built_in">mkdir</span> /app</span><br><span class="line">[root@db04 ~]# tar xf mysql-5.7.44-linux-glibc2.12-x86_64.tar.gz  -C /app/</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# <span class="built_in">mv</span> /app/mysql-5.7.44-linux-glibc2.12-x86_64/ /app/mysql-5.7.44</span><br><span class="line"></span><br><span class="line">3ã€#åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€å®šè¦åœ¨è¿è¡Œçš„æ•°æ®åº“ï¼Œæ‹·è´å…¶ä»–æ•°æ®åº“çš„é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db04 ~]# useradd mysql -s /sbin/nologin -M</span><br><span class="line">[root@db04 mysql-5.7.44]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.7.44</span><br><span class="line">datadir=/app/mysql-5.7.44/data</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# <span class="built_in">cp</span> /app/mysql-5.7.44/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# <span class="built_in">cd</span> /app/mysql-5.7.44/</span><br><span class="line"></span><br><span class="line">4ã€#åˆ›å»ºdataç›®å½•ï¼Œå¹¶æˆäºˆç›¸å…³æƒé™</span><br><span class="line">root@db04 mysql-5.7.44]# <span class="built_in">mkdir</span> &#123;mysql-files,data&#125;</span><br><span class="line">[root@db04 mysql-5.7.44]# <span class="built_in">chown</span> -R mysql.mysql /app/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5ã€#åˆå§‹åŒ–æ•°æ®åº“ ç”Ÿæˆä¸€ä¸ªéšæœºå¯†ç </span><br><span class="line">[root@db04 mysql-5.7.44]# /app/mysql-5.7.44/bin/mysqld --initialize --user=mysql --basedir=/app/mysql-5.7.44 --datadir=/app/mysql-5.7.44/data</span><br><span class="line">2024-08-07T17:43:11.896232Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation <span class="keyword">for</span> more details).</span><br><span class="line">2024-08-07T17:43:18.143399Z 0 [Warning] InnoDB: New <span class="built_in">log</span> files created, LSN=45790</span><br><span class="line">2024-08-07T17:43:19.266013Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class="line">2024-08-07T17:43:19.354535Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 88a4a42a-54e4-11ef-8129-000c2961c317.</span><br><span class="line">2024-08-07T17:43:19.358779Z 0 [Warning] Gtid table is not ready to be used. Table <span class="string">&#x27;mysql.gtid_executed&#x27;</span> cannot be opened.</span><br><span class="line">2024-08-07T17:43:20.532115Z 0 [Warning] A deprecated TLS version TLSv1 is enabled. Please use TLSv1.2 or higher.</span><br><span class="line">2024-08-07T17:43:20.532142Z 0 [Warning] A deprecated TLS version TLSv1.1 is enabled. Please use TLSv1.2 or higher.</span><br><span class="line">2024-08-07T17:43:20.540163Z 0 [Warning] CA certificate ca.pem is self signed.</span><br><span class="line">2024-08-07T17:43:20.824069Z 1 [Note] A temporary password is generated <span class="keyword">for</span> root@localhost: ?-h9g5kg9g%K   <span class="comment">#éšæœºå¯†ç </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚æœæ•°æ®åº“å´©æºƒäº†ï¼Œéœ€è¦é‡æ–°åˆå§‹åŒ–ï¼Œå°±è¦<span class="built_in">rm</span> -rf /data ç„¶åå†åˆå§‹åŒ– </span><br><span class="line"></span><br><span class="line">6ã€#å¯åŠ¨</span><br><span class="line">[root@db04 mysql-5.7.44]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL.Logging to <span class="string">&#x27;/app/mysql-5.7.44/data/db04.err&#x27;</span>.</span><br><span class="line">.. SUCCESS! </span><br><span class="line"></span><br><span class="line">7ã€#æ·»åŠ ç¯å¢ƒå˜é‡</span><br><span class="line">[root@db03 ~]# <span class="built_in">echo</span> <span class="string">&#x27;export PATH=&quot;/app/mysql-5.7.44/bin:$PATH&quot;&#x27;</span> &gt; /etc/profile.d/mysql.sh</span><br><span class="line">[root@db03 ~]# <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">8ã€#ç™»é™†ä½¿ç”¨éšæœºå¯†ç ç™»é™†</span><br><span class="line">[root@db04 mysql-5.7.44]# mysql -uroot -p<span class="string">&#x27;?-h9g5kg9g%K&#x27;</span> </span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</span><br><span class="line"></span><br><span class="line">9ã€#æé†’éœ€è¦é‡æ–°è®¾ç½®å¯†ç </span><br><span class="line">mysql&gt; ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨systemdç®¡ç†æ•°æ®åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1ã€æŸ¥çœ‹mysqlçš„æºç”Ÿå¯åŠ¨å‘½ä»¤</span><br><span class="line">[root@db02 ~]# ps -ef |grep mysql</span><br><span class="line">root       9719      1  0 Aug08 pts/0    00:00:00 /bin/sh /app/mysql-5.6.50/bin/mysqld_safe --datadir=/app/mysql-5.6.50/data --pid-file=/app/mysql-5.6.50/data/db01.pid</span><br><span class="line"></span><br><span class="line"><span class="comment">#å°±æ˜¯è¿™ä¸ªå‘½ä»¤</span></span><br><span class="line">/app/mysql-5.6.50/bin/mysqld_safe --datadir=/app/mysql-5.6.50/data --pid-file=/app/mysql-5.6.50/data/db01.pid</span><br><span class="line"></span><br><span class="line">2ã€#æ‹·è´sshdçš„å¯åŠ¨è„šæœ¬ï¼Œå¹¶æ”¹æˆmysqlçš„</span><br><span class="line">[root@db02 ~]# <span class="built_in">cp</span> /usr/lib/systemd/system/&#123;sshd,mysqld&#125;.service</span><br><span class="line">[root@db02 ~]# ll /usr/lib/systemd/system/mysqld.service</span><br><span class="line">-rw-r--r-- 1 root root 373 Aug  8 18:35 /usr/lib/systemd/system/mysqld.service</span><br><span class="line"></span><br><span class="line">3ã€ç¼–è¾‘å¯åŠ¨æ–‡ä»¶</span><br><span class="line">[root@db02 ~]# vim /usr/lib/systemd/system/mysqld.service</span><br><span class="line">[Unit] <span class="comment">#è¿™ä¸ªæ ‡ç­¾çš„ä¿¡æ¯ä¸é‡è¦</span></span><br><span class="line">Description=mysql server</span><br><span class="line">Documentation=man:sshd(8) man:sshd_config(5)</span><br><span class="line">After=network.target sshd-keygen.service</span><br><span class="line">Wants=sshd-keygen.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line"><span class="comment">#å°±ä¿®æ”¹è¿™è¡Œ,æ·»åŠ äº†å¯åŠ¨è„šæœ¬</span></span><br><span class="line">ExecStart=/app/mysql-5.6.50/bin/mysqld_safe --datadir=/app/mysql-5.6.50/data --pid-file=/app/mysql-5.6.50/data/db02.pid</span><br><span class="line">ExecReload=/bin/kill -HUP <span class="variable">$MAINPID</span></span><br><span class="line"><span class="comment">#KillMode=process  #æˆ‘å¦‚æœæ‰“å¼€è¿™è¡Œ,å°±ä¸èƒ½åœæ­¢æœåŠ¡,æˆ‘æ³¨é‡Šæ‰å°±å¯ä»¥åœæ­¢æœåŠ¡äº†,å¦‚æœæ‰“å¼€è¿™è¡Œå¯ä»¥åœæ­¢æœåŠ¡,å°±æ²¡å¿…è¦æ³¨é‡Šæ‰</span></span><br><span class="line">KillMode=killall mysqld</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=42s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’•3ã€MySQLçš„ç®¡ç†</title>
      <link href="/posts/1832714a.html"/>
      <url>/posts/1832714a.html</url>
      
        <content type="html"><![CDATA[<h2 id="MySQLçš„ç®¡ç†">MySQLçš„ç®¡ç†</h2><h3 id="1ã€ç”¨æˆ·ç®¡ç†"><strong>1ã€ç”¨æˆ·ç®¡ç†</strong></h3><p>MySQLç”¨æˆ·çš„ä½œç”¨:<br>1ï¼‰ç™»é™†MySQLæ•°æ®åº“<br>2ï¼‰ç®¡ç†æ•°æ®åº“å¯¹è±¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">MySQLç”¨æˆ·ç®¡ç†ï¼š</span><br><span class="line">1ï¼‰åˆ›å»ºç”¨æˆ·ï¼šcreate user</span><br><span class="line">2ï¼‰åˆ é™¤ç”¨æˆ·ï¼šdelete userï¼Œdrop user</span><br><span class="line">3ï¼‰ä¿®æ”¹ç”¨æˆ·ï¼šupdate</span><br><span class="line"></span><br><span class="line">ç”¨æˆ·çš„å®šä¹‰ï¼š</span><br><span class="line">1) username@<span class="string">&#x27;ä¸»æœºåŸŸ&#x27;</span>  è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·</span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line">+------+-------------+</span><br><span class="line">| user | host        |</span><br><span class="line">+------+-------------+</span><br><span class="line">| root | 127.0.0.1   |</span><br><span class="line">|      | db02        |</span><br><span class="line">| root | db02        |</span><br><span class="line">| root | localhost   |</span><br><span class="line">+------+-------------+</span><br><span class="line"></span><br><span class="line">2ï¼‰ä¸»æœºåŸŸï¼šå¯ä»¥ç†è§£ä¸ºæ˜¯MySQLç™»é™†çš„ç™½åå•</span><br><span class="line"></span><br><span class="line">3ï¼‰ä¸»æœºåŸŸæ ¼å¼ï¼š</span><br><span class="line"><span class="comment">#è¿™3ä¸ªå¸¸ç”¨</span></span><br><span class="line">10.0.0.5%   10.0.0.50~10.0.0.59 10.0.0.5</span><br><span class="line">localhost</span><br><span class="line">10.0.0.%</span><br><span class="line"></span><br><span class="line">10.0.0.51</span><br><span class="line">10.0.%.%</span><br><span class="line">10.%.%.%</span><br><span class="line">%</span><br><span class="line">db01</span><br><span class="line">10.0.0.51/255.255.255.0</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to test1@<span class="string">&#x27;10.0.0.0/24&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">mysql&gt; grant all on *.* to test2@<span class="string">&#x27;10.0.0.0/255.255.255.0&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šä½¿ç”¨IPæˆæƒçš„ç”¨æˆ·ï¼Œç™»é™†æ—¶ï¼Œéƒ½è¦æŒ‡å®šIPå»è¿æ¥</span></span><br><span class="line">mysql&gt; grant all on *.* to asm@<span class="string">&#x27;10.0.0.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line">+------+-------------+</span><br><span class="line">| user | host        |</span><br><span class="line">+------+-------------+</span><br><span class="line">| asm  | 10.0.0.%    |</span><br><span class="line">| <span class="built_in">test</span> | 10.0.0.0/24 |</span><br><span class="line">| root | 127.0.0.1   |</span><br><span class="line">|      | db02        |</span><br><span class="line">| root | db02        |</span><br><span class="line">| root | localhost   |</span><br><span class="line">+------+-------------+</span><br><span class="line">[root@db02 ~]# mysql -uasm -p123 -h10.0.0.52</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å‘½ä»¤å‰é¢åŠ ç©ºæ ¼ï¼Œå†å²çºªå½•ä¸ä¿å­˜</span></span><br><span class="line">vim /etc/profile.d/xxxx.sh</span><br><span class="line">HISTCONTROL=ignorespace</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹ç”¨æˆ·çš„ç®¡ç†å°±æ˜¯ </span></span><br><span class="line">å¢</span><br><span class="line">åˆ </span><br><span class="line">æ”¹</span><br><span class="line">æŸ¥</span><br></pre></td></tr></table></figure><p>å¢ï¼šåˆ›å»ºç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¬¦åˆSQL92æ ‡å‡†çš„ï¼Œå…ˆåˆ›å»ºï¼Œåœ¨grant</span></span><br><span class="line">create user asm@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">grant all on *.* to asm@<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·å¹¶æˆæƒ</span></span><br><span class="line">grant all on *.* to asm@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#insert into è¿™ä¸ªç›¸å½“äºç¼–è¾‘/etc/passwdæ–‡ä»¶å»å¢åŠ ç”¨æˆ·</span></span><br></pre></td></tr></table></figure><p>åˆ ï¼šåˆ é™¤ç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop user asm@<span class="string">&#x27;localhost&#x27;</span>;   <span class="comment">#ç›¸å½“äºuserdel</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç”¨æˆ·å·²è¢«åˆ é™¤</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; delete from mysql.user <span class="built_in">where</span> user=<span class="string">&#x27;asm&#x27;</span> and host=<span class="string">&#x27;localhost&#x27;</span>   <span class="comment">#ç›¸å½“äºvim /etc/passwd</span></span><br></pre></td></tr></table></figure><p>æ”¹ï¼šä¿®æ”¹ç”¨æˆ·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">æ”¹å¯†ç   æ”¹æƒé™  ç»å¸¸ç”¨æ¥æ”¹å¯†ç </span><br><span class="line"></span><br><span class="line"><span class="comment">#æ”¹å¯†ç </span></span><br><span class="line">æ–¹æ³•ä¸€</span><br><span class="line">å‘½ä»¤æç¤ºè¡Œä¸­ä¿®æ”¹</span><br><span class="line">[root@db04 ~]#mysqladmin -uç”¨æˆ·  -p<span class="string">&#x27;æ—§å¯†ç &#x27;</span> password <span class="string">&#x27;æ–°å¯†ç &#x27;</span></span><br><span class="line"></span><br><span class="line">æ–¹æ³•äºŒ  åªæœ‰5.7ä»¥ä¸Šç‰ˆæœ¬ä¸“ç”¨</span><br><span class="line">mysql&gt; alter asm@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">æ–¹æ³•ä¸‰  æ›´æ”¹å½“å‰ç”¨æˆ·çš„å¯†ç  PASSWORDå‡½æ•°åŠ å¯†123</span><br><span class="line">mysql&gt; <span class="built_in">set</span> password=PASSWORD(<span class="string">&#x27;123&#x27;</span>);    </span><br><span class="line"></span><br><span class="line">æ–¹æ³•å››   åªæœ‰ä½¿ç”¨updataeä¿®æ”¹ç”¨æˆ·å¯†ç æ—¶ï¼Œæ‰éœ€è¦æ‰§è¡Œflush privileges</span><br><span class="line"><span class="comment">#MYSQL5.6</span></span><br><span class="line">mysql&gt; updata mysql.user <span class="built_in">set</span> password=PASSWORD(<span class="string">&#x27;123&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;asm&#x27;</span> and host=<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">mysql&gt; flush privileges   <span class="comment">#åˆ·æ–°æˆæƒè¡¨   //å¾ˆå±é™©çš„å‘½ä»¤ï¼Œæ˜¯å…¨å±€çš„SQLè¯­å¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MYSQL5.7</span></span><br><span class="line">mysql&gt; updata mysql.user <span class="built_in">set</span> authentication_string=PASSWORD(<span class="string">&#x27;123&#x27;</span>) <span class="built_in">where</span> user=<span class="string">&#x27;asm&#x27;</span> and host=<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">mysql&gt; flush privileges  </span><br><span class="line"></span><br><span class="line">æ–¹æ³•äº”</span><br><span class="line">mysql&gt; grant all on *.* to asm@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æŸ¥ï¼šç”¨æˆ·çš„æŸ¥è¯¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;  ç›¸å½“äº<span class="built_in">cat</span> /etc/passwd</span><br><span class="line"></span><br><span class="line">mysql&gt; show grant <span class="keyword">for</span> asm@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line"></span><br><span class="line">mysql&gt; selcet * from mysql.user\G</span><br><span class="line"></span><br><span class="line">\G  æ ¼å¼åŒ–è¾“å‡º</span><br></pre></td></tr></table></figure><h3 id="2ã€æƒé™ç®¡ç†">2ã€<strong>æƒé™ç®¡ç†</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…¨éƒ¨æƒé™</span></span><br><span class="line"></span><br><span class="line">INSERT,SELECT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN,  PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER, CREATE TABLESPACE  </span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™ä¸¤æ¡å‘½ä»¤éƒ½æ˜¯æˆæƒï¼Œæ²¡ä»€ä¹ˆåŒºåˆ«</span></span><br><span class="line">mysql&gt; grant   all  on   *.*   to  <span class="built_in">test</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">mysql&gt; grant   all privileges  on   *.*   to  <span class="built_in">test</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">             æƒé™           ä½œç”¨å¯¹è±¡        å½’å±                       å¯†ç </span><br><span class="line"></span><br><span class="line">æƒ³è¦ç”¨æˆ·æœ‰grantæƒé™ ï¼Œéœ€è¦åœ¨æˆæƒå‘½ä»¤çš„åé¢åŠ ï¼šwith grant option</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆæƒç”¨æˆ·</span></span><br><span class="line">mysql&gt; grant all on *.* to aaa@<span class="string">&#x27;10.0.0.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="comment">#æŸ¥çœ‹</span></span><br><span class="line">mysql&gt; show grants <span class="keyword">for</span> aaa@<span class="string">&#x27;10.0.0.%&#x27;</span>;</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants <span class="keyword">for</span> aaa@10.0.0.%                                                                                            |</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;aaa&#x27;</span>@<span class="string">&#x27;10.0.0.%&#x27;</span> IDENTIFIED BY PASSWORD <span class="string">&#x27;*23AE809DDACAF96AF0FD78ED04B6A265E05AA257&#x27;</span> |</span><br><span class="line">+--------------------------------------------------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½œç”¨å¯¹è±¡åˆ†è§£</span></span><br><span class="line">*.* [å½“å‰MySQLå®ä¾‹ä¸­æ‰€æœ‰åº“ä¸‹çš„æ‰€æœ‰è¡¨]</span><br><span class="line">wordpress.* [å½“å‰MySQLå®ä¾‹ä¸­wordpressåº“ä¸­æ‰€æœ‰è¡¨ï¼ˆå•åº“çº§åˆ«ï¼‰]#å¸¸ç”¨çš„çº§åˆ«</span><br><span class="line">wordpress.user [å½“å‰MySQLå®ä¾‹ä¸­wordpressåº“ä¸­çš„userè¡¨ï¼ˆå•è¡¨çº§åˆ«ï¼‰]</span><br><span class="line">å•å­—æ®µçº§åˆ«</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»™å¼€å‘å¼€æƒé™ï¼ˆåŸå§‹äººç‰ˆï¼‰</span></span><br><span class="line">INSERT,SELECT, UPDATE, DELETE</span><br><span class="line"><span class="comment">#ç»™å¼€å‘å¼€æƒé™ï¼ˆè§„èŒƒç‰ˆæœ¬ï¼‰</span></span><br><span class="line">INSERT,SELECT, UPDATE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å•å­—æ®µçº§åˆ«ï¼šè„±æ• ï¼šè„±ç¦»æ•æ„Ÿä¿¡æ¯</span></span><br><span class="line">æ¯”å¦‚ä¸€ä¸ªè¡¨é‡Œé¢æœ‰ç”¨æˆ·çš„é“¶è¡Œå¡å·ï¼Œå¼€å‘ä½¿ç”¨è¿™ä¸ªè¡¨ï¼Œæˆ‘ä¸æƒ³è®©ä»–çœ‹åˆ°è¡¨é‡Œé¢çš„é“¶è¡Œå¡ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨è„±æ•</span><br><span class="line"><span class="comment">#åªç»™å¼€å‘æŸ¥çœ‹user hostå­—æ®µçš„ä¿¡æ¯ï¼Œå…¶ä»–çš„ä¸èƒ½çœ‹</span></span><br><span class="line">mysql&gt; grant insert,<span class="keyword">select</span>(user,host),update,delete on mysql.user to dev@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•</span></span><br><span class="line">[root@db02 ~]# mysql -udev -p123</span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host from mysql.user;</span><br><span class="line">+------+-------------+</span><br><span class="line">| user | host        |</span><br><span class="line">+------+-------------+</span><br><span class="line">| aaa  | 10.0.0.%    |</span><br><span class="line">| root | db02        |</span><br><span class="line">| dev  | localhost   |</span><br><span class="line">| root | localhost   |</span><br><span class="line">+------+-------------+</span><br><span class="line">8 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"><span class="comment">#æŸ¥çœ‹passwprdå­—æ®µï¼ŒæŠ¥é”™æ²¡æœ‰æƒé™</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> user,host,password from mysql.user;</span><br><span class="line">ERROR 1143 (42000): SELECT <span class="built_in">command</span> denied to user <span class="string">&#x27;dev&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> table <span class="string">&#x27;user&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">å¼€å‘äººå‘˜è¯´ï¼šè¯·ç»™æˆ‘å¼€ä¸€ä¸ªç”¨æˆ·</span><br><span class="line">æ²Ÿé€šï¼š</span><br><span class="line">å¡«å†™å®¡æ‰¹å·¥å•æˆ–è€…å‘é‚®ä»¶è®©è€æ¿åŒæ„ï¼Œæœ‰ä¸€ä¸ªå®¡æ‰¹æµç¨‹  <span class="comment">#å¼€å‘ ---å¼€å‘é¢†å¯¼å®¡æ‰¹ ---è¿ç»´æ€»ç›‘---ä½ </span></span><br><span class="line">1ã€ç”¨æˆ·å</span><br><span class="line">2ã€ä»å“ªé‡Œè¿æ¥è¿‡æ¥</span><br><span class="line">3ã€å¯†ç è¦æ±‚</span><br><span class="line">4ã€éœ€è¦å¯¹å“ªäº›åº“ã€è¡¨è¿›è¡Œæ“ä½œ</span><br><span class="line"></span><br><span class="line">å¼€å‘è¯´ï¼šä½ æŠŠrootç”¨æˆ·ç»™æˆ‘å‘—ï¼Ÿ  </span><br><span class="line">æŠŠåˆ©å¼Šç»™è¿ç»´æ€»ç›‘è¯´ï¼Œå¦‚æœä»–åŒæ„ï¼Œä½ å°±æŠŠç”¨æˆ·åå¯†ç ï¼Œå‘ç»™è¿ç»´æ€»ç›‘ï¼Œè®©æ€»ç›‘å‘ç»™ä»–ï¼Œä½ ä¸è¦å‘</span><br></pre></td></tr></table></figure><h3 id="3ã€mysqlçš„è¿æ¥ç®¡ç†">3ã€<strong>mysqlçš„è¿æ¥ç®¡ç†</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]# mysql</span><br><span class="line">-uï¼šæŒ‡å®šç”¨æˆ·</span><br><span class="line">-pï¼šæŒ‡å®šå¯†ç </span><br><span class="line">-hï¼šæŒ‡å®šä¸»æœº</span><br><span class="line">-Sï¼šæŒ‡å®šsocket</span><br><span class="line">-Pï¼šæŒ‡å®šç«¯å£</span><br><span class="line">-eï¼šå…äº¤äº’æŒ‡å®šMySQLçš„SQLè¯­å¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¿æ¥å·¥å…·</span><br><span class="line">2)ç¬¬ä¸‰æ–¹çš„è¿æ¥å·¥å…·</span><br><span class="line">sqlyogã€navicat</span><br><span class="line">åº”ç”¨ç¨‹åºè¿æ¥MySQL</span><br><span class="line">æ³¨æ„ï¼šéœ€è¦åŠ è½½å¯¹åº”è¯­è¨€ç¨‹åºçš„API</span><br><span class="line"></span><br><span class="line">2.è¿æ¥æ–¹å¼</span><br><span class="line">1) socketè¿æ¥</span><br><span class="line">mysql -uroot -poldboy123 -S/application/mysql/tmp/mysql.sock</span><br><span class="line">mysql -uroot -poldboy123</span><br><span class="line">2) TCP/IP</span><br><span class="line">mysql -uroot -poldboy123 -h10.0.0.51 -P3306</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ç»™å…¬ç½‘IP,ä¸ä¼šæš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œeth0ä¼šdownæ‰ï¼Œè¿™ä¸ªæ—¶å€™æƒ³è¦ç”¨ç¬¬ä¸‰æ–¹å·¥å…·è¿æ¥æ•°æ®åº“ï¼Œå°±è¦ç«¯å£è½¬å‘ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¼šæœ‰ä¸€å°æœºå™¨æš´éœ²åœ¨å…¬ç½‘çš„ï¼Œç±»ä¼¼äºè´Ÿè½½å‡è¡¡çš„æœºå™¨ï¼Œå°±ä»è´Ÿè½½å‡è¡¡çš„æœºå™¨è·³è¿‡å»ã€‚</p><p><img src="../image/study_img/image-20240809152949694.png" alt="image-20240809152949694"></p><p><img src="../image/study_img/image-20240809153134945.png" alt="image-20240809153134945"></p><h3 id="4ã€MYSQLå¯åŠ¨å…³é—­æµç¨‹">4ã€<strong>MYSQLå¯åŠ¨å…³é—­æµç¨‹</strong></h3><p><img src="../image/study_img/image-20240809114555924.png" alt="image-20240809114555924"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/mysqld start ------&gt; mysqld_safe ------&gt; mysqld</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨</span></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line">systemctl mysqld start</span><br><span class="line">mysqld_safe --defaults-file=/etcc/my.cnf &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœæ­¢</span></span><br><span class="line">/etc/init.d/mysqld stop</span><br><span class="line">systemctl mysqld stop</span><br><span class="line">[root@db01 ~]# mysqladmin -uroot -p123 shutdown</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### ä»¥ä¸‹åœæ­¢æ–¹å¼åˆ«ç”¨</span></span><br><span class="line"><span class="built_in">kill</span> -9 pid ?</span><br><span class="line">killall mysqld ?</span><br><span class="line">pkill mysqld ?</span><br><span class="line">pkill -9 mysqld ?</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data buffer page åªè®°å½•å˜åŒ–è¿‡ç¨‹</span><br></pre></td></tr></table></figure><h3 id="5ã€MYSQLå¯åŠ¨é…ç½®">5ã€<strong>MYSQLå¯åŠ¨é…ç½®</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">é¢„ç¼–è¯‘ï¼šMySQLé…ç½® datadir=/app/mysql/data</span><br><span class="line">é…ç½®æ–‡ä»¶ï¼šMySQLé…ç½® datadir=/app/tmp/data</span><br><span class="line">å‘½ä»¤è¡Œï¼šmysqld_safe --datadir=/app/xxx/data</span><br><span class="line"></span><br><span class="line">é…ç½®æ–‡ä»¶è¯»å–é¡ºåºï¼š</span><br><span class="line">/etc/my.cnf</span><br><span class="line">/etc/mysql/my.cnf</span><br><span class="line"><span class="variable">$basedir</span>/my.cnfï¼ˆå‰ææ˜¯åœ¨ç¯å¢ƒå˜é‡ä¸­å®šä¹‰äº†MYSQL_HOMEå˜é‡ï¼‰</span><br><span class="line">mysqld_safe --defaults-extra-file=/opt/my.cnf ï¼ˆç±»ä¼¼includeï¼‰</span><br><span class="line">~/.my.cnf   è¿™ä¸ªæ˜¯è‡ªå·±å†™çš„</span><br><span class="line"></span><br><span class="line"><span class="comment">## å½“MySQLå¯åŠ¨æ—¶ï¼ŒæŒ‡å®šäº†è¯¥å‚æ•°ï¼Œé‚£ä¹ˆå…¶ä»–é…ç½®æ–‡ä»¶éƒ½ä¸è¯»å–</span></span><br><span class="line">--defaults-file</span><br><span class="line"></span><br><span class="line">è¯»å–é¡ºåºå’Œä¼˜å…ˆçº§ç›¸å  æœ€åè¯»çš„ä¼šè¦†ç›–å‰é¢çš„   å½“mysqlå¯åŠ¨æ—¶æŒ‡å®šäº†é…ç½®æ–‡ä»¶ï¼Œå…¶ä»–çš„éƒ½ä¸è¯»å–   å‘½ä»¤è¡Œçš„ä¼˜å…ˆçº§æœ€é«˜</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨ç›¸åŒé…ç½®æƒ…å†µä¸‹ï¼Œé…ç½®ç”Ÿæ•ˆçš„ä¼˜å…ˆçº§</span></span><br><span class="line">é¢„ç¼–è¯‘ &lt; é…ç½®æ–‡ä»¶ ï¼ˆ /etc/my.cnf &lt; /etc/mysql/my.cnf &lt; <span class="variable">$besedir</span>/my.cnf &lt; defaults-extra-file &lt; ~/.my.cnf &lt; defaults-file ï¼‰ &lt; å‘½ä»¤è¡Œ</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¥6ã€Nginxéƒ¨ç½²</title>
      <link href="/posts/a1dff2a4.html"/>
      <url>/posts/a1dff2a4.html</url>
      
        <content type="html"><![CDATA[<h2 id="Nginxéƒ¨ç½²">Nginxéƒ¨ç½²</h2><p><strong>linuxå’Œwindowså¹³å°å¸¸è§çš„webæœåŠ¡å™¨</strong></p><ul><li><p>Apacheï¼Œ(å›½ä¼æ€§è´¨ï¼Œè¦æ±‚æŠ€æœ¯æ ˆä¸éœ€è¦é‚£ä¹ˆå…ˆè¿›ï¼Œæ²¡æœ‰å¤§é‡çš„æµé‡ï¼Œåªéœ€è¦ç³»ç»Ÿæ¶æ„ç¨³å®šå³å¯)</p></li><li><p>nginx(ä¸»æµçš„äº’è”ç½‘å…¬å¸éƒ½é€‰æ‹©ä½¿ç”¨nginxï¼Œäº¬ä¸œï¼Œç¾å›¢ï¼Œæ–—é±¼ï¼Œç½‘æ˜“)</p></li><li><p>Lighttpd(æ€§èƒ½éå¸¸æ¥è¿‘nginxçš„ä¸€æ¬¾web serverï¼Œä¸»è¦æ˜¯è€å¤–åœ¨ç”¨)</p></li><li><p>Tomcat(åº”ç”¨æœåŠ¡å™¨ï¼Œjavaåšç¨‹åºè§£æ)</p></li><li><p>IBM(websphere)</p><p>windowså¹³å°ä¸‹çš„</p><ul><li>llS()internet information server )</li></ul><p><strong>apache</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apacheæ˜¯ä¸–ç•Œä¸»æµçš„webæœåŠ¡å™¨ï¼Œå¤§éƒ¨åˆ†ç½‘ç«™éƒ½æ˜¯apacheæ­å»ºçš„ï¼Œä¼˜åŠ¿æ˜¯å¼€æ”¾æºä»£ç ï¼Œå¼€å‘ç»´æŠ¤çš„å›¢é˜Ÿå¾ˆå¼ºå¤§ï¼Œæœ‰å¥½å‡ åå¹´çš„å†å²ï¼Œapcheæ”¯æŒè·¨å¹³å°åº”ç”¨(1inuxï¼Œunixï¼Œwindows)ä½†æ˜¯apacheå±äºé‡é‡çº§çš„äº§å“ï¼ŒåŠŸèƒ½éƒ½æ˜¯ä»¥æ¨¡å—åŒ–å®šåˆ¶ï¼Œä¸”å®ƒçš„å·¥ä½œæ¨¡å¼ï¼Œå ç”¨çš„å†…å­˜èµ„æºè¿‡å¤šï¼Œå¯¹ç³»ç»Ÿæ¶ˆè€—å¾ˆå¤§ï¼Œæ€§èƒ½ä¹Ÿç¨å¼±äºnginx</span><br></pre></td></tr></table></figure><p><strong>Lighttpd</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ï¼Œé«˜å®‰å…¨æ€§ï¼Œå¿«é€Ÿï¼Œä¸”é…ç½®çµæ´»çš„webæœåŠ¡å™¨äº§å“ï¼Œï¼Œä¸“é—¨ä¸ºé«˜æµé‡çš„ç½‘ç«™è®¾è®¡ï¼Œç›¸æ¯”å…¶ä»–å„æ¬¾webæœåŠ¡å™¨ï¼Œå†…æœ‰å ç”¨é‡æå°ï¼Œèƒ½å¤Ÿæä¾›æœ‰æ•ˆçš„APIï¼Œå¯¹cPUè´Ÿè½½æƒ…å†µç®¡ç†ï¼Œæ”¯æŒåå°è¯·æ±‚è½¬å‘ï¼Œastcgiï¼Œscgiï¼Œèµ„æºå‹ç¼©ï¼Œur1é‡å†™ï¼Œåˆ«åç­‰ç­‰é€šèƒ½ï¼Œå®ƒæ˜¯nginxçš„é‡å¤´å¯¹æ‰‹ä¹‹ä¸€</span><br></pre></td></tr></table></figure><p><strong>tomcat</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tomcatæ±¤å§†çŒ«æ˜¯ä¸€ä¸ªå¼€æºï¼Œè¿è¡ŒåŸºäºjavaçš„ä¸€ä¸ªwebåº”ç”¨æœåŠ¡å™¨ï¼Œä¸»è¦æ ¹æ®serverletè¿›è¡Œæ‰§è¡Œï¼Œä½†æ˜¯tomcatå¯¹äºå¹³å°æ–‡ä»¶ï¼Œé™æ€æ–‡ä»¶ï¼Œé«˜å¹¶å‘å¤„ç†è¿˜æ˜¯è¾ƒå¼±ï¼Œå› æ­¤ä¹Ÿæ˜¯å’Œnginxï¼Œapacheç»“åˆä½¿ç”¨ã€‚æƒ³è¦ä½¿ç”¨tomcatåº”ç”¨æœåŠ¡å™¨ï¼Œéœ€è¦æŒæ¡åŸºæœ¬çš„javaç¯å¢ƒéƒ¨ç½²ç­‰ç­‰</span><br></pre></td></tr></table></figure><p><strong>IIS</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å’Œnginxï¼Œapacheï¼Œlightttpæœ‰å“ªäº›åŒºåˆ«å‘¢<span class="string">?I</span>ISæ”¯æŒå›¾å½¢åŒ–æ“ä½œï¼Œæ¯•ç«Ÿæ˜¯åœ¨windowså¹³å°ï¼Œé€šè¿‡é¼ æ ‡ç‚¹å‡»å°±å¯ä»¥å®Œæˆç½‘ç«™é…ç½®åŠŸèƒ½è¿˜æ˜¯å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯åªèƒ½è¿è¡Œåœ¨windowså¹³å°</span><br></pre></td></tr></table></figure><p><strong>Nginx</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ˜¯ä¿„ç½—æ–¯äººå¼€å‘å‡ºçš„ä¸€æ¬¾é«˜æ€§èƒ½ HTTP webæœåŠ¡å™¨ï¼Œæ”¯æŒåå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ï¼Œèµ„æºå‹ç¼©ï¼Œur1é‡å†™ï¼Œç½‘ç«™è·³è½¬ç­‰ç­‰åŠŸèƒ½nginxä»¥é«˜æ•ˆçš„1inuxç½‘ç»œæ¨¡å‹ï¼Œepo11,event,ä½œä¸ºç½‘ç»œI0æ¨¡å‹,kqueueï¼Œåœ¨é«˜å¹¶å‘ç½‘ç«™æƒ…å†µä¸‹ï¼Œnginxèƒ½å¤Ÿè½»æ¾æ”¯æŒ5w+çš„å¹¶å‘æµé‡ï¼Œå¹¶ä¸”æ¶ˆè€—çš„æœåŠ¡å™¨å†…å­˜ï¼Œcpuç­‰èµ„æºï¼Œä¹Ÿæ˜¯å¾ˆä½çš„ï¼Œè¿è¡Œèµ·æ¥éå¸¸ç¨³å®šã€‚</span><br></pre></td></tr></table></figure><p>å¼€æº: ç›´æ¥è·å–æºä»£ç <br>é«˜æ€§èƒ½: æ”¯æŒæµ·é‡å¹¶å‘<br>å¯é : <code>æœåŠ¡ç¨³å®š</code></p></li></ul><p><strong>æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©NginxæœåŠ¡</strong><br>Nginxéå¸¸è½»é‡</p><p>nginxçš„ä¼˜åŠ¿ï¼šé«˜å¹¶å‘ã€IOå¤šè·¯å¤ç”¨ã€epollæ¨¡å‹ã€å¼‚æ­¥ã€éé˜»å¡</p><p>åŠŸèƒ½æ¨¡å—å°‘ (æºä»£ç ä»…ä¿ç•™httpä¸æ ¸å¿ƒæ¨¡å—ä»£ç ,å…¶ä½™ä¸å¤Ÿæ ¸å¿ƒä»£ç ä¼šä½œä¸ºæ’ä»¶æ¥å®‰è£…)<br>ä»£ç æ¨¡å—åŒ– (æ˜“è¯»ï¼Œä¾¿äºäºŒæ¬¡å¼€å‘ï¼Œå¯¹äºå¼€å‘äººå‘˜éå¸¸å‹å¥½)<br>äº’è”ç½‘å…¬å¸éƒ½é€‰æ‹©Nginx</p><p>1.NginxæŠ€æœ¯æˆç†Ÿï¼Œå…·å¤‡çš„åŠŸèƒ½æ˜¯ä¼ä¸šæœ€å¸¸ä½¿ç”¨è€Œä¸”æœ€éœ€è¦çš„<br>2.é€‚åˆå½“å‰ä¸»æµæ¶æ„è¶‹åŠ¿, å¾®æœåŠ¡ã€äº‘æ¶æ„ã€ä¸­é—´å±‚<br>3.ç»Ÿä¸€æŠ€æœ¯æ ˆ, é™ä½ç»´æŠ¤æˆæœ¬, é™ä½æŠ€æœ¯æ›´æ–°æˆæœ¬ã€‚</p><p>Nginxé‡‡ç”¨Epoolç½‘ç»œæ¨¡å‹ï¼ŒApacheé‡‡ç”¨Selectæ¨¡å‹<br>Select: å½“ç”¨æˆ·å‘èµ·ä¸€æ¬¡è¯·æ±‚ï¼Œselectæ¨¡å‹å°±ä¼šè¿›è¡Œä¸€æ¬¡éå†æ‰«æï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä½ä¸‹ã€‚<br>Epool: å½“ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œepoolæ¨¡å‹ä¼šç›´æ¥è¿›è¡Œå¤„ç†ï¼Œæ•ˆç‡é«˜æ•ˆï¼Œå¹¶æ— è¿æ¥é™åˆ¶ã€‚</p><p><strong>æŠ€æœ¯æ¶æ„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æ”¶è´¹æŠ€æœ¯æ ˆ:             redhat + jqurey+js+svn +oracle +tomcat +java + apache</span><br><span class="line">çœé’±ï¼Œèµ°å‘å¼€æºæŠ€æœ¯æ ˆ:    centos + jquery +js + git + mysql + java+tomcat +pythontperl+ nginx</span><br><span class="line"></span><br><span class="line">ç¾ä¼ï¼Œæ¯”è¾ƒæœ‰é’±</span><br><span class="line"></span><br><span class="line">æœ‰é’±çš„å¤§å…¬å¸ï¼Œè‡ªå·±é€ æœºæˆ¿ï¼Œä¹°æœåŠ¡å™¨ï¼Œæ•°æ®éƒ½ç”±è‡ªå·±ç®¡æ§ï¼Œè‡ªå·±æ‹›è˜IDCæœºæˆ¿è¿ç»´ï¼Œ1inuxç³»ç»Ÿè¿ç»´ï¼Œå¤´æ¡ï¼Œç™¾å›¢ï¼Œè‹¹æœä¸­ç­‰å…¬å¸ï¼Œå¤–ä¼ï¼Œè‡ªå·±è´­ä¹°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ”¾åœ¨ä¸“ä¸šçš„æœºæˆ¿æ‰˜ç®¡(å†…éƒ¨çš„å†…ç½‘ä¸šåŠ¡ï¼Œä¹Ÿæœ‰åœ¨è‡ªå·±å…¬å¸æ­å»ºå°å‹çš„æœåŠ¡å™¨æœºæˆ¿)</span><br><span class="line"></span><br><span class="line">å°å‹å…¬å¸ï¼Œé€‰æ‹©äº‘æœåŠ¡å™¨ï¼Œæ˜¯æœ€ç»æµå®æƒ </span><br></pre></td></tr></table></figure><p><strong>Nginxå¿«é€Ÿå®‰è£…</strong><br>Nginxçš„å®‰è£…æ–¹å¼<br>1.æºç ç¼–è¯‘=&gt;Nginx (1.ç‰ˆæœ¬éšæ„ 2.å®‰è£…å¤æ‚ 3.å‡çº§ç¹ç 4.è§„èŒƒ 5.ä¾¿äºç®¡ç†)<br>2.epelä»“åº“=&gt;Nginx (1.ç‰ˆæœ¬è¾ƒä½ 2.å®‰è£…ç®€å• 3.é…ç½®ä¸æ˜“è¯»)<br>3.å®˜æ–¹ä»“åº“=&gt;Nginx (1.ç‰ˆæœ¬è¾ƒæ–° 2.å®‰è£…ç®€å• 3.é…ç½®æ˜“è¯»)</p><p><strong>Nginxå®˜æ–¹ä»“åº“å®‰è£…</strong></p><p>å®˜æ–¹å®‰è£…æ­¥éª¤ï¼Œè¿›å…¥nginxå®˜ç½‘<br>documentationâ€”â€”&gt;Installing nginxâ€”â€”&gt;packagesâ€”â€”&gt;RHEL and derivatives</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1ã€é…ç½®yumæº</span><br><span class="line">yum install yum-utils</span><br><span class="line">2ã€åˆ›å»ºyumé…ç½®æ–‡ä»¶</span><br><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=<span class="literal">true</span></span><br><span class="line">3ã€å®‰è£…nginx</span><br><span class="line">yum install nginx -y</span><br><span class="line">4ã€systemcl start nginx</span><br><span class="line">5ã€systemctl <span class="built_in">enable</span> nginx</span><br><span class="line">6ã€åœ¨æµè§ˆå™¨è¾“å…¥ipçœ‹åˆ°æµ‹è¯•é¡µé¢å³å¯</span><br><span class="line">7ã€nginx -V  æŸ¥çœ‹ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><strong>Nginxçš„å¯åœ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.Nginxå¯åŠ¨</span><br><span class="line">[root@m01 ~]# /usr/sbin/nginx</span><br><span class="line">[root@m01 ~]# systemctl start nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.Nginxåœæ­¢</span><br><span class="line">[root@m01 ~]# /usr/sbin/nginx -s stop</span><br><span class="line">[root@m01 ~]# systemctl stop nginx</span><br><span class="line"></span><br><span class="line">3.Nginxé‡å¯</span><br><span class="line">[root@m01 ~]# systemctl restart nginx</span><br><span class="line"></span><br><span class="line">4.Nginxé‡è½½</span><br><span class="line">[root@m01 ~]# /usr/sbin/nginx -s reload</span><br><span class="line">[root@m01 ~]# systemctl reload nginx</span><br></pre></td></tr></table></figure><p><strong>Nginxé…ç½®æ–‡ä»¶</strong></p><p>1.Nginxä¸»é…ç½®æ–‡ä»¶</p><table><thead><tr><th>è·¯å¾„</th><th>ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/etc/nginx/nginx.conf</td><td>é…ç½®æ–‡ä»¶</td><td>nginxä¸»é…ç½®æ–‡ä»¶</td></tr><tr><td>/etc/nginx/conf.d/default.conf</td><td>é…ç½®æ–‡ä»¶</td><td>é»˜è®¤ç½‘ç«™é…ç½®æ–‡ä»¶</td></tr></tbody></table><p><em>2.Nginx</em>ä»£ç†ç›¸å…³å‚æ•°æ–‡ä»¶</p><table><thead><tr><th>è·¯å¾„</th><th>ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/etc/nginx/fastcgi_params</td><td>é…ç½®æ–‡ä»¶</td><td>Fastcgiä»£ç†é…ç½®æ–‡ä»¶</td></tr><tr><td>/etc/nginx/scgi_params</td><td>é…ç½®æ–‡ä»¶</td><td>scgiä»£ç†é…ç½®æ–‡ä»¶</td></tr><tr><td>/etc/nginx/uwsgi_params</td><td>é…ç½®æ–‡ä»¶</td><td>uwsgiä»£ç†é…ç½®æ–‡ä»¶</td></tr></tbody></table><p><em>3.Nginx</em>ç¼–ç ç›¸å…³é…ç½®æ–‡ä»¶</p><table><thead><tr><th>è·¯å¾„</th><th>ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/etc/nginx/win-utf</td><td>é…ç½®æ–‡ä»¶</td><td>Nginxç¼–ç è½¬æ¢æ˜ å°„æ–‡ä»¶</td></tr><tr><td>/etc/nginx/koi-utf</td><td>é…ç½®æ–‡ä»¶</td><td>Nginxç¼–ç è½¬æ¢æ˜ å°„æ–‡ä»¶</td></tr><tr><td>/etc/nginx/koi-win</td><td>é…ç½®æ–‡ä»¶</td><td>Nginxç¼–ç è½¬æ¢æ˜ å°„æ–‡ä»¶</td></tr><tr><td>/etc/nginx/mime.types</td><td>é…ç½®æ–‡ä»¶</td><td>Content-Typeä¸æ‰©å±•å</td></tr></tbody></table><p><em>4.Nginx</em>ç®¡ç†ç›¸å…³å‘½ä»¤</p><table><thead><tr><th>è·¯å¾„</th><th>ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/usr/sbin/nginx</td><td>å‘½ä»¤</td><td>Nginxå‘½ä»¤è¡Œç®¡ç†ç»ˆç«¯å·¥å…·</td></tr><tr><td>/usr/sbin/nginx-debug</td><td>å‘½ä»¤</td><td>Nginxå‘½ä»¤è¡Œä¸ç»ˆç«¯è°ƒè¯•å·¥å…·</td></tr></tbody></table><p><em>5.Nginx</em>æ—¥å¿—ç›¸å…³ç›®å½•ä¸æ–‡ä»¶</p><table><thead><tr><th>è·¯å¾„</th><th>ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>/var/log/nginx</td><td>ç›®å½•</td><td>nginxé»˜è®¤å­˜æ”¾æ—¥å¿—ç›®å½•</td></tr><tr><td>/etc/logrotate.d/nginx</td><td>é…ç½®æ–‡ä»¶</td><td>Nginxé»˜è®¤çš„æ—¥å¿—åˆ‡å‰²</td></tr></tbody></table><p><strong>nginxä¸»é…ç½®æ–‡ä»¶è®²è§£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/nginx/nginx.conf  </span><br><span class="line"><span class="comment"># æ ¸å¿ƒæ¨¡å—</span></span><br><span class="line">user nginx;   <span class="comment">#å¯åŠ¨nginx1çš„ç”¨æˆ·</span></span><br><span class="line">worker_processes auto;  <span class="comment"># nginxworkerè¿›ç¨‹æ•° autoæ˜¯æ ¹æ®æœåŠ¡å™¨çš„cpuæ ¸å¿ƒæ•°è‡ªè¡Œåˆ¤æ–­</span></span><br><span class="line">error_log /var/log/nginx/error.log; <span class="comment"># é”™è¯¯æ—¥å¿—çš„è·¯å¾„å’Œæ–‡ä»¶åç§°</span></span><br><span class="line">pid /var/run/nginx.pid;   <span class="comment">#nginxè¿›ç¨‹çš„pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#äº‹ä»¶é©±åŠ¨æ¨¡å—</span></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024; <span class="comment">#æ¯ä¸ªworkerè¿›ç¨‹æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ï¼Œè¿‡å¤šçš„è¿æ¥ä¼šå¯¼è‡´nginxæ€§èƒ½ä¸‹é™ã€è´Ÿè½½è¿‡é«˜</span></span><br><span class="line">    use epoll; <span class="comment">#äº‹ä»¶é©±åŠ¨æ¨¡å‹, epollé»˜è®¤          apacheçš„é©±åŠ¨æ¨¡å—select</span></span><br><span class="line">    nginxä½¿ç”¨epolèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤§é‡çš„å¹¶å‘ï¼›æé«˜äº†æœåŠ¡å™¨çš„æ€§èƒ½å’Œç¨³å®šæ€§</span><br><span class="line">   - æ€§èƒ½ä¼˜åŠ¿</span><br><span class="line">      åŒå¯¹æ¯”<span class="keyword">select</span>ç­‰å…¶ä»–äº‹ä»¶é©±åŠ¨</span><br><span class="line">      epolåœ¨å¤„ç†å¤§è§„æ¨¡å¹¶å‘äº‹ä»¶çš„æ—¶å€™ï¼Œè¡¨ç°ä¼˜å¼‚</span><br><span class="line">      æé«˜æœåŠ¡å™¨çš„æ€§èƒ½å’Œç¨³å®šæ€§</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HttpCoreModule(httpå†…æ ¸æ¨¡å—)ï¼Œæ¯ä¸€ä¸ªserverå®šä¹‰äº†ä¸€ä¸ªè™šæ‹Ÿä¸»æœºå’Œç½‘ç«™é…ç½®</span></span><br><span class="line">http &#123;</span><br><span class="line"><span class="comment">#å®šä¹‰äº†åä¸ºmainæ—¥å¿—çš„æ ¼å¼</span></span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line">    <span class="comment">#è®¿é—®æ—¥å¿—è·¯å¾„å’Œæ–‡ä»¶å</span></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile            on;  <span class="comment">#é«˜æ•ˆæ–‡ä»¶ä¼ è¾“ï¼Œå°†æ–‡ä»¶å†…å®¹ä»ç£ç›˜ç›´æ¥å‘é€åˆ°å®¢æˆ·ç«¯</span></span><br><span class="line">    tcp_nopush          on;  <span class="comment">#æ­é…sendfileä¸€èµ·ä½¿ç”¨</span></span><br><span class="line">    tcp_nodelay         on;  <span class="comment">#æ­é…sendfileä¸€èµ·ä½¿ç”¨</span></span><br><span class="line">    keepalive_timeout   65;  <span class="comment">#é•¿è¿æ¥ï¼Œè¶…æ—¶æ—¶é—´60s</span></span><br><span class="line">    types_hash_max_size 4096;</span><br><span class="line"></span><br><span class="line">    include             /etc/nginx/mime.types; <span class="comment">#nginxç›¸å…³çš„é…ç½®çš„ç±»å‹é…ç½®æ–‡ä»¶ã€‚ç”¨äºç¡®å®šå¦‚ä½•å¤„ç†è¯·æ±‚ä¸­çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    default_type        application/octet-stream;#é»˜è®¤ç±»å‹   å¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰æ–‡ä»¶ç±»å‹ï¼Œnginxä¼šé»˜è®¤ä½¿ç”¨ä»–ä½œä¸ºæ–‡ä»¶ç±»å‹</span><br><span class="line"></span><br><span class="line">   <span class="comment">#nginxç½‘å€ç›¸å…³çš„ç¼–å†™è·¯å¾„å’Œæ–‡ä»¶æ ¼å¼</span></span><br><span class="line">    include /etc/nginx/conf.d/*.conf;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;  <span class="comment">#nginxé»˜è®¤çš„ç«¯å£</span></span><br><span class="line">        listen       [::]:80;</span><br><span class="line">        server_name  _;   <span class="comment">#æä¾›çš„åŸŸå</span></span><br><span class="line">        root         /usr/share/nginx/html; <span class="comment">#ç«™ç‚¹ç›®å½•ï¼Œå­˜æ”¾ç½‘å€ä»£ç çš„ç›®å½•</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Load configuration files for the default server block.</span></span><br><span class="line">        include /etc/nginx/default.d/*.conf;  <span class="comment">#å­˜æ”¾é¢å¤–çš„nginxé…ç½®æ–‡ä»¶ï¼Œä½¿å¾—é…ç½®æ›´åŠ æ¸…æ™°ï¼Œæ˜“äºç®¡ç†</span></span><br><span class="line"></span><br><span class="line">        error_page 404 /404.html;</span><br><span class="line">        location = /404.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page 500 502 503 504 /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#serverå±‚,ç”¨äºå®šä¹‰è™šæ‹Ÿä¸»æœºçš„é…ç½®ï¼Œå’Œå®¢æˆ·ç«¯çš„httpè¯·æ±‚</span></span><br><span class="line">server &#123;                     </span><br><span class="line">listen 80;  <span class="comment">#å‘Šè¯‰nginxåœ¨80ç«¯å£ä¸Šç›‘å¬ä¼ å…¥httpçš„è¯·æ±‚</span></span><br><span class="line">server_name  172.16.1.7; <span class="comment">#é€šè¿‡server nameåˆ¶å®šæ‰€åŒ¹é…çš„ä¸»æœºå/IPåœ°å€</span></span><br><span class="line">charset utf-8;</span><br><span class="line">location / &#123;   <span class="comment">#ä½¿ç”¨æ¥è‡ªè¯¥æœåŠ¡å™¨çš„è¯·æ±‚éƒ½ä¼šè¢«è¿™ä¸ªé…ç½®å¤„ç†</span></span><br><span class="line">root /www/lol/;    <span class="comment">#æŒ‡å®šæœåŠ¡å™¨çš„/ç›®å½•</span></span><br><span class="line">index index.html;   <span class="comment">#æŒ‡å®šé»˜è®¤çš„ç´¢å¼•æ–‡ä»¶         </span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æŒ‡å®šäº†è™šæ‹Ÿä¸»æœºçš„ä¸»æœºåï¼Œå½“è¯·æ±‚çš„åŸŸåæ˜¯php.web.comçš„æ—¶å€™å°±ä¼šåº”ç”¨æ”¹æœåŠ¡å™¨å—çš„é…ç½®</span><br></pre></td></tr></table></figure><p><strong>nginxæ—¥å¿—é…ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ç›¸å…³æŒ‡ä»¤</span><br><span class="line">log_format     æ—¥å¿—æ ¼å¼</span><br><span class="line">access.log     è®¿é—®æ—¥å¿—</span><br><span class="line">error.log      é”™è¯¯æ—¥å¿—</span><br><span class="line">open_log_file_cache   æ—¥å¿—ç¼“å­˜</span><br><span class="line"></span><br><span class="line">æ—¥å¿—çš„æ ¼å¼å’Œå‘½ä»¤</span><br><span class="line"><span class="comment"># æ—¥å¿—æ ¼å¼å…è®¸åŒ…å«çš„å˜é‡</span></span><br><span class="line">vim /etc/nginx/nginx.conf</span><br><span class="line"> log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line"><span class="variable">$remote_addr</span>    ç”¨æˆ·ä½¿ç”¨çš„è®¾å¤‡çš„ipåœ°å€</span><br><span class="line"><span class="variable">$remote_user</span>    è¿œç¨‹ç”¨æˆ·ï¼šè®°å½•å®¢æˆ·ç«¯ç”¨æˆ·çš„åç§°</span><br><span class="line">[<span class="variable">$time_local</span>]   æœ¬åœ°æ—¶é—´ï¼šç”¨æˆ·è®¿é—®ç½‘ç«™çš„æ—¶é—´</span><br><span class="line"><span class="variable">$request</span>        è®°å½•è¯·æ±‚çš„URLå’ŒHTTPåè®®ï¼Œç”¨æˆ·è®¿é—®çš„ç½‘ç«™ è®¿é—®3æ®µ åŠ¨ä½œ/å†…å®¹/ç‰ˆæœ¬</span><br><span class="line"><span class="variable">$status</span>         çŠ¶æ€ï¼šè®°å½•è¯·æ±‚çŠ¶æ€ï¼Œä¸€èˆ¬ç”±3ä¸ºæ•°ç»„æˆï¼Œå«çŠ¶æ€ç </span><br><span class="line">                 200  æ­¤å¤„è®¿é—®å®ŒæˆæˆåŠŸï¼Œç”¨æˆ·éœ€è¦çš„ä¿¡æ¯æœåŠ¡å™¨å·²ç»™å‡º</span><br><span class="line">                 404  </span><br><span class="line"><span class="variable">$body_bytes_sent</span>  å‘é€ç»™å®¢æˆ·ç«¯çš„æ–‡æ¡£ä½“ç§¯ï¼Œä¸åŒ…æ‹¬å“åº”å¤´çš„å¤§å°</span><br><span class="line"><span class="variable">$http_referer</span>     å¼•ç”¨ï¼šè®°å½•ä»å“ªä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„  ï¼ˆè¶…é“¾æ¥ï¼‰</span><br><span class="line"><span class="variable">$http_user_agent</span>  ç”¨æˆ·ç”¨ä»€ä¹ˆæµè§ˆå™¨è®¿é—®çš„</span><br><span class="line"><span class="variable">$http_x_forwarded_for</span>  ä»£ç†ip</span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆnginxä¸èƒ½ä»¥rootèº«ä»½è¿è¡Œï¼Ÿ</strong></p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> ä¸ºä»€ä¹ˆnginxä¸èƒ½<span class="built_in">ä»¥root</span>èº«ä»½è¿è¡Œï¼Ÿ</span><br><span class="line"> æœ¬<span class="built_in">èº«root</span>æ‹¥æœ‰æœ€é«˜çš„æƒé™ï¼Œä¼šå¸¦æ¥ç³»ç»Ÿçš„å®‰å…¨æ€§èƒ½ï¼Œè¿˜æœ‰ä¸€äº›å±é™©çš„æ“ä½œï¼Œæé«˜äº†æ”»å‡»é¢</span><br><span class="line"> - ç³»ç»Ÿå®‰å…¨</span><br><span class="line">å¦‚æœworkè¿›ç¨‹<span class="built_in">ä»¥root</span>èº«ä»½è¿è¡Œæ—¶ï¼Œç½‘ç«™è¢«æ”»å‡»ï¼Œæ”»å‡»æ–¹æ‹¥æœ‰æå¤§çš„æ§åˆ¶æƒï¼Œé€ æˆä¸¥é‡çš„å®‰å…¨å¨èƒ</span><br><span class="line">- æƒé™è¿‡å¤§<span class="built_in"></span></span><br><span class="line"><span class="built_in">root</span>èº«ä»½è¿è¡Œæ—¶ï¼Œå¯ä»¥è®¿é—®ç³»ç»Ÿçš„èµ„æºå’Œæ–‡ä»¶</span><br><span class="line">å¯¼è‡´ç³»ç»Ÿè¿›è¡Œæœªæˆæƒçš„æ“ä½œ/è®¿é—®æ•æ„Ÿä¿¡æ¯ï¼Œå¢åŠ å—åˆ°æ¶æ„æ”»å‡»å¾—çš„é¢</span><br><span class="line">-å±é™©æ“ä½œ<span class="built_in"></span></span><br><span class="line"><span class="built_in">root</span>èº«ä»½æƒé™æé«˜ï¼Œæ¯”å¦‚ä¿®æ”¹ç³»ç»Ÿé…ç½®ï¼Œå¯¹æˆ‘çš„ç³»ç»Ÿäº§ç”Ÿç³»ç»Ÿå´©æºƒï¼Œæ•°æ®ä¸¢å¤±</span><br><span class="line">- æé«˜äº†æ”»å‡»é¢</span><br><span class="line">æé«˜äº†æ”»å‡»çš„æ¸—é€æœºä¼š</span><br><span class="line"></span><br><span class="line">nginxçš„ç‰ˆæœ¬è¦éšè—ï¼Œå› ä¸ºæ”»å‡»è€…è¦å·¥å…·ç‰ˆæœ¬ä¿¡æ¯æ‰¾åˆ°éšè—çš„æ¼æ´</span><br></pre></td></tr></table></figure><p><strong>ç®€å•çš„éƒ¨ç½²ç½‘é¡µ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–è¾‘é…ç½®æ–‡ä»¶</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /etc/nginx/conf.d/asm.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name www.asm.com; </span><br><span class="line">  root /code;</span><br><span class="line">  index index.html; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2ã€æ£€æŸ¥è¯­æ³•</span><br><span class="line">nginx -t</span><br><span class="line">nginx: the configuration file /opt/nginx-1.26.0/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /opt/nginx-1.26.0/conf/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line">3ã€å‡†å¤‡ç«™ç‚¹ç›®å½•</span><br><span class="line"><span class="built_in">mkdir</span> /code</span><br><span class="line"></span><br><span class="line">4ã€å‡†å¤‡ç´¢å¼•æ–‡ä»¶</span><br><span class="line">[root@web02 nginx-1.26.0]# <span class="built_in">echo</span> 123 &gt; /code/index.html</span><br><span class="line">[root@web02 nginx-1.26.0]# <span class="built_in">cat</span> /code/index.html</span><br><span class="line">123</span><br><span class="line"></span><br><span class="line">5ã€é‡æ–°åŠ è½½nginx</span><br><span class="line">systemctl reload nginx</span><br><span class="line">6ã€æ£€æŸ¥è¿›ç¨‹ï¼Œæ£€æŸ¥ç«¯å£</span><br><span class="line">[root@web02 nginx-1.26.0]# ps -ef | grep nginx</span><br><span class="line">root 13755 1 0 11:38 ? 00:00:00 nginx: master process</span><br><span class="line">/usr/sbin/nginx</span><br><span class="line">nginx 13757 13755 0 11:38 ? 00:00:00 nginx: worker process</span><br><span class="line">root 13762 6942 0 11:39 pts/0 00:00:00 grep --color=auto nginx</span><br><span class="line">[root@web02 nginx-1.26.0]# netstat -lntup | grep 80</span><br><span class="line">tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN</span><br><span class="line">13755/nginx: master</span><br><span class="line">tcp6 0 0 :::80 :::* LISTEN</span><br><span class="line">13755/nginx: master</span><br><span class="line"></span><br><span class="line">7ã€æœ¬åœ°DNSè§£æ</span><br><span class="line">windowsé”® + r  è¾“å…¥driversï¼Œæ‰¾åˆ°etcå¹¶è¿›å…¥ï¼Œæ‰¾åˆ°hostsç¼–è¾‘æ–‡ä»¶</span><br><span class="line">10.0.0.7  www.asm.com</span><br><span class="line"></span><br><span class="line">8ã€ä½¿ç”¨æµè§ˆå™¨è¾“å…¥åŸŸåæˆåŠŸè®¿é—®å³å¯</span><br></pre></td></tr></table></figure><p><strong>Nginxæ­å»ºå°æ¸¸æˆç½‘ç«™</strong></p><p>(æ¸¸æˆä»£ç çš„ä¸‹è½½åœ°å€) <a href="http://test.driverzeng.com/Nginx_Code/h5_games.zip">http://test.driverzeng.com/Nginx_Code/h5_games.zip</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">1ã€ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå¹¶æ£€æµ‹è¯­æ³•</span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> /etc/nginx/conf.d/asm.conf</span><br><span class="line">server &#123;</span><br><span class="line">  listen 80;</span><br><span class="line">  server_name www.asm.com; </span><br><span class="line">  root /code;</span><br><span class="line">  index index.html; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2ã€å‡†å¤‡ç«™ç‚¹ç›®å½•</span><br><span class="line"><span class="built_in">mkdir</span> /code</span><br><span class="line"></span><br><span class="line">4ã€å‡†å¤‡æ¸¸æˆä»£ç </span><br><span class="line"><span class="built_in">cd</span> /code</span><br><span class="line">wget  http://test.driverzeng.com/Nginx_Code/h5_games.zip</span><br><span class="line"></span><br><span class="line">5ã€è§£å‹ä»£ç </span><br><span class="line"><span class="built_in">cd</span> /code</span><br><span class="line">unzip h5_games.zip</span><br><span class="line"></span><br><span class="line">6ã€æ£€æµ‹nginx</span><br><span class="line">nginx -t</span><br><span class="line">nginx: the configuration file /opt/nginx-1.26.0/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /opt/nginx-1.26.0/conf/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line">7ã€é‡æ–°åŠ è½½æ£€æŸ¥ç«¯å£</span><br><span class="line">systemctl reload nginx</span><br><span class="line"></span><br><span class="line">8ã€ä½¿ç”¨æµè§ˆå™¨è¾“å…¥åŸŸåæˆåŠŸè®¿é—®å³å¯</span><br></pre></td></tr></table></figure><img src="../image/study_img/image-20240522153552120.png" alt="image-20240522153552120" style="zoom:80%;" />]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¥5ã€googleçš„åŒå‘è®¤è¯</title>
      <link href="/posts/6e8f0329.html"/>
      <url>/posts/6e8f0329.html</url>
      
        <content type="html"><![CDATA[<h3 id="googleçš„åŒå‘è®¤è¯">googleçš„åŒå‘è®¤è¯</h3><p>é€šå¸¸æˆ‘ä»¬ç›´æ¥é€šè¿‡sshè¾“å…¥å¯†ç è¿æ¥æœåŠ¡å™¨ï¼Œä½†è¿™æ ·å¾ˆå®¹æ˜“å‡ºç°æš´åŠ›ç ´è§£æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»“åˆgoogleçš„åŠ¨æ€è®¤è¯+sshå¯†ç ï¼Œè¿™æ ·èƒ½å¤Ÿå¤§å¤§çš„æå‡ç™»é™†çš„å®‰å…¨ã€‚<br>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ç”¨æˆ·é€šè¿‡sshç™»é™†ç³»ç»Ÿæ—¶ï¼Œå…ˆè¾“å…¥googleçš„éšæœºéªŒè¯ç ï¼Œç„¶ååœ¨è¾“å…¥æœåŠ¡å™¨çš„sshå¯†ç </p><p><strong>Google-authenticatoréƒ¨ç½²</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘åœ¨m01_10.0.0.61è¿™ä¸ªæœåŠ¡å™¨ä¸Šè¿›è¡Œé…ç½®çš„è®¤è¯</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…</span></span><br><span class="line">1ã€å®‰è£…ä¾èµ–åŒ…ï¼Œç¯å¢ƒæ˜¯centos7çš„</span><br><span class="line">[root@m01 ~]# yum -y install pam-devel libpng-devel autoconf automake libtool</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½ä»£ç </span></span><br><span class="line"> å›½å†…æº</span><br><span class="line">wget http://test.driverzeng.com/other/1.04.tar.gz</span><br><span class="line"> å›½å¤–æº</span><br><span class="line">wget https://github.com/google/google-authenticator-libpam/archive/1.04.tar.gz</span><br><span class="line"></span><br><span class="line">2ã€ä¸‹è½½å®‰è£…google-authenticator-libpamæ’ä»¶</span><br><span class="line">[root@m01 ~]# wget https://github.com/google/google-authenticator-libpam/archive/1.04.tar.gz</span><br><span class="line"></span><br><span class="line">3ã€è§£å‹</span><br><span class="line">[root@m01 ~]# tar xf 1.04</span><br><span class="line">å¾—åˆ°è¿™ä¸ªç›®å½• google-authenticator-libpam-1.04</span><br><span class="line"></span><br><span class="line">4ã€è¿›å…¥å·¥ä½œç›®å½•</span><br><span class="line">[root@m01 ~]# <span class="built_in">cd</span> google-authenticator-libpam-1.04/</span><br><span class="line"></span><br><span class="line">5ã€æ‰§è¡Œ(æ„å»ºä»£ç )</span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]# ./bootstrap.sh </span><br><span class="line"></span><br><span class="line">6ã€ç”Ÿæˆ</span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]# ./configure </span><br><span class="line">ç”Ÿæˆå¥½äº†ä¼šå¤šä¸€äº›ä¸œè¥¿</span><br><span class="line"></span><br><span class="line">7ã€ç¼–è¯‘å®‰è£…(ç¼–è¯‘çš„ä½œç”¨ï¼šè®©æœºå™¨èƒ½å¤Ÿè®¤è¯†æˆ‘çš„ä»£ç )</span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]#make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">8ã€æŸ¥çœ‹pam_google_authenticator.soçš„æ’ä»¶æ˜¯å¦ç”Ÿæˆ(éªŒè¯æ’ä»¶æ˜¯å¦å®‰è£…)</span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]# ll /usr/local/lib/security/</span><br><span class="line">total 136</span><br><span class="line">-rwxr-xr-x 1 root root   1021 May 21 08:59 pam_google_authenticator.la</span><br><span class="line">-rwxr-xr-x 1 root root 133552 May 21 08:59 pam_google_authenticator.so</span><br><span class="line"></span><br><span class="line">9ã€å°†google-authenticator-libpamå¤åˆ¶åˆ°åº“æ–‡ä»¶</span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]# <span class="built_in">cp</span> /usr/local/lib/security/pam_google_authenticator.so /usr/lib64/security/</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç°åœ¨è¾“å…¥googleä¼štabè‡ªåŠ¨è¡¥å…¨ï¼Œè¯æ˜å®‰è£…å·²å®Œæˆ</span></span><br><span class="line">[root@m01 google-authenticator-libpam-1.04]# google-authenticator </span><br></pre></td></tr></table></figure><p><strong>ç”Ÿæˆgoogleè®¤è¯è¯†åˆ«</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@m01 google-authenticator-libpam-1.04]# google-authenticator </span><br><span class="line">è¾“å…¥å‘½ä»¤ä¹‹åï¼Œå†è¾“å…¥yï¼Œä¼šæœ‰ä¸€ä¸ªäºŒç»´ç å‡ºæ¥ï¼Œç”¨æ‰‹æœºæ‰«æï¼Œè·å–åŠ¨æ€ç ä¹‹åå†è¾“å…¥4ä¸ªy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¯å¦åŸºäºæ—¶é—´çš„è®¤è¯ï¼Œä¸ºäº†é˜²æ­¢ä¸åŒè·¨æ—¶åŒºçš„é—®é¢˜ï¼Œè¿™é‡Œé€‰æ‹©y</span></span><br><span class="line">Do you want authentication tokens to be time-based (y/n) y</span><br><span class="line"><span class="comment">#ç„¶åä¼šè·³å‡ºä¸€ä¸ªgoogleçš„äºŒç»´ç </span></span><br><span class="line"><span class="comment">#çº¢è‰²æ¡†æ¡†æ˜¯: ç”Ÿæˆçš„å¯†é’¥</span></span><br><span class="line"><span class="comment">#ç»¿è‰²æ¡†æ¡†æ˜¯: ç”Ÿæˆçš„5ä¸ªä¸€æ¬¡æ€§ç´§æ€¥éªŒè¯ç ï¼Œç”¨äºç´§æ€¥æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¿‡ä¸€æ¬¡åè¯¥éªŒè¯ç å³å¤±æ•ˆäº†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ˜¯å¦æ›´æ–°ç”¨æˆ·çš„ Google Authenticator é…ç½®æ–‡ä»¶ï¼Œé€‰æ‹© y æ‰èƒ½ä½¿ä¸Šé¢æ“ä½œå¯¹å½“å‰ root ç”¨æˆ·ç”Ÿæ•ˆï¼Œå…¶å®å°±æ˜¯åœ¨å¯¹åº”ç”¨æˆ·çš„ Home ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª .google_authenticator æ–‡ä»¶ï¼Œå¦‚æœä½ æƒ³åœç”¨è¿™ä¸ªç”¨æˆ·çš„ Google Authenticator éªŒè¯ï¼Œåªéœ€è¦åˆ é™¤è¿™ä¸ªç”¨æˆ· Home ç›®å½•ä¸‹çš„ .google_authenticator æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</span></span><br><span class="line">Do you want me to update your <span class="string">&quot;/root/.google_authenticator&quot;</span> file? (y/n) y</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¯æ¬¡ç”Ÿæˆçš„è®¤è¯ç æ˜¯å¦åŒæ—¶åªå…è®¸ä¸€ä¸ªäººä½¿ç”¨ï¼Ÿè¿™é‡Œé€‰æ‹© yã€‚</span></span><br><span class="line">Do you want to disallow multiple uses of the same authentication</span><br><span class="line">token? This restricts you to one login about every 30s, but it increases</span><br><span class="line">your chances to notice or even prevent man-in-the-middle attacks (y/n) y</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¯æ¬¡ç”Ÿæˆçš„ä»¤ç‰Œ30sç”Ÿæˆä¸€æ¬¡ï¼Œæœ€é«˜å…è®¸å­˜åœ¨è¯¯å·®4åˆ†é’Ÿã€‚</span></span><br><span class="line">By default, a new token is generated every 30 seconds by the mobile app.</span><br><span class="line">In order to compensate <span class="keyword">for</span> possible time-skew between the client and the server,</span><br><span class="line">we allow an extra token before and after the current time. This allows <span class="keyword">for</span> a</span><br><span class="line">time skew of up to 30 seconds between authentication server and client. If you</span><br><span class="line">experience problems with poor time synchronization, you can increase the window</span><br><span class="line">from its default size of 3 permitted codes (one previous code, the current</span><br><span class="line">code, the next code) to 17 permitted codes (the 8 previous codes, the current</span><br><span class="line">code, and the 8 next codes). This will permit <span class="keyword">for</span> a time skew of up to 4 minutes</span><br><span class="line">between client and server.</span><br><span class="line">Do you want to <span class="keyword">do</span> so? (y/n) y</span><br></pre></td></tr></table></figure><p><strong>å°†google 2FAåŠ åˆ°ssh</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> 1ã€æ­å»ºé…ç½®æ–‡ä»¶(SSHè°ƒç”¨åŠå®¢æˆ·ç«¯é…ç½®ï¼Œæ·»åŠ pamè®¤è¯ï¼Œå†é…ç½®æ–‡ä»¶é‡Œé¢çš„ç¬¬ä¸€è¡Œè¾“å…¥ä»¥ä¸‹å†…å®¹)</span><br><span class="line"> [root@m01 ~]# vim /etc/pam.d/sshd    </span><br><span class="line">  <span class="comment">#%PAM-1.0</span></span><br><span class="line">  auth       required     pam_google_authenticator.so</span><br><span class="line"></span><br><span class="line">2ã€ä¿®æ”¹sshé…ç½®æ–‡ä»¶ï¼Œå…³è”googleè®¤è¯</span><br><span class="line">[root@m01 ~]# vim /etc/ssh/sshd_config </span><br><span class="line">ChallengeResponseAuthentication <span class="built_in">yes</span>     <span class="comment">#ç¬¬69è¡Œçš„noï¼Œä¿®æ”¹ä¸ºyes</span></span><br><span class="line"> </span><br><span class="line">3ã€é‡å¯sshæœåŠ¡</span><br><span class="line">[root@m01 ~]# systemctl restart sshd</span><br><span class="line"> </span><br><span class="line">4ã€éªŒè¯googleåŒå‘è®¤è¯</span><br><span class="line">æ–­å¼€ä¸Šè¿°é…ç½®çš„æœåŠ¡å™¨ï¼Œå†æ¬¡é‡æ–°è¿æ¥å‘ç°æ— æ³•è¿æ¥ç™»é™†ä¸Šå»ï¼Œä»£è¡¨GoogleäºŒæ¬¡è®¤è¯å·²é…ç½®å®Œæˆï¼Œå¯ä»¥ä½¿ç”¨è¿œç¨‹è¿æ¥çš„æ–¹æ³•è¿›è¡Œè¿æ¥ç™»é™†</span><br><span class="line">[root@web01 ~]# ssh root@10.0.0.61</span><br><span class="line">  æˆ‘åœ¨m01_10.0.0.61è¿™ä¸ªæœåŠ¡å™¨ä¸Šè¿›è¡Œé…ç½®çš„è®¤è¯ï¼Œæ‰€ä»¥æˆ‘è¦è¿œç¨‹è¿æ¥10.0.0.61ï¼Œéœ€è¦è®©æˆ‘è¾“å…¥åŠ¨æ€ç å³æˆåŠŸå®Œæˆé…ç½®è®¤è¯</span><br><span class="line">  </span><br><span class="line"> æˆ–è€…ä½¿ç”¨xshellå»ºç«‹è¿æ¥éªŒè¯ä¹Ÿå¯ä»¥</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240521100545835.png" alt="image-20240521100545835"></p><p><img src="../image/study_img/image-20240521140003525.png" alt="image-20240521140003525"></p><p>æ³¨æ„äº‹é¡¹ï¼š<br><em>1.ç”¨password + google authenticatorï¼Œå¦‚æœä½¿ç”¨å…¬é’¥ç™»å½•çš„è¯ï¼Œä¼šè·³è¿‡google authenticatoréªŒè¯ç›´æ¥ç™»å½•æœåŠ¡å™¨çš„ã€‚<br>2.å¦‚æœæ˜¯å†…ç½‘æµ‹è¯•ä½¿ç”¨ï¼Œå»ºè®®å®‰è£…google authenticator æµè§ˆå™¨æ’ä»¶å®è·µã€‚å¦‚æœæ˜¯å…¬ç½‘æœåŠ¡å™¨å»ºè®®å®‰è£…æ‰‹æœºç‰ˆçš„Authenticator</em></p><p><em>äºŒæ¬¡è®¤è¯å¹¶ä¸æ˜¯åˆšéœ€ï¼Œå¯ä»¥æ ¹æ®å·¥ä½œéœ€è¦å»éƒ¨ç½²ï¼Œåªæœ‰xsehllè¿æ¥å¯ä»¥è®¾ç½®äºŒæ¬¡è®¤è¯ï¼Œwindtermä¸æ”¯æŒ</em></p><img src="../image/study_img/image-20240521140905172.png" alt="image-20240521140905172" style="zoom:80%;" /><img src="../image/study_img/image-20240521141110144.png" alt="image-20240521141110144" style="zoom:67%;" /><img src="../image/study_img/image-20240521141204024.png" alt="image-20240521141204024" style="zoom:67%;" /><p><strong>Nginxçš„éƒ¨ç½²</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yumå®‰è£… </span></span><br><span class="line">ä¼˜ç‚¹ï¼šå®‰è£…å¯åŠ¨ç®€å•</span><br><span class="line">ç¼ºç‚¹ï¼šyumå®‰è£…çš„ç‰ˆæœ¬æ˜¯1.20ç‰ˆæœ¬æ˜¯å›ºå®šæ­»çš„ï¼Œå‡çº§ç®€å•ï¼Œç›´æ¥ä½¿ç”¨yum updateå‡çº§å³å¯</span><br><span class="line"></span><br><span class="line"><span class="comment">#æºç å®‰è£…   </span></span><br><span class="line">ä¼˜ç‚¹ï¼šå¯ä»¥é€‰æ‹©è‡ªå·±éœ€è¦çš„ç‰ˆæœ¬</span><br><span class="line">ç¼ºç‚¹ï¼šå®‰è£…å¤æ‚ï¼Œå‡çº§ç¹ç</span><br><span class="line"><span class="comment">#äºŒè¿›åˆ¶å®‰è£…</span></span><br><span class="line">è§£å‹å³ç”¨</span><br><span class="line"></span><br><span class="line">Nginxå®˜ç½‘  http://nginx.org/</span><br></pre></td></tr></table></figure><img src="../image/study_img/image-20240521141338448.png" alt="image-20240521141338448" style="zoom:67%;" /><img src="../image/study_img/image-20240521141437441.png" alt="image-20240521141437441" style="zoom:67%;" /><p><strong>Nginxæºç å®‰è£…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‰æœŸå‡†å¤‡ å®‰è£…ç¼–è¯‘éœ€è¦çš„gccå’Œgcc-c++</span></span><br><span class="line">yum install -y gcc gcc-c++</span><br><span class="line"></span><br><span class="line">1ã€åˆ°Nginxå®˜ç½‘ä¸‹è½½æºç åŒ…</span><br><span class="line">wget http://nginx.org/download/nginx-1.24.0.tar.gz</span><br><span class="line"></span><br><span class="line">[root@m01 ~]# ll</span><br><span class="line">-rw-rw-rw-   1 root root   54019 May 21 08:49 1.04.tar.gz</span><br><span class="line"></span><br><span class="line">2ã€åˆ›å»ºå·¥ä½œç›®å½•ï¼Œå°†æºç åŒ…å¤åˆ¶åˆ°å·¥ä½œç›®å½•å¹¶è§£å‹</span><br><span class="line">[root@m01 ~]# <span class="built_in">mkdir</span> /app</span><br><span class="line">[root@m01 ~]# <span class="built_in">mv</span> nginx-1.24.0.tar.gz  /app/</span><br><span class="line">[root@m01 ~]# <span class="built_in">cd</span> /app/</span><br><span class="line">[root@m01 app]# tar xf nginx-1.24.0.tar.gz </span><br><span class="line">[root@m01 app]# ll</span><br><span class="line">drwxr-xr-x 8 1001 1001     158 Apr 11  2023 nginx-1.24.0</span><br><span class="line">-rw-r--r-- 1 root root 1112471 Apr 12  2023 nginx-1.24.0.tar.gz</span><br><span class="line"></span><br><span class="line">3ã€ç”Ÿæˆ(ç¬¬1æ¬¡ç”Ÿæˆ)    </span><br><span class="line"><span class="comment">#ä¸ºé¿å…ç¼ºå°‘ä¾èµ–ç”ŸæˆæŠ¥é”™ï¼Œå¯ä»¥æå‰å®‰è£…ä¾èµ–ï¼šyum -y install pcre-devel pcre-devel</span></span><br><span class="line"></span><br><span class="line">éœ€è¦è¿›å…¥å·¥ä½œç›®å½•,å†ç”Ÿæˆ</span><br><span class="line">[root@m01 app]# <span class="built_in">cd</span> /app/nginx-1.24.0</span><br><span class="line">[root@m01 app]#./configure --prefix=/opt/nginx-1.24.0 --with-http_ssl_module --with-http_stub_status_module</span><br><span class="line"> --prefix=/opt/nginx-1.24.0 ï¼šæŒ‡å®šå®‰è£…è·¯å¾„</span><br><span class="line">--with-http_ssl_moduleï¼šæƒ³è¦nginxå¸¦httpçš„åŠŸèƒ½</span><br><span class="line">--with-http_stub_status_moduleï¼šè¿™ä¸ªæ¨¡å—èƒ½å¤Ÿè·å–Nginxè‡ªä¸Šæ¬¡å¯åŠ¨ä»¥æ¥çš„å·¥ä½œçŠ¶æ€</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰§è¡Œå‘½ä»¤æŠ¥é”™ï¼Œé—®é¢˜1ï¼šç¼ºå°‘pcreçš„ä¾èµ–</span></span><br><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either <span class="built_in">disable</span> the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the <span class="built_in">source</span> with nginx by using --with-pcre=&lt;path&gt; option.</span><br><span class="line"><span class="comment">#è§£å†³åŠæ³•ï¼šå®‰è£…pcreçš„ä¾èµ–</span></span><br><span class="line">[root@m01 nginx-1.24.0]# yum -y install pcre-devel</span><br><span class="line"></span><br><span class="line">4ã€ç”Ÿæˆ(ç¬¬2æ¬¡ç”Ÿæˆ)</span><br><span class="line">[root@m01 app]#./configure --prefix=/opt/nginx-1.24.0 --with-http_ssl_module --with-http_stub_status_module</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œå‘½ä»¤æŠ¥é”™ï¼Œé—®é¢˜2ï¼šç¼ºå°‘opensslçš„ä¾èµ–</span></span><br><span class="line">./configure: error: SSL modules require the OpenSSL library.</span><br><span class="line">You can either <span class="keyword">do</span> not <span class="built_in">enable</span> the modules, or install the OpenSSL library</span><br><span class="line">into the system, or build the OpenSSL library statically from the <span class="built_in">source</span></span><br><span class="line">with nginx by using --with-openssl=&lt;path&gt; option.</span><br><span class="line"><span class="comment">## è§£å†³æ–¹æ¡ˆ:å®‰è£…opensslçš„ä¾èµ–</span></span><br><span class="line">yum install -y openssl-devel</span><br><span class="line"></span><br><span class="line">5ã€ç”Ÿæˆ(ç¬¬3æ¬¡ç”Ÿæˆ)</span><br><span class="line">[root@m01 app]#./configure --prefix=/opt/nginx-1.24.0 --with-http_ssl_module --with-http_stub_status_module</span><br><span class="line">ä¾èµ–å…¨éƒ¨å®‰è£…å®Œæˆåï¼Œå†æ¬¡ç”Ÿæˆï¼Œå‡ºç°å¦‚ä¸‹å†…å®¹ä»£è¡¨ç”Ÿæˆå®Œæˆ</span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + using system OpenSSL library</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: <span class="string">&quot;/opt/nginx-1.24.0&quot;</span></span><br><span class="line">  nginx binary file: <span class="string">&quot;/opt/nginx-1.24.0/sbin/nginx&quot;</span></span><br><span class="line">  nginx modules path: <span class="string">&quot;/opt/nginx-1.24.0/modules&quot;</span></span><br><span class="line">  nginx configuration prefix: <span class="string">&quot;/opt/nginx-1.24.0/conf&quot;</span></span><br><span class="line">  nginx configuration file: <span class="string">&quot;/opt/nginx-1.24.0/conf/nginx.conf&quot;</span></span><br><span class="line">  nginx pid file: <span class="string">&quot;/opt/nginx-1.24.0/logs/nginx.pid&quot;</span></span><br><span class="line">  nginx error <span class="built_in">log</span> file: <span class="string">&quot;/opt/nginx-1.24.0/logs/error.log&quot;</span></span><br><span class="line">  nginx http access <span class="built_in">log</span> file: <span class="string">&quot;/opt/nginx-1.24.0/logs/access.log&quot;</span></span><br><span class="line">  nginx http client request body temporary files: <span class="string">&quot;client_body_temp&quot;</span></span><br><span class="line">  nginx http proxy temporary files: <span class="string">&quot;proxy_temp&quot;</span></span><br><span class="line">  nginx http fastcgi temporary files: <span class="string">&quot;fastcgi_temp&quot;</span></span><br><span class="line">  nginx http uwsgi temporary files: <span class="string">&quot;uwsgi_temp&quot;</span></span><br><span class="line">  nginx http scgi temporary files: <span class="string">&quot;scgi_temp&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€ç¼–è¯‘å®‰è£…(è®©ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«ä½ çš„ä»£ç )  æ³¨æ„ï¼Œè¦è¿›å…¥å·¥ä½œç›®å½•        </span><br><span class="line">[root@m01 nginx-1.24.0]# make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">7ã€å®‰è£…   ç¼–è¯‘å®‰è£…æˆåŠŸä¼šåœ¨optä¸‹ç”Ÿæˆnginx</span><br><span class="line">[root@m01 nginx-1.24.0]# ll /opt/</span><br><span class="line">drwxr-xr-x 6 root root 54 May 21 11:45 nginx-1.24.0</span><br><span class="line"></span><br><span class="line">8ã€æ·»åŠ è½¯è¿æ¥</span><br><span class="line">[root@m01 nginx-1.24.0]# <span class="built_in">ln</span> -s /opt/nginx-1.24.0/ /opt/nginx</span><br><span class="line">[root@m01 nginx-1.24.0]# ll /opt/</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 18 May 21 11:52 nginx -&gt; /opt/nginx-1.24.0/</span><br><span class="line"></span><br><span class="line">9ã€æ·»åŠ ç¯å¢ƒå˜é‡</span><br><span class="line">[root@m01 nginx-1.24.0]# <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@m01 nginx-1.24.0]# vim /etc/profile.d/nginx.sh    <span class="comment">#è¿™é‡Œä¼šæ‰“å¼€ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œå°†å¦‚ä¸‹å†…å®¹å†™å…¥æ–‡ä»¶å³å¯</span></span><br><span class="line"><span class="built_in">export</span> NGINX_PATH=/opt/nginx/sbin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$NGINX_PATH</span></span><br><span class="line"></span><br><span class="line">10ã€ç”Ÿæ•ˆç¯å¢ƒå˜é‡</span><br><span class="line">[root@m01 nginx-1.24.0]# <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">11ã€æ£€æŸ¥ç¯å¢ƒå˜é‡</span><br><span class="line">[root@m01 nginx-1.24.0]# <span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/opt/nginx/sbin</span><br><span class="line"></span><br><span class="line">12ã€å¯åŠ¨Nginxï¼Œå¹¶æ£€æŸ¥å¯åŠ¨æ˜¯å¦æˆåŠŸ</span><br><span class="line">[root@m01 nginx-1.24.0]# nginx </span><br><span class="line">[root@m01 nginx-1.24.0]# ps -aux |grep nginx</span><br><span class="line">root      24355  0.0  0.1  46004  1140 ?        Ss   11:58   0:00 nginx: master process nginx</span><br><span class="line">nobody    24356  0.0  0.1  46452  1888 ?        S    11:58   0:00 nginx: worker process</span><br><span class="line">root      24358  0.0  0.0 112812   980 pts/2    R+   11:58   0:00 grep --color=auto nginx</span><br><span class="line">[root@m01 nginx-1.24.0]# netstat -lntup|grep 80</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      24355/nginx: master </span><br><span class="line"></span><br><span class="line">è®¿é—®10.0.0.61é¡µé¢</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240521120431273.png" alt="image-20240521120431273"></p><p>æ³¨æ„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœnginxèµ·ä¸æ¥ã€‚å¯ä»¥æŸ¥çœ‹æ˜¯å¦æœ‰è€ç‰ˆæœ¬å­˜åœ¨ï¼Œå¹¶å°†è€ç‰ˆæœ¬ç§»é™¤</span></span><br><span class="line">[root@m01 nginx-1.24.0]# rpm -qa |grep nginx</span><br><span class="line">yum remove nginx</span><br><span class="line"></span><br><span class="line">ä¸åŠ ç¯å¢ƒå˜é‡å°±ç”¨/opt/nginx/sbin/nginxè¿™ä¸ªå‘½ä»¤æ‰§è¡Œï¼Œnginxä¹Ÿå¯ä»¥å¯åŠ¨</span><br></pre></td></tr></table></figure><p><strong>å¸è½½æºç å®‰è£…çš„nginx</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1ã€å…³é—­nginx</span><br><span class="line">nginx -s stop</span><br><span class="line">[root@m01 ~]# ps -aux|grep nginx</span><br><span class="line">root      24741  0.0  0.0 112812   976 pts/2    R+   15:09   0:00 grep --color=auto nginx</span><br><span class="line"></span><br><span class="line">2ã€è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤å…¨å±€æŸ¥æ‰¾nginxç›¸å…³çš„æ–‡ä»¶ï¼š</span><br><span class="line">[root@m01 nginx-1.24.0]# <span class="built_in">sudo</span> find / -name <span class="string">&quot;nginx*&quot;</span></span><br><span class="line"></span><br><span class="line">3ã€åˆ é™¤æŸ¥æ‰¾å‡ºæ¥çš„æ‰€æœ‰nginxç›¸å…³æ–‡ä»¶</span><br><span class="line">[root@m01 nginx-1.24.0]# <span class="built_in">sudo</span> find / -name <span class="string">&quot;nginx*&quot;</span>|xargs <span class="built_in">rm</span> -rf</span><br><span class="line"></span><br><span class="line">4ã€å°è¯•å¯åŠ¨nginx ä¸èƒ½å¯åŠ¨ä»£è¡¨å¸è½½æˆåŠŸ</span><br><span class="line">[root@m01 ~]# /opt/nginx/sbin/nginx</span><br><span class="line">-bash: /opt/nginx/sbin/nginx: No such file or directory</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¥4ã€å¦‚ä½•å®ç°å…¬é’¥æ¨é€è„šæœ¬</title>
      <link href="/posts/ed89b172.html"/>
      <url>/posts/ed89b172.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¦‚ä½•å®ç°æ¨é€å…¬é’¥è„šæœ¬">å¦‚ä½•å®ç°æ¨é€å…¬é’¥è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#äº¤äº’ç”Ÿæˆå¯†é’¥å¯¹ï¼Œéœ€è¦æŒ‰3ä¸ªå›è½¦ï¼Œæ‰ä¼šç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">[root@m01 ~]# ssh-keygen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.å…äº¤äº’ç”Ÿæˆå¯†é’¥å¯¹ï¼Œä¸éœ€è¦è¾“å…¥å›è½¦ï¼Œç›´æ¥ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">[root@m01 ~]# ssh-keygen -t rsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_rsa  &amp;&gt;/dev/null </span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬åœ¨ä½¿ç”¨ssh root@10.0.0.31è¿œç¨‹è¿æ¥æ—¶ï¼Œä¼šè®©æˆ‘ä»¬äº¤äº’è¾“å…¥å¯¹æ–¹ä¸»æœºçš„å¯†ç æ‰å¯è¿›è¡Œè¿æ¥</span><br><span class="line"><span class="comment"># 2.å…äº¤è¾“å…¥å¯†ç   å®‰è£…sshpass</span></span><br><span class="line">[root@m01 ~]# yum install -y sshpass</span><br><span class="line">[root@m01 ~]# sshpass -p 1 ssh root@10.0.0.31</span><br><span class="line">sshpass -p å¯†ç  ssh root@10.0.0.31</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.ç¬¬ä¸€æ¬¡è¿œç¨‹è¿æ¥æ—¶ï¼Œéœ€è¦æŒ‡çº¹è®¤è¯å’Œè¾“å…¥å¯†ç ï¼Œè¿™äº›éƒ½å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åšåˆ°å…äº¤äº’</span></span><br><span class="line">[root@m01 ~]# sshpass -p root ssh -o strictHostKeyChecking=no root@10.0.0.31</span><br><span class="line"></span><br><span class="line">sshpass -p å¯†ç  ssh -o strictHostKeyChecking=no root@10.0.0.31</span><br><span class="line">-pï¼šæŒ‡å®šå¯†ç </span><br><span class="line">-o strictHostKeyChecking=noï¼šå¿½ç•¥æŒ‡çº¹è®¤è¯</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™è„šæœ¬</span></span><br><span class="line">[root@m01 ~]# vim push_public_key.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#åˆ¤æ–­å…¬é’¥æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f ~/.ssh/id_rsa ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> ssh-keygen -t rsa -P <span class="string">&#x27;&#x27;</span> -f ~/.ssh/id_rsa &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> &#123;5,6,7,8,31,41,51,61,71&#125;;<span class="keyword">do</span></span><br><span class="line">ping -c1 -W1 172.16.1.<span class="variable">$ip</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="comment">#å¿½ç•¥æŒ‡çº¹è®¤è¯æ¨é€å…¬é’¥</span></span><br><span class="line">[ $? -eq 0 ] &amp;&amp;\</span><br><span class="line">sshpass -p root ssh-copy-id -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa.pub root@172.16.1.<span class="variable">$ip</span> &amp;&gt;/dev/null &amp;&amp;\</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;172.16.1.<span class="variable">$ip</span> æ¨é€æˆåŠŸ...&quot;</span> ||\</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;172.16.1.<span class="variable">$ip</span> æ¨é€å¤±è´¥...&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¦‚æœè„šæœ¬é‡Œé¢å¸¦å¯†ç ï¼Œä¸ºäº†å®‰å…¨ï¼Œå°±å¯ä»¥æŠŠæ–‡ä»¶å˜æˆäºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">å°†è„šæœ¬å˜æˆäºŒè¿›åˆ¶æ–‡ä»¶(åŠ å¯†æ–‡ä»¶å†…å®¹)å®‰è£…shc </span><br><span class="line"><span class="comment">## å°†è„šæœ¬å˜æˆäºŒè¿›åˆ¶æ–‡ä»¶</span></span><br><span class="line">[root@m01 ~]# yum install -y shc</span><br><span class="line">[root@m01 ~]# shc -f ip_host.sh</span><br><span class="line"></span><br><span class="line">shc -f æ–‡ä»¶å</span><br><span class="line">ä¼šç”Ÿæˆ.x .x.c çš„æ–‡ä»¶ï¼ŒæŠŠ.xçš„æ–‡ä»¶è¿›è¡Œæ‰§è¡Œå°±å¯ä»¥</span><br><span class="line">./æ–‡ä»¶å ï¼šäºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨./æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p><strong>expectå…äº¤äº’è¯­è¨€(äº†è§£)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£…expect</span></span><br><span class="line">[root@m01 ~]# yum install -y expect</span><br><span class="line"></span><br><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip 10.0.0.41</span><br><span class="line"><span class="built_in">set</span> pass root</span><br><span class="line"><span class="built_in">set</span> <span class="built_in">timeout</span> 30</span><br><span class="line">spawn ssh root@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">&quot;(yes/no)&quot;</span> &#123;send <span class="string">&quot;yes\r&quot;</span>; exp_continue&#125;</span><br><span class="line"><span class="string">&quot;password:&quot;</span> &#123;send <span class="string">&quot;<span class="variable">$pass</span>\r&quot;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line">expect <span class="string">&quot;root@*&quot;</span> &#123;send <span class="string">&quot;df -h\r&quot;</span>&#125;</span><br><span class="line">expect <span class="string">&quot;root@*&quot;</span> &#123;send <span class="string">&quot;exit\r&quot;</span>&#125;</span><br><span class="line">expect eof</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## å¾ªç¯å¤šå°æœºå™¨</span></span><br><span class="line">[root@m01 ~]# !vim</span><br><span class="line">vim 1.exp</span><br><span class="line"><span class="comment">#!/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> pass 1</span><br><span class="line">foreach ip &#123;<span class="string">&quot;7&quot;</span> <span class="string">&quot;8&quot;</span> <span class="string">&quot;31&quot;</span> <span class="string">&quot;41&quot;</span>&#125; &#123;</span><br><span class="line">puts <span class="string">&quot;å½“å‰IPåœ°å€: <span class="variable">$ip</span>&quot;</span></span><br><span class="line">spawn ssh root@172.16.1.<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">&quot;(yes/no)&quot;</span> &#123;send <span class="string">&quot;yes\r&quot;</span>; exp_continue&#125;</span><br><span class="line"><span class="string">&quot;password:&quot;</span> &#123;send <span class="string">&quot;<span class="variable">$pass</span>\r&quot;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line">expect <span class="string">&quot;root@*&quot;</span> &#123;send <span class="string">&quot;df -h\r&quot;</span>&#125;</span><br><span class="line">expect <span class="string">&quot;root@*&quot;</span> &#123;send <span class="string">&quot;exit\r&quot;</span>&#125;</span><br><span class="line">expect eof</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------å…äº¤äº’æ¨é€å…¬é’¥ï¼Œå…æŒ‡çº¹è®¤è¯è„šæœ¬ï¼Œä¸€æ­¥åˆ°ä½------------------</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªIPåœ°å€æ–‡ä»¶ã€‚</span></span><br><span class="line">&gt;ip.txt</span><br><span class="line">pass=root</span><br><span class="line"><span class="comment">#æ£€æµ‹expectæ˜¯å¦å®‰è£…ï¼Œæ£€æµ‹å…¬é’¥æ˜¯å¦åˆ›å»ºã€‚</span></span><br><span class="line">rpm -q expect &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ] ;<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;å¼€å§‹å®‰è£…expectï¼Œè¯·ç¨ç­‰ä¸€ä¼š...&quot;</span></span><br><span class="line">        yum install -y expect &amp;&gt; /dev/null</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;expectå®‰è£…å®Œæˆ&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ ! -f ~/.ssh/id_rsa ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;å¼€å§‹åˆ›å»ºå¯†é’¥å¯¹...&quot;</span></span><br><span class="line">        ssh-keygen -P <span class="string">&quot;&quot;</span> -f ~/.ssh/id_rsa &amp;&gt; /dev/null</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;å¯†é’¥å¯¹åˆ›å»ºå®Œæˆ&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨forå¾ªç¯pingæµ‹è¯•ä¸»æœºæ˜¯å¦åœ¨çº¿ã€‚</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;2..254&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">        ip=10.0.0.<span class="variable">$i</span></span><br><span class="line">        ping -c1 -W1 <span class="variable">$ip</span> &amp;&gt; /dev/null</span><br><span class="line">        <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> &gt;&gt; ip.txt</span><br><span class="line">        /usr/bin/expect &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">set timeout 10</span></span><br><span class="line"><span class="string">spawn ssh-copy-id $ip</span></span><br><span class="line"><span class="string">expect &#123;</span></span><br><span class="line"><span class="string">        &quot;yes/no&quot; &#123; send &quot;yes\r&quot;; exp_continue &#125; &amp;&gt; /dev/null</span></span><br><span class="line"><span class="string">        &quot;password:&quot; &#123; send &quot;$pass\r&quot; &#125; &amp;&gt; /dev/null</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">expect eof</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">        &#125;&amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ¨é€å…¬é’¥å’Œå…äº¤äº’å·¥ä½œå·²å®Œæˆï¼Œä½ ç°åœ¨å¯ä»¥ç›´æ¥è¿œç¨‹ç™»é™†æœºå™¨äº†&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">expectçš„å˜é‡å®šä¹‰ï¼š <span class="built_in">set</span> å˜é‡å  å˜é‡å€¼</span><br><span class="line"></span><br><span class="line">\r å›è½¦</span><br><span class="line">\n æ¢è¡Œç¬¦</span><br></pre></td></tr></table></figure><p><strong>SSHå®‰å…¨ä¼˜åŒ–</strong></p><p>SSHä½œä¸ºè¿œç¨‹è¿æ¥æœåŠ¡ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ°è¯¥æœåŠ¡çš„å®‰å…¨ï¼Œæ‰€ä»¥éœ€è¦å¯¹è¯¥æœåŠ¡è¿›è¡Œå®‰å…¨æ–¹é¢çš„é…ç½®ã€‚<br>1.æ›´æ”¹è¿œç¨‹è¿æ¥ç™»é™†çš„ç«¯å£<br>2.ç¦æ­¢ROOTç®¡ç†å‘˜ç›´æ¥ç™»å½•<br>3.å¯†ç è®¤è¯æ–¹å¼æ”¹ä¸ºå¯†é’¥è®¤è¯<br>4.é‡è¦æœåŠ¡ä¸ä½¿ç”¨å…¬ç½‘IPåœ°å€<br>5.ä½¿ç”¨é˜²ç«å¢™é™åˆ¶æ¥æºIPåœ°å€</p><p>SSHæœåŠ¡ç™»å½•é˜²æŠ¤éœ€è¿›è¡Œå¦‚ä¸‹é…ç½®è°ƒæ•´ï¼Œå…ˆå¯¹å¦‚ä¸‹å‚æ•°è¿›è¡Œäº†è§£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Port 6666                       <span class="comment"># å˜æ›´SSHæœåŠ¡è¿œç¨‹è¿æ¥ç«¯å£</span></span><br><span class="line">PermitRootLogin         no      <span class="comment"># ç¦æ­¢rootç”¨æˆ·ç›´æ¥è¿œç¨‹ç™»å½•</span></span><br><span class="line">PasswordAuthentication  no      <span class="comment"># ç¦æ­¢ä½¿ç”¨å¯†ç ç›´æ¥è¿œç¨‹ç™»å½•</span></span><br><span class="line">UseDNS                  no      <span class="comment"># ç¦æ­¢sshè¿›è¡Œdnsåå‘è§£æï¼Œå½±å“sshè¿æ¥æ•ˆç‡å‚æ•°</span></span><br><span class="line">GSSAPIAuthentication    no      <span class="comment"># ç¦æ­¢GSSè®¤è¯ï¼Œå‡å°‘è¿æ¥æ—¶äº§ç”Ÿçš„å»¶è¿Ÿ</span></span><br></pre></td></tr></table></figure><p>å°†å¦‚ä¸‹å…·ä½“é…ç½®æ·»åŠ è‡³/etc/ssh/sshd_configæ–‡ä»¶ä¸­ï¼Œå‚æ•°éœ€æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###SSH###</span></span><br><span class="line"><span class="comment">#Port 6666</span></span><br><span class="line"><span class="comment">#PasswordAuthentication no</span></span><br><span class="line"><span class="comment">#PermitRootLogin no</span></span><br><span class="line">GSSAPIAuthentication no</span><br><span class="line">UseDNS no</span><br><span class="line"><span class="comment">###END###</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¥3ã€SSHè¿œç¨‹ç®¡ç†æœåŠ¡å®æˆ˜</title>
      <link href="/posts/2a29ab50.html"/>
      <url>/posts/2a29ab50.html</url>
      
        <content type="html"><![CDATA[<h2 id="SSHè¿œç¨‹ç®¡ç†æœåŠ¡å®æˆ˜">SSHè¿œç¨‹ç®¡ç†æœåŠ¡å®æˆ˜</h2><p><strong>SSHåŸºæœ¬æ¦‚è¿°</strong><br>SSHæ˜¯ä¸€ä¸ªå®‰å…¨åè®®ï¼Œåœ¨è¿›è¡Œæ•°æ®ä¼ è¾“æ—¶ï¼Œä¼šå¯¹æ•°æ®åŒ…è¿›è¡ŒåŠ å¯†å¤„ç†ï¼ŒåŠ å¯†ååœ¨è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ç¡®ä¿äº†æ•°æ®ä¼ è¾“å®‰å…¨ã€‚é‚£SSHæœåŠ¡ä¸»è¦åŠŸèƒ½æœ‰å“ªäº›å‘¢ï¼Ÿ</p><p>1.æä¾›è¿œç¨‹è¿æ¥æœåŠ¡å™¨çš„æœåŠ¡<br>2.å¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†</p><p>é‚£ä¹ˆé™¤äº†SSHåè®®èƒ½æä¾›è¿œç¨‹è¿æ¥æœåŠ¡ï¼ŒTelnetä¹Ÿèƒ½æä¾›è¿œç¨‹è¿æ¥æœåŠ¡, é‚£ä¹ˆåˆ†åˆ«çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢?<br>sshæœåŠ¡ä¼šå¯¹ä¼ è¾“æ•°æ®è¿›è¡ŒåŠ å¯†, ç›‘å¬åœ¨æœ¬åœ°22/tcpç«¯å£, sshæœåŠ¡é»˜è®¤æ”¯æŒrootç”¨æˆ·ç™»å½•<br>telnetæœåŠ¡ä¸å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†, ç›‘å¬åœ¨æœ¬åœ°23/tcpç«¯å£, Telneté»˜è®¤ä¸æ”¯æŒrootç”¨æˆ·ç™»å½•</p><p><strong>ä¸ºä»€ä¹ˆä¸è¦telnetè¿æ¥å‘¢ï¼Ÿ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">telnetä¹Ÿå¯ä»¥è¿œç¨‹è¿æ¥ï¼Œä¸ºä»€ä¹ˆä¸è¦telnetè¿æ¥å‘¢ï¼Ÿ</span><br><span class="line">1ã€åˆšå®‰è£…å®Œæˆçš„ç³»ç»Ÿæ²¡æœ‰telnetçš„æœåŠ¡ç«¯ï¼Œåªæœ‰sshçš„æœåŠ¡ç«¯ï¼Œæƒ³è¦ä½¿ç”¨telnetè¿œç¨‹ï¼Œéœ€è¦å®‰è£…</span><br><span class="line">2ã€telnetæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œä¸å®‰å…¨   ç«¯å£æ˜¯23ç«¯å£</span><br></pre></td></tr></table></figure><table><thead><tr><th>æœåŠ¡è¿æ¥æ–¹å¼</th><th>æœåŠ¡æ•°æ®ä¼ è¾“</th><th>æœåŠ¡ç›‘å¬ç«¯å£</th><th>æœåŠ¡ç™»é™†ç”¨æˆ·</th></tr></thead><tbody><tr><td>ssh</td><td>åŠ å¯†</td><td>22/tcp</td><td>é»˜è®¤æ”¯æŒrootç”¨æˆ·ç™»é™†</td></tr><tr><td>telnet</td><td>æ˜æ–‡</td><td>23/tcp</td><td>ä¸æ”¯æŒrootç”¨æˆ·ç™»é™†</td></tr></tbody></table><p><strong>å†™å‡ºä»¥ä¸‹åè®®ç«¯å£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ftp:21</span><br><span class="line">dns:53</span><br><span class="line">ssh:22</span><br><span class="line">telnet:23</span><br><span class="line">mysql:3306</span><br><span class="line">httpï¼š80</span><br><span class="line">httpï¼š443</span><br><span class="line">rsyncï¼š873</span><br><span class="line">pop3æ”¶é‚®ä»¶åè®®ï¼š110</span><br><span class="line">smtpé‚®ç®±åè®®ç«¯å£ï¼š25</span><br><span class="line">rdpè¿œç¨‹è¿æ¥windowsï¼š3389</span><br></pre></td></tr></table></figure><p><strong>SSHç›¸å…³å‘½ä»¤</strong></p><p>sshå‘½ä»¤ä¸€èˆ¬éƒ½æ˜¯å»ºç«‹è¿œç¨‹è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ssh  è¿œç¨‹è¿æ¥</span></span><br><span class="line">è¿œç¨‹è¿æ¥çš„åº•å±‚å°±æ˜¯è°ƒç”¨sshè¿™ä¸ªå‘½ä»¤</span><br><span class="line">ssh -p 22 root@172.16.1.13</span><br><span class="line"></span><br><span class="line">-p ï¼šæŒ‡å®šç«¯å£ï¼Œé»˜è®¤22ç«¯å£è¿™ä¸ªé€‰é¡¹å°±å¯ä»¥çœç•¥</span><br><span class="line">@ï¼šåˆ†éš”ç¬¦ï¼Œåˆ†å‰²ç”¨æˆ·å’Œip</span><br><span class="line">172.16.1.13 ï¼š å¯ä»¥è¾“å…¥ipæˆ–è€…åŸŸå</span><br><span class="line"></span><br><span class="line">è¿œç¨‹è¾“å…¥æ‰§è¡Œå‘½ä»¤ </span><br><span class="line"><span class="comment">#æ³¨æ„</span></span><br><span class="line">1ã€åœ¨ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ—¶ä¼šè¿›è¡ŒæŒ‡çº¹è®¤è¯ï¼Œè®©è¾“å…¥<span class="built_in">yes</span>ï¼Œ</span><br><span class="line">2ã€åªè¦æ²¡æœ‰åšå…å¯†çš„æƒ…å†µä¸‹ï¼Œè¿æ¥è‡ªå·±ä¹Ÿéœ€è¦è¾“å…¥å¯†ç </span><br><span class="line">[root@backup ~]# ssh root@10.0.0.7 <span class="string">&quot;ifconfig&quot;</span></span><br><span class="line">[root@backup ~]# ssh root@10.0.0.7 <span class="string">&quot;ls /root&quot;</span></span><br><span class="line">root@10.0.0.7<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">anaconda-ks.cfg</span></span><br><span class="line"><span class="string">jichu1.sh</span></span><br><span class="line"><span class="string">jichu.sh</span></span><br><span class="line"><span class="string">sh</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[root@backup ~]# ssh  -o strictHostKeyChecking=no root@10.0.0.7 &quot;ifconfig&quot;</span></span><br><span class="line"><span class="string">-o strictHostKeyChecking=noï¼šå¿½ç•¥æŒ‡çº¹è®¤è¯ï¼Œç›´æ¥è¾“å…¥å¯†ç </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># scp è¿œç¨‹æ‹·è´</span></span><br><span class="line"><span class="string">scp -r /etc  root@10.0.0.7:/tmp</span></span><br><span class="line"><span class="string">-r:é€’å½’ï¼Œä¼ è¾“ç›®å½•</span></span><br><span class="line"><span class="string">-p(å°å†™)ï¼šä¿æŒæ–‡ä»¶å±æ€§ï¼Œä¼ é€’è¿‡å»etcç›®å½•ä¸‹çš„æ–‡ä»¶å±æ€§ä¸å˜</span></span><br><span class="line"><span class="string">-P(å¤§å†™)ï¼šæŒ‡å®šç«¯å£</span></span><br><span class="line"><span class="string">å¦‚æœsshçš„ç«¯å£å˜äº† å°±è¦åŠ å…¥ç«¯å£çš„é€‰é¡¹ -P</span></span><br><span class="line"><span class="string">scp -P 2222 -rp /etc  root@10.0.0.7:/tmp</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#scpè¿œç¨‹æ‹‰å–æ–‡ä»¶</span></span><br><span class="line"><span class="string">scp 10.0.0.31:/backup /tmp</span></span><br></pre></td></tr></table></figure><p>å­¦sshåè®®éœ€è¦ä¸€å°æ–°çš„æœºå™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">æœºå™¨å·¡æ£€ï¼Œæ¯å°æœºå™¨ä¸€ä¸ªè„šæœ¬ï¼Œå‘é‚®ä»¶ç»™é¢†å¯¼ï¼Œå¦‚æœ100ä¸ªæœåŠ¡å™¨ é‚£é‚®ä»¶éƒ½æ»¡äº†ï¼Œä¸€èˆ¬å·¡æ£€éƒ½æ˜¯ç”±ä¸€ä¸ªæœºå™¨å®Œæˆ</span><br><span class="line">[root@backup ~]# ssh root@10.0.0.7 <span class="string">&quot;idf -Th&quot;</span></span><br><span class="line"></span><br><span class="line">å¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œå°±æ”¾åˆ°web01ï¼Œæ‰§è¡Œè¿œç¨‹æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">ssh root@10.0.0.7 <span class="string">&quot;idf -Th&quot;</span></span><br><span class="line">ssh root@10.0.0.8 <span class="string">&quot;idf -Th&quot;</span></span><br><span class="line">ssh root@10.0.0.31 <span class="string">&quot;idf -Th&quot;</span> ä½†æ˜¯è¦è¾“å…¥å¯†ç ï¼Œæ²¡æœ‰å†™å…¥å¯†ç çš„å˜é‡ï¼Œéœ€è¦åšsshå…å¯†éªŒè¯</span><br></pre></td></tr></table></figure><p><strong>SSHå…å¯†è¿æ¥æ–¹å¼</strong></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡<em>ssh</em>å®¢æˆ·ç«¯å‘½ä»¤ç™»é™†è¿œç¨‹æœåŠ¡å™¨ï¼Œéœ€è¦æä¾›è¿œç¨‹ç³»ç»Ÿä¸Šçš„å¸å·ä¸å¯†ç ï¼Œä½†ä¸ºäº†é™ä½å¯†ç æ³„éœ²çš„æœºç‡å’Œæé«˜ç™»é™†çš„æ–¹ä¾¿æ€§ï¼Œå»ºè®®ä½¿ç”¨å¯†é’¥éªŒè¯æ–¹å¼ã€‚</p><img src="../image/study_img/image-20240517133155314.png" alt="image-20240517133155314" style="zoom:80%;" /><p><strong>SSHå…å¯†è¿æ¥æ–¹å¼</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1ã€å¿…é¡»è¦ç”Ÿæˆä¸€å¯¹å¯†é’¥å¯¹ï¼Œæ‰èƒ½å…å¯†è¿æ¥åˆ«äºº</span><br><span class="line"><span class="comment"># å¯†é’¥å¯¹ï¼šç”±å…¬é’¥ + ç§é’¥ç»„æˆ</span></span><br><span class="line">å…¬é’¥ï¼šé—¨é”</span><br><span class="line">ç§é’¥ï¼šé’¥åŒ™</span><br><span class="line"></span><br><span class="line">m01(10.0.0.61),åšç®¡ç†çš„æœºå™¨ï¼Œä»¥åæ”¾å·¡æ£€è„šæœ¬ç”¨çš„</span><br><span class="line"><span class="comment"># 1.ç”Ÿæˆå¯†é’¥å¯¹</span></span><br><span class="line">[root@m01 ~]# ssh-keygen</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): // å¯†é’¥å¯¹å­˜æ”¾è·¯å¾„</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa. // ç§é’¥</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub. // å…¬é’¥</span><br><span class="line"></span><br><span class="line">[root@m01 ~]# ll ~/.ssh/</span><br><span class="line">-rw------- 1 root root 1675 May 17 11:49 id_rsa // ç§é’¥ï¼šé’¥åŒ™</span><br><span class="line">-rw-r--r-- 1 root root 390 May 17 11:49 id_rsa.pub // å…¬é’¥ï¼šé”</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.å…å¯†è¿æ¥web01</span></span><br><span class="line">[root@m01 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub     root@172.16.1.7</span><br><span class="line">[root@m01 ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@172.16.1.8</span><br><span class="line">[root@m01 ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@172.16.1.31</span><br><span class="line">[root@m01 ~]# ssh-copy-id -i /root/.ssh/id_rsa.pub root@172.16.1.41</span><br><span class="line">------------------------------------</span><br><span class="line"><span class="comment">## ssh-copy-id åº•å±‚åŸç†</span></span><br><span class="line">1ï¼‰è¿œç¨‹åˆ›å»º.sshç›®å½•</span><br><span class="line">å…å¯†è·³æ¿æœº</span><br><span class="line">[root@m01 ~]# ssh root@10.0.0.8 <span class="string">&#x27;mkdir /root/.ssh&#x27;</span></span><br><span class="line">2ï¼‰å°†å…¬é’¥ä¿å­˜åˆ°éœ€è¦å…å¯†æ§åˆ¶çš„æœºå™¨</span><br><span class="line">[root@web02 ~]# vim /root/.ssh/authorized_keys</span><br><span class="line">ssh-rsa</span><br><span class="line">AAAAB3NzaC1yc2EAAAADAQABAAABAQDXrmYzl1/VAkM6pcAkjwuPzHzzhWKroscKwnGlsWLffgEe/WZT</span><br><span class="line">2mqQqfygUNQmhZF3BLySTRlI/vVZKoLgqKBGr6CbRXPWi1ETKCYpbkK8NCj97wO3SV6Q01GU1sIcFAFV</span><br><span class="line">pXl5O+BapM/tLJVC+5EJqtK+2O1am3PC2/OPxQJJXCYWg9GH4VZhTUK4jQISJX9YRMcY8/HFjhQkgHEA</span><br><span class="line">/O6bFzeEFcfOodVfUKO2cauBLJTNw5UIRvsBX9cH10478pN3+QaZCTab2d43bfGW2A8b/tVXfumCF253</span><br><span class="line">eBrPCA8mt1nAH+YRpPLRS4FovbqQpfFHn/fVR1WLDo5IYIUhbcPP root@m01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ssh-keygen    3ä¸ªå›è½¦     </span><br><span class="line">ä¼šè¾“å‡ºä¸€ä¸ªll -a  ~/.sshç›®å½•ï¼Œé‡Œé¢æœ‰å…¬é’¥å’Œç§é’¥æ–‡ä»¶</span><br><span class="line">æˆ‘æƒ³å…å¯†è¿æ¥å“ªä¸ªæœºå™¨ï¼Œæˆ‘å°±è¦æŠŠå…¬é’¥å‘ç»™è°</span><br><span class="line"></span><br><span class="line">åªæœ‰ç”¨sshè¿æ¥è¿‡åˆ«äººï¼Œè‡ªå·±å®¶ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸€ä¸ª.sshçš„ç›®å½•ï¼Œä¸‹æ¬¡è¿æ¥å°±ä¸è¦è¾“å…¥<span class="built_in">yes</span>äº†</span><br><span class="line"></span><br><span class="line">fingerprint  æŒ‡çº¹è®¤è¯ åœ¨.sshç›®å½•ä¸‹çš„known_hosts</span><br><span class="line"></span><br><span class="line">2ã€å…å¯†è¿æ¥  æŠŠé”å‘ç»™éœ€è¦è¿æ¥çš„äºº</span><br><span class="line">ssh-copy-id -i /root/.ssh/id_rsa.pub root@172.16.1.7</span><br><span class="line"></span><br><span class="line">-i æŒ‡å®šé”çš„è·¯å¾„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ssh-copy-idåº•å±‚åŸç†</span><br><span class="line">ä¼šå…ˆåˆ›å»ºä¸€ä¸ª .sshç›®å½•</span><br><span class="line"></span><br><span class="line">æœ‰è¿™ç§å…å¯†è¿æ¥çš„æ–¹å¼ï¼Œå†™è„šæœ¬å°±å®¹æ˜“äº†ï¼Œ</span><br></pre></td></tr></table></figure><p><strong>å…å¯†è·³æ¿æœº</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ï¼/bin/bash</span></span><br><span class="line"><span class="comment">#jumpserver</span></span><br><span class="line">lb01=10.0.0.5</span><br><span class="line">lb02=10.0.0.6</span><br><span class="line">web01=10.0.0.7</span><br><span class="line">web02=10.0.0.8</span><br><span class="line">web03=10.0.0.9</span><br><span class="line">nfs=10.0.0.31</span><br><span class="line">backup=10.0.0.41</span><br><span class="line">db01=10.0.0.51</span><br><span class="line">m01=10.0.0.61</span><br><span class="line">zabbix=10.0.0.71</span><br><span class="line"><span class="function"><span class="title">menu</span></span>()&#123;</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;-<span class="string">EOF</span></span><br><span class="line"><span class="string">+-------------------------+</span></span><br><span class="line"><span class="string">| 1) lb01 |</span></span><br><span class="line"><span class="string">| 2) lb02 |</span></span><br><span class="line"><span class="string">| 3) web01 |</span></span><br><span class="line"><span class="string">| 4) web02 |</span></span><br><span class="line"><span class="string">| 5) web03 |</span></span><br><span class="line"><span class="string">| 6) nfs |</span></span><br><span class="line"><span class="string">| 7) backup |</span></span><br><span class="line"><span class="string">| 8) db01 |</span></span><br><span class="line"><span class="string">| 9) m01 |</span></span><br><span class="line"><span class="string">| 10) zabbix |</span></span><br><span class="line"><span class="string">| h) help |</span></span><br><span class="line"><span class="string">+-------------------------+</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#èœå•å‡½æ•°</span></span><br><span class="line">menu</span><br><span class="line"><span class="comment">#è¿æ¥å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="title">connect</span></span>()&#123;</span><br><span class="line">ping -c 1 -w 1 <span class="variable">$1</span> &amp;&gt;/dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">ssh root@<span class="variable">$1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[5;4;40;31m åˆ«è¿äº†,æˆ‘çš„å“¥,<span class="variable">$2</span>:<span class="variable">$1</span>æœºå™¨éƒ½æ²¡å¼€!!!\033[0m&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#æ§åˆ¶ä¸è®©è¾“å…¥ctrl+c,z</span></span><br><span class="line"><span class="built_in">trap</span> <span class="string">&quot;&quot;</span> HUP INT TSTP</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">&quot;è¯·è¾“å…¥è¦è¿æ¥çš„ä¸»æœºç¼–å·ï¼š&quot;</span> num</span><br><span class="line"><span class="keyword">case</span> <span class="variable">$num</span> <span class="keyword">in</span></span><br><span class="line">1|lb01)</span><br><span class="line">connect <span class="variable">$lb01</span> lb01</span><br><span class="line">;;</span><br><span class="line">2|lb02)</span><br><span class="line">connect <span class="variable">$lb02</span> lb02</span><br><span class="line">;;</span><br><span class="line">3|web01)</span><br><span class="line">connect <span class="variable">$web01</span> web01</span><br><span class="line">;;</span><br><span class="line">4|web02)</span><br><span class="line">connect <span class="variable">$web02</span> web02</span><br><span class="line">;;</span><br><span class="line">5|web03)</span><br><span class="line">connect <span class="variable">$web03</span> web03</span><br><span class="line">;;</span><br><span class="line">6|nfs)</span><br><span class="line">connect <span class="variable">$nfs</span> nfs</span><br><span class="line">;;</span><br><span class="line">7|backup)</span><br><span class="line">connect <span class="variable">$backup</span> backup</span><br><span class="line">;;</span><br><span class="line">8|db01)</span><br><span class="line">connect <span class="variable">$db01</span> db01</span><br><span class="line">;;</span><br><span class="line">9|m01)</span><br><span class="line">connect <span class="variable">$m01</span> m01</span><br><span class="line">;;</span><br><span class="line">10|zabbix)</span><br><span class="line">connect <span class="variable">$zabbix</span> zabbix</span><br><span class="line">;;</span><br><span class="line">h|<span class="built_in">help</span>)</span><br><span class="line">clear</span><br><span class="line">menu</span><br><span class="line">;;</span><br><span class="line">close)</span><br><span class="line"><span class="built_in">break</span></span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¥2ã€sersyncå®æ—¶åŒæ­¥æ•°æ®</title>
      <link href="/posts/efb3d0d0.html"/>
      <url>/posts/efb3d0d0.html</url>
      
        <content type="html"><![CDATA[<h3 id="sersyncå®æ—¶åŒæ­¥æ•°æ®">sersyncå®æ—¶åŒæ­¥æ•°æ®</h3><p>inotifyï¼šæ˜¯ä¸€ä¸ªå¯ä»¥å®æ—¶ç›‘æ§æ–‡ä»¶å’Œç›®å½•çš„å·¥å…·<br>ç›‘æ§æ–‡ä»¶å†…å®¹æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œç›®å½•æ˜¯å¦å‘ç”Ÿåˆ›å»ºå’Œåˆ é™¤</p><p>å®æ—¶åŒæ­¥ï¼šé€šè¿‡ç›‘æ§åˆ°æ–‡ä»¶æˆ–ç›®å½•æœ‰å˜åŒ–ï¼Œå°±ä¼šè§¦å‘rsyncæ¨é€æ•°æ®çš„åŠ¨ä½œï¼Œèµ·åˆ°å®æ—¶åŒæ­¥çš„ä½œç”¨</p><p><strong>å®‰è£…inotifyâ€”â€”åœ¨å®¢æˆ·ç«¯å®‰è£…</strong></p><p>æ˜ç¡®inotifyå®‰è£…åœ¨å®¢æˆ·ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install inotify-tools </span><br><span class="line"><span class="comment">#æŸ¥è¯¢å®‰è£…åäº§ç”Ÿçš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">rpm -ql inotify-tools</span><br><span class="line">ä½¿ç”¨çš„æ˜¯ywait å’Œywatch</span><br></pre></td></tr></table></figure><p><strong>inotifyé€‰é¡¹å’Œå‚æ•°</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-m æŒç»­ç›‘æ§</span><br><span class="line">-r é€’å½’</span><br><span class="line">-q é™é»˜ï¼Œä»…æ‰“å°æ—¶é—´ä¿¡æ¯</span><br><span class="line">--timefmt æŒ‡å®šè¾“å‡ºæ—¶é—´æ ¼å¼</span><br><span class="line">--format æŒ‡å®šäº‹ä»¶è¾“å‡ºæ ¼å¼</span><br><span class="line">%Xe äº‹ä»¶</span><br><span class="line">%w ç›®å½•</span><br><span class="line">%f æ–‡ä»¶</span><br><span class="line">-e æŒ‡å®šç›‘æ§çš„äº‹ä»¶</span><br><span class="line">access è®¿é—®</span><br><span class="line">modify å†…å®¹ä¿®æ”¹</span><br><span class="line">attrib å±æ€§ä¿®æ”¹</span><br><span class="line">close_write ä¿®æ”¹çœŸå®æ–‡ä»¶å†…å®¹</span><br><span class="line">open æ‰“å¼€</span><br><span class="line">create åˆ›å»º</span><br><span class="line">delete åˆ é™¤</span><br><span class="line">umount å¸è½½</span><br></pre></td></tr></table></figure><p><strong>inotifyå‘½ä»¤æµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inotifywait -mrq --format <span class="string">&#x27;%Xe %w %f&#x27;</span> -e create,modify,delete,attrib,close_write /backup</span><br></pre></td></tr></table></figure><p><strong>è„šæœ¬å®æ—¶åŒæ­¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å®æ—¶åŒæ­¥ï¼šrsync + inotify</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">cat</span> bak.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> RSYNC_PASSWORD=123</span><br><span class="line">bak_dir=/zls_backup/</span><br><span class="line">/usr/bin/inotifywait -mrq --format <span class="string">&#x27;%Xe %w %f&#x27;</span> -e</span><br><span class="line">create,modify,delete,attrib,close_write <span class="variable">$bak_dir</span>|<span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span></span><br><span class="line">rsync -az --delete <span class="variable">$bak_dir</span> rsync_backup@172.16.1.41::zls</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">è‹¥å‘ç”ŸæœåŠ¡å™¨é‡å¯ï¼Œè„šæœ¬æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥è¿˜æ˜¯æœ‰ç¼ºé™·çš„ï¼Œå°±æ— æ³•å®æ—¶ç›‘æ§æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦æœ‰å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Sersync</span><br></pre></td></tr></table></figure><p><strong>Sersync+rsyncå®æ—¶åŒæ­¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å®æ—¶åŒæ­¥çš„ç›®çš„ï¼šä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</span><br><span class="line">æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Sersync+rsync</span><br><span class="line"></span><br><span class="line">Inotify æ˜¯ä¸€ä¸ªé€šçŸ¥æ¥å£ï¼Œç”¨æ¥ç›‘æ§æ–‡ä»¶ç³»ç»Ÿçš„å„ç§å˜åŒ–ï¼Œå¦‚æœæ–‡ä»¶å­˜å–ï¼Œåˆ é™¤ï¼Œç§»åŠ¨ã€‚å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç°æ–‡ä»¶å¼‚åŠ¨å‘Šè­¦ï¼Œå¢é‡å¤‡ä»½ï¼Œå¹¶é’ˆå¯¹ç›®å½•æˆ–æ–‡ä»¶çš„å˜åŒ–åŠæ—¶ä½œå‡ºå“åº”ã€‚ rsync+inotify å¯ä»¥å®è§¦å‘å®æ—¶åŒæ­¥å¢é‡å¤‡ä»½</span><br><span class="line"></span><br><span class="line">sersync æ˜¯å›½äººåŸºäº rsync+inotify-tools å¼€å‘çš„å·¥å…·ï¼Œä¸ä»…ä¿ç•™äº†ä¼˜ç‚¹åŒæ—¶è¿˜å¼ºåŒ–äº†å®æ—¶ç›‘æ§ï¼Œæ–‡</span><br><span class="line">ä»¶è¿‡æ»¤ï¼Œç®€åŒ–é…ç½®ç­‰åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·æé«˜è¿è¡Œæ•ˆç‡ï¼ŒèŠ‚çœæ—¶é—´å’Œç½‘ç»œèµ„æºã€‚sersyncé¡¹ç›®åœ°å€</span><br></pre></td></tr></table></figure><p><strong>ç¯å¢ƒå‡†å¤‡â€”â€”å®ç°3å°æœºå™¨åŒæ­¥</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>å…¬ç½‘IP</th><th>å†…ç½‘IP</th><th>ä½œç”¨</th><th>åº”ç”¨</th></tr></thead><tbody><tr><td>backup</td><td>10.0.0.41</td><td>172.16.1.41</td><td>ä»“åº“(å­˜å‚¨æ‰€æœ‰å¤‡ä»½æ•°æ®çš„æœºå™¨)ï¼ŒæœåŠ¡ç«¯</td><td>rsyncçš„æœåŠ¡ç«¯</td></tr><tr><td>web01</td><td>10.0.0.7</td><td>172.16.1.7</td><td>éœ€è¦å¤‡ä»½æ•°æ®çš„æœºå™¨ï¼Œå®¢æˆ·ç«¯</td><td>rsyncçš„å®¢æˆ·ç«¯ã€sersyncã€inotify</td></tr><tr><td>web02</td><td>10.0.0.8</td><td>172.16.1.8</td><td>éœ€è¦å¤‡ä»½æ•°æ®çš„æœºå™¨ï¼Œå®¢æˆ·ç«¯</td><td>rsyncçš„å®¢æˆ·ç«¯ã€sersyncã€inotify</td></tr></tbody></table><p><strong>å®‰è£…rsyncæœåŠ¡ç«¯å¹¶é…ç½®(backup)</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…rsyncæœåŠ¡ç«¯</span><br><span class="line">yum -y install rsync</span><br><span class="line">2ã€é…ç½®rsyncæœåŠ¡ç«¯   (ä½œå®æ—¶å¤‡ä»½ï¼Œä¸¤è¾¹çš„ç›®å½•è¦ä¸€è‡´)</span><br><span class="line">vim /etc/rsyncd.conf</span><br><span class="line">åˆ é™¤é‡Œé¢çš„å…¨éƒ¨å†…å®¹ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br><span class="line">[root@backup ~]# <span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">uid = rsync</span><br><span class="line">gid = rsync</span><br><span class="line">port = 873</span><br><span class="line">fake super = <span class="built_in">yes</span></span><br><span class="line">use <span class="built_in">chroot</span> = no</span><br><span class="line">max connections = 200</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">ignore errors</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">list = <span class="literal">false</span></span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.passwd</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line"><span class="comment">#####################################é‡ç‚¹æ˜¯ä¸‹é¢è¿™å‡ è¡Œ</span></span><br><span class="line"><span class="comment">#ä½œæ•°æ®å¤‡ä»½æ¨¡å—</span></span><br><span class="line">[backup]</span><br><span class="line">comment = welcome to backup!</span><br><span class="line">path = /backup</span><br><span class="line"><span class="comment">#ä½œå®æ—¶åŒæ­¥çš„æ¨¡å—</span></span><br><span class="line">[data_web01]</span><br><span class="line">path = /data_web01</span><br><span class="line">[data_web02]</span><br><span class="line">path = /data_web02</span><br><span class="line"></span><br><span class="line">3ã€åˆ›å»ºé…ç½®æ–‡ä»¶é‡Œé¢çš„ç›®å½•</span><br><span class="line"><span class="built_in">mkdir</span> /data_web01</span><br><span class="line"><span class="built_in">mkdir</span> /data_web02</span><br><span class="line"></span><br><span class="line">4ã€åˆ›å»ºç”¨æˆ·</span><br><span class="line">useradd rsync -s /sbin/nologin -M</span><br><span class="line"></span><br><span class="line">5ã€æˆæƒç›®å½•</span><br><span class="line"><span class="built_in">chown</span> rsync.rsync /data_web01</span><br><span class="line"><span class="built_in">chown</span> rsync.rsync /data_web02</span><br><span class="line"></span><br><span class="line">6ã€åˆ›å»ºå¯†ç æ–‡ä»¶</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;rsync_backup:123&#x27;</span> &gt;/etc/rsync.passwd</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/rsync.passwd</span><br><span class="line"></span><br><span class="line">7ã€å¯åŠ¨æœåŠ¡ï¼Œå¼€æœºè‡ªå¯åŠ¨</span><br><span class="line">[root@backup ~]# systemctl start rsyncd</span><br><span class="line">[root@backup ~]# systemctl <span class="built_in">enable</span> rsyncd</span><br></pre></td></tr></table></figure><p><strong>å®‰è£…é…ç½®sersyncå®¢æˆ·ç«¯(web01ã€web02)</strong></p><p><strong>Web01</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½sersyncå®‰è£…åŒ…ï¼Œä¸‹è½½ä¾èµ–åŒ…rsyncã€inotify-tools</span><br><span class="line"> yum -y install inotify-tools</span><br><span class="line"> wget http://test.driverzeng.com/other/sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line">2ã€åˆ›å»ºå®‰è£…ç›®å½•</span><br><span class="line"><span class="built_in">mkdir</span> /app</span><br><span class="line"><span class="built_in">cd</span> /</span><br><span class="line">tar xf app/sersync2.5.4_64bit_binary_stable_final.tar.gz  -C app/</span><br><span class="line">ä¿®æ”¹ç¨‹åºç›®å½•åï¼Œä¹ æƒ¯è¦ç»™ç¨‹åºåšè½¯è¿æ¥</span><br><span class="line">[root@web01 app]# <span class="built_in">mv</span> /app/GNU-Linux-x86 /app/sersync-2.5.4</span><br><span class="line">[root@web01 app]# <span class="built_in">ln</span> -s sersync2.5.4 sersync</span><br><span class="line">æµ‹è¯•æ¨é€</span><br><span class="line">rsync -az --delete /data_web01 rsync_backup@172.16.1.41::data_web01 --password-file=/etc/rsync.pass</span><br><span class="line">3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">æ‰¾åˆ°inotify  æ”¹æˆ<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[root@web01 app]# vim /app/sersync/confxml.xml</span><br><span class="line">  &lt;inotify&gt;</span><br><span class="line">&lt;delete start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;createFolder start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;createFile start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;closeWrite start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;moveFrom start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;moveTo start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;attrib start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;modify start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;/inotify&gt;</span><br><span class="line">&lt;sersync&gt;</span><br><span class="line">&lt;localpath watch=<span class="string">&quot;/data_web01&quot;</span>&gt;</span><br><span class="line">&lt;remote ip=<span class="string">&quot;172.16.1.41&quot;</span> name=<span class="string">&quot;data_web01&quot;</span>/&gt;</span><br><span class="line">&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">&lt;/localpath&gt;</span><br><span class="line">&lt;rsync&gt;</span><br><span class="line">&lt;commonParams params=<span class="string">&quot;-az --delete&quot;</span>/&gt;</span><br><span class="line">&lt;auth start=<span class="string">&quot;true&quot;</span> <span class="built_in">users</span>=<span class="string">&quot;rsync_backup&quot;</span></span><br><span class="line">passwordfile=<span class="string">&quot;/etc/rsync.pass&quot;</span>/&gt;</span><br><span class="line">&lt;userDefinedPort start=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!-- port=874 --&gt;</span><br><span class="line">&lt;<span class="built_in">timeout</span> start=<span class="string">&quot;false&quot;</span> time=<span class="string">&quot;100&quot;</span>/&gt;&lt;!-- <span class="built_in">timeout</span>=100 --&gt;</span><br><span class="line">&lt;ssh start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">&lt;/rsync&gt;</span><br><span class="line">&lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!--default</span><br><span class="line">every 60mins execute once--&gt;</span><br><span class="line">&lt;crontab start=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!--600mins--&gt;</span><br><span class="line">&lt;crontabfilter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">&lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">&lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">&lt;/crontabfilter&gt;</span><br><span class="line">&lt;/crontab&gt;</span><br><span class="line">&lt;plugin start=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line">&lt;/sersync&gt;</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240916180931786.png" alt="image-20240916180931786"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">4ã€åˆ›å»ºæ•°æ®ç›®å½•data</span><br><span class="line"><span class="built_in">mkdir</span> /data_web01</span><br><span class="line">5ã€åˆ›å»ºå¯†ç æ–‡ä»¶ï¼Œæˆæƒ600</span><br><span class="line">[root@web01 app]# <span class="built_in">echo</span> <span class="string">&#x27;123&#x27;</span> &gt; /etc/rsync.pass</span><br><span class="line">[root@web01 app]# <span class="built_in">chmod</span> 600 /etc/rsync.pass</span><br><span class="line">6ã€å¯åŠ¨æœåŠ¡</span><br><span class="line">[root@web01 app]# /app/sersync/sersync2 -rdo /app/sersync/confxml.xml</span><br><span class="line">å†ç”¨æ­¤å‘½ä»¤å®ç°æ•°æ®åŒæ­¥</span><br><span class="line"><span class="built_in">cd</span> /data_web01 &amp;&amp; rsync -az --delete -R --delete ./ rsync_backup@172.16.1.41::data_web01 --password-file=/etc/rsync.pass</span><br><span class="line">åœ¨dataåˆ›å»ºæ–‡ä»¶ï¼ŒæŸ¥çœ‹æœåŠ¡ç«¯æ˜¯å¦åŒæ­¥æ•°æ®å³å¯</span><br></pre></td></tr></table></figure><p><strong>Web02</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸‹è½½sersyncå®‰è£…åŒ…ï¼Œä¸‹è½½ä¾èµ–åŒ…rsyncã€inotify-tools</span><br><span class="line"> yum -y install inotify-tools</span><br><span class="line"> wget http://test.driverzeng.com/other/sersync2.5.4_64bit_binary_stable_final.tar.gz</span><br><span class="line">2ã€åˆ›å»ºå®‰è£…ç›®å½•</span><br><span class="line"><span class="built_in">mkdir</span> /app</span><br><span class="line"><span class="built_in">cd</span> /</span><br><span class="line">tar xf app/sersync2.5.4_64bit_binary_stable_final.tar.gz  -C app/</span><br><span class="line">ä¿®æ”¹ç¨‹åºç›®å½•åï¼Œä¹ æƒ¯è¦ç»™ç¨‹åºåšè½¯è¿æ¥</span><br><span class="line">[root@web01 app]# <span class="built_in">mv</span> /app/GNU-Linux-x86 /app/sersync-2.5.4</span><br><span class="line">[root@nfs app]# <span class="built_in">cd</span> ~</span><br><span class="line">[root@nfs ~]# <span class="built_in">ln</span> -s /app/sersync-2.5.4 /app/sersync</span><br><span class="line">åˆ›å»ºæ•°æ®ç›®å½•ï¼Œæµ‹è¯•æ¨é€</span><br><span class="line"><span class="built_in">mkdir</span> /data2</span><br><span class="line">rsync -az --delete /data2 rsync_backup@172.16.1.41::datd --password-file=/etc/rsync.pass</span><br><span class="line"></span><br><span class="line">3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">æ‰¾åˆ°inotify  æ”¹æˆ<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[root@web01 app]# vim /app/sersync/confxml.xml</span><br><span class="line">  &lt;inotify&gt;</span><br><span class="line">&lt;delete start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;createFolder start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;createFile start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;closeWrite start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;moveFrom start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;moveTo start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;attrib start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;modify start=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">&lt;/inotify&gt;</span><br><span class="line"></span><br><span class="line">&lt;sersync&gt;</span><br><span class="line">&lt;localpath watch=<span class="string">&quot;/data_web02&quot;</span>&gt;</span><br><span class="line">&lt;remote ip=<span class="string">&quot;172.16.1.41&quot;</span> name=<span class="string">&quot;data_web012&quot;</span>/&gt;</span><br><span class="line">&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.39&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">&lt;!--&lt;remote ip=<span class="string">&quot;192.168.8.40&quot;</span> name=<span class="string">&quot;tongbu&quot;</span>/&gt;--&gt;</span><br><span class="line">&lt;/localpath&gt;</span><br><span class="line">&lt;rsync&gt;</span><br><span class="line">&lt;commonParams params=<span class="string">&quot;-az --delete&quot;</span>/&gt;</span><br><span class="line">&lt;auth start=<span class="string">&quot;true&quot;</span> <span class="built_in">users</span>=<span class="string">&quot;rsync_backup&quot;</span></span><br><span class="line">passwordfile=<span class="string">&quot;/etc/rsync.pass&quot;</span>/&gt;</span><br><span class="line">&lt;userDefinedPort start=<span class="string">&quot;false&quot;</span> port=<span class="string">&quot;874&quot;</span>/&gt;&lt;!-- port=874 --&gt;</span><br><span class="line">&lt;<span class="built_in">timeout</span> start=<span class="string">&quot;false&quot;</span> time=<span class="string">&quot;100&quot;</span>/&gt;&lt;!-- <span class="built_in">timeout</span>=100 --&gt;</span><br><span class="line">&lt;ssh start=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">&lt;/rsync&gt;</span><br><span class="line">&lt;failLog path=<span class="string">&quot;/tmp/rsync_fail_log.sh&quot;</span> timeToExecute=<span class="string">&quot;60&quot;</span>/&gt;&lt;!--default</span><br><span class="line">every 60mins execute once--&gt;</span><br><span class="line">&lt;crontab start=<span class="string">&quot;false&quot;</span> schedule=<span class="string">&quot;600&quot;</span>&gt;&lt;!--600mins--&gt;</span><br><span class="line">&lt;crontabfilter start=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">&lt;exclude expression=<span class="string">&quot;*.php&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">&lt;exclude expression=<span class="string">&quot;info/*&quot;</span>&gt;&lt;/exclude&gt;</span><br><span class="line">&lt;/crontabfilter&gt;</span><br><span class="line">&lt;/crontab&gt;</span><br><span class="line">&lt;plugin start=<span class="string">&quot;false&quot;</span> name=<span class="string">&quot;command&quot;</span>/&gt;</span><br><span class="line">&lt;/sersync&gt;</span><br><span class="line"></span><br><span class="line">5ã€åˆ›å»ºå¯†ç æ–‡ä»¶ï¼Œæˆæƒ600</span><br><span class="line">[root@web01 app]# <span class="built_in">echo</span> <span class="string">&#x27;123&#x27;</span> &gt; /etc/rsync.pass</span><br><span class="line">[root@web01 app]# <span class="built_in">chmod</span> 600 /etc/rsync.pass</span><br><span class="line">6ã€å¯åŠ¨æœåŠ¡</span><br><span class="line">[root@web01 app]# /app/sersync/sersync2 -rdo /app/sersync/confxml.xml</span><br><span class="line">å†ç”¨æ­¤å‘½ä»¤å®ç°æ•°æ®åŒæ­¥</span><br><span class="line"><span class="built_in">cd</span> /data_web02 &amp;&amp; rsync -az --delete -R --delete ./ rsync_backup@172.16.1.41::data_web02 --password-file=/etc/rsync.pass</span><br><span class="line">åœ¨dataåˆ›å»ºæ–‡ä»¶ï¼ŒæŸ¥çœ‹æœåŠ¡ç«¯æ˜¯å¦åŒæ­¥æ•°æ®å³å¯</span><br></pre></td></tr></table></figure><p><img src="../image/study_img/image-20240516091401677.png" alt="image-20240516091401677"></p>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ¥1ã€Rsyncå¤‡ä»½æœåŠ¡å®æˆ˜</title>
      <link href="/posts/8f355f8a.html"/>
      <url>/posts/8f355f8a.html</url>
      
        <content type="html"><![CDATA[<h3 id="Rsynå¤‡ä»½æœåŠ¡å®æˆ˜">Rsynå¤‡ä»½æœåŠ¡å®æˆ˜</h3><p><strong>Rsyncä»‹ç»</strong></p><p>rsyncæ˜¯ä¸€æ¬¾å¼€æºã€å¿«é€Ÿã€å¤šåŠŸèƒ½ã€å¯å®ç°<strong>å…¨é‡åŠå¢é‡</strong>çš„æœ¬åœ°æˆ–<strong>è¿œç¨‹æ•°æ®åŒæ­¥</strong>å¤‡ä»½çš„ä¼˜ç§€å·¥å…·ã€‚rsyncè½¯ä»¶é€‚ç”¨äºUnix/linux/Windowsç­‰å¤šç§æ“ä½œç³»ç»Ÿå¹³å°</p><p>è¿™ä¸ªåŠŸèƒ½ç±»ä¼¼äºsshå¸¦çš„scpå‘½ä»¤ï¼Œä½†æ˜¯åˆä¼˜äºscpå‘½ä»¤çš„åŠŸèƒ½ï¼Œscpæ¯æ¬¡éƒ½æ˜¯å…¨é‡æ‹·è´ï¼Œè€Œrsyncå¯ä»¥å¢é‡æ‹·è´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scpæ¨é€çš„æ˜¯å…¨éƒ¨æ–‡ä»¶ï¼Œæ¨é€é€Ÿåº¦æ…¢</span><br><span class="line">rsyncåªæ¨é€å¢åŠ çš„æ–‡ä»¶ï¼Œæ¨é€é€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–‡ä»¶æ¨é€  è·¨æœºå™¨copyæ–‡ä»¶  -rå¤åˆ¶ç›®å½•</span></span><br><span class="line">scp æºæ–‡ä»¶  root@ç›®æ ‡ä¸»æœºip:/tmp</span><br><span class="line">[root@backup ~]# scp -r 111/ root@10.0.0.7:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ–‡ä»¶æ‹‰å–</span></span><br><span class="line">scp ç”¨æˆ·å@ç›®æ ‡ä¸»æœºip:/è·¯å¾„/æ–‡ä»¶å  ./</span><br><span class="line">[root@backup ~]# scp root@10.0.0.7:/tmp/yum.log ./</span><br></pre></td></tr></table></figure><p>rsyncå®˜æ–¹åœ°å€ï¼šTP<br>rsyncç›‘å¬ç«¯å£ï¼š873<br>rsyncè¿è¡Œæ¨¡å¼ï¼šC/S</p><p>å°æç¤ºï¼šåˆ©ç”¨rsyncè¿˜å¯ä»¥å®ç°åˆ é™¤æ–‡ä»¶å’Œç›®å½•çš„åŠŸèƒ½ï¼Œè¿™åˆç›¸å½“äºrmå‘½ä»¤ï¼Œä¸€ä¸ªrsyncç›¸å½“äºscpã€cpã€rmï¼Œä½†æ˜¯è¿˜ä¼˜äºä»–ä»¬çš„æ¯ä¸€ä¸ªå‘½ä»¤ã€‚</p><p><strong>Rsyncçš„ç‰¹æ€§</strong><br>æ”¯æŒæ‹·è´ç‰¹æ®Šæ–‡ä»¶ï¼Œå¦‚é“¾æ¥æ–‡ä»¶ã€è®¾å¤‡ç­‰ã€‚<br>å¯ä»¥æœ‰æ’é™¤æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•åŒæ­¥çš„åŠŸèƒ½ï¼Œç›¸å½“äºæ‰“åŒ…å‘½ä»¤tarçš„æ’é™¤åŠŸèƒ½ã€‚<br>å¯ä»¥åšåˆ°ä¿æŒåŸæ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€æ—¶é—´ã€è½¯ç¡¬é“¾æ¥ã€å±ä¸»ã€ç»„ç­‰æ‰€æœ‰å±æ€§å‡ä¸æ”¹å˜ â€“pã€‚<br>å¯ä»¥å®ç°å¢é‡åŒæ­¥ï¼Œæ—¢åªåŒæ­¥å‘ç”Ÿå˜åŒ–çš„æ•°æ®ï¼Œå› æ­¤æ•°æ®ä¼ è¾“æ•ˆç‡å¾ˆé«˜ï¼ˆtar-Nï¼‰ã€‚<br>å¯ä»¥ä½¿ç”¨rcpã€rshã€sshç­‰æ–¹å¼æ¥é…åˆä¼ è¾“æ–‡ä»¶ï¼ˆrsyncæœ¬èº«ä¸å¯¹æ•°æ®åŠ å¯†ï¼‰ã€‚<br>å¯ä»¥é€šè¿‡socketï¼ˆè¿›ç¨‹æ–¹å¼ï¼‰ä¼ è¾“æ–‡ä»¶å’Œæ•°æ®ï¼ˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼‰*****ã€‚<br>æ”¯æŒåŒ¿åç”¨æˆ·è®¤è¯ï¼ˆæ— éœ€ç³»ç»Ÿç”¨æˆ·ï¼‰çš„è¿›ç¨‹æ¨¡å¼ä¼ è¾“ï¼Œå¯ä»¥å®ç°æ–¹ä¾¿å®‰å…¨çš„è¿›è¡Œæ•°æ®å¤‡ä»½å’Œé•œåƒã€‚</p><p><strong>å¤‡ä»½ç±»å‹</strong></p><ul><li><p>å…¨é‡å¤‡ä»½</p><p><img src="../image/study_img/image-20240514145710956.png" alt="image-20240514145710956"></p></li></ul><p>å…¨é‡å¤‡ä»½ï¼Œå°†å®¢æˆ·ç«¯æ‰€æœ‰çš„æ•°æ®å†…å®¹file1 file2 file3å…¨éƒ¨å¤‡ä»½è‡³æœåŠ¡ç«¯ (æ•ˆç‡ä½ä¸‹, å ç”¨ç©ºé—´)</p><ul><li><p>å¢é‡å¤‡ä»½</p><p><img src="../image/study_img/image-20240514145739675.png" alt="image-20240514145739675"></p></li></ul><p>å¢é‡å¤‡ä»½ï¼Œå°†å®¢æˆ·ç«¯çš„file2 file3å¢é‡å¤‡ä»½è‡³æœåŠ¡ç«¯ (æé«˜å¤‡ä»½æ•ˆç‡,èŠ‚çœç©ºé—´, é€‚åˆå¼‚åœ°å¤‡ä»½ )</p><p><strong>Rsyncçš„åº”ç”¨åœºæ™¯</strong></p><p><em>1.<em>æ¨</em>:</em> æ‰€æœ‰ä¸»æœºæ¨é€æœ¬åœ°æ•°æ®è‡³<em>Rsync</em>å¤‡ä»½æœåŠ¡å™¨ï¼Œä¼šå¯¼è‡´æ•°æ®åŒæ­¥ç¼“æ…¢*(<em>é€‚åˆå°‘é‡æ•°æ®å¤‡ä»½</em>)*</p><p><img src="../image/study_img/image-20240514150109176.png" alt="image-20240514150109176"></p><p><em>2.<em>æ‹‰</em>: rsync</em>å¤‡ä»½æœåŠ¡ç«¯æ‹‰å–æ‰€æœ‰ä¸»æœºä¸Šçš„æ•°æ®ï¼Œä¼šå¯¼è‡´å¤‡ä»½æœåŠ¡å™¨å¼€é”€å¤§</p><p><img src="../image/study_img/image-20240514150214345.png" alt="image-20240514150214345"></p><p>*3.*å¤§é‡æœåŠ¡å™¨å¤‡ä»½åœºæ™¯</p><p><img src="../image/study_img/image-20240514150323325.png" alt="image-20240514150323325"></p><p>*4.*å¼‚åœ°å¤‡ä»½å®ç°æ€è·¯</p><p><img src="../image/study_img/image-20240514150351675.png" alt="image-20240514150351675"></p><p><strong>rsyncä¼ è¾“æ¨¡å¼</strong></p><ul><li>æœ¬åœ°æ¨¡å¼</li><li>è¿œç¨‹æ¨¡å¼</li><li>å®ˆæŠ¤æ¨¡å¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬åœ°æ¨¡å¼ï¼šç±»ä¼¼cpå‘½ä»¤ï¼Œæœ¬åœ°æ‹·è´ç›®å½•æˆ–æ–‡ä»¶</span></span><br><span class="line">[root@web01 ~]# rsync /root/base.sh /usr/local/</span><br><span class="line">rsync [OPTION...] SRC... [DEST]</span><br><span class="line">rsync [é€‰é¡¹...] æºæ–‡ä»¶... ç›®æ ‡è·¯å¾„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿œç¨‹æ¨¡å¼ï¼šç±»ä¼¼scpå‘½ä»¤ åŸºäºsshåè®®</span></span><br><span class="line"><span class="comment">## æ¨Pushï¼šæŠŠæœ¬æœºçš„æ–‡ä»¶æ¨é€åˆ°å…¶ä»–æœºå™¨</span></span><br><span class="line">rsync [OPTION...] [USER@]HOST:SRC... [DEST]</span><br><span class="line">rsync [é€‰é¡¹...] [ç”¨æˆ·@]ä¸»æœºIP:æºæ–‡ä»¶... æœ¬æœºçš„ç›®æ ‡è·¯å¾„</span><br><span class="line">[root@web01 ~]# scp 1.txt 10.0.0.41:/opt</span><br><span class="line">[root@web01 ~]# rsync 1.txt 10.0.0.41:/usr/local</span><br><span class="line"></span><br><span class="line"><span class="comment">## æ‹‰pull:å°†å…¶ä»–æœºå™¨çš„æ–‡ä»¶æ‹‰åˆ°æœ¬æœº</span></span><br><span class="line">rsync [OPTION...] SRC... [USER@]HOST:DEST</span><br><span class="line">rsync [é€‰é¡¹...] æœ¬æœºçš„æºæ–‡ä»¶ [ç”¨æˆ·@]ä¸»æœºIP:ç›®æ ‡è·¯å¾„</span><br><span class="line">[root@web01 ~]# scp root@10.0.0.8:/root/base.sh ./</span><br><span class="line">[root@web01 ~]# rsync root@10.0.0.8:/root/base.sh ./</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®ˆæŠ¤è¿›ç¨‹</span></span><br><span class="line">Pull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]</span><br><span class="line">      rsync [é€‰é¡¹...] [åŒ¿åç”¨æˆ·@]ä¸»æœºIP::æ¨¡å—å... ç›®æ ‡è·¯å¾„</span><br><span class="line">      rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]</span><br><span class="line"></span><br><span class="line">Push: rsync [OPTION...] SRC... [USER@]HOST::DEST</span><br><span class="line">      rsync [é€‰é¡¹...] æºæ–‡ä»¶... [åŒ¿åç”¨æˆ·@]ä¸»æœºIP::æ¨¡å—å</span><br><span class="line">      rsync [OPTION...] SRC... rsync://[USER@]HOST[:PORT]/DEST</span><br><span class="line">      rsync [é€‰é¡¹...] æºæ–‡ä»¶... [åŒ¿åç”¨æˆ·@]ä¸»æœºIP::æ¨¡å—å</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rzä¸èƒ½ä¸Šä¼ å¤§äº4Gçš„æ–‡ä»¶ï¼Œå¦‚æœæƒ³è¦ä¸Šä¼ å¤§äº4gçš„æ–‡ä»¶ï¼Œå¯ä»¥åœ¨windowsä¸Šä½¿ç”¨cmderåˆ©ç”¨scpå»ä¸Šä¼ </span><br><span class="line"></span><br><span class="line">-avz å¸¸ç”¨çš„æ­é…é€‰é¡¹</span><br></pre></td></tr></table></figure><p>rsyncçš„é€‰é¡¹</p><table><thead><tr><th>é€‰é¡¹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>-a</td><td>å½’æ¡£ä¼ è¾“</td></tr><tr><td>-v</td><td>æ˜¾ç¤ºä¼ è¾“è¿‡ç¨‹</td></tr><tr><td>-z</td><td>å‹ç¼©ä¼ è¾“</td></tr><tr><td>â€“delete</td><td>æ— å·®å¼‚ä¼ è¾“(ä¼šåˆ é™¤ä¸å­˜åœ¨çš„æ–‡ä»¶)</td></tr></tbody></table><p><strong>rsyncå®æˆ˜</strong></p><p><strong>ç¯å¢ƒå‡†å¤‡</strong></p><table><thead><tr><th>ä¸»æœºå</th><th>å…¬ç½‘IP</th><th>å†…ç½‘IP</th><th>ä½œç”¨</th><th>åº”ç”¨</th></tr></thead><tbody><tr><td>backup</td><td>10.0.0.41</td><td>172.16.1.41</td><td>ä»“åº“(å­˜å‚¨æ‰€æœ‰å¤‡ä»½æ•°æ®çš„æœºå™¨)ï¼ŒæœåŠ¡ç«¯</td><td>rsyncçš„æœåŠ¡ç«¯</td></tr><tr><td>web01</td><td>10.0.0.7</td><td>172.16.1.7</td><td>éœ€è¦å¤‡ä»½æ•°æ®çš„æœºå™¨ï¼Œå®¢æˆ·ç«¯</td><td>rsyncçš„å®¢æˆ·ç«¯</td></tr><tr><td>web02</td><td>10.0.0.8</td><td>172.16.1.8</td><td>éœ€è¦å¤‡ä»½æ•°æ®çš„æœºå™¨ï¼Œå®¢æˆ·ç«¯</td><td>rsyncçš„å®¢æˆ·ç«¯</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">1ã€å®‰è£…rsyncçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯</span><br><span class="line">yum -y install rsync</span><br><span class="line">2ã€ä¿®æ”¹æœåŠ¡ç«¯é…ç½®æ–‡ä»¶</span><br><span class="line">vim /etc/rsyncd.conf</span><br><span class="line">åˆ é™¤é‡Œé¢çš„å…¨éƒ¨å†…å®¹ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹</span><br><span class="line">[root@backup ~]# <span class="built_in">cat</span> /etc/rsyncd.conf</span><br><span class="line">uid = rsync</span><br><span class="line">gid = rsync</span><br><span class="line">port = 873</span><br><span class="line">fake super = <span class="built_in">yes</span></span><br><span class="line">use <span class="built_in">chroot</span> = no</span><br><span class="line">max connections = 200</span><br><span class="line"><span class="built_in">timeout</span> = 600</span><br><span class="line">ignore errors</span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line">list = <span class="literal">false</span></span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup</span><br><span class="line">secrets file = /etc/rsync.passwd</span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log</span><br><span class="line"><span class="comment">#####################################é‡ç‚¹æ˜¯ä¸‹é¢è¿™å‡ è¡Œ</span></span><br><span class="line">[backup]</span><br><span class="line">comment = welcome to backup!</span><br><span class="line">path = /backup</span><br><span class="line"> </span><br><span class="line">--- é…ç½®è¯¦è§£</span><br><span class="line">[root@backup ~]# vim /etc/rsyncd.conf</span><br><span class="line">uid = rsync                      <span class="comment"># è¿è¡ŒrsyncæœåŠ¡çš„ç”¨æˆ·</span></span><br><span class="line">gid = rsync                      <span class="comment"># è¿è¡ŒrsyncæœåŠ¡çš„ç”¨æˆ·ç»„</span></span><br><span class="line">port = 873                       <span class="comment"># ç›‘å¬ç«¯å£</span></span><br><span class="line">fake super = <span class="built_in">yes</span>                 <span class="comment"># æ— éœ€è®©rsyncä»¥rootèº«ä»½è¿è¡Œï¼Œå…è®¸æ¥æ”¶æ–‡ä»¶çš„å®Œæ•´å±æ€§</span></span><br><span class="line">use <span class="built_in">chroot</span> = no                  <span class="comment"># ç¦é”¢æ¨é€çš„æ•°æ®è‡³æŸä¸ªç›®å½•, ä¸å…è®¸è·³å‡ºè¯¥ç›®å½•</span></span><br><span class="line">max connections = 200            <span class="comment"># æœ€å¤§è¿æ¥æ•°ï¼Œæ¥æ”¶200ä¸ªå®¢æˆ·ç«¯æ¨é€æ•°æ®</span></span><br><span class="line"><span class="built_in">timeout</span> = 600                    <span class="comment"># è¶…æ—¶æ—¶é—´ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…æ•°æ®æ²¡æœ‰ä¼ å®Œï¼Œè‡ªåŠ¨æ–­å¼€</span></span><br><span class="line">ignore errors                    <span class="comment"># å¿½ç•¥é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span>                <span class="comment"># å¯¹å¤‡ä»½æ•°æ®å¯è¯»å†™ï¼Œfalseå…³é—­åªè¯»</span></span><br><span class="line">list = <span class="literal">false</span>                     <span class="comment"># ä¸å…è®¸æŸ¥çœ‹æ¨¡å—ä¿¡æ¯</span></span><br><span class="line">auth <span class="built_in">users</span> = rsync_backup        <span class="comment"># è®¤è¯ç”¨æˆ·(åŒ¿åç”¨æˆ·)</span></span><br><span class="line">secrets file = /etc/rsync.passwd <span class="comment"># å®šä¹‰rsyncæœåŠ¡ç”¨æˆ·è¿æ¥è®¤è¯å¯†ç æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="built_in">log</span> file = /var/log/rsyncd.log   <span class="comment">#æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#####################################é‡ç‚¹æ˜¯ä¸‹é¢è¿™å‡ è¡Œ</span></span><br><span class="line">[backup]                <span class="comment"># å®šä¹‰æ¨¡å—ä¿¡æ¯</span></span><br><span class="line">comment = commit        <span class="comment"># è‡ªå®šä¹‰æ¨¡å—æ³¨é‡Šä¿¡æ¯</span></span><br><span class="line">path = /backup          <span class="comment"># å®šä¹‰æœåŠ¡ç«¯æ¥æ”¶å¤‡ä»½æ•°æ®ç›®å½•</span></span><br><span class="line"></span><br><span class="line">3ã€åˆ›å»ºæœåŠ¡å¯åŠ¨ç”¨æˆ·</span><br><span class="line">useradd rsync -s /sbin/nologin  -M</span><br><span class="line">4ã€åˆ›å»ºå¤‡ä»½ç›®å½•å¹¶æˆæƒç›®å½•</span><br><span class="line"><span class="built_in">mkdir</span> -p /backup</span><br><span class="line"><span class="built_in">chown</span>  -R rsync.rsync /backup</span><br><span class="line">5ã€ç¼–å†™å¯†ç æ–‡ä»¶</span><br><span class="line">vim /etc/rsync.passwd</span><br><span class="line">rsync_backupï¼š123</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/rsync.passwd</span><br><span class="line">6ã€å¯åŠ¨æœåŠ¡ï¼Œå¼€æœºè‡ªå¯åŠ¨</span><br><span class="line">systemctl start rsync</span><br><span class="line">systemctl enabled rsync</span><br><span class="line">7ã€æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸ</span><br><span class="line">[root@backup ~]# ps -aux |grep rsync</span><br><span class="line">root       6046  0.0  0.1 114856  1136 ?        Ss   22:32   0:00 /usr/bin/rsync --daemon --no-detach</span><br><span class="line">root       7279  0.0  0.0 112812   980 pts/0    R+   23:37   0:00 grep --color=auto rsync</span><br><span class="line">[root@backup ~]# netstat -lntup|grep 873</span><br><span class="line">tcp        0      0 0.0.0.0:873             0.0.0.0:*               LISTEN      6046/rsync          </span><br><span class="line">tcp6       0      0 :::873                  :::*                    LISTEN      6046/rsync  </span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯æ¨é€å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@web01 ~]# rsync -avz base.sh rsync_backup@172.16.1.41::backup</span><br><span class="line">Password: 123</span><br><span class="line"></span><br><span class="line"><span class="comment">## rsyncå…äº¤äº’æ¨é€</span></span><br><span class="line"><span class="comment"># 1.å®¢æˆ·ç«¯é…ç½®å¯†ç æ–‡ä»¶ï¼ˆæ­¤å¤„éœ€å’ŒæœåŠ¡ç«¯secrets fileæ–‡ä»¶å¯†ç å¯¹åº”ä¸Šï¼‰</span></span><br><span class="line">[root@web01 ~]# vi /etc/asm_rsync.pass</span><br><span class="line">123  <span class="comment">#å¯†ç </span></span><br><span class="line"><span class="comment"># 2.å®¢æˆ·ç«¯å¯†ç æ–‡ä»¶æˆæƒ</span></span><br><span class="line">[root@web01 ~]# <span class="built_in">chmod</span> 600 /etc/asm_rsync.pass</span><br><span class="line"><span class="comment"># 3.å®¢æˆ·ç«¯æ¨é€æ•°æ®</span></span><br><span class="line">[root@web01 ~]# rsync -avz /etc rsync_backup@172.16.1.41::backup --password-file=/etc/asm_rsync.pass</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Markdownè¯­æ³•ä¸å¤–æŒ‚æ ‡ç­¾å†™æ³•æ±‡æ€»</title>
      <link href="/posts/2013454d.html"/>
      <url>/posts/2013454d.html</url>
      
        <content type="html"><![CDATA[<h1>1.Markdownè¯­æ³•è‡ªå¸¦æ ¼å¼</h1><div class="note info flat"><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/u014061630/article/details/81359144">Markdownè¯­æ³•å›¾æ–‡å…¨é¢è¯¦è§£(10åˆ†é’Ÿå­¦ä¼š)</a></p></div><div class="note warning flat"><p>æ³¨æ„ï¼šæ­¤é¡µé¢å¶å°”ä¼šå­˜åœ¨CSSå†²çªé—®é¢˜!</p></div><h2 id="1-1-ä»£ç å—">1.1 ä»£ç å—</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">\```shell</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCodeç»ˆç«¯</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmderç»ˆç«¯</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br><span class="line">\```</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VSCodeç»ˆç«¯</span></span><br><span class="line">hexo clean; hexo s</span><br><span class="line">hexo clean; hexo g; hexo d</span><br><span class="line">git add .; git commit -m &quot;npm publish&quot;; npm version patch; </span><br><span class="line">git push</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Cmderç»ˆç«¯</span></span><br><span class="line">hexo clean &amp;&amp; hexo s</span><br><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br><span class="line">git add . &amp;&amp; git commit -m &quot;npm publish&quot; &amp;&amp; npm version patch</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-2-å¤šçº§æ ‡é¢˜">1.2 å¤šçº§æ ‡é¢˜</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># H1</span></span><br><span class="line"><span class="section">## H2</span></span><br><span class="line"><span class="section">### H3</span></span><br><span class="line"><span class="section">#### H4</span></span><br><span class="line"><span class="section">##### H5</span></span><br><span class="line"><span class="section">###### H6</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><p>è§æœ¬æ–‡ç« æ ‡é¢˜!</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-3-æ–‡å­—æ ·å¼">1.3 æ–‡å­—æ ·å¼</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">u</span>&gt;</span></span>ä¸‹åˆ’çº¿æ¼”ç¤º<span class="language-xml"><span class="tag">&lt;/<span class="name">u</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">æ–‡å­—<span class="strong">**åŠ ç²—**</span>æ¼”ç¤º</span><br><span class="line"></span><br><span class="line">æ–‡å­—<span class="emphasis">*æ–œä½“*</span>æ¼”ç¤º</span><br><span class="line"></span><br><span class="line">æ–‡æœ¬<span class="code">`é«˜äº®`</span>æ¼”ç¤º</span><br><span class="line"></span><br><span class="line">æ–‡æœ¬~~åˆ é™¤~~çº¿æ¼”ç¤º</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">size</span> = <span class="string">5</span>&gt;</span></span>5å·å­—<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">face</span>=<span class="string">&quot;é»‘ä½“&quot;</span>&gt;</span></span>é»‘ä½“<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">blue</span>&gt;</span></span>è“è‰²<span class="language-xml"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">td</span> <span class="attr">bgcolor</span>=<span class="string">MistyRose</span>&gt;</span></span>è¿™é‡Œçš„èƒŒæ™¯è‰²æ˜¯ï¼šMistyRosenï¼Œæ­¤å¤„è¾“å…¥ä»»æ„æƒ³è¾“å…¥çš„å†…å®¹<span class="language-xml"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><p><u>ä¸‹åˆ’çº¿æ¼”ç¤º</u></p><p>æ–‡å­—<strong>åŠ ç²—</strong>æ¼”ç¤º</p><p>æ–‡å­—<em>æ–œä½“</em>æ¼”ç¤º</p><p>æ–‡æœ¬<code>é«˜äº®</code>æ¼”ç¤º</p><p>æ–‡æœ¬<s>åˆ é™¤</s>çº¿æ¼”ç¤º</p><p><font size = 5>5å·å­—</font><br><font face="é»‘ä½“">é»‘ä½“</font><br><font color=blue>è“è‰²</font></p><table><tr><td bgcolor=MistyRose>è¿™é‡Œçš„èƒŒæ™¯è‰²æ˜¯ï¼šMistyRosenï¼Œæ­¤å¤„è¾“å…¥ä»»æ„æƒ³è¾“å…¥çš„å†…å®¹</td></tr></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><div class="note info flat"><p>ä¸Šè¿°è¦ç‚¹å¯å‚è€ƒ:<a href="https://blog.csdn.net/qq_43732429/article/details/108034518">ã€Markdownè¯­æ³•ã€‘å­—ä½“é¢œè‰²å¤§å°åŠæ–‡å­—åº•è‰²è®¾ç½®</a></p></div><h2 id="1-4-å¼•ç”¨">1.4 å¼•ç”¨</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt;  Java</span></span><br><span class="line"><span class="quote">&gt; äºŒçº§å¼•ç”¨æ¼”ç¤º</span></span><br><span class="line"><span class="quote">&gt; MySQL</span></span><br><span class="line"><span class="quote">&gt; &gt;å¤–é”®</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;äº‹åŠ¡</span></span><br><span class="line"><span class="quote">&gt; &gt;</span></span><br><span class="line"><span class="quote">&gt; &gt;<span class="strong">**è¡Œçº§é”**</span>(å¼•ç”¨å†…éƒ¨ä¸€æ ·å¯ä»¥ç”¨æ ¼å¼)</span></span><br><span class="line"><span class="quote">&gt; </span></span><br><span class="line"><span class="quote">&gt; ....</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><blockquote><p>Java<br>äºŒçº§å¼•ç”¨æ¼”ç¤º<br>MySQL</p><blockquote><p>å¤–é”®</p><p>äº‹åŠ¡</p><p><strong>è¡Œçº§é”</strong>(å¼•ç”¨å†…éƒ¨ä¸€æ ·å¯ä»¥ç”¨æ ¼å¼)</p></blockquote><p>â€¦</p></blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-5-åˆ†å‰²çº¿">1.5 åˆ†å‰²çº¿</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="strong">**<span class="emphasis">*</span></span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><hr><hr><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-6-åˆ—è¡¨-è·Ÿç©ºæ ¼éƒ½å¯ä»¥">1.6 åˆ—è¡¨(*,+,-è·Ÿç©ºæ ¼éƒ½å¯ä»¥)</h2><h3 id="1-6-1-æ— åºåˆ—è¡¨">1.6.1 æ— åºåˆ—è¡¨</h3><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> Java</span><br><span class="line"><span class="bullet">*</span> Python</span><br><span class="line"><span class="bullet">*</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">+</span> Java</span><br><span class="line"><span class="bullet">+</span> Python</span><br><span class="line"><span class="bullet">+</span> ...</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> Java</span><br><span class="line"><span class="bullet">-</span> Python</span><br><span class="line"><span class="bullet">-</span> ...</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ul><li>Java</li><li>Python</li><li>â€¦</li></ul><ul><li>Java</li><li>Python</li><li>â€¦</li></ul><ul><li>Java</li><li>Python</li><li>â€¦</li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h3 id="1-6-2-æœ‰åºåˆ—è¡¨">1.6.2 æœ‰åºåˆ—è¡¨</h3><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># æ³¨æ„åé¢æœ‰ç©ºæ ¼</span></span><br><span class="line"><span class="bullet">1.</span> </span><br><span class="line"><span class="bullet">2.</span> </span><br><span class="line"><span class="bullet">3.</span> </span><br><span class="line"><span class="bullet">4.</span> </span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li></li><li></li><li></li><li></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-7-å›¾ç‰‡">1.7 å›¾ç‰‡</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># æœ¬åœ°å›¾ç‰‡</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/assets/pusheencode.webp&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;ç¤ºä¾‹å›¾ç‰‡&quot;</span> <span class="attr">style</span>=<span class="string">&quot;zoom:50%;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="section"># åœ¨çº¿å›¾ç‰‡</span></span><br><span class="line">![<span class="string">code</span>](<span class="link">https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png</span>)</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><p>æœ¬åœ°å›¾ç‰‡:<br><img src="/assets/pusheencode.webp" alt="ç¤ºä¾‹å›¾ç‰‡" style="zoom:50%;" /><br>åœ¨çº¿å›¾ç‰‡:<br><img src="https://cdn.jsdelivr.net/gh/fomalhaut1998/markdown_pic/img/code.png" alt="code"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-8-è¡¨æ ¼">1.8 è¡¨æ ¼</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| é¡¹ç›®æ ‡å· | èµ„é‡‘     | å¤‡æ³¨ |</span><br><span class="line">| -------- | -------- | ---- |</span><br><span class="line">| 1        | 100ï¼Œ000 | æ—    |</span><br><span class="line">| 2        | 200ï¼Œ000 | æ—    |</span><br><span class="line">| 3        | 300,600  | é‡è¦ |</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><table><thead><tr><th>é¡¹ç›®æ ‡å·</th><th>èµ„é‡‘</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1</td><td>100ï¼Œ000</td><td>æ— </td></tr><tr><td>2</td><td>200ï¼Œ000</td><td>æ— </td></tr><tr><td>3</td><td>300,600</td><td>é‡è¦</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="1-9-å…¬å¼">1.9 å…¬å¼</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$$</span><br><span class="line">\Gamma(z)=\int<span class="emphasis">_0^\infty t^&#123;z-1&#125;e^&#123;-t&#125;dt.</span></span><br><span class="line"><span class="emphasis">$$</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><p>$$<br>\Gamma(z)=\int_0^\infty t^{z-1}e^{-t}dt.<br>$$</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h1>2.Butterflyå¤–æŒ‚æ ‡ç­¾</h1><div class="note info flat"><p>è¿™éƒ¨åˆ†å‚è€ƒå®‰çŸ¥é±¼:<a href="https://anzhiy.cn/posts/7d58.html">åŸºäºButterflyçš„å¤–æŒ‚æ ‡ç­¾å¼•å…¥</a></p></div><h2 id="2-1-è¡Œå†…æ–‡æœ¬æ ·å¼-text">2.1 è¡Œå†…æ–‡æœ¬æ ·å¼ text</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% u æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% emp æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% wavy æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% del æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% kbd æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% psw æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> å¸¦ &#123;% u ä¸‹åˆ’çº¿ %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">2.</span> å¸¦ &#123;% emp ç€é‡å· %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">3.</span> å¸¦ &#123;% wavy æ³¢æµªçº¿ %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">4.</span> å¸¦ &#123;% del åˆ é™¤çº¿ %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">5.</span> é”®ç›˜æ ·å¼çš„æ–‡æœ¬ &#123;% kbd command %&#125; + &#123;% kbd D %&#125;</span><br><span class="line"><span class="bullet">6.</span> å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š&#123;% psw è¿™é‡Œæ²¡æœ‰éªŒè¯ç  %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><ol><li>å¸¦ <u>ä¸‹åˆ’çº¿</u> çš„æ–‡æœ¬</li><li>å¸¦ <emp>ç€é‡å·</emp> çš„æ–‡æœ¬</li><li>å¸¦ <wavy>æ³¢æµªçº¿</wavy> çš„æ–‡æœ¬</li><li>å¸¦ <del>åˆ é™¤çº¿</del> çš„æ–‡æœ¬</li><li>é”®ç›˜æ ·å¼çš„æ–‡æœ¬ <kbd>command</kbd> + <kbd>D</kbd></li><li>å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š<psw>è¿™é‡Œæ²¡æœ‰éªŒè¯ç </psw></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-2-è¡Œå†…æ–‡æœ¬-span">2.2 è¡Œå†…æ–‡æœ¬ span</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% span æ ·å¼å‚æ•°(å‚æ•°ä»¥ç©ºæ ¼åˆ’åˆ†), æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>å­—ä½“</code>: logo, code</li><li><code>é¢œè‰²</code>: red,yellow,green,cyan,blue,gray</li><li><code>å¤§å°</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>å¯¹é½æ–¹å‘</code>: left, center, right</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> å½©è‰²æ–‡å­—</span><br><span class="line">åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š&#123;% span red, çº¢è‰² %&#125;ã€&#123;% span yellow, é»„è‰² %&#125;ã€&#123;% span green, ç»¿è‰² %&#125;ã€&#123;% span cyan, é’è‰² %&#125;ã€&#123;% span blue, è“è‰² %&#125;ã€&#123;% span gray, ç°è‰² %&#125;ã€‚</span><br><span class="line"><span class="bullet">-</span> è¶…å¤§å·æ–‡å­—</span><br><span class="line">æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚</span><br><span class="line">&#123;% span center logo large, Volantis %&#125;</span><br><span class="line">&#123;% span center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><ul><li>å½©è‰²æ–‡å­—<br>åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š<span class='p red'>çº¢è‰²</span>ã€<span class='p yellow'>é»„è‰²</span>ã€<span class='p green'>ç»¿è‰²</span>ã€<span class='p cyan'>é’è‰²</span>ã€<span class='p blue'>è“è‰²</span>ã€<span class='p gray'>ç°è‰²</span>ã€‚</li><li>è¶…å¤§å·æ–‡å­—<br>æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚<br><span class='p center logo large'>Volantis</span><br><span class='p center small'>A Wonderful Theme for Hexo</span></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-3-æ®µè½æ–‡æœ¬-p">2.3 æ®µè½æ–‡æœ¬ p</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% p æ ·å¼å‚æ•°(å‚æ•°ä»¥ç©ºæ ¼åˆ’åˆ†), æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>å­—ä½“</code>: logo, code</li><li><code>é¢œè‰²</code>: red,yellow,green,cyan,blue,gray</li><li><code>å¤§å°</code>: small, h4, h3, h2, h1, large, huge, ultra</li><li><code>å¯¹é½æ–¹å‘</code>: left, center, right</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> å½©è‰²æ–‡å­—</span><br><span class="line">åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š&#123;% p red, çº¢è‰² %&#125;ã€&#123;% p yellow, é»„è‰² %&#125;ã€&#123;% p green, ç»¿è‰² %&#125;ã€&#123;% p cyan, é’è‰² %&#125;ã€&#123;% p blue, è“è‰² %&#125;ã€&#123;% p gray, ç°è‰² %&#125;ã€‚</span><br><span class="line"><span class="bullet">-</span> è¶…å¤§å·æ–‡å­—</span><br><span class="line">æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚</span><br><span class="line">&#123;% p center logo large, Volantis %&#125;</span><br><span class="line">&#123;% p center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><ul><li>å½©è‰²æ–‡å­—<br>åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š<p class='p red'>çº¢è‰²</p>ã€<p class='p yellow'>é»„è‰²</p>ã€<p class='p green'>ç»¿è‰²</p>ã€<p class='p cyan'>é’è‰²</p>ã€<p class='p blue'>è“è‰²</p>ã€<p class='p gray'>ç°è‰²</p>ã€‚</li><li>è¶…å¤§å·æ–‡å­—<br>æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚</li></ul><p class='p center logo large'>Volantis</p><p class='p center small'>A Wonderful Theme for Hexo</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-4-å¼•ç”¨note">2.4 å¼•ç”¨note</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">é€šç”¨é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">è¯­æ³•æ ¼å¼</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -5">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">note:</span><br><span class="line">  # Note tag style values:</span><br><span class="line">  #  - simple    bs-callout old alert style. Default.</span><br><span class="line">  #  - modern    bs-callout new (v2-v3) alert style.</span><br><span class="line">  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span><br><span class="line">  #  - disabled  disable all CSS styles import of note tag.</span><br><span class="line">  style: simple</span><br><span class="line">  icons: false</span><br><span class="line">  border<span class="emphasis">_radius: 3</span></span><br><span class="line"><span class="emphasis">  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line"><span class="emphasis">  # Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line"><span class="emphasis">  light_</span>bg<span class="emphasis">_offset: 0</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># è‡ªå¸¦icon</span></span><br><span class="line">&#123;% note [class] [no-icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"><span class="section"># å¤–éƒ¨icon</span></span><br><span class="line">&#123;% note [color] [icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.è‡ªå¸¦icon</p><table><thead><tr><th>å‚æ•°</th><th style="text-align:center">ç”¨æ³•</th></tr></thead><tbody><tr><td>class</td><td style="text-align:center">ã€å¯é€‰ã€‘æ ‡è¯†ï¼Œä¸åŒçš„æ ‡è¯†æœ‰ä¸åŒçš„é…è‰² ï¼ˆ default / primary / success / info / warning / danger ï¼‰</td></tr><tr><td>no-icon</td><td style="text-align:center">ã€å¯é€‰ã€‘ä¸æ˜¾ç¤º icon</td></tr><tr><td>style</td><td style="text-align:center">ã€å¯é€‰ã€‘å¯ä»¥è¦†ç›–é…ç½®ä¸­çš„ style ï¼ˆsimple/modern/flat/disabledï¼‰</td></tr></tbody></table><p>2.å¤–éƒ¨icon</p><table><thead><tr><th>å‚æ•°</th><th style="text-align:center">ç”¨æ³•</th></tr></thead><tbody><tr><td>class</td><td style="text-align:center">ã€å¯é€‰ã€‘æ ‡è¯†ï¼Œä¸åŒçš„æ ‡è¯†æœ‰ä¸åŒçš„é…è‰² ï¼ˆ default / blue / pink / red / purple / orange / green ï¼‰</td></tr><tr><td>no-icon</td><td style="text-align:center">ã€å¯é€‰ã€‘å¯é…ç½®è‡ªå®šä¹‰ icon (åªæ”¯æŒ fontawesome å›¾æ ‡, ä¹Ÿå¯ä»¥é…ç½® no-icon )</td></tr><tr><td>style</td><td style="text-align:center">ã€å¯é€‰ã€‘å¯ä»¥è¦†ç›–é…ç½®ä¸­çš„ style ï¼ˆsimple/modern/flat/disabledï¼‰</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><details class="folding-tag" blue><summary> 1.è‡ªå¸¦icon </summary>              <div class='content'>              <p>1.<code>simple</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note simple %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default simple %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary simple %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success simple %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info simple %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning simple %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger simple %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note modern %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default modern %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary modern %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success modern %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info modern %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning modern %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger modern %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note flat %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default flat %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary flat %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success flat %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info flat %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning flat %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger flat %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note disabled %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default disabled %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary disabled %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success disabled %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info disabled %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning disabled %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger disabled %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note default no-icon %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note primary no-icon %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note success no-icon %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note info no-icon %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note warning no-icon %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note danger no-icon %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" blue><summary> 2.å¤–éƒ¨icon </summary>              <div class='content'>              <p>1.<code>simple</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; simple %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; simple %&#125;2021å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; simple %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; simple%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; simple %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; simple %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; simple %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>2.<code>modern</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; modern %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern %&#125;2021å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; modern %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; modern%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; modern %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; modern %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; modern %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>3.<code>flat</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; flat %&#125;2021å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; flat %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; flat%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; flat %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; flat %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>4.<code>disabled</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; disabled %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; disabled %&#125;2021å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; disabled %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red &#x27;fas fa-fan&#x27; disabled %&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; disabled %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; disabled %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; disabled %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p>5.<code>no-icon</code>æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note blue no-icon %&#125;2021å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note pink no-icon %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note red no-icon %&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note orange no-icon %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note purple no-icon %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% note green no-icon %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -5"><details class="folding-tag" blue><summary> 1.è‡ªå¸¦icon </summary>              <div class='content'>              <p>1.<code>simple</code>æ ·å¼</p><div class="note simple"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default simple"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary simple"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success simple"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info simple"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning simple"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger simple"><p>danger æç¤ºå—æ ‡ç­¾</p></div>2.`modern`æ ·å¼<div class="note modern"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default modern"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary modern"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success modern"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info modern"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning modern"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger modern"><p>danger æç¤ºå—æ ‡ç­¾</p></div><p>3.<code>flat</code>æ ·å¼</p><div class="note flat"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default flat"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary flat"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success flat"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info flat"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning flat"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger flat"><p>danger æç¤ºå—æ ‡ç­¾</p></div><p>4.<code>disabled</code>æ ·å¼</p><div class="note disabled"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default disabled"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary disabled"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success disabled"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info disabled"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning disabled"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger disabled"><p>danger æç¤ºå—æ ‡ç­¾</p></div><p>5.<code>no-icon</code>æ ·å¼</p><div class="note no-icon flat"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default no-icon flat"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary no-icon flat"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success no-icon flat"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info no-icon flat"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning no-icon flat"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger no-icon flat"><p>danger æç¤ºå—æ ‡ç­¾</p></div>              </div>            </details><details class="folding-tag" blue><summary> 2.å¤–éƒ¨icon </summary>              <div class='content'>              <p>1.<code>simple</code>æ ·å¼</p><div class="note icon-padding simple"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding simple"><i class="note-icon fas fa-bullhorn"></i><p>2021å¹´å¿«åˆ°äº†â€¦</p></div><div class="note pink icon-padding simple"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-padding simple"><i class="note-icon fas fa-fan"></i><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding simple"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding simple"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding simple"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p>2.<code>modern</code>æ ·å¼</p><div class="note icon-padding modern"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p>2021å¹´å¿«åˆ°äº†â€¦</p></div><div class="note pink icon-padding modern"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-padding modern"><i class="note-icon fas fa-fan"></i><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding modern"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p>3.<code>flat</code>æ ·å¼</p><div class="note icon-padding flat"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding flat"><i class="note-icon fas fa-bullhorn"></i><p>2021å¹´å¿«åˆ°äº†â€¦</p></div><div class="note pink icon-padding flat"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-padding flat"><i class="note-icon fas fa-fan"></i><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding flat"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding flat"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding flat"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p>4.<code>disabled</code>æ ·å¼</p><div class="note icon-padding disabled"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding disabled"><i class="note-icon fas fa-bullhorn"></i><p>2021å¹´å¿«åˆ°äº†â€¦</p></div><div class="note pink icon-padding disabled"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-padding disabled"><i class="note-icon fas fa-fan"></i><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding disabled"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding disabled"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding disabled"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p>5.<code>no-icon</code>æ ·å¼</p><div class="note no-icon flat"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue no-icon flat"><p>2021å¹´å¿«åˆ°äº†â€¦</p></div><div class="note pink no-icon flat"><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red no-icon flat"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange no-icon flat"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple no-icon flat"><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green no-icon flat"><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-5-ä¸Šæ ‡æ ‡ç­¾-tip">2.5 ä¸Šæ ‡æ ‡ç­¾ tip</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [å‚æ•°ï¼Œå¯é€‰] %&#125;æ–‡æœ¬å†…å®¹&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>æ ·å¼</code>: success,error,warning,bolt,ban,home,sync,cogs,key,bell</li><li><code>è‡ªå®šä¹‰å›¾æ ‡</code>: æ”¯æŒfontawesomeã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip %&#125;default&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip info %&#125;info&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip success %&#125;success&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip error %&#125;error&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip warning %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bolt %&#125;bolt&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban %&#125;ban&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip home %&#125;home&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip sync %&#125;sync&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip cogs %&#125;cogs&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip key %&#125;key&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bell %&#125;bell&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip fa-atom %&#125;è‡ªå®šä¹‰font awesomeå›¾æ ‡&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><div class="tip "><p>default</p></div><div class="tip info"><p>info</p></div><div class="tip success"><p>success</p></div><div class="tip error"><p>error</p></div><div class="tip warning"><p>warning</p></div><div class="tip bolt"><p>bolt</p></div><div class="tip ban"><p>ban</p></div><div class="tip home"><p>home</p></div><div class="tip sync"><p>sync</p></div><div class="tip cogs"><p>cogs</p></div><div class="tip key"><p>key</p></div><div class="tip bell"><p>bell</p></div><div class="tip fa-atom"><p>è‡ªå®šä¹‰font awesomeå›¾æ ‡</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-6-åŠ¨æ€æ ‡ç­¾-anima">2.6 åŠ¨æ€æ ‡ç­¾ anima</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [å‚æ•°ï¼Œå¯é€‰] %&#125;æ–‡æœ¬å†…å®¹&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><div class="note info flat"><ol><li>å°†æ‰€éœ€çš„CSSç±»æ·»åŠ åˆ°å›¾æ ‡ï¼ˆæˆ–DOMä¸­çš„ä»»ä½•å…ƒç´ ï¼‰ã€‚</li><li>å¯¹äºçˆ¶çº§æ‚¬åœæ ·å¼ï¼Œéœ€è¦ç»™ç›®æ ‡å…ƒç´ æ·»åŠ æŒ‡å®šCSSç±»ï¼ŒåŒæ—¶è¿˜è¦ç»™ç›®æ ‡å…ƒç´ çš„çˆ¶çº§å…ƒç´ æ·»åŠ CSSç±»<code>faa-parent animated-hover</code>ã€‚ï¼ˆè¯¦æƒ…è§ç¤ºä¾‹åŠç¤ºä¾‹æºç ï¼‰<br>You can regulate the speed of the animation by adding the CSS class or . faa-fastfaa-slow</li><li>å¯ä»¥é€šè¿‡ç»™ç›®æ ‡å…ƒç´ æ·»åŠ CSSç±»<code>faa-fast</code>æˆ–<code>faa-slow</code>æ¥æ§åˆ¶åŠ¨ç”»å¿«æ…¢ã€‚</li></ol></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.On DOM loadï¼ˆå½“é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåŠ¨ç”»ï¼‰</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>2.è°ƒæ•´åŠ¨ç”»é€Ÿåº¦</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated faa-fast %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated faa-slow %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>3.On hoverï¼ˆå½“é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºåŠ¨ç”»ï¼‰</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-horizontal animated-hover %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-flash animated-hover %&#125;ban&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><p>4.On parent hoverï¼ˆå½“é¼ æ ‡æ‚¬åœåœ¨çˆ¶çº§å…ƒç´ æ—¶æ˜¾ç¤ºåŠ¨ç”»ï¼‰</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip warning faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-horizontal&quot;</span>&gt;</span></span>warning<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban faa-parent animated-hover %&#125;<span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;faa-flash&quot;</span>&gt;</span></span>ban<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.On DOM loadï¼ˆå½“é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåŠ¨ç”»ï¼‰</p><div class="tip warning faa-horizontal animated"><p>warning</p></div><div class="tip ban faa-flash animated"><p>ban</p></div>2.è°ƒæ•´åŠ¨ç”»é€Ÿåº¦<div class="tip warning faa-horizontal animated faa-fast"><p>warning</p></div><div class="tip ban faa-flash animated faa-slow"><p>ban</p></div>3.On hoverï¼ˆå½“é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºåŠ¨ç”»ï¼‰<div class="tip warning faa-horizontal animated-hover"><p>warning</p></div><div class="tip ban faa-flash animated-hover"><p>ban</p></div>4.On parent hoverï¼ˆå½“é¼ æ ‡æ‚¬åœåœ¨çˆ¶çº§å…ƒç´ æ—¶æ˜¾ç¤ºåŠ¨ç”»ï¼‰<div class="tip warning faa-parent animated-hover"><p class="faa-horizontal">warning</p></div><div class="tip ban faa-parent animated-hover"><p class="faa-flash">ban</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-7-å¤é€‰åˆ—è¡¨-checkbox">2.7 å¤é€‰åˆ—è¡¨ checkbox</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox æ ·å¼å‚æ•°ï¼ˆå¯é€‰ï¼‰, æ–‡æœ¬ï¼ˆæ”¯æŒç®€å•mdï¼‰ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>æ ·å¼</code>: plus, minus, times</li><li><code>é¢œè‰²</code>: red,yellow,green,cyan,blue,gray</li><li><code>é€‰ä¸­çŠ¶æ€</code>: checked</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox çº¯æ–‡æœ¬æµ‹è¯• %&#125;</span><br><span class="line">&#123;% checkbox checked, æ”¯æŒç®€å•çš„ [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) è¯­æ³• %&#125;</span><br><span class="line">&#123;% checkbox red, æ”¯æŒè‡ªå®šä¹‰é¢œè‰² %&#125;</span><br><span class="line">&#123;% checkbox green checked, ç»¿è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox yellow checked, é»„è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox cyan checked, é’è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox blue checked, è“è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox plus green checked, å¢åŠ  %&#125;</span><br><span class="line">&#123;% checkbox minus yellow checked, å‡å°‘ %&#125;</span><br><span class="line">&#123;% checkbox times red checked, å‰ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><div class='checkbox'><input type="checkbox" />            <p>çº¯æ–‡æœ¬æµ‹è¯•</p>            </div><div class='checkbox checked'><input type="checkbox" checked="checked"/>            <p>æ”¯æŒç®€å•çš„ <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> è¯­æ³•</p>            </div><div class='checkbox red'><input type="checkbox" />            <p>æ”¯æŒè‡ªå®šä¹‰é¢œè‰²</p>            </div><div class='checkbox green checked'><input type="checkbox" checked="checked"/>            <p>ç»¿è‰² + é»˜è®¤é€‰ä¸­</p>            </div><div class='checkbox yellow checked'><input type="checkbox" checked="checked"/>            <p>é»„è‰² + é»˜è®¤é€‰ä¸­</p>            </div><div class='checkbox cyan checked'><input type="checkbox" checked="checked"/>            <p>é’è‰² + é»˜è®¤é€‰ä¸­</p>            </div><div class='checkbox blue checked'><input type="checkbox" checked="checked"/>            <p>è“è‰² + é»˜è®¤é€‰ä¸­</p>            </div><div class='checkbox plus green checked'><input type="checkbox" checked="checked"/>            <p>å¢åŠ </p>            </div><div class='checkbox minus yellow checked'><input type="checkbox" checked="checked"/>            <p>å‡å°‘</p>            </div><div class='checkbox times red checked'><input type="checkbox" checked="checked"/>            <p>å‰</p>            </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-8-å•é€‰åˆ—è¡¨-radio">2.8 å•é€‰åˆ—è¡¨ radio</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio æ ·å¼å‚æ•°ï¼ˆå¯é€‰ï¼‰, æ–‡æœ¬ï¼ˆæ”¯æŒç®€å•mdï¼‰ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>é¢œè‰²</code>: red,yellow,green,cyan,blue,gray</li><li><code>é€‰ä¸­çŠ¶æ€</code>: checked</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio çº¯æ–‡æœ¬æµ‹è¯• %&#125;</span><br><span class="line">&#123;% radio checked, æ”¯æŒç®€å•çš„ [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) è¯­æ³• %&#125;</span><br><span class="line">&#123;% radio red, æ”¯æŒè‡ªå®šä¹‰é¢œè‰² %&#125;</span><br><span class="line">&#123;% radio green, ç»¿è‰² %&#125;</span><br><span class="line">&#123;% radio yellow, é»„è‰² %&#125;</span><br><span class="line">&#123;% radio cyan, é’è‰² %&#125;</span><br><span class="line">&#123;% radio blue, è“è‰² %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><div class='checkbox'><input type="radio" />            <p>çº¯æ–‡æœ¬æµ‹è¯•</p>            </div><div class='checkbox checked'><input type="radio" checked="checked"/>            <p>æ”¯æŒç®€å•çš„ <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> è¯­æ³•</p>            </div><div class='checkbox red'><input type="radio" />            <p>æ”¯æŒè‡ªå®šä¹‰é¢œè‰²</p>            </div><div class='checkbox green'><input type="radio" />            <p>ç»¿è‰²</p>            </div><div class='checkbox yellow'><input type="radio" />            <p>é»„è‰²</p>            </div><div class='checkbox cyan'><input type="radio" />            <p>é’è‰²</p>            </div><div class='checkbox blue'><input type="radio" />            <p>è“è‰²</p>            </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-9-æ—¶é—´è½´-timeline">2.9 æ—¶é—´è½´ timeline</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline æ—¶é—´çº¿æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰[,color] %&#125;</span><br><span class="line">&lt;!-- timeline æ—¶é—´èŠ‚ç‚¹ï¼ˆæ ‡é¢˜ï¼‰ --&gt;</span><br><span class="line">æ­£æ–‡å†…å®¹</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&lt;!-- timeline æ—¶é—´èŠ‚ç‚¹ï¼ˆæ ‡é¢˜ï¼‰ --&gt;</span><br><span class="line">æ­£æ–‡å†…å®¹</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>title</code>:æ ‡é¢˜/æ—¶é—´çº¿</li><li><code>color</code>:<code>timeline</code>é¢œè‰²:default(ç•™ç©º) / blue / pink / red / purple / orange / green</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline æ—¶é—´è½´æ ·å¼,blue %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-07-24 [<span class="string">2.6.6 -&gt; 3.0</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> å¦‚æœæœ‰ <span class="code">`hexo-lazyload-image`</span> æ’ä»¶ï¼Œéœ€è¦åˆ é™¤å¹¶é‡æ–°å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œè®¾ç½® <span class="code">`lazyload.isSPA: true`</span>ã€‚</span><br><span class="line"><span class="bullet">2.</span> 2.x ç‰ˆæœ¬çš„ css å’Œ js ä¸é€‚ç”¨äº 3.x ç‰ˆæœ¬ï¼Œå¦‚æœä½¿ç”¨äº† <span class="code">`use_cdn: true`</span> åˆ™éœ€è¦åˆ é™¤ã€‚</span><br><span class="line"><span class="bullet">3.</span> 2.x ç‰ˆæœ¬çš„ fancybox æ ‡ç­¾åœ¨ 3.x ç‰ˆæœ¬ä¸­è¢«é‡å‘½åä¸º gallery ã€‚</span><br><span class="line"><span class="bullet">4.</span> 2.x ç‰ˆæœ¬çš„ç½®é¡¶ <span class="code">`top: true`</span> æ”¹ä¸ºäº† <span class="code">`pin: true`</span>ï¼Œå¹¶ä¸”åŒæ ·é€‚ç”¨äº <span class="code">`layout: page`</span> çš„é¡µé¢ã€‚</span><br><span class="line"><span class="bullet">5.</span> å¦‚æœä½¿ç”¨äº† <span class="code">`hexo-offline`</span> æ’ä»¶ï¼Œå»ºè®®å¸è½½ï¼Œ3.0 ç‰ˆæœ¬é»˜è®¤å¼€å¯äº† pjax æœåŠ¡ã€‚</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-05-15 [<span class="string">2.6.3 -&gt; 2.6.6</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6</span>) --&gt;</span><br><span class="line"></span><br><span class="line">ä¸éœ€è¦é¢å¤–å¤„ç†ã€‚</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline 2020-04-20 [<span class="string">2.6.2 -&gt; 2.6.3</span>](<span class="link">https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3</span>) --&gt;</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> å…¨å±€æœç´¢ <span class="code">`seotitle`</span> å¹¶æ›¿æ¢ä¸º <span class="code">`seo_title`</span>ã€‚</span><br><span class="line"><span class="bullet">2.</span> group ç»„ä»¶çš„ç´¢å¼•è§„åˆ™æœ‰å˜ï¼Œä½¿ç”¨ group ç»„ä»¶çš„æ–‡ç« å†…ï¼Œ<span class="code">`group: group_name`</span> å¯¹åº”çš„ç»„ä»¶åå¿…é¡»æ˜¯ <span class="code">`group_name`</span>ã€‚</span><br><span class="line"><span class="bullet">2.</span> group ç»„ä»¶çš„åˆ—è¡¨åä¼˜å…ˆæ˜¾ç¤ºæ–‡ç« çš„ <span class="code">`short_title`</span> å…¶æ¬¡æ˜¯ <span class="code">`title`</span>ã€‚</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><div class="timeline blue"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>æ—¶é—´è½´æ ·å¼</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-07-24 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases">2.6.6 -&gt; 3.0</a></p></div></div><div class='timeline-item-content'><ol><li>å¦‚æœæœ‰ <code>hexo-lazyload-image</code> æ’ä»¶ï¼Œéœ€è¦åˆ é™¤å¹¶é‡æ–°å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œè®¾ç½® <code>lazyload.isSPA: true</code>ã€‚</li><li>2.x ç‰ˆæœ¬çš„ css å’Œ js ä¸é€‚ç”¨äº 3.x ç‰ˆæœ¬ï¼Œå¦‚æœä½¿ç”¨äº† <code>use_cdn: true</code> åˆ™éœ€è¦åˆ é™¤ã€‚</li><li>2.x ç‰ˆæœ¬çš„ fancybox æ ‡ç­¾åœ¨ 3.x ç‰ˆæœ¬ä¸­è¢«é‡å‘½åä¸º gallery ã€‚</li><li>2.x ç‰ˆæœ¬çš„ç½®é¡¶ <code>top: true</code> æ”¹ä¸ºäº† <code>pin: true</code>ï¼Œå¹¶ä¸”åŒæ ·é€‚ç”¨äº <code>layout: page</code> çš„é¡µé¢ã€‚</li><li>å¦‚æœä½¿ç”¨äº† <code>hexo-offline</code> æ’ä»¶ï¼Œå»ºè®®å¸è½½ï¼Œ3.0 ç‰ˆæœ¬é»˜è®¤å¼€å¯äº† pjax æœåŠ¡ã€‚</li></ol></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-05-15 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.6">2.6.3 -&gt; 2.6.6</a></p></div></div><div class='timeline-item-content'><p>ä¸éœ€è¦é¢å¤–å¤„ç†ã€‚</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p>2020-04-20 <a href="https://github.com/volantis-x/hexo-theme-volantis/releases/tag/2.6.3">2.6.2 -&gt; 2.6.3</a></p></div></div><div class='timeline-item-content'><ol><li>å…¨å±€æœç´¢ <code>seotitle</code> å¹¶æ›¿æ¢ä¸º <code>seo_title</code>ã€‚</li><li>group ç»„ä»¶çš„ç´¢å¼•è§„åˆ™æœ‰å˜ï¼Œä½¿ç”¨ group ç»„ä»¶çš„æ–‡ç« å†…ï¼Œ<code>group: group_name</code> å¯¹åº”çš„ç»„ä»¶åå¿…é¡»æ˜¯ <code>group_name</code>ã€‚</li><li>group ç»„ä»¶çš„åˆ—è¡¨åä¼˜å…ˆæ˜¾ç¤ºæ–‡ç« çš„ <code>short_title</code> å…¶æ¬¡æ˜¯ <code>title</code>ã€‚</li></ol></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-10-é“¾æ¥å¡ç‰‡-link">2.10 é“¾æ¥å¡ç‰‡ link</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link æ ‡é¢˜, é“¾æ¥, å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link ç³–æœå±‹æ•™ç¨‹è´´, https://akilar.top/posts/615e2dec/, https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><div class="tag link"><a class="link-card" title="ç³–æœå±‹æ•™ç¨‹è´´" href="https://akilar.top/posts/615e2dec/"><div class="left"><img src="https://cdn.cbd.int/akilar-candyassets@1.0.36/image/siteicon/favicon.ico"/></div><div class="right"><p class="text">ç³–æœå±‹æ•™ç¨‹è´´</p><p class="url">https://akilar.top/posts/615e2dec/</p></div></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-11-æŒ‰é’®-btns">2.11 æŒ‰é’® btns</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns æ ·å¼å‚æ•° %&#125;</span><br><span class="line">&#123;% cell æ ‡é¢˜, é“¾æ¥, å›¾ç‰‡æˆ–è€…å›¾æ ‡ %&#125;</span><br><span class="line">&#123;% cell æ ‡é¢˜, é“¾æ¥, å›¾ç‰‡æˆ–è€…å›¾æ ‡ %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li>åœ†è§’æ ·å¼ï¼šrounded, circle</li><li>å¢åŠ æ–‡å­—æ ·å¼ï¼šå¯ä»¥åœ¨å®¹å™¨å†…å¢åŠ  <code>&lt;b&gt;</code>æ ‡é¢˜<code>&lt;/b&gt;</code>å’Œ<code>&lt;p&gt;</code>æè¿°æ–‡å­—<code>&lt;/p&gt;</code></li><li>å¸ƒå±€æ–¹å¼ï¼š<br>é»˜è®¤ä¸ºè‡ªåŠ¨å®½åº¦ï¼Œé€‚åˆè§†é‡å†…åªæœ‰ä¸€ä¸¤ä¸ªçš„æƒ…å†µã€‚</li></ol><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>wide</td><td>å®½ä¸€ç‚¹çš„æŒ‰é’®</td></tr><tr><td>fill</td><td>å¡«å……å¸ƒå±€ï¼Œè‡ªåŠ¨é“ºæ»¡è‡³å°‘ä¸€è¡Œï¼Œå¤šäº†ä¼šæ¢è¡Œ</td></tr><tr><td>center</td><td>å±…ä¸­ï¼ŒæŒ‰é’®ä¹‹é—´æ˜¯å›ºå®šé—´è·</td></tr><tr><td>around</td><td>å±…ä¸­åˆ†æ•£</td></tr><tr><td>grid2</td><td>ç­‰å®½æœ€å¤š2åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr><tr><td>grid3</td><td>ç­‰å®½æœ€å¤š3åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr><tr><td>grid4</td><td>ç­‰å®½æœ€å¤š4åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr><tr><td>grid5</td><td>ç­‰å®½æœ€å¤š5åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.å¦‚æœéœ€è¦æ˜¾ç¤ºç±»ä¼¼ã€Œå›¢é˜Ÿæˆå‘˜ã€ä¹‹ç±»çš„ä¸€ç»„å«æœ‰å¤´åƒçš„é“¾æ¥</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle grid5 %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>2.æˆ–è€…å«æœ‰å›¾æ ‡çš„æŒ‰é’®</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns rounded grid5 %&#125;</span><br><span class="line">&#123;% cell ä¸‹è½½æºç , /, fas fa-download %&#125;</span><br><span class="line">&#123;% cell æŸ¥çœ‹æ–‡æ¡£, /, fas fa-book-open %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><p>3.åœ†å½¢å›¾æ ‡ + æ ‡é¢˜ + æè¿° + å›¾ç‰‡ + ç½‘æ ¼5åˆ— + å±…ä¸­</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle center grid5 %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>å¿ƒç‡ç®¡å®¶<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p red, ä¸“ä¸šç‰ˆ %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1&#x27;</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;fab fa-apple&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>å¿ƒç‡ç®¡å®¶<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">  &#123;% p green, å…è´¹ç‰ˆ %&#125;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.å¦‚æœéœ€è¦æ˜¾ç¤ºç±»ä¼¼ã€Œå›¢é˜Ÿæˆå‘˜ã€ä¹‹ç±»çš„ä¸€ç»„å«æœ‰å¤´åƒçš„é“¾æ¥</p><div class="btns circle grid5">            <a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a><a class="button" href='https://xaoxuu.com' title='xaoxuu'><img src='https://cdn.jsdelivr.net/gh/xaoxuu/cdn-assets/avatar/avatar.png'>xaoxuu</a>          </div>2.æˆ–è€…å«æœ‰å›¾æ ‡çš„æŒ‰é’®<div class="btns rounded grid5">            <a class="button" href='/' title='ä¸‹è½½æºç '><i class='fas fa-download'></i>ä¸‹è½½æºç </a><a class="button" href='/' title='æŸ¥çœ‹æ–‡æ¡£'><i class='fas fa-book-open'></i>æŸ¥çœ‹æ–‡æ¡£</a>          </div>3.åœ†å½¢å›¾æ ‡ + æ ‡é¢˜ + æè¿° + å›¾ç‰‡ + ç½‘æ ¼5åˆ— + å±…ä¸­<div class="btns circle center grid5">            <a href='https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1'>  <i class='fab fa-apple'></i>  <b>å¿ƒç‡ç®¡å®¶</b>  <p class='p red'>ä¸“ä¸šç‰ˆ</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_pro.png'></a><a href='https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1'>  <i class='fab fa-apple'></i>  <b>å¿ƒç‡ç®¡å®¶</b>  <p class='p green'>å…è´¹ç‰ˆ</p>  <img src='https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/qrcode/heartmate_lite.png'></a>          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-12-githubå¡ç‰‡-ghcard">2.12 githubå¡ç‰‡ ghcard</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% ghcard ç”¨æˆ·å, å…¶å®ƒå‚æ•°ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br><span class="line">&#123;% ghcard ç”¨æˆ·å/ä»“åº“, å…¶å®ƒå‚æ•°ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><p>ä½¿ç”¨<code>,</code>åˆ†å‰²å„ä¸ªå‚æ•°ã€‚å†™æ³•ä¸ºï¼š<code>å‚æ•°å=å‚æ•°å€¼</code><br>ä»¥ä¸‹åªå†™å‡ ä¸ªå¸¸ç”¨å‚æ•°å€¼ã€‚</p><table><thead><tr><th><strong>å‚æ•°å</strong></th><th>å–å€¼</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>hide</td><td>stars,commits,prs,issues,contribs</td><td>éšè—æŒ‡å®šç»Ÿè®¡</td></tr><tr><td>count_private</td><td>true</td><td>å°†ç§äººé¡¹ç›®è´¡çŒ®æ·»åŠ åˆ°æ€»æäº¤è®¡æ•°ä¸­</td></tr><tr><td>show_icons</td><td>true</td><td>æ˜¾ç¤ºå›¾æ ‡</td></tr><tr><td>theme</td><td>æŸ¥é˜…:<a href="https://github.com/anuraghazra/github-readme-stats/blob/master/themes/README.md">Available Themes</a></td><td>ä¸»é¢˜</td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.ç”¨æˆ·ä¿¡æ¯å¡ç‰‡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| &#123;% ghcard fomalhaut1998 %&#125; | &#123;% ghcard fomalhaut1998, theme=vue %&#125; |</span><br><span class="line">| -- | -- |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=buefy %&#125; | &#123;% ghcard fomalhaut1998, theme=solarized-light %&#125; |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=onedark %&#125; | &#123;% ghcard fomalhaut1998, theme=solarized-dark %&#125; |</span><br><span class="line">| &#123;% ghcard fomalhaut1998, theme=algolia %&#125; | &#123;% ghcard fomalhaut1998, theme=calm %&#125; |</span><br></pre></td></tr></table></figure><p>2.ä»“åº“ä¿¡æ¯å¡ç‰‡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=vue %&#125; |</span><br><span class="line">| -- | -- |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=buefy %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=solarized-light %&#125; |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=onedark %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=solarized-dark %&#125; |</span><br><span class="line">| &#123;% ghcard volantis-x/hexo-theme-volantis, theme=algolia %&#125; | &#123;% ghcard volantis-x/hexo-theme-volantis, theme=calm %&#125; |</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.ç”¨æˆ·ä¿¡æ¯å¡ç‰‡</p><table><thead><tr><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&show_owner=true"/></a></th><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=vue&show_owner=true"/></a></th></tr></thead><tbody><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=buefy&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=solarized-light&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=onedark&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=solarized-dark&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=algolia&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/fomalhaut1998"><img src="https://github-readme-stats.vercel.app/api/?username=fomalhaut1998&theme=calm&show_owner=true"/></a></td></tr></tbody></table><p>2.ä»“åº“ä¿¡æ¯å¡ç‰‡</p><table><thead><tr><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&show_owner=true"/></a></th><th><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=vue&show_owner=true"/></a></th></tr></thead><tbody><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=buefy&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=solarized-light&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=onedark&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=solarized-dark&show_owner=true"/></a></td></tr><tr><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=algolia&show_owner=true"/></a></td><td><a class="ghcard" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis"><img src="https://github-readme-stats.vercel.app/api/pin/?username=volantis-x&repo=hexo-theme-volantis&theme=calm&show_owner=true"/></a></td></tr></tbody></table><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-13-githubå¾½æ ‡-ghbdage">2.13 githubå¾½æ ‡ ghbdage</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage [right],[left],[logo]||[color],[link],[title]||[option] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>left</code>ï¼šå¾½æ ‡å·¦è¾¹çš„ä¿¡æ¯ï¼Œå¿…é€‰å‚æ•°ã€‚</li><li><code>right</code>: å¾½æ ‡å³è¾¹çš„ä¿¡æ¯ï¼Œå¿…é€‰å‚æ•°ï¼Œ</li><li><code>logo</code>ï¼šå¾½æ ‡å›¾æ ‡ï¼Œå›¾æ ‡åç§°è¯¦è§<a href="https://simpleicons.org/">simpleicons</a>ï¼Œå¯é€‰å‚æ•°ã€‚</li><li><code>color</code>ï¼šå¾½æ ‡å³è¾¹çš„é¢œè‰²ï¼Œå¯é€‰å‚æ•°ã€‚</li><li><code>link</code>ï¼šæŒ‡å‘çš„é“¾æ¥ï¼Œå¯é€‰å‚æ•°ã€‚</li><li><code>title</code>ï¼šå¾½æ ‡çš„é¢å¤–ä¿¡æ¯ï¼Œå¯é€‰å‚æ•°ã€‚ä¸»è¦ç”¨äºä¼˜åŒ–SEOï¼Œä½†<code>object</code>æ ‡ç­¾ä¸ä¼šåƒ<code>a</code>æ ‡ç­¾ä¸€æ ·åœ¨é¼ æ ‡æ‚¬åœæ˜¾ç¤º<code>title</code>ä¿¡æ¯ã€‚</li><li><code>option</code>ï¼šè‡ªå®šä¹‰å‚æ•°ï¼Œæ”¯æŒ<a href="https://shields.io/">shields.io</a>çš„å…¨éƒ¨APIå‚æ•°æ”¯æŒï¼Œå…·ä½“å‚æ•°å¯ä»¥å‚çœ‹ä¸Šæ–‡ä¸­çš„æ‹“å±•å†™æ³•ç¤ºä¾‹ã€‚å½¢å¼ä¸º<code>name1=value2&amp;name2=value2</code>ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.åŸºæœ¬å‚æ•°,å®šä¹‰å¾½æ ‡å·¦å³æ–‡å­—å’Œå›¾æ ‡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage Theme,Butterfly %&#125;</span><br><span class="line">&#123;% bdage Frame,Hexo,hexo %&#125;</span><br></pre></td></tr></table></figure><p>2.ä¿¡æ¯å‚æ•°ï¼Œå®šä¹‰å¾½æ ‡å³ä¾§å†…å®¹èƒŒæ™¯è‰²ï¼ŒæŒ‡å‘é“¾æ¥</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage CDN,JsDelivr,jsDelivr||abcdef,https://metroui.org.ua/index.html,æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ %&#125;</span><br><span class="line">//å¦‚æœæ˜¯è·¨é¡ºåºçœç•¥å¯é€‰å‚æ•°ï¼Œä»ç„¶éœ€è¦å†™ä¸ªé€—å·,ç”¨ä½œåˆ†å‰²</span><br><span class="line">&#123;% bdage Source,GitHub,GitHub||,https://github.com/ %&#125;</span><br></pre></td></tr></table></figure><p>3.æ‹“å±•å‚æ•°ï¼Œæ”¯æŒshieldsçš„APIçš„å…¨éƒ¨å‚æ•°å†…å®¹</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bdage Hosted,Vercel,Vercel||brightgreen,https://vercel.com/,æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel||style=social&amp;logoWidth=20 %&#125;</span><br><span class="line">//å¦‚æœæ˜¯è·¨é¡ºåºçœç•¥å¯é€‰å‚æ•°ç»„ï¼Œä»ç„¶éœ€è¦å†™åŒç«–çº¿||ç”¨ä½œåˆ†å‰²</span><br><span class="line">&#123;% bdage Hosted,Vercel,Vercel||||style=social&amp;logoWidth=20&amp;logoColor=violet %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.åŸºæœ¬å‚æ•°,å®šä¹‰å¾½æ ‡å·¦å³æ–‡å­—å’Œå›¾æ ‡</p><p><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Butterfly-Theme-orange?logo=&color=orange&link=&"></object><br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Hexo-Frame-orange?logo=hexo&color=orange&link=&"></object></p><p>2.ä¿¡æ¯å‚æ•°ï¼Œå®šä¹‰å¾½æ ‡å³ä¾§å†…å®¹èƒŒæ™¯è‰²ï¼ŒæŒ‡å‘é“¾æ¥</p><p><object class="ghbdage" style="margin-inline:5px" title="æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ" standby="loading..." data="https://img.shields.io/badge/JsDelivr-CDN-orange?logo=jsDelivr&color=abcdef&link=https://metroui.org.ua/index.html&"></object><br>//å¦‚æœæ˜¯è·¨é¡ºåºçœç•¥å¯é€‰å‚æ•°ï¼Œä»ç„¶éœ€è¦å†™ä¸ªé€—å·,ç”¨ä½œåˆ†å‰²<br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/GitHub-Source-orange?logo=GitHub&color=orange&link=https://github.com/&"></object></p><p>3.æ‹“å±•å‚æ•°ï¼Œæ”¯æŒshieldsçš„APIçš„å…¨éƒ¨å‚æ•°å†…å®¹</p><p><object class="ghbdage" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel" standby="loading..." data="https://img.shields.io/badge/Vercel-Hosted-orange?logo=Vercel&color=brightgreen&link=https://vercel.com/&style=social&logoWidth=20"></object><br>//å¦‚æœæ˜¯è·¨é¡ºåºçœç•¥å¯é€‰å‚æ•°ç»„ï¼Œä»ç„¶éœ€è¦å†™åŒç«–çº¿||ç”¨ä½œåˆ†å‰²<br><object class="ghbdage" style="margin-inline:5px" title="" standby="loading..." data="https://img.shields.io/badge/Vercel-Hosted-orange?logo=Vercel&color=orange&link=&style=social&logoWidth=20&logoColor=violet"></object></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-14-ç½‘ç«™å¡ç‰‡-sites">2.14 ç½‘ç«™å¡ç‰‡ sites</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site æ ‡é¢˜, url=é“¾æ¥, screenshot=æˆªå›¾é“¾æ¥, avatar=å¤´åƒé“¾æ¥ï¼ˆå¯é€‰ï¼‰, description=æè¿°ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br><span class="line">&#123;% site æ ‡é¢˜, url=é“¾æ¥, screenshot=æˆªå›¾é“¾æ¥, avatar=å¤´åƒé“¾æ¥ï¼ˆå¯é€‰ï¼‰, description=æè¿°ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site xaoxuu, url=https://xaoxuu.com, screenshot=https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg, avatar=https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png, description=ç®€çº¦é£æ ¼ %&#125;</span><br><span class="line">&#123;% site inkss, url=https://inkss.cn, screenshot=https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg, avatar=https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg, description=è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­— %&#125;</span><br><span class="line">&#123;% site MHuiG, url=https://blog.mhuig.top, screenshot=https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png, avatar=https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png, description=è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­— %&#125;</span><br><span class="line">&#123;% site Colsrch, url=https://colsrch.top, screenshot=https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png, avatar=https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg, description=è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­— %&#125;</span><br><span class="line">&#123;% site Linhk1606, url=https://linhk1606.github.io, screenshot=https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png, avatar=https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png, description=è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­— %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><div class="site-card-group"><a class="site-card" href="https://fomalhaut1998.com"><div class="img"><img src="https://i.loli.net/2020/08/21/VuSwWZ1xAeUHEBC.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/fomalhaut1998/cdn-assets/avatar/avatar.png"/><span class="title">fomalhaut1998</span><span class="desc">ç®€çº¦é£æ ¼</span></div></a><a class="site-card" href="https://inkss.cn"><div class="img"><img src="https://i.loli.net/2020/08/21/Vzbu3i8fXs6Nh5Y.jpg"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/inkss/common@master/static/web/avatar.jpg"/><span class="title">inkss</span><span class="desc">è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­—</span></div></a><a class="site-card" href="https://blog.mhuig.top"><div class="img"><img src="https://i.loli.net/2020/08/22/d24zpPlhLYWX6D1.png"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed@master/data/p.png"/><span class="title">MHuiG</span><span class="desc">è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­—</span></div></a><a class="site-card" href="https://colsrch.top"><div class="img"><img src="https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png"/></div><div class="info"><img src="https://cdn.jsdelivr.net/gh/Colsrch/images/Colsrch/avatar.jpg"/><span class="title">Colsrch</span><span class="desc">è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­—</span></div></a><a class="site-card" href="https://linhk1606.github.io"><div class="img"><img src="https://i.loli.net/2020/08/21/3PmGLCKicnfow1x.png"/></div><div class="info"><img src="https://i.loli.net/2020/02/09/PN7I5RJfFtA93r2.png"/><span class="title">Linhk1606</span><span class="desc">è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­—</span></div></a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-15-è¡Œå†…å›¾ç‰‡-inlineimage">2.15 è¡Œå†…å›¾ç‰‡ inlineimage</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% inlineimage å›¾ç‰‡é“¾æ¥, height=é«˜åº¦ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>é«˜åº¦</code>ï¼šheight=20px</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯ &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif %&#125; ä¸€æ®µè¯ã€‚</span><br><span class="line"></span><br><span class="line">è¿™åˆæ˜¯ &#123;% inlineimage https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif, height=40px %&#125; ä¸€æ®µè¯ã€‚</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>è¿™æ˜¯ <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/0000.gif" style="height:1.5em"/> ä¸€æ®µè¯ã€‚</p><p>è¿™åˆæ˜¯ <img no-lazy class="inline" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/aru-l/5150.gif" style="height:40px;"/> ä¸€æ®µè¯ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-16-å•å¼ å›¾ç‰‡-image">2.16 å•å¼ å›¾ç‰‡ image</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image é“¾æ¥, width=å®½åº¦ï¼ˆå¯é€‰ï¼‰, height=é«˜åº¦ï¼ˆå¯é€‰ï¼‰, alt=æè¿°ï¼ˆå¯é€‰ï¼‰, bg=å ä½é¢œè‰²ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li>å›¾ç‰‡å®½åº¦é«˜åº¦ï¼šwidth=300px, height=32px</li><li>å›¾ç‰‡æè¿°ï¼šalt=å›¾ç‰‡æè¿°ï¼ˆbutterflyéœ€è¦åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­å¼€å¯å›¾ç‰‡æè¿°ï¼‰</li><li>å ä½èƒŒæ™¯è‰²ï¼šbg=#f2f2f2</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.æ·»åŠ æè¿°ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, alt=æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚ %&#125;</span><br></pre></td></tr></table></figure><p>2.æŒ‡å®šå®½åº¦</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px %&#125;</span><br></pre></td></tr></table></figure><p>3.æŒ‡å®šå®½åº¦å¹¶æ·»åŠ æè¿°ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, alt=æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚ %&#125;</span><br></pre></td></tr></table></figure><p>4.è®¾ç½®å ä½èƒŒæ™¯è‰²ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg, width=400px, bg=#1D0C04, alt=ä¼˜åŒ–ä¸åŒå®½åº¦æµè§ˆçš„è§‚æ„Ÿ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.æ·»åŠ æè¿°ï¼š</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚"/></div><span class="image-caption">æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚</span></div>2..æŒ‡å®šå®½åº¦<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" style="width:400px;"/></div></div>3.æŒ‡å®šå®½åº¦å¹¶æ·»åŠ æè¿°ï¼š<div class="img-wrap"><div class="img-bg"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚" style="width:400px;"/></div><span class="image-caption">æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚</span></div>4.è®¾ç½®å ä½èƒŒæ™¯è‰²ï¼š<div class="img-wrap"><div class="img-bg" style="background:#1D0C04"><img class="img" src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg" alt="ä¼˜åŒ–ä¸åŒå®½åº¦æµè§ˆçš„è§‚æ„Ÿ" style="width:400px;"/></div><span class="image-caption">ä¼˜åŒ–ä¸åŒå®½åº¦æµè§ˆçš„è§‚æ„Ÿ</span></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-17-éŸ³é¢‘-audio">2.17 éŸ³é¢‘ audio</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio éŸ³é¢‘é“¾æ¥ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><div class="audio"><audio controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-18-è§†é¢‘-video">2.18 è§†é¢‘ video</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video è§†é¢‘é“¾æ¥ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>å¯¹é½æ–¹å‘</code>ï¼šleft, center, right</li><li><code>åˆ—æ•°</code>ï¼šé€—å·åé¢ç›´æ¥å†™åˆ—æ•°ï¼Œæ”¯æŒ 1 ï½ 4 åˆ—ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.100%å®½åº¦</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br></pre></td></tr></table></figure><p>2.50%å®½åº¦</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 2 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><p>3.25%å®½åº¦</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 4 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.100%å®½åº¦</p><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div>2.50%å®½åº¦<div class="videos" col='2'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div>3.25%å®½åº¦<div class="videos" col='4'><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div><div class="video"><video controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_0341.mov' type='video/mp4'>Your browser does not support the video tag.</video></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-19-ç›¸å†Œ-gallery">2.19 ç›¸å†Œ gallery</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><p>1.gallerygroup ç›¸å†Œå›¾åº“</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery ç›¸å†Œ</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">markdown åœ–ç‰‡æ ¼å¼</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ul><li>gallerygroup ç›¸å†Œå›¾åº“</li></ul><table><thead><tr><th>å‚æ•°å</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>name</td><td>å›¾åº“åå­—</td></tr><tr><td>description</td><td>å›¾åº“æè¿°</td></tr><tr><td>link</td><td>é“¾æ¥åˆ°å¯¹åº”ç›¸å†Œçš„åœ°å€</td></tr><tr><td>img-url</td><td>å›¾åº“å°é¢</td></tr></tbody></table><ul><li><p>gallery ç›¸å†Œ</p><p>åŒºåˆ«äºæ—§ç‰ˆçš„Galleryç›¸å†Œ,æ–°çš„Galleryç›¸å†Œä¼šè‡ªåŠ¨æ ¹æ®å›¾ç‰‡é•¿åº¦è¿›è¡Œæ’ç‰ˆï¼Œä¹¦å†™ä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œä¸markdownæ ¼å¼ä¸€æ ·ã€‚å¯æ ¹æ®éœ€è¦æ’å…¥åˆ°ç›¸åº”çš„mdã€‚æ— éœ€å†è‡ªå·±é…ç½®é•¿å®½ã€‚<strong>å»ºè®®åœ¨ç²˜è´´æ—¶æ•…æ„ä½¿ç”¨é•¿çŸ­ã€å¤§å°ã€æ¨ªç«–ä¸ä¸€çš„å›¾ç‰‡</strong>ï¼Œä¼šæœ‰æ›´å¥½çš„æ•ˆæœã€‚ï¼ˆå°ºå¯¸å®Œå…¨ç›¸åŒçš„å›¾ç‰‡åªä¼šå¹³é“ºè¾“å‡ºï¼Œæ•ˆæœå¾ˆç³Ÿç³•ï¼‰</p></li></ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.gallerygroup ç›¸å†Œå›¾åº“</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup MC åœ¨Rikkaã®å…­èŠ±æœåŠ¡å™¨é‡Œç•™ä¸‹çš„è¶³è¿¹ &#x27;/gallery/MC/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg %&#125;</span><br><span class="line">&#123;% galleryGroup Gundam å“¦å’§å“‡gundamå“’ï¼ &#x27;/gallery/Gundam/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png %&#125;</span><br><span class="line">&#123;% galleryGroup I-am-Akilar æŸç§æ„ä¹‰ä¸Šä¹Ÿç®—è‡ªæ‹å§ &#x27;/gallery/I-am-Akilar/&#x27; https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>2.gallery ç›¸å†Œ</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg</span>)</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.gallerygroup ç›¸å†Œå›¾åº“</p><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/1.jpg' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">MC</div>  <p>åœ¨Rikkaã®å…­èŠ±æœåŠ¡å™¨é‡Œç•™ä¸‹çš„è¶³è¿¹</p>  <a href='/gallery/MC/'></a>  </figcaption>  </figure>  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907110508327.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Gundam</div>  <p>å“¦å’§å“‡gundamå“’ï¼</p>  <a href='/gallery/Gundam/'></a>  </figcaption>  </figure>  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src='https://cdn.cbd.int/akilar-candyassets@1.0.36/image/20200907113116651.png' alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">I-am-Akilar</div>  <p>æŸç§æ„ä¹‰ä¸Šä¹Ÿç®—è‡ªæ‹å§</p>  <a href='/gallery/I-am-Akilar/'></a>  </figcaption>  </figure></div>2.gallery ç›¸å†Œ<div class="fj-gallery"><p><img src="https://i.loli.net/2019/12/25/Fze9jchtnyJXMHN.jpg" alt=""><br><img src="https://i.loli.net/2019/12/25/ryLVePaqkYm4TEK.jpg" alt=""></p>          </div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-20-æŠ˜å æ¡†-folding">2.20 æŠ˜å æ¡† folding</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><p>1.gallerygroup ç›¸å†Œå›¾åº“</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding å‚æ•°ï¼ˆå¯é€‰ï¼‰, æ ‡é¢˜ %&#125;</span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><!-- tab å‚æ•°é…ç½® --><ol><li><p><code>é¢œè‰²</code>ï¼šblue, cyan, green, yellow, red</p></li><li><p><code>çŠ¶æ€</code>ï¼šçŠ¶æ€å¡«å†™ open ä»£è¡¨é»˜è®¤æ‰“å¼€ã€‚</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding æŸ¥çœ‹å›¾ç‰‡æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line">![](<span class="link">https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg</span>)</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding cyan open, æŸ¥çœ‹é»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡† %&#125;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡†ã€‚</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding green, æŸ¥çœ‹ä»£ç æµ‹è¯• %&#125;</span><br><span class="line">å‡è£…è¿™é‡Œæœ‰ä»£ç å—ï¼ˆä»£ç å—æ²¡æ³•åµŒå¥—ä»£ç å—ï¼‰</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding yellow, æŸ¥çœ‹åˆ—è¡¨æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> haha</span><br><span class="line"><span class="bullet">-</span> hehe</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding red, æŸ¥çœ‹åµŒå¥—æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding blue, æŸ¥çœ‹åµŒå¥—æµ‹è¯•2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding æŸ¥çœ‹åµŒå¥—æµ‹è¯•3 %&#125;</span><br><span class="line"></span><br><span class="line">hahaha <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png&#x27;</span> <span class="attr">style</span>=<span class="string">&#x27;height:24px&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><details class="folding-tag" ><summary> æŸ¥çœ‹å›¾ç‰‡æµ‹è¯• </summary>              <div class='content'>              <p><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper/abstract/41F215B9-261F-48B4-80B5-4E86E165259E.jpeg" alt=""></p>              </div>            </details><details class="folding-tag" cyan open><summary> æŸ¥çœ‹é»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡† </summary>              <div class='content'>              <p>è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡†ã€‚</p>              </div>            </details><details class="folding-tag" green><summary> æŸ¥çœ‹ä»£ç æµ‹è¯• </summary>              <div class='content'>              <p>å‡è£…è¿™é‡Œæœ‰ä»£ç å—ï¼ˆä»£ç å—æ²¡æ³•åµŒå¥—ä»£ç å—ï¼‰</p>              </div>            </details><details class="folding-tag" yellow><summary> æŸ¥çœ‹åˆ—è¡¨æµ‹è¯• </summary>              <div class='content'>              <ul><li>haha</li><li>hehe</li></ul>              </div>            </details><details class="folding-tag" red><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯• </summary>              <div class='content'>              <details class="folding-tag" blue><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯•2 </summary>              <div class='content'>              <details class="folding-tag" ><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯•3 </summary>              <div class='content'>              <p>hahaha <span><img src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-emoji/tieba/%E6%BB%91%E7%A8%BD.png' style='height:24px'></span></p>              </div>            </details>              </div>            </details>              </div>            </details><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-21-åˆ†æ -tab">2.21 åˆ†æ  tab</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">é…ç½®å‚æ•°</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><p>Unique name :</p><ul><li><p>é€‰é¡¹å¡å—æ ‡ç­¾çš„å”¯ä¸€åç§°ï¼Œä¸å¸¦é€—å·ã€‚</p></li><li><p>å°†åœ¨#idä¸­ç”¨ä½œæ¯ä¸ªæ ‡ç­¾åŠå…¶ç´¢å¼•å·çš„å‰ç¼€ã€‚</p></li><li><p>å¦‚æœåç§°ä¸­åŒ…å«ç©ºæ ¼ï¼Œåˆ™å¯¹äºç”Ÿæˆ#idï¼Œæ‰€æœ‰ç©ºæ ¼å°†ç”±ç ´æŠ˜å·ä»£æ›¿ã€‚</p></li><li><p>ä»…å½“å‰å¸–å­/é¡µé¢çš„URLå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼</p></li></ul></li><li><p>[index]:</p><ul><li><p>æ´»åŠ¨é€‰é¡¹å¡çš„ç´¢å¼•å·ã€‚</p></li><li><p>å¦‚æœæœªæŒ‡å®šï¼Œå°†é€‰æ‹©ç¬¬ä¸€ä¸ªæ ‡ç­¾ï¼ˆ1ï¼‰ã€‚</p></li><li><p>å¦‚æœindexä¸º-1ï¼Œåˆ™ä¸ä¼šé€‰æ‹©ä»»ä½•é€‰é¡¹å¡ã€‚</p></li><li><p>å¯é€‰å‚æ•°ã€‚</p></li></ul></li><li><p>[Tab caption]:</p><ul><li><p>å½“å‰é€‰é¡¹å¡çš„æ ‡é¢˜ã€‚</p></li><li><p>å¦‚æœæœªæŒ‡å®šæ ‡é¢˜ï¼Œåˆ™å¸¦æœ‰åˆ¶è¡¨ç¬¦ç´¢å¼•åç¼€çš„å”¯ä¸€åç§°å°†ç”¨ä½œåˆ¶è¡¨ç¬¦çš„æ ‡é¢˜ã€‚</p></li><li><p>å¦‚æœæœªæŒ‡å®šæ ‡é¢˜ï¼Œä½†æŒ‡å®šäº†å›¾æ ‡ï¼Œåˆ™æ ‡é¢˜å°†ä¸ºç©ºã€‚</p></li><li><p>å¯é€‰å‚æ•°ã€‚</p></li></ul></li><li><p>[@icon]:</p><ul><li><p>FontAwesomeå›¾æ ‡åç§°ï¼ˆå…¨åï¼Œçœ‹èµ·æ¥åƒâ€œ fas fa-fontâ€ï¼‰</p></li><li><p>å¯ä»¥æŒ‡å®šå¸¦ç©ºæ ¼æˆ–ä¸å¸¦ç©ºæ ¼ï¼›</p></li><li><p>ä¾‹å¦‚â€™Tab caption @iconâ€™ å’Œ â€˜Tab caption@iconâ€™.</p></li><li><p>å¯é€‰å‚æ•°ã€‚</p></li></ul></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.Demo 1 - é¢„è®¾é€‰æ‹©ç¬¬ä¸€ä¸ªã€é»˜è®¤ã€‘</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>2.Demo 2 - é¢„è®¾é€‰æ‹©tabs</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test2, 3 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>3.Demo 3 - æ²¡æœ‰é¢„è®¾å€¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test3, -1 %&#125;</span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><p>4.Demo 4 - è‡ªå®šä¹‰Tabå + åªæœ‰icon + iconå’ŒTabå</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test4 %&#125;</span><br><span class="line">&lt;!-- tab ç¬¬ä¸€ä¸ªTab --&gt;</span><br><span class="line"><span class="strong">**tabåå­—ä¸ºç¬¬ä¸€ä¸ªTab**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab @fab fa-apple-pay --&gt;</span><br><span class="line"><span class="strong">**åªæœ‰å›¾æ ‡ æ²¡æœ‰Tabåå­—**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab ç‚¸å¼¹@fas fa-bomb --&gt;</span><br><span class="line"><span class="strong">**åå­—+icon**</span></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.Demo 1 - é¢„è®¾é€‰æ‹©ç¬¬ä¸€ä¸ªã€é»˜è®¤ã€‘</p><div class="tabs" id="test1"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test1-1">test1 1</button></li><li class="tab"><button type="button" data-href="#test1-2">test1 2</button></li><li class="tab"><button type="button" data-href="#test1-3">test1 3</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test1-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test1-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>2.Demo 2 - é¢„è®¾é€‰æ‹©tabs</p><div class="tabs" id="test2"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#test2-1">test2 1</button></li><li class="tab"><button type="button" data-href="#test2-2">test2 2</button></li><li class="tab active"><button type="button" data-href="#test2-3">test2 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="test2-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test2-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content active" id="test2-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>3.Demo 3 - æ²¡æœ‰é¢„è®¾å€¼</p><div class="tabs" id="test3"><ul class="nav-tabs"><li class="tab"><button type="button" data-href="#test3-1">test3 1</button></li><li class="tab"><button type="button" data-href="#test3-2">test3 2</button></li><li class="tab"><button type="button" data-href="#test3-3">test3 3</button></li></ul><div class="tab-contents"><div class="tab-item-content" id="test3-1"><p><strong>This is Tab 1.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test3-2"><p><strong>This is Tab 2.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test3-3"><p><strong>This is Tab 3.</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>4.Demo 4 - è‡ªå®šä¹‰Tabå + åªæœ‰icon + iconå’ŒTabå</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">ç¬¬ä¸€ä¸ªTab</button></li><li class="tab"><button type="button" data-href="#test4-2"><i class="fab fa-apple-pay" style="text-align: center;"></i></button></li><li class="tab"><button type="button" data-href="#test4-3"><i class="fas fa-bomb"></i>ç‚¸å¼¹</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p><strong>tabåå­—ä¸ºç¬¬ä¸€ä¸ªTab</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><p><strong>åªæœ‰å›¾æ ‡ æ²¡æœ‰Tabåå­—</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><p><strong>åå­—+icon</strong></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-22-è¯—è¯æ ‡ç­¾-poem">2.22 è¯—è¯æ ‡ç­¾ poem</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><ol><li><code>title</code>ï¼šè¯—è¯æ ‡é¢˜</li><li><code>author</code>ï¼šä½œè€…ï¼Œå¯ä»¥ä¸å†™</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;% poem æ°´è°ƒæ­Œå¤´,è‹è½¼ %&#125;</span><br><span class="line">ä¸™è¾°ä¸­ç§‹ï¼Œæ¬¢é¥®è¾¾æ—¦ï¼Œå¤§é†‰ï¼Œä½œæ­¤ç¯‡ï¼Œå…¼æ€€å­ç”±ã€‚</span><br><span class="line">æ˜æœˆå‡ æ—¶æœ‰ï¼ŸæŠŠé…’é—®é’å¤©ã€‚</span><br><span class="line">ä¸çŸ¥å¤©ä¸Šå®«é˜™ï¼Œä»Šå¤•æ˜¯ä½•å¹´ï¼Ÿ</span><br><span class="line">æˆ‘æ¬²ä¹˜é£å½’å»ï¼Œåˆæç¼æ¥¼ç‰å®‡ï¼Œé«˜å¤„ä¸èƒœå¯’ã€‚</span><br><span class="line">èµ·èˆå¼„æ¸…å½±ï¼Œä½•ä¼¼åœ¨äººé—´ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è½¬æœ±é˜ï¼Œä½ç»®æˆ·ï¼Œç…§æ— çœ ã€‚</span><br><span class="line">ä¸åº”æœ‰æ¨ï¼Œä½•äº‹é•¿å‘åˆ«æ—¶åœ†ï¼Ÿ</span><br><span class="line">äººæœ‰æ‚²æ¬¢ç¦»åˆï¼Œæœˆæœ‰é˜´æ™´åœ†ç¼ºï¼Œæ­¤äº‹å¤éš¾å…¨ã€‚</span><br><span class="line">ä½†æ„¿äººé•¿ä¹…ï¼Œåƒé‡Œå…±å©µå¨Ÿã€‚</span><br><span class="line">&#123;% endpoem %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><div class='poem'><div class='poem-title'>æ°´è°ƒæ­Œå¤´</div><div class='poem-author'>è‹è½¼</div><p>ä¸™è¾°ä¸­ç§‹ï¼Œæ¬¢é¥®è¾¾æ—¦ï¼Œå¤§é†‰ï¼Œä½œæ­¤ç¯‡ï¼Œå…¼æ€€å­ç”±ã€‚<br>æ˜æœˆå‡ æ—¶æœ‰ï¼ŸæŠŠé…’é—®é’å¤©ã€‚<br>ä¸çŸ¥å¤©ä¸Šå®«é˜™ï¼Œä»Šå¤•æ˜¯ä½•å¹´ï¼Ÿ<br>æˆ‘æ¬²ä¹˜é£å½’å»ï¼Œåˆæç¼æ¥¼ç‰å®‡ï¼Œé«˜å¤„ä¸èƒœå¯’ã€‚<br>èµ·èˆå¼„æ¸…å½±ï¼Œä½•ä¼¼åœ¨äººé—´ï¼Ÿ</p><p>è½¬æœ±é˜ï¼Œä½ç»®æˆ·ï¼Œç…§æ— çœ ã€‚<br>ä¸åº”æœ‰æ¨ï¼Œä½•äº‹é•¿å‘åˆ«æ—¶åœ†ï¼Ÿ<br>äººæœ‰æ‚²æ¬¢ç¦»åˆï¼Œæœˆæœ‰é˜´æ™´åœ†ç¼ºï¼Œæ­¤äº‹å¤éš¾å…¨ã€‚<br>ä½†æ„¿äººé•¿ä¹…ï¼Œåƒé‡Œå…±å©µå¨Ÿã€‚</p></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-23-é˜¿é‡Œå›¾æ ‡-icon">2.23 é˜¿é‡Œå›¾æ ‡ icon</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon [icon-xxxx],[font-size] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>icon-xxxx</code>ï¼šè¡¨ç¤ºå›¾æ ‡<code>font-class</code>,å¯ä»¥åœ¨è‡ªå·±çš„é˜¿é‡ŒçŸ¢é‡å›¾æ ‡åº“é¡¹ç›®çš„<code>font-class</code>å¼•ç”¨æ–¹æ¡ˆå†…æŸ¥è¯¢å¹¶å¤åˆ¶ã€‚</li><li><code>font-size</code>ï¼šè¡¨ç¤ºå›¾æ ‡å¤§å°ï¼Œç›´æ¥å¡«å†™æ•°å­—å³å¯ï¼Œå•ä½ä¸º<code>em</code>ã€‚å›¾æ ‡å¤§å°é»˜è®¤å€¼ä¸º<code>1em</code>ã€‚</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% icon icon-rat<span class="emphasis">_zi %&#125;&#123;% icon icon-rat,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-ox_</span>chou,3 %&#125;&#123;% icon icon-ox,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-tiger<span class="emphasis">_yin,5 %&#125;&#123;% icon icon-tiger,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rabbit_</span>mao,1 %&#125;&#123;% icon icon-rabbit,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dragon<span class="emphasis">_chen,3 %&#125;&#123;% icon icon-dragon,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-snake_</span>si,5 %&#125;&#123;% icon icon-snake,6 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-horse<span class="emphasis">_wu %&#125;&#123;% icon icon-horse,2 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-goat_</span>wei,3 %&#125;&#123;% icon icon-goat,4 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-monkey<span class="emphasis">_shen,5 %&#125;&#123;% icon icon-monkey,6 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-rooster_</span>you %&#125;&#123;% icon icon-rooster,2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% icon icon-dog<span class="emphasis">_xu,3 %&#125;&#123;% icon icon-dog,4 %&#125;</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">&#123;% icon icon-boar_</span>hai,5 %&#125;&#123;% icon icon-boar,6 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rat_zi"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rat"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-ox_chou"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-ox"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-tiger_yin"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-tiger"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rabbit_mao"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rabbit"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dragon_chen"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dragon"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-snake_si"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-snake"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-horse_wu"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-horse"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-goat_wei"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-goat"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-monkey_shen"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-monkey"></use></svg></p><p><svg class="icon" style="width:1em; height:1em" aria-hidden="true"><use xlink:href="#icon-rooster_you"></use></svg><svg class="icon" style="width:2em; height:2em" aria-hidden="true"><use xlink:href="#icon-rooster"></use></svg></p><p><svg class="icon" style="width:3em; height:3em" aria-hidden="true"><use xlink:href="#icon-dog_xu"></use></svg><svg class="icon" style="width:4em; height:4em" aria-hidden="true"><use xlink:href="#icon-dog"></use></svg></p><p><svg class="icon" style="width:5em; height:5em" aria-hidden="true"><use xlink:href="#icon-boar_hai"></use></svg><svg class="icon" style="width:6em; height:6em" aria-hidden="true"><use xlink:href="#icon-boar"></use></svg></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-24-ç‰¹æ•ˆæ ‡ç­¾wow">2.24 ç‰¹æ•ˆæ ‡ç­¾wow</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ¸²æŸ“æ¼”ç¤º</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow [animete],[duration],[delay],[offset],[iteration] %&#125;</span><br><span class="line">å†…å®¹</span><br><span class="line">&#123;% endwow %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>animate</code>: åŠ¨ç”»æ ·å¼ï¼Œæ•ˆæœè¯¦è§<a href="https://animate.style/">animate.csså‚è€ƒæ–‡æ¡£</a></li><li><code>duration</code>: é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»æŒç»­æ—¶é—´ï¼Œå•ä½å¯ä»¥æ˜¯<code>ms</code>ä¹Ÿå¯ä»¥æ˜¯<code>s</code>ã€‚ä¾‹å¦‚<code>3s</code>ï¼Œ<code>700ms</code>ã€‚</li><li><code>delay</code>: é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»å¼€å§‹çš„å»¶è¿Ÿæ—¶é—´ï¼Œå•ä½å¯ä»¥æ˜¯<code>ms</code>ä¹Ÿå¯ä»¥æ˜¯<code>s</code>ã€‚ä¾‹å¦‚<code>3s</code>ï¼Œ<code>700ms</code>ã€‚</li><li><code>offset</code>: é€‰å¡«é¡¹ï¼Œå¼€å§‹åŠ¨ç”»çš„è·ç¦»ï¼ˆç›¸å¯¹æµè§ˆå™¨åº•éƒ¨ï¼‰</li><li><code>iteration</code>: é€‰å¡«é¡¹ï¼ŒåŠ¨ç”»é‡å¤çš„æ¬¡æ•°</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><p>1.flipåŠ¨ç”»æ•ˆæœã€‚</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__zoomIn,5s,5s,100,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`zoomIn`åŠ¨ç”»æ•ˆæœï¼ŒæŒç»­`5s`ï¼Œå»¶æ—¶`5s`ï¼Œç¦»åº•éƒ¨`100`è·ç¦»æ—¶å¯åŠ¨ï¼Œé‡å¤`10`æ¬¡</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>2.zoomInåŠ¨ç”»æ•ˆæœï¼ŒæŒç»­5sï¼Œå»¶æ—¶5sï¼Œç¦»åº•éƒ¨100è·ç¦»æ—¶å¯åŠ¨ï¼Œé‡å¤10æ¬¡</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__zoomIn,5s,5s,100,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`zoomIn`åŠ¨ç”»æ•ˆæœï¼ŒæŒç»­`5s`ï¼Œå»¶æ—¶`5s`ï¼Œç¦»åº•éƒ¨`100`è·ç¦»æ—¶å¯åŠ¨ï¼Œé‡å¤`10`æ¬¡</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>3.slideInRightåŠ¨ç”»æ•ˆæœï¼ŒæŒç»­5sï¼Œå»¶æ—¶5s</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__slideInRight,5s,5s %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note orange &#x27;fas fa-car&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`slideInRight`åŠ¨ç”»æ•ˆæœï¼ŒæŒç»­`5s`ï¼Œå»¶æ—¶`5s`ã€‚</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><p>4.heartBeatåŠ¨ç”»æ•ˆæœï¼Œå»¶æ—¶5sï¼Œé‡å¤10æ¬¡ã€‚æ­¤å¤„æ³¨æ„ä¸ç”¨çš„å‚æ•°ä½ç½®è¦ç•™ç©ºï¼Œç”¨é€—å·é—´éš”ã€‚</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% wow animate<span class="strong">__heartBeat,,5s,,10 %&#125;</span></span><br><span class="line"><span class="strong">&#123;% note red &#x27;fas fa-battery-half&#x27; modern%&#125;</span></span><br><span class="line"><span class="strong">`heartBeat`åŠ¨ç”»æ•ˆæœï¼Œå»¶æ—¶`5s`ï¼Œé‡å¤`10`æ¬¡ã€‚</span></span><br><span class="line"><span class="strong">&#123;% endnote %&#125;</span></span><br><span class="line"><span class="strong">&#123;% endwow %&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>1.flipåŠ¨ç”»æ•ˆæœã€‚</p><div class='wow animate__zoomIn' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset='100'  data-wow-iteration='10' ><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><code>zoomIn</code>åŠ¨ç”»æ•ˆæœï¼ŒæŒç»­<code>5s</code>ï¼Œå»¶æ—¶<code>5s</code>ï¼Œç¦»åº•éƒ¨<code>100</code>è·ç¦»æ—¶å¯åŠ¨ï¼Œé‡å¤<code>10</code>æ¬¡</p></div></div><p>2.zoomInåŠ¨ç”»æ•ˆæœï¼ŒæŒç»­5sï¼Œå»¶æ—¶5sï¼Œç¦»åº•éƒ¨100è·ç¦»æ—¶å¯åŠ¨ï¼Œé‡å¤10æ¬¡</p><div class='wow animate__zoomIn' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset='100'  data-wow-iteration='10' ><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p><code>zoomIn</code>åŠ¨ç”»æ•ˆæœï¼ŒæŒç»­<code>5s</code>ï¼Œå»¶æ—¶<code>5s</code>ï¼Œç¦»åº•éƒ¨<code>100</code>è·ç¦»æ—¶å¯åŠ¨ï¼Œé‡å¤<code>10</code>æ¬¡</p></div></div><p>3.slideInRightåŠ¨ç”»æ•ˆæœï¼ŒæŒç»­5sï¼Œå»¶æ—¶5s</p><div class='wow animate__slideInRight' data-wow-duration='5s' data-wow-delay='5s' data-wow-offset=''  data-wow-iteration='' ><div class="note orange icon-padding modern"><i class="note-icon fas fa-car"></i><p><code>slideInRight</code>åŠ¨ç”»æ•ˆæœï¼ŒæŒç»­<code>5s</code>ï¼Œå»¶æ—¶<code>5s</code>ã€‚</p></div></div><p>4.heartBeatåŠ¨ç”»æ•ˆæœï¼Œå»¶æ—¶5sï¼Œé‡å¤10æ¬¡ã€‚æ­¤å¤„æ³¨æ„ä¸ç”¨çš„å‚æ•°ä½ç½®è¦ç•™ç©ºï¼Œç”¨é€—å·é—´éš”ã€‚</p><div class='wow animate__heartBeat' data-wow-duration='' data-wow-delay='5s' data-wow-offset=''  data-wow-iteration='10' ><div class="note red icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p><code>heartBeat</code>åŠ¨ç”»æ•ˆæœï¼Œå»¶æ—¶<code>5s</code>ï¼Œé‡å¤<code>10</code>æ¬¡ã€‚</p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-25-è¿›åº¦æ¡-progress">2.25  è¿›åº¦æ¡ progress</h2><div class="note info flat"><p>è¿›åº¦æ¡æ ‡ç­¾å‚è€ƒ<a href="https://rongbuqiu.com/jdt.html">æ²‚ä½°å­œçŒ«-ç»™HEXOæ–‡ç« æ·»åŠ å½©è‰²è¿›åº¦æ¡</a>ã€‚<br>æºæ ·å¼æå–è‡ª<a href="https://zwying0814.gitbook.io/cuteen/">Cuteen</a>ä¸»é¢˜ã€‚</p></div><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% progress [width] [color] [text] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>width</code>: 0åˆ°100çš„é˜¿æ‹‰ä¼¯æ•°å­—</li><li><code>color</code>: é¢œè‰²ï¼Œå–å€¼æœ‰red,yellow,green,cyan,blue,gray</li><li><code>text</code>:è¿›åº¦æ¡ä¸Šçš„æ–‡å­—å†…å®¹</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% progress 10 red è¿›åº¦æ¡æ ·å¼é¢„è§ˆ %&#125;</span><br><span class="line">&#123;% progress 30 yellow è¿›åº¦æ¡æ ·å¼é¢„è§ˆ %&#125;</span><br><span class="line">&#123;% progress 50 green è¿›åº¦æ¡æ ·å¼é¢„è§ˆ %&#125;</span><br><span class="line">&#123;% progress 70 cyan è¿›åº¦æ¡æ ·å¼é¢„è§ˆ %&#125;</span><br><span class="line">&#123;% progress 90 blue è¿›åº¦æ¡æ ·å¼é¢„è§ˆ %&#125;</span><br><span class="line">&#123;% progress 100 gray è¿›åº¦æ¡æ ·å¼é¢„è§ˆ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-red"  style="width: 10%" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100"><p>è¿›åº¦æ¡æ ·å¼é¢„è§ˆ</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-yellow"  style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"><p>è¿›åº¦æ¡æ ·å¼é¢„è§ˆ</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-green"  style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"><p>è¿›åº¦æ¡æ ·å¼é¢„è§ˆ</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-cyan"  style="width: 70%" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"><p>è¿›åº¦æ¡æ ·å¼é¢„è§ˆ</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-blue"  style="width: 90%" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100"><p>è¿›åº¦æ¡æ ·å¼é¢„è§ˆ</p></div></div><div class="progress"><div class="progress-bar-animated progress-bar progress-bar-striped bg-gray"  style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"><p>è¿›åº¦æ¡æ ·å¼é¢„è§ˆ</p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-26-æ³¨é‡Š-notation">2.26 æ³¨é‡Š notation</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% nota [label] , [text] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><p><code>label</code>: æ³¨é‡Šè¯æ±‡</p></li><li><p><code>text</code>: æ‚¬åœæ˜¾ç¤ºçš„æ³¨è§£å†…å®¹</p></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% nota æŠŠé¼ æ ‡ç§»åŠ¨åˆ°æˆ‘ä¸Šé¢è¯•è¯• ,å¯ä»¥çœ‹åˆ°æ³¨è§£å†…å®¹å‡ºç°åœ¨é¡¶æ  %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p><span class='nota' data-nota='å¯ä»¥çœ‹åˆ°æ³¨è§£å†…å®¹å‡ºç°åœ¨é¡¶æ '>æŠŠé¼ æ ‡ç§»åŠ¨åˆ°æˆ‘ä¸Šé¢è¯•è¯•</span></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-27-æ°”æ³¡æ³¨é‡Š-bubble">2.27 æ°”æ³¡æ³¨é‡Š bubble</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% bubble [content] , [notation] ,[background-color] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>content</code>: æ³¨é‡Šè¯æ±‡</li><li><code>notation</code>: æ‚¬åœæ˜¾ç¤ºçš„æ³¨è§£å†…å®¹</li><li><code>background-color</code>: å¯é€‰ï¼Œæ°”æ³¡èƒŒæ™¯è‰²ã€‚é»˜è®¤ä¸ºâ€œ#71a4e3â€</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ€è¿‘æˆ‘å­¦åˆ°äº†ä¸å°‘æ–°ç©æ„å„¿ï¼ˆè™½ç„¶å¯¹å¾ˆå¤šå¤§ä½¬æ¥è¯´è¿™äº›å·²ç»æ˜¯æ—§æŠ€æœ¯äº†ï¼‰ï¼Œæ¯”å¦‚CSSçš„&#123;% bubble å…„å¼Ÿç›¸é‚»é€‰æ‹©å™¨,&quot;ä¾‹å¦‚ h1 + p &#123;margin-top:50px;&#125;&quot; %&#125;ï¼Œ&#123;% bubble flexå¸ƒå±€,&quot;Flex æ˜¯ Flexible Box çš„ç¼©å†™ï¼Œæ„ä¸º&quot;å¼¹æ€§å¸ƒå±€&quot;ï¼Œç”¨æ¥ä¸ºç›’çŠ¶æ¨¡å‹æä¾›æœ€å¤§çš„çµæ´»æ€§&quot;,&quot;#ec5830&quot; %&#125;ï¼Œ&#123;% bubble transformå˜æ¢,&quot;transform å±æ€§å‘å…ƒç´ åº”ç”¨ 2D æˆ– 3D è½¬æ¢ã€‚è¯¥å±æ€§å…è®¸æˆ‘ä»¬å¯¹å…ƒç´ è¿›è¡Œæ—‹è½¬ã€ç¼©æ”¾ã€ç§»åŠ¨æˆ–å€¾æ–œã€‚&quot;,&quot;#1db675&quot; %&#125;ï¼Œanimationçš„&#123;% bubble è´å¡å°”é€Ÿåº¦æ›²çº¿,&quot;è´å¡å°”æ›²çº¿(BÃ©zier curve)ï¼Œåˆç§°è´å…¹æ›²çº¿æˆ–è´æµåŸƒæ›²çº¿ï¼Œæ˜¯åº”ç”¨äºäºŒç»´å›¾å½¢åº”ç”¨ç¨‹åºçš„æ•°å­¦æ›²çº¿ã€‚ä¸€èˆ¬çš„çŸ¢é‡å›¾å½¢è½¯ä»¶é€šè¿‡å®ƒæ¥ç²¾ç¡®ç”»å‡ºæ›²çº¿ï¼Œè´å…¹æ›²çº¿ç”±çº¿æ®µä¸èŠ‚ç‚¹ç»„æˆï¼ŒèŠ‚ç‚¹æ˜¯å¯æ‹–åŠ¨çš„æ”¯ç‚¹ï¼Œçº¿æ®µåƒå¯ä¼¸ç¼©çš„çš®ç­‹&quot;,&quot;#de4489&quot; %&#125;å†™æ³•ï¼Œè¿˜æœ‰ä»Šå¤©åˆšçœ‹åˆ°çš„&#123;% bubble clip-path,&quot;clip-pathå±æ€§ä½¿ç”¨è£å‰ªæ–¹å¼åˆ›å»ºå…ƒç´ çš„å¯æ˜¾ç¤ºåŒºåŸŸã€‚åŒºåŸŸå†…çš„éƒ¨åˆ†æ˜¾ç¤ºï¼ŒåŒºåŸŸå¤–çš„éšè—ã€‚&quot;,&quot;#868fd7&quot; %&#125;å±æ€§ã€‚è¿™äº›å¯¹æˆ‘æ¥è¯´å¾ˆæ–°é¢–çš„æ¦‚å¿µç‹ ç‹ çš„å†²å‡»ç€æˆ‘ä»¥å‰ç§¯ç´¯èµ·æ¥çš„è®¾è®¡æ€è·¯ã€‚</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>æœ€è¿‘æˆ‘å­¦åˆ°äº†ä¸å°‘æ–°ç©æ„å„¿ï¼ˆè™½ç„¶å¯¹å¾ˆå¤šå¤§ä½¬æ¥è¯´è¿™äº›å·²ç»æ˜¯æ—§æŠ€æœ¯äº†ï¼‰ï¼Œæ¯”å¦‚CSSçš„<span class="bubble-content">å…„å¼Ÿç›¸é‚»é€‰æ‹©å™¨</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#71a4e3;">ä¾‹å¦‚ h1 + p {margin-top:50px;}</span></span>ï¼Œ<span class="bubble-content">flexå¸ƒå±€</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#ec5830;">Flex æ˜¯ Flexible Box çš„ç¼©å†™ï¼Œæ„ä¸ºå¼¹æ€§å¸ƒå±€&quot;ï¼Œç”¨æ¥ä¸ºç›’çŠ¶æ¨¡å‹æä¾›æœ€å¤§çš„çµæ´»æ€§&quot;</span></span>ï¼Œ<span class="bubble-content">transformå˜æ¢</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#1db675;">transform å±æ€§å‘å…ƒç´ åº”ç”¨ 2D æˆ– 3D è½¬æ¢ã€‚è¯¥å±æ€§å…è®¸æˆ‘ä»¬å¯¹å…ƒç´ è¿›è¡Œæ—‹è½¬ã€ç¼©æ”¾ã€ç§»åŠ¨æˆ–å€¾æ–œã€‚</span></span>ï¼Œanimationçš„<span class="bubble-content">è´å¡å°”é€Ÿåº¦æ›²çº¿</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#de4489;">è´å¡å°”æ›²çº¿(BÃ©zier curve)ï¼Œåˆç§°è´å…¹æ›²çº¿æˆ–è´æµåŸƒæ›²çº¿ï¼Œæ˜¯åº”ç”¨äºäºŒç»´å›¾å½¢åº”ç”¨ç¨‹åºçš„æ•°å­¦æ›²çº¿ã€‚ä¸€èˆ¬çš„çŸ¢é‡å›¾å½¢è½¯ä»¶é€šè¿‡å®ƒæ¥ç²¾ç¡®ç”»å‡ºæ›²çº¿ï¼Œè´å…¹æ›²çº¿ç”±çº¿æ®µä¸èŠ‚ç‚¹ç»„æˆï¼ŒèŠ‚ç‚¹æ˜¯å¯æ‹–åŠ¨çš„æ”¯ç‚¹ï¼Œçº¿æ®µåƒå¯ä¼¸ç¼©çš„çš®ç­‹</span></span>å†™æ³•ï¼Œè¿˜æœ‰ä»Šå¤©åˆšçœ‹åˆ°çš„<span class="bubble-content">clip-path</span><span class="bubble-notation"><span class="bubble-item" style="background-color:#868fd7;">clip-pathå±æ€§ä½¿ç”¨è£å‰ªæ–¹å¼åˆ›å»ºå…ƒç´ çš„å¯æ˜¾ç¤ºåŒºåŸŸã€‚åŒºåŸŸå†…çš„éƒ¨åˆ†æ˜¾ç¤ºï¼ŒåŒºåŸŸå¤–çš„éšè—ã€‚</span></span>å±æ€§ã€‚è¿™äº›å¯¹æˆ‘æ¥è¯´å¾ˆæ–°é¢–çš„æ¦‚å¿µç‹ ç‹ çš„å†²å‡»ç€æˆ‘ä»¥å‰ç§¯ç´¯èµ·æ¥çš„è®¾è®¡æ€è·¯ã€‚</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-28-å¼•ç”¨æ–‡çŒ®-reference">2.28 å¼•ç”¨æ–‡çŒ® reference</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% referto [id] , [literature] %&#125;</span><br><span class="line">&#123;% referfrom [id] , [literature] , [url] %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><p>referto å¼•ç”¨ä¸Šæ ‡</p><ul><li><p><code>id</code>: ä¸Šæ ‡åºå·å†…å®¹ï¼Œéœ€ä¸referfromæ ‡ç­¾çš„idå¯¹åº”æ‰èƒ½å®ç°è·³è½¬</p></li><li><p><code>literature</code>: å¼•ç”¨çš„å‚è€ƒæ–‡çŒ®åç§°</p></li></ul></li><li><p>referfrom å¼•ç”¨å‡ºå¤„</p><ul><li><p><code>id</code>: åºå·å†…å®¹ï¼Œéœ€ä¸refertoæ ‡ç­¾çš„idå¯¹åº”æ‰èƒ½å®ç° è·³è½¬</p></li><li><p><code>literature</code>: å¼•ç”¨çš„å‚è€ƒæ–‡çŒ®åç§°</p></li><li><p><code>url</code>: å¼•ç”¨çš„å‚è€ƒæ–‡çŒ®é“¾æ¥ï¼Œå¯çœç•¥</p></li></ul></li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Akilarã®ç³–æœå±‹(akilar.top)æ˜¯ä¸€ä¸ªç§äººæ€§è´¨çš„åšå®¢&#123;% referto &#x27;[1]&#x27;,&#x27;Akilarã®ç³–æœå±‹ç¾¤èŠç®€ä»‹&#x27; %&#125;ï¼Œä»å„ç±»æ•™ç¨‹è‡³ç”Ÿæ´»ç‚¹æ»´ï¼Œæ— è¯ä¸è°ˆã€‚å»ºç¾¤çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªé—²èŠçš„åœºæ‰€ã€‚åšå®¢é‡‡ç”¨Hexoæ¡†æ¶&#123;% referto &#x27;[2]&#x27;,&#x27;Hexoä¸­æ–‡æ–‡æ¡£&#x27; %&#125;ï¼ŒButterflyä¸»é¢˜&#123;% referto &#x27;[3]&#x27;,&#x27;Butterfly å®‰è£…æ–‡æ¡£(ä¸€) å¿«é€Ÿå¼€å§‹&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">æœ¬é¡¹ç›®å‚è€ƒäº†Volantis&#123;% referto &#x27;[4]&#x27;,&#x27;hexo-theme-volantis æ ‡ç­¾æ’ä»¶&#x27; %&#125;çš„æ ‡ç­¾æ ·å¼ã€‚å¼•å…¥<span class="code">`[tag].js`</span>ï¼Œå¹¶é’ˆå¯¹<span class="code">`butterfly`</span>ä¸»é¢˜ä¿®æ”¹äº†ç›¸åº”çš„<span class="code">`[tag].styl`</span>ã€‚åœ¨æ­¤é¸£è°¢<span class="code">`Volantis`</span>ä¸»é¢˜ä¼—å¼€å‘è€…ã€‚</span><br><span class="line">ä¸»è¦å‚è€ƒå†…å®¹åŒ…æ‹¬å„ä¸ªvolantisçš„å†…ç½®æ ‡ç­¾æ’ä»¶æ–‡æ¡£&#123;% referto &#x27;[5]&#x27;,&#x27;Volantisæ–‡æ¡£:å†…ç½®æ ‡ç­¾æ’ä»¶&#x27; %&#125;</span><br><span class="line">Butterflyä¸»é¢˜çš„å„ä¸ªè¡ç”Ÿé­”æ”¹&#123;% referto &#x27;[6]&#x27;,&#x27;Butterfly å®‰è£…æ–‡æ¡£:æ ‡ç­¾å¤–æŒ‚ï¼ˆTag Plugins&#x27; %&#125;&#123;% referto &#x27;[7]&#x27;,&#x27;å°å¼‹ã®ç”Ÿæ´»é¦†å…¨æ ·å¼é¢„è§ˆ&#x27; %&#125;&#123;% referto &#x27;[8]&#x27;,&#x27;l-lin-font-awesome-animation&#x27; %&#125;&#123;% referto &#x27;[9]&#x27;,&#x27;å°åº·çš„butterflyä¸»é¢˜ä½¿ç”¨æ–‡æ¡£&#x27; %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% referfrom &#x27;[1]&#x27;,&#x27;Akilarã®ç³–æœå±‹ç¾¤èŠç®€ä»‹&#x27;,&#x27;https://jq.qq.com/?<span class="emphasis">_wv=1027&amp;k=pGLB2C0N&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[2]&#x27;,&#x27;Hexoä¸­æ–‡æ–‡æ¡£&#x27;,&#x27;https://hexo.io/zh-cn/docs/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[3]&#x27;,&#x27;Butterfly å®‰è£…æ–‡æ¡£(ä¸€) å¿«é€Ÿå¼€å§‹&#x27;,&#x27;https://butterfly.js.org/posts/21cfbf15/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[4]&#x27;,&#x27;hexo-theme-volantis æ ‡ç­¾æ’ä»¶&#x27;,&#x27;https://volantis.js.org/v5/tag-plugins/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[5]&#x27;,&#x27;Volantisæ–‡æ¡£:å†…ç½®æ ‡ç­¾æ’ä»¶&#x27;,&#x27;https://volantis.js.org/tag-plugins/&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[6]&#x27;,&#x27;Butterfly å®‰è£…æ–‡æ¡£:æ ‡ç­¾å¤–æŒ‚ï¼ˆTag Plugins&#x27;,&#x27;https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[7]&#x27;,&#x27;å°å¼‹ã®ç”Ÿæ´»é¦†å…¨æ ·å¼é¢„è§ˆ&#x27;,&#x27;https://lovelijunyi.gitee.io/posts/c898.html&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[8]&#x27;,&#x27;l-lin-font-awesome-animation&#x27;,&#x27;https://github.com/l-lin/font-awesome-animation&#x27; %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% referfrom &#x27;[9]&#x27;,&#x27;å°åº·çš„butterflyä¸»é¢˜ä½¿ç”¨æ–‡æ¡£&#x27;,&#x27;https://www.antmoe.com/posts/3b43914f/&#x27; %&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>Akilarã®ç³–æœå±‹(akilar.top)æ˜¯ä¸€ä¸ªç§äººæ€§è´¨çš„åšå®¢<span class="hidden-anchor" id="referto_[1]"></span><sup class="reference"><a href="#referfrom_[1]">[1]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Akilarã®ç³–æœå±‹ç¾¤èŠç®€ä»‹</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span>ï¼Œä»å„ç±»æ•™ç¨‹è‡³ç”Ÿæ´»ç‚¹æ»´ï¼Œæ— è¯ä¸è°ˆã€‚å»ºç¾¤çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªé—²èŠçš„åœºæ‰€ã€‚åšå®¢é‡‡ç”¨Hexoæ¡†æ¶<span class="hidden-anchor" id="referto_[2]"></span><sup class="reference"><a href="#referfrom_[2]">[2]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Hexoä¸­æ–‡æ–‡æ¡£</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span>ï¼ŒButterflyä¸»é¢˜<span class="hidden-anchor" id="referto_[3]"></span><sup class="reference"><a href="#referfrom_[3]">[3]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Butterfly å®‰è£…æ–‡æ¡£(ä¸€) å¿«é€Ÿå¼€å§‹</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span></p><p>æœ¬é¡¹ç›®å‚è€ƒäº†Volantis<span class="hidden-anchor" id="referto_[4]"></span><sup class="reference"><a href="#referfrom_[4]">[4]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">hexo-theme-volantis æ ‡ç­¾æ’ä»¶</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span>çš„æ ‡ç­¾æ ·å¼ã€‚å¼•å…¥<code>[tag].js</code>ï¼Œå¹¶é’ˆå¯¹<code>butterfly</code>ä¸»é¢˜ä¿®æ”¹äº†ç›¸åº”çš„<code>[tag].styl</code>ã€‚åœ¨æ­¤é¸£è°¢<code>Volantis</code>ä¸»é¢˜ä¼—å¼€å‘è€…ã€‚<br>ä¸»è¦å‚è€ƒå†…å®¹åŒ…æ‹¬å„ä¸ªvolantisçš„å†…ç½®æ ‡ç­¾æ’ä»¶æ–‡æ¡£<span class="hidden-anchor" id="referto_[5]"></span><sup class="reference"><a href="#referfrom_[5]">[5]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Volantisæ–‡æ¡£:å†…ç½®æ ‡ç­¾æ’ä»¶</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span><br>Butterflyä¸»é¢˜çš„å„ä¸ªè¡ç”Ÿé­”æ”¹<span class="hidden-anchor" id="referto_[6]"></span><sup class="reference"><a href="#referfrom_[6]">[6]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">Butterfly å®‰è£…æ–‡æ¡£:æ ‡ç­¾å¤–æŒ‚ï¼ˆTag Plugins</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span><span class="hidden-anchor" id="referto_[7]"></span><sup class="reference"><a href="#referfrom_[7]">[7]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">å°å¼‹ã®ç”Ÿæ´»é¦†å…¨æ ·å¼é¢„è§ˆ</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span><span class="hidden-anchor" id="referto_[8]"></span><sup class="reference"><a href="#referfrom_[8]">[8]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">l-lin-font-awesome-animation</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span><span class="hidden-anchor" id="referto_[9]"></span><sup class="reference"><a href="#referfrom_[9]">[9]</a></sup><span class="reference-bubble"><span class="reference-item"><span class="reference-literature">å°åº·çš„butterflyä¸»é¢˜ä½¿ç”¨æ–‡æ¡£</span><span class="reference-title">å‚è€ƒèµ„æ–™</span></span></span></p><div class="reference-source"><span class="hidden-anchor" id="referfrom_[1]"></span><a class="reference-anchor" href="#referto_[1]">[1]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://jq.qq.com/?_wv=1027&k=pGLB2C0N">Akilarã®ç³–æœå±‹ç¾¤èŠç®€ä»‹</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[2]"></span><a class="reference-anchor" href="#referto_[2]">[2]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://hexo.io/zh-cn/docs/">Hexoä¸­æ–‡æ–‡æ¡£</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[3]"></span><a class="reference-anchor" href="#referto_[3]">[3]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://butterfly.js.org/posts/21cfbf15/">Butterfly å®‰è£…æ–‡æ¡£(ä¸€) å¿«é€Ÿå¼€å§‹</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[4]"></span><a class="reference-anchor" href="#referto_[4]">[4]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://volantis.js.org/v5/tag-plugins/">hexo-theme-volantis æ ‡ç­¾æ’ä»¶</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[5]"></span><a class="reference-anchor" href="#referto_[5]">[5]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://volantis.js.org/tag-plugins/">Volantisæ–‡æ¡£:å†…ç½®æ ‡ç­¾æ’ä»¶</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[6]"></span><a class="reference-anchor" href="#referto_[6]">[6]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://butterfly.js.org/posts/4aa8abbe/#%E6%A8%99%E7%B1%A4%E5%A4%96%E6%8E%9B%EF%BC%88Tag-Plugins%EF%BC%89">Butterfly å®‰è£…æ–‡æ¡£:æ ‡ç­¾å¤–æŒ‚ï¼ˆTag Plugins</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[7]"></span><a class="reference-anchor" href="#referto_[7]">[7]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://lovelijunyi.gitee.io/posts/c898.html">å°å¼‹ã®ç”Ÿæ´»é¦†å…¨æ ·å¼é¢„è§ˆ</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[8]"></span><a class="reference-anchor" href="#referto_[8]">[8]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://github.com/l-lin/font-awesome-animation">l-lin-font-awesome-animation</a></div><div class="reference-source"><span class="hidden-anchor" id="referfrom_[9]"></span><a class="reference-anchor" href="#referto_[9]">[9]<div class="reference-anchor-up fa-solid fa-angles-up"></div></a><a class="reference-link" href="https://www.antmoe.com/posts/3b43914f/">å°åº·çš„butterflyä¸»é¢˜ä½¿ç”¨æ–‡æ¡£</a></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-29-PDFå±•ç¤º">2.29 PDFå±•ç¤º</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% pdf æ–‡ä»¶è·¯å¾„ %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li><code>æ–‡ä»¶è·¯å¾„</code>: å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–è€…æ˜¯åœ¨çº¿é“¾æ¥</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 1.æœ¬åœ°æ–‡ä»¶:åœ¨mdæ–‡ä»¶è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ï¼Œå…¶å†…æ”¾pdfæ–‡ä»¶åä¸ºxxx.pdfçš„æ–‡ä»¶</span></span><br><span class="line">&#123;% pdf xxx.pdf %&#125;</span><br><span class="line"><span class="section"># 2.åœ¨çº¿é“¾æ¥</span></span><br><span class="line">&#123;% pdf https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/å°ä½œæ–‡è®²ä¹‰.pdf %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><p>2.åœ¨çº¿é“¾æ¥(è¦æ”¾åˆ°æœ€å¤–å±‚æ‰èƒ½èµ·ä½œç”¨)</p><pre><code>&lt;div class=&quot;row&quot;&gt;&lt;embed src=&quot;https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/å°ä½œæ–‡è®²ä¹‰.pdf&quot; width=&quot;100%&quot; height=&quot;550&quot; type=&quot;application/pdf&quot;&gt;&lt;/div&gt;</code></pre><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-30-Hexo-tag-map-æ’ä»¶">2.30 Hexo-tag-map æ’ä»¶</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% + æ ‡ç­¾å€¼ + ç»åº¦ + çº¬åº¦ + æ–‡æœ¬ + ç¼©æ”¾ç­‰çº§ + å®½ + é«˜ + é»˜è®¤å›¾å±‚ + %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><table><thead><tr><th style="text-align:center">åœ°å›¾å</th><th style="text-align:center">æ ‡ç­¾å€¼ &lt;å¿…å¡«&gt;</th><th style="text-align:center">å®½ (é»˜è®¤ 100%) / é«˜ (é»˜è®¤ 360px)</th><th style="text-align:center">ç¼©æ”¾ç­‰çº§ (é»˜è®¤ 14)</th><th style="text-align:center">å®½ (é»˜è®¤ 100%) / é«˜ (é»˜è®¤ 360px)</th><th style="text-align:center">é»˜è®¤å›¾å±‚ (é»˜è®¤ 1)</th></tr></thead><tbody><tr><td style="text-align:center">æ··åˆåœ°å›¾</td><td style="text-align:center">map</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 3~18</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~7</td></tr><tr><td style="text-align:center">è°·æ­Œåœ°å›¾</td><td style="text-align:center">googleMap</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~20</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~3</td></tr><tr><td style="text-align:center">é«˜å¾·åœ°å›¾</td><td style="text-align:center">gaodeMap</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 3~18</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~3</td></tr><tr><td style="text-align:center">ç™¾åº¦åœ°å›¾</td><td style="text-align:center">baiduMap</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 4~18</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~2</td></tr><tr><td style="text-align:center">Geoq åœ°å›¾</td><td style="text-align:center">geoqMap</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~18</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~5</td></tr><tr><td style="text-align:center">openstreet åœ°å›¾</td><td style="text-align:center">openstreetMap</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">å–å€¼ 1~18</td><td style="text-align:center">ç™¾åˆ†æ•°æˆ–å…·ä½“å€¼ (100% æˆ– 360px)</td><td style="text-align:center">ä¸æ”¯æŒæ­¤å‚æ•°</td></tr></tbody></table><ol><li>å‚æ•°ä¹‹é—´ï¼Œç”¨è‹±æ–‡é€—å·ç›¸éš”</li><li>å‚æ•°å¿…é¡»æŒ‰ä¸Šè¿°äº‹ä¾‹é¡ºåºè¾“å…¥ï¼Œä¸å¾—ä¸ºç©º</li><li>åŒä¸€ä¸ªé¡µé¢ï¼ŒåŒä¸€ç»„ç»çº¬åº¦å€¼ï¼Œåªèƒ½æ’å…¥ä¸€ä¸ªç›¸åŒæ ‡ç­¾å€¼çš„åœ°å›¾ (è‹¥æœ‰éœ€è¦ï¼Œå¯ä»¥å°†ç¬¬äºŒä¸ªåœ°å›¾ä¸Šï¼Œç»åº¦æˆ–çº¬åº¦æœ«å°¾åˆ é™¤ä¸€ä¸¤ä¸ªæ•°)</li><li>å‚æ•°å–å€¼å¿…é¡»åœ¨ä¸Šè¿°èŒƒå›´å†…</li><li>é»˜è®¤å›¾å±‚ï¼šå³åœ°å›¾å åŠ å±‚çš„å€¼ï¼Œé»˜è®¤å¸¸è§„åœ°å›¾è¿˜æ˜¯å«æ˜Ÿåœ°å›¾ï¼Œå¯æŒ‰åœ°å›¾æ˜¾ç¤ºé¡ºåºå–å€¼</li><li>ç¼©æ”¾ç­‰çº§ï¼Œæ•°å­—è¶Šå¤§ï¼Œåœ°å›¾æ¯”ä¾‹å°ºè¶Šå°ï¼Œæ˜¾ç¤ºçš„è¶Šç²¾ç»†</li><li>é™¤æ ‡ç­¾å€¼å¤–ï¼Œå…¶ä»–å‚æ•°é€‰å¡«ï¼Œä½† æ¯ä¸ªå‚æ•°çš„å·¦è¾¹çš„å‚æ•°å¿…å¡«</li><li>è°·æ­Œåœ°å›¾éœ€è¦å¤–ç½‘æ‰èƒ½åŠ è½½æŸ¥çœ‹</li></ol><p>åæ ‡è·å–ï¼š<a href="https://lbs.amap.com/tools/picker">é«˜å¾·åœ°å›¾åæ ‡æ‹¾å–ç³»ç»Ÿ</a> ã€<a href="https://api.map.baidu.com/lbsapi/getpoint/index.html">ç™¾åº¦åœ°å›¾åæ ‡æ‹¾å–ç³»ç»Ÿ</a></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% map 120.101101,30.239119 %&#125;</span><br><span class="line">&#123;% googleMap 120.101101,30.239119, è¿™é‡Œæ˜¯è¥¿æ¹–çµéšå¯ºï¼Œæ®è¯´æ±‚å§»ç¼˜å¾ˆçµéªŒå“¦ï¼ %&#125;</span><br><span class="line">&#123;% geoqMap 120.101101,30.239119, è¿™é‡Œæ˜¯è¥¿æ¹–çµéšå¯ºï¼Œæ®è¯´æ±‚å§»ç¼˜å¾ˆçµéªŒå“¦ï¼, 13, 90%, 320px, 3 %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><link rel="stylesheet" href="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div class="map-box" style="margin: 0.8rem 0 1.6rem 0;"><div id="map-120.101101-30.239119" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div></div><script type="text/javascript">var normalm=L.tileLayer.chinaProvider('GaoDe.Normal.Map',{maxZoom:20,minZoom:1,attribution:'é«˜å¾·åœ°å›¾'});var imgm=L.tileLayer.chinaProvider('GaoDe.Satellite.Map',{maxZoom:20,minZoom:1,attribution:'é«˜å¾·åœ°å›¾'});var imga=L.tileLayer.chinaProvider('GaoDe.Satellite.Annotion',{maxZoom:20,minZoom:1,attribution:'é«˜å¾·åœ°å›¾'});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:20,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'});routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1});var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:21,minZoom:1,attribution:'Google Maps'}),routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:21,minZoom:1,attribution:'Google Maps'});var normalm1=L.tileLayer.chinaProvider('Geoq.Normal.Map',{maxZoom:21,minZoom:1,attribution:'GeoQ'});var normal=L.layerGroup([normalm]),image=L.layerGroup([imgm,imga]);var baseLayers={"é«˜å¾·åœ°å›¾":normal,"æ™ºå›¾åœ°å›¾":normalm1,"è°·æ­Œåœ°å›¾":normalMap,"é«˜å¾·å«æ˜Ÿåœ°å›¾":imgm,"è°·æ­Œå«æ˜Ÿåœ°å›¾":satelliteMap,"é«˜å¾·å«æ˜Ÿæ ‡æ³¨":image,"è°·æ­Œå«æ˜Ÿæ ‡æ³¨":routeMap};var mymap=L.map('map-120.101101-30.239119',{center:[30.239119,120.101101],zoom:14,layers:[normal],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'æ”¾å¤§',zoomOutTitle:'ç¼©å°'}).addTo(mymap);</script><br><link rel="stylesheet" href="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div id="googleMap-120.101101-30.239119" style="max-width:100%; height:360px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div><script type="text/javascript">var normalMap=L.tileLayer.chinaProvider('Google.Normal.Map',{maxZoom:22,minZoom:1,attribution:'Google Maps'}),satelliteMap=L.tileLayer.chinaProvider('Google.Satellite.Map',{maxZoom:22,minZoom:1,attribution:'Google Maps'}),routeMap=L.tileLayer.chinaProvider('Google.Satellite.Annotion',{maxZoom:22,minZoom:1,attribution:'Google Maps'});var baseLayers={"è°·æ­Œåœ°å›¾":normalMap,"è°·æ­Œå«æ˜Ÿå›¾":satelliteMap,"è°·æ­Œå«æ˜Ÿæ ‡æ³¨": routeMap};var overlayLayers={};var mymap=L.map("googleMap-120.101101-30.239119",{center:[30.239119,120.101101],zoom:14,layers:[normalMap],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'æ”¾å¤§',zoomOutTitle:'ç¼©å°'}).addTo(mymap);var marker = L.marker(['30.239119','120.101101']).addTo(mymap);marker.bindPopup("è¿™é‡Œæ˜¯è¥¿æ¹–çµéšå¯ºï¼Œæ®è¯´æ±‚å§»ç¼˜å¾ˆçµéªŒå“¦ï¼").openPopup();</script><br><link rel="stylesheet" href="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.css"><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet@1.7.1.js"></script><script data-pjax src="//unpkg.com/hexo-tag-map/lib/leaflet.ChineseTmsProviders@1.0.4.js"></script><div id="geoqMap-120.101101-30.239119" style="max-width:90%; height:320px;display: block;margin:0 auto;z-index:1;border-radius: 5px;"></div><script type="text/javascript">var normalm1=L.tileLayer.chinaProvider('Geoq.Normal.Map',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm2=L.tileLayer.chinaProvider('Geoq.Normal.PurplishBlue',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm3=L.tileLayer.chinaProvider('Geoq.Normal.Gray',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm4=L.tileLayer.chinaProvider('Geoq.Normal.Warm',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normalm5=L.tileLayer.chinaProvider('Geoq.Theme.Hydro',{maxZoom:20,minZoom:1,attribution:'GeoQ'});var normal=L.layerGroup([normalm1,normalm2,normalm3,normalm4,normalm5]);var baseLayers={"æ™ºå›¾åœ°å›¾":normalm1,"åˆå¤œè“":normalm2,"ç°è‰²":normalm3,"æš–è‰²":normalm4,"æ°´ç³»":normalm5};var mymap=L.map("geoqMap-120.101101-30.239119",{center:[30.239119,120.101101],zoom:13,layers:[normalm3],zoomControl:false});L.control.layers(baseLayers,null).addTo(mymap);L.control.zoom({zoomInTitle:'æ”¾å¤§',zoomOutTitle:'ç¼©å°'}).addTo(mymap);var marker = L.marker(['30.239119','120.101101']).addTo(mymap);marker.bindPopup("è¿™é‡Œæ˜¯è¥¿æ¹–çµéšå¯ºï¼Œæ®è¯´æ±‚å§»ç¼˜å¾ˆçµéªŒå“¦ï¼").openPopup();</script><br><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><h2 id="2-31-éšè—å—">2.31 éšè—å—</h2><div class="tabs" id="åˆ†æ "><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#åˆ†æ -1">æ ‡ç­¾è¯­æ³•</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -2">å‚æ•°é…ç½®</button></li><li class="tab"><button type="button" data-href="#åˆ†æ -3">ç¤ºä¾‹æºç </button></li><li class="tab"><button type="button" data-href="#åˆ†æ -4">æ¸²æŸ“æ¼”ç¤º</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="åˆ†æ -1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideBlock display,bg,color %&#125;</span><br><span class="line">content</span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -2"><ol><li>contentï¼šè¦éšè—çš„å†…å®¹</li><li>displayï¼šå±•ç¤ºå‰æŒ‰é’®æ˜¾ç¤ºçš„æ–‡å­—ï¼ˆå¯é€‰ï¼‰</li><li>bgï¼šæŒ‰é’®çš„èƒŒæ™¯é¢œè‰²ï¼ˆå¯é€‰ï¼‰</li><li>colorï¼šæŒ‰é’®æ˜¾ç¤ºçš„æ–‡å­—çš„é¢œè‰²ï¼ˆå¯é€‰ï¼‰</li></ol><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideBlock ç‚¹æˆ‘é¢„è§ˆ, blue %&#125;</span><br><span class="line">è¿™é‡Œæœ‰å¼ å›¾ç‰‡ï¼š</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://s1.vika.cn/space/2022/10/30/b35fce448bc9404a8d65c3ce1e6e46eb&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;image (1)&quot;</span> <span class="attr">style</span>=<span class="string">&quot;zoom:67%;&quot;</span> /&gt;</span></span></span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="åˆ†æ -4"><div class="hide-block"><button type="button" class="hide-button" style="background-color:  blue;">ç‚¹æˆ‘é¢„è§ˆ    </button><div class="hide-content"><p>è¿™é‡Œæœ‰å¼ å›¾ç‰‡ï¼š<br><img src="https://s1.vika.cn/space/2022/10/30/b35fce448bc9404a8d65c3ce1e6e46eb" alt="image (1)" style="zoom:67%;" /></p></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
      
      
      <categories>
          
          <category> æ¼”ç¤º </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> å¤–æŒ‚æ ‡ç­¾ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
