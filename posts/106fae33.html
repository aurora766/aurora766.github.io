<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>mysqlä¸»ä»å¤åˆ¶ | FomalhautğŸ¥</title><meta name="keywords" content="Java,MySQL,ç®—æ³•,ä»£ç ,åšå®¢,Butterfly,Hexo,FomalhautğŸ¥,Fomalhaut"><meta name="author" content="FomalhautğŸ¥"><meta name="copyright" content="FomalhautğŸ¥"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="mysqlçš„ä¸»ä»å¤åˆ¶ã€å»¶æ—¶å¤åˆ¶ã€åŠåŒæ­¥å¤åˆ¶ã€è¿‡æ»¤å¤åˆ¶çš„æ¡ˆä¾‹">
<meta property="og:type" content="article">
<meta property="og:title" content="mysqlä¸»ä»å¤åˆ¶">
<meta property="og:url" content="https://www.fomal.cc/posts/106fae33.html">
<meta property="og:site_name" content="FomalhautğŸ¥">
<meta property="og:description" content="mysqlçš„ä¸»ä»å¤åˆ¶ã€å»¶æ—¶å¤åˆ¶ã€åŠåŒæ­¥å¤åˆ¶ã€è¿‡æ»¤å¤åˆ¶çš„æ¡ˆä¾‹">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://source.fomal.cc/img/default_cover_14.webp">
<meta property="article:published_time" content="2024-09-21T09:45:49.000Z">
<meta property="article:modified_time" content="2024-09-21T10:42:01.989Z">
<meta property="article:author" content="FomalhautğŸ¥">
<meta property="article:tag" content="Java,MySQL,ç®—æ³•,ä»£ç ,åšå®¢,Butterfly,Hexo,FomalhautğŸ¥,Fomalhaut">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://source.fomal.cc/img/default_cover_14.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.fomal.cc/posts/106fae33"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'mysqlä¸»ä»å¤åˆ¶',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-21 18:42:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="FomalhautğŸ¥" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://aurora766.github.io/image/study_img/touxiang.jpg" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">1</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> å” å¨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> æ‹çˆ±å°å±‹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">FomalhautğŸ¥</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xiangzi"></use></svg><span class="menu_word" style="font-size:17px"> å…«å®ç®±</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/box/gallery/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-tubiaozhizuomoban">                   </use></svg><span class="menu_word" style="font-size:17px"> ç”»å»Š</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/animation/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-nvwumao">                   </use></svg><span class="menu_word" style="font-size:17px"> åŠ¨ç”»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-zhifengche">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘å€å¯¼èˆª</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pengyouquan">                   </use></svg><span class="menu_word" style="font-size:17px"> æœ‹å‹åœˆ</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> å” å¨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> æ‹çˆ±å°å±‹</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> å…³äº</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> æœç´¢</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">mysqlä¸»ä»å¤åˆ¶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">å‘è¡¨äº </span><time class="post-meta-date-created" datetime="2024-09-21T09:45:49.000Z" title="å‘è¡¨äº 2024-09-21 17:45:49">2024-09-21</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-09-21T10:42:01.989Z" title="æ›´æ–°äº 2024-09-21 18:42:01">2024-09-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">6788</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>28åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="mysqlä¸»ä»å¤åˆ¶"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="1ã€-mysqlä¸»ä»å¤åˆ¶">1ã€ mysqlä¸»ä»å¤åˆ¶</h3>
<p><strong>ä¸ºä»€ä¹ˆè¦åšä¸»ä»å¤åˆ¶</strong><br>
1ã€ä¸ºäº†åšé«˜å¯ç”¨<br>
2ã€ä¸ºäº†è§£å†³MySQLçš„å•ç‚¹æ•…éšœ<br>
3ã€åˆ†æ‘Šä¸»åº“çš„å‹åŠ›<br>
4ã€åšå¤‡ä»½çš„æƒ…å†µ(å»¶è¿Ÿä»åº“)</p>
<p><strong>Mysqlä¸»ä»å¤åˆ¶åŸç†</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240823161157907.png" alt="image-20240823161157907"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">åŒæ­¥ï¼šIOçº¿ç¨‹æ‹¿åˆ°æ•°æ®äº¤ç»™SQLçº¿ç¨‹ï¼Œsqlçº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼ŒIOçº¿ç¨‹å†å»è¦ä¸‹ä¸€æ¡æ•°æ®(ç±»ä¼¼äºæˆ‘ç»™ä½ ä¼ æ–‡ä»¶ï¼Œæˆ‘è¦ç­‰ä½ æ¥æ”¶å®Œ)</span><br><span class="line">å¼‚æ­¥ï¼šIOçº¿ç¨‹æŠŠæ•°æ®æ”¾åˆ°ç¼“å­˜é‡Œ,ä¸ç®¡SQLçº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œï¼ŒIOçº¿ç¨‹éƒ½ä¼šå»è¦ä¸‹ä¸€æ¡æ•°æ®</span><br><span class="line"></span><br><span class="line">å¦‚æœçœ‹åˆ°SQLæ˜¾ç¤ºNO,å¯èƒ½æ˜¯æ•°æ®çš„é—®é¢˜ï¼Œå¯èƒ½ä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">master.info å‚¨å­˜ä¸»åº“ä¿¡æ¯çš„æ–‡ä»¶</span><br><span class="line">relay-log  ä¸­ç»§æ—¥å¿—ï¼Œä¹Ÿå«å·®å¼‚æ—¥å¿—(ä¸»åº“é‡Œæœ‰ï¼Œä»åº“é‡Œæ²¡æœ‰ï¼Œè¿˜éœ€è¦ä»åº“æ‰§è¡Œçš„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ä¸»åº“å’Œä»åº“çš„æ•°æ®å·®å¼‚çš„)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åŸç†</span></span><br><span class="line">1ï¼‰é€šè¿‡change master toè¯­å¥å‘Šè¯‰ä»åº“ä¸»åº“çš„ipï¼Œportï¼Œuserï¼Œpasswordï¼Œfileï¼Œpos</span><br><span class="line">2ï¼‰ä»åº“é€šè¿‡start slaveå‘½ä»¤å¼€å¯å¤åˆ¶å¿…è¦çš„IOçº¿ç¨‹å’ŒSQLçº¿ç¨‹</span><br><span class="line">3ï¼‰ä»åº“é€šè¿‡IOçº¿ç¨‹æ‹¿ç€change master toç”¨æˆ·å¯†ç ç›¸å…³ä¿¡æ¯ï¼Œè¿æ¥ä¸»åº“ï¼ŒéªŒè¯åˆæ³•æ€§</span><br><span class="line">4ï¼‰ä»åº“è¿æ¥æˆåŠŸåï¼Œä¼šæ ¹æ®binlogçš„posé—®ä¸»åº“ï¼Œæœ‰æ²¡æœ‰æ¯”è¿™ä¸ªæ›´æ–°çš„</span><br><span class="line">5ï¼‰ä¸»åº“æ¥æ”¶åˆ°ä»åº“è¯·æ±‚åï¼Œæ¯”è¾ƒä¸€ä¸‹binlogä¿¡æ¯ï¼Œå¦‚æœæœ‰å°±å°†æœ€æ–°æ•°æ®é€šè¿‡dumpçº¿ç¨‹ç»™ä»åº“IOçº¿ç¨‹</span><br><span class="line">6ï¼‰ä»åº“é€šè¿‡IOçº¿ç¨‹æ¥æ”¶åˆ°ä¸»åº“å‘æ¥çš„binlogäº‹ä»¶ï¼Œå­˜å‚¨åˆ°TCP/IPç¼“å­˜ä¸­ï¼Œå¹¶è¿”å›ACKæ›´æ–°master.info</span><br><span class="line">7ï¼‰å°†TCP/IPç¼“å­˜ä¸­çš„å†…å®¹å­˜åˆ°relay-logä¸­</span><br><span class="line">8ï¼‰SQLçº¿ç¨‹è¯»å–relay-log.infoï¼Œè¯»å–åˆ°ä¸Šæ¬¡å·²ç»æ‰§è¡Œè¿‡çš„relay-logä½ç½®ç‚¹ï¼Œç»§ç»­æ‰§è¡Œåç»­çš„relay-logæ—¥å¿—ï¼Œæ‰§è¡Œå®Œæˆåï¼Œæ›´æ–°relay-log.info</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_passwd=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000001&#x27;</span>,</span><br><span class="line">master_log_pos=446</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQLä¸»ä»å¤åˆ¶å’Œ3ä¸ªçº¿ç¨‹ï¼Œ4ä¸ªæ–‡ä»¶æœ‰å…³ç³»</span></span><br><span class="line">1ã€#3ä¸ªçº¿ç¨‹ï¼š</span><br><span class="line">      - ä»åº“ä¸Šçš„IOçº¿ç¨‹ï¼š(å’Œä¸»åº“å»ºç«‹è¿æ¥ï¼Œæ¥æ”¶ä¸»åº“çš„æ•°æ®)</span><br><span class="line">      - ä»åº“ä¸Šçš„SQLçº¿ç¨‹ï¼š(å°†IOçº¿ç¨‹å–å‡ºçš„æ•°æ®åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä¸€éï¼Œä»–ä¸¤ä¹‹å‰æ˜¯å¼‚æ­¥çš„)</span><br><span class="line">      </span><br><span class="line">      - ä¸»åº“ä¸Šçš„dumpçº¿ç¨‹ï¼š(æ¥å—IOçº¿ç¨‹çš„è¯·æ±‚ï¼Œä»binlogä¸­å–å‡ºæ•°æ®è¿”å›ç»™IOçº¿ç¨‹)</span><br><span class="line">      </span><br><span class="line">2ã€#4ä¸ªæ–‡ä»¶</span><br><span class="line">      - ä»åº“ï¼šmaster.info(å­˜ä¸Šä¸€æ¬¡ä¸»åº“binlogçš„åå­—å’Œä½ç½®ç‚¹)ï¼šæ‰§è¡Œstart slaveä¼šæŠŠä¸»åº“ä¿¡æ¯è®°å½•åœ¨master.info,æ–¹ä¾¿ä¸‹ä¸€æ¬¡å–æ•°æ®</span><br><span class="line">      - ä»åº“ï¼šrelay-log.infoï¼š(è®°å½•sqlè¯­å¥ä¸Šä¸€å›æ‰§è¡Œåˆ°ä¸­ç»§æ—¥å¿—çš„ä½ç½®ç‚¹ï¼Œä¸‹å›å†æ‰§è¡Œçš„æ—¶å€™å°±ä»è¿™ä¸ªä½ç½®ç‚¹å¾€åæ‰§è¡Œ)</span><br><span class="line">      - ä»åº“ï¼šrelay-logï¼š(å­˜å‚¨binlogä¸­æ–°å¢çš„æ•°æ®ï¼ˆä¸æ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼‰å¤åˆ¶SQLçº¿ç¨‹åœ¨æ‰§è¡Œå®Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰äº‹ä»¶å¹¶ä¸”ä¸å†éœ€è¦å®ƒåï¼Œä¼šè‡ªåŠ¨åˆ é™¤æ¯ä¸ªä¸­ç»§æ—¥å¿—æ–‡ä»¶)</span><br><span class="line">      </span><br><span class="line">      - ä¸»åº“ï¼šbin-log(äºŒè¿›åˆ¶æ—¥å¿—è®°å½•ä¸»åº“æ‰€æœ‰å¯¹æ•°æ®è¡¨å‘ç”Ÿå˜åŒ–çš„è¯­å¥)</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line"><span class="comment">#é—®é¢˜ï¼šrelay-logä¼šä¸€ç›´å­˜åœ¨å—,å¦‚æœä¸æ˜¯ï¼Œä¼šå­˜åœ¨å¤šä¹…ï¼Ÿ</span></span><br><span class="line">å®˜ç½‘ç»™çš„ç­”æ¡ˆï¼š</span><br><span class="line">https://dev.mysql.com/doc/refman/5.7/en/replica-logs-relaylog.html</span><br><span class="line"></span><br><span class="line">The replication SQL thread automatically deletes each relay <span class="built_in">log</span> file after it has executed all events <span class="keyword">in</span> the file and no longer needs it. There is no explicit mechanism <span class="keyword">for</span> deleting relay logs because the replication SQL thread takes care of doing so. However, FLUSH LOGS rotates relay logs, <span class="built_in">which</span> influences when the replication SQL thread deletes them.</span><br><span class="line">(å¤åˆ¶SQLçº¿ç¨‹åœ¨æ‰§è¡Œå®Œæ–‡ä»¶ä¸­çš„æ‰€æœ‰äº‹ä»¶å¹¶ä¸”ä¸å†éœ€è¦å®ƒåï¼Œä¼šè‡ªåŠ¨åˆ é™¤æ¯ä¸ªä¸­ç»§æ—¥å¿—æ–‡ä»¶ã€‚æ²¡æœ‰æ˜ç¡®çš„æœºåˆ¶æ¥åˆ é™¤ä¸­ç»§æ—¥å¿—ï¼Œå› ä¸ºå¤åˆ¶SQLçº¿ç¨‹ä¼šè´Ÿè´£è¿™æ ·åšã€‚ä½†æ˜¯ï¼ŒFLUSH logsä¼šè½®æ¢ä¸­ç»§æ—¥å¿—ï¼Œè¿™ä¼šå½±å“å¤åˆ¶SQLçº¿ç¨‹ä½•æ—¶åˆ é™¤å®ƒä»¬ã€‚)</span><br><span class="line">ä¹Ÿå°±æ˜¯è¯´SQLçº¿ç¨‹æ‰§è¡Œå®Œrelay-logçš„æ‰€æœ‰äº‹ä»¶ä¹‹åï¼Œä¼šå®šæœŸçš„åˆ é™¤relay-logï¼Œä½†æ˜¯ä¸çŸ¥é“å¤šä¹…åˆ é™¤ä¸€æ¬¡ï¼Œå®˜æ–¹æ²¡æœ‰ç»™å‡ºæ˜ç¡®çš„æ—¶é—´</span><br><span class="line"></span><br><span class="line">æ¶‰åŠåˆ°3ä¸ªçº¿ç¨‹ 4ä¸ªæ–‡ä»¶</span><br><span class="line"><span class="comment">#ä»ï¼šmaster inifo  </span></span><br><span class="line">relay.loh  </span><br><span class="line">relayï¼šè®°å½•sqlè¯­å¥ä¸Šä¸€å›æ‰§è¡Œåˆ°ä¸­ç»§æ—¥å¿—çš„é‚£ä¸ªä½ç½®ç‚¹äº†</span><br></pre></td></tr></table></figure>
<p><strong>éƒ¨ç½²ä¼ ç»Ÿä¸»ä»å¤åˆ¶</strong></p>
<p>ç¯å¢ƒå‡†å¤‡</p>
<table>
<thead>
<tr>
<th>ä¸»æœºå</th>
<th>ip</th>
<th>è§’è‰²</th>
<th>åº”ç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>db01</td>
<td>10.0.0.51  /  172.16.1.51</td>
<td><strong>ä¸»åº“</strong></td>
<td>mysql 5.6</td>
</tr>
<tr>
<td>db02</td>
<td>10.0.0.52  /  172.16.1.52</td>
<td>ä»åº“</td>
<td>mysql 5.6</td>
</tr>
<tr>
<td>db03</td>
<td>10.0.0.53  /  172.16.1.53</td>
<td>ä»åº“</td>
<td>mysql 5.6</td>
</tr>
<tr>
<td>db04</td>
<td>10.0.0.54 /  172.16.1.54</td>
<td>ä»åº“</td>
<td>mysql 5.6</td>
</tr>
</tbody>
</table>
<p>1ã€ä¸»åº“æ“ä½œdb01</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¸»åº“æ“ä½œ</span><br><span class="line"><span class="comment">#ä¿®æ”¹é…ç½®æ–‡ä»¶</span></span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">log_bin=mysql-bin</span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">skip-name-resolve</span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db04 ~]#  /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#åˆ›å»ºä¸€ä¸ªä¸»ä»å¤åˆ¶çš„ç”¨æˆ·</span><br><span class="line">grant replication slave on *.* to rep@<span class="string">&#x27;172.16.1.5%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line">4ã€#æŸ¥çœ‹binlog(master)çš„ä¿¡æ¯</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+</span><br><span class="line">| File             | Position |</span><br><span class="line">+------------------+----------+</span><br><span class="line">| mysql-bin.000016 |      327 |</span><br><span class="line">+------------------+----------+</span><br></pre></td></tr></table></figure>
<p>2ã€ä»åº“æ“ä½œ   å…ˆé…ç½®db02  db03</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">[root@db03 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/app/mysql-5.6.50</span><br><span class="line">datadir=/app/mysql-5.6.50/data</span><br><span class="line">ä»åº“binlogä¸éœ€è¦å¼€å¯</span><br><span class="line"><span class="comment">#log_bin=mysql-bin</span></span><br><span class="line"><span class="comment">#server_idä¸ä¸€æ ·</span></span><br><span class="line">server_id=1</span><br><span class="line">lower_case_table=1</span><br><span class="line"><span class="comment">#innodb_data_file_path=ibdata1:12M;ibdata2:50M:autoextend</span></span><br><span class="line">binlog_format=row</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">skip-name-resolve</span><br><span class="line">[client]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">prompt=<span class="string">&quot;\\u@\\h:\\d &gt; &quot;</span></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db03 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#æ‰§è¡Œmasterè¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=327,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">4ã€#å¼€å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line">5ã€#æŸ¥çœ‹ä¸»ä»å¤åˆ¶çŠ¶æ€</span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000016</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">            </span><br><span class="line">           <span class="comment">#2ä¸ªyeså°±OK</span></span><br></pre></td></tr></table></figure>
<p><strong>ä¸»ä»å¤åˆ¶æ•…éšœå¤„ç†</strong></p>
<p>IOçº¿ç¨‹æ•…éšœ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¤§æ¦‚ç‡æ˜¯è¿æ¥å‡ºé—®é¢˜</span></span><br><span class="line">change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=327,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">1ã€#æ£€æŸ¥IPæ˜¯å¦æ­£å¸¸(å’Œchange masterçš„IPä¸€æ ·ï¼Œä¸è¦å†™å¤–ç½‘IP)</span><br><span class="line">ping 172.16.1.51</span><br><span class="line"></span><br><span class="line">2ã€#æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£å¸¸(å’Œchange masterçš„IPä¸€æ ·ï¼Œä¸è¦å†™å¤–ç½‘IP)</span><br><span class="line">telent 172.16.1.51 3306</span><br><span class="line">ç«¯å£ä¸é€šï¼š</span><br><span class="line">      - é˜²ç«å¢™ selinux</span><br><span class="line">      - æœåŠ¡æ²¡æœ‰èµ·</span><br><span class="line">      - æ²¡æœ‰åˆ›å»ºè¿œç¨‹è¿æ¥çš„ç”¨æˆ·</span><br><span class="line">      </span><br><span class="line">3ã€#æ£€æµ‹ç”¨æˆ·åå’Œå¯†ç   ä»åº“ç”¨repç”¨æˆ·è¿æ¥åˆ°ä¸»åº“</span><br><span class="line">[root@db03 ~]# mysql -urep -p123 -h172.16.1.51</span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æ£€æŸ¥binglogåå­—å’Œä½ç½®ç‚¹æ˜¯å¦æ­£ç¡®(ä½ç½®ç‚¹å¯ä»¥å°‘ï¼Œä¸èƒ½å¤šï¼Œå¤šäº†æ‰¾ä¸åˆ°é‚£ä¸ªç‚¹)</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+-</span><br><span class="line">| File             | Position | </span><br><span class="line">+------------------+----------+-</span><br><span class="line">| mysql-bin.000016 |    32858 | </span><br><span class="line">+------------------+----------+-</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240823175441790.png" alt="image-20240823175441790"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠ¥é”™åŸå› ï¼š</span></span><br><span class="line">ä¸»åº“å’Œä»åº“çš„server_idç›¸åŒ</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240823175520693.png" alt="image-20240823175520693"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠ¥é”™åŸå› ï¼š</span></span><br><span class="line">ä¸»åº“å’Œä»åº“çš„UUIDç›¸åŒ</span><br></pre></td></tr></table></figure>
<p>SQLçº¿ç¨‹æ•…éšœ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ ¹æœ¬åŸå› ï¼šä¸»åº“å’Œä»åº“æ•°æ®ä¸ä¸€è‡´</span></span><br><span class="line"></span><br><span class="line">1ã€ä¸»åº“çš„æ•°æ®æ¯”ä»åº“å¤š(ä¸»åº“é‡Œé¢æœ‰ä¸€ä¸ªjiaoyiè¡¨ï¼Œä»åº“æ²¡æœ‰ï¼Œæˆ‘åœ¨ä¸»åº“é‡Œé¢çš„jiaoyiè¡¨æ’å…¥æ•°æ®ï¼Œä»åº“SQLçº¿ç¨‹å°±ä¼šæŠ¥é”™)</span><br><span class="line"></span><br><span class="line">2ã€ä»åº“çš„æ•°æ®æ¯”ä¸»åº“å¤š(ä»åº“å·²ç»å­˜åœ¨ä¸€ä¸ªtabl1è¡¨ï¼Œå½“ä¸»åº“åˆ›å»ºtable1è¡¨æ—¶ï¼Œä»åº“QLçº¿ç¨‹å°±ä¼šæŠ¥é”™)</span><br></pre></td></tr></table></figure>
<p>1ã€ä¸»åº“çš„æ•°æ®æ¯”ä»åº“å¤š  æŠ¥é”™</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240823160331343.png" alt="image-20240823160331343"></p>
<p>2ã€ä»åº“çš„æ•°æ®æ¯”ä¸»åº“å¤š  æŠ¥é”™</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240823180522184.png" alt="image-20240823180522184"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§£å†³æ–¹æ³•ï¼š</span></span><br><span class="line"></span><br><span class="line">æ–¹æ³•1ï¼š:ä¸æ¨è  ä¸´æ—¶çš„è§£å†³æ–¹æ³•  </span><br><span class="line">(è·³è¿‡è¿™ä¸ªæŠ¥é”™çš„æŒ‡é’ˆ)</span><br><span class="line"><span class="comment"># ä¸´æ—¶åœæ­¢åŒæ­¥</span></span><br><span class="line">mysql&gt; stop slave;</span><br><span class="line"><span class="comment"># å°†åŒæ­¥æŒ‡é’ˆå‘ä¸‹ç§»åŠ¨ä¸€ä¸ªï¼ˆå¯é‡å¤æ“ä½œï¼‰</span></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global sql_slave_skip_counter=1;</span><br><span class="line"><span class="comment"># å¼€å¯åŒæ­¥</span></span><br><span class="line">mysql&gt; start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ–¹æ³•2ï¼šä¸æ¨è  ä¸´æ—¶çš„è§£å†³æ–¹æ³•</span><br><span class="line">(åœ¨mysqlæ ‡ç­¾ä¸»æ·»åŠ è·³è¿‡é”™è¯¯ä»£ç çš„é…ç½®)</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line"><span class="comment">#åœ¨[mysqld]æ ‡ç­¾ä¸‹æ·»åŠ ä»¥ä¸‹å‚æ•°</span></span><br><span class="line">slave-skip-errors=1032,1062,1007,1146</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½†æ˜¯ä»¥ä¸Šæ“ä½œéƒ½æ˜¯æœ‰é£é™©å­˜åœ¨çš„,å¯¼è‡´ä»åº“æ•°æ®ç¼ºå¤±ï¼Œè¿™ä¸ªæ•°æ®ä»åº“é‡Œé¢æ°¸è¿œæ²¡æœ‰ï¼ŒæŸ¥ä¸åˆ°æ•°æ®ï¼Œä»–è·³è¿‡è¿™ä¸ªé”™è¯¯ï¼Œé…ç½®æ–‡ä»¶é‡Œé¢å†™äº†ï¼Œæ•°æ®ä¸å¤åˆ¶,è¿™ä¸ªåªæ˜¯è¡¨é¢ä¸Šçœ‹åˆ°yes,å®é™…ä¸Šæ²¡æœ‰æ„ä¹‰ï¼Œè·³è¿‡ç›¸å½“äºä»åº“å°‘æ•°æ®</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°æ®ä¸ä¸€è‡´çš„åŸå› å¯èƒ½å¦‚ä¸‹ï¼š</span></span><br><span class="line">1ã€åœ¨ç”Ÿäº§ä¸­è¿è¡Œå·²æœ‰çš„æ•°æ®åº“çš„ä¸»åº“ï¼Œæ–°ä»åº“ç›´æ¥ä»å½“å‰ä½ç½®ç‚¹å¤åˆ¶</span><br><span class="line">è§£å†³æ–¹æ³•ï¼šç»™ä¸»åº“å…¨å¤‡ï¼Œå¯¼å…¥åˆ°æ–°ä»åº“ä¸­ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</span><br><span class="line"></span><br><span class="line">2ã€ç›´æ¥åœ¨ä»åº“ä¸­æ“ä½œæ•°æ®åº“</span><br><span class="line">è§£å†³æ–¹æ³•ï¼šä»åº“è®¾ç½®ä¸å…è®¸å†™å…¥ ï¼Œä»åº“è®¾ç½®ä¸ºåªè¯»(è¯»å†™åˆ†ç¦»)</span><br><span class="line"><span class="comment"># åœ¨å‘½ä»¤è¡Œä¸´æ—¶è®¾ç½®</span></span><br><span class="line"><span class="built_in">set</span> global read_only=1;</span><br><span class="line"><span class="comment"># åœ¨é…ç½®æ–‡ä»¶ä¸­æ°¸ä¹…ç”Ÿæ•ˆ</span></span><br><span class="line">read_only=1</span><br><span class="line">å‘½ä»¤è¡Œ+é…ç½®æ–‡ä»¶ ä¸éœ€è¦é‡å¯å°±æ˜¯æ°¸ä¹…å¤±æ•ˆ</span><br><span class="line"><span class="comment">#ä½†æ˜¯ç”¨rootç”¨æˆ·ï¼Œå¯¹rootä¸ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure>
<p>3ã€</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240826150832618.png" alt="image-20240826150832618"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è§£å†³åŠæ³•</span></span><br><span class="line">1ã€ä¸»åº“åœæ­¢ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">2ã€åœ¨ä¸»åº“ä¸ŠæŸ¥çœ‹å½“å‰ä½ç½®ç‚¹</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000016 |  5235939 |              |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line">3ã€ä»åº“æ‰“ç‚¹å…¨å¤‡ï¼Œåˆ°ä»åº“ï¼Œ</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=1 --single-transaction|gzip &gt; /tmp/full.sql.gz</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp</span><br><span class="line"></span><br><span class="line">4ã€ä»åº“å†ä»å½“å‰ä½ç½®ç‚¹å¼€å§‹å¤åˆ¶</span><br><span class="line">[root@db02 ~]# zcat /tmp/full.sql.gz |mysql -uroot -p123</span><br><span class="line">[root@db02 ~]# mysql -uroot -p123</span><br><span class="line"></span><br><span class="line">5ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=5235939,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6ã€#ä»åº“å¼€å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line">æŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>
<p><strong>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¦‚ä½•æ·»åŠ ä¸€å°ä»åº“</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ–°ä»åº“ç¯å¢ƒåˆå§‹åŒ–  (db04)</span></span><br><span class="line">ç›®å‰db01ä¸»åº“å·²ç»æœ‰ä¸€äº›æ•°æ®äº†ï¼Œå‡è®¾db01æ˜¯ç”Ÿäº§ç¯å¢ƒçš„ä¸»åº“ï¼Œè¿˜æœ‰æ•°æ®åœ¨ç½‘é‡Œé¢å†™å…¥</span><br><span class="line">è¿è¡Œè„šæœ¬</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start; mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">1ã€#ä¸»åº“æ‰“ç‚¹å…¨å¤‡(çƒ­å¤‡ ä¸é”è¡¨)</span><br><span class="line">[root@db01 ~]#  mysqldump -uroot -p123 -A -R --triggers --master-data=1 --single-transaction|gzip &gt; /tmp/full.sql.gz</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯zcatçš„æ–‡ä»¶é‡Œé¢æœ‰loca table ä¸ºä»€ä¹ˆé”è¡¨å‘¢ï¼Ÿ</span><br><span class="line">å®ƒæ˜¯ç”¨è¿™ä¸ªæ–‡ä»¶å¾€é‡Œæ¢å¤æ•°æ®çš„æ—¶å€™é”è¡¨ï¼Œæ–‡ä»¶æ˜¾ç¤ºçš„æ˜¯æ¢å¤è¿‡ç¨‹ï¼Œå¤‡ä»½çš„æ—¶å€™ä¸é”è¡¨çš„ï¼Œä¸æ˜¯å¤‡ä»½çš„è¿‡ç¨‹ï¼Œæ˜¯åœ¨æ¢å¤çš„æ—¶å€™é”ä½</span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“æ¢å¤ä¸»åº“å…¨å¤‡æ•°æ®</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.54:/tmp</span><br><span class="line"></span><br><span class="line">[root@db04 ~]# zcat /tmp/full.sql.gz |mysql -uroot -p123</span><br><span class="line"></span><br><span class="line">3ã€#ä»æŸ¥çœ‹æ•°æ®å°‘äº†ï¼ŒæŸ¥çœ‹ç‚¹ä½ï¼Œç›´æ¥ä»æ‰“ç‚¹çš„ä½ç½®å¼€å§‹å¤åˆ¶</span><br><span class="line">[root@db01 ~]# zcat /tmp/full.sql.gz |<span class="built_in">head</span> -25</span><br><span class="line">CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000016&#x27;</span>, MASTER_LOG_POS=984578;</span><br><span class="line"></span><br><span class="line">5ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=984578,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">6ã€#ä»åº“å¼€å¯ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line">æŸ¥çœ‹æ•°æ®æ˜¯å¦åŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>
<h3 id="2ã€å»¶æ—¶å¤åˆ¶">2ã€å»¶æ—¶å¤åˆ¶</h3>
<p><strong>ä¼ ç»Ÿä¸»ä»å¤åˆ¶çš„ç¼ºé™·</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ— æ³•å¤‡ä»½</span><br><span class="line">2ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ— æ³•è¿‡æ»¤å¤åˆ¶</span><br><span class="line">3ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶é€Ÿåº¦ç›¸å¯¹æ¥è¯´æ¯”è¾ƒæ…¢</span><br><span class="line">4ã€ä¼ ç»Ÿä¸»ä»å¤åˆ¶æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œä»åº“æ•°æ®å»¶è¿Ÿ(æ¯å°ä»åº“æ•°æ®ä¸æ˜¯ç™¾åˆ†ç™¾ä¸€è‡´ï¼Œæ¯å°ä»åº“çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä½†è¿™ä¸ªæ˜¯ä¸å¯é¿å…çš„ï¼Œåœ¨ç”Ÿäº§ä¸­ä¸€å®šæœ‰å»¶è¿Ÿ)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant replication slave on prod.* to slave@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">ERROR 1221 (HY000): Incorrect usage of DB GRANT and GLOBAL PRIVILEGES</span><br><span class="line"><span class="comment">#replication è¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„æƒé™</span></span><br></pre></td></tr></table></figure>
<p><strong>å»¶æ—¶ä»åº“</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¼ä¸šä¸€èˆ¬ä¼šå»¶æ—¶3~6å°æ—¶</span></span><br><span class="line">1ã€åšå»¶æ—¶ä»åº“çš„æœåŠ¡å™¨æ— æ³•åœ¨ç”Ÿäº§ä¸­æä¾›æœåŠ¡(è¿™ä¸ªæœºå™¨å°±æ˜¯ä¸€ä¸ªå¤‡æœº)</span><br><span class="line">2ã€å¤‡ä»½</span><br><span class="line">3ã€æ¢å¤æ•°æ®é€Ÿåº¦æ›´å¿«</span><br><span class="line">4ã€å»¶æ—¶ä»åº“ä¸å½±å“é«˜å¯ç”¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å»¶æ—¶ä»åº“çš„åŸç†ï¼šåœ¨SQLçº¿ç¨‹åšæ‰‹è„šï¼ŒIOçº¿ç¨‹ç»§ç»­æ‹¿æ•°æ®ï¼ŒSQLçº¿ç¨‹åœ¨æŒ‡å®šæ—¶é—´åï¼Œå»¶æ—¶æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">(æ€ä¹ˆåšï¼Œæ‰èƒ½è®©ä»–å»¶è¿Ÿ3~6å°æ—¶ï¼Ÿ)</span><br><span class="line"><span class="comment">#ä¼šè®¾ç½®SQLçº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´åå†æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>
<p>å»¶æ—¶ä»åº“çš„åŸç†</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240826144421626.png" alt="image-20240826144421626"></p>
<p><strong>é…ç½®å»¶æ—¶ä»åº“</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å‘½ä»¤ï¼šé‡ç½®ä¸»ä»å¤åˆ¶ :ä»–ä¼šæŠŠæ‰€æœ‰ç›¸å…³æ–‡ä»¶é‡ç½®</span></span><br><span class="line">éœ€è¦ä¿®æ”¹æŸäº›å‚æ•°çš„æ—¶å€™æ‰ç”¨(æ¯”å¦‚è¯´ä½ç½®ç‚¹å†™é”™äº†ï¼Œå¯†ç å†™é”™äº†)</span><br><span class="line">mysql&gt; change master to</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,master_user=<span class="string">&#x27;rep&#x27;</span>,master_password=<span class="string">&#x27;123&#x27;</span>,master_log_file=<span class="string">&#x27;mysql-bin.000003&#x27;</span>,master_log_pos=154;</span><br><span class="line"></span><br><span class="line">reset slave;     ä¼šä¿ç•™ä¹‹å‰chang masetrçš„ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">reset slave all;  (å®Œå…¨é‡ç½®ä¸»ä»ï¼Œä¿ç•™ä»»ä½•ä¿¡æ¯ï¼Œå–æ¶ˆä»åº“èº«ä»½çš„æ—¶å€™)</span><br><span class="line"></span><br><span class="line"><span class="comment">#åœæ­¢ä¸»ä»å¤åˆ¶</span></span><br><span class="line">stop slave;  </span><br><span class="line"></span><br><span class="line"><span class="comment">#å°±æ˜¯åœ¨SQL-DelayåŠ å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">#å°†db04å˜æˆå»¶æ—¶ä»åº“</span></span><br><span class="line"></span><br><span class="line">1ã€#åœæ­¢ä¸»ä»å¤åˆ¶</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">2ã€#é‡ç½®ä¸»ä»ä¿¡æ¯</span><br><span class="line">root@localhost:(none) &gt; reset salve;</span><br><span class="line"></span><br><span class="line">3ã€#é…ç½®SQLçº¿ç¨‹å»¶è¿Ÿå¤åˆ¶æ—¶é—´   180 3min</span><br><span class="line">root@localhost:(none) &gt; chang master to master_delay=180;</span><br><span class="line"></span><br><span class="line">4ã€#å¼€å¯ä¸»ä»å¤åˆ¶ï¼Œå¹¶æŸ¥çœ‹çŠ¶æ€</span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: </span><br><span class="line">               Master_Host: 172.16.1.51</span><br><span class="line">               ......</span><br><span class="line">               SQL_Delay: 180</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®å»¶æ—¶ä»åº“ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå½“è®©æ•°æ®ä¸€è‡´çš„è§£å†³åŠæ³•</span></span><br><span class="line">1ã€#ä»åº“æ“ä½œ</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line">root@localhost:(none) &gt; reset slave;</span><br><span class="line">root@localhost:(none) &gt; change master to master_delay=0;</span><br><span class="line"></span><br><span class="line">2ã€ä¸»åº“æ“ä½œ</span><br><span class="line">[root@db01 ~]#  mysqldump -A -uroot -p123 &gt; /tmp/full.sql</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp</span><br><span class="line"></span><br><span class="line">3ã€ä»åº“æ¢å¤æ•°æ®</span><br><span class="line">root@localhost:world &gt; <span class="built_in">source</span> /tmp/full.sql;</span><br><span class="line"></span><br><span class="line">4ã€ä¸»åº“æŸ¥çœ‹ä½ç½®ç‚¹</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000016 |  5366820 |              |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line">5ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000016&#x27;</span>,</span><br><span class="line">master_log_pos=5366820,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; start slave;</span><br><span class="line">root@localhost:world &gt; show slave status\G</span><br></pre></td></tr></table></figure>
<p><strong>å»¶æ—¶ä»åº“æ¢å¤æ¡ˆä¾‹</strong></p>
<p>æ€»æ•°æ®é‡çº§500Gï¼Œæ­£å¸¸å¤‡ä»½å»æ¢å¤éœ€è¦1.5-2å°æ—¶<br>
1ï¼‰é…ç½®å»¶æ—¶3600ç§’<br>
mysql&gt;CHANGE MASTER TO MASTER_DELAY = 3600;</p>
<p>2ï¼‰ä¸»åº“<br>
drop database db;</p>
<p>3ï¼‰æ€ä¹ˆåˆ©ç”¨å»¶æ—¶ä»åº“ï¼Œæ¢å¤æ•°æ®ï¼Ÿ</p>
<p>1ã€æ¨¡æ‹Ÿæ•°æ®å‡†å¤‡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">1ã€#ä¸»åº“db01æ‰§è¡Œå†™å…¥æ•°æ®çš„è„šæœ¬</span><br><span class="line">[root@db01 ~]# sh insert.sh </span><br><span class="line"></span><br><span class="line">2ã€å…ˆä¿è¯å…¶ä»–ä»åº“çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œä¸»ä»åŒæ­¥æ²¡é—®é¢˜</span><br><span class="line"></span><br><span class="line">3ã€ä¸»åº“åˆ›å»ºä¸€ä¸ªåº“ï¼Œå†™å…¥æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; create database asm;</span><br><span class="line">root@localhost:(none) &gt; flush logs;</span><br><span class="line">root@localhost:(none) &gt; use asm</span><br><span class="line">root@localhost:(none) &gt; create table asm(<span class="built_in">id</span> int);</span><br><span class="line">root@localhost:(none) &gt; insert into asm values(1),(2),(3);</span><br><span class="line">root@localhost:(none) &gt; update asm <span class="built_in">set</span> <span class="built_in">id</span>=10 <span class="built_in">where</span> <span class="built_in">id</span>=1;</span><br><span class="line"></span><br><span class="line">4ã€ä¸»åº“æ‰“ç‚¹å…¨å¤‡</span><br><span class="line">[root@db01 ~]# mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction  &gt; /tmp/full.sql.gz</span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp</span><br><span class="line"></span><br><span class="line">5ã€ä»åº“ä»åº“ä½ç½®ç‚¹</span><br><span class="line">[root@db02 ~]# <span class="built_in">head</span> -25 /tmp/full.sql.gz </span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000017&#x27;</span>, MASTER_LOG_POS=99930;</span><br><span class="line">[root@db02 ~]#  mysql -uroot -p123 &lt; /tmp/full.sql.gz </span><br><span class="line"></span><br><span class="line">6ã€è®©ä»åº“db02å˜æˆä¸€ä¸ªå»¶æ—¶ä»åº“</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from asm.asm;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">+------+</span><br><span class="line">root@localhost:world &gt; stop slave;</span><br><span class="line">root@localhost:world &gt; reset slave all;</span><br><span class="line"></span><br><span class="line">7ã€ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000017&#x27;</span>,</span><br><span class="line">master_log_pos=99930,</span><br><span class="line">master_port=3306,</span><br><span class="line">master_delay=180;</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; start slave;</span><br><span class="line">root@localhost:world &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Slave_IO_Running: Yes</span><br><span class="line">          Slave_SQL_Running: Yes</span><br><span class="line">          .........</span><br><span class="line">          SQL_Delay: 180</span><br><span class="line">          SQL_Remaining_Delay: 0</span><br><span class="line">          </span><br><span class="line"></span><br><span class="line">8ã€ä¸»åº“é‡Œé¢å†å†™ç‚¹æ•°æ®ï¼Œä»åº“é‡Œé¢æŸ¥çœ‹ç°åœ¨æ•°æ®è¿˜æ²¡æœ‰å†™è¿‡æ¥ï¼ŒæŠŠä¸»åº“çš„åº“åˆ é™¤</span><br><span class="line">root@localhost:asm &gt; insert into asm values(4),(5),(6);</span><br><span class="line">root@localhost:asm &gt; <span class="keyword">select</span> * from asm.asm;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">|    5 |</span><br><span class="line">|    6 |</span><br><span class="line">+------+      </span><br><span class="line">root@localhost:(none) &gt; drop database asm;</span><br></pre></td></tr></table></figure>
<p>2ã€æ¢å¤æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">(ä¼ä¸šä¸­çš„ç›˜)SAS  Flash(æœ€æ¥è¿‘å†…å­˜æ€§èƒ½çš„ç›˜) </span><br><span class="line">SATA(ç”µè„‘çš„ç›˜)</span><br><span class="line">mysq1&gt; change master to master_delay=0;  å–æ¶ˆå»¶æ—¶å¤åˆ¶</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¢å¤æ€è·¯    ç”¨db02åšå»¶æ—¶ä»åº“</span></span><br><span class="line">1ã€#åœæ­¢db02å»¶æ—¶ä»åº“çš„SQLçº¿ç¨‹</span><br><span class="line">root@localhost:(none) &gt; stop slave SQL_thread;</span><br><span class="line"></span><br><span class="line">2ã€#å‡†å¤‡æ–°ç¯å¢ƒ</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db02 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db02 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld start; mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">3ã€#å»¶æ—¶ä»åº“åšå…¨å¤‡  (ä»åº“æ²¡æœ‰å¼€binlog  ä¸ç”¨æ‰“ç‚¹å…¨å¤‡)</span><br><span class="line">[root@db02 ~]# mysqldump -uroot -p123 -A -R --triggers &gt; /tmp/full_new.sql</span><br><span class="line"></span><br><span class="line">4ã€#æˆªå–åˆ åº“ä¹‹å‰relay-log.infoæ•°æ®  (æŸ¥çœ‹ä»åº“æ‰§è¡Œåˆ°å“ªä¸ªä½ç½®ç‚¹)</span><br><span class="line">[root@db02 ~]# <span class="built_in">cat</span> /app/mysql-5.6.50/data/relay-log.info </span><br><span class="line">7</span><br><span class="line">./db02-relay-bin.000002  <span class="comment">#ç»“æŸä½ç½®ç‚¹çš„æ–‡ä»¶</span></span><br><span class="line">171031  <span class="comment">#å¼€å§‹ä½ç½®ç‚¹</span></span><br><span class="line">mysql-bin.000017</span><br><span class="line">270678</span><br><span class="line">180</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š171031  </span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/db02-relay-bin.000002 | grep -iC 10 drop</span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š194850</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --start-position=171031 --stop-position=194850  /app/mysql-5.6.50/data/db02-relay-bin.000002 &gt; /tmp/inc1.sql</span><br><span class="line"></span><br><span class="line">5ã€æˆªå–åˆ åº“ä¹‹åçš„æ•°æ® éœ€è¦åœæ­¢æ•°æ®å†™å…¥</span><br><span class="line">[root@db01 ~]# sh insert.sh ^C</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     3442 |</span><br><span class="line">+----------+  <span class="comment">#è®°å½•åœåº“å‰æ•°æ®æœ€åå†™å…¥çš„çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">6ã€æˆªå–åˆ åº“ä¹‹å‰çš„ä½ç½®ç‚¹~åœåº“çš„ä½ç½®ç‚¹æ•°æ®</span><br><span class="line">[root@db02 ~]# mysqlbinlog --base64-output=decode-rows -vvv /app/mysql-5.6.50/data/db02-relay-bin.000002 | grep -iC 10 drop</span><br><span class="line">å¼€å§‹ä½ç½®ç‚¹ï¼š194939 </span><br><span class="line"></span><br><span class="line">[root@db02 ~]# ll /app/mysql-5.6.50/data/</span><br><span class="line">-rw-rw---- 1 mysql mysql   489751 Aug 26 17:21 db02-relay-bin.000002</span><br><span class="line">ç»“æŸä½ç½®ç‚¹ï¼š489751</span><br><span class="line"></span><br><span class="line">[root@db02 ~]# mysqlbinlog --start-position=194939 --stop-position=489751  /app/mysql-5.6.50/data/db02-relay-bin.000002 &gt; /tmp/inc2.sql</span><br><span class="line"></span><br><span class="line">7ã€å‡†å¤‡æ–°ç¯å¢ƒ<span class="string">&#x27;db03&#x27;</span></span><br><span class="line">[root@db03 ~]# /etc/init.d/mysqld stop</span><br><span class="line">[root@db03 ~]# <span class="built_in">rm</span> -rf /app/mysql-5.6.50/data</span><br><span class="line">é…ç½®æ–‡ä»¶å’Œæ—§ç¯å¢ƒå¤§éƒ¨åˆ†ä¿æŒä¸€è‡´</span><br><span class="line">[root@db03 ~]# vim /etc/my.cnf</span><br><span class="line">[root@db03 ~]# /app/mysql-5.6.50/scripts/mysql_install_db --user=mysql --basedir=/app/mysql-5.6.50 --datadir=/app/mysql-5.6.50/data</span><br><span class="line">[root@db03 ~]# /etc/init.d/mysqld start; mysqladmin -uroot -p password <span class="string">&#x27;123&#x27;</span></span><br><span class="line"></span><br><span class="line">7ã€å°†å»¶æ—¶ä»åº“çš„å…¨å¤‡å¯¼å…¥æ–°ç¯å¢ƒ</span><br><span class="line">[root@db02 ~]# scp /tmp/full_new.sql  172.16.1.53:/tmp</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123 &lt; /tmp/full_new.sql </span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ–°ç¯å¢ƒçš„æ•°æ®çŠ¶æ€</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     1731 |</span><br><span class="line">+----------+  <span class="comment">#å¯ä»¥çœ‹åˆ°æ•°æ®è¿˜ä¸å…¨</span></span><br><span class="line"></span><br><span class="line">8ã€æ¢å¤å»¶è¿ŸæŸ¥çœ‹æˆªå–çš„ç¬¬ä¸€æ®µï¼Œç¬¬äºŒæ®µæ–°å¢æ•°æ®åˆ°æ–°ç¯å¢ƒ</span><br><span class="line">[root@db02 ~]# scp /tmp/inc1.sql   172.16.1.53:/tmp</span><br><span class="line">[root@db02 ~]# scp /tmp/inc2.sql   172.16.1.53:/tmp</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123 &lt; /tmp/inc1.sql</span><br><span class="line">[root@db03 ~]#  mysql -uroot -p123 &lt; /tmp/inc2.sql</span><br><span class="line"></span><br><span class="line">9ã€æ–°ç¯å¢ƒdb03æŸ¥çœ‹æ•°æ®æ˜¯å¦æ¢å¤</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> count(*) from prod.prod;</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|     3442 |</span><br><span class="line">+----------+</span><br><span class="line">root@localhost:(none) &gt; <span class="keyword">select</span> * from asm.asm;</span><br><span class="line">+------+</span><br><span class="line">| <span class="built_in">id</span>   |</span><br><span class="line">+------+</span><br><span class="line">|   10 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">|    5 |</span><br><span class="line">|    6 |</span><br><span class="line">+------+</span><br><span class="line"></span><br><span class="line">10ã€åº”ç”¨å‰²æ¥</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å–æ¶ˆå»¶æ—¶ä»åº“çš„æ­¥éª¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å°†db02å»¶æ—¶ä»åº“å–æ¶ˆé…ç½®</span></span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; change master to master_delay=0;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; start slave;</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line"><span class="comment">#æŸ¥çœ‹çº¿ç¨‹å¯èƒ½æœ‰æŠ¥é”™</span></span><br><span class="line">ä¸»åº“æ‰“ç‚¹å…¨å¤‡</span><br><span class="line">[root@db01 ~]#  mysqldump -uroot -p123 -A -R --triggers --master-data=2 --single-transaction  &gt; /tmp/full.sql.gz</span><br><span class="line"></span><br><span class="line">[root@db01 ~]# scp /tmp/full.sql.gz 172.16.1.52:/tmp </span><br><span class="line">[root@db01 ~]# <span class="built_in">head</span> -25 /tmp/full.sql.gz</span><br><span class="line">-- CHANGE MASTER TO MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000017&#x27;</span>, MASTER_LOG_POS=589398;</span><br><span class="line"></span><br><span class="line">ã€ä»åº“æ¢å¤æ•°æ®</span><br><span class="line">root@localhost:world &gt; <span class="built_in">source</span> /tmp/full.sql;</span><br><span class="line"></span><br><span class="line">ã€ä¸»åº“æŸ¥çœ‹ä½ç½®ç‚¹</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000017 |  589398  |              |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ã€#ä»åº“æ‰§è¡Œchange mater è¯­å¥</span><br><span class="line">root@localhost:(none) &gt; stop slave;</span><br><span class="line"></span><br><span class="line">change master to</span><br><span class="line">master_user=<span class="string">&#x27;rep&#x27;</span>,</span><br><span class="line">master_host=<span class="string">&#x27;172.16.1.51&#x27;</span>,</span><br><span class="line">master_password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">master_log_file=<span class="string">&#x27;mysql-bin.000017&#x27;</span>,</span><br><span class="line">master_log_pos=589398,</span><br><span class="line">master_port=3306;</span><br><span class="line"></span><br><span class="line">root@localhost:world &gt; start slave;</span><br><span class="line">root@localhost:world &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting <span class="keyword">for</span> master to send event</span><br><span class="line">                  Master_Host: 172.16.1.51</span><br><span class="line">                  Master_User: rep</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000017</span><br><span class="line">          Read_Master_Log_Pos: 589398</span><br><span class="line">               Relay_Log_File: db02-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 283</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000017</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br></pre></td></tr></table></figure>
<h3 id="3ã€åŠåŒæ­¥å¤åˆ¶">3ã€<strong>åŠåŒæ­¥å¤åˆ¶</strong></h3>
<p>åŠåŒæ­¥å¤åˆ¶å‡ºç°çš„åŸå› ï¼šä¸ºäº†ä¿è¯ä¸»åº“å’Œä»åº“çš„æ•°æ®ä¸€è‡´æ€§</p>
<p>ä»åº“çš„IOçº¿ç¨‹åœ¨æ²¡æœ‰æ¥æ”¶åˆ°ACKä¹‹å‰ï¼Œä¼šé˜»å¡ä¸»åº“å†™å…¥æ“ä½œ<br>
åŠåŒæ­¥ç¼ºç‚¹ï¼šé˜»å¡ä¸»åº“å†™å…¥æ•°æ®ï¼Œå½±å“ä¸»åº“æ€§èƒ½ï¼Œé™ä½ç”¨æˆ·ä½“éªŒ<br>
åŠåŒæ­¥ä¼˜ç‚¹ï¼šä¸»åº“å’Œä»åº“æ•°æ®ä¿è¯äº†ä¸€è‡´æ€§ï¼Œä¸ä¼šä¸¢æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ä»MYSQL5.5å¼€å§‹ï¼Œæ”¯æŒåŠè‡ªåŠ¨å¤åˆ¶ã€‚ä¹‹å‰ç‰ˆæœ¬çš„MySQL Replicationéƒ½æ˜¯å¼‚æ­¥ï¼ˆasynchronousï¼‰çš„ï¼Œä¸»åº“åœ¨æ‰§è¡Œå®Œä¸€äº›äº‹åŠ¡åï¼Œæ˜¯ä¸ä¼šç®¡å¤‡åº“çš„è¿›åº¦çš„ã€‚å¦‚æœå¤‡åº“ä¸å¹¸è½åï¼Œè€Œæ›´ä¸å¹¸çš„æ˜¯ä¸»åº“æ­¤æ—¶åˆå‡ºç°Crashï¼ˆä¾‹å¦‚å®•æœºï¼‰ï¼Œè¿™æ—¶å¤‡åº“ä¸­çš„æ•°æ®å°±æ˜¯ä¸å®Œæ•´çš„ã€‚ç®€è€Œè¨€ä¹‹ï¼Œåœ¨ä¸»åº“å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨å¤‡åº“æ¥ç»§ç»­æä¾›æ•°æ®ä¸€è‡´çš„æœåŠ¡äº†ã€‚</span><br><span class="line"></span><br><span class="line">åŠåŒæ­¥å¤åˆ¶ï¼ˆSemi synchronous Replicationï¼‰åˆ™ä¸€å®šç¨‹åº¦ä¸Šä¿è¯æäº¤çš„äº‹åŠ¡å·²ç»ä¼ ç»™äº†è‡³å°‘ä¸€ä¸ªå¤‡åº“ã€‚</span><br><span class="line">å‡ºå‘ç‚¹æ˜¯ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå®‰å…¨çš„è€ƒè™‘ã€‚</span><br><span class="line">5.5 å‡ºç°æ¦‚å¿µï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨ï¼Œæ€§èƒ½å¤ªå·®</span><br><span class="line">5.6å‡ºç°group commit ç»„æäº¤åŠŸèƒ½ï¼Œæ¥æå‡å¼€å¯åŠåŒæ­¥å¤åˆ¶çš„æ€§èƒ½</span><br><span class="line">5.7æ›´åŠ å®Œå–„äº†ï¼Œåœ¨group commitåŸºç¡€ä¸Šå‡ºç°äº†MGR</span><br><span class="line">5.7çš„å¢å¼ºåŠåŒæ­¥å¤åˆ¶çš„æ–°ç‰¹æ€§ï¼šafter commitï¼› after <span class="built_in">sync</span>ï¼›</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä»€ä¹ˆæƒ…å†µä¸‹ä»£è¡¨æ•°æ®å†™å®Œäº†ï¼Œè€Œä¸”å®Œæ•´</span></span><br><span class="line">TCPç¼“å­˜ä¼šè¿”å›ä¸€ä¸ªACKç»™IOçº¿ç¨‹</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠåŒæ­¥å¤åˆ¶(åœ¨IOçº¿ç¨‹åšæ‰‹è„š)</span></span><br><span class="line">IOçº¿ç¨‹å–å‡ºæ•°æ®åï¼ŒIOçº¿ç¨‹ä¸è¿”å›ACKï¼ŒIOçº¿ç¨‹å°±ä¸å»ç»™Dumpçº¿ç¨‹è¦æ•°æ®</span><br><span class="line">åªè¦ä»åº“IOçº¿ç¨‹æ²¡æœ‰æ¥åˆ°ACKä¹‹å‰ï¼Œä¼šé˜»å¡ä¸»åº“å†™å…¥æ“ä½œ(ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½±å“ä¸»åº“æ€§èƒ½å¯¼è‡´ç”¨æˆ·çš„ä½“éªŒä¸‹é™)</span><br><span class="line"><span class="comment">#å¼€ä¸å¼€åŠåŒæ­¥å–å†³äºå…¬å¸ï¼Œä½†å‡ ä¹å¾ˆå°‘å¼€</span></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240826181704110.png" alt="image-20240826181704110"></p>
<p>åŠåŒæ­¥çš„æ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 ~]# ll /app/mysql-5.6.50/lib/plugin/</span><br><span class="line">-rwxr-xr-x 1 mysql mysql 515584 Aug  7 19:52 semisync_master.so</span><br><span class="line">-rwxr-xr-x 1 mysql mysql 276296 Aug  7 19:52 semisync_slave.so</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆä¸æ˜¯è‡ªåŠ¨å®‰è£…è¿™ä¸¤ä¸ªæ’ä»¶ï¼Ÿ</span><br><span class="line">1ã€ä¸æ˜¯æ¯ä¸ªå…¬å¸éƒ½æœ‰å¼€åŠåŒæ­¥</span><br><span class="line">2ã€å…ˆåšä¸»ä»ä¹‹åæ‰èƒ½å¼€åŠåŒæ­¥</span><br></pre></td></tr></table></figure>
<p><strong>åŠåŒæ­¥å¤åˆ¶çš„é…ç½®</strong></p>
<p>1ã€db01ä¸»åº“æ“ä½œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸»åº“æŸ¥çœ‹æ˜¯å¦æ”¯æŒåŠåŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show global variables like <span class="string">&#x27;have_dynamic_loading&#x27;</span>;</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| Variable_name        | Value |</span><br><span class="line">+----------------------+-------+</span><br><span class="line">| have_dynamic_loading | YES   |</span><br><span class="line">+----------------------+-------+</span><br><span class="line"></span><br><span class="line">2ã€ä¸»åº“éœ€è¦å®‰è£…åŠåŒæ­¥æ’ä»¶</span><br><span class="line">root@localhost:(none) &gt; install plugin rpl_semi_sync_master soname<span class="string">&#x27;semisync_master.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨æ’ä»¶+è®¾ç½®è¶…æ—¶æ—¶é—´(ä¸´æ—¶çš„) </span><br><span class="line">root@localhost:(none) &gt; SET GLOBAL rpl_semi_sync_master_enabled = 1;</span><br><span class="line">root@localhost:(none) &gt; <span class="built_in">set</span> global rpl_semi_sync_master_timeout = 1000;</span><br><span class="line"></span><br><span class="line">4ã€#æ°¸ä¹…å¯åŠ¨å†™åœ¨é…ç½®æ–‡ä»¶é‡Œé¢+è¶…æ—¶æ—¶é—´  è®¾ç½®è¶…æ—¶ 1000ms=1s</span><br><span class="line">è¶…è¿‡10sè¿˜æ²¡æœ‰å†™å®Œæ•°æ®ï¼Œä¼šåœæ­¢åŠåŒæ­¥ï¼Œæ¢å¤æˆå¼‚æ­¥å¤åˆ¶(å¦‚æœæƒ³è¦æ°¸ä¹…å¤±æ•ˆå°±å†™åœ¨é…ç½®æ–‡ä»¶é‡Œé¢)</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line">rpl_semi_sync_master_enabled=1</span><br><span class="line">rpl_semi_sync_master_timeout = 1000</span><br><span class="line"></span><br><span class="line">5ã€æ£€æŸ¥</span><br><span class="line">root@localhost:(none) &gt; show variables like<span class="string">&#x27;rpl%&#x27;</span>;</span><br><span class="line">root@localhost:(none) &gt; show variables like<span class="string">&#x27;rpl%&#x27;</span>;</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line">| Variable_name                      | Value    |</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line">| rpl_semi_sync_master_enabled       | ON       |#å¼€å¯</span><br><span class="line">| rpl_semi_sync_master_timeout       | 1000     |#è¶…æ—¶æ—¶é—´</span><br><span class="line">| rpl_semi_sync_master_trace_level   | 32       |#è·¯ç”±çš„çº§åˆ«</span><br><span class="line">| rpl_semi_sync_master_wait_no_slave | ON       |</span><br><span class="line">| rpl_stop_slave_timeout             | 31536000 |#åœæ­¢ä»åº“çš„è¶…æ—¶æ—¶é—´</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 0     |#0ä»£è¡¨å®¢æˆ·ç«¯è¿˜æ²¡æœ‰</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 0     |</span><br><span class="line">+--------------------------------------------+-------+</span><br></pre></td></tr></table></figure>
<p>2ã€db02ä»åº“é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä»åº“é…ç½®</span></span><br><span class="line">1ã€å®‰è£…æ’ä»¶</span><br><span class="line">root@localhost:world &gt; INSTALL PLUGIN rpl_semi_sync_slave SONAME<span class="string">&#x27;semisync_slave.so&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3ã€å¯åŠ¨æ’ä»¶(ä¸´æ—¶å¯åŠ¨)</span><br><span class="line">root@localhost:world &gt; SET GLOBAL rpl_semi_sync_slave_enabled = 1;</span><br><span class="line">æ°¸ä¹…ç”Ÿæ•ˆ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line">rpl_semi_sync_slave_enabled = 1</span><br><span class="line"></span><br><span class="line">4ã€é‡å¯IOçº¿ç¨‹</span><br><span class="line">root@localhost:world &gt; stop slave io_thread;</span><br><span class="line">root@localhost:world &gt; start slave io_thread;</span><br><span class="line"></span><br><span class="line">5ã€åˆ°ä¸»åº“æŸ¥çœ‹æ˜¯å¦æœ‰ä»åº“å˜æˆåŠåŒæ­¥</span><br><span class="line">root@localhost:(none) &gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 1     |#æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 0     |</span><br><span class="line">+--------------------------------------------+-------+</span><br></pre></td></tr></table></figure>
<p>3ã€æµ‹è¯•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1ã€ä¸»åº“åˆ›å»ºä¸€ä¸ªåº“</span><br><span class="line">root@localhost:(none) &gt; create database abc111;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)   <span class="comment">#é…ç½®ä¹‹åï¼Œä¸»åº“å»ºåº“æ—¶é—´å˜å¿«</span></span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; create database abc112;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; create database abc113;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@localhost:(none) &gt; create database abc114;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">2ã€æŸ¥çœ‹çŠ¶æ€ï¼Œä¼šè®°å½•å¹³å‡ç­‰å¾…æ—¶é—´  ï¼ˆmsä¸ºå•ä½ï¼‰</span><br><span class="line">root@localhost:(none) &gt; show global status like <span class="string">&#x27;rpl_semi%&#x27;</span>;</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Variable_name                              | Value |</span><br><span class="line">+--------------------------------------------+-------+</span><br><span class="line">| Rpl_semi_sync_master_clients               | 1     |</span><br><span class="line">| Rpl_semi_sync_master_net_avg_wait_time     | 4199  |</span><br><span class="line">| Rpl_semi_sync_master_net_wait_time         | 16799 |</span><br><span class="line">| Rpl_semi_sync_master_net_waits             | 4     |</span><br><span class="line">| Rpl_semi_sync_master_no_times              | 0     |</span><br><span class="line">| Rpl_semi_sync_master_no_tx                 | 0     |</span><br><span class="line">| Rpl_semi_sync_master_status                | ON    |</span><br><span class="line">| Rpl_semi_sync_master_timefunc_failures     | 0     |</span><br><span class="line">| Rpl_semi_sync_master_tx_avg_wait_time      | 4286  |#å¹³å‡ç­‰å¾…æ—¶é—´ </span><br><span class="line">| Rpl_semi_sync_master_tx_wait_time          | 17144 |</span><br><span class="line">| Rpl_semi_sync_master_tx_waits              | 4     |#ä¸€å…±4æ¡è¯­å¥</span><br><span class="line">| Rpl_semi_sync_master_wait_pos_backtraverse | 0     |</span><br><span class="line">| Rpl_semi_sync_master_wait_sessions         | 0     |</span><br><span class="line">| Rpl_semi_sync_master_yes_tx                | 4     |#æˆåŠŸæ‰§è¡Œ4æ¡è¯­å¥</span><br><span class="line">+--------------------------------------------+-------+</span><br></pre></td></tr></table></figure>
<p>å…³é—­åŠåŒæ­¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:world &gt; SET GLOBAL rpl_semi_sync_slave_enabled = 0;</span><br><span class="line">é…ç½®æ–‡ä»¶å–æ¶ˆ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">....</span><br><span class="line"><span class="comment">#rpl_semi_sync_slave_enabled = 1</span></span><br></pre></td></tr></table></figure>
<h3 id="4ã€mysqlçš„è¿‡æ»¤å¤åˆ¶">4ã€<strong>mysqlçš„è¿‡æ»¤å¤åˆ¶</strong></h3>
<p>æ¯ä¸ªä»åº“åªæƒ³å¤åˆ¶ä¸€ä¸ªåº“</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../image/study_img/image-20240826200642230.png" alt="image-20240826200642230"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ–¹æ³•ï¼š</span><br><span class="line">å¯ä»¥åœ¨ä¸»åº“é…ç½®ï¼šé…ç½®ç™½åå•æˆ–è€…é»‘åå•</span><br><span class="line">å¯ä»¥åœ¨ä»åº“é…ç½®ï¼šé…ç½®ç™½åå•æˆ–è€…é»‘åå•</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ³•ä¸€ï¼šä¸»åº“é…ç½®(ä¸€èˆ¬ä¸ç”¨)</strong></p>
<ul>
<li>binlog-do-dbï¼šç™½åå•ï¼šåªè®°å½•ç™½åå•ä¸­åˆ—å‡ºçš„åº“çš„äºŒè¿›åˆ¶æ—¥å¿—</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">è§„èŒƒçš„sqlè¯­å¥å…ˆuseä¸€ä¸ªåº“ï¼Œå†å†™æ•°æ®</span><br><span class="line"><span class="comment">#åœ¨binlogåšæ‰‹è„šï¼šbinlogåªè®°å½•prodåº“çš„æ•°æ®ï¼Œå…¶ä»–çš„ä¸è®°å½•</span></span><br><span class="line"></span><br><span class="line">1ã€#åªå¤åˆ¶å•åº“</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-do-db=prod</span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000018 |      120 | prod         |#ä»åº“åªå¤åˆ¶prodè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¤åˆ¶å¤šä¸ªåº“</span></span><br><span class="line">1ã€#é…ç½®æ–‡ä»¶å†™åº“åå­—ï¼Œæœ‰å‡ ä¸ªåº“å°±å†™å‡ è¡Œ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-do-db=prod</span><br><span class="line">binlog-do-db=world</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line">| mysql-bin.000019 |      120 | prod,world   |</span><br><span class="line">+------------------+----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•</span></span><br><span class="line">1ã€#ä¸»åº“å¾€prodåº“é‡Œé¢å†™æ•°æ®</span><br><span class="line">root@localhost:(none) &gt; use prod</span><br><span class="line">root@localhost:prod &gt; insert into prod values(77777);</span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“æŸ¥çœ‹</span><br><span class="line">root@localhost:world &gt; <span class="keyword">select</span> * from prod.prod;</span><br><span class="line">+-------+</span><br><span class="line">| 77777 |</span><br><span class="line">+-------+</span><br></pre></td></tr></table></figure>
<ul>
<li>binlog-ignore-dbï¼šé»‘åå•ï¼šä¸è®°å½•é»‘åå•åˆ—å‡ºçš„åº“çš„äºŒè¿›åˆ¶æ—¥å¿—</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#åœ¨binlogåšæ‰‹è„šï¼šbinlogä¸è®°å½•abcåº“çš„æ•°æ®ï¼Œå…¶ä»–çš„éƒ½è®°å½•</span></span><br><span class="line"></span><br><span class="line">1ã€#ä¸å¤åˆ¶å•åº“</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-ignore-db=abc</span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">root@localhost:prod &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| mysql-bin.000020 |      120 |              | abc              | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line"><span class="comment">#ä»åº“ä¸å¤åˆ¶abcè¿™ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸å¤åˆ¶å¤šä¸ªåº“</span></span><br><span class="line">1ã€#é…ç½®æ–‡ä»¶å†™åº“åå­—ï¼Œæœ‰å‡ ä¸ªåº“å°±å†™å‡ è¡Œ</span><br><span class="line">[root@db01 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">binlog-ignore-db=abc</span><br><span class="line">binlog-ignore-db=aaa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#é‡å¯</span><br><span class="line">[root@db01 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#é‡å¯ä¹‹åï¼Œä»åº“çš„ä¸»ä»å¤åˆ¶éœ€è¦é‡å¯</span><br><span class="line">root@localhost:world &gt; stop slave;start slave;</span><br><span class="line"></span><br><span class="line">4ã€#ä¸»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br><span class="line">| mysql-bin.000020 |      120 |              | abc,aaa          | </span><br><span class="line">+------------------+----------+--------------+------------------+</span><br></pre></td></tr></table></figure>
<p><strong>æ–¹æ³•äºŒï¼šä»åº“é…ç½®(å¸¸ç”¨)</strong></p>
<p>ç™½åå•ï¼šåªæ‰§è¡Œç™½åå•ä¸­åˆ—å‡ºçš„åº“æˆ–è€…è¡¨çš„ä¸­ç»§æ—¥å¿—</p>
<ul>
<li>replicate-do-db=prod    (åº“é‡Œæ‰€æœ‰è¡¨éƒ½å¤åˆ¶)</li>
<li>replicate-do-table=prod.prod     (åº“é‡Œçš„æŸä¸€å¼ è¡¨å¤åˆ¶)</li>
<li>replicate-wild-do-table=prod.p*    (åº“é‡Œä»¥på¼€å¤´çš„è¡¨éƒ½å¤åˆ¶)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">binlogä¸è®°å½•æŒ‡å®šçš„åº“ï¼Œå…¶ä»–çš„éƒ½è®°å½•</span><br><span class="line"></span><br><span class="line">è¡¨é‡Œé¢SQLçº¿ç¨‹åªæ‰§è¡Œ Replicat_Do_DBæŒ‡å®šçš„åº“çš„SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">1ã€#ä»åº“é…ç½®æ–‡ä»¶é…ç½®</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-do-db=prod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“é‡å¯</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#ä»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">.....</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: prod   <span class="comment">#åªå¤åˆ¶prodåº“</span></span><br></pre></td></tr></table></figure>
<p>é»‘åå•ï¼šä¸æ‰§è¡Œé»‘åå•ä¸­åˆ—å‡ºçš„åº“æˆ–è€…è¡¨çš„ä¸­ç»§æ—¥å¿—</p>
<ul>
<li>replicate-ignore-db=abc    (åº“é‡Œæ‰€æœ‰è¡¨ä¸å¤åˆ¶)</li>
<li>replicate-ignore-table=abc.abc    (åº“é‡Œçš„æŸä¸€å¼ è¡¨ä¸å¤åˆ¶)</li>
<li>replicate-wild-ignore-table=abc.a*      (åº“é‡Œä»¥på¼€å¤´çš„è¡¨éƒ½ä¸å¤åˆ¶)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SQLçº¿ç¨‹ä¸æ‰§è¡Œ Replicat_Ignore_DBæŒ‡å®šçš„åº“çš„SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">1ã€#ä»åº“é…ç½®æ–‡ä»¶é…ç½®</span><br><span class="line">[root@db02 ~]# vim /etc/my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">replicate-ignore-db=abc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2ã€#ä»åº“é‡å¯</span><br><span class="line">[root@db02 ~]# /etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line">3ã€#ä»åº“æŸ¥çœ‹çŠ¶æ€ï¼šåªå¤åˆ¶prodå’Œworldè¿™2ä¸ªåº“çš„äºŒè¿›åˆ¶æ—¥å¿—</span><br><span class="line">root@localhost:(none) &gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">.....</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: abc   <span class="comment">#ä¸å¤åˆ¶abcåº“</span></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>mysqlä¸»ä»å¤åˆ¶</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.fomal.cc/posts/106fae33.html">https://www.fomal.cc/posts/106fae33.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>FomalhautğŸ¥</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2024-09-21</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2024-09-21</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æŠ•å–‚ä½œè€…</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://tuchuang.voooe.cn/image/CmIeI" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/image/CmIeI" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://tuchuang.voooe.cn/image/CmVrO" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://tuchuang.voooe.cn/image/CmVrO" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/74c516b4.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_14.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">MHAé«˜å¯ç”¨</div></div></a></div><div class="next-post pull-right"><a href="/posts/42021c83.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_14.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">MySQLæ•°æ®å¤‡ä»½å’Œæ¢å¤</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81-mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">1ã€ mysqlä¸»ä»å¤åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%BB%B6%E6%97%B6%E5%A4%8D%E5%88%B6"><span class="toc-text">2ã€å»¶æ—¶å¤åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6"><span class="toc-text">3ã€åŠåŒæ­¥å¤åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81mysql%E7%9A%84%E8%BF%87%E6%BB%A4%E5%A4%8D%E5%88%B6"><span class="toc-text">4ã€mysqlçš„è¿‡æ»¤å¤åˆ¶</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">æ ¼è¨€ğŸ§¬</p><div class="bg-ad"><div>æˆå¹´äººçš„ç”Ÿæ´»ï¼šä¸‡èˆ¬çš†è‹¦ï¼Œå”¯æœ‰è‡ªæ¸¡ï¼Œæ´»ç€å°±è¦é‡å±±å¼€å±±ï¼Œè§æ°´æ¶æ¡¥ï¼Œå…¶å®ä¸€ç›´é™ªç€ä½ çš„æ°¸è¿œéƒ½æ˜¯é‚£ä¸ªäº†ä¸èµ·çš„è‡ªå·±ã€‚âœ¨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">ç‚¹å‡»å¼€å¯æ˜Ÿè¾°ä¹‹æ—…</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">çŒœä½ æƒ³çœ‹ğŸ’¡</p><ul class="ft-links"><li><a href="/posts/eec9786.html">é­”æ”¹æŒ‡å—</a><a href="/box/nav/">ç½‘å€å¯¼èˆª</a></li><li><a href="/box/Gallery/">æˆ‘çš„ç”»å»Š</a><a href="/comments/">ç•™ç‚¹ä»€ä¹ˆ</a></li><li><a href="/personal/about/">å…³äºä½œè€…</a><a href="/archives/">æ–‡ç« å½’æ¡£</a></li><li><a href="/categories/">æ–‡ç« åˆ†ç±»</a><a href="/tags/">æ–‡ç« æ ‡ç­¾</a></li><li><a href="/site/time/">å»ºè®¾è¿›ç¨‹</a><a href="/site/census/">ç½‘ç«™ç»Ÿè®¡</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">æ¨èå‹é“¾âŒ›</p><div class="ft-img-group"><div class="img-group-item"><a href="https://www.fomal.cc/" title="FomalhautğŸ¥"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/60e5d4e39da7c077.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2023-2024</b></span><span><b>&nbsp;&nbsp;By FomalhautğŸ¥</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œä¸»çº¿è·¯æ‰˜ç®¡äºVercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="æœ¬ç«™æ•°æ®åˆ†æå¾—ç›Šäº51laæŠ€æœ¯æ”¯æŒ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20226665" style="margin-inline:5px" title="æœ¬ç«™å·²åŠ å…¥èŒICPè±ªåå¥—é¤ï¼ŒèŒICPå¤‡20226665å·"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/èŒICPå¤‡-20226665-fe1384.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="æœ¬ç½‘ç«™ç»Service Workeråˆ†æµè‡³ç¼¤çº·äº‘å¯¹è±¡å­˜å‚¨"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-ç¼¤çº·äº‘-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="æœ¬ç«™ä½¿ç”¨ç½‘ç›¾æ˜Ÿçƒæä¾›CDNåŠ é€Ÿä¸é˜²æŠ¤"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-ç½‘ç›¾æ˜Ÿçƒ-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="æœ¬ç½‘ç«™æºç ç”±Githubæä¾›å­˜å‚¨ä»“åº“"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="å³é”®æ¨¡å¼" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>ç©ºé™è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>ç¾åŒ–è®¾ç½®</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>åˆ‡æ¢å…¨å±</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>æ‰“å°é¡µé¢</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://www.fomal.cc/categories/æ¼”ç¤º/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ å°Fã®æ¡ˆä¾‹æ¼”ç¤ºç¬”è®° (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://www.fomal.cc/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://source.fomal.cc/img/default_cover_14.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-11-29</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">Markdownè¯­æ³•ä¸å¤–æŒ‚æ ‡ç­¾å†™æ³•æ±‡æ€»</a><div class="blog-slider__text">æœ¬æ–‡æ±‡æ€»Markdownæ ¼å¼ä»¥åŠå¤–æŒ‚æ ‡ç­¾åœ¨ç½‘é¡µç«¯çš„æ¸²æŸ“æ•ˆæœï¼Œå¯ä½œä¸ºæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>